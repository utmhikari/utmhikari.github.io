<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ä¸€å¥—çµæ´»çš„å˜æ›´é£é™©è§‚æµ‹ç­–ç•¥åŒ¹é…æœºåˆ¶è®¾è®¡</title>
    <url>/2026/01/17/testlife/change_observe_strategy_design/</url>
    <content><![CDATA[<p>è¿‘æœŸç¬”è€…åœ¨æŠ•å…¥å˜æ›´é£é™©é˜²æ§å¼€æ”¾å¹³å°çš„é¢å¤–åŠŸèƒ½å¼€å‘ï¼Œç›®çš„æ˜¯å¸Œæœ›è®¾è®¡ä¸€å¥—æ›´åŠ çµæ´»çš„å˜æ›´é£é™©è§‚æµ‹ç­–ç•¥åŒ¹é…æœºåˆ¶ï¼Œèƒ½å¤Ÿåœ¨æ»¡è¶³é¢å‘ä»»æ„å˜æ›´åœºæ™¯åº”ç”¨è§‚æµ‹ç­–ç•¥çš„åŒæ—¶ï¼Œå°½å¯èƒ½ä¿è¯äº§å“ä½“éªŒï¼Œè®©ç”¨æˆ·æ¸…æ™°åœ°äº†è§£åˆ°è‡ªå·±é…ç½®çš„ä»€ä¹ˆç­–ç•¥èƒ½å¤Ÿåœ¨ä»€ä¹ˆæƒ…å†µçš„å˜æ›´è¿‡ç¨‹ä¸­ç”Ÿæ•ˆã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDEvMjYvdGVzdGxpZmUvY2hhbmdlX29ic2VydmVfbG9naWMv" title="https://utmhikari.top/2025/01/26/testlife/change_observe_logic/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>å½“ä¸­ï¼Œæœ‰ç²—æµ…æåˆ°å˜æ›´è§‚æµ‹ç­–ç•¥åŒ¹é…çš„äº‹æƒ…ï¼Œä½†æ²¡æœ‰æ·±å…¥æ¢ç©¶ï¼Œå¹¶ä¸”ç¬”è€…ä»¥å‰æ¥æ‰‹çš„é¡¹ç›®ï¼Œå¾ˆå¤šåº•å±‚è®¾è®¡çš„æŠ€æœ¯å€ºä¹Ÿéš¾ä»¥å¿è¿˜ï¼Œè¦åœ¨ä»¥å‰å®ç°çš„åŸºç¡€ä¸Šå†åšé‡æ„ä¹Ÿä¸æ˜¯å¾ˆç°å®äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¶ç€æ‰©å±•æ–°ç³»ç»Ÿçš„æœºä¼šï¼Œç¬”è€…é‡æ–°æ€è€ƒäº†ä¸‹å˜æ›´é£é™©è§‚æµ‹ç­–ç•¥åŒ¹é…æœºåˆ¶çš„äº‹æƒ…ï¼Œè·Ÿéšè¿™ç¯‡æ–‡ç« æ¥æŠ›ç –å¼•ç‰ä¸‹è‡ªå·±çš„æƒ³æ³•ã€‚</p>
<p>é¦–å…ˆï¼Œè¿˜æ˜¯ä¸€ä¸ªæ ¹æœ¬é—®é¢˜ï¼Œä¸€æ¡å˜æ›´é£é™©è§‚æµ‹ç­–ç•¥çš„ç²’åº¦æ˜¯æ€æ ·çš„ï¼Ÿå¦‚æœç²’åº¦å¤ªç²—ï¼Œé‚£ä¹ˆä»äº§å“è§†è§’ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´ã€Œæ‰€è§éæ‰€å¾—ã€çš„é—®é¢˜ï¼›å¦‚æœç²’åº¦å¤ªç»†ï¼Œé‚£ä¹ˆç”¨æˆ·é…ç½®èµ·æ¥ä¹Ÿä¼šç›¸å½“éº»çƒ¦ã€‚ç»è¯„ä¼°ï¼Œç”±å•ä¸ªæ£€æµ‹èƒ½åŠ›æ‰§è¡Œçš„ç²’åº¦ä»£è¡¨ä¸€æ¡ç­–ç•¥ï¼Œè¿™æ ·çš„å½¢å¼ç›¸å¯¹åˆç†ï¼Œä¸ä»…æ–¹ä¾¿äº§å“å±‚é¢åšã€Œæ‰€è§å³æ‰€å¾—ã€çš„è®¾è®¡ï¼Œè€Œä¸”å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¹Ÿå¯ä»¥ä»¥åŸå­åŒ–çš„å½¢å¼åšç¼–æ’ï¼Œä»è°ƒåº¦è§’åº¦æ¥è®²ä¹Ÿå¾ˆå®¹æ˜“æ‰©å±•ã€‚</p>
<p>è¯¦ç»†æ¥è®²ï¼Œä¸€æ¡ç­–ç•¥åœ¨è®¾è®¡ä¸Šï¼Œéœ€è¦å…³è”ä»¥ä¸‹å‡ ç±»æ¦‚å¿µï¼š</p>
<a id="more"></a>
<ul>
<li>æ£€æµ‹èƒ½åŠ›ï¼š1ä¸ªå˜æ›´é£é™©è§‚æµ‹èƒ½åŠ›ï¼Œå’Œ1å¥—èƒ½åŠ›æ‰§è¡Œ/è°ƒåº¦å‚æ•°</li>
<li>å˜æ›´åœºæ™¯ï¼šä»¥å˜æ›´æ¸ é“/ç±»å‹/é˜¶æ®µ3ä¸ªç»´åº¦æè¿°å˜æ›´åœºæ™¯ï¼Œ1æ¡ç­–ç•¥åŒ¹é…1ä¸ªå˜æ›´æ¸ é“ï¼ŒNä¸ªå˜æ›´ç±»å‹ï¼ŒNä¸ªå˜æ›´é˜¶æ®µ</li>
<li>å˜æ›´å¯¹è±¡ï¼š1ä¸ªèŒƒå›´çš„å˜æ›´å¯¹è±¡ï¼ŒåŒæ—¶ä¹Ÿè¦æ”¯æŒç»†ç²’åº¦çš„å˜æ›´å¯¹è±¡KVå±æ€§</li>
</ul>
<p>æ£€æµ‹èƒ½åŠ›çš„æ‰§è¡Œè°ƒåº¦è¿™éƒ¨åˆ†ä¸ç”¨å¤ªç»†è®²ï¼Œå˜æ›´åœºæ™¯çš„è¯ï¼Œä»ç»éªŒè§’åº¦ï¼Œæ¯ä¸ªå˜æ›´å·¥å•æœ‰å¤šä¸ªå˜æ›´é˜¶æ®µï¼Œæ‰€ä»¥å˜æ›´è§‚æµ‹éœ€è¦è§‚æµ‹çš„ç»´åº¦ä¹Ÿæ˜¯é˜¶æ®µç»´åº¦ï¼Œè¿™æ ·çš„è¯æŒ‰ç…§å˜æ›´æ¸ é“/ç±»å‹/é˜¶æ®µå»æ‹†è§£å˜æ›´åœºæ™¯ä¹Ÿæ˜¯æ¯”è¾ƒåˆç†çš„ã€‚è®¾è®¡ä¸Šçš„çº ç»“ç‚¹ä¸»è¦åœ¨äºå˜æ›´å¯¹è±¡åŒ¹é…ï¼Œåœ¨å®é™…åœºæ™¯ä¸­ï¼Œå¦‚æœå˜æ›´å¯¹è±¡æ˜¯ä»¥æ ‘çš„å½¢å¼ç®¡ç†çš„ï¼Œé‚£ä¹ˆåŒ¹é…å˜æ›´å¯¹è±¡å¯èƒ½å¾—åŒ¹é…æŸä¸ªéå¶å­èŠ‚ç‚¹ï¼›å¦‚æœå˜æ›´å¯¹è±¡å¯ä»¥ç”¨é€šç”¨çš„stringè¡¨è¾¾ï¼Œé‚£ä¹ˆç”¨æˆ·ä¹Ÿå¯èƒ½å¸Œæœ›ä¸€æ¡ç­–ç•¥åŒ¹é…å¤šä¸ªstringæˆ–è€…æ­£åˆ™ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæœ‰æ—¶ç”¨æˆ·ä¹Ÿå¸Œæœ›æŸæ¡ç­–ç•¥å»åŒ¹é…æŸä¸ªé¡¶å±‚çš„æ ‘èŠ‚ç‚¹ï¼Œä½†åˆè±å…æ‰ä¸‹çº§çš„æŸäº›å­èŠ‚ç‚¹ã€‚æ‰€ä»¥ï¼Œç”±è¿™äº›éœ€æ±‚åæ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•å¾—åˆ°è¿™æ ·çš„å˜æ›´å¯¹è±¡Matcherè®¾è®¡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ChangeObjectMatcher <span class="keyword">struct</span> &#123;</span><br><span class="line">    ObjectType <span class="keyword">string</span> <span class="string">`json:"object_type"`</span> <span class="comment">// æ ‘ç±»/å­—ç¬¦ä¸²ç±»å˜æ›´å¯¹è±¡</span></span><br><span class="line">    TreeNodeIDs []<span class="keyword">string</span> <span class="string">`json:"tree_node_ids"`</span> <span class="comment">// æ ‘ç±»å˜æ›´å¯¹è±¡ï¼ŒåŒ¹é…çš„æ ‘èŠ‚ç‚¹IDåˆ—è¡¨</span></span><br><span class="line">    ObjectValues []<span class="keyword">string</span> <span class="string">`json:"object_values"`</span> <span class="comment">// å­—ç¬¦ä¸²ç±»å˜æ›´å¯¹è±¡ï¼ŒåŒ¹é…çš„å­—ç¬¦ä¸²å€¼åˆ—è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">    ObjectAttributes <span class="keyword">map</span>[<span class="keyword">string</span>]any <span class="string">`json:"object_attributes"`</span> <span class="comment">// å­—ç¬¦ä¸²ç±»å˜æ›´å¯¹è±¡ï¼ŒåŒ¹é…çš„KVå±æ€§é”®å€¼å¯¹</span></span><br><span class="line">    ExcludeMatchers []ChangeObjectMatcher <span class="string">`json:"exclude_matchers"`</span> <span class="comment">// å­èŠ‚ç‚¹åŒ¹é…å™¨ï¼Œç”¨äºæ’é™¤æŸäº›å­èŠ‚ç‚¹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¾ˆæ–¹ä¾¿è¡¨è¾¾å‡ºã€ŒåŒ¹é…ä¸€ä¸ªèŒƒå›´çš„å˜æ›´å¯¹è±¡ï¼Œè±å…å¤šä¸ªå­èŒƒå›´çš„å˜æ›´å¯¹è±¡ã€è¿™ä¸ªäº‹æƒ…ã€‚å½“ç„¶ï¼Œå®é™…ExcludeMatcheråº”è¯¥å¾€å¤–é¢æä¸€ä¸ªå­—æ®µï¼Œåšæˆã€Œåœ¨å¤šä¸ªå­å˜æ›´åœºæ™¯ä¸‹ï¼Œè±å…å¤šä¸ªå­èŒƒå›´çš„å˜æ›´å¯¹è±¡ã€ä¼šæ›´åŠ åˆé€‚ã€‚è‡³äºå‰ç«¯åˆ†é¡µï¼Œéœ€è¦ä»DBç­›é€‰ä¸€æ³¢ä¹‹åï¼Œå†…å­˜å†ç­›é€‰ä¸€æ³¢ï¼Œç„¶åå†åšåˆ†é¡µï¼Œè¿™ä¸ªå–å†³äºç­–ç•¥çš„é‡çº§ï¼Œè‡³å°‘åœ¨ç¬”è€…çš„å®æˆ˜åœºæ™¯ä¸‹ï¼ŒDBæŸ¥è¯¢å·²ç»å¯ä»¥å˜æ›´åœºæ™¯+æ ‘èŠ‚ç‚¹ï¼Œç¬¬ä¸€æ³¢å‡ºæ¥çš„ç­–ç•¥æ•°é‡ä¹Ÿä¸ä¼šè¿‡ç™¾ï¼Œé‚£ä¹ˆåœ¨å†…å­˜é‡Œåšåˆ†é¡µï¼Œå¯¹å†…å­˜çš„å¼€é”€ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p>å³ä¾¿å¦‚æ­¤ï¼Œè¦å…¼é¡¾äº§å“è®¾è®¡å’Œè§‚æµ‹ä»»åŠ¡è¿è¡Œæ—¶çš„ã€Œæ‰€è§å³æ‰€å¾—ã€çš„è¯ï¼Œè¿˜æœ‰ä¸¤ä»¶äº‹æƒ…è¦åšã€‚</p>
<p>ç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯ï¼Œéœ€è¦ä»å˜æ›´å¯¹è±¡çš„è§’åº¦ï¼Œå¦å¤–å¢åŠ ä¸€å¥—ExcludeMatcherã€‚è¿™æ ·åšæ˜¯å› ä¸ºï¼Œç”¨æˆ·æ“ä½œå±‚é¢ï¼Œå¯èƒ½åœ¨å‰ç«¯å¯ä»¥çœ‹åˆ°æŸäº›ç­–ç•¥æ˜¯å¦åŒ¹é…ä¸Šï¼Œä½†ä¹Ÿå¸Œæœ›èƒ½å¤Ÿçœ‹åˆ°è¿™äº›ç­–ç•¥çš„å¯ç¦ç”¨æƒ…å†µã€‚è¿™ä¸ªå¯ç¦ç”¨æ˜¯å˜æ›´å¯¹è±¡è§†è§’ä¸‹çš„ï¼Œæ‰€ä»¥éœ€è¦æœ‰å¦ä¸€å¥—ExcludeMatcheræ¥è¡¨è¾¾ã€‚</p>
<p>ç¬¬äºŒä»¶äº‹æƒ…æ˜¯ï¼Œéœ€è¦æŠŠå‰ç«¯è§†è§’çš„åŒ¹é…é€»è¾‘å’Œæ£€æµ‹ä»»åŠ¡è§†è§’çš„åŒ¹é…é€»è¾‘åŒºåˆ†ä¸¤ä¸ªPolicyã€‚è¿™æ˜¯å› ä¸ºï¼Œå‰ç«¯è§†è§’ä¸‹ç­›é€‰æ¡ä»¶æœ‰é™ï¼Œç†è®ºä¸Šè‚¯å®šæ— æ³•ã€Œæ‰€è§å³æ‰€å¾—ã€ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦åŒ¹é…ç»†ç²’åº¦çš„ObjectAttributesï¼Œé‚£åªæœ‰åœ¨æ£€æµ‹ä»»åŠ¡è¿è¡Œæ—¶æ‰ä¼šçŸ¥é“ã€‚æ‰€ä»¥é™¤äº†äº§å“è®¾è®¡ä¸Šéœ€è¦æœ‰é¢å¤–çš„è¯´æ˜ä¹‹å¤–ï¼Œæ£€ç´¢æµç¨‹è®¾è®¡ä¸Šç”¨ä¸€ä¸ªå•ç‹¬çš„MatchPolicyå­—æ®µå»è¡¨è¾¾ï¼Œæ¯”å¦‚MatchPolicyä¸ºRuntimeå°±åŒ¹é…ç»†ç²’åº¦çš„å˜æ›´å±æ€§ï¼Œé‚£è¿™æ ·å†™ç­–ç•¥åŒ¹é…é€»è¾‘å°±æ¯”è¾ƒæ–¹ä¾¿äº†ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>äº§å“</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘å¿«é€Ÿä¸Šæ‰‹å¤æ‚åç«¯é¡¹ç›®å¼€å‘çš„ç»éªŒ</title>
    <url>/2026/01/17/geekdaily/project_work_quickstart/</url>
    <content><![CDATA[<p>å»å¹´å¹´åº•ä¸€æ®µæ—¶é—´ï¼Œç¬”è€…å‚ä¸äº†ç»„ç»‡å†…éƒ¨æ™ºèƒ½åŒ–å¹³å°é¡¹ç›®ç ”å‘æ”»åšï¼Œè™½ç„¶ä¸»æ”»å¹³å°å·¥ç¨‹éƒ¨åˆ†ï¼Œä½†å¤šå°‘ä¹Ÿäº†è§£äº†ä¸‹ç›®å‰AIGCå¯ä»¥åº”ç”¨åˆ°çš„ä¸€äº›ä¸šåŠ¡åœºæ™¯ï¼Œä»¥åŠæŠ€æœ¯å®è·µã€é¡¹ç›®ç®¡ç†çš„ä¸€äº›äº‹æƒ…ã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMTIvMDcvYXJjaGlhcnQvbGxtX2F1Z21lbnRfZGV2ZWxvcG1lbnRfcm9sZXMv" title="https://utmhikari.top/2025/12/07/archiart/llm_augment_development_roles/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>é‡Œå¤´ï¼Œæœ‰æµ…è¦æè¿°ä¸‹AIGC+Webç±»é¡¹ç›®çš„è§’è‰²åˆ†å·¥å’Œé…åˆã€‚é‚£ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±æµ…èŠä¸€ä¸‹å¦‚æœä½ å³å°†æ·±å…¥æ­¤å±€ï¼Œé€‚åº”ä¸€ä¸ªå¤æ‚çš„åç«¯é¡¹ç›®å¼€å‘ï¼Œæœ‰ä»€ä¹ˆæ–¹æ³•è®ºæ˜¯å¯ä»¥é€šç”¨çš„ã€‚</p>
<p>ä¸»è¦æ˜¯ä¸¤ä¸ªå…³é”®ç‚¹ï¼šï¼ˆ1ï¼‰ç†è§£äº§å“åŠæ¦‚å¿µå®ä½“è”ç³»ï¼›ï¼ˆ2ï¼‰ä¸»åŠ¨æ‹†è§£ç›®æ ‡å„ä¸ªå‡»ç ´ã€‚</p>
<a id="more"></a>
<p>ç¬¬ä¸€ä¸ªç‚¹æ¯”è¾ƒé‡è¦ï¼Œåœ¨ç†è§£å…·ä½“ä»£ç ä¹‹å‰ï¼Œæœ€å¥½æ˜¯ç†Ÿæ‚‰äº§å“ï¼Œäº†è§£äº§å“å‰ç«¯æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå°è¯•å…ˆå…¥ä¸ºä¸»åœ°çŒœæƒ³åç«¯çš„è®¾è®¡å®ç°ï¼ŒæŠŠè‡ªå·±çš„æƒ³æ³•å¸¦å…¥è¿›å»ï¼Œå†ç»“åˆä¸€äº›AIGCè§£è¯»å·¥å…·ç†è§£ä»£ç ï¼Œåé¢å°±æ¯”è¾ƒå¥½ä¸‹æ‰‹ã€‚</p>
<p>å½“ç„¶è¿™é‡Œä¸æ’é™¤ä¸€äº›æƒ…å†µæ˜¯ï¼Œæ¯”å¦‚å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œæµç¨‹ç±»çš„å®ç°ï¼Œçº¯åç«¯çš„éƒ¨åˆ†ï¼Œå°±å¯èƒ½æ¶‰åŠåˆ°å¤šæ–¹çš„åä½œã€‚è¿™ç§æƒ…å†µè¿˜æ˜¯ä»¥å¤šæ²Ÿé€šå¤šäº†è§£ä¸ºä¸»ï¼Œå¥½æ¯”è¯´ä¸€ä¸ªè‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œï¼Œå•ä¸ªä»»åŠ¡ä¸‹é¢åŒ…å«å¤šä¸ªç”¨ä¾‹æ‰§è¡Œï¼Œæ¯ä¸ªç”¨ä¾‹æ‰§è¡Œåˆ†å¤šä¸ªOSï¼Œå¹³å°çš„ä»»åŠ¡çŠ¶æ€ç®¡ç†å’Œç”¨ä¾‹æ‰§è¡Œçš„ä»»åŠ¡çŠ¶æ€ç®¡ç†å¯èƒ½å­˜åœ¨ä¸åŒçš„æœåŠ¡ä¸Šï¼Œä¸­é—´çŠ¶æ€æ€ä¹ˆæµè½¬æ€ä¹ˆåŒæ­¥ï¼Œå¡çŠ¶æ€äº†æ€ä¹ˆè¡¥å¿ï¼Œè¿™äº›å®ç°éƒ½æ˜¯å¾—æ·±å…¥å»æ²Ÿé€šäº†è§£çš„ã€‚ç„¶åï¼Œè‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œæœ‰AIå¢å¼ºçš„åœºæ™¯ï¼Œä¹Ÿéœ€è¦äº†è§£ä»€ä¹ˆåœ°æ–¹ç”¨äº†AIå¢å¼ºï¼Œæ¯”å¦‚ç”¨ä¾‹æœ¬èº«æ˜¯AIç”Ÿæˆçš„ï¼Œæˆ–è€…åŸºäºAIåšäº†æ”¹å†™ä¼˜åŒ–ï¼Œé‚£ä¹ˆå¹³å°ç«¯å’ŒAIå®ç°ç«¯æ˜¯æ€ä¹ˆåŒæ­¥AIGCé˜¶æ®µæ€§ä¿¡æ¯çš„ï¼Œè¿™äº›ä¹Ÿå¾—ç¡®è®¤ã€‚äº†è§£äº†ä¸­é—´çš„æœºç†å’Œä»£ç å®ç°ï¼Œè‡ªå·±å¿ƒä¸­æœ‰è“å›¾ä¹‹åï¼Œåç»­å°±å¥½ä¸‹æ‰‹ã€‚</p>
<p>ç¬¬äºŒä¸ªç‚¹æ˜¯è¦ä¸»åŠ¨æ‹†è§£ç ”å‘ç›®æ ‡ï¼Œæ¯”å¦‚ä¸€å¥—çŸ¥è¯†åº“æœåŠ¡ï¼Œå¯èƒ½åŒ…å«çŸ¥è¯†åº“/æ–‡æ¡£/åˆ‡ç‰‡ç®¡ç†ã€çŸ¥è¯†æ£€ç´¢ã€åœ¨ç¦»çº¿çŸ¥è¯†é‡‡é›†/æ¸…æ´—/å…¥åº“ï¼ŒçŸ¥è¯†ä¿é²œç­‰æ¨¡å—ï¼Œé‚£ä¹ˆé¦–å…ˆå°±è¦ç¡®å®šè‡ªå·±çš„è´Ÿè´£èŒƒå›´æ˜¯å“ªäº›ï¼Œå…¶æ¬¡å°±æ˜¯æ ¹æ®ä½ å¯¹æ•´å¥—äº§å“æˆ–è€…æŠ€æœ¯è®¾è®¡çš„äº†è§£ï¼Œè‡ªä¸»å»æ‹†åˆ†è¿™äº›äº‹æƒ…çš„ä¾èµ–å…³ç³»å’Œä¼˜å…ˆçº§ï¼Œè€Œä¸æ˜¯è¢«åŠ¨å»è¿åˆéœ€æ±‚åˆ†é…ã€‚</p>
<p>æ¯”å¦‚ï¼Œç¬”è€…è´Ÿè´£çŸ¥è¯†åº“ç®¡ç†ã€çŸ¥è¯†æ£€ç´¢ä»¥åŠå†å²çŸ¥è¯†å›æº¯çš„äº‹æƒ…ï¼Œé‚£ä¹ˆé¡ºåºä¸Šå°±æ˜¯çŸ¥è¯†åº“ç®¡ç†-&gt;å†å²çŸ¥è¯†å›æº¯-&gt;çŸ¥è¯†æ£€ç´¢ï¼Œè€ŒçŸ¥è¯†å›æº¯ä¹Ÿä¾èµ–çŸ¥è¯†åº“/æ–‡æ¡£/åˆ‡ç‰‡ç®¡ç†çš„å®Œæˆï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦äº†è§£åˆ«äººåœ¨æ–‡æ¡£/åˆ‡ç‰‡ç®¡ç†æ–¹é¢å®ç°æ˜¯æ€ä¹ˆæ ·çš„ï¼Œç„¶åå†åšçŸ¥è¯†å›æº¯çš„è¯ï¼Œä¹Ÿéœ€è¦äº†è§£ç¦»çº¿çŸ¥è¯†å…¥åº“çš„æœºåˆ¶å’Œæ¥å£æ˜¯æ€æ ·çš„ã€‚é€šè¿‡åŒ–è¢«åŠ¨ä¸ºä¸»åŠ¨ï¼Œå°±å¯ä»¥èƒ½å¤Ÿå¯¹è‡ªèº«çš„èŒè´£å’Œè¦åšçš„äº‹æƒ…æœ‰æ›´å¥½çš„æŠŠæ¡ã€‚</p>
<p>æ€»çš„æ¥è®²ï¼Œå¤æ‚çš„é¡¹ç›®ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯è‡ªå·±ä¸çŸ¥é“è¯¥åšä»€ä¹ˆã€‚ä½œä¸ºæŠ€æœ¯ä»ä¸šè€…ï¼Œæ¯”èµ·å†™ä»£ç æœ¬èº«ï¼Œæ›´éœ€è¦çŸ¥é“å†™ä»£ç çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Œç„¶åå†åæ¨è‡ªå·±éœ€è¦åšä»€ä¹ˆã€‚è¿™æ ·å·¥ä½œæ€è·¯å°±èƒ½æ›´æ¸…æ™°ï¼Œåšå¤æ‚é¡¹ç›®å¼€å‘ä¹Ÿä¼šæ›´åŠ å®¹æ˜“ä¸Šæ‰‹ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>äº§å“</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>AI</tag>
        <tag>çŸ¥è¯†åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘ç®€è¿°LLMå¢å¼ºäº§å“ç ”å‘è§’è‰²</title>
    <url>/2025/12/07/archiart/llm_augment_development_roles/</url>
    <content><![CDATA[<p>2025å¹´ç®—æ˜¯LLMå¢å¼ºäº§å“äº•å–·çš„ä¸€å¹´ï¼Œä»¥ç¬”è€…äº²èº«ç»å†çš„ï¼Œä¸è®ºæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°è¿˜æ˜¯äº‘æœåŠ¡ç¨³å®šæ€§å¹³å°ï¼Œéƒ½åœ¨å·²æœ‰å¹³å°åŸºå»ºçš„åŸºç¡€ä¸Šï¼Œä¾é LLMå¢å¼ºçš„AIGCèƒ½åŠ›ï¼Œåšäº†è¯¸å¦‚XMindç”¨ä¾‹è‡ªåŠ¨ç”Ÿæˆã€ç”¨ä¾‹æ­¥éª¤è‡ªä¸»æ¢ç´¢ã€RCAæ•…éšœå®šä½ä»¥åŠæœåŠ¡å‘å¸ƒé£é™©å®æ—¶è§£è¯»ç­‰æœ‰ä¸šåŠ¡ä»·å€¼çš„èƒ½åŠ›ã€‚</p>
<p>è¦åšå‡ºè¿™æ ·çš„äº§å“ï¼ŒæŠ•å…¥çš„ç ”å‘äººåŠ›ä¹Ÿè‚¯å®šä¸å°‘ï¼Œè€Œåœ¨è¿™ä¸ªä½“ç³»ä¸‹ï¼Œæ€ä¹ˆåˆ†é…ä¸åŒçš„ç ”å‘è§’è‰²ï¼Œæ—¢èƒ½è®©æ¯ä¸ªæ¨¡å—çš„åŒå­¦ä¸“æ³¨è‡ªèº«èƒ½åŠ›ç ”å‘ï¼Œåˆå¯ä»¥å½¢æˆæœ‰æœºç»“åˆè®©æ•´ä¸ªäº§å“é¡ºåˆ©è¿è½¬èµ·æ¥ï¼Œæ˜¯äº§å“æ¶æ„è¿­ä»£è¿‡ç¨‹ä¸­æ—¶åˆ»éƒ½è¦æ€è€ƒçš„é‡è¦é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œè¿™ç¯‡æ–‡ç« å°±ç®€å•èŠä¸‹ï¼Œå¦‚æœè¦å¤§åŠ›æŠ•å…¥è¿™ç±»å‹çš„äº§å“ç ”å‘ï¼Œå¯èƒ½éœ€è¦å“ªäº›è§’è‰²ï¼Œä»¥åŠå…¶ä¸­å¯èƒ½å­˜åœ¨é…åˆæ˜¯æ€æ ·çš„ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆä»çº¯æŠ€æœ¯è§’åº¦å‡ºå‘çš„è¯ï¼Œå¯èƒ½éœ€è¦è¿™ä¹ˆå‡ ç±»ç ”å‘ï¼š</p>
<ul>
<li>å¹³å°å·¥ç¨‹ï¼šåˆ†å‰åç«¯è§’è‰²ï¼ŒæŠŠæ¡æ•´ä¸ªå¹³å°çš„æ ¸å¿ƒæ¶æ„è¿­ä»£ï¼Œä¸»æ§éœ€æ±‚äº¤ä»˜ï¼ŒåŒæ—¶å…³æ³¨äº§å“ä¸šåŠ¡è·Ÿç¨³å®šæ€§æŒ‡æ ‡ï¼›</li>
<li>ä¸šåŠ¡åŸŸå·¥ç¨‹ï¼šæ¯”å¦‚è‡ªåŠ¨åŒ–æµ‹è¯•æˆ–è€…ç¨³å®šæ€§ï¼Œä¹Ÿå°‘ä¸äº†ä»»åŠ¡è°ƒåº¦å¹³å°ã€SREç¨³å®šæ€§ç­‰ä¸šåŠ¡åŸŸç ”å‘çš„å‚ä¸ï¼›</li>
<li>Agentå·¥ç¨‹ï¼šåœ¨LLMå¢å¼ºäº§å“å°‘ä¸äº†Chat-Agentçš„å‰æä¸‹ï¼Œè´Ÿè´£Agentå¹³å°ç ”å‘ï¼Œä¹Ÿå…³æ³¨Agentçš„ä¸šåŠ¡åœºæ™¯å’Œæ•ˆæœæŒ‡æ ‡ï¼›</li>
<li>æ™ºèƒ½åŒ–å·¥ç¨‹ï¼šè´Ÿè´£äº§å“ä¸­LLMå¢å¼º/AIGCèƒ½åŠ›çš„ä¸“é¡¹ç ”å‘ï¼Œä¸€èˆ¬ä½œä¸ºäº§å“/Agent/ä¸šåŠ¡åŸŸå·¥ç¨‹çš„ä¸‹æ¸¸ï¼Œä¸»è¦å…³æ³¨èƒ½åŠ›æ•ˆæœï¼›</li>
<li>çŸ¥è¯†åº“å·¥ç¨‹ï¼šä¸€èˆ¬ä½œä¸ºæ™ºèƒ½åŒ–èƒ½åŠ›çš„ä¸‹æ¸¸ï¼Œè´Ÿè´£çŸ¥è¯†åº“CRUDã€çŸ¥è¯†ç”Ÿäº§ã€RAGç­‰åŠŸèƒ½ç ”å‘ï¼Œä¸ºæ™ºèƒ½åŒ–èƒ½åŠ›æä¾›ä¸Šä¸‹æ–‡åŸºå»ºï¼›</li>
<li>æ™ºèƒ½åŒ–ç®—æ³•ï¼šä¸»è¦è´Ÿè´£é¢å‘ä¸šåŠ¡çš„æ¨¡å‹è°ƒä¼˜å·¥ä½œï¼Œæ³¨é‡æ™ºèƒ½åŒ–/Agentèƒ½åŠ›æ•ˆæœæŒ‡æ ‡ã€‚</li>
</ul>
<p>åœ¨è¿™æ ·åŸºç¡€ä¸Šï¼Œæ¯ç±»è§’è‰²çš„èŒè´£å°±ä¼šåˆ’åˆ†åœ°æ¯”è¾ƒæ¸…æ™°ï¼Œå¯¹äºå•ä¸ªèƒ½åŠ›ï¼Œä¸åŒè§’è‰²ä¹‹é—´å¦‚ä½•äº§ç”ŸæŠ€æœ¯é…åˆä¹Ÿä¼šæ¯”è¾ƒæ¸…æ¥šã€‚</p>
<p>å†å®è§‚ä¸€ç‚¹ï¼Œä»ä¸šåŠ¡äº§å“çš„è§’åº¦å‡ºå‘çš„è¯ï¼Œäº§å“ç»ç†ã€ä¸šåŠ¡è¿è¥ã€ä¸šåŠ¡BPè·Ÿè´¨é‡QAç­‰è§’è‰²ä¹Ÿæ˜¯ä¸å¯å°‘çš„ã€‚åœ¨ç°å®åœºæ™¯ä¸‹ï¼Œå¯èƒ½æ˜¯äº§å“ç»ç†æŠŠæ¡åŠŸèƒ½è¿­ä»£å’Œæ’æœŸå®šå®¹ï¼Œä¸šåŠ¡è¿è¥è´Ÿè´£äº§å“è¥é”€å’Œæ¨å¹¿ï¼Œä¸šåŠ¡BPè´Ÿè´£ToBå®šç‚¹æ¨å¹¿è½åœ°ï¼Œè€Œè´¨é‡QAè´Ÿè´£æŠŠæ§äº§å“è´¨é‡åšåŠŸèƒ½æµ‹è¯•å’Œæ•ˆæœè¯„æµ‹ã€‚é€šè¿‡è¿™æ ·çš„åˆ†å·¥ï¼Œæ•´å¥—äº§å“ç ”å‘è¿­ä»£å°±å¯ä»¥æœ‰æ•ˆè¿è½¬èµ·æ¥ã€‚</p>
<p>è¿™é‡Œé‡ç‚¹è¯´ä¸‹è´¨é‡QAçš„è§’è‰²ï¼Œåœ¨é™æœ¬å¢æ•ˆçš„å¤§ç¯å¢ƒä¸‹ï¼Œå¾ˆå¤šQAçš„äººåŠ›éƒ½ä¼šè¢«ç ï¼Œè¿™æ ·å¿…ç„¶å¸¦æ¥äº§å“è´¨é‡é£é™©ï¼Œæœ¬è´¨ä¾¿æ˜¯ä¿è´¨é‡çš„äº‹æƒ…åˆ†æ‘Šåˆ°äº†ä¸åŒäººèº«ä¸Šï¼Œä½†å…¶å®ƒè§’è‰²éƒ½æ²¡æœ‰è¶³å¤Ÿç²¾åŠ›å»æŠŠè¿™ç‚¹åšæ·±ï¼Œæ‰€ä»¥äº¤ä»˜æ—¶å€™å°±å®¹æ˜“å‡ºç°å„ç®¡å„çš„çš„æƒ…å†µã€‚å¦‚æœæœ‰æ¡ä»¶ï¼Œæ„¿æ„æŠŠäº§å“è´¨é‡åšçš„æ›´å¥½çš„è¯ï¼Œå¯¹äºLLMå¢å¼ºäº§å“ç ”å‘è¿™ä»¶äº‹æƒ…ï¼Œæœ€å¥½è¿˜æ˜¯å¼•å…¥ä¸“é—¨æŠŠæ§äº¤ä»˜è´¨é‡çš„è§’è‰²ï¼Œé‡ç‚¹è¡¥ä½P0åŠŸèƒ½ã€æ•ˆæœè¯„æµ‹ç­‰å¤æ‚çš„ã€å„æ–¹éƒ½æ²¡æœ‰è¶³å¤Ÿç²¾åŠ›æŠ•å…¥çš„ã€å­˜åœ¨è¾ƒå¤§è´¨é‡äº¤ä»˜é£é™©çš„äº‹æƒ…ï¼ŒååŠ›æŠŠæ•ˆæœæŒ‡æ ‡å’Œä¸šåŠ¡æŒ‡æ ‡éƒ½ä¼˜åŒ–ä¸Šæ¥ã€‚</p>
<p>æœ€åå°±æ˜¯ï¼Œå¦‚æœè¯»è€…ä½ æ­£å¥½èº«åœ¨æ­¤å±€ï¼Œä¸å¦¨ä¹Ÿä»å®è§‚è§†è§’å®¡è§†ä¸‹è‡ªå·±é¡¹ç›®çš„è¿è½¬ï¼Œçœ‹çœ‹è‡ªå·±èº«å¤„ä»€ä¹ˆè§’è‰²ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®é‡Œèƒ½å¤Ÿå¤šåšäº›ä»€ä¹ˆï¼Œå¤šäº†è§£äº›ä»€ä¹ˆã€‚é™¤äº†æŠ€æœ¯ç ”å‘æœ¬èº«ä¹‹å¤–ï¼Œå¯¹äºå¦‚ä½•æ‹‰é€šå¤æ‚çš„ä¸Šä¸‹æ¸¸ï¼Œåè°ƒå„æ–¹èµ„æºï¼ŒæŠŠè‡ªå·±è´Ÿè´£çš„åŠŸèƒ½å’Œæ•ˆæœéƒ½åšåˆ°æè‡´ï¼Œè¿™ä»½æ€è€ƒï¼Œè¯´ä¸å®šæ˜¯æ­¤åˆ»çš„ä½ æ‰€éœ€è¦çš„ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>äº§å“</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>AI</tag>
        <tag>LLM</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘æ™ºèƒ½åŒ–å·¥ç¨‹AgentFlowä»£ç å®ç°åˆ†æ</title>
    <url>/2025/12/07/geekdaily/agentflow_code/</url>
    <content><![CDATA[<p>è¿‘æœŸç¬”è€…å› ä¸ºå‚ä¸LLMå¢å¼ºé¡¹ç›®æ”»åšï¼Œå¯¹LLMå·¥ç¨‹ç›¸å…³çš„æŠ€æœ¯ä¹Ÿå¸Œæœ›æœ‰ä¸€å®šçš„äº†è§£ï¼Œå› æ­¤å¸Œæœ›å€Ÿè¿™ä¸ªæœºä¼šï¼Œè¯»ä¸€äº›æ–‡ç« å……ç”µï¼Œçœ‹çœ‹ç›®å‰LLMæ™ºèƒ½åŒ–å·¥ç¨‹çš„ä¸€äº›ç ”ç©¶è¶‹åŠ¿ã€‚åœ¨é˜…è¯»äº†å‡ ç¯‡æ–‡ç« ä¹‹åï¼Œæœ€ç»ˆè¯»è€…é€‰å®š<span class="exturl" data-url="aHR0cHM6Ly9hZ2VudGZsb3cuc3RhbmZvcmQuZWR1Lw==" title="https://agentflow.stanford.edu/">AgentFlow<i class="fa fa-external-link"></i></span>è¿™ä¸ªé¡¹ç›®åšä»£ç å®ç°åˆ†æã€‚ç”±äºç¬”è€…åœ¨ç®—æ³•æ–¹é¢çš„æ¶‰çŒå®åœ¨ä¸æ·±ï¼Œæ‰€ä»¥æœ¬æ–‡åªæ˜¯æŠ›ç –å¼•ç‰ï¼Œé˜è¿°ä¸Šæœ‰ä»€ä¹ˆä¸ä¸“ä¸šä¸ä¸¥è°¨çš„åœ°æ–¹ï¼Œä¹Ÿè¾›è‹¦å¤§å®¶æŒ‡æ­£ã€‚</p>
<p>AgentFlowä¸»è¦è§£å†³ç°æœ‰LLMåœ¨è¿›è¡Œå·¥å…·å¢å¼ºæ¨ç†æ—¶æœ‰å¯æ‰©å±•å’Œæ³›åŒ–èƒ½åŠ›å·®çš„é—®é¢˜ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨çº¿LLM-AgentæœåŠ¡ç¼ºä¹åœ¨ç”Ÿäº§ç¯å¢ƒä¸­RLï¼ˆå¼ºåŒ–å­¦ä¹ ï¼‰çš„æ‰‹æ®µã€‚æ‰€ä»¥AgentFlowæå‡ºäº†ä»¥ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼Œä¸€æ˜¯ä¸€å¥—åŠ¨æ€è®­ç»ƒPlannerçš„ç¼–æ’ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ä¸€å¥—å¥–åŠ±ç›®æ ‡è®­ç»ƒç®—æ³•Flow-GRPOã€‚æºç å¯ä»¥é€šè¿‡<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2x1cGFudGVjaC9BZ2VudEZsb3c=" title="https://github.com/lupantech/AgentFlow">è¿™ä¸ªGitHub<i class="fa fa-external-link"></i></span>æ¥ä¸‹è½½ï¼Œè·‘äº†ä¸€ç•ªçœ‹Agentç¼–æ’çš„å®ç°æ¯”è¾ƒå®Œæ•´ï¼Œä½†åœ¨çº¿æœåŠ¡è·Ÿè®­ç»ƒçš„éƒ¨ç½²æ‰§è¡Œä¼šæ¯”è¾ƒéš¾æï¼Œæ‰€ä»¥æœ¬æ–‡æ›´å€¾å‘äºå¯¹Agentç¼–æ’åšè¯¦ç»†é˜è¿°ã€‚</p>
<p>Agentç¼–æ’åŒ…å«Plannerã€Executorã€Verifierè·ŸGeneratorå››ä¸ªè§’è‰²ï¼ŒPlannerä¼šä¸æ–­Rolloutåˆ¤æ–­ä¸‹ä¸€æ­¥è¦åšä»€ä¹ˆï¼ŒExecutoræ‰§è¡ŒToolCallï¼ŒVerifieråˆ¤æ–­å½“å‰é—®é¢˜æ˜¯å¦è§£å†³ï¼ŒGeneratorè´Ÿè´£æ•´åˆOutputã€‚æ•´ä¸ªæ ¸å¿ƒä»£ç é›†ä¸­åœ¨Solver.solveï¼Œé•¿è¿™ä¸ªæ ·å­ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solver</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span><span class="params">(self, question: str, image_path: Optional[str] = None)</span>:</span></span><br><span class="line">        <span class="comment"># Update cache directory for the executor</span></span><br><span class="line">        self.executor.set_query_cache_dir(self.root_cache_dir)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Initialize json_data with basic problem information</span></span><br><span class="line">        json_data = &#123;</span><br><span class="line">            <span class="string">"query"</span>: question,</span><br><span class="line">            <span class="string">"image"</span>: image_path</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Generate base response if requested</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'base'</span> <span class="keyword">in</span> self.output_types:</span><br><span class="line">            base_response = self.planner.generate_base_response(question, image_path, self.max_tokens)</span><br><span class="line">            json_data[<span class="string">"base_response"</span>] = base_response</span><br><span class="line"></span><br><span class="line">        <span class="comment"># If only base response is needed, save and return</span></span><br><span class="line">        <span class="keyword">if</span> set(self.output_types) == &#123;<span class="string">'base'</span>&#125;:</span><br><span class="line">            <span class="keyword">return</span> json_data</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># Continue with query analysis and tool execution if final or direct responses are needed</span></span><br><span class="line">        <span class="keyword">if</span> &#123;<span class="string">'final'</span>, <span class="string">'direct'</span>&#125; &amp; set(self.output_types):</span><br><span class="line">            <span class="comment"># [1] Analyze query</span></span><br><span class="line">            query_start_time = time.time()</span><br><span class="line">            query_analysis = self.planner.analyze_query(question, image_path)</span><br><span class="line">            json_data[<span class="string">"query_analysis"</span>] = query_analysis</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Main execution loop</span></span><br><span class="line">            step_count = <span class="number">0</span></span><br><span class="line">            action_times = []</span><br><span class="line">            <span class="keyword">while</span> step_count &lt; self.max_steps <span class="keyword">and</span> (time.time() - query_start_time) &lt; self.max_time:</span><br><span class="line">                step_count += <span class="number">1</span></span><br><span class="line">                step_start_time = time.time()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># [2] Generate next step</span></span><br><span class="line">                local_start_time = time.time()</span><br><span class="line">                next_step = self.planner.generate_next_step(</span><br><span class="line">                    question, </span><br><span class="line">                    image_path, </span><br><span class="line">                    query_analysis, </span><br><span class="line">                    self.memory, </span><br><span class="line">                    step_count, </span><br><span class="line">                    self.max_steps,</span><br><span class="line">                    json_data</span><br><span class="line">                )</span><br><span class="line">                context, sub_goal, tool_name = self.planner.extract_context_subgoal_and_tool(next_step)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> tool_name <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> tool_name <span class="keyword">not</span> <span class="keyword">in</span> self.planner.available_tools:</span><br><span class="line">                    print(<span class="string">f"\n==&gt; ğŸš« Error: Tool '<span class="subst">&#123;tool_name&#125;</span>' is not available or not found."</span>)</span><br><span class="line">                    command = <span class="string">"No command was generated because the tool was not found."</span></span><br><span class="line">                    result = <span class="string">"No result was generated because the tool was not found."</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># [3] Generate the tool command</span></span><br><span class="line">                    local_start_time = time.time()</span><br><span class="line">                    tool_command = self.executor.generate_tool_command(</span><br><span class="line">                        question, </span><br><span class="line">                        image_path, </span><br><span class="line">                        context, </span><br><span class="line">                        sub_goal, </span><br><span class="line">                        tool_name, </span><br><span class="line">                        self.planner.toolbox_metadata[tool_name],</span><br><span class="line">                        step_count,</span><br><span class="line">                        json_data</span><br><span class="line">                    )</span><br><span class="line">                    analysis, explanation, command = self.executor.extract_explanation_and_command(tool_command)</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment"># [4] Execute the tool command</span></span><br><span class="line">                    local_start_time = time.time()</span><br><span class="line">                    result = self.executor.execute_tool_command(tool_name, command)</span><br><span class="line">                    result = make_json_serializable_truncated(result) <span class="comment"># Convert to JSON serializable format</span></span><br><span class="line">                    json_data[<span class="string">f"tool_result_<span class="subst">&#123;step_count&#125;</span>"</span>] = result</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Track execution time for the current step</span></span><br><span class="line">                execution_time_step = round(time.time() - step_start_time, <span class="number">2</span>)</span><br><span class="line">                action_times.append(execution_time_step)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Update memory</span></span><br><span class="line">                self.memory.add_action(step_count, tool_name, sub_goal, command, result)</span><br><span class="line">                memory_actions = self.memory.get_actions()</span><br><span class="line"></span><br><span class="line">                <span class="comment"># [5] Verify memory (context verification)</span></span><br><span class="line">                local_start_time = time.time()</span><br><span class="line">                stop_verification = self.planner.verificate_context(</span><br><span class="line">                    question, </span><br><span class="line">                    image_path, </span><br><span class="line">                    query_analysis, </span><br><span class="line">                    self.memory,</span><br><span class="line">                    step_count,</span><br><span class="line">                    json_data</span><br><span class="line">                )</span><br><span class="line">                context_verification, conclusion = self.planner.extract_conclusion(stop_verification)</span><br><span class="line">                </span><br><span class="line">                <span class="comment"># Break the loop if the context is verified</span></span><br><span class="line">                <span class="keyword">if</span> conclusion == <span class="string">'STOP'</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Add memory and statistics to json_data</span></span><br><span class="line">            json_data.update(&#123;</span><br><span class="line">                <span class="string">"memory"</span>: memory_actions,</span><br><span class="line">                <span class="string">"step_count"</span>: step_count,</span><br><span class="line">                <span class="string">"execution_time"</span>: round(time.time() - query_start_time, <span class="number">2</span>),</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Generate final output if requested</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'final'</span> <span class="keyword">in</span> self.output_types:</span><br><span class="line">                final_output = self.planner.generate_final_output(question, image_path, self.memory)</span><br><span class="line">                json_data[<span class="string">"final_output"</span>] = final_output</span><br><span class="line">                print(<span class="string">f"\n==&gt; ğŸ™ Detailed Solution:\n\n<span class="subst">&#123;final_output&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Generate direct output if requested</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">'direct'</span> <span class="keyword">in</span> self.output_types:</span><br><span class="line">                direct_output = self.planner.generate_direct_output(question, image_path, self.memory)</span><br><span class="line">                json_data[<span class="string">"direct_output"</span>] = direct_output</span><br><span class="line">                print(<span class="string">f"\n==&gt; ğŸ™ Final Answer:\n\n<span class="subst">&#123;direct_output&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">            print(<span class="string">f"\n[Total Time]: <span class="subst">&#123;round(time.time() - query_start_time, <span class="number">2</span>)&#125;</span>s"</span>)</span><br><span class="line">            print(<span class="string">f"\n==&gt; âœ… Query Solved!"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> json_data</span><br></pre></td></tr></table></figure>
<p>è¯¦ç»†æ¥è®²æ˜¯è¿™æ ·ä¸€ä¸ªæµç¨‹ï¼š</p>
<ul>
<li>Analyze Query<ul>
<li>Inputsï¼šQuestion &amp; Tools -&gt; Inject Into Prompts</li>
<li>Outputs: Query Analysis -&gt; Brief &amp; Concise</li>
</ul>
</li>
<li>Main Execution Loop<ul>
<li>Planner.generate_next_step<ul>
<li>Inputs: Question, Query Analysis, Memory &amp; StepCount -&gt; Inject Into Prompts</li>
<li>Outputs: NextStep -&gt; Justification, Context, SubGoal &amp; ToolName</li>
</ul>
</li>
<li>Planner.extract_subgoal_and_tool -&gt; JSON or REGEX<ul>
<li>Inputs: NextStep</li>
<li>Outputs: Context, SubGoal &amp; ToolName</li>
</ul>
</li>
<li>CallTool if tool is active<ul>
<li>Executor.generate_tool_command<ul>
<li>Inputs: Question, Context, SubGoal &amp; ToolMeta -&gt; Inject Into Prompts</li>
<li>Outputs: ToolCommand</li>
</ul>
</li>
<li>Executor.extract_explanation_and_command<ul>
<li>Inputs: ToolCommand</li>
<li>Outputs: analysis, explanation &amp; command</li>
</ul>
</li>
<li>Executor.execute_tool_command<ul>
<li>Inputs: ToolName &amp; Command</li>
<li>Outputs: Result</li>
</ul>
</li>
</ul>
</li>
<li>Memory.add_action<ul>
<li>Inputsï¼šStepCount, ToolName, SubGoal, Command, Result</li>
</ul>
</li>
<li>Planner.verificate_context -&gt; verify memory<ul>
<li>Inputs: Question, Query Analysis, Memory, StepCount -&gt; Inject Into Prompts</li>
<li>Outputs: Stop Verification -&gt; Explanation + STOP/CONTINUE</li>
</ul>
</li>
<li>Planner.extract_conclusion -&gt; JSON or REGEX<ul>
<li>Inputs: Stop Verification</li>
<li>Outputs: Context Verification (Explanation), Conclusion (STOP/CONTINUE)</li>
</ul>
</li>
<li>Planner.generate_final_output/generate_direct_output<ul>
<li>Inputs: Question, Memory -&gt; Inject Into Prompts</li>
<li>Outputs: Chat Response</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æœ¬è´¨ä¸Šè¿™å¥—æµç¨‹æ˜¯ä¸€ä¸ªå¤šå›åˆçš„MDPï¼ˆé©¬å°”å¯å¤«å†³ç­–è¿‡ç¨‹ï¼‰ï¼Œé€šè¿‡ä¸Šé¢4ä¸ªæ¨¡å—çš„åä½œï¼Œä¸æ–­é€¼è¿‘æœ€åˆç†çš„ç­”æ¡ˆã€‚ä½†ä»…ä»…æœ‰è¿™ä¸ªæ¡†æ¶è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œçº¯Rollouté€¼è¿‘çš„æ•ˆæœç†è®ºä¸Šè‚¯å®šæ²¡æœ‰ç»è¿‡è®­ç»ƒä¹‹åçš„å¥½ã€‚æ‰€ä»¥paperé‡Œé‡‡ç”¨Flow-GRPOè¿™å¥—ä½“ç³»æä¾›ç”Ÿäº§ç¯å¢ƒè®­ç»ƒèƒ½åŠ›ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</p>
<ul>
<li>QAå¥–åŠ±ï¼šå•æ¬¡QAå¥–åŠ±ä¼šå¹¿æ’­åˆ°æ¯ä¸ªstepï¼Œæœ€ç»ˆç»“æœå½±å“æ¯ä¸ªstepçš„å†³ç­–å¥–åŠ±ï¼›</li>
<li>Group-Normalized-Advantagesï¼ˆç»„å½’ä¸€åŒ–ä¼˜åŠ¿ï¼‰ï¼šåœ¨æ¯ä¸ªè®­ç»ƒæ‰¹æ¬¡ä¸­ï¼Œç®—æ³•å¯¹åŒä¸€æ‰¹æ¬¡ï¼ˆå¹¶è¡Œrolloutsï¼‰æ‰€æœ‰è½¨è¿¹çš„ä¼˜åŠ¿å‡½æ•°åšå½’ä¸€åŒ–ï¼Œç¡®ä¿ä¼˜åŒ–æ¢¯åº¦åˆç†ï¼Œæœ¬è´¨ä¹Ÿç¬¦åˆ<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8yMTA0NjI2NTA3Mg==" title="https://zhuanlan.zhihu.com/p/21046265072">GRPO<i class="fa fa-external-link"></i></span>çš„æ€è·¯ã€‚</li>
</ul>
<p>è¦è¯¦ç»†äº†è§£AgentFlowè¿™å¥—GRPOå®ç°çš„è¯ï¼Œå¯ä»¥çœ‹<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xOTY4OTg0NTQxNzI2MjQ1Mzc5" title="https://zhuanlan.zhihu.com/p/1968984541726245379">è¿™ä¸ª<i class="fa fa-external-link"></i></span>ä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xOTYwODQ0MzcwMzIxMzQ3MzUw" title="https://zhuanlan.zhihu.com/p/1960844370321347350">å¦ä¸€ä¸ª<i class="fa fa-external-link"></i></span>çŸ¥ä¹æ–‡ç« ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚ä»£ç æ–¹é¢çš„è¯ï¼Œç›®å‰ç¬”è€…æ²¡æœ‰è·‘é€šï¼Œä¹Ÿæœ‰å¯èƒ½éœ€è¦å€ŸåŠ©verlã€cudaä¹‹ç±»ç¯å¢ƒæ‰å¯ä»¥æŠŠæ•´ä¸ªè®­ç»ƒéªŒè¯è·‘èµ·æ¥ã€‚ä»å·²æœ‰ä¿¡æ¯æ¥çœ‹ï¼Œä¹Ÿè®¸è®­ç»ƒé€»è¾‘èµ°åˆ°äº†ä¸‹é¢çš„ä»£ç ï¼Œé€šè¿‡training_rollout_asyncå’Œ_solve_and_evaluateä¿è¯è®­ç»ƒé›†çš„Rolloutå’Œè¯„æµ‹å¯å¹¶å‘è¿›è¡Œï¼Œç„¶åäº§å‡ºä¸€æ‰¹rollout_dataï¼Œä½†rollout_dataçš„æ¶ˆè´¹é€»è¾‘ç›®å‰è¿˜ä¸æ˜ç¡®ã€‚å…·ä½“çš„è¯ï¼Œå¯ä»¥å‚è€ƒç›®å‰rolloutçš„é€»è¾‘ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rollout</span><span class="params">(LitAgent)</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_solve_and_evaluate</span><span class="params">(self, rollout: AgentFlowRollout, task: Any, step_n: int, val: bool = False)</span>:</span></span><br><span class="line">        <span class="string">"""A helper function to run the agent, parse the result, and evaluate it."""</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            output_format = <span class="string">"When ready, output the final answer enclosed in &lt;answer&gt; and &lt;/answer&gt; tags. Do not generate any content after the &lt;/answer&gt; tag."</span></span><br><span class="line">            prompt = task[<span class="string">"question"</span>] + <span class="string">" "</span> + output_format</span><br><span class="line">            <span class="comment"># prompt = task["question"]</span></span><br><span class="line">            result = rollout.solve(question=prompt)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Safely check for and extract the final answer</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"direct_output"</span> <span class="keyword">in</span> result <span class="keyword">and</span> result[<span class="string">"direct_output"</span>]:</span><br><span class="line">                final_output = result[<span class="string">"direct_output"</span>]</span><br><span class="line">                all_matches = re.findall(<span class="string">r"&lt;answer&gt;(.*?)&lt;/answer&gt;"</span>, final_output, re.DOTALL)</span><br><span class="line">                <span class="keyword">if</span> all_matches:</span><br><span class="line">                    answer = all_matches[<span class="number">-1</span>].strip()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    answer = final_output</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">"Warning: Result has no direct_output or direct_output is empty."</span>)</span><br><span class="line">                answer = <span class="string">"None"</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(<span class="string">f"Failure during agent execution: <span class="subst">&#123;str(e)&#125;</span>. Defaulting to 'None'."</span>)</span><br><span class="line">            answer = <span class="string">"None"</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Evaluate the answer against the ground truth</span></span><br><span class="line">        reward_value = <span class="keyword">await</span> eval(task[<span class="string">"question"</span>], str(task[<span class="string">"result"</span>]), answer, val)  <span class="comment"># reward is tracked with the decorator</span></span><br><span class="line">        print(<span class="string">"answer: &#123;&#125; ground_truth: &#123;&#125; reward: &#123;&#125;"</span>.format(answer, task[<span class="string">"result"</span>], reward_value))</span><br><span class="line"></span><br><span class="line">        idx = task.get(<span class="string">"extra_info"</span>, &#123;&#125;).get(<span class="string">"idx"</span>, <span class="string">"unknown_idx"</span>)</span><br><span class="line"></span><br><span class="line">        rollout_data = &#123;</span><br><span class="line">            <span class="string">"step"</span>: task.get(<span class="string">"step"</span>, <span class="string">""</span>), <span class="comment"># <span class="doctag">TODO:</span> check whether it can be solved</span></span><br><span class="line">            <span class="string">"idx"</span>: idx,</span><br><span class="line">            <span class="string">"id"</span>: task.get(<span class="string">"id"</span>, <span class="string">""</span>),</span><br><span class="line">            <span class="string">"prompt"</span>: task[<span class="string">"question"</span>],</span><br><span class="line">            <span class="string">"model"</span>:rollout.llm_engine,</span><br><span class="line">            <span class="string">"tools"</span>:self.tools,</span><br><span class="line">            <span class="string">"groundtruth"</span>: task.get(<span class="string">"extra_info"</span>, &#123;&#125;).get(<span class="string">"groundtruth"</span>, task[<span class="string">"result"</span>]),</span><br><span class="line">            <span class="string">"answer_extracted"</span>: answer,</span><br><span class="line">            <span class="string">"reward"</span>: reward_value,</span><br><span class="line">            <span class="string">"total_result"</span>:result,</span><br><span class="line">            <span class="string">"timestamp"</span>: datetime.now().isoformat(),</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        data_id = str(uuid.uuid4())</span><br><span class="line">        filename = <span class="string">f"rollout_<span class="subst">&#123;data_id&#125;</span>.json"</span></span><br><span class="line"></span><br><span class="line">        save_dir = self.val_rollout_dir <span class="keyword">if</span> val <span class="keyword">else</span> self.train_rollout_dir</span><br><span class="line"></span><br><span class="line">        <span class="comment"># This function now uses the `step_n` passed as an argument.</span></span><br><span class="line">        step_dir = os.path.join(save_dir, <span class="string">f"step_<span class="subst">&#123;step_n&#125;</span>"</span>)</span><br><span class="line">        </span><br><span class="line">        idx_dir = os.path.join(step_dir, <span class="string">f"idx_<span class="subst">&#123;idx&#125;</span>"</span>)</span><br><span class="line">        os.makedirs(idx_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">        json_count = sum(</span><br><span class="line">            len([f <span class="keyword">for</span> f <span class="keyword">in</span> files <span class="keyword">if</span> f.endswith(<span class="string">".json"</span>)])</span><br><span class="line">            <span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(idx_dir)</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">assert</span> json_count &lt; self.rollout_num, \</span><br><span class="line">            <span class="string">f"Too many rollouts for idx <span class="subst">&#123;idx&#125;</span>: already <span class="subst">&#123;json_count&#125;</span> &gt;= <span class="subst">&#123;self.rollout_num&#125;</span>"</span></span><br><span class="line"></span><br><span class="line">        save_path = os.path.join(idx_dir, filename)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> open(save_path, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(rollout_data, f, indent=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        print(<span class="string">f"Rollout data saved to: <span class="subst">&#123;save_path&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">training_rollout_async</span><span class="params">(self, task: Any, rollout_id: str, resources: NamedResources, val: bool = False)</span> -&gt; Any:</span></span><br><span class="line">        <span class="keyword">await</span> self._initialize_run_once(resources)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.training_agent <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            print(<span class="string">"Initializing training agent..."</span>)</span><br><span class="line">            llm: LLM = resources.get(<span class="string">"main_llm"</span>)</span><br><span class="line">            self.training_agent = get_agent(</span><br><span class="line">                llm.model,</span><br><span class="line">                llm.endpoint,</span><br><span class="line">                temperature=self.train_temperature,</span><br><span class="line">                tools = self.tools,</span><br><span class="line">                max_steps = self.max_steps,</span><br><span class="line">                tool_engine = self.tool_engine,</span><br><span class="line">                resources = resources,</span><br><span class="line">                max_tokens = self.max_tokens,</span><br><span class="line">                output_type= self.output_type,</span><br><span class="line">                timeout= self.timeout,</span><br><span class="line">            )</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># filelock to determine step_n ---</span></span><br><span class="line">        lock = FileLock(self.train_lock_file, timeout=<span class="number">30</span>)</span><br><span class="line">        <span class="keyword">with</span> lock:</span><br><span class="line">            step_dirs = [d <span class="keyword">for</span> d <span class="keyword">in</span> os.listdir(self.train_rollout_dir) <span class="keyword">if</span> d.startswith(<span class="string">"step_"</span>)]</span><br><span class="line">            step_nums = [int(d.replace(<span class="string">"step_"</span>, <span class="string">""</span>)) <span class="keyword">for</span> d <span class="keyword">in</span> step_dirs <span class="keyword">if</span> d.replace(<span class="string">"step_"</span>, <span class="string">""</span>).isdigit()]</span><br><span class="line">            </span><br><span class="line">            current_step_n = <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> step_nums:</span><br><span class="line">                current_step_n = max(step_nums)</span><br><span class="line"></span><br><span class="line">            current_step_dir = os.path.join(self.train_rollout_dir, <span class="string">f"step_<span class="subst">&#123;current_step_n&#125;</span>"</span>)</span><br><span class="line">            <span class="keyword">if</span> os.path.exists(current_step_dir):</span><br><span class="line">                num_items_in_step = len(os.listdir(current_step_dir))</span><br><span class="line">                <span class="keyword">if</span> num_items_in_step &gt;= self.train_batch_size:</span><br><span class="line">                    current_step_n += <span class="number">1</span></span><br><span class="line">            </span><br><span class="line">            step_n = current_step_n</span><br><span class="line"></span><br><span class="line">        <span class="keyword">await</span> self._solve_and_evaluate(self.training_agent, task, step_n, val)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>LLM</tag>
        <tag>AgentFlow</tag>
        <tag>å¼ºåŒ–å­¦ä¹ </tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘ä»£ç å¼€å‘AIè¾…åŠ©å·¥å…·trae-agent</title>
    <url>/2025/11/01/githubdiscovery/trae_agent/</url>
    <content><![CDATA[<p>ä½œä¸ºå›½å†…è¡¨ç°ä¸Šæ¯”è¾ƒagenticçš„å¼€å‘å·¥å…·ä¹‹ä¸€ï¼Œtraeé¡¹ç›®å¼€æºäº†è‡ªå®¶trae-agentå¼€å‘å·¥å…·ï¼Œæ•´ä½“ä¹Ÿæœ‰ä¸€æ®µæ—¶é—´äº†ã€‚å€Ÿç€æ—¥å¸¸é—²æš‡çš„æœºä¼šï¼Œç¬”è€…è®¡åˆ’ç ”ç©¶ä¸‹trae-agentçš„ä»£ç å®ç°ï¼Œçœ‹ä¸‹è¿™ä¸ªæœ¬åœ°AIå¼€å‘è¾…åŠ©å·¥å…·æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p>
<p>ä»å¼€æºé¡¹ç›®çš„è§’åº¦ï¼Œtrae-agentç»™çš„æ–‡æ¡£ä¿¡æ¯æ˜¯æ¯”è¾ƒå……è¶³çš„ï¼Œä½†ä»£ç å®ç°ä¸Šåªèƒ½è¯´æ˜¯MVPç‰ˆæœ¬ï¼Œåªæœ‰ä¸€äº›åŸºç¡€åŠŸèƒ½ã€‚å½“ç„¶è¿™ä¸ªä¹Ÿå¯ä»¥ç†è§£ï¼Œç›¸ä¿¡å®é™…ç”Ÿäº§ç”¨çš„trae-agentä¼šè¿œæ¯”è¿™ä¸ªå®ç°æ›´åŠ å¤æ‚ï¼Œä»¥åŠä¸å¯èƒ½æ‰€æœ‰äººåŠ›éƒ½æŠ•å…¥åˆ°å¼€æºé¡¹ç›®çš„å»ºè®¾ä¸­ã€‚æ‰€ä»¥ä»Šå¤©å°±ç®€å•çœ‹çœ‹è¿™ä¸ªé¡¹ç›®çš„ä¸»æµç¨‹ã€‚</p>
<a id="more"></a>
<p>ä¸»æµç¨‹çš„è¯åœ¨agent.pyå½“ä¸­ï¼Œå¯ä»¥å‚è€ƒæœ€æ·±å¤„BaseAgentä¸­execute_taskå’Œ_run_llm_stepçš„å®ç°ï¼Œæ­¤å¤„å±•ç¤ºä¸‹åŸºç¡€æµç¨‹éƒ¨åˆ†ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseAgent</span><span class="params">(ABC)</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">execute_task</span><span class="params">(self)</span> -&gt; AgentExecution:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            messages = self._initial_messages</span><br><span class="line">            step_number = <span class="number">1</span></span><br><span class="line">            execution.agent_state = AgentState.RUNNING</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> step_number &lt;= self._max_steps:</span><br><span class="line">                step = AgentStep(step_number=step_number, state=AgentStepState.THINKING)</span><br><span class="line">                <span class="keyword">try</span>: <span class="comment"># è°ƒç”¨_run_llm_stepå’Œllmåšchat</span></span><br><span class="line">                    messages = <span class="keyword">await</span> self._run_llm_step(step, messages, execution)</span><br><span class="line">                    <span class="keyword">await</span> self._finalize_step( <span class="comment"># è®°å½•trace</span></span><br><span class="line">                        step, messages, execution</span><br><span class="line">                    )  <span class="comment"># record trajectory for this step and update the CLI console</span></span><br><span class="line">                    <span class="keyword">if</span> execution.agent_state == AgentState.COMPLETED:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    step_number += <span class="number">1</span></span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line">                    execution.agent_state = AgentState.ERROR</span><br><span class="line">                    step.state = AgentStepState.ERROR</span><br><span class="line">                    step.error = str(error)</span><br><span class="line">                    <span class="keyword">await</span> self._finalize_step(step, messages, execution)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> step_number &gt; self._max_steps <span class="keyword">and</span> <span class="keyword">not</span> execution.success:</span><br><span class="line">                execution.final_result = <span class="string">"Task execution exceeded maximum steps without completion."</span></span><br><span class="line">                execution.agent_state = AgentState.ERROR</span><br><span class="line">        <span class="keyword">return</span> execution</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_run_llm_step</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self, step: <span class="string">"AgentStep"</span>, messages: list[<span class="string">"LLMMessage"</span>], execution: <span class="string">"AgentExecution"</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; list["LLMMessage"]:</span></span><br><span class="line">        <span class="comment"># Display thinking state</span></span><br><span class="line">        step.state = AgentStepState.THINKING</span><br><span class="line">        self._update_cli_console(step, execution)</span><br><span class="line">        <span class="comment"># Get LLM response</span></span><br><span class="line">        llm_response = self._llm_client.chat(messages, self._model_config, self._tools)</span><br><span class="line">        step.llm_response = llm_response</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Display step with LLM response</span></span><br><span class="line">        self._update_cli_console(step, execution)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Update token usage</span></span><br><span class="line">        self._update_llm_usage(llm_response, execution)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.llm_indicates_task_completed(llm_response):</span><br><span class="line">            <span class="keyword">if</span> self._is_task_completed(llm_response):</span><br><span class="line">                execution.agent_state = AgentState.COMPLETED</span><br><span class="line">                execution.final_result = llm_response.content</span><br><span class="line">                execution.success = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">return</span> messages</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                execution.agent_state = AgentState.RUNNING</span><br><span class="line">                <span class="keyword">return</span> [LLMMessage(role=<span class="string">"user"</span>, content=self.task_incomplete_message())]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tool_calls = llm_response.tool_calls</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> self._tool_call_handler(tool_calls, step)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ”¯é»˜è®¤æŒçš„tools</span></span><br><span class="line">tools_registry: dict[str, type[Tool]] = &#123;</span><br><span class="line">    <span class="string">"bash"</span>: BashTool,</span><br><span class="line">    <span class="string">"str_replace_based_edit_tool"</span>: TextEditorTool,</span><br><span class="line">    <span class="string">"json_edit_tool"</span>: JSONEditTool,</span><br><span class="line">    <span class="string">"sequentialthinking"</span>: SequentialThinkingTool,</span><br><span class="line">    <span class="string">"task_done"</span>: TaskDoneTool,</span><br><span class="line">    <span class="string">"ckg"</span>: CKGTool,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è®¾ç½®é‡Œå¤´æˆ‘ä»¬å¯ä»¥è®¾ç½®æ¯ä¸ªé—®é¢˜çš„æœ€å¤§stepæ¬¡æ•°ï¼Œexecute_taskä¸­å°±é€šè¿‡loopå»è¦æ±‚LLMä¸æ–­è¿­ä»£é—®é¢˜è§£å†³æ–¹æ¡ˆã€‚_run_llm_stepä¸­åˆ™ä¼ é€’å†å²æ¶ˆæ¯å’Œtoolsç»™åˆ°LLMï¼Œ_llm_clientæ”¯æŒäº†å¤šä¸ªproviderï¼Œç»™å›ç»“æœåï¼Œé€šè¿‡åŒ¹é…ç¡¬ç¼–ç çš„å…³é”®å­—åˆ¤æ–­æ˜¯å¦å®Œæˆtaskï¼Œå¦åˆ™ç»§ç»­è¿­ä»£ï¼Œå½“ç„¶å¦‚æœè¯†åˆ«å‡ºéœ€è¦tool-callçš„è¯ï¼Œå°±ç”±ä»£ç é€»è¾‘ä¸»åŠ¨è°ƒç”¨å¯¹åº”toolã€‚</p>
<p>é’ˆå¯¹messagesï¼Œåœ¨execute_taskçš„callerçš„new_taskè¿‡ç¨‹ä¸­ï¼Œå·²ç»æ³¨å…¥äº†ç¡¬ç¼–ç çš„system-promptï¼Œä»¥åŠå¸¦æ¨¡æ¿çš„user-promptï¼Œå¯ä»¥åœ¨agent_prompt.pyä¸­çœ‹åˆ°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">TRAE_AGENT_SYSTEM_PROMPT = <span class="string">"""You are an expert AI software engineering agent.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">File Path Rule: All tools that take a `file_path` as an argument require an **absolute path**. You MUST construct the full, absolute path by combining the `[Project root path]` provided in the user's message with the file's path inside the project.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">For example, if the project root is `/home/user/my_project` and you need to edit `src/main.py`, the correct `file_path` argument is `/home/user/my_project/src/main.py`. Do NOT use relative paths like `src/main.py`.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Your primary goal is to resolve a given GitHub issue by navigating the provided codebase, identifying the root cause of the bug, implementing a robust fix, and ensuring your changes are safe and well-tested.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Follow these steps methodically:"""</span></span><br><span class="line"><span class="comment"># ä¸‹é¢å¿½ç•¥</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TraeAgent</span><span class="params">(BaseAgent)</span>:</span></span><br><span class="line"><span class="meta">    @override</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new_task</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self,</span></span></span><br><span class="line"><span class="function"><span class="params">        task: str,</span></span></span><br><span class="line"><span class="function"><span class="params">        extra_args: dict[str, str] | None = None,</span></span></span><br><span class="line"><span class="function"><span class="params">        tool_names: list[str] | None = None,</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>:</span></span><br><span class="line">        <span class="comment"># fixed system prompt</span></span><br><span class="line">        self._initial_messages: list[LLMMessage] = []</span><br><span class="line">        self._initial_messages.append(LLMMessage(role=<span class="string">"system"</span>, content=self.get_system_prompt()))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># user message with issue to solve</span></span><br><span class="line">        user_message = <span class="string">""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> extra_args:</span><br><span class="line">            <span class="keyword">raise</span> AgentError(<span class="string">"Project path and issue information are required."</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"project_path"</span> <span class="keyword">not</span> <span class="keyword">in</span> extra_args:</span><br><span class="line">            <span class="keyword">raise</span> AgentError(<span class="string">"Project path is required"</span>)</span><br><span class="line"></span><br><span class="line">        self.project_path = extra_args.get(<span class="string">"project_path"</span>, <span class="string">""</span>)</span><br><span class="line">        <span class="keyword">if</span> self.docker_config:</span><br><span class="line">            user_message += <span class="string">r"[Project root path]:\workspace\n\n"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            user_message += <span class="string">f"[Project root path]:\n<span class="subst">&#123;self.project_path&#125;</span>\n\n"</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"issue"</span> <span class="keyword">in</span> extra_args:</span><br><span class="line">            user_message += <span class="string">f"[Problem statement]: We're currently solving the following issue within our repository. Here's the issue text:\n<span class="subst">&#123;extra_args[<span class="string">'issue'</span>]&#125;</span>\n"</span></span><br><span class="line">        optional_attrs_to_set = [<span class="string">"base_commit"</span>, <span class="string">"must_patch"</span>, <span class="string">"patch_path"</span>]</span><br><span class="line">        <span class="keyword">for</span> attr <span class="keyword">in</span> optional_attrs_to_set:</span><br><span class="line">            <span class="keyword">if</span> attr <span class="keyword">in</span> extra_args:</span><br><span class="line">                setattr(self, attr, extra_args[attr])</span><br><span class="line"></span><br><span class="line">        self._initial_messages.append(LLMMessage(role=<span class="string">"user"</span>, content=user_message))</span><br></pre></td></tr></table></figure>
<p>ç”±äºæ¯æ¬¡messageåªä¼ é€’å½“æ¬¡é—®ç­”çš„messageï¼Œæ‰€ä»¥é’ˆå¯¹å•ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªLLMClientéœ€è¦å®ç°å¯¹å†å²é—®ç­”çš„è®°å½•ã€‚æ¯”å¦‚OllamaClientçš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OllamaClient</span><span class="params">(BaseLLMClient)</span>:</span></span><br><span class="line"><span class="meta">    @override</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">chat</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        self,</span></span></span><br><span class="line"><span class="function"><span class="params">        messages: list[LLMMessage],</span></span></span><br><span class="line"><span class="function"><span class="params">        model_config: ModelConfig,</span></span></span><br><span class="line"><span class="function"><span class="params">        tools: list[Tool] | None = None,</span></span></span><br><span class="line"><span class="function"><span class="params">        reuse_history: bool = True,</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span> -&gt; LLMResponse:</span></span><br><span class="line">        msgs: ResponseInputParam = self.parse_messages(messages)</span><br><span class="line">        <span class="keyword">if</span> reuse_history:</span><br><span class="line">            self.message_history = self.message_history + msgs</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.message_history = msgs</span><br></pre></td></tr></table></figure>
<p>ä¸»æµç¨‹å¤§æ¦‚æ˜¯è¿™äº›ï¼Œä»£ç æ¶æ„ä¸Šæ¥çœ‹å®ç°ä¹Ÿä¸ç®—å¤ªå¤æ‚ï¼Œç”¨ä¸“æœ‰Agentæ¡†æ¶å¤åˆ»ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œç„¶åç¡¬ç¼–ç æ³¨å…¥çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥æ•´ä½“ä¸Šæ¥çœ‹trae-agentå¼€æºç‰ˆç¦»å®é™…æŠ•äº§çš„æ ‡å‡†è¿˜æœ‰ä¸€äº›è·ç¦»ã€‚å¦‚æœè‡ªå·±çš„é¡¹ç›®è¦å¤ç”¨è¿™å¥—æ¡†æ¶å¼€å‘å†…å®¹ï¼Œæœ€å¥½ä¿è¯ä»¥ä¸‹äº‹æƒ…ï¼Œä¸€æ˜¯æœ‰ä¸€ä¸ªè¶³å¤Ÿå¯é ç¡®å®šæ€§é«˜çš„æ¨¡å‹ï¼ŒäºŒæ˜¯éœ€è¦å•ç‹¬ä¸€å¥—promptç®¡ç†æ¨¡å—æŠŠç¡¬ç¼–ç æ³¨å…¥çš„promptç­‰æ–‡æœ¬åšç»Ÿä¸€ç®¡ç†ï¼Œä¸‰æ˜¯æœ‰ä¸€å¥—æ‰§è¡Œç¨³å®šæ€§è·Ÿè¯„æµ‹æœºåˆ¶è®©æ•´ä¸ªagentè¿‡ç¨‹èƒ½å¤Ÿé’ˆå¯¹è‡ªå·±é¡¹ç›®çš„é—®é¢˜ç»™å‡ºè§£å†³æ–¹æ¡ˆï¼Œè‡³å°‘å¾—æœ‰é¢å­ä¸Šè¿‡å¾—å»çš„outputæ‰è¡Œã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>AI</tag>
        <tag>Agent</tag>
        <tag>LLM</tag>
        <tag>trae-agent</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°æ¶æ„è®¾è®¡çš„ä¸€äº›é€šç”¨è¦ç‚¹</title>
    <url>/2025/11/01/archiart/autotest_platform_architecture/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvR2FtZS1PZi1BdXRvVGVzdC8=" title="https://utmhikari.top/categories/Game-Of-AutoTest/">Game-Of-AutoTest<i class="fa fa-external-link"></i></span>ç³»åˆ—çš„æ–‡ç« å½“ä¸­ï¼Œæ›¾ç»æ·±å…¥èŠåˆ°å¦‚ä½•åšå¥½æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æŠ€æœ¯å®è·µï¼ŒåŒ…æ‹¬ç”¨ä¾‹ç¼–å†™å’Œä»»åŠ¡è°ƒåº¦ç­‰å¤šä¸ªæ–¹é¢ã€‚ç”±äºå·¥ä½œåŸå› ï¼Œç¬”è€…å†ä¸€æ¬¡éœ€è¦äº†è§£è‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°çš„æ•´ä½“æ¶æ„ï¼Œå› æ­¤ä¹Ÿå€Ÿç€è¿™ä¸ªæœºä¼šï¼Œä»æ›´åŠ å®è§‚çš„è§’åº¦ï¼Œå†èŠä¸€ä¸‹è‡ªåŠ¨åŒ–å¹³å°æ¶æ„è®¾è®¡çš„ä¸€äº›é€šç”¨è¦ç‚¹ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆä»ç»†ç²’åº¦çš„æ¥è®²ï¼Œæµ‹è¯•ç”¨ä¾‹testcaseç®¡ç†æ˜¯åŸºç¡€ï¼Œä¸€ä¸ªæœ€ç®€å•çš„æµ‹è¯•ç”¨ä¾‹éœ€è¦åŒ…å«æ ‡é¢˜ã€setupã€æ‰§è¡Œæ­¥éª¤ä»¥åŠteardownç­‰ç¯èŠ‚ã€‚è€Œæ‰§è¡Œæ­¥éª¤é‡Œé¢ï¼Œç”±äºè¦åšè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ‰€ä»¥éœ€è¦æ‹†åˆ†æˆè¾ƒç»†çš„stepç²’åº¦ï¼Œæ¯ä¸ªstepç²’åº¦å¯èƒ½æœ‰ä¸åŒçš„æ“ä½œç±»å‹ï¼Œæ¯”å¦‚æ­£å¸¸å’ŒçœŸæœºäº¤äº’æ–­è¨€ï¼Œæˆ–è€…æ˜¯å¯¹å¤–å‘é€HTTPè¯·æ±‚è¿™ç±»ï¼Œéƒ½å¯ä»¥ç®—ä½œæ˜¯ä¸€ç±»æ­¥éª¤ï¼Œæ‰€ä»¥å¦‚æœæœ‰å…±æ€§çš„æ­¥éª¤çš„è¯ï¼Œä¹Ÿå¯ä»¥æŠ½è±¡å‡ºæ­¥éª¤é›†èƒ½åŠ›ï¼Œæ–¹ä¾¿å¤šåœºæ™¯å…±ç”¨ã€‚å†å¾€å®è§‚ä¸€ç‚¹çš„è¯ï¼Œtestcaseéœ€è¦æ‰“æ ‡ï¼Œéœ€è¦é€šè¿‡é›†åˆã€ç±»åˆ«ã€åœºæ™¯ä»¥åŠä¸šåŠ¡ç­‰ç»´åº¦å»åšç»Ÿä¸€çš„ç®¡ç†ã€‚ä½œä¸ºä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°ï¼Œéœ€è¦æœ‰è¿™ä¹ˆæ ·ä¸€å¥—ç´¢å¼•æœºåˆ¶ï¼Œè®©æµ‹è¯•åŒå­¦æ›´å¥½ä½¿ç”¨æ•´å¥—äº§å“ã€‚</p>
<p>ç„¶åæ˜¯è‡ªåŠ¨åŒ–ç”¨ä¾‹çš„æ‰§è¡Œï¼Œè¿™é‡Œé¦–å…ˆéœ€è¦æ³¨æ„æ‰§è¡Œæ˜¯æœ‰å¤šä¸ªç²’åº¦çš„ã€‚å‡ä½¿ä¸€ä¸ªå¤§çš„å®¢æˆ·ç«¯ç‰ˆæœ¬å‘å¸ƒï¼Œé‚£ä¹ˆè¿™ä¸ªç‰ˆæœ¬å¯èƒ½å¯¹åº”å¤šä¸ªOSçš„å®¢æˆ·ç«¯ï¼Œæ‰§è¡Œå¤šä¸ªåœºæ™¯çš„ç”¨ä¾‹ã€‚é‚£ä¹ˆè‡ªé¡¶å‘ä¸‹æ¥çœ‹ï¼Œé¦–å…ˆæœ‰é‚£ä¹ˆä¸€å¥—é›†æˆæµ‹è¯•ä»»åŠ¡ï¼Œä¸‹é¢ä¼šæŒ‚å¾ˆå¤šä¸ªç”¨ä¾‹çš„å­ä»»åŠ¡ï¼Œæ¯ä¸ªç”¨ä¾‹å¯èƒ½åœ¨å¤šç«¯è¿è¡Œï¼Œå¦‚æœå•ç«¯è¿è¡Œå¤±è´¥ä¹Ÿéœ€è¦æœ‰å†å²è®°å½•ï¼Œæ‰€ä»¥èµ·ç å¾—æœ‰4å¼ è¡¨å»æè¿°æ•´ä¸€å¥—ä¸šåŠ¡é›†æˆæµ‹è¯•è¿™ä¸ªäº‹æƒ…ã€‚ä¸€ä¸ªç”¨ä¾‹æ‰§è¡Œä¹Ÿéœ€è¦å…³è”å¾ˆå¤šå†…å®¹ï¼Œé™¤äº†åŒ…ä½“ä¿¡æ¯ä¹‹å¤–ï¼Œæœºå™¨è°ƒåº¦ã€çŠ¶æ€å‘¨çŸ¥ã€ç¯å¢ƒå˜é‡ã€æ‰§è¡Œç­–ç•¥ä»¥åŠwebhookç­‰å„ç§ä»»åŠ¡æ‰§è¡Œç›¸å…³çš„å…ƒç´ éƒ½æ˜¯éœ€è¦è€ƒè™‘çš„ï¼Œæ‰€ä»¥å¦‚æœæœ‰å…±æ€§çš„ä¸€äº›ä¸œè¥¿çš„è¯ï¼Œä¹Ÿå¯ä»¥æŠ½è±¡å‡ºæ¥ä»»åŠ¡æ¨¡æ¿èƒ½åŠ›ï¼Œæ–¹ä¾¿ä»»åŠ¡å¤ç”¨ã€‚</p>
<p>ä¹‹åæ˜¯ä»»åŠ¡è°ƒåº¦ã€æ‰§è¡Œå’Œç›‘æ§ã€‚è°ƒåº¦çš„è¯é€šå¸¸é€»è¾‘æ˜¯å…ˆè®¿é—®è®¾å¤‡ç®¡ç†æœåŠ¡ï¼Œç»™è®¾å¤‡ä¸Šé”ï¼Œç„¶åè¦æ±‚ç”¨ä¾‹æ‰§è¡ŒæœåŠ¡æ“ä½œè¿™ä¸ªè®¾å¤‡ï¼Œæ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•æ“ä½œã€‚ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå°±éœ€è¦è€ƒè™‘å¦‚ä½•ä¿éšœä»»åŠ¡æ‰§è¡Œç¨³å®šæ€§ï¼Œè¿™éƒ¨åˆ†<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMTAvMDMvZ2FtZW9mYXV0b3Rlc3QvaXYv" title="https://utmhikari.top/2022/10/03/gameofautotest/iv/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>æœ‰èŠï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚å¦‚æœäººåŠ›å……è¶³ä¸”æœåŠ¡æ•°é‡è¾ƒå¤šçš„è¯ï¼Œæœ€å¥½æ˜¯é€šè¿‡MQçš„å½¢å¼åœ¨ä¸åŒæœåŠ¡ä¹‹é—´æ­æ¡¥ï¼Œé©±åŠ¨æ‰§è¡ŒçŠ¶æ€å˜åŒ–ï¼Œè¿™ä¹ˆåšçš„åŸå› æ­£å¥½æ˜¯æ‰§è¡Œæ˜¯å¤šç²’åº¦ä¸”çŠ¶æ€æ˜¯ç›¸äº’ä¾èµ–çš„ï¼Œåªæœ‰æœ€å°ç²’åº¦æ‰§è¡ŒçŠ¶æ€å˜åŒ–äº†ï¼Œç²—ç²’åº¦çš„æ‰§è¡Œæ‰è·Ÿç€å˜åŒ–ï¼Œè¿™æ ·å°±ä¸å®¹æ˜“å‡ºç°å¡çŠ¶æ€çš„æƒ…å†µã€‚å¦‚æœäººåŠ›ä¸å……è¶³çš„è¯ï¼Œæœ€å¥½æ˜¯ç»Ÿä¸€é€šè¿‡å¤–éƒ¨å®šæ—¶ä»»åŠ¡æ¨åŠ¨ä»»åŠ¡çŠ¶æ€æ‰§è¡Œè·Ÿè¡¥å¿ï¼Œè¿™æ ·æœåŠ¡é—´èŒè´£ä¼šæ›´åŠ æ¸…æ™°ä¸€äº›ã€‚</p>
<p>æœ€åå°±æ˜¯éœ€è¦åšå¥½ä»»åŠ¡æ‰§è¡Œçš„traceæ¨¡å—ï¼Œç²¾ç¡®åˆ°æ¯ä¸€ä¸ªå®¢æˆ·ç«¯æ‰§è¡Œçš„æ¯ä¸€ä¸ªStepï¼Œæ¯ä¸€ä¸ªStepéœ€è¦è®°å½•æ“ä½œæ—¥å¿—ã€æˆªå›¾ã€ç»“æœä»¥åŠæ€è€ƒç­‰å¤šç±»å…ƒä¿¡æ¯ï¼Œè¿™æ ·ä¸è®ºæ˜¯è°ƒè¯•ç”¨ä¾‹è¿˜æ˜¯æ’æŸ¥çº¿ä¸Šé—®é¢˜éƒ½æ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œèƒ½æ˜¾è‘—æå‡å·¥ä½œæ•ˆç‡ã€‚ä»ä¸šåŠ¡è§†è§’ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¨³å®šæ€§å’Œç»“æœçš„å¯è¯»æ€§ä¼šæ˜¾è‘—åŠ¨åŒ–æµ‹è¯•é—®é¢˜æ˜¯å¦èƒ½å¿«é€Ÿè·Ÿè¿›ï¼Œè¿›è€Œå½±å“è¿™ä¸ªäº‹æƒ…åœ¨ä¸šåŠ¡é‡Œæ˜¯å¦èƒ½é•¿ä¹…çš„æ¨ä¸‹å»ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘ç”¨Eino+Ollamaä½æˆæœ¬ç ”å‘LLMçš„Agent</title>
    <url>/2025/10/06/geekdaily/eino_ollama_llm/</url>
    <content><![CDATA[<p>åä¸€å›½åº†æ­£æ˜¯å……ç”µçš„å¥½æ—¶æœºï¼Œå€Ÿç€å‡æœŸæ—¶é—´å……è£•ï¼Œç¬”è€…åˆæµ…è°ƒç ”äº†ä¸€ä¸‹æœ¬åœ°LLMå¼€å‘ç›¸å…³çš„å·¥å…·é“¾ï¼Œçœ‹ä¸‹å¦‚æœæ˜¯æ—¥å¸¸ä¸šä½™æä¸ªäººLLMçš„Agenté¡¹ç›®ï¼Œå…·ä½“æœ‰å“ªäº›èƒ½åŠ›å¯ç”¨ã€‚å·¥ä¸šç•Œçš„è¯ï¼Œå› ä¸ºçŸ¥è¯†ä¿å¯†æ€§ç­‰å„ç§åŸå› ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°å…„å¼Ÿéƒ¨é—¨çš„LLMæ¨¡å‹æˆ–è€…ç›¸å…³Agentèƒ½åŠ›ï¼Œä»¥åŠå¸‚é¢ä¸Šæ”¶è´¹ä½†ä¼ä¸šå†…éƒ¨å…è´¹çš„ä¸€äº›æŠ€æœ¯åŸºå»ºã€‚ä½†å¦‚æœæ˜¯ä¸ªäººæLLMåº”ç”¨å¼€å‘ï¼Œå°±æ›´åŠ å€¾å‘äºçœ‹æœ‰æ²¡æœ‰ä½æˆæœ¬ç”šè‡³å…è´¹çš„åŠæ³•å»åšæœ¬åœ°ç ”å‘äº†ã€‚</p>
<p>åŸºäºè¿™ä¸ªç›®çš„ï¼Œç»è¿‡ä¸€ç•ªè°ƒç ”å®æ“ï¼Œå‘ç°åªéœ€è¦ä¸€ä¸ªAgentå¼€å‘æ¡†æ¶åŠ ä¸Šæ¨¡å‹Providerå°±èƒ½è§£å†³é—®é¢˜ã€‚å› æ­¤æœ¬æ–‡å°±ä»‹ç»ä¸€ä¸‹ï¼Œä»¥Agentå¼€å‘æ¡†æ¶Einoï¼ŒåŠ ä¸ŠOllamaè¿™ä¸ªæ¨¡å‹Providerï¼Œå¦‚ä½•èƒ½å¤Ÿä½æˆæœ¬ç ”å‘LLMçš„Agentã€‚é’ˆå¯¹è¿™ä¸ªä¸»é¢˜ï¼Œè™½ç„¶ä»¥å‰ä¹Ÿå†™è¿‡<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDgvMTAvZ2Vla2RhaWx5L2RldmVsb3BfYWdlbnRfYnlfY296ZS8=" title="https://utmhikari.top/2025/08/10/geekdaily/develop_agent_by_coze/">ç”¨Cozeå¼€æºç‰ˆç ”å‘çš„Case<i class="fa fa-external-link"></i></span>ï¼Œä½†Cozeæœ¬èº«ä½œä¸ºä¸€å¥—å·¥ä¸šç•Œäº§å“åŸºå»ºï¼Œç›´æ¥æ‹¿å®ƒå·¥ä½œè¿˜æ˜¯æ¯”è¾ƒé‡çš„ï¼Œæœ¬æ–‡æš‚ä¸”åªè®¨è®ºä¸€äº›æ¯”è¾ƒè½»é‡çš„äº‹æƒ…ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆå’±ä»¬éœ€è¦ç†è§£æ¨¡å‹å¯¹æ ‡ç°å®ä¸­çš„å•¥ï¼Œå…·ä½“æ€ä¹ˆæå‡ç”Ÿäº§åŠ›ã€‚æŒ‰ç¬”è€…ç²—æµ…ç†è§£çš„è¯ï¼Œä¸€ä¸ªæ¨¡å‹å®ä¾‹å°±ç›¸å½“äºä¸€ä¸ªå¤§è„‘ï¼Œå®ƒèŠ‚çœå¼€å‘è€…å·¥ä½œé‡çš„åœ°æ–¹åœ¨äºï¼Œä»¥å‰çš„ç¨‹åºæ˜¯å¼€å‘è€…ä¸€è¡Œè¡Œä»£ç ç¼–å†™å‡ºæ¥çš„ï¼Œè€Œç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡å¾®è°ƒæˆ–è€…å·¥å…·å¢å¼ºç­‰æ–¹å¼å®šåˆ¶åŒ–ä¸€ä¸ªå¤§è„‘ï¼Œä½¿å¾—åœ¨å°½å¯èƒ½å‡å°‘ç¡®å®šæ€§æŠ˜æŸçš„æ¡ä»¶ä¸‹ï¼Œä½æˆæœ¬åšå¤šæ¨¡æ€çš„æ•°æ®è½¬æ¢ï¼Œç”šè‡³å®ç°å¦ä¸€å¥—æˆ‘ä»¬éœ€è¦çš„ç¨‹åºã€‚ä¸ç®¡è¿™ä¸ªç†è§£æ˜¯ä¸æ˜¯ç²¾ç¡®ï¼Œä½†è‡³å°‘æœ‰äº†è¿™ä¸ªæƒ³æ³•çš„è¯ï¼Œå¼€å‘ä¸€ä¸ªLLMåº”ç”¨æ€è·¯ä¼šæ¸…æ™°çš„å¤šã€‚</p>
<p>åœ¨æœ¬åœ°ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©<span class="exturl" data-url="aHR0cHM6Ly9vbGxhbWEuY29tLw==" title="https://ollama.com/">Ollama<i class="fa fa-external-link"></i></span>å·¥å…·ç®¡ç†å¤šä¸ªå¤§è„‘ï¼Œæ¯ä¸ªå¤§è„‘æœ‰ä¸åŒçš„èƒ½åŠ›ï¼Œæ¯”å¦‚gemma3å¯ä»¥å¤„ç†è§†è§‰ä¿¡æ¯ï¼Œqwen3å¯ä»¥åšå¤–éƒ¨å·¥å…·è¯†åˆ«ï¼Œbge-m3å¯ä»¥åšæ–‡æœ¬å‘é‡åŒ–ï¼ˆembeddingï¼‰ï¼Œdeepseek-r1å…·å¤‡è‡ªæ€è€ƒèƒ½åŠ›ï¼Œç„¶ååŸºæœ¬ä¸Šæ¯ä¸ªæ¨¡å‹éƒ½æœ‰é—®ç­”èƒ½åŠ›ï¼Œç­‰ç­‰ã€‚åœ¨å…·ä½“å®ç°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç»„åˆä¸åŒçš„æ¨¡å‹ï¼Œæ‰“é€ ä¸€å¥—å®Œå–„çš„Agentã€‚</p>
<p>æ¯”æ–¹è¯´æœ‰ç”¨æˆ·é—®ï¼Œæƒ³è¦å»æŸä¸ªå›¾ç‰‡é‡Œé¢çš„åœ°æ–¹æ—…æ¸¸ï¼Œæœ‰ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿé‚£ä¹ˆæˆ‘ä»¬çš„Agentå¯ä»¥å®ç°æˆï¼Œé¦–å…ˆå€ŸåŠ©deepseek-r1çš„æ€è€ƒèƒ½åŠ›åšæ„å›¾è¯†åˆ«ï¼Œå‘ç°é—®é¢˜åŒ…å«é¢å¤–å›¾ç‰‡ä¿¡æ¯ï¼Œä¹‹åå°±è°ƒç”¨gemma3æ¨¡å‹ï¼ˆæˆ–æ˜¯å°è£…çš„Agentï¼‰åšå›¾ç‰‡è¯†åˆ«ï¼Œè¯†åˆ«å›¾ç‰‡é‡Œçš„å…³é”®åœ°æ ‡ä¿¡æ¯ï¼Œå†ä¹‹åç»“åˆå‘é‡æ•°æ®åº“è·Ÿæˆ‘ä»¬é€šè¿‡bge-m3æ¨¡å‹embedçš„å¤§é‡æ–‡æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€å¥—åœ°ç†çŸ¥è¯†åº“ï¼Œåœ¨è¿™ä¸ªçŸ¥è¯†åº“é‡Œæ£€ç´¢åˆ°è¿™ä¸ªåœ°æ ‡å¯¹åº”çš„åŸå¸‚ï¼Œæœ€åå†å€ŸåŠ©qwen3ä»¥åŠå¤–éƒ¨é«˜å¾·åœ°å›¾ç­‰å·¥å…·ï¼Œè§„åˆ’å‡ºä¸€å¥—å®Œæ•´çš„æ—…è¡Œæ–¹æ¡ˆï¼Œå›ç»™ä¸»è„‘deepseek-r1åå‡ºæ¥ã€‚å…·ä½“æ€ä¹ˆç®¡ç†Ollamaçš„æ¨¡å‹ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9sbGFtYS5jb20v" title="https://docs.ollama.com/">Ollamaå®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>ä¸ºäº†å®ç°è¿™æ ·çš„ç¼–æ’ï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€å¥—Agentå¼€å‘æ¡†æ¶ï¼Œå¸¸è§çš„å°±æ˜¯åŸºäºPythonçš„<span class="exturl" data-url="aHR0cHM6Ly93d3cubGFuZ2NoYWluLmNvbS8=" title="https://www.langchain.com/">LangChain<i class="fa fa-external-link"></i></span>ä»¥åŠåŸºäºGolangçš„<span class="exturl" data-url="aHR0cHM6Ly93d3cuY2xvdWR3ZWdvLmlvL3poL2RvY3MvZWluby8=" title="https://www.cloudwego.io/zh/docs/eino/">Eino<i class="fa fa-external-link"></i></span>ã€‚æœ¬æ–‡ä»¥Einoä¸ºä¾‹å­ï¼ŒEinoå†…éƒ¨æœ‰å°è£…å¯¹Ollamaçš„è°ƒç”¨ï¼Œæ‰€ä»¥é€šè¿‡Einoè¿æ¥Ollamaæ¨¡å‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *EinoOllamaAgent)</span> <span class="title">Run</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">    <span class="comment">// connect local ollama model</span></span><br><span class="line">	model, err := ollama.NewChatModel(ctx, &amp;ollama.ChatModelConfig&#123;</span><br><span class="line">		<span class="comment">// åŸºç¡€é…ç½®</span></span><br><span class="line">		BaseURL: ollamaURL,        <span class="comment">// Ollama æœåŠ¡åœ°å€ï¼Œé€šå¸¸ä¸ºhttp://localhost:11434</span></span><br><span class="line">		Timeout: <span class="number">30</span> * time.Second, <span class="comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¨¡å‹é…ç½®</span></span><br><span class="line">		Model:  qwen3Model,                <span class="comment">// æ¨¡å‹åç§°ï¼Œæ¯”å¦‚qwen3:latest</span></span><br><span class="line">		Format: json.RawMessage(<span class="string">`"json"`</span>), <span class="comment">// è¾“å‡ºæ ¼å¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¨¡å‹å‚æ•°</span></span><br><span class="line">		Options: &amp;api.Options&#123;</span><br><span class="line">			Temperature: <span class="number">0.7</span>,</span><br><span class="line">			NumPredict:  <span class="number">8192</span>,</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¨ç†é…ç½®</span></span><br><span class="line">		Thinking: &amp;api.ThinkValue&#123;Value: <span class="literal">false</span>&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"create ollama chat model failed: %v"</span>, err))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	messages := []*schema.Message&#123;</span><br><span class="line">		schema.SystemMessage(<span class="string">"ä½ æ˜¯ä¸€ä¸ªåŠ©æ‰‹"</span>),</span><br><span class="line">		schema.UserMessage(<span class="string">"è¯·ç”¨ä¸€å¥è¯ä»‹ç»Ollama"</span>),</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ™®é€šæ¨¡å¼</span></span><br><span class="line">	response, err := model.Generate(ctx, messages)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"generate msg failed: %v"</span>, err))</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">"resp: %s\n"</span>, response.Content)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæ˜¯éœ€è¦æ„å»ºçŸ¥è¯†åº“çš„åœºæ™¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åšçš„ä¸€æ˜¯æŠŠembeddingæ¨¡å‹å½“æˆé€šç”¨æ–‡æœ¬å‘é‡åŒ–å·¥å…·ï¼Œä¸å•ç‹¬å†™ä¸€å¥—ä»£ç ï¼ŒäºŒæ˜¯å¼•å…¥ä¸€ä¸ªå‘é‡æ•°æ®åº“ï¼ŒæŒä¹…åŒ–æ–‡æœ¬å‘é‡ï¼Œæä¾›çŸ¥è¯†è®¿é—®èƒ½åŠ›ã€‚å¦‚æœç”¨Einoå®ç°çš„è¯ï¼Œå…ˆç»™ä¸€ä¸ªä»¥å†…å­˜ä½œä¸ºå‘é‡æ•°æ®åº“çš„æœ€ç®€å•ä¾‹å­ï¼Œå½“ç„¶Einoæœ¬èº«ä¹Ÿæœ‰å¾ˆå¤šå‘é‡æ•°æ®åº“Clientçš„æŠ½è±¡ï¼Œæ­¤å¤„ä¸èµ˜è¿°äº†ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Doc <span class="keyword">struct</span> &#123;</span><br><span class="line">	ID        <span class="keyword">int</span></span><br><span class="line">	Content   <span class="keyword">string</span></span><br><span class="line">	Embedding []<span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> EinoOllamaKnowledge <span class="keyword">struct</span> &#123;</span><br><span class="line">	docs     <span class="keyword">map</span>[<span class="keyword">int</span>]*Doc</span><br><span class="line">	embedder *openai.Embedder</span><br><span class="line">	idIncr   <span class="keyword">int</span></span><br><span class="line">	idMtx    sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewEinoOllamaKnowledge</span><span class="params">(ctx context.Context)</span> *<span class="title">EinoOllamaKnowledge</span></span> &#123;</span><br><span class="line">	embedder, err := openai.NewEmbedder(ctx, &amp;openai.EmbeddingConfig&#123;</span><br><span class="line">		BaseURL: ollamaV1URL, <span class="comment">// OllamaæœåŠ¡v1åœ°å€ï¼Œå…¼å®¹OpenAIæ¥å£</span></span><br><span class="line">		Model:   embedModel, <span class="comment">// æ¨¡å‹åç§°ï¼Œæ¯”å¦‚bge-m3:latest</span></span><br><span class="line">		Timeout: <span class="number">30</span> * time.Second,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"create ollama embed model failed: %v"</span>, err))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &amp;EinoOllamaKnowledge&#123;</span><br><span class="line">		docs:     <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]*Doc),</span><br><span class="line">		embedder: embedder,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(k *EinoOllamaKnowledge)</span> <span class="title">Run</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	texts := []<span class="keyword">string</span>&#123;</span><br><span class="line">		<span class="string">"åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚"</span>,</span><br><span class="line">		<span class="string">"ç¦»ç¦»åŸä¸Šè‰ï¼Œä¸€å²ä¸€æ¯è£ã€‚é‡ç«çƒ§ä¸å°½ï¼Œæ˜¥é£å¹åˆç”Ÿã€‚"</span>,</span><br><span class="line">		<span class="string">"ç™½æ—¥ä¾å±±å°½ï¼Œé»„æ²³å…¥æµ·æµã€‚æ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼ã€‚"</span>,</span><br><span class="line">		<span class="string">"ç…®è±†ç‡ƒè±†èï¼Œè±†åœ¨é‡œä¸­æ³£ã€‚æœ¬æ˜¯åŒæ ¹ç”Ÿï¼Œç›¸ç…ä½•å¤ªæ€¥ã€‚"</span>,</span><br><span class="line">		<span class="string">"é¹…é¹…é¹…ï¼Œæ›²é¡¹å‘å¤©æ­Œã€‚ç™½æ¯›æµ®ç»¿æ°´ï¼Œçº¢æŒæ‹¨æ¸…æ³¢ã€‚"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	k.AddDocs(ctx, texts)</span><br><span class="line"></span><br><span class="line">	queries := []<span class="keyword">string</span>&#123;</span><br><span class="line">		<span class="string">"éŸ§æ€§"</span>,</span><br><span class="line">		<span class="string">"ç™»é«˜"</span>,</span><br><span class="line">		<span class="string">"å¤œæ™š"</span>,</span><br><span class="line">		<span class="string">"åŠ¨ç‰©"</span>,</span><br><span class="line">		<span class="string">"å…„å¼Ÿ"</span>,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> _, q := <span class="keyword">range</span> queries &#123;</span><br><span class="line">		doc := k.FindMostSimilarDoc(ctx, q)</span><br><span class="line">		<span class="keyword">if</span> doc != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"query: %s, most similar doc: %s\n"</span>, q, doc.Content)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">"query: %s, no similar doc found\n"</span>, q)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(k *EinoOllamaKnowledge)</span> <span class="title">genID</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	k.idMtx.Lock()</span><br><span class="line">	<span class="keyword">defer</span> k.idMtx.Unlock()</span><br><span class="line">	k.idIncr++</span><br><span class="line">	<span class="keyword">return</span> k.idIncr</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(k *EinoOllamaKnowledge)</span> <span class="title">AddDocs</span><span class="params">(ctx context.Context, texts []<span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	embeddings, err := k.embedder.EmbedStrings(ctx, texts)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"generate embedding failed: %v"</span>, err))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(embeddings) != <span class="built_in">len</span>(texts) &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"embedding count not equal to text count: %d != %d"</span>, <span class="built_in">len</span>(embeddings), <span class="built_in">len</span>(texts)))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(texts); i++ &#123;</span><br><span class="line">		id := k.genID()</span><br><span class="line">		doc := &amp;Doc&#123;</span><br><span class="line">			ID:        id,</span><br><span class="line">			Content:   texts[i],</span><br><span class="line">			Embedding: embeddings[i],</span><br><span class="line">		&#125;</span><br><span class="line">		k.docs[id] = doc</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(k *EinoOllamaKnowledge)</span> <span class="title">GetDoc</span><span class="params">(id <span class="keyword">int</span>)</span> *<span class="title">Doc</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> doc, ok := k.docs[id]; ok &#123;</span><br><span class="line">		<span class="keyword">return</span> doc</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FindMostSimilarDoc æœ€ç®€å•çš„æŸ¥æ‰¾æœ€ç›¸ä¼¼æ–‡æ¡£çš„å®ç°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(k *EinoOllamaKnowledge)</span> <span class="title">FindMostSimilarDoc</span><span class="params">(ctx context.Context, text <span class="keyword">string</span>)</span> *<span class="title">Doc</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> text == <span class="string">""</span> || <span class="built_in">len</span>(k.docs) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	embeddings, err := k.embedder.EmbedStrings(ctx, []<span class="keyword">string</span>&#123;text&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"generate embedding failed: %v"</span>, err))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(embeddings) != <span class="number">1</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"embedding count not equal to text count: %d != %d"</span>, <span class="built_in">len</span>(embeddings), <span class="number">1</span>))</span><br><span class="line">	&#125;</span><br><span class="line">	queryEmbedding := embeddings[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">	cosineSimilarity := <span class="function"><span class="keyword">func</span><span class="params">(a, b []<span class="keyword">float64</span>)</span> <span class="title">float64</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(a) != <span class="built_in">len</span>(b) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">var</span> dotProduct, normA, normB <span class="keyword">float64</span></span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> a &#123;</span><br><span class="line">			dotProduct += a[i] * b[i]</span><br><span class="line">			normA += a[i] * a[i]</span><br><span class="line">			normB += b[i] * b[i]</span><br><span class="line">			<span class="keyword">if</span> normA == <span class="number">0</span> || normB == <span class="number">0</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> dotProduct / (math.Sqrt(normA) * math.Sqrt(normB))</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> mostSimilar *Doc</span><br><span class="line">	maxScore := <span class="number">-1.0</span></span><br><span class="line">	<span class="keyword">for</span> _, doc := <span class="keyword">range</span> k.docs &#123;</span><br><span class="line">		score := cosineSimilarity(queryEmbedding, doc.Embedding)</span><br><span class="line">		fmt.Printf(<span class="string">"[FindMostSimilarDoc] query: %s, doc: %s, score: %v\n"</span>, text, doc.Content, score)</span><br><span class="line">		<span class="keyword">if</span> score &gt; maxScore &#123;</span><br><span class="line">			maxScore = score</span><br><span class="line">			mostSimilar = doc</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> mostSimilar</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœè¿™æ®µä»£ç è½¬æˆPythonä¹Ÿæ˜¯æ¯”è¾ƒå®¹æ˜“çš„ï¼Œæ¯”å¦‚Traeè¿™ç§å–„äºå¤„ç†ä»£ç ä»»åŠ¡çš„Agentå°±å¯ä»¥åšä¸åŒè¯­è¨€ä»£ç è½¬æ¢ã€‚å‡ä½¿ç”¨LangChainå®ç°ï¼Œå¤–åŠ ChromaDBæœ¬åœ°æŒä¹…åŒ–å‘é‡æ–‡æœ¬çš„è¯ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> langchain_community.embeddings <span class="keyword">import</span> OllamaEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain_community.vectorstores <span class="keyword">import</span> Chroma</span><br><span class="line"><span class="keyword">from</span> langchain.schema <span class="keyword">import</span> Document</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OllamaKnowledge</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, model=<span class="string">"bge-m3:latest"</span>, ollama_base_url=<span class="string">"http://localhost:11434"</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 persist_directory=<span class="string">"./chroma_db"</span>)</span>:</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–OllamaåµŒå…¥æ¨¡å‹</span></span><br><span class="line">        self.embeddings = OllamaEmbeddings(</span><br><span class="line">            model=model,</span><br><span class="line">            base_url=ollama_base_url</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–Chromaå‘é‡å­˜å‚¨</span></span><br><span class="line">        self.vector_store = Chroma(</span><br><span class="line">            embedding_function=self.embeddings,</span><br><span class="line">            persist_directory=persist_directory</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_docs</span><span class="params">(self, texts)</span>:</span></span><br><span class="line">        <span class="string">"""æ·»åŠ æ–‡æ¡£åˆ°å‘é‡æ•°æ®åº“"""</span></span><br><span class="line">        documents = []</span><br><span class="line">        <span class="keyword">for</span> text <span class="keyword">in</span> texts:</span><br><span class="line">            <span class="comment"># ä¸ºæ¯ä¸ªæ–‡æ¡£ç”Ÿæˆå”¯ä¸€ID</span></span><br><span class="line">            doc_id = str(uuid.uuid4())</span><br><span class="line">            <span class="comment"># åˆ›å»ºLangChainæ–‡æ¡£å¯¹è±¡</span></span><br><span class="line">            document = Document(</span><br><span class="line">                page_content=text,</span><br><span class="line">                metadata=&#123;<span class="string">"id"</span>: doc_id&#125;</span><br><span class="line">            )</span><br><span class="line">            documents.append(document)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†æ–‡æ¡£æ·»åŠ åˆ°å‘é‡å­˜å‚¨</span></span><br><span class="line">        self.vector_store.add_documents(documents)</span><br><span class="line">        <span class="comment"># æŒä¹…åŒ–å­˜å‚¨</span></span><br><span class="line">        self.vector_store.persist()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_most_similar_doc</span><span class="params">(self, query, k=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="string">"""æŸ¥æ‰¾ä¸æŸ¥è¯¢æœ€ç›¸ä¼¼çš„æ–‡æ¡£"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> query:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ‰§è¡Œç›¸ä¼¼åº¦æœç´¢</span></span><br><span class="line">        results = self.vector_store.similarity_search_with_score(query, k=k)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> results:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿”å›æœ€ç›¸ä¼¼çš„æ–‡æ¡£</span></span><br><span class="line">        most_similar_doc, score = results[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> most_similar_doc, score</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_demo</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è¿è¡Œæ¼”ç¤ºï¼šæ·»åŠ æ–‡æ¡£å¹¶æ‰§è¡ŒæŸ¥è¯¢"""</span></span><br><span class="line">        <span class="comment"># ç¤ºä¾‹æ–‡æ¡£ï¼ˆå”è¯—ï¼‰</span></span><br><span class="line">        texts = [</span><br><span class="line">            <span class="string">"åºŠå‰æ˜æœˆå…‰ï¼Œç–‘æ˜¯åœ°ä¸Šéœœã€‚ä¸¾å¤´æœ›æ˜æœˆï¼Œä½å¤´æ€æ•…ä¹¡ã€‚"</span>,</span><br><span class="line">            <span class="string">"ç¦»ç¦»åŸä¸Šè‰ï¼Œä¸€å²ä¸€æ¯è£ã€‚é‡ç«çƒ§ä¸å°½ï¼Œæ˜¥é£å¹åˆç”Ÿã€‚"</span>,</span><br><span class="line">            <span class="string">"ç™½æ—¥ä¾å±±å°½ï¼Œé»„æ²³å…¥æµ·æµã€‚æ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼ã€‚"</span>,</span><br><span class="line">            <span class="string">"ç…®è±†ç‡ƒè±†èï¼Œè±†åœ¨é‡œä¸­æ³£ã€‚æœ¬æ˜¯åŒæ ¹ç”Ÿï¼Œç›¸ç…ä½•å¤ªæ€¥ã€‚"</span>,</span><br><span class="line">            <span class="string">"é¹…é¹…é¹…ï¼Œæ›²é¡¹å‘å¤©æ­Œã€‚ç™½æ¯›æµ®ç»¿æ°´ï¼Œçº¢æŒæ‹¨æ¸…æ³¢ã€‚"</span>,</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ·»åŠ æ–‡æ¡£</span></span><br><span class="line">        print(<span class="string">"æ­£åœ¨æ·»åŠ æ–‡æ¡£åˆ°å‘é‡æ•°æ®åº“..."</span>)</span><br><span class="line">        self.add_docs(texts)</span><br><span class="line">        print(<span class="string">f"æˆåŠŸæ·»åŠ äº† <span class="subst">&#123;len(texts)&#125;</span> ç¯‡æ–‡æ¡£\n"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æŸ¥è¯¢ç¤ºä¾‹</span></span><br><span class="line">        queries = [<span class="string">"éŸ§æ€§"</span>, <span class="string">"ç™»é«˜"</span>, <span class="string">"å¤œæ™š"</span>, <span class="string">"åŠ¨ç‰©"</span>, <span class="string">"å…„å¼Ÿ"</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> q <span class="keyword">in</span> queries:</span><br><span class="line">            result = self.find_most_similar_doc(q)</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                doc, score = result</span><br><span class="line">                print(<span class="string">f"æŸ¥è¯¢: <span class="subst">&#123;q&#125;</span>"</span>)</span><br><span class="line">                print(<span class="string">f"æœ€ç›¸ä¼¼çš„æ–‡æ¡£: <span class="subst">&#123;doc.page_content&#125;</span>"</span>)</span><br><span class="line">                print(<span class="string">f"ç›¸ä¼¼åº¦å¾—åˆ†: <span class="subst">&#123;score:<span class="number">.4</span>f&#125;</span>\n"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">f"æŸ¥è¯¢: <span class="subst">&#123;q&#125;</span>, æœªæ‰¾åˆ°ç›¸ä¼¼æ–‡æ¡£\n"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»å‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="comment"># åˆ›å»ºOllamaKnowledgeå®ä¾‹</span></span><br><span class="line">    knowledge = OllamaKnowledge()</span><br><span class="line">    <span class="comment"># è¿è¡Œæ¼”ç¤º</span></span><br><span class="line">    knowledge.run_demo()</span><br></pre></td></tr></table></figure>
<p>å¯¹äºå¤æ‚ç¼–æ’ï¼Œé™¤äº†å¯ä»¥è€ƒè™‘ç”¨Difyä¹‹ç±»çš„å¯è§†åŒ–å·¥å…·åšä¹‹å¤–ï¼Œçº¯ç¨‹åºçš„è¯ï¼ŒEinoä¹Ÿæä¾›äº†ä¸€å¥—<span class="exturl" data-url="aHR0cHM6Ly93d3cuY2xvdWR3ZWdvLmlvL3poL2RvY3MvZWluby9jb3JlX21vZHVsZXMvZWlub19hZGsv" title="https://www.cloudwego.io/zh/docs/eino/core_modules/eino_adk/">ADK<i class="fa fa-external-link"></i></span>æ¡†æ¶å°è£…äº†æ›´å¤æ‚çš„Agentç¼–æ’åŠŸèƒ½ã€‚é™¤äº†æœ€åŸºç¡€çš„ChatModelAgentä¹‹å¤–ï¼Œå†å¾€ä¸Šå®ç°çš„æ˜¯WorkflowAgentsï¼Œé‡Œé¢åŒ…æ‹¬Sequentialã€Loopä»¥åŠParallelç­‰ç¼–æ’ï¼Œä¹Ÿå°±æ˜¯è¡Œä¸ºæ ‘çš„ç¿»ç‰ˆï¼Œç„¶åå†ç»§ç»­å¾€ä¸Šå°±å®ç°äº†Supervisorä»¥åŠPlan-Executeä¸¤ç±»å°è£…å¥½çš„åº”ç”¨çº§ç¼–æ’ã€‚</p>
<p>å¯¹äºè°ƒç ”ç±»ä»»åŠ¡çš„è¯ï¼Œæœ‰ä¸€ä¸ªå°è£…å¥½çš„Plan-Executeç¼–æ’ï¼ŒåŠ ä¸Šé è°±çš„æ•°æ®å¤„ç†æ¨¡å‹ï¼Œå°±å¯ä»¥å®ç°ä¸€ä¸ªç®€å•çš„è°ƒç ”ç±»Agentï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> EinoAdkAgent <span class="keyword">struct</span> &#123;</span><br><span class="line">	runner *adk.Runner</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewEinoAdkAgent</span><span class="params">()</span> *<span class="title">EinoAdkAgent</span></span> &#123;</span><br><span class="line">	a := &amp;EinoAdkAgent&#123;&#125;</span><br><span class="line">	<span class="keyword">if</span> err := a.init(context.Background()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(errors.Errorf(<span class="string">"initialize EinoAdkAgent failed: %v"</span>, err))</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *EinoAdkAgent)</span> <span class="title">Run</span><span class="params">(ctx context.Context)</span></span> &#123;</span><br><span class="line">	userInput := []adk.Message&#123;</span><br><span class="line">		schema.UserMessage(<span class="string">"è¯·ç”¨ä¸­æ–‡å›ç­”å¦‚ä½•å†™ä¸€ç¯‡100000å­—çš„ç§‘å¹»å°è¯´ï¼Ÿ"</span>),</span><br><span class="line">	&#125;</span><br><span class="line">	events := a.runner.Run(ctx, userInput)</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		event, ok := events.Next()</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> event.Err != <span class="literal">nil</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">"æ‰§è¡Œé”™è¯¯: %v"</span>, event.Err)</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// æ‰“å°æ™ºèƒ½ä½“è¾“å‡ºï¼ˆè®¡åˆ’ã€æ‰§è¡Œç»“æœã€æœ€ç»ˆå“åº”ç­‰ï¼‰</span></span><br><span class="line">		<span class="keyword">if</span> msg, err := event.Output.MessageOutput.GetMessage(); err == <span class="literal">nil</span> &amp;&amp; msg.Content != <span class="string">""</span> &#123;</span><br><span class="line">			log.Printf(<span class="string">"\n=== Agent [%s] Output ===\n%s\n"</span>, event.AgentName, msg.Content)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *EinoAdkAgent)</span> <span class="title">init</span><span class="params">(ctx context.Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	<span class="comment">// init chat model</span></span><br><span class="line">	chatModel, err := a.initChatModel(ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.Errorf(<span class="string">"create ollama chat model failed: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> agent adk.Agent</span><br><span class="line"></span><br><span class="line">	<span class="comment">// init plan-executor</span></span><br><span class="line">	planExecutor, err := a.initPlanExecutor(ctx, chatModel)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> errors.Errorf(<span class="string">"create plan-executor agent failed: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	agent = planExecutor</span><br><span class="line"></span><br><span class="line">	<span class="comment">// init runner</span></span><br><span class="line">	a.runner = adk.NewRunner(ctx, adk.RunnerConfig&#123;Agent: agent, EnableStreaming: <span class="literal">true</span>&#125;)</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *EinoAdkAgent)</span> <span class="title">initChatModel</span><span class="params">(ctx context.Context)</span> <span class="params">(model.ToolCallingChatModel, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> ollama.NewChatModel(ctx, &amp;ollama.ChatModelConfig&#123;</span><br><span class="line">		<span class="comment">// åŸºç¡€é…ç½®</span></span><br><span class="line">		BaseURL: ollamaURL,         <span class="comment">// Ollama æœåŠ¡åœ°å€</span></span><br><span class="line">		Timeout: <span class="number">300</span> * time.Second, <span class="comment">// è¯·æ±‚è¶…æ—¶æ—¶é—´</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¨¡å‹é…ç½®</span></span><br><span class="line">		Model: qwen3Model, <span class="comment">// æ¨¡å‹åç§°</span></span><br><span class="line">		<span class="comment">// Format: json.RawMessage(`"json"`), // è¾“å‡ºæ ¼å¼ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¨¡å‹å‚æ•°</span></span><br><span class="line">		Options: &amp;api.Options&#123;</span><br><span class="line">			NumPredict: <span class="number">4096</span>,</span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ¨ç†é…ç½®</span></span><br><span class="line">		Thinking: &amp;api.ThinkValue&#123;Value: <span class="literal">false</span>&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *EinoAdkAgent)</span> <span class="title">initPlanExecutor</span><span class="params">(ctx context.Context, chatModel model.ToolCallingChatModel)</span> <span class="params">(adk.Agent, error)</span></span> &#123;</span><br><span class="line">	<span class="comment">// init planner</span></span><br><span class="line">	planner, err := planexecute.NewPlanner(ctx, &amp;planexecute.PlannerConfig&#123;</span><br><span class="line">		ToolCallingChatModel: chatModel,</span><br><span class="line">		ToolInfo:             &amp;planexecute.PlanToolInfo, <span class="comment">// é»˜è®¤ Plan å·¥å…· schema</span></span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.Errorf(<span class="string">"create planner agent failed: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// init executor</span></span><br><span class="line">	execAgent, err := adk.NewChatModelAgent(ctx, &amp;adk.ChatModelAgentConfig&#123;</span><br><span class="line">		Name:          <span class="string">"AnySolver"</span>,</span><br><span class="line">		Description:   <span class="string">"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è§£ç­”è€…ï¼Œèƒ½å¤Ÿä¸ºä»»æ„é—®é¢˜ç”Ÿæˆè§£ç­”æ–¹æ¡ˆã€‚"</span>,</span><br><span class="line">		Instruction:   <span class="string">"ä½ åªèƒ½æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼Œç”Ÿæˆå…·ä½“å¯æ‰§è¡Œçš„è§£ç­”æ–¹æ¡ˆï¼Œä¸èƒ½ç”Ÿæˆä»»ä½•ä¸é—®é¢˜æ— å…³çš„å†…å®¹ã€‚"</span>,</span><br><span class="line">		Model:         chatModel,</span><br><span class="line">		MaxIterations: <span class="number">1</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.Errorf(<span class="string">"create executor chat model agent failed: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	execTool := adk.NewAgentTool(ctx, execAgent) <span class="comment">// ä¸€ä¸ªçº¯ChatModelå ä½ï¼ŒMCPåŸºæœ¬æ”¶è´¹ï¼Œå…ˆä¸ç®¡</span></span><br><span class="line">	executor, err := planexecute.NewExecutor(ctx, &amp;planexecute.ExecutorConfig&#123;</span><br><span class="line">		Model:         chatModel,</span><br><span class="line">		MaxIterations: <span class="number">3</span>,</span><br><span class="line">		ToolsConfig: adk.ToolsConfig&#123;</span><br><span class="line">			ToolsNodeConfig: compose.ToolsNodeConfig&#123;</span><br><span class="line">				Tools: []tool.BaseTool&#123;execTool&#125;,</span><br><span class="line">			&#125;,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.Errorf(<span class="string">"create executor agent failed: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// init replanner</span></span><br><span class="line">	replanner, err := planexecute.NewReplanner(ctx, &amp;planexecute.ReplannerConfig&#123;</span><br><span class="line">		ChatModel: chatModel,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.Errorf(<span class="string">"create replanner agent failed: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// init plan-executor agent</span></span><br><span class="line">	planExecuteAgent, err := planexecute.New(ctx, &amp;planexecute.Config&#123;</span><br><span class="line">		Planner:       planner,</span><br><span class="line">		Executor:      executor,</span><br><span class="line">		Replanner:     replanner,</span><br><span class="line">		MaxIterations: <span class="number">10</span>,</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.Errorf(<span class="string">"create plan-execute agent failed: %v"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> planExecuteAgent, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œå¦‚æœè¯´è¦æŠŠAgentæ•ˆæœç»§ç»­ä¼˜åŒ–çš„è¯ï¼Œå…ˆæ˜¯è¦æœ‰ä¸€å¥—å®Œå–„çš„è¯„æµ‹ç³»ç»Ÿï¼Œç„¶åä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªTraceå·¥å…·äº†è§£æ•´ä¸ªAgenté“¾è·¯ä¸Šçš„å¼±ç‚¹ï¼Œæœ€åå¯ä»¥ä»å·¥å…·ã€Promptã€æ¨¡å‹FineTuneç­‰å¾ˆå¤šè§’åº¦å»åšä¼˜åŒ–ï¼Œä»è€Œä¸æ–­å®Œå–„Agentçš„èƒ½åŠ›ã€‚è¦å®ç°ä¸€ä¸ªDemoå¾ˆå®¹æ˜“ï¼Œä½†æ‰“ç£¨äº§å“çš„ä»»åŠ¡ä»ç„¶ä»»é‡é“è¿œã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Agent</tag>
        <tag>LLM</tag>
        <tag>Eino</tag>
        <tag>Ollama</tag>
        <tag>LangChain</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘LLMèµ‹èƒ½æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„ä¸€äº›æƒ³æ³•</title>
    <url>/2025/10/04/testlife/llm_game_autotest/</url>
    <content><![CDATA[<p>åœ¨ä¸‰å¹´å‰ç¬”è€…æ’°å†™çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvR2FtZS1PZi1BdXRvVGVzdC8=" title="https://utmhikari.top/categories/Game-Of-AutoTest/">Game-Of-AutoTest<i class="fa fa-external-link"></i></span>ä¸“æ å½“ä¸­ï¼ŒèŠäº†å¾ˆå¤šå…³äºæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„å®è·µæ€è€ƒã€‚ä¸è®ºæ˜¯å¯¹è‡ªåŠ¨åŒ–æµ‹è¯•åœ¨æŠ€æœ¯å±‚é¢çš„è®¤è¯†ï¼Œè¿˜æ˜¯æ€ä¹ˆè½åœ°ä¸€äº›æŠ€æœ¯åŸºå»ºä¿éšœæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¯æ‰©å±•æ€§ï¼Œåœ¨è¿™äº›ä¸“æ é‡Œéƒ½å·²ç»åšäº†æ·±åº¦çš„ç§‘æ™®ã€‚è¿‘å¹´æ¥ï¼ŒLLMåœ¨è‡ªç„¶è¯­è¨€å¤„ç†é¢†åŸŸå–å¾—äº†çªç ´æ€§è¿›å±•ï¼Œå¹¶ä¸”éšç€æ¸¸æˆå¼€å‘çš„å¤æ‚åº¦ä¸æ–­æå‡ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•åœ¨ä¿éšœæ¸¸æˆè´¨é‡æ–¹é¢å˜å¾—å°¤ä¸ºé‡è¦ã€‚ç›´æ„Ÿæ¥çœ‹ï¼ŒLLMä½œä¸ºé€šç”¨çš„ä¿¡æ¯å¤„ç†è½¬æ¢å¤§è„‘ï¼Œå¿…ç„¶èƒ½ä¸ºæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯å¸¦æ¥äº†æ–°çš„å¯èƒ½æ€§ã€‚å› æ­¤ï¼Œæœ¬æ–‡å°±æµ…èŠä¸€ä¸‹LLMèµ‹èƒ½æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„ä¸€äº›æƒ³æ³•ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯æµ‹è¯•ç”¨ä¾‹è‡ªåŠ¨ç”Ÿæˆã€‚LLMæ˜¯å…·å¤‡å°†è‡ªç„¶è¯­è¨€è½¬åŒ–æˆç»“æ„åŒ–æ•°æ®çš„èƒ½åŠ›çš„ï¼Œæ‰€ä»¥ç†è®ºå¯è¡Œã€‚å¦‚æœæ˜¯å·²ç»ç¼–å†™å¥½çš„æ¸¸æˆæµ‹è¯•ç”¨ä¾‹ï¼Œä¸€èˆ¬æœ¬èº«å·²ç»åŒ…å«äº†å‰ç½®æ¡ä»¶ã€æ‰§è¡Œæ­¥éª¤å’Œé¢„æœŸç»“æœçš„å­—æ®µæ ‡æ³¨ï¼Œè€ŒLLMéœ€è¦åšçš„å°±æ˜¯æ€ä¹ˆæŠŠæ¯ä¸ªå­—æ®µé‡Œçš„å†…å®¹å’Œè‡ªåŠ¨åŒ–æ¡†æ¶é¢„ç½®çš„è¡Œä¸ºå¯¹åº”ä¸Šï¼Œç„¶åè‡ªåŠ¨ç”Ÿæˆä¸€å¥—è‡ªåŠ¨åŒ–ç¨‹åºã€‚è¿™æ ·å¯ä»¥é™æœ¬çš„åŸå› æ˜¯ï¼Œè‡ªåŠ¨åŒ–ä¸€ç«¯åªéœ€è¦å®ç°å…·ä½“çš„è¡Œä¸ºï¼Œè€Œè¿™äº›è¡Œä¸ºæ€ä¹ˆä¸²èµ·æ¥ï¼Œç”¨LLMç»“åˆä¸€å¥—è¡Œä¸ºæ ‘æ¡†æ¶ï¼Œç†è®ºä¸Šä¹Ÿå¯ä»¥è‡ªä¸»ç”Ÿæˆè‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p>
<p>å…¶æ¬¡æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬çš„è¿­ä»£ã€‚æµ‹è¯•éœ€è¦æ‰§è¡Œä¸€ç³»åˆ—è‡ªç„¶è¯­è¨€æè¿°çš„è¡Œä¸ºï¼Œæœ€ç»ˆéœ€è¦åšè‡ªç„¶è¯­è¨€æè¿°çš„åˆ¤æ–­ï¼Œé‚£ä¹ˆæ€æ ·æè¿°æ›´åŠ ç²¾ç¡®ï¼Œå…¶å®ä¹Ÿå¯ä»¥é€šè¿‡LLMè¾…åŠ©ï¼Œç»™å‡ºä¿®æ­£å»ºè®®ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æœæœ‰ä¸€å¥—è‡ªåŠ¨åŒ–æµ‹è¯•è°ƒè¯•æ¨¡å—ï¼Œå°±å¯ä»¥æ¸…æ™°äº†è§£æ¯æ—¶æ¯åˆ»LLMåœ¨æƒ³ä»€ä¹ˆï¼Œä»è€Œä¹Ÿå¯ä»¥å®šå‘ä¼˜åŒ–LLMçš„åˆ¤æ–­ã€‚å¦‚æœè¦è®©ä¿®æ­£å»ºè®®æ•ˆæœæ›´å¥½ï¼Œé‚£ä¹ˆLLMå°±éœ€è¦äº†è§£æ›´å¤šæ¸¸æˆçš„ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥å¦‚æœå¯¹åº”çš„çŸ¥è¯†åº“èƒ½åŠ›å¯ä»¥å’Œæ¸¸æˆå¼•æ“é¡¹ç›®èƒ½åŠ›åšä¸€ä¸ªç»“åˆçš„è¯ï¼Œé‚£å°±æœ‰å¯èƒ½è¾¾åˆ°æ¯”è¾ƒå¥½çš„æ•ˆæœã€‚</p>
<p>ç„¶åæ˜¯æ¢ç´¢æµ‹è¯•ã€‚ä¸»è¦æ˜¯ä¸¤ä»¶äº‹æƒ…ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯ç»™å®šä¸€ç±»æ¸¸æˆæ¢ç´¢åœºæ™¯ï¼ŒLLMå¯ä»¥è‡ªä¸»Planå‡ºä¸€å¥—æµ‹è¯•æ–¹æ¡ˆï¼Œæ¢ç´¢æµ‹è¯•è¿‡ç¨‹æ½œåœ¨çš„å´©æºƒå’Œå¡æ­»é—®é¢˜ï¼›ç¬¬äºŒä»¶äº‹æƒ…å°±æ˜¯ç»™å®šä¸€ä¸ªç³»ç»Ÿæ¨¡å—ï¼Œè®©LLMè‡ªä¸»æ¢ç´¢äº¤äº’è¡Œä¸ºï¼Œè‡ªåŠ¨ç”Ÿæˆå¤§é‡æµ‹è¯•ç”¨ä¾‹ã€‚å¦‚æœæ˜¯å‡ºæµ·ç±»æ¸¸æˆï¼Œå¯¹äºç¿»è¯‘äº¤äº’ç±»é—®é¢˜ï¼ŒLLMä¹Ÿæœ‰æ½œåŠ›å»åšè¯†åˆ«ï¼Œè¿™æ ·å°±å¯ä»¥æå¤§æå‡æ¸¸æˆæµ‹è¯•çš„å¹¿åº¦å’Œæ·±åº¦ã€‚</p>
<p>æœ€åä¸€ç‚¹æ˜¯ï¼ŒLLMå¦‚æœè¦åœ¨æ¸¸æˆè‡ªåŠ¨åŒ–é¢†åŸŸåº”ç”¨çš„å¥½ï¼Œäº§å“å±‚é¢ä¸€æ˜¯éœ€è¦æœ‰ä¸€å¥—ç±»ä¼¼äºIDE/Workbenchçš„ä¸œè¥¿æŠŠå„ç§å·¥å…·é“¾ä¸²èµ·æ¥ï¼ŒäºŒæ˜¯éœ€è¦é…åˆä¸€å¥—æ˜“ä¸Šæ‰‹çš„æ•™å­¦ï¼Œè¿™æ ·æ‰èƒ½æ›´å¿«é€Ÿåœ¨æ¸¸æˆæµ‹è¯•å·¥ä½œä¸­è½åœ°ã€‚è¦åšè¿™ä¸ªäº§å“è¿˜æ˜¯éœ€è¦ä¸€å®šçš„æŠ•å…¥çš„ï¼Œä½†å¤§å¤šæ•°æ¸¸æˆå¯èƒ½ç ”å‘æœŸæˆ–è€…åˆšä¸Šçº¿å°±æš´æ¯™äº†ï¼Œä¸åƒWebäº§å“ç”Ÿå‘½å‘¨æœŸä¼šæ›´é•¿ä¸€ç‚¹ã€‚æ‰€ä»¥å¦‚æœè¦åšè¿™ä¸ªäº§å“çš„è¯ï¼Œä¸€å®šè¦æŠ±æœ‰æŒç»­ç§¯ç´¯çš„æ‰“ç®—ï¼Œè¿™æ ·æ‰èƒ½ä¿è¯LLMè‡ªåŠ¨åŒ–æµ‹è¯•çš„äº¤ä»˜è´¨é‡ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>IDE</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>LLM</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘æ„å»ºå˜æ›´é£é™©é˜²æ§èƒ½åŠ›å¸‚åœºçš„ä¸€äº›ç»éªŒ</title>
    <url>/2025/10/04/archiart/change_control_ability_market/</url>
    <content><![CDATA[<p>å˜æ›´é£é™©é˜²æ§çš„èƒ½åŠ›æ˜¯å¤šæ ·çš„ï¼Œé™¤äº†æœ€ä¼ ç»Ÿçš„å‘Šè­¦æ£€æµ‹ã€Metricsæ›²çº¿å¯¹æ¯”ä»¥åŠè‡ªåŠ¨åŒ–æµ‹è¯•èƒ½åŠ›ä¹‹å¤–ï¼Œåƒå˜æ›´å½±å“åˆ†æã€é£é™©é™å™ªä»¥åŠçº¿ä¸Šé£é™©RCAç­‰å‘¨è¾¹èƒ½åŠ›ä¹Ÿæ˜¯ä¸å¯å°‘çš„ã€‚æœ‰äº†æ›´å¤šçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ‰èƒ½å¯¹å˜æ›´é£é™©åšæ›´å¥½çš„åˆ¤æ–­ã€‚ä»ä¸­å°æŠ€æœ¯è§†è§’æ¥çœ‹ï¼Œä¸è®ºæ˜¯ä¼ ç»Ÿèƒ½åŠ›è¿˜æ˜¯ä¸€äº›AIåŠ æˆçš„èƒ½åŠ›ï¼Œå¦‚æœæ²¡æœ‰ä¸€å¥—ç¨³å›ºçš„æŠ€æœ¯åŸºå»ºè®©è¿™äº›èƒ½åŠ›å°½æƒ…å‘æŒ¥ï¼Œé‚£ä¹ˆè¿™äº›èƒ½åŠ›å°†éš¾ä»¥å¿«é€Ÿè½åœ°ï¼Œå……åˆ†å…‘ç°å…¶ä¸šåŠ¡ä»·å€¼ã€‚</p>
<p>åŸºäºæ­¤ï¼Œç¬”è€…åœ¨ä»Šå¹´å·¥ä½œä¸­ï¼Œäº¤ä»˜äº†ä¸€å¥—ã€Œèƒ½åŠ›å¸‚åœºã€äº§å“ä¸æŠ€æœ¯æ¶æ„ï¼Œæ—¨åœ¨é¢å‘ä¸åŒä¸šåŠ¡å›¢é˜Ÿçš„è‡ªç ”èƒ½åŠ›ï¼Œæä¾›ä¸€å¥—å¼€æ”¾å¼æ ‡å‡†åŒ–çš„æ¥å…¥æ–¹æ¡ˆï¼Œè®©ä¸šåŠ¡è‡ªç ”çš„å˜æ›´é˜²æ§èƒ½åŠ›å¯ä»¥å¿«é€Ÿåº”ç”¨åˆ°å˜æ›´é£é™©è´¨æ£€è¿‡ç¨‹ä¸­ã€‚è™½ç„¶è¿™å¥—æ¶æ„ç›®å‰è¿˜æœ‰å¾ˆå¤šç»§ç»­æ‰©å±•å’Œå®Œå–„çš„ç©ºé—´ï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰è¹­åˆ°LLMçš„å™±å¤´ï¼Œä½†åœ¨æ¶æ„è¿­ä»£è¿‡ç¨‹ä¸­ç¬”è€…æƒè¡¡äº†å¾ˆå¤šåˆ©å®³å…³ç³»ï¼Œä¸»å¯¼äº†å¾ˆå¤šæŠ€æœ¯æ¼”è¿›åˆ¤æ–­ï¼Œæœ€ç»ˆä¹ŸæˆåŠŸè½å®äº†è¿™ä¸ªæŠ€æœ¯ç»“æœã€‚</p>
<p>å…·ä½“ä¸€äº›æŠ€æœ¯ä¸Šçš„è®¾è®¡ï¼Œå…¶å®å‰é¢çš„æ–‡ç« å·²ç»èŠäº†å¾ˆå¤šï¼ŒåŒ…æ‹¬<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDMvMDkvYXJjaGlhcnQvY2hhbmdlX29ic2VydmF0aW9uX3dvcmtlci8=" title="https://utmhikari.top/2025/03/09/archiart/change_observation_worker/">ä»»åŠ¡è°ƒåº¦<i class="fa fa-external-link"></i></span>ã€<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDkvMDYvYXJjaGlhcnQvY2hhbmdlX2NvbnRyb2xfc2NoZWR1bGVfZXZlbnQv" title="https://utmhikari.top/2025/09/06/archiart/change_control_schedule_event/">äº‹ä»¶çŠ¶æ€æœº<i class="fa fa-external-link"></i></span>ä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDkvMDYvYXJjaGlhcnQvY2hhbmdlX2NvbnRyb2xfZGVjaXNpb25fbW9kdWxlLw==" title="https://utmhikari.top/2025/09/06/archiart/change_control_decision_module/">å†…ç½®é™å™ªæ¨¡å—åµŒå…¥<i class="fa fa-external-link"></i></span>ä¹‹ç±»çš„ç‚¹éƒ½æœ‰é˜è¿°ã€‚æ‰€ä»¥ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œä¸å€¾å‘äºèŠè¿™äº›å…·ä½“çš„æŠ€æœ¯å®ç°ï¼Œæ›´å€¾å‘äºèŠä¸‹æ•´ä¸ªäº§å“äº¤ä»˜è¿‡ç¨‹ä¸­çš„ä¸€äº›æƒè¡¡å’Œåˆ¤æ–­ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯å¦‚ä½•å†³æ–­ã€Œèƒ½åŠ›å¸‚åœºã€äº§å“æŠ€æœ¯æ¶æ„çš„æ•´ä½“è®¾è®¡ï¼Œè¿™éƒ¨åˆ†å¦‚æœä»æœ€ç»ˆæ•ˆæœå‡ºå‘ï¼Œæ˜¯æ¯”è¾ƒå¥½æ¨ç†çš„ã€‚äº§å“çš„æ½œåœ¨ç”¨æˆ·ä¸»è¦æ˜¯å˜æ›´é˜²æ§èƒ½åŠ›RDä»¥åŠä¸šåŠ¡SREï¼Œèƒ½åŠ›RDå…³æ³¨æ€ä¹ˆæŠŠèƒ½åŠ›æ¥å…¥åˆ°ç³»ç»Ÿï¼Œä¸šåŠ¡SREå…³æ³¨æ€ä¹ˆæŠŠèƒ½åŠ›åº”ç”¨åˆ°æœåŠ¡å˜æ›´å‘å¸ƒè¿‡ç¨‹ã€‚é¢å‘èƒ½åŠ›RDï¼Œéœ€è¦æœ‰ä¸€å¥—èƒ½åŠ›å…ƒä¿¡æ¯ç®¡ç†æœºåˆ¶å’Œæ¥å…¥åè®®ï¼›é¢å‘ä¸šåŠ¡SREï¼Œéœ€è¦æœ‰ä¸€å¥—èƒ½åŠ›æ‰§è¡Œç­–ç•¥æœºåˆ¶ï¼›é¢å‘èƒ½åŠ›å®é™…è½åœ°ï¼Œåˆéœ€è¦æœ‰ä¸€å¥—è°ƒåº¦æœºåˆ¶æŠŠèƒ½åŠ›å…ƒä¿¡æ¯å’Œæ‰§è¡Œç­–ç•¥ä¸²èµ·æ¥ã€‚æ‰€ä»¥ä¸€å¥—å…ƒä¿¡æ¯ç®¡ç†-&gt;æ‰§è¡Œç­–ç•¥é…ç½®-&gt;æ‰§è¡Œè°ƒåº¦Workflowçš„æ¶æ„è®¾è®¡å°±å¾ˆæ¸…æ™°äº†ã€‚</p>
<p>ç„¶ååœ¨å®é™…ç ”å‘å‰ï¼Œéœ€è¦è€ƒè™‘çš„æ˜¯è¿™å¥—äº§å“äº¤ä»˜åï¼Œå¦‚ä½•ä¸å½±å“åŸæœ‰äº§å“ä½“éªŒã€‚åœ¨ç¬”è€…è¿™é‡Œï¼Œæœ‰ä¸€ä¸ªèƒŒæ™¯æ˜¯ç¬”è€…æ‰€åœ¨å›¢é˜Ÿå·²ç»æœ‰äº†ä¸€å¥—æŠ€æœ¯å®ç°åä¸šåŠ¡å®šåˆ¶åŒ–çš„å˜æ›´é˜²æ§äº§å“ï¼ŒåŸºæœ¬è¦†ç›–äº†å…¨å…¬å¸çš„ä¸šåŠ¡ï¼Œå¾ˆå¤šå†å²é€»è¾‘éƒ½ä¸æ˜¯å¾ˆå¥½æŒªã€‚ç ”å‘äººåŠ›æ–¹é¢ï¼Œã€Œèƒ½åŠ›å¸‚åœºã€æŠ•å…¥ä¹Ÿä¸ç®—å¤šã€‚æ‰€ä»¥æœ€ç»ˆå†³ç­–ä¸Šï¼Œã€Œèƒ½åŠ›å¸‚åœºã€æ•´å¥—æŠ€æœ¯æ¶æ„ä¼šä½œä¸ºåŸæœ‰äº§å“çš„æ‰©å……ï¼ŒåŒæ–¹å†…éƒ¨ä¼šå…±äº«çŠ¶æ€æ•°æ®ï¼Œåšä¸€äº›æ•°æ®å…¼å®¹é€»è¾‘ã€‚è™½ç„¶è¿™æ ·å®ç°ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œä½†ä¹Ÿæ˜¯å”¯ä¸€èƒ½ä¿éšœäº§å“ä½“éªŒçš„å¯è¡Œæ–¹æ¡ˆã€‚</p>
<p>ä¹‹åå°±æ˜¯å¯¹äºæ¯ç±»å˜æ›´é˜²æ§èƒ½åŠ›ï¼Œå¦‚ä½•åœ¨å˜æ›´é£é™©è§‚æµ‹è¿‡ç¨‹ä¸­åšçµæ´»è‡ªç”±çš„è°ƒåº¦ï¼Œå¯¹äºè¿™ä»¶äº‹æƒ…ï¼Œä¸Šé¢ã€Œäº‹ä»¶çŠ¶æ€æœºã€çš„æ–¹æ¡ˆæ˜¯å¯ä»¥è§£å†³çš„ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥åº”ä»˜æœªæ¥æ›´å¤šçš„æ¥å…¥éœ€æ±‚ã€‚ç®€å•æ¥è¯´ï¼Œå˜æ›´é£é™©è§‚æµ‹è¿‡ç¨‹é‡Œï¼Œæ¶‰åŠåˆ°è§‚æµ‹å’Œå˜æ›´ä¸¤æ¡æ—¶é—´çº¿ï¼Œä¸¤æ¡æ—¶é—´çº¿ä¸Šå„ç±»çŠ¶æ€å®Œæˆçš„äº‹ä»¶éƒ½æ˜¯ä¸å¯é€†çš„ã€‚å› æ­¤å¯ä»¥å›ºåŒ–å‡ºä¸€å¥—äº‹ä»¶çŠ¶æ€æœºï¼Œé€šè¿‡ä¸æ–­çš„çŠ¶æ€æ¼”è¿›ï¼Œæ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™å¯åœå“ªäº›èƒ½åŠ›ï¼Œä»€ä¹ˆæ—¶å€™ç»“æŸè§‚æµ‹ã€‚</p>
<p>æœ€åå°±æ˜¯å¯¹äºã€Œèƒ½åŠ›å¸‚åœºã€åç»­è¿­ä»£çš„ä¸€äº›å±•æœ›ã€‚ä¸ªäººä»¥ä¸ºã€Œèƒ½åŠ›å¸‚åœºã€çš„èŒè´£ä¸Šï¼Œé™¤äº†æå‡ä¸šåŠ¡é£é™©æ‹¦æˆªæ°´å¹³ä»¥å¤–ï¼Œè¿˜éœ€è¦æœ‰èƒ½åŠ›æ‰§è¡Œæ•°æ®çš„è¿è¥åŠŸèƒ½ï¼Œæ¯”å¦‚ç¨³å®šæ€§ã€é£é™©å¬å›ç‡ä»¥åŠæ£€æµ‹å‡†ç¡®ç‡ç­‰æ–¹é¢ï¼Œé€šè¿‡æ•°æ®åˆ†æå»è¾…åŠ©å„èƒ½åŠ›ä¸“é¡¹åšå®šå‘ä¼˜åŒ–ã€‚å¦‚æœé¢å‘LLMå¢å¼ºçš„é£é™©å†³ç­–èƒ½åŠ›ï¼Œä¹Ÿå¯ä»¥æ„å»ºä¸€äº›è¯„æµ‹æ‰‹æ®µï¼Œè¯„ä»·è¿™äº›å†³ç­–èƒ½åŠ›çš„æœ€ç»ˆæ•ˆæœã€‚è‡³å°‘ä»æŠ€æœ¯ä¸Šæ¥è®²ï¼Œå¯æ‰©å±•çš„ç‚¹è¿˜æ˜¯éå¸¸ä¸°å¯Œçš„ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>äº§å“</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>ä¸šåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘å˜æ›´é£é™©é˜²æ§æ¶æ„åµŒå…¥å†³ç­–é™å™ªæ¨¡å—çš„æ–¹æ³•</title>
    <url>/2025/09/06/archiart/change_control_decision_module/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDMvMDkvYXJjaGlhcnQvY2hhbmdlX29ic2VydmF0aW9uX3dvcmtlci8=" title="https://utmhikari.top/2025/03/09/archiart/change_observation_worker/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­ï¼Œæˆ‘ä»¬èŠåˆ°äº†ä¸€ä¸ªå˜æ›´è§‚æµ‹ä»»åŠ¡å¯ä»¥é€šè¿‡ä»€ä¹ˆæ ·çš„æ–¹å¼å¯¹ä¸åŒçš„å˜æ›´é˜²æ§èƒ½åŠ›åšç»Ÿä¸€è°ƒåº¦ï¼Œè¾¾åˆ°ä¼˜è¶Šçš„å˜æ›´é£é™©æ‹¦æˆªæ•ˆæœã€‚ä½†æ˜¯åœ¨å®æˆ˜å½“ä¸­ï¼Œå˜æ›´è§‚æµ‹ä»»åŠ¡é›†æˆäº†å¾ˆå¤šèƒ½åŠ›ï¼Œå³ä¾¿é£é™©æ‹¦æˆªç‡å¾ˆé«˜ï¼Œä½†ä¸åŒèƒ½åŠ›æ•ˆæœä¹Ÿæœ‰å·®è·ï¼Œå› æ­¤ä¼šæœ‰å¯èƒ½å‡ºç°è¯¯æŠ¥ï¼Œå¯¼è‡´å˜æ›´è§‚æµ‹ç»“è®ºä¸å‡†ç¡®ï¼Œå½±å“ç ”å‘å‘å¸ƒæ•ˆç‡ã€‚ä¸ºæ­¤ï¼Œä¸€å¥—æˆç†Ÿçš„å˜æ›´è§‚æµ‹ç³»ç»Ÿï¼Œæ˜¯éœ€è¦åµŒå…¥ä¸€ä¸ªå†³ç­–é™å™ªæ¨¡å—ï¼Œé€šè¿‡å¹²é¢„å˜æ›´é˜²æ§æ‹¦æˆªç»“æœï¼Œè¾¾åˆ°åœ¨é£é™©å¬å›ä¸åŠ£åŒ–çš„åŒæ—¶ï¼Œæå‡å‡†ç¡®ç‡ï¼Œè®©ç»“æœæ›´åŠ ç½®ä¿¡ã€‚</p>
<p>å› æ­¤ï¼Œä»Šå¤©ç¬”è€…å†³å®šç»“åˆè‡ªå·±çš„å·¥ä½œç»éªŒï¼Œç®€å•èŠä¸€ä¸‹å˜æ›´é£é™©é˜²æ§æ¶æ„çš„å®è§‚ä½“ç³»å½“ä¸­ï¼Œå†³ç­–é™å™ªæ¨¡å—åº”å½“æ€æ ·æ¥å…¥æ¯”è¾ƒåˆé€‚ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæœ¬æ–‡ä¸æ¶‰åŠå…·ä½“é™å™ªçš„å®ç°ï¼ŒåŒ…æ‹¬ç®—æ³•çš„è®¸å¤šéƒ¨åˆ†ï¼Œä¸»è¦æ˜¯ä»åç«¯å·¥ç¨‹æ¶æ„è§’åº¦ï¼ŒèŠä¸€ä¸‹æ€æ ·çš„æ¶æ„è®¾è®¡ï¼Œèƒ½å¤Ÿè®©å˜æ›´è§‚æµ‹ä»»åŠ¡å’Œå†³ç­–é™å™ªä»»åŠ¡å®Œç¾é…åˆèµ·æ¥ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆï¼Œå’±ä»¬éœ€è¦ä»äº§å“è§’åº¦çœ‹ä¸‹é™å™ªæœ€ç»ˆè¦å‘ˆç°ä»€ä¹ˆæ•ˆæœã€‚ç®€å•è€Œè¨€ï¼Œé™å™ªçš„å¯¹è±¡ï¼Œä¸€å—æ˜¯å¯¹äºçº¿ä¸Šå‘Šè­¦çš„é™å™ªï¼Œæ¯”å¦‚criticalçš„å‘Šè­¦ï¼Œå‡ä½¿è¢«é™å™ªæ¨¡å—è®¤ä¸ºå’Œå½“æ¬¡å˜æ›´æ— å…³ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¿½ç•¥ï¼Œæ‰€ä»¥æ£€æµ‹æŠ¥å‘Šé‡Œé¢é€å‡ºçš„ï¼Œå¯èƒ½å°±æ˜¯æŠ¥è­¦çš„æœ€ç»ˆç»“æœä»¥åŠé™å™ªç†ç”±ã€‚å¦ä¸€å—å°±æ˜¯å¯¹äºå•ä¸ªæ£€æµ‹èƒ½åŠ›çš„ç»“è®ºåšå¹²é¢„ï¼Œè¿™æ˜¯ç”±äºå•ä¸ªèƒ½åŠ›çš„å‘Šè­¦è¢«é™å™ªï¼Œè¿å¸¦åšäº†æœ€ç»ˆç»“æœçš„å†³ç­–ã€‚</p>
<p>å› æ­¤ï¼Œä»æœ€ç»ˆæ•ˆæœåæ¨ï¼Œå†³ç­–é™å™ªæ¨¡å—çš„åˆ‡å…¥æ–¹é¢ï¼Œç»“æœå†³ç­–ä½œä¸ºç»Ÿä¸€çš„ã€ä½å»¶è¿Ÿçš„åå¤„ç†æ¨¡å—ï¼Œè€Œå‘Šè­¦é™å™ªåˆ™ä½œä¸ºå•ç‹¬çš„ã€å®¹å¿é«˜å»¶è¿Ÿçš„è®¡ç®—æ¨¡å—æ¯”è¾ƒåˆé€‚ã€‚ä¸€ä¸ªå˜æ›´è§‚æµ‹ä»»åŠ¡ä¼šäº§å‡ºå¤šä¸ªè§‚æµ‹èƒ½åŠ›çš„å¤šä¸ªé£é™©å‘Šè­¦ï¼Œè¿™äº›é£é™©å‘Šè­¦åœ¨äº§å‡ºåéœ€è¦ç»ç”±ç»“æœå†³ç­–æ¨¡å—åšåå¤„ç†ï¼Œç»“æœå†³ç­–åœ¨åå¤„ç†çš„æ—¶å€™ï¼Œæ ¹æ®æ‰€æœ‰è§‚æµ‹èƒ½åŠ›äº§å‡ºçš„å‘Šè­¦ï¼ŒæŸ¥è¯¢å¯¹åº”é™å™ªæ¨¡å—æ˜¯å¦æœ‰å¯¹åº”çš„é™å™ªç»“æœã€‚æœ‰çš„è¯ï¼Œå°±å¯¹é£é™©å‘Šè­¦å’Œè§‚æµ‹èƒ½åŠ›ç»“è®ºåšå¹²é¢„ï¼Œä»¥æå‡è§‚æµ‹æ•´ä½“çš„å‡†ç¡®ç‡ã€‚</p>
<p>ä¹‹åï¼Œç»“æœå†³ç­–æ¨¡å—ï¼Œåšçš„ç®€å•çš„è¯ï¼Œå¯ä»¥é€šè¿‡çº¿æ€§æˆ–è€…å†³ç­–æ ‘çš„æ–¹å¼å¯¹ä¸åŒä¸šåŠ¡/èƒ½åŠ›/å‘Šè­¦çš„é™å™ªä¼˜å…ˆçº§åšé…ç½®ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå®ç°å¯¹ä¸åŒä¸šåŠ¡åœºæ™¯çš„å®šåˆ¶åŒ–é™å™ªï¼Œå¤æ‚çš„è¯å¯ä»¥æ”¯æŒå¹³å°åŒ–ä½ä»£ç çš„é™å™ªç­–ç•¥é…ç½®ï¼Œè¿™æ ·ä¸šåŠ¡å¯ä»¥è‡ªä¸»åšä¸€äº›ç­–ç•¥æ¥å…¥ã€‚å‘Šè­¦é™å™ªå®ç°æ¨¡å—çš„è¯ï¼Œä»ä¸å½±å“æ­£å¸¸å˜æ›´è§‚æµ‹ä»»åŠ¡çš„è°ƒåº¦è€ƒè™‘ï¼Œå¯ä»¥åšæˆå¼‚æ­¥é™å™ªã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé™å™ªæ¨¡å—èƒ½å¤Ÿå®æ—¶æ„ŸçŸ¥å˜æ›´è§‚æµ‹ä»»åŠ¡çš„ä¸Šä¸‹æ–‡ï¼Œä¸”å½“æŸå˜æ›´è§‚æµ‹èƒ½åŠ›äº§å‡ºæ–°çš„å‘Šè­¦æ—¶å€™ï¼Œç«‹å³å¯¹æ–°çš„å‘Šè­¦æ•°æ®åšåˆ†æï¼Œå‘èµ·ä¸€ä¸ªåˆ†é’Ÿçº§çš„ä»»åŠ¡ï¼Œåˆ¤æ–­å¯¹å•æ¡å‘Šè­¦ä»¥åŠå˜æ›´è§‚æµ‹ç»“è®ºæ˜¯å¦éƒ½åšé™çº§ã€‚åŒæ—¶ï¼Œé™å™ªæ¨¡å—éœ€è¦ç»™å†³ç­–æ¨¡å—æä¾›ä¸€ä¸ªæ¥å£ï¼Œä»¥ä¾›è·å–å½“å‰è§‚æµ‹ä»»åŠ¡å…·å¤‡æ—¶æ•ˆæ€§çš„é™å™ªç»“æœé›†ï¼Œè¿™æ ·ä»å†³ç­–æ¨¡å—è§’åº¦ï¼Œè·å–çš„æ•°æ®ä¹Ÿæ˜¯ç½®ä¿¡çš„ï¼Œè€Œé™å™ªæ•°æ®çš„æ—¶æ•ˆæ€§åˆ™ç»Ÿä¸€ç”±å¤–æŒ‚çš„é™å™ªæ¨¡å—åšä¿éšœã€‚</p>
<p>æœ€åï¼Œå¦‚æœè¦è¯„ä¼°æŸä¸ªé™å™ªèƒ½åŠ›çš„æ•ˆæœï¼Œé™å™ªèƒ½åŠ›çš„ç°åº¦æ”¾é‡ã€å®æ—¶æ‰“ç‚¹ï¼Œä»¥åŠäº§å“æ–¹é¢å‘Šè­¦æœ‰æ•ˆæ€§æ‰“æ ‡ã€é™å™ªç»“è®ºåº¦é‡çœ‹æ¿ç­‰èƒ½åŠ›ä¹Ÿæ˜¯ä¸å¯å°‘çš„ã€‚æ‹¥æœ‰è¿™äº›æŠ€æœ¯åŸºå»ºï¼Œæ‰å¯ä»¥è®©å˜æ›´é˜²æ§é™å™ªæ¨¡å—å‘æŒ¥æ›´å¤šä»·å€¼ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>ç¨³å®šæ€§</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘é€šè¿‡æ ‡å‡†åŒ–äº‹ä»¶è§£å†³å˜æ›´æ£€æµ‹èƒ½åŠ›çš„è°ƒåº¦é—®é¢˜</title>
    <url>/2025/09/06/archiart/change_control_schedule_event/</url>
    <content><![CDATA[<p>åœ¨å˜æ›´é£é™©è§‚æµ‹ä»»åŠ¡è°ƒåº¦è¿‡ç¨‹å½“ä¸­ï¼Œå¦‚ä½•è®©ä¸€ä¸ªè§‚æµ‹ä»»åŠ¡åœ¨åˆé€‚çš„æ—¶é—´ç‚¹è°ƒç”¨åˆé€‚çš„å˜æ›´é˜²æ§èƒ½åŠ›ï¼Œç¡®ä¿åœ¨å˜æ›´è¿‡ç¨‹ä¸­åŠæ—¶å‘ç°å’Œå¤„ç†é£é™©ï¼Œæ˜¯ä»»åŠ¡è°ƒåº¦æ¨¡å—è®¾è®¡æ–¹é¢æ¯”è¾ƒé‡è¦çš„é—®é¢˜ä¹‹ä¸€ã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDMvMDkvYXJjaGlhcnQvY2hhbmdlX29ic2VydmF0aW9uX3dvcmtlci8=" title="https://utmhikari.top/2025/03/09/archiart/change_observation_worker/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­ï¼Œä¹Ÿç®€å•æåˆ°äº†å˜æ›´è§‚æµ‹ä»»åŠ¡è°ƒåº¦çš„åŸºæœ¬è®¾è®¡æ–¹æ³•ã€‚ä½†ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œä¸»è¦å…³æ³¨é€šè¿‡æ ‡å‡†åŒ–äº‹ä»¶çš„æ–¹å¼ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨è§£å†³å˜æ›´æ£€æµ‹èƒ½åŠ›çš„è°ƒåº¦é—®é¢˜ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯ä¸ºä»€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜é€šè¿‡äº‹ä»¶é©±åŠ¨æ¯”è¾ƒåˆé€‚ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€æ˜¯å®ç°æˆæœ¬æ¯”è¾ƒä½ï¼Œå¦ä¸€å—æ˜¯èƒ½å°½å¯èƒ½coveræ›´å¤šçš„ä¸šåŠ¡åœºæ™¯ã€‚é¦–å…ˆæ˜¯å®ç°æˆæœ¬æ–¹é¢ï¼Œå•ä¸ªä»»åŠ¡çš„æ‰€æœ‰ä¸­é—´äº‹ä»¶éƒ½å¯ä»¥æ”¾åˆ°åŸºäºredisçš„äº‹ä»¶æ€»çº¿å½“ä¸­ï¼Œå¦‚æœredisçš„ç¼“å­˜é‡å’Œååé‡è¶³å¤Ÿå¤§çš„è¯ï¼Œåªéœ€è¦å¯¹æ¯ä¸ªä»»åŠ¡çš„äº‹ä»¶contextåšé€»è¾‘éš”ç¦»ï¼Œå°±å¯ä»¥æ»¡è¶³éœ€æ±‚ã€‚åœ¨ç¬”è€…çš„å®æˆ˜åœºæ™¯ä¸‹ï¼Œä»»åŠ¡è°ƒåº¦æ¨¡å—åªæœ‰ä¸€ä¸¤ä¸ªäººåšæŒç»­ç»´æŠ¤ï¼Œé‚£ä¹ˆè¿™ç§å®ç°æ–¹å¼å°±æ˜¯éå¸¸åˆé€‚çš„ã€‚</p>
<p>ç„¶åæ˜¯ä¸šåŠ¡åœºæ™¯çš„coverã€‚å¯¹äºå•ä¸ªå˜æ›´è§‚æµ‹ä»»åŠ¡ï¼Œæˆ–è€…å¹¿ä¹‰è®²å˜æ›´è§‚æµ‹å…³è”çš„æµ‹è¯•ç±»ã€ç›‘æ§ç±»ä»¥åŠå‘Šè­¦é™å™ªç±»ä»»åŠ¡ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¸€å¥—åŸºäºäº‹ä»¶è°ƒåº¦çš„ç³»ç»Ÿåšæ§åˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œå•ä¸ªè§‚æµ‹èƒ½åŠ›æ‰§è¡Œé…ç½®ï¼Œéœ€è¦æŒ‡å®šå¯åŠ¨å’Œç»ˆæ­¢çš„æ¡ä»¶ï¼Œè€Œå¯åŠ¨ç»ˆæ­¢æ¡ä»¶å†…åœ¨å¯ä»¥é€šè¿‡äº‹ä»¶KVæ¥è¡¨è¾¾ã€‚æ¯”å¦‚ï¼Œå¯¹äºå‘Šè­¦ç›‘å¬ç±»èƒ½åŠ›ï¼Œæˆ‘ä»¬æœŸæœ›åœ¨å˜æ›´æ»šåŠ¨åˆ°50%æ—¶å¯åŠ¨ï¼Œå˜æ›´ç»“æŸ+ç®¡æ§è§‚å¯Ÿæ—¶é•¿ä¹‹ååœæ­¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆå¼€å‘ä¸€ä¸ªå†…ç½®çš„å˜æ›´è¿›åº¦ç›‘æ§èƒ½åŠ›ï¼Œå˜æ›´è¿›åº¦ç›‘æ§èƒ½åŠ›åœ¨å˜æ›´è§‚æµ‹ä»»åŠ¡å¼€å§‹æ—¶å¯åŠ¨ï¼Œäº§å‡ºå˜æ›´è¿›åº¦ç›¸å…³äº‹ä»¶ï¼Œå½“æŸä¸€æ¬¡ä»»åŠ¡æ¨è¿›å‘ç°å˜æ›´æ»šåŠ¨åˆ°50%ä¹‹åï¼Œå°±å¯ä»¥å¯åŠ¨è¿™ä¸ªå‘Šè­¦ç›‘å¬èƒ½åŠ›ã€‚ç»“æŸä¹Ÿæ˜¯ä¸€æ ·ï¼Œæœ‰äº†å˜æ›´è¿›åº¦ç›‘æ§ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å˜æ›´å®Œæˆæ—¶é—´ä»¥åŠç›®å‰è·ç¦»å˜æ›´å®Œæˆçš„åœç•™æ—¶é•¿ï¼Œä»è€Œåœ¨åˆé€‚çš„æ—¶æœºç»“æŸæ‰å‘Šè­¦ç›‘å¬ç±»èƒ½åŠ›ã€‚å¯¹äºå…¶å®ƒèƒ½åŠ›ä¹Ÿæ˜¯ä¸€æ ·ï¼Œé€šè¿‡ä¸æ–­äº§å‡ºäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å †ç§¯å‡ºå½“å‰å˜æ›´è§‚æµ‹è¿›åº¦çŠ¶æ€ï¼Œé€šè¿‡æŒç»­è½®è¯¢æ¨è¿›ï¼Œå°±èƒ½å¤Ÿè®©æ¯ä¸ªèƒ½åŠ›åœ¨åˆé€‚æ—¶æœºå¯åœã€‚</p>
<p>æ€»çš„æ¥è®²ï¼Œé€šè¿‡äº‹ä»¶é©±åŠ¨å’Œæ ‡å‡†åŒ–ç­–ç•¥é…ç½®ï¼Œå˜æ›´é£é™©ä»»åŠ¡è°ƒåº¦èƒ½å¤Ÿçµæ´»æ”¯æŒå„ç§èµ·æ­¢æ¡ä»¶ï¼Œæå‡å˜æ›´è¿‡ç¨‹çš„è‡ªåŠ¨åŒ–å’Œå¯æ§æ€§ã€‚è¿™ä¸ä»…æé«˜äº†æ£€æµ‹ä»»åŠ¡çš„æ‰§è¡Œæ•ˆç‡ï¼Œä¹Ÿä¸ºç³»ç»Ÿå®‰å…¨å’Œç¨³å®šæ€§æä¾›äº†æœ‰åŠ›ä¿éšœã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>äº‹ä»¶å¾ªç¯</tag>
        <tag>å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘ç”¨Cozeç®€å•å¼€å‘ä¸€ä¸ªAgent</title>
    <url>/2025/08/10/geekdaily/develop_agent_by_coze/</url>
    <content><![CDATA[<p>è¿‘æ¥AIå¤§æ¨¡å‹å‘å±•è¿…çŒ›ï¼Œä¸è®ºæ˜¯å·¥ä¸šç•Œè¿˜æ˜¯ç”Ÿæ´»ç•Œéƒ½çº·çº·å¼€å§‹è¿›å†›AIï¼Œäº†è§£åŸºäºLLMçš„é—®ç­”Agentéœ€è¦å¦‚ä½•å¼€å‘ã€‚ä¸ºäº†è·Ÿé£ï¼Œç¬”è€…ä¹Ÿç²—æµ…äº†è§£äº†ä¸‹é—®ç­”Agentå¼€å‘çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œç®€å•å¼€å‘äº†ä¸€ä¸ªä¸»è¦å…³æ³¨Pythoné—®ç­”çš„Agentï¼ŒæŒ‚åœ¨äº†è‡ªå·±çš„å¾®ä¿¡å…¬ä¼—å·ä¸Šã€‚</p>
<p>è¦å¼€å‘ä¸€ä¸ªé—®ç­”Agentä¹Ÿå¾ˆç®€å•ï¼Œé‡è¦çš„æ˜¯å¾—æ¸…æ¥šä¸€äº›æœ¬è´¨ï¼š</p>
<a id="more"></a>
<ul>
<li>é—®ç­”Agentå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼š<code>func(userInput string) (chatOutput string)</code>ã€‚</li>
<li>å‡½æ•°ä¸­é—´çš„å¤„ç†è¿‡ç¨‹å¯ä»¥ç”±çº¯è‡ªç„¶è¯­è¨€æè¿°ï¼ˆPrompt As ByteCodeï¼‰ï¼Œä¹Ÿå¯ä»¥æŠ½è±¡æˆç»“æ„åŒ–çš„å›¾å½¢å¼ï¼ˆCompose Graphï¼‰ã€‚å›¾èŠ‚ç‚¹é‡Œé¢å¯ä»¥å¹²ä»»ä½•äº‹æƒ…ï¼Œä¸ç®¡æ˜¯è°ƒç”¨å…¶å®ƒå¤§æ¨¡å‹ã€å¤–éƒ¨æ¥å£ï¼ˆMCPï¼‰ç”šè‡³æ˜¯è°ƒç”¨å¤–éƒ¨Agentéƒ½æ˜¯å¯ä»¥çš„ã€‚</li>
<li>è¦è®©chatOutputè´¨é‡æ›´å¥½ï¼Œå…œåº•è¿˜æ˜¯è¦äº§å‡ºæ›´å¤šçš„ä¸­é—´æ•°æ®ï¼Œè®©chatOutputèƒ½å¤Ÿå……åˆ†ç†è§£æ•´åˆä¸Šä¸‹æ–‡ã€‚ä¸­é—´æ•°æ®å¯ä»¥è‡ªäº§è‡ªé”€ï¼ˆReActï¼‰ï¼Œå…ˆè‡ªå·±æ·±å…¥æ‹†è§£é—®é¢˜ï¼Œå†æ¯ä¸ªå„ä¸ªå‡»ç ´ï¼Œæœ€åè‡ªå·±å†æ•´åˆã€‚</li>
</ul>
<p>ä¹‹åå°±å¯ä»¥å¼€å§‹å¼€å‘äº†ã€‚ç¬”è€…é‡‡ç”¨Cozeå¹³å°å¼€å‘ï¼Œè¿›åˆ°é¡¹ç›®é‡Œé¢åˆ›å»ºä¸€ä¸ªAgentå°±å¯ä»¥åŠ¨æ‰‹äº†ã€‚é‡Œé¢æœ‰å‡ ä¸ªä¸»è¦æ ç›®ï¼š</p>
<ul>
<li>äººè®¾ä¸å›å¤é€»è¾‘ï¼ˆMain Promptï¼‰ï¼šæœ¬è´¨ä¸Šå°±æ˜¯è®©ä½ ç”¨è‡ªç„¶è¯­è¨€æè¿°é—®ç­”AgentèŒè´£æ˜¯ä»€ä¹ˆï¼Œå·¥ä½œä¸»æµç¨‹æ˜¯ä»€ä¹ˆï¼Œå¯¹é—®ç­”AgentåšåŸºæœ¬çº¦æŸã€‚</li>
<li>æ¨¡å‹ï¼šç”¨äºç†è§£è‡ªç„¶è¯­è¨€å¹¶åå‡ºå›å¤ï¼Œæœ‰æ–°é€‰æ–°ï¼Œè¿™æ ·å›å¤çš„å†…å®¹èƒ½å’Œå’±ä»¬çš„é¢„æœŸæ›´åŠ ä¸€è‡´ã€‚å¦‚æœè¦å¿«é€Ÿå›ç­”å°±è°¨æ…é€‰æ‹©æ·±åº¦æ¨ç†ã€‚</li>
<li>æ’ä»¶ï¼šå¯ä»¥ç†è§£æˆå¤–éƒ¨æ¥å£ï¼Œç›´æ¥æŸ¥å¤–éƒ¨èµ„æ–™ï¼Œè·å–ç»“æ„åŒ–çš„æ•°æ®</li>
<li>å·¥ä½œæµï¼šç”¨å›¾æè¿°çš„è‡ªç„¶è¯­è¨€è¾“å…¥è¾“å‡ºï¼Œé…åˆäº†ä¸ªä½ä»£ç ç¼–è¾‘å™¨ï¼Œç©è¿‡UE4/UE5çš„åŒå­¦éƒ½ä¸ä¼šé™Œç”Ÿã€‚å¦‚æœå·æ‡’çš„è¯ï¼Œå…¶å®åœ¨Main Prompté‡Œï¼Œå¼ºè¡Œè®©Agentç”¨ä½ çš„å·¥ä½œæµæ‰§è¡Œå·¥ä½œä¸»æµç¨‹å°±è¡Œã€‚</li>
<li>çŸ¥è¯†ï¼šå¯ä»¥ç”¨æ¥çº¦æŸAgentåœ¨ç‰¹å®šé—®é¢˜æ¡ä»¶ä¸‹è·å–åˆ°çš„çŸ¥è¯†ï¼Œé˜²æ­¢çŸ¥è¯†æ±¡æŸ“ã€‚</li>
<li>è®°å¿†ï¼šå¦‚æœæŠŠAgentå½“åšä¸€ä¸ªåå°æœåŠ¡çš„è¯ï¼Œè¿™ä¸ªæ¨¡å—æä¾›äº†æ•°æ®æŒä¹…åŒ–ä»¥åŠå•æ¬¡å¯¹è¯ä¸­ç¼“å­˜ä¸Šä¸‹æ–‡å˜é‡çš„èƒ½åŠ›ã€‚</li>
<li>å¯¹è¯ä½“éªŒï¼šä¸»è¦ä¼˜åŒ–Agentå›ç­”çš„èˆ’é€‚åº¦ï¼Œæä¾›æ›´å¤šæƒ…ç»ªä»·å€¼ã€‚</li>
</ul>
<p>ç»“åˆè¿™äº›æ¨¡å—ä¹‹åï¼Œå¼€å‘ä¸€ä¸ªç®€å•çš„Agentä¹Ÿä¸éš¾ã€‚Cozeé‡Œé¢æœ‰è‡ªå¸¦é¢„è§ˆè°ƒè¯•ï¼Œå¦‚æœä¸“ä¸šä¸€ç‚¹çš„è¯ä¹Ÿæœ‰Promptè¯„æµ‹ç³»ç»Ÿç”¨æ¥ç®¡ç†å˜æ›´è´¨é‡ï¼ˆè¯„æµ‹çš„è¯ä¹Ÿæ˜¯ç”¨å¤§æ¨¡å‹+Promptç›´æ¥åšç†è§£æ‰“åˆ†ï¼Œéå¸¸æ–¹ä¾¿ï¼‰ã€‚å‘å¸ƒçš„è¯ï¼ŒCozeä¹Ÿæ”¯æŒè‡ªå·±å¹³å°ã€è±†åŒ…ï¼Œç”šè‡³æ˜¯å¾®ä¿¡å…¬ä¼—å·çš„åˆ†å‘æ¸ é“ã€‚ç¬”è€…å¼€å‘çš„Pythoné—®ç­”Agentåœ¨Cozeå¹³å°å¯ä»¥é€šè¿‡<span class="exturl" data-url="aHR0cHM6Ly93d3cuY296ZS5jbi9zL2RqanFiZjd0dVBvLw==" title="https://www.coze.cn/s/djjqbf7tuPo/">è¿™ä¸ªé“¾æ¥<i class="fa fa-external-link"></i></span>è®¿é—®ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å’ŒTAå” å” å—‘ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>AI</tag>
        <tag>Agent</tag>
        <tag>LLM</tag>
        <tag>coze</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘Promptå¼€å‘è¯„æµ‹å¹³å°CozeLoopè¸©å‘ä½“éªŒ</title>
    <url>/2025/08/03/githubdiscovery/coze_loop/</url>
    <content><![CDATA[<p>æ¥ç»­<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDgvMDMvZ2l0aHViZGlzY292ZXJ5L2NvemVfc3R1ZGlvLw==" title="https://utmhikari.top/2025/08/03/githubdiscovery/coze_studio/">å…ˆå‰CozeStudioçš„æ–‡ç« <i class="fa fa-external-link"></i></span>ï¼ŒCozeLoopç›¸å¯¹äºCozeStudioï¼Œæ›´åŠ ä¸“æ³¨äºPrompt Engineeringï¼Œæ‰“ç£¨æ•´ä¸ªAgent Promptçš„æ•ˆæœã€‚å› æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« ä¹Ÿåˆ†äº«ä¸€ä¸‹ç¬”è€…ä½¿ç”¨CozeLoopçš„ä½“éªŒï¼Œæºç å¯ä»¥ä»<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvemUtZGV2L2NvemUtbG9vcA==" title="https://github.com/coze-dev/coze-loop">è¿™ä¸ªRepo<i class="fa fa-external-link"></i></span>é‡Œé¢æ‹‰å–ã€‚</p>
<a id="more"></a>
<p>CozeLoopä¹Ÿé‡‡ç”¨DDDçš„èŒƒå¼ï¼Œä½†å’ŒCozeStudioç¨å¾®æœ‰åŒºåˆ«ã€‚CozeLoopåˆ†ä¸ºapiã€moduleså’Œinfraä¸‰å¤§å±‚ï¼Œä½†åœ¨modulesé‡Œé¢å°±åŒ…å«äº†è¯„æµ‹é›†ã€è¯„æµ‹å®éªŒã€LLMã€traceç­‰æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä¸‹é¢å°±æœ‰æ¯”è¾ƒæ¸…æ™°çš„appã€domainã€infraçš„åˆ’åˆ†äº†ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šè¿˜æ˜¯ç¬¦åˆDDDçš„èŒƒå¼çš„ã€‚</p>
<p>éƒ¨ç½²æ–¹é¢æ¯”è¾ƒå‘ï¼ŒCozeLoopæ²¡æœ‰CozeStudioé‚£æ ·å¼€æºçš„æ•ˆæœå¥½ï¼Œç¬”è€…æŠ˜è…¾äº†å¾ˆä¹…æ‰åœ¨æœ¬åœ°è·‘èµ·æ¥æœåŠ¡ã€‚ä¸»è¦é‡åˆ°äº†å‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ä¸»æœºç”¨macï¼Œä½†æœåŠ¡éœ€è¦éƒ¨ç½²åœ¨linux/amd64çš„æœåŠ¡ä¸­ï¼Œéœ€è¦åœ¨Dockerfileä»¥åŠå„ä¸ªå®‰è£…è„šæœ¬é‡Œé¢åšå…¼å®¹ï¼Œæ¯”å¦‚æŒ‡å®šæ¶æ„platformã€å–æ¶ˆCGOç­‰ï¼Œé˜²æ­¢æŒ‡ä»¤é›†ä¸å…¼å®¹ï¼›</li>
<li>MySQLç¼ºå°‘é»˜è®¤DBï¼Œè¿™ä¸ªéœ€è¦æŸ¥ä¸‹issueç„¶åæ–°å¢ä¸ªsql+æ›¿æ¢entrypoint.shæ¥è§£å†³ï¼›</li>
<li>cozeloop-brokerèµ·ä¸æ¥ï¼Œè¿™ä¸ªå‘ç°æ˜¯ç¬”è€…è‡ªå·±çš„colimaæ ¸æ•°å¤ªå°‘ï¼ŒåŠ å¤§æ ¸æ•°è°ƒå¤§sleepè§£å†³äº†ã€‚</li>
</ul>
<p>å¼€å‘æ–¹é¢ï¼ŒCozeLoopå…ˆæ˜¯æä¾›äº†ä¸€ä¸ªPromptè°ƒè¯•ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°Promptçš„è¿è¡Œç»“æœï¼Œä¹Ÿæœ‰å¯¹æ¯”åŠŸèƒ½çœ‹ä¸åŒæ¨¡å‹ä¸åŒPromptå¯¹åŒä¸€ä¸ªé—®é¢˜çš„æ•ˆæœã€‚ç„¶åè¯„æµ‹æ–¹é¢ï¼Œæä¾›äº†è¯„æµ‹é›†/è¯„ä¼°å™¨ç®¡ç†ä»¥åŠå®éªŒä»»åŠ¡ç­‰åŠŸèƒ½ã€‚ä»è¯„ä¼°å™¨è§’åº¦æ¥çœ‹ï¼Œè¯„ä¼°å™¨çš„Promptéœ€è¦æœ‰è¯„æµ‹inputã€é¢„æœŸoutputä»¥åŠå®é™…outputçš„è¾“å…¥ï¼Œè€Œè¢«è¯„ä¼°çš„Promptå¿…é¡»å¾—è®¾ç½®ä¸€ä¸ªå˜é‡ï¼Œå¼•ç”¨è¯„æµ‹é›†çš„inputï¼Œæ‰èƒ½è®©Promptäº†è§£åˆ°æ¯ä¸€æ¬¡è¦è¯„æµ‹å“ªä¸ªè¾“å…¥ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå†™ä¸€ä¸ªé¢å‘è¯„æµ‹çš„Promptï¼‰ã€‚å®éªŒçš„è¿‡ç¨‹ä¹Ÿæ˜¯submitä»»åŠ¡ï¼Œåˆ›å»ºä»»åŠ¡è®°å½•åï¼Œæ¯æ¡è¯„æµ‹å°±å¼€å§‹è‡ªå·±åœ¨MQé‡Œé¢Loopï¼Œæ¨è¿›ç»“æœäº†ã€‚ç”±äºæ³¨å…¥å˜é‡è¿™ä¸ªäº‹æƒ…å®˜æ–¹æ–‡æ¡£è®²çš„ä¹Ÿä¸è¯¦ç»†ï¼Œä¹Ÿè¸©äº†ä¸€äº›å‘ï¼Œå®é™…è°ƒè¯•çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æ¯ä¸ªæµ‹è¯•çš„Traceç»“æœï¼Œæ¥åˆ¤æ–­å®éªŒæ˜¯å¦æŒ‰ç…§é¢„æœŸæ‰§è¡Œã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>Agent</tag>
        <tag>Coze</tag>
        <tag>DDD</tag>
        <tag>Prompt</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘Agentå¼€å‘å¹³å°CozeStudioå¼€æºç‰ˆæœ¬è¸©å‘ä½“éªŒ</title>
    <url>/2025/08/03/githubdiscovery/coze_studio/</url>
    <content><![CDATA[<p>è¿‘æœŸCozeå¼€æºäº†è‡ªå·±çš„æ ¸å¿ƒäº§å“CozeStudioå’ŒCozeLoopï¼ŒCozeStudioä¸»è¦é¢å‘AI-Agentäº§å“å¼€å‘å’Œå‘¨è¾¹ç”Ÿæ€ï¼Œè€ŒCozeLoopä¸»è¦é¢å‘Prompt Engineeringä»¥åŠæ•ˆæœè¯„æµ‹ã€‚å€Ÿè¿™ä¸ªæœºä¼šï¼Œç¬”è€…ä¹Ÿè¸©å‘äº†ä¸‹CozeStudioå’ŒCozeLoopçš„æºç ï¼Œåœ¨æœ¬åœ°åšäº†éƒ¨ç½²ç®€å•ç©è½¬äº†ä¸‹ï¼Œä¹Ÿé¡ºå¸¦äº†è§£äº†ä¸‹CozeStudioè·ŸCozeLoopçš„ä¸€äº›äº§å“åŸç†ã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« å°±å…ˆåˆ†äº«ä¸€ä¸‹CozeStudioçš„è¸©å‘ä½“éªŒï¼Œæºç å¯ä»¥ä»<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2NvemUtZGV2L2NvemUtc3R1ZGlv" title="https://github.com/coze-dev/coze-studio">è¿™ä¸ªRepo<i class="fa fa-external-link"></i></span>é‡Œé¢æ‹‰å–ã€‚</p>
<a id="more"></a>
<p>CozeStudioé‡‡ç”¨DDDèŒƒå¼ç¼–ç ï¼Œæ•´ä¸ªåç«¯æ¡†æ¶åˆ†æˆapiã€appã€domainã€crossdomainä»¥åŠinfraç­‰å‡ å±‚ã€‚è¦éƒ¨ç½²åç«¯æœåŠ¡çš„è¯ï¼Œç”±äºCozeStudioé‡‡ç”¨DockerComposeï¼Œå› æ­¤éœ€è¦æœ‰Dockerä»¥åŠç›¸å…³ç¯å¢ƒã€‚è¿™é‡Œç¬”è€…ç”±äºç”¨çš„æ˜¯Macbookï¼Œä¸”ç”¨çš„å…¬å¸ç”µè„‘è¯•æ°´ï¼Œå› æ­¤é‡‡ç”¨Docker+Colimaçš„é€‰æ‹©ï¼Œè®©CozeStudioèƒ½åœ¨Macä¸Šé¢è·‘èµ·æ¥ã€‚å¦‚æœéœ€è¦è°ƒè¯•ä»£ç çš„è¯ï¼ŒCozeStudioä¹Ÿæä¾›äº†æ¯”è¾ƒç»†è‡´çš„æ–‡æ¡£æŒ‡å¼•ï¼Œæ”¹äº†ä»£ç åmake debugä¸€ä¸‹å°±èƒ½æå®šã€‚å½“ç„¶å¦‚æœè¦ç›´æ¥å¥—ç”¨å¼€å‘çš„è¯ï¼Œå»ºè®®è¿˜æ˜¯å»ºå¤§å›¢é˜Ÿå¼€å‘æ¯”è¾ƒé€‚åˆï¼Œå› ä¸ºçº¯DDDèŒƒå¼çš„ç¼–ç å±‚æ¬¡ç»“æ„è¾¹ç•Œå¤ªå¼ºï¼Œäººå°‘äº†è¿­ä»£ä¼šå¾ˆæ…¢ã€‚</p>
<p>CozeStudioé‡Œé¢çš„å†…å®¹ä¸»è¦æ˜¯é¢å‘Agentå¼€å‘ä¸šåŠ¡çš„ã€‚è¦å¼€å‘ä¸€ä¸ªAgentçš„è¯ï¼ŒCozeStudioä¼šä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªSystem Promptï¼Œç„¶åé™„å¸¦ä¸€äº›å·¥å…·é“¾ï¼ŒåŒ…æ‹¬æ’ä»¶ï¼ˆä¸æ”¯æŒMCPï¼Œä½†ç±»ä¼¼ï¼Œå¯ä»¥æè¿°å„ä¸ªå·¥å…·ä»¥åŠæ‰“æ ‡è¿”å›æ•°æ®ï¼‰ã€Eino Based Workflowã€çŸ¥è¯†åº“ï¼ˆæ–‡æœ¬/è¡¨æ ¼ç­‰ï¼‰ä»¥åŠè®°å¿†æ¨¡å—ï¼ˆå˜é‡ï¼‰ç­‰å†…å®¹ã€‚å½“ç„¶å…¶ä¸­ä¸è®ºæ˜¯Agentè°ƒè¯•è¿˜æ˜¯çŸ¥è¯†åº“æŒä¹…åŒ–éƒ½æ˜¯éœ€è¦æ¨ç†è·ŸEmbeddingæ¨¡å‹æ”¯æŒçš„ï¼Œè¿™é‡Œç¬”è€…å°±å€ŸåŠ©äº†å…¬å¸ä¾¿åˆ©ï¼Œç”¨äº†ç«å±±äº‘çš„ç›¸å…³åŸºå»ºæ¥æ»¡è¶³éœ€æ±‚ã€‚</p>
<p>å¦‚æœæŠŠè‡ªç„¶è¯­è¨€Promptç†è§£æˆAgentçš„å­—èŠ‚ç çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªAgentå…¶å®ä¹Ÿå¯ä»¥çœ‹åšæˆä¸€ä¸ªå¤§Promptï¼Œä½†å¦‚æœä½ å¸Œæœ›è®©Agenté€»è¾‘æ›´åŠ å¯æ§çš„è¯ï¼Œä¹Ÿå¯ä»¥æŠŠä¸»æµç¨‹æŠ½è±¡æˆWorkflowï¼Œç„¶ååœ¨System Prompté‡Œé¢è¦æ±‚å¤§æ¨¡å‹ç›´æ¥è°ƒç”¨Workflowè§£å†³ç”¨æˆ·é—®é¢˜ã€‚ä»æºç ä¸Šæ¥çœ‹ï¼Œã€ŒSystemPrompt+å„ç±»å·¥å…·èƒ½åŠ›ã€è¿™ä¸ªäº‹æƒ…ï¼Œæœ¬èº«ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªç¡¬ç¼–ç çš„ComposeGraphæ¥å®ç°çš„ã€‚å¦‚æœä½ å‘å¸ƒäº†Agentï¼Œè°ƒç”¨äº†Chatæ¥å£ï¼Œå…¶å·¥ä½œæµç¨‹ä¼šæ˜¯è¿™æ ·ï¼š</p>
<ul>
<li>å»ºç«‹SSEè¿æ¥</li>
<li>OpenapiAgentRunï¼šè·å–Agentä¿¡æ¯ï¼Œç¡®è®¤æ˜¯å¦å·²æœ‰/æ–°å¢ç”¨æˆ·ä¼šè¯ï¼Œç„¶åå°è¯•æ‰§è¡ŒAgent</li>
<li>AgentRunï¼šè·å–Agentå†å²ï¼Œç»™SSEè¿”å›é—®ç­”åˆ›å»º/è¿›è¡Œä¸­ä»¥åŠAckç­‰Messageï¼Œç„¶åå¼€å§‹æ¨ç†æ¶ˆæ¯</li>
<li>StreamExecuteï¼šç¡¬ç¼–ç Composeä¸€ä¸ªGraphï¼ŒæŠŠæ¨¡å‹å’ŒPromptã€å˜é‡ä»¥åŠçŸ¥è¯†åº“/æ’ä»¶/Workflowçš„Retrieverç»™ç»‘å®šèµ·æ¥ï¼Œæ„é€ ä¸€ä¸ªReAct+Suggestionçš„äº¤äº’æµç¨‹ï¼Œç„¶åæ‰§è¡Œæ•´ä¸ªGraphï¼Œä¸æ–­ç»™SSEè¿”å›Messageæ•°æ®ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>Agent</tag>
        <tag>Coze</tag>
        <tag>DDD</tag>
        <tag>LLM</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘åç«¯ä»»åŠ¡åŠ¨æ€æ³¨å…¥æ‰§è¡Œç­–ç•¥çš„ä¸€ç§æŠ€æœ¯å®ç°</title>
    <url>/2025/07/12/geekdaily/dynamic_job_impl/</url>
    <content><![CDATA[<p>è¿‘æœŸåšé¡¹ç›®æ—¶é‡åˆ°ä¸€ä¸ªåœºæ™¯ï¼Œæ˜¯éœ€è¦åœ¨åç«¯ä»»åŠ¡æ‰§è¡Œæ—¶åŠ¨æ€æ³¨å…¥ç­–ç•¥ã€‚å…·ä½“è€Œè¨€ï¼Œç¬”è€…è´Ÿè´£çš„åç«¯æœåŠ¡ï¼Œå¯ä»¥ç†è§£æ˜¯ä¼šåœ¨çº¿ä¸ŠæœåŠ¡å‘å¸ƒæ—¶ï¼Œå¯¹æœåŠ¡é£é™©åšå®æ—¶æ‰«æï¼Œé‚£ä¹ˆè¿™ä¸ªæ‰«æå°±éœ€è¦æ ¹æ®å½“å‰çº¿ä¸ŠæœåŠ¡å‘å¸ƒä¸Šä¸‹æ–‡ï¼ŒåŒ¹é…å¯¹åº”çš„ç­–ç•¥ã€‚ä½†è¿™é‡Œæ‰«å‡ºæ¥çš„ç­–ç•¥éƒ½æ˜¯é™æ€æŒä¹…åŒ–çš„ï¼Œå‰ç«¯ä¹Ÿæœ‰äº§å“åŒ–çš„é…ç½®ï¼Œè€Œæœ‰äº›ä¸šåŠ¡åˆ™å¸Œæœ›èƒ½å¤Ÿåœ¨ä»»åŠ¡æ‰§è¡Œæ—¶ï¼ŒåŠ¨æ€æ³¨å…¥ä¸€äº›ä¸šåŠ¡è‡ªå·±ç†è§£éœ€è¦çš„æ‰«æç­–ç•¥ï¼Œä¸åœ¨å‰ç«¯åšé™æ€é…ç½®ã€‚</p>
<p>å¯¹äºè¿™ç±»å®šåˆ¶åŒ–éœ€æ±‚ï¼Œç¬”è€…æƒ³åˆ°çš„ä¸€ç§æ¯”è¾ƒä½æˆæœ¬å®ç°çš„æ–¹å¼æ˜¯è¿™æ ·çš„ï¼š</p>
<a id="more"></a>
<p>é¦–å…ˆè¿™ç±»åŠ¨æ€ç”Ÿæˆçš„ç­–ç•¥è¿˜æ˜¯éœ€è¦æŒä¹…åŒ–çš„ï¼Œä½†ä¸éœ€è¦åœ¨å‰ç«¯åšäº§å“åŒ–ï¼Œåªä¸è¿‡åç«¯æŸ¥é…ç½®çš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸€å®šçš„é€»è¾‘è¯†åˆ«å‡ºæ¥å“ªäº›ç­–ç•¥æ˜¯é™æ€é…ç½®ï¼Œå“ªäº›ç­–ç•¥æ˜¯åŠ¨æ€ç”Ÿæˆã€‚å…·ä½“çš„è¯†åˆ«é€»è¾‘æ€ä¹ˆåšï¼Œä¸€ä¸ªè§£æ³•å°±å›æº¯åˆ°åˆšè¿›å¤§å­¦å­¦è®¡ç®—æœºç½‘ç»œé‚£ä¸ªå¹´ä»£ï¼ŒIPæ˜¯æ€ä¹ˆåˆ’åˆ†çš„ï¼Œé‚£ä¹ˆåŠ¨æ€ç­–ç•¥çš„IDå°±å¯ä»¥æ€æ ·åˆ’åˆ†ã€‚</p>
<p>ç„¶åæ˜¯é€‰æ•°å€¼æ®µï¼Œè¿™é‡Œéœ€è¦ç¡®ä¿dbé‡Œé¢idèŒƒå›´å’Œå†…å­˜é‡Œé¢æ•°æ®ç±»å‹æ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚mysqlçš„bigintå¯ä»¥å¯¹åº”ä¸ŠGolangé‡Œé¢int64ï¼Œé‚£ä¹ˆå°±ç¡®ä¿ä¸ä¼šå‡ºç°æ•°å€¼çš„éšå¼è½¬æ¢ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥åƒIPåˆ’åˆ†ä¸€æ ·ï¼Œç»™ä¸€ä¸ªéå¸¸å¤§çš„prefixï¼ˆæ¯”å¦‚0x1234567800000000ï¼‰ä»¥åŠä¸€ä¸ªmaskï¼ˆå¯¹åº”çš„æ˜¯0x7FFFFFFF00000000ï¼‰ï¼Œé‚£ä¹ˆåªè¦æœ‰ä¸€ä¸ªIDï¼Œå°±å¯ä»¥æ ¹æ®prefixå’Œmaskåˆ¤æ–­è¿™ä¸ªIDæ˜¯åŠ¨æ€ç­–ç•¥çš„è¿˜æ˜¯é™æ€ç­–ç•¥çš„ï¼Œå¹¶ä¸”æœ‰äº†prefixï¼ŒåŠ¨æ€ç­–ç•¥IDå’Œè½åº“ä¸»é”®IDä¹Ÿå¯ä»¥ç›¸äº’è½¬åŒ–ã€‚</p>
<p>æœ€åå¯¹äºæ•´ä¸ªç³»ç»Ÿï¼Œæ ¹æ®IDå»CRUDæ‰§è¡Œç­–ç•¥çš„é€»è¾‘éƒ½éœ€è¦åšå˜æ¢ï¼Œéœ€è¦å…ˆæ ¡éªŒæ˜¯åŠ¨æ€ç­–ç•¥è¿˜æ˜¯é™æ€ç­–ç•¥ï¼Œç„¶åå†èµ°å¯¹åº”çš„åˆ†æ”¯é€»è¾‘ã€‚å¦åˆ™ä¼šå‡ºç°é—®é¢˜ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>è®¡ç®—æœºç½‘ç»œ</tag>
        <tag>ä¸šåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘é€¸å‰‘é£äº‘å†³çƒŸå°˜å›å“+æ­¦å®¶æ—§äº‹+ç¢§æµ·ä»™è¸ªDLCæ”»ç•¥æ•´åˆ</title>
    <url>/2025/07/12/diymemo/wandering_sword_tactic/</url>
    <content><![CDATA[<p>ã€Šé€¸å‰‘é£äº‘å†³ã€‹ç®—æ˜¯ç¬”è€…è®¤ä¸ºè¿‘10å¹´æœ€å¥½çš„å›½äº§æ¸¸æˆä¹‹ä¸€ï¼Œä¸äºšäºé»‘ç¥è¯ã€‚ä»24å¹´å¼€å§‹ç¬”è€…å·²ç»ç©äº†å¾ˆå¤šä¸ªå‘¨ç›®ï¼Œç”šè‡³é»‘ç¥è¯ä¹Ÿæ²¡ç©ï¼Œç»ˆç©¶è¿˜æ˜¯å› ä¸ºã€Šé€¸å‰‘é£äº‘å†³ã€‹æœ¬æ ¼çš„æ­¦ä¾ é£æ ¼ç¡®å®å¯¹åˆ°äº†ç¬”è€…çš„èƒƒå£ï¼Œå¹¶ä¸”ç”¨UE4åšçš„æ•ˆæœä¹Ÿè¿˜ä¸é”™ã€‚ä»Šå¹´æ–°å‡ºäº†2ä¸ªDLCï¼Œä¹Ÿå€’é€¼ç¬”è€…é‡æ–°å¼€äº†ä¸€å‘¨ç›®ï¼Œç´ éºŸçŒ–ç—ï¼Œæ‰“äº†æ¬¡æéš¾8+31å¨œä¹Œçº¿å®Œæ•´ç»“å±€ï¼Œ204600ç‚¹æ•°ã€‚æœŸé—´å‚è€ƒäº†å¾ˆå¤šæ”»ç•¥ï¼Œè¸©äº†æŒºå¤šå‘ï¼Œå› æ­¤ç¬”è€…ä»Šå¤©å°±ç®€å•åˆ†äº«ä¸€ä¸‹è‡ªå·±çš„æ”»ç•¥æ•´åˆã€‚</p>
<p>é¦–å…ˆå…ˆåˆ—å‡ºç¬”è€…å‚è€ƒè¿‡çš„æ”»ç•¥åˆé›†ï¼ŒåŒ…æ‹¬ï¼š</p>
<a id="more"></a>
<ul>
<li>ã€Œå¼±æ°´ä¸‰åƒæµ®ç”Ÿè‹¥æ¢¦ã€åŒå­¦çš„<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3JlYWQvcmVhZGxpc3Qvcmw3NTk2MTQ=" title="https://www.bilibili.com/read/readlist/rl759614">å‚»ç“œå¼å—ç–†å®Œç¾æ”»ç•¥<i class="fa fa-external-link"></i></span>ï¼›</li>
<li>ã€Œå–»äº•ã€åŒå­¦çš„<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL29wdXMvOTk4MTYyMDM0NjY0MTQ0OTE5" title="https://www.bilibili.com/opus/998162034664144919">ç¢§æµ·ä»™è¸ªå…¨è¦ç‚¹æ”»ç•¥<i class="fa fa-external-link"></i></span>ï¼›</li>
<li>ã€Œæ²³å›¾ä¸æ´›ä¹¦ã€åŒå­¦çš„<span class="exturl" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vMTA1MDA0NTgvdXBsb2FkL29wdXM=" title="https://space.bilibili.com/10500458/upload/opus">æ”»ç•¥åˆé›†<i class="fa fa-external-link"></i></span>ï¼Œç¢§æµ·ä»™è¸ªã€æ­¦å®¶æ—§äº‹å’ŒçƒŸå°˜å›å“éƒ½æœ‰å…¨æµç¨‹çš„è¯¦ç»†æŒ‡å¼•ï¼›</li>
<li>ã€Œè™šé¥®èŒ¶ã€åŒå­¦çš„<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL29wdXMvOTE5NzY4Njk4MTQxNTQwMzUy" title="https://www.bilibili.com/opus/919768698141540352">èŒæ–°æ”»ç•¥å®Œç¾è·¯çº¿<i class="fa fa-external-link"></i></span></li>
</ul>
<p>ç„¶åæ˜¯å„ä¸ªå…³é”®ç‚¹çš„æ‰“æ³•é¡ºåºï¼Œå°¤å…¶å¦‚æœä½ æœ‰å¾ˆå¤šç»§æ‰¿ç‚¹çš„è¯ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ªï¼š</p>
<ul>
<li>æ¢§æ¡æ‘å¼€å±€ + ä¸­åŸå…¨æ”¶é›† + èœƒæ¥¼çˆ¬å¡”è§£é”<ul>
<li>å¼€å±€å¯ä»¥çˆ¬çš„è¯ï¼Œç•™ä¸€ä¸ªã€Œäº”å®èŠ±èœœé…’ã€ä¸è¦å–ï¼Œæ˜¯ä¹å·è¯€è§£é”çš„ä¾èµ–ï¼Œå…¶å®ƒä¾èµ–è¯·æŸ¥æ”»ç•¥</li>
</ul>
</li>
<li>æ´›æ‘+è¿›æ­¦å½“<ul>
<li>è¦ç»ƒç‘¶å§¬çš„è¯ä¹Ÿå¯ä»¥å¡ç¢—å­å±±å‡ºå»ç»ƒ</li>
</ul>
</li>
<li>é—¨æ´¾å…¨åˆ‡ç£‹å…¨æ”¶é›† + èƒ½å…¥çš„é˜Ÿå‹å…¥é˜Ÿ<ul>
<li>åœ¨æ­¥å¾®æœˆå…¥é˜Ÿä»»åŠ¡å‰å…ˆè¦å‰‘æ³•ä¸Š100æ‹¿ç™½çŒ¿å½’é£å‰‘ï¼Œå¦åˆ™åé¢æ²¡æœ‰</li>
<li>å…ˆæ¨è¿›å•ä»™å„¿å’Œå²³å®¶å…„å¦¹ï¼Œä¸è¿›å’Œæ¿®å±±åº„</li>
<li>å¨œä¹Œå’Œå•†ç¥åŒ»æ˜¯ä¸¤æ¡è·¯çº¿ï¼Œè¦ä¸€èµ·æ¨è¿›çš„è¯å¾—ç”¨CheatEngineæˆ–è€…ä¸€ä¿®å¤§å¸ˆåŠ é‡‘èé“å…·</li>
<li>ï¼ˆæš‚æœªéªŒè¯æ˜¯å¦ä¼šç¼ºé˜Ÿå‹å‰§æƒ…ï¼‰æ­¥å¾®æœˆå…¥é˜Ÿåï¼Œç¢§æµ·ä»™è¸ªæ¨åˆ°æ— åå²›åå†å›ä¸­åŸ</li>
</ul>
</li>
<li>æ¸…æ²³æ‘ç–‘äº‘ + å¹³åº·åŸä»»åŠ¡</li>
<li>é›·å®¶æ‘å¤§å‹æ”¯çº¿ + é˜Ÿå‹æ”¶é›†</li>
<li>æ­¦å®¶æ—§äº‹<ul>
<li>äºŒå“ç å…‰å®æ°”æ­¦å™¨åšä¸€ç»„ï¼Œä¸­æœŸå¾ˆå¥½ç”¨</li>
</ul>
</li>
<li>å“å‰‘å¤§ä¼š + ä¸é£å±±</li>
<li>ä¼¤é­‚è°ƒ</li>
<li>éœ¹é›³é—¨</li>
<li>å¤©æ°´ç¥å¯¿<ul>
<li>å®Œäº‹åå…ˆä¸è¦è§£é”äº‘ç›¸å¤ªæï¼Œä¼šskipæ‰ç»®ç½—ç­µ</li>
</ul>
</li>
<li>ç”˜æ³‰è‹¦æ°´<ul>
<li>å®Œç¾å®Œæˆï¼Œä¿è¯æ‹¿åˆ°ç™¾é¸Ÿæœå‡¤æªç§˜ç±ï¼ˆç»§æ‰¿é™¤å¤–ï¼‰ç»™å•ä»™å„¿è§£é”æ¢¨èŠ±æªæ</li>
</ul>
</li>
<li>ç¢§æµ·ä»™è¸ª<ul>
<li>ä¹å·è¯€ç†è®ºä¸Šå½“å‰æ‹¿ä¸åˆ°ï¼Œé¢„è®¡åˆ°æ‰“å¤¹é¦æ—¶å€™æ‰ä¼šæ‹¿åˆ°ï¼Œçˆ¬å¡”å¯ç”¨</li>
</ul>
</li>
<li>ç»®ç½—ç­µ</li>
<li>äº‘ç›¸å¤ªæ<ul>
<li>å¼„å®Œå°±è¦å»å—ç–†äº†ï¼Œæ­¤æ—¶å¯ä»¥çˆ¬çˆ¬å¡”</li>
</ul>
</li>
<li>å—ç–†é£äº‘</li>
<li>çƒŸå°˜å›å“<ul>
<li>æ‰“å¤¹é¦ä¹‹å‰æœ‰ä¸€ä¸ªæ—¶æ®µåªæœ‰å¶é£ä¸åœ¨ï¼Œæ˜¯æœ€æ™šå…¨å‘˜çˆ¬å¡”çš„æ—¶æœº</li>
</ul>
</li>
</ul>
<p>çˆ¬å¡”çš„è¯ç¬”è€…å…ˆå»æ‰31è¿‡çš„ï¼Œç„¶åçˆ¬31çš„å¿ƒæ³•ç§˜ç±åˆ†é…ï¼š</p>
<ul>
<li>å®‡æ–‡é€¸ï¼šé£äº‘+å…³å±±+ç‰é¾™+æ˜¥ç§‹+é¡»è‡¾<ul>
<li>ç§˜ç±ï¼šå‡Œæ³¢å¾®æ­¥</li>
</ul>
</li>
<li>æ­¥å¾®æœˆï¼šé¡»è‡¾+ä¹å·+ç„ç«+å¤©é­”+ç¡æ¢¦<ul>
<li>ç§˜ç±ï¼šç¢ç‰æ‰‹+å¤©å±±æ‹³</li>
</ul>
</li>
<li>å•ä»™å„¿ï¼šå…³å±±+ç‰é¾™+ä¸‡é‡Œ+é¡½çŸ³+å¤§æ¤¿<ul>
<li>è¾“å‡ºçš„è¯å¤§æ¤¿å¯ä»¥ç»™è€ç‡•ï¼Œè‡ªå·±å¸¦ç„ç«</li>
<li>å…³å±±+ç‰é¾™æœ€åè§£é”ï¼Œä¸­æœŸå¯ä»¥ç”¨</li>
</ul>
</li>
<li>ä¸Šå®˜è™¹ï¼šç™½å¸+æ˜¥ç§‹+é¡»è‡¾+ç„ç«+ç¡æ¢¦<ul>
<li>ç§˜ç±ï¼šå¤©å±±å‰‘+é£ä»™å‰‘</li>
<li>ç¬”è€…èµ°äº†å¨œä¹Œçº¿ï¼Œä¸ç®—å®Œå…¨ä½“ï¼Œå®Œå…¨ä½“å¯ä»¥åŠ è¯åœ£</li>
</ul>
</li>
<li>å¸é©¬ç²ï¼šè¾¾æ‘©+æ˜“ç­‹ç»+ç™½å¸+æ··æ²Œ+ç„ç«<ul>
<li>å°‘æ—åˆ€ï¼Œä¸»DPSï¼Œä¹Ÿå¯è€ƒè™‘åŠ ç¦…å®—ä¼é­”åŠŸ</li>
</ul>
</li>
<li>ç‡•æœªè¿˜ï¼šå¾¡é¾™+äº‘ç›¸+æƒ”ç¥+ç„ç«+æ“’é¾™<ul>
<li>ç§˜ç±ï¼šå¤§å¤©é­”æ‰‹</li>
<li>æ¯”è¾ƒè„†ï¼Œå¯ä»¥ä¸Šå¤§æ¤¿</li>
</ul>
</li>
<li>è€æ³æ³ï¼šéŸ¶å+ç­å¯‚+å¸æ˜Ÿ+å…µçƒ½+å¤©èš•<ul>
<li>ä¸»æ§ï¼Œå…ˆé€</li>
</ul>
</li>
</ul>
<p>å½“ç„¶è¿™ä¸ªåˆ†é…ï¼Œæ‰“æ³•ä¸Šä¸»Cè¿˜æ˜¯å®‡æ–‡é€¸ï¼Œå¦‚æœå…¶å®ƒäººCçš„è¯ï¼Œå¯èƒ½æœ‰æ›´åŠ ç»†èŠ‚åˆç†çš„æ‰“æ³•ã€‚éš¾ç‚¹ä¸»è¦æ˜¯ä½›é­”ä¸€å¿µå’Œå¤©äººï¼Œå¤©äººä¸»è¦é™åˆ¶å”å”å’Œé’äº‘çš„å‡ºæ‰‹ï¼Œä½›é­”å…ˆæ‰“å¤¹é¦åæ‰“æ³•ç­å°½ï¼Œæ³¨æ„ç”¨æ˜¥ç§‹ç ´æŠ¤ç›¾å’Œç”¨è¾¾æ‘©ç­‰æ— æ•Œæ‰‹æ®µæŠ—ä¼¤å®³ï¼Œç¢°ç¢°è¿æ°”ç»ˆç©¶è¿˜æ˜¯èƒ½è¿‡ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆ</tag>
        <tag>æ¸¸æˆç­–åˆ’</tag>
        <tag>é€¸å‰‘é£äº‘å†³</tag>
        <tag>UE4</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘ICï¼ˆä¸ªäººè´¡çŒ®è€…ï¼‰è§†è§’ä¸‹äº§å“ç ”å‘è§„åˆ’çš„å®æˆ˜Tips</title>
    <url>/2025/07/06/archiart/ic_development_planning/</url>
    <content><![CDATA[<p>å› å·¥ä½œåŸå› ï¼Œè¿‘æœŸç¬”è€…ä»¥ç›¸å¯¹åICçš„èº«ä»½ï¼Œç‰µå¤´ä¸€ä¸ªä¸¤ä¸ªteamå…±å»ºé¡¹ç›®çš„äº§å“ç ”å‘å·¥ä½œã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç¬”è€…ä¹Ÿç®€å•ç§¯ç´¯äº†ä¸€äº›ICå·¥ä½œçš„ç»éªŒï¼Œè¸©äº†äº›å‘ï¼Œä¹Ÿæœ‰ä¸€ç‚¹é˜¶æ®µæ€§æˆæœã€‚è¿™ç¯‡æ–‡ç« å°±æ ¹æ®è‡ªå·±ç»éªŒèŠèŠä½œä¸ºICè§’è‰²ï¼Œæ€ä¹ˆå»æŠŠæ§æ•´ä¸ªäº§å“ç ”å‘çš„è§„åˆ’å’ŒèŠ‚å¥ï¼Œç»™ä¸€äº›å®æˆ˜å½“ä¸­çš„Tipsã€‚</p>
<p>æ•´ä½“æ¥çœ‹ï¼Œé¦–è¦ä»»åŠ¡æ˜¯äº†è§£è‡ªå·±è§’è‰²éœ€è¦åšäº›ä»€ä¹ˆå»æ¨åŠ¨æ•´ä¸ªé¡¹ç›®è¿ä½œï¼Œå…¶æ¬¡æ˜¯æ‹†åˆ†ä»»åŠ¡ç¡®å®šå“ªäº›å…ˆåšå“ªäº›ååšï¼Œæœ€åæ‰æ˜¯åšæŠ€æœ¯å®ç°ï¼Œæ¯ä¸€æ­¥éƒ½æŠŠæœ€å…³é”®æœ€ä¼˜å…ˆçš„æˆæœåšå‡ºæ¥ã€‚</p>
<a id="more"></a>
<p>ICçš„è§’è‰²å’Œä¸€èˆ¬çš„åç«¯å¼€å‘ï¼Œä»¥åŠå’Œå¸¦å®çº¿ç®¡ç†èŒè´£çš„æŠ€æœ¯æˆ–è€…ä¸šåŠ¡æ¶æ„å¸ˆï¼ŒèŒè´£ä¸Šéƒ½æœ‰åŒºåˆ«ï¼Œä¹Ÿè®¸å’Œæå¼€æºä¼šæ¯”è¾ƒç±»ä¼¼ã€‚é¦–å…ˆåœ¨åç«¯å¼€å‘åŸºç¡€ä¸Šï¼ŒICéœ€è¦æ‰¿æ‹…äº§å“æ•ˆæœè¯„ä¼°ã€éœ€æ±‚æ‹†è§£ã€æ¶æ„è®¾è®¡ä¹‹ç±»ç›¸å¯¹å®è§‚çš„å·¥ä½œï¼Œå…¶æ¬¡åœ¨ç®¡ç†ä¸ŠICåè™šçº¿ï¼Œç”šè‡³æ˜¯æ— ç®¡ç†èŒè´£åšè·¨éƒ¨é—¨æ²Ÿé€šï¼Œå› æ­¤æ¯”èµ·ç®¡ç†æ›´å¤šä¾èµ–åè°ƒæ–¹é¢çš„æŠ€èƒ½ã€‚</p>
<p>æ‰€ä»¥ç»¼åˆæ¥çœ‹ï¼Œè¦æ¨åŠ¨æ•´ä¸ªé¡¹ç›®è¿ä½œï¼Œé¦–å…ˆéœ€è¦ä»è‡ªå·±è§’åº¦å‡ºå‘ï¼Œå¯¹é¡¹ç›®çš„é‡Œç¨‹ç¢‘æœ‰è‡ªå·±çš„ç†è§£ï¼Œç„¶åå†å’Œé˜Ÿå‹åšè®¨è®ºï¼Œçœ‹æ¯ä¸ªæ—¶æœŸéœ€è¦å®ç°æ€æ ·çš„äº§å“å½¢æ€ï¼Œç¡®å®šä¸€ä¸ªä¸ªå­ç›®æ ‡ã€‚å…¶æ¬¡å°±æ˜¯åšæŠ€æœ¯æ¶æ„è®¾è®¡å’Œæ¼”è¿›æ–¹æ¡ˆï¼Œçœ‹æ€æ ·çš„æŠ€æœ¯æ–¹æ¡ˆèƒ½å¤Ÿæ»¡è¶³äº§å“çš„æ¼”è¿›ï¼Œå…¼é¡¾å„æ–¹çš„åˆ©ç›Šã€‚æœ€åæ‰æ˜¯æŠ€æœ¯å®ç°ï¼Œæœ€å¥½çš„å½¢å¼æ˜¯1åˆ°2äººä¸»å¯¼æ•´ä¸ªæ¶æ„ï¼Œæ¯ä¸ªæ¨¡å—ä¿è¯ä¸åŒäººè´Ÿè´£ï¼Œä¸”è€ƒè™‘åˆ°ä¸€èˆ¬ICåœ¨è™šæ‹Ÿå°ç»„ï¼Œæ•´å¥—ä»£ç æ¶æ„æœ€å¥½ä¹Ÿæœ‰æ˜ç¡®çš„ç ”å‘çº¦æŸï¼Œä¿è¯å¤§å®¶çš„ç ”å‘è¡Œä¸ºè¶‹è¿‘ä¸€è‡´ï¼Œé¿å…é‡æ„æˆæœ¬ã€‚è¿™æ ·ä»å®è§‚æ¥çœ‹ï¼Œæ•´ä¸ªé¡¹ç›®è¦åšçš„äº‹æƒ…å’Œæ¯ä¸ªæ—¶æœŸçš„äº¤ä»˜éƒ½æœ‰é¢„æœŸï¼Œæ¯ä¸ªäººä¹Ÿèƒ½å¤ŸæŒç»­é€¼è¿‘è‡ªå·±çš„ç›®æ ‡ï¼Œä¿è¯å„æ–¹çš„ç”Ÿäº§æ•ˆç‡ã€‚</p>
<p>è¿™é‡Œä¸€ä¸ªå…³é”®ç‚¹æ˜¯ï¼Œæ¯”å¦‚è·¨å›¢é˜Ÿåä½œï¼Œæ¯ä¸ªå›¢é˜Ÿçš„åˆ©ç›Šã€åšäº‹é£æ ¼å’ŒèŒè´£èŠ‚å¥éƒ½ä¸ä¸€æ ·ï¼Œå¦‚æœéœ€è¦åšäº›ä»€ä¹ˆçš„è¯ï¼Œæœ€å¥½è¦æ‰¾åˆ°è‡ªå·±çš„ä»·å€¼ç‚¹ä¸»åŠ¨è¡¥ä½ï¼Œæ¯”å¦‚ä½ è´Ÿè´£ä¸šåŠ¡å¼€å‘å’ŒåŸºç¡€æ¶æ„å¯¹æ¥ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥å»ä¸»å¯¼ä¸šåŠ¡éƒ¨åˆ†çš„äº§å“é€»è¾‘å’Œæ¨¡å—è®¾è®¡ï¼Œå› ä¸ºåŸºç¡€æ¶æ„åŒå­¦å¯¹è¿™éƒ¨åˆ†ä¸ç”šäº†è§£ï¼Œä¸ç„¶ç ”å‘æ•ˆæœå°±è¶Šæ¥è¶Šåï¼Œå¦‚æœä½ æ˜¯åŸºç¡€æ¶æ„æ–¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥å»ä¸»å¯¼æ•´ä¸ªå¾®æœåŠ¡æ¶æ„è·Ÿä¸‰æ–¹ä¾èµ–çš„è®¾è®¡ï¼Œå› ä¸ºä¸šåŠ¡åŒå­¦é€šå¸¸æ˜¯ä¾èµ–ä½¿ç”¨æ–¹ï¼Œå¯¹äºåŸºç¡€æ¶æ„å¾ˆå¤šæ½œè§„åˆ™ä¹Ÿä¸ä¼šå¾ˆäº†è§£ï¼Œæ‰€ä»¥è¿™éƒ¨åˆ†è®©åŸºç¡€æ¶æ„çš„åŒå­¦å®ç°åˆé€‚ã€‚</p>
<p>å…¶æ¬¡æ˜¯åšä»»åŠ¡æ‹†åˆ†ã€‚åœ¨ç¬”è€…çš„å·¥ä½œç¯å¢ƒï¼Œä¼šç»å¸¸é‡åˆ°åŒä¸€æ—¶åˆ»è¢«å¾ˆå¤šäººå¾ˆå¤šäº‹æ¨ç€èµ°ï¼Œå¦‚æœå¯¹è¿™æ ·çš„ç°çŠ¶æ²¡æœ‰å¾ˆå¥½åº”å¯¹çš„è¯ï¼Œé‚£ä¹ˆä¸€æ˜¯å¾ˆå®¹æ˜“å†…è€—å¯¼è‡´èº«å¿ƒé—®é¢˜ï¼ŒäºŒæ˜¯é¡¹ç›®è¿›åº¦æ— æ³•æ¨è¿›ã€‚è§£å†³çš„åŠæ³•å°±æ˜¯æ‰“å¤ªæï¼ŒåŒ–è¢«åŠ¨ä¸ºä¸»åŠ¨ï¼Œæ—¢ç„¶é¢å¯¹å¾ˆå¤šäº‹æƒ…ï¼Œé‚£å°±æŠŠè¿™äº›äº‹æƒ…å…¨éƒ¨è®°å½•ä¸‹æ¥ï¼Œç„¶åç»“åˆè‡ªå·±é¡¹ç›®çš„éœ€è¦ï¼Œè‡ªä¸»å†³å®šå“ªäº›å…ˆåšï¼Œå“ªäº›ååšï¼Œå“ªäº›å…ˆè¦å‡ºç»“æœï¼Œå“ªäº›è¦é•¿æœŸæ²»ç†ã€‚å¦‚æœè¦å®ç°äº§å“MVPï¼Œé‚£ä¹ˆäº§å“MVPå¿…é¡»çš„æŠ€æœ¯ç»„ä»¶å¿…é¡»æ”¾åœ¨å‰å¤´ï¼Œç”¨æˆ·çš„å…·ä½“éœ€æ±‚è¦é åï¼Œä¸ç„¶è‡ªèº«éš¾ä¿ï¼›å¦‚æœè¦å¿«é€Ÿæ‹¿ä¸šåŠ¡ç»“æœï¼Œé‚£ä¹ˆç”¨æˆ·éœ€æ±‚è¦æ”¾åœ¨å‰å¤´ï¼ŒæŠ€æœ¯ä¼˜åŒ–å’Œç¨³å®šæ€§å·©å›ºæ”¾åœ¨åå¤´ï¼Œå…ˆæŠŠä¸šåŠ¡è·‘èµ·æ¥å†åšé‡æ„ä¼˜åŒ–ï¼Œå…ˆ60åˆ†å†80åˆ†ã€‚</p>
<p>å½“ç„¶ï¼Œå®é™…åœºæ™¯ä¸‹å¯èƒ½ä¼šæ›´åŠ å¤æ‚ï¼Œè¿™é‡Œä¸»è¦å¼ºè°ƒçš„ç‚¹æ˜¯ï¼Œå¯¹äºä»»åŠ¡å¦‚ä½•æ‹†åˆ†ï¼Œæ€ä¹ˆä¾èµ–ï¼Œå®ç°å…ˆåï¼Œæ—¶æ—¶åˆ»åˆ»éƒ½è¦æœ‰è‡ªå·±çš„æŠŠæ¡ï¼Œå‡è¡¡å¥½äººåŠ›å’Œäº§å“æ•ˆæœã€‚åŒæ—¶æŠ€æœ¯ä¸Šé‡è¦çš„æ˜¯ï¼Œç»“åˆè‡ªå·±çš„æŠ€æœ¯ç»éªŒï¼Œè®¾è®¡ä¸€å¥—å¼ºç¡®å®šæ€§çš„ä»£ç æ¶æ„ï¼Œé•¿æœŸè®©æ›´å°‘çš„ç²¾åŠ›æŠ•å…¥åˆ°ä»£ç ç ”å‘ä¸Šï¼Œè¿™æ ·æ‰ä¼šæœ‰æ›´å¤šçš„ç²¾åŠ›å»æˆäº‹ã€‚</p>
<p>æœ€åå°±æ˜¯æŠ€æœ¯å®ç°ã€‚è¿™é‡Œçš„æŠ€æœ¯å®ç°ä¸ä»…ä»…æ˜¯ç ”å‘äº¤ä»˜å°±å®Œæˆäº†ï¼Œä½œä¸ºä¸»å¯¼äº§å“ç ”å‘çš„è§’è‰²ï¼Œç ”å‘å†…å®¹ææµ‹ã€ç°åº¦å’Œä¸Šçº¿è¿‡ç¨‹ï¼Œç›¸å¯¹äºæ™®é€šå¼€å‘éƒ½éœ€è¦åšæ›´å¤šçš„å¹²é¢„ï¼Œä¿è¯äº§å“æœ€ç»ˆçš„äº¤ä»˜è´¨é‡ã€‚ç›¸å¯¹äºäº‹æƒ…æ¨åŠ¨å’Œæ‹†è§£æ¥è®²ï¼ŒæŠ€æœ¯æ€ä¹ˆå®ç°ä¹Ÿè®¸æ˜¯å¯¹äºICæ¥è®²æœ€ä¸é‡è¦çš„éƒ¨åˆ†ï¼Œä½†æŠ€æœ¯æ¯•ç«Ÿæ˜¯äº§å“çš„è¡€è‚‰ï¼Œäº¤ä»˜è´¨é‡è‚¯å®šè¦å»ä¿è¯çš„ã€‚æ‰€ä»¥ä¸€ä¸ªæ®‹é…·çš„ç‚¹æ˜¯ï¼Œå¦‚æœè¦åšå¥½ICï¼Œé‚£ä¹ˆå‰ææ˜¯ä½ åœ¨æŠ€æœ¯å®ç°æ–¹é¢å·²ç»å½¢æˆäº†æˆç†Ÿçš„è‚Œè‚‰è®°å¿†ï¼Œæœ‰èƒ½åŠ›å»æ— è„‘å®ç°å¾ˆå¤šä¸œè¥¿ï¼Œè¿™æ ·å°±èƒ½æŠŠæ›´å¤šçš„ç²¾åŠ›æ”¾åˆ°å®è§‚çš„äº‹æƒ…ä¸Šã€‚å¦åˆ™ï¼Œè¿˜æ˜¯å»ºè®®è€ƒè™‘å…¶å®ƒçš„è§’è‰²ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>äº§å“</tag>
        <tag>é‡æ„</tag>
        <tag>IC</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘åˆ†äº«ä¸‹OOMé—®é¢˜æ’æŸ¥è§£å†³çš„å®æˆ˜ç»éªŒ</title>
    <url>/2025/07/06/geekdaily/oom_issue_solution/</url>
    <content><![CDATA[<p>åœ¨AIåŠ©æ‰‹æ—¶ä»£ï¼ŒOOMçš„é—®é¢˜æ’æŸ¥æ–¹æ³•è®ºå·²ç»éå¸¸çƒ‚å¤§è¡—ï¼Œä½†åœ¨å®é™…å·¥ä½œä¸­ï¼Œå³ä¾¿æˆ‘ä»¬é€šè¿‡å¾ˆå¤šæ–¹å¼æŸ¥åˆ°äº†OOMé—®é¢˜ï¼Œä½†ä¿®å¤è¿˜æ˜¯è¦æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨ä¿®ã€‚OOMä¼šå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ã€ç³»ç»Ÿä¸ç¨³å®šç­‰é—®é¢˜ï¼Œä¼šç›´æ¥å½±å“ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥ä»ç¨³å®šæ€§é—®é¢˜è§£å†³ä¼˜å…ˆçº§æ¥çœ‹ï¼Œæ˜¯å±äºæ¯”è¾ƒé«˜çš„ã€‚</p>
<p>å› æ­¤ï¼Œä»Šå¤©ç¬”è€…å°±ç®€å•ä»è‡ªèº«ç»éªŒå‡ºå‘ï¼ŒèŠä¸€ä¸‹OOMé—®é¢˜çš„æ’æŸ¥å’Œè§£å†³ç»éªŒã€‚ä»äº‹æƒ…ä¸Šæ¥çœ‹ï¼Œè½»æ’æŸ¥ï¼Œé‡è§£å†³ã€‚æ’æŸ¥çš„æ‰‹æ®µå¾ˆå¤šï¼Œä½†æ€ä¹ˆè§£å†³ï¼Œå°±éœ€è¦æˆ‘ä»¬è‡ªå·±æ ¹æ®å®é™…æƒ…å†µæ¥å†³ç­–ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆèŠä¸€ä¸‹é—®é¢˜æ’æŸ¥ã€‚æ’æŸ¥ç”¨çš„å·¥å…·æ¯”å¦‚jvmå¯ä»¥ç”¨arthasï¼Œæ’golangæœåŠ¡å¯ä»¥ç”¨pprofï¼Œæˆ–è€…å…¶ä»–å¼€æºè·Ÿä¼ä¸šå†…éƒ¨è‡ªå»ºçš„å·¥å…·éƒ½å¯ä»¥ï¼Œä¸»è¦éœ€è¦æœ‰heap-dumpçš„èƒ½åŠ›ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªèƒ½åŠ›çš„è¯ï¼Œæ¬¡ä¹‹åªèƒ½é€šè¿‡æ—¥å¿—/metricsåšOOMæ½œåœ¨é£é™©é“¾è·¯åˆ¤æ–­ã€‚</p>
<p>å·¥å…·å‡†å¤‡å¥½äº†ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç¡®å®šOOMçš„æˆå› ã€‚æœåŠ¡ä¼šOOMï¼Œç›´æ¥åŸå› å°±æ˜¯å•ç‚¹æœåŠ¡çš„å†…å­˜å®¹é‡æ²¡æœ‰åŠæ³•æ‰¿è½½ä¸šåŠ¡å†…å­˜æ³„æ¼çš„éœ€è¦ï¼Œç¬¬ä¸€ç‚¹å°±éœ€è¦æ’æŸ¥ä¸šåŠ¡é€»è¾‘é‡Œé¢ï¼Œæœ‰ä»€ä¹ˆèŠ‚ç‚¹ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œç”³è¯·å¤§é‡å†…å­˜ç¼“å­˜ä¸šåŠ¡æ•°æ®ã€‚æ¯”æ–¹è¯´ï¼ŒæŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œæˆ‘å¼€äº†100ä¸ªçº¿ç¨‹ï¼Œloadäº†100ä¸ªä»»åŠ¡çš„æŒä¹…åŒ–æ—¥å¿—è®°å½•ï¼Œåšåˆ†æä¿®æ”¹å¹¶è½åº“ï¼Œé‚£ä¹ˆè¿™é‡Œé¢æ•°æ®çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ï¼ˆä¸šåŠ¡jsonè·Ÿdbçš„orméƒ½è¦è€ƒè™‘ï¼‰ã€æ—¥å¿—åˆ†ææ—¶æœŸæ•°æ®åœ¨å†…å­˜çš„é©»ç•™ã€åˆ†æè¿‡ç¨‹ä¸­é—´æ•°æ®çš„äº§å‡ºï¼Œéƒ½æœ‰å¯èƒ½å¯¼è‡´å†…å­˜çˆ†ç‚¸ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹è¿™ç±»å¤šå¼€æ“ä½œåšæ—¥å¿—æ‰“ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦å¯èƒ½å­˜åœ¨é£é™©ã€‚å¦‚æœæ˜¯å› ä¸ºæ­»é”è·Ÿæˆ–è€…WaitGroupä¸doneå¯¼è‡´çš„é—®é¢˜ï¼Œå¸¸è§ç—‡çŠ¶ä¸€æ˜¯OOMä¼šç›¸å¯¹é¢‘ç¹ï¼ŒäºŒæ˜¯traceæ—¥å¿—æˆ–è€…æ•´ä¸ªä»»åŠ¡è¿›åº¦å¡åœ¨æŸä¸ªç‚¹ä¸è¿›è¡Œä¸‹å»ï¼Œä¸‰æ˜¯çº¿ç¨‹æ°¸ä¸é‡Šæ”¾æ•°é‡æ’å®šå¢é•¿ï¼Œè¿™äº›é—®é¢˜éƒ½æ˜¯å¯ä»¥é€šè¿‡å¯¹åº”æŒ‡æ ‡å»åˆ¤æ–­çš„ã€‚</p>
<p>å¦‚æœOOMç›¸å¯¹æ¥è®²çªå‘çš„ï¼Œé‚£å¯èƒ½é—®é¢˜åœ¨äºå…·ä½“æŸä¸ªä»»åŠ¡æˆ–æŸä¸ªè¯·æ±‚å¯¹åº”çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œæ ¹å› æ›´åƒæ˜¯æŸç±»ä»£ç bugï¼Œè€Œä¸æ˜¯ä»£ç å®ç°æœªåšå……åˆ†ä¿æŠ¤æªæ–½å¼•èµ·ã€‚å¯¹äºè¿™ç±»é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®heap-dumpå†…å®¹å»åæ¨å…·ä½“å“ªä¸ªä»»åŠ¡æˆ–å“ªç±»è¯·æ±‚å‡ºé—®é¢˜ï¼Œç„¶åç»“åˆä»£ç å»æ’æŸ¥ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿé‚£ä¹ˆå¤šçš„æ•°æ®ã€‚æ¯”æ–¹è¯´ï¼Œå¦‚æœæŸä¸ªä»»åŠ¡æ‰€æœ‰å­æ‰§è¡Œé¡¹çš„æ—¥å¿—æ‰“å°å†…å®¹å®¹æ˜“å¯¼è‡´OOMï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ’æŸ¥ä»»åŠ¡å­æ‰§è¡Œé¡¹çš„æ•°é‡æ˜¯ä¸æ˜¯å¼‚å¸¸å¤šï¼Œå¦‚æœå¤šçš„è¯ï¼Œå°±çœ‹ä»£ç é‡Œé¢æ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆåœºæ™¯é—æ¼å¯¼è‡´ä»»åŠ¡å­æ‰§è¡Œé¡¹æ— é™å¢é•¿ã€‚åŒæ—¶ï¼Œä¸€èˆ¬ä»£ç bugéƒ½æ˜¯é€šè¿‡å˜æ›´å¼•èµ·ï¼Œæ‰€ä»¥æ’æŸ¥ä»£ç bugä¹Ÿå¯ä»¥å…³æ³¨OOMæ˜¯ä»€ä¹ˆæ—¶é—´å¼€å§‹ï¼Œè¿™ä¸ªæ—¶é—´é™„è¿‘æœ‰æ²¡æœ‰æŸäº›å…³é”®é€»è¾‘çš„ä»£ç å˜æ›´ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€Ÿå®šä½åˆ°é—®é¢˜ã€‚å¦‚æœä¸æ˜¯è¿™ç§caseï¼Œä¹Ÿå¯ä»¥è€ƒè™‘æ˜¯å¦æ˜¯ä¸Šæ¸¸æµé‡çªå¢å¼•èµ·æŸæ¡ä¸šåŠ¡é“¾è·¯å†…å­˜å ç”¨è¿‡å¤§ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æ’æŸ¥HTTPã€RPCã€Consumerå’Œç¼“å­˜çš„æµé‡å’Œæ¶ˆè´¹æ—¥å¿—ï¼Œåˆ¤æ–­å¯èƒ½çš„åŸå› ã€‚</p>
<p>ç„¶åèŠä¸€ä¸‹OOMçš„è§£å†³ã€‚é€šç”¨æ— è„‘çš„è§£å†³æ–¹æ³•å½“ç„¶æ˜¯æ‰©å®¹ï¼Œä½†è¿™ä¸ªæ“ä½œä¸€æ¥æ˜¯ç¼“å’Œçº¿ä¸Šé—®é¢˜åšä¸´æ—¶æ­¢æŸï¼ŒäºŒæ¥æœ‰ä¸€ä¸ªå‰ç½®è®¤çŸ¥æ˜¯ä¸šåŠ¡é€»è¾‘çš„å†…å­˜é¢„æœŸç”¨é‡ç¬¦åˆé¢„æœŸï¼Œå¦åˆ™OOMçš„é—®é¢˜æ²¡æœ‰åŠæ³•æ ¹æœ¬è§£å†³ã€‚è¦æ ¹æœ¬è§£å†³OOMé—®é¢˜ï¼Œå…ˆçœ‹å¦‚æœæ˜¯çªå‘å¼‚å¸¸çš„è¯ï¼Œæ¯”å¦‚æŸä¸ªä»»åŠ¡å­é¡¹æ•°é‡æœ‰å¼‚å¸¸ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»ˆæ­¢ä»»åŠ¡ã€é™åˆ¶å­é¡¹æŸ¥è¯¢ä»¥åŠä»»åŠ¡å­é¡¹çš„ä¿®æ•°å»åšæ­¢æŸï¼Œç„¶åä¿®å¤å¯¹åº”çš„ä»£ç bugå½“ä¸‹è§£å†³é—®é¢˜ä¿è¯æœåŠ¡å¯ç”¨ï¼Œç„¶åé•¿æœŸå»åšä¸€äº›å¯¹åº”å¼‚å¸¸çš„ç›‘æ§ä»¥åŠæ›´åŠ ä¸¥æ ¼çš„ä»£ç CRæœºåˆ¶æ¥ä¿è¯OOMé—®é¢˜èƒ½å¤Ÿæå‰å‘ç°ã€‚å¦‚æœæ˜¯ä¸Šæ¸¸æµé‡çªå¢å¯¼è‡´çš„OOMé—®é¢˜ï¼Œé‚£æˆ‘ä»¬é¦–å…ˆéœ€è¦ä¸Šæ¸¸å¯¹é½å¼‚å¸¸æµé‡æ˜¯å¦ç¬¦åˆä¸šåŠ¡é¢„æœŸï¼Œç„¶åå†å†³å®šæ˜¯ä¼˜å…ˆåšäº›é€šç”¨çš„é™æµç†”æ–­æªæ–½ï¼Œè¿˜æ˜¯åœ¨ä»£ç é‡Œåšäº›å·¥ä½œè¿åˆä¸šåŠ¡é¢„æœŸã€‚å¦‚æœæ˜¯æ­»é”å¯¼è‡´çš„é—®é¢˜ï¼Œä¸€èˆ¬ä¿®å®Œä»£ç è·ŸæœåŠ¡å®ä¾‹ä¹‹åéƒ½åº”è¯¥ä¼šè‡ªåŠ¨ä¿®å¤ï¼Œç»§ç»­æ¨è¿›ç›¸å…³ä»»åŠ¡è¿›åº¦ã€‚</p>
<p>å¦‚æœæ˜¯é•¿æœŸä½†ä¸æ˜¯å¾ˆé¢‘ç¹çš„å†…å­˜æ³„æ¼é—®é¢˜ï¼Œå¯ä»¥åœ¨æ‰©å®¹åŸºç¡€ä¸Šå»ä¼˜åŒ–ä¸€æ¬¡æ€§å¤šå¼€æˆ–è€…é•¿æœŸå†…å­˜é©»ç•™çš„é€»è¾‘ï¼Œæ¯”å¦‚å¯ä»¥é€šè¿‡å‡½æ•°ä½œç”¨åŸŸçš„ç‰¹æ€§è®©ä¸­é—´æ•°æ®åŠæ—¶è¢«gcæ‰ï¼Œgolangçš„è¯å•ç‚¹æœåŠ¡å°½å¯èƒ½é€šè¿‡æŒ‡é’ˆæ ‡è¯†æ•°æ®ï¼Œç›¸åŒä½†è€—å†…å­˜çš„dbæŸ¥è¯¢ç”¨singleflightå°è£…ï¼ˆæ³¨æ„æ­»é”ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯èŠ‚çœå†…å­˜çš„åŠæ³•ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ç¨³å®šæ€§</tag>
        <tag>é—®é¢˜æ’æŸ¥</tag>
        <tag>OOM</tag>
        <tag>å†…å­˜æ³„æ¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘å¹³è¡¡æŠ€æœ¯æ¶æ„è®¾è®¡å’Œé¢„æœŸçš„äº§å“å½¢æ€</title>
    <url>/2025/06/01/archiart/balance_architecture_and_product/</url>
    <content><![CDATA[<p>è¿‘æœŸç¬”è€…å› ä¸ºå·¥ä½œåŸå› ï¼Œå¼€å§‹å¯åŠ¨teamå†…éƒ¨éƒ¨åˆ†æŠ€æœ¯é¡¹ç›®çš„é‡æ„ã€‚åœ¨äº‹æƒ…å¯åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œå†…éƒ¨å¯¹äºè¿™ä»¶äº‹æƒ…çš„å®šæ€§å’ŒæŠ•å…¥æœ‰ä¸€äº›äº‰è®ºï¼Œä½†æœ€ç»ˆè¿˜æ˜¯æ•²å®šäº†ä¸‹æ¥ã€‚å…¶ä¸­éƒ¨åˆ†äº‰è®ºç‚¹ä¸»è¦åœ¨äºäº§å“å½¢æ€ï¼Œå› ä¸ºäº‹æƒ…æ¶‰åŠåˆ°è·¨éƒ¨é—¨åˆä½œï¼Œæ‰€ä»¥äº§å“å½¢æ€æ€ä¹ˆç¬¦åˆåŒæ–¹çš„åˆ©ç›Šæ˜¯æ¯”è¾ƒé‡è¦çš„ã€‚åœ¨è¿™ä¸ªå‰æä¸‹ï¼Œç„¶åæ‰æ˜¯æŠ€æœ¯è®¾è®¡ä¸Šé¢ï¼Œæ€ä¹ˆèƒ½å¤Ÿè¿åˆé•¿ä¹…åˆä½œçš„éœ€è¦ã€‚</p>
<p>å› æ­¤ï¼Œä»Šå¤©ç¬”è€…å°±ç®€å•èŠä¸€ä¸‹ï¼Œæ€ä¹ˆå»åšåˆ°è®©æŠ€æœ¯æ¶æ„è®¾è®¡å’Œé¢„æœŸäº§å“å½¢æ€èƒ½å¤Ÿåšåˆ°æœ‰æ•ˆå¹³è¡¡ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆï¼Œå› ä¸ºäº§å“å½¢æ€å†³å®šæŠ€æœ¯ç»“æœï¼Œæ‰€ä»¥éœ€è¦ç»è¿‡è®¨è®ºå»ç¡®å®šæ ¸å¿ƒçš„äº§å“æ•ˆæœã€‚ç¬”è€…æ‰€åœ¨çš„teamè·ç¦»å…·ä½“ä¸šåŠ¡æ¯”è¾ƒè¿‘ï¼Œè€Œé¢ä¸´çš„è·¨éƒ¨é—¨åˆä½œåœºæ™¯ä¸»è¦æ˜¯å’Œinfraéƒ¨é—¨åˆä½œï¼Œé‚£ä¹ˆè¿™é‡Œé¢çš„åˆ†æ­§ç‚¹å°±æ˜¯ï¼Œinfraéƒ¨é—¨å¯¹äºä¸šåŠ¡éœ€æ±‚æå€¡å¼€æ”¾æ€§ï¼Œè€Œè·ç¦»å…·ä½“ä¸šåŠ¡æ¯”è¾ƒè¿‘çš„éƒ¨é—¨åˆ™æ›´åŠ å€¾å‘äºæ‰“é€ ç›¸å¯¹å°é—­è€Œæœ‰ç«äº‰åŠ›çš„äº§å“ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªåˆ†æ­§ï¼Œæœ€ç»ˆè®¨è®ºäº§å“æ•ˆæœæ˜¯è®©infraæä¾›æ¶å­ï¼Œç¬”è€…teamçš„èƒ½åŠ›ä½œä¸ºæ ¸å¿ƒç»„ä»¶æ¥å…¥ï¼Œè¿™æ ·å°±èƒ½å¤Ÿè¾¾åˆ°åŒæ–¹å¯¹äºæœ€ç»ˆäº§å“æ•ˆæœä¸Šçš„å…±è¯†ã€‚å½“ç„¶ï¼Œä¸åŒä¼ä¸šä¸åŒéƒ¨é—¨æƒ…å†µä¸ç»Ÿä¸€ï¼Œä½†è¿™ä¸ªäº‹æƒ…è¿˜æ˜¯è¦ç¡®å®šçš„ã€‚</p>
<p>å…¶æ¬¡ï¼Œç”±äº§å“å½¢æ€åæ¨æŠ€æœ¯è®¾è®¡ï¼Œå¿…ç„¶æ¶‰åŠåˆ°æ¶æ„æ¼”è¿›çš„éƒ¨åˆ†ï¼Œä»ç°æœ‰çš„æŠ€æœ¯æ¶æ„å‡ºå‘ï¼Œæ€ä¹ˆæ¼”è¿›åˆ°æœ€ç»ˆæ€ï¼ŒèŠ±è´¹å¤šå°‘æ—¶é—´å¤šå°‘äººåŠ›ï¼Œå¦‚æœè¦æ‹¿æŠ€æœ¯/ä¸šåŠ¡ç»“æœçš„è¯æœ‰å“ªäº›é˜¶æ®µæ€§äº§å‡ºï¼Œä¸åŒé˜¶æ®µä¹‹é—´æ¶æ„æ¼”è¿›ä¼šæœ‰ä»€ä¹ˆæ ·çš„å˜åŒ–ï¼Œæ¯ä¸ªé˜¶æ®µæŠ•å…¥äº§å‡ºæ¯”æ€ä¹ˆæ ·ï¼Œè¿™äº›éƒ½æ˜¯ä½œä¸ºæ¶æ„å¸ˆéœ€è¦å»è€ƒè™‘çš„ã€‚åœ¨ç¬”è€…çš„caseé‡Œé¢ï¼Œç¬”è€…æ‰€è¦é‡æ„çš„æ˜¯ä¸€å¥—å˜æ›´é£é™©è§‚æµ‹åŸºå»ºï¼Œæ‰€ä»¥æ¶æ„æ¼”è¿›ä¸»è¦é‡‡ç”¨åˆ†æ¨¡å—æ¼”è¿›çš„æ–¹å¼ï¼Œç¬¬ä¸€é˜¶æ®µé¢å‘è§‚æµ‹èƒ½åŠ›ï¼Œæä¾›ç»Ÿä¸€çš„æŠ€æœ¯æ¥å…¥å’Œè°ƒåº¦åè®®ï¼›ç¬¬äºŒé˜¶æ®µé¢å‘è§‚æµ‹è°ƒåº¦ï¼Œæä¾›ç±»æµæ°´çº¿+ä½ä»£ç çš„ç¼–æ’æ–¹æ¡ˆï¼›ç¬¬ä¸‰é˜¶æ®µå°†æ•´å¥—è°ƒåº¦ç¼–æ’åšæŒç»­è¿­ä»£ï¼Œé€‚é…å„ç±»ä¸šåŠ¡å˜æ›´è§‚æµ‹åœºæ™¯ï¼Œå¹¶å®Œå–„æ•°æ®åº¦é‡åˆ†æç­‰å‘¨è¾¹åŠŸèƒ½ã€‚è¿™æ ·ï¼Œè¿™å¥—å˜æ›´é£é™©è§‚æµ‹åŸºå»ºï¼Œå°±å¯ä»¥å…¼é¡¾çŸ­æœŸå’Œé•¿æœŸçš„è½åœ°éœ€è¦ï¼Œé€æ­¥æˆä¸ºå…¬å¸å†…éƒ¨æ ‡å‡†åŒ–çš„æ–¹æ¡ˆã€‚</p>
<p>æœ€åï¼Œåœ¨å®é™…æ‰§è¡ŒæŠ€æœ¯æ¶æ„å®ç°çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿéœ€è¦ä¿æŒè¶³å¤Ÿçš„ä¸»åŠ¨æ€§ï¼Œæ¨åŠ¨ç ”å‘å’Œéç ”å‘çš„äº‹æƒ…éƒ½å¾—åˆ°è§£å†³ã€‚è™½ç„¶ä¸‹é¢çš„è¯æœ‰ç‚¹é˜¿é‡Œå‘³ï¼Œä½†é“ç†æ˜¯æ²¡æœ‰é”™ï¼Œé‚£å°±æ˜¯å› ä¸ºç›¸ä¿¡ï¼Œæ‰€ä»¥çœ‹è§ã€‚ä»¥è¿™æ ·çš„åŸºç¡€ï¼Œè·¨éƒ¨é—¨åˆä½œä¹Ÿä¼šæ›´åŠ æœ‰å‡èšåŠ›ï¼Œå¤§å®¶ä¹Ÿæ›´æ„¿æ„äº’ç›¸ä¿¡ä»»ï¼Œè®©æ•´ä¸ªäº‹æƒ…åšåˆ°æˆåŠŸã€‚å½“ç„¶ï¼Œæ‚²è§‚çš„æ¥è®²ï¼Œå”¯ä¸€ä¸å˜çš„æ˜¯å˜åŒ–ï¼Œä¹Ÿè®¸ä¸€äº›å®å¤§çš„æŠ€æœ¯æ„æ€ï¼Œæœ€ç»ˆä¹Ÿä¼šå› ä¸ºç§ç§åŸå› æ— æ³•è½åœ°ï¼Œä½†è¿™å¹¶ä¸é‡è¦ã€‚é‡è¦çš„æ˜¯ï¼Œä½ èƒ½å¤Ÿç”¨æŠ€æœ¯æŒæ§äººï¼Œè§£å†³äººçš„é—®é¢˜ï¼Œè¿™æ‰æ˜¯ä½œä¸ºä¸€åæŠ€æœ¯æ¶æ„å¸ˆå­˜åœ¨çš„ä»·å€¼ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>äº§å“</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>é‡æ„</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘åˆ†äº«goå¼€å‘ä¸­wireå’Œinterfaceé…åˆçš„ä¸€äº›ç»éªŒ</title>
    <url>/2025/06/01/geekdaily/wire_and_interface/</url>
    <content><![CDATA[<p>åœ¨å…ˆå‰<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDQvMDQvYXJjaGlhcnQvZ29fbW9ub3JlcG9fd2lyZS8=" title="https://utmhikari.top/2025/04/04/archiart/go_monorepo_wire/">ä¸€ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­ï¼Œç¬”è€…ç»™å¤§å®¶æåˆ°äº†goè¯­è¨€åç«¯ç¼–ç¨‹å¯ä»¥ç”¨wireä¾èµ–æ³¨å…¥æ¨¡å—å»ç®€åŒ–å•ä¾‹æœåŠ¡çš„åˆå§‹åŒ–ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è§£å†³æœåŠ¡å•ä¾‹ä¹‹é—´å¤æ‚ä¾èµ–çš„é—®é¢˜ã€‚ä½†å®äº‹æ±‚æ˜¯æ¥è®²ï¼Œç”¨wireä¹Ÿæ˜¯æœ‰ä¸€äº›å­¦ä¹ æˆæœ¬çš„ï¼Œwireåœ¨å¸®åŠ©è§£å†³å¤æ‚ä¾èµ–çš„é—®é¢˜åŒæ—¶ï¼Œä¹Ÿä¼šé™å®šä½ å»ç”¨ä¸€äº›ç‰¹å®šçš„ç¼–ç¨‹æ–¹å¼æ¥æ»¡è¶³wireçš„éœ€è¦ï¼Œå°¤å…¶éœ€è¦ä½ interfaceç»™ç”¨çš„æ›´åŠ çµæ´»ã€‚</p>
<p>å› æ­¤ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œç¬”è€…ç»“åˆè‡ªå·±çš„ç»éªŒï¼Œå°±å’Œå¤§å®¶æµ…åˆ†äº«ä¸‹ï¼Œwireå’Œinterfaceé…åˆçš„ä¸€äº›ç»éªŒï¼Œè®©å¤§å®¶ä»¥åç”¨wireçš„æ—¶å€™é¿å…ä¸€äº›å‘ã€‚</p>
<a id="more"></a>
<p>å¯¹äºwireçš„buildæŒ‡ä»¤è€Œè¨€ï¼Œbuildä¼šæ£€æŸ¥ä½ ä¾èµ–å¯¹è±¡æ˜¯å±äºå“ªç§ç±»å‹ï¼Œä¸èƒ½å‡ºç°é‡å¤provideæŸç§ç±»å‹çš„æƒ…å†µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯”å¦‚ä½ çš„æŸä¸ªServiceéœ€è¦ä¸€ä¸ªstringçš„memberï¼Œé‚£è¿™ä¸ªstringå°±ä¸å¥½å•ç‹¬provideå‡ºæ¥ï¼Œå› ä¸ºå…¶ä»–Serviceä¹Ÿå¤§æ¦‚ç‡å­˜åœ¨ã€‚æ‰€ä»¥è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªstring-providerçš„interfaceæˆ–è€…structå»å¯¹è¿™ä¸ªstringåšä¸€ä¸ªå°è£…ï¼Œé˜æ˜è¿™ä¸ªå‚æ•°çš„ç‹¬æœ‰ä¸šåŠ¡æ¶µä¹‰ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°ä¾èµ–é‡å¤çš„æƒ…å†µã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ThirdPartyClient <span class="keyword">struct</span> &#123;</span><br><span class="line">    Client *HttpClient</span><br><span class="line">    Secret <span class="keyword">string</span> <span class="comment">// åˆå§‹æƒ…å†µä¸‹ï¼Œéœ€è¦æä¾›ä¸€ä¸ªsecretå‚æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡é™æ€configæ‹¿ï¼Œç„¶åwire.Structç»™åˆ°ThirdPartyClient</span></span><br><span class="line"><span class="keyword">type</span> ThirdPartyConfig <span class="keyword">struct</span> &#123;</span><br><span class="line">    Secret <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ThirdPartyClient <span class="keyword">struct</span> &#123;</span><br><span class="line">    Client *HttpClient</span><br><span class="line">    Config *ThirdPartyConfig</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewThirdPartyClient</span><span class="params">(httpClient *HttpClient, config *ThirdPartyConfig)</span> *<span class="title">ThirdPartyClient</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;ThirdPartyClient&#123;</span><br><span class="line">        Client: httpClient,</span><br><span class="line">        Config: config,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¦ä¸€ç§æ–¹å¼æ˜¯æŠ½è±¡ä¸€ä¸ªSecretProviderçš„interfaceï¼Œå¯ä»¥å¤„ç†åŠ¨æ€è·å–Secretçš„æƒ…å†µ</span></span><br><span class="line"><span class="keyword">type</span> ISecretProvider <span class="keyword">interface</span> &#123;</span><br><span class="line">    GetSecret() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ThirdPartyClient <span class="keyword">struct</span> &#123;</span><br><span class="line">    Client *HttpClient</span><br><span class="line">    SecretProvider ISecretProvider</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewThirdPartyClient</span><span class="params">(httpClient *HttpClient, secretProvider ISecretProvider)</span> *<span class="title">ThirdPartyClient</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;ThirdPartyClient&#123;</span><br><span class="line">        Client: httpClient,</span><br><span class="line">        SecretProvider: secretProvider,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£è¿™é‡Œå°±è¡ç”Ÿå‡ºæ–°çš„é—®é¢˜ï¼Œå¦‚æœæˆ‘æœ‰å¾ˆå¤šSecretï¼Œä¸€ä¸ªSecretProviderä¸å¤Ÿï¼Œé‚£æ€ä¹ˆåŠï¼Ÿè¿™ä¸ªä¹Ÿå¥½åŠï¼Œå› ä¸ºæœ¬è´¨ä¸Šæ¥è®²ï¼Œå¯¹äºæ¯ä¸€ä¸ªå‚ä¸wireçš„å®ä¾‹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦é˜æ˜å…¶çš„ç‹¬æœ‰ä¸šåŠ¡æ¶µä¹‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¾—åœ¨ISecretProvideråŸºç¡€ä¸Šï¼Œå®šä¹‰IAAASecretProviderã€IBBBSecretProviderä»¥åŠICCCSecretProviderè¿™ç§ã€‚æˆ–è€…æ¢ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬wireä¸€äº›ç¼“å­˜æ¨¡å—ç»™ä¸šåŠ¡serviceï¼Œç¼“å­˜æ¨¡å—å°±éœ€è¦è¿™ä¹ˆè®¾è®¡ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ICache <span class="keyword">interface</span> &#123;</span><br><span class="line">    Get(key <span class="keyword">string</span>) (<span class="keyword">string</span>, error)</span><br><span class="line">    Set(key <span class="keyword">string</span>, value <span class="keyword">string</span>, expiration time.Duration) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ILocalCache <span class="keyword">interface</span> &#123;</span><br><span class="line">    ICache</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IRemoteCache <span class="keyword">interface</span> &#123;</span><br><span class="line">    ICache</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGoCache</span><span class="params">()</span> <span class="title">ILocalCache</span></span> &#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRedisCache</span><span class="params">()</span> <span class="title">IRemoteCache</span></span> &#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ ·å†™ï¼Œä¸ä»…å¯ä»¥åŒºåˆ†LocalCacheå’ŒRemoteCacheï¼Œæ»¡è¶³wireçš„è¦æ±‚ï¼ŒåŒæ—¶å¯¹äºå…¶å®ƒå¼€å‘è€…ï¼Œä¹Ÿèƒ½å¤Ÿæ¸…æ¥šçŸ¥é“å½“å‰æ˜¯ä½¿ç”¨Localå’ŒRemoteçš„Cacheæ¥åšä¸šåŠ¡é€»è¾‘ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°è¯¯ç”¨ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>wire</tag>
        <tag>ä¾èµ–æ³¨å…¥</tag>
        <tag>interface</tag>
        <tag>cache</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘Goå¤§ä»“monorepoå„æ¨¡å—çš„ä»£ç ç»„ç»‡è®¾è®¡</title>
    <url>/2025/05/02/archiart/go_monorepo_modules/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDMvMDkvYXJjaGlhcnQvZ29fbW9ub3JlcG9fc3RydWN0dXJlLw==" title="https://utmhikari.top/2025/03/09/archiart/go_monorepo_structure/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­ï¼Œç¬”è€…åˆ†äº«äº†goè¯­è¨€monorepoåŸºæœ¬çš„ä¸€å¥—ä»£ç æ¶æ„è®¾è®¡ã€‚ä»¥è¿™ä¸ªè®¾è®¡ä¸ºåŸºç¡€ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±èŠä¸€ä¸‹å…·ä½“é‡Œé¢çš„ä»£ç æ€ä¹ˆç¼–å†™èµ·æ¥æ¯”è¾ƒèˆ’é€‚ã€‚</p>
<p>å…³äºæ¯ä¸ªå¾®æœåŠ¡è‡ªå·±çš„ä»£ç ï¼Œå…¶å®åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDQvMDQvYXJjaGlhcnQvZ29fbW9ub3JlcG9fd2lyZS8=" title="https://utmhikari.top/2025/04/04/archiart/go_monorepo_wire/">wireä¾èµ–æ³¨å…¥<i class="fa fa-external-link"></i></span>è¿™ç¯‡æ–‡ç« æœ‰æåˆ°è¿‡ä¸€å¥—æ¯”è¾ƒç®€æ´çš„ç”¨æ³•ã€‚å¦‚æœå¤§ä»“å¯¹åº”çš„æœåŠ¡é›†ç¾¤æœ‰å¾ˆå¤šä¸‰æ–¹ä¾èµ–ï¼Œæœ‰å¾ˆå¤šé”™ç»¼å¤æ‚çš„æ¨¡å—çš„è¯ï¼Œå¯¹ä¸‰æ–¹ä¾èµ–åšä¸€å±‚æŠ½è±¡ï¼ŒåŠ ä¸Šç”¨wireå»è§£å†³é‡å¤ä¾èµ–é—®é¢˜ï¼Œæ˜¯æœ€ä¸ºèˆ’é€‚çš„ä¸€å¥—è§£æ³•ã€‚å½“ç„¶åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå…¶å®ƒå„æ¨¡å—ï¼Œå°¤å…¶æ˜¯å…¬æœ‰æ¨¡å—ï¼ˆlibï¼‰éœ€è¦å¦‚ä½•åšä»£ç å®ç°ï¼Œè¿™éƒ¨åˆ†æ˜¯éœ€è¦é¢å¤–æ¨æ•²çš„ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æµ…èŠä¸€ä¸‹ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆå…ˆçœ‹å…¬æœ‰æ¨¡å—çš„ä¾èµ–å…³ç³»å¦‚ä½•ã€‚æœ€åº•å±‚çš„è¯ä¸€èˆ¬æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼ˆidlã€protoã€modelä¹‹ç±»ï¼‰ä»¥åŠè‡ªå·±å®šä¹‰çš„commonå¸¸é‡æšä¸¾ä¹‹ç±»ï¼Œç„¶åå†ä¸Šé¢æ˜¯utilsï¼Œå†ä¸Šé¢æ‰æ˜¯ä¸‰æ–¹ä¾èµ–clients/dalï¼Œä¹‹åæ‰æ˜¯å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚è‡ªåŠ¨ç”Ÿæˆçš„è¿™ä¸ªæ²¡æ³•æ‰‹å†™ï¼Œç„¶åcommonä¹Ÿæ¯”è¾ƒè‡ªç”±ï¼Œä¿è¯åœ¨utilsä¹‹ä¸‹å°±å¯ä»¥ã€‚</p>
<p>å¯¹äºutilsï¼Œè¿™éƒ¨åˆ†æ¯”è¾ƒå…³é”®ã€‚ç¬”è€…åšä»£ç ç»„ç»‡çš„æ–¹å¼æ˜¯åˆ†ä¸‰ä¸ªå­å±‚æ¬¡ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>æœ€åº•å±‚ï¼šæ”¾åˆ°utilsä¸‹é¢çš„å­ç›®å½•ï¼Œé‡Œé¢æ”¾çš„æ˜¯åŸºäºruntime-librarieså¾€ä¸Šçš„ä¸€äº›æŠ½è±¡ã€‚æ¯”å¦‚ï¼Œå¯¹äºjsonæ•°æ®çš„å„ç§å¤„ç†æ–¹æ³•ï¼Œå¦‚æœä¸€æ—¶åŠä¼šæ‰¾ä¸åˆ°åˆé€‚çš„åº“ï¼Œå°±å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªï¼Œæ”¾åˆ°è¿™ä¸ªå­ç›®å½•ä¸‹é¢ã€‚</li>
<li>ä¸­é—´å±‚ï¼šå³utilså½“å‰å±‚æ¬¡çš„å„ç§å‡½æ•°ï¼Œæ¯”å¦‚æœ‰ä¸ªutils.goæ–‡ä»¶é‡Œé¢ä¸€ä¸ªGetEnvå‡½æ•°ï¼Œå°±å±äºè¿™ä¸€å±‚ã€‚è¿™ä¸€å±‚å‡½æ•°çš„ä½œç”¨æ˜¯æŠŠæ•´ä¸ªæœåŠ¡çš„é€šç”¨åŠŸèƒ½å°è£…èµ·æ¥ï¼Œå¯ä»¥å…·å¤‡å°‘é‡çš„ä¸šåŠ¡æ€§è´¨ï¼Œå°¤å…¶æ˜¯å’ŒæœåŠ¡æ‰€åœ¨ç¯å¢ƒç›¸å…³çš„å·¥å…·å‡½æ•°ï¼Œå°±éƒ½æ”¾åˆ°è¿™ä¸€å±‚ã€‚</li>
<li>æœ€é¡¶å±‚ï¼šé¡¶å±‚çš„utilséœ€è¦å…·å¤‡ä¸€äº›ä¸šåŠ¡å«ä¹‰ï¼Œæ¯”å¦‚ç»“åˆæœåŠ¡ç¯å¢ƒå’Œcommoné‡Œé¢ä¸€äº›ä¸šåŠ¡ç±»æšä¸¾ï¼Œè¡ç”Ÿå‡ºæ¥çš„ä¸€äº›ä¸šåŠ¡utilsã€‚è¿™ç±»utilsçš„ä»£ç ç»„ç»‡ï¼Œå¯ä»¥å°è£…æˆstructï¼Œæ¯”å¦‚UserUtilsï¼Œç„¶åå†ç»™ä¸€ä¸ª<code>var User = &amp;UserUtils{}</code>ï¼Œè¿™æ ·å…¶å®ƒåœ°æ–¹è°ƒç”¨å°±å¯ä»¥ç›´æ¥<code>utils.User.XXXX</code>æ¥å»å†™ï¼Œéå¸¸ç®€æ´æ˜äº†ã€‚</li>
</ul>
<p>ç„¶åå†å¾€ä¸Šä¸‰æ–¹ä¾èµ–clients/dalã€‚è¿™éƒ¨åˆ†ç¬”è€…å»ºè®®æ˜¯åšè‡ªä¸»æŠ½è±¡ï¼Œæ¯”å¦‚mysqlä¸è¦ç›´æ¥æš´éœ²gorm.DBï¼Œredisä¹Ÿä¸è¦æš´éœ²go-redisï¼Œè€Œæ˜¯åœ¨è¿™äº›clientä¸Šé¢åšäºŒæ¬¡å°è£…ï¼Œç„¶åæŠŠäºŒæ¬¡å°è£…çš„clientç»™provideåˆ°å„ä¸ªæœåŠ¡é‡Œé¢ã€‚è¿™æ ·åšçš„å¥½å¤„ï¼Œä¸€æ˜¯å¯ä»¥è‡ªä¸»å®šä¹‰ä¸€äº›æ•°æ®æ“ä½œï¼ŒäºŒæ˜¯å¯ä»¥èµ‹äºˆclientæ›´å¤šçš„ä¸šåŠ¡æ¶µä¹‰ï¼Œè¿™æ ·ä»æ¯ä¸ªæœåŠ¡è§’åº¦ï¼Œå°±å½»åº•ä¸éœ€è¦å…³å¿ƒå…·ä½“æ•°æ®è®¿é—®åº•å±‚æ€ä¹ˆå®ç°äº†ã€‚</p>
<p>å¯¹äºæ´‹è‘±å±‚çš„middlewareï¼Œç¬”è€…çš„å»ºè®®ä¹Ÿæ˜¯åœ¨libé‡Œé¢å•ç‹¬å¼€ä¸€ä¸ªmiddlewareæ¨¡å—ï¼Œç”¨æ¥å°è£…æœåŠ¡å¸¸ç”¨çš„middlewareï¼Œæ¯”å¦‚corsã€token+rbacé‰´æƒè¿™ç§ã€‚ä¸ºä»€ä¹ˆå•ç‹¬å¼€ï¼ŒåŸå› ä¸€æ˜¯ç›¸åŒçš„middlewareä¼šåœ¨å¤šä¸ªæœåŠ¡ä½¿ç”¨ï¼ŒäºŒæ˜¯æ¯”å¦‚é‰´æƒçš„middlewareå°±ä¾èµ–é‰´æƒclientã€‚æ‰€ä»¥è¿™æ ·æœ€å¥½çš„æ–¹å¼å°±æ˜¯åœ¨libé‡Œé¢å¼€middlewareï¼Œç„¶åæ¯ä¸ªæœåŠ¡å¼€æœæ—¶å€™å»ç¼–å†™<code>r.Use(middleware.Auth(ctx, jwtClient))</code>è¿™ç§æ ·å¼çš„ä»£ç ï¼Œè¿™æ ·ä¹Ÿéå¸¸ç®€æ´ã€‚</p>
<p>å¯¹äºserviceæ˜¯å¦è¦åœ¨libé‡Œå•å¼€ï¼Œç¬”è€…çš„æƒ³æ³•æ˜¯ä¸å¼€æ¯”è¾ƒåˆé€‚ã€‚è¿™ç±»çº¯ä¸šåŠ¡é€»è¾‘ï¼Œè¦ä¹ˆå¾—ä¸‹æ²‰åˆ°lib.clientï¼Œè¦ä¹ˆå¾—ä¸Šæµ®åˆ°appé‡Œé¢æ¯ä¸ªå­serviceé‡Œé¢æ¯”è¾ƒåˆé€‚ï¼Œæ¯”èµ·ç”¨ä»£ç ï¼Œæ›´å€¾å‘äºç”¨æœåŠ¡é—´çš„æ‹“æ‰‘è°ƒç”¨å»è§£é‡Šè¿™å±‚å…³ç³»ï¼ŒæœåŠ¡ä¹‹é—´å¼€æ¥å£ï¼Œé€šè¿‡è‡ªåŠ¨ç”Ÿæˆä»£ç çš„æ–¹å¼å»ç”Ÿæˆå„ä¸ªæœåŠ¡çš„clientï¼Œè¿™æ ·æ‰æ¯”è¾ƒæ˜ç¡®æ¯ä¸ªæœåŠ¡çš„èŒè´£ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>monorepo</tag>
        <tag>ç¼–ç¨‹</tag>
        <tag>Golang</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘æ–°æ‰‹å°ç™½è¶…é¢‘é‡åˆ°é»‘å±é—®é¢˜è§£å†³åˆ†äº«</title>
    <url>/2025/05/02/diymemo/overclock_voltage/</url>
    <content><![CDATA[<p>æœ€è¿‘ç©FPSæ¸¸æˆçš„æ—¶å€™ï¼Œå‘ç°ä»¥å‰<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjQvMTAvMTMvZGl5bWVtby9vdmVyY2xvY2tfdHJ5Lw==" title="https://utmhikari.top/2024/10/13/diymemo/overclock_try/">ä¸€é¡¿æ“ä½œ<i class="fa fa-external-link"></i></span>è¶…é¢‘ä¹‹åçš„ç”µè„‘ï¼Œæœ‰ä¸€å®šæ¦‚ç‡ä¼šå‡ºé—®é¢˜ã€‚å…·ä½“è¡¨ç°æ¯”å¦‚ä¸€ç§æ˜¯ï¼Œç”µè„‘æ˜¾ç¤ºå™¨ç›´æ¥é»‘å±ï¼Œæ‰€æœ‰é”®ç›˜äº¤äº’æ²¡æœ‰å“åº”ï¼Œåªèƒ½ç›´æ¥é‡å¯ç”µè„‘ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯å¶ç°å¡é¡¿ï¼Œç›´æ¥æ­»æœºæˆ–è€…å¡å‡ºæ¸¸æˆä¹‹å¤–ã€‚</p>
<p>ç»è¿‡æ’æŸ¥å’Œä¸Šç½‘æŸ¥èµ„æ–™å‘ç°ï¼Œå¯èƒ½æ˜¯ç”±äºè¶…é¢‘ä¹‹åï¼ŒCPUçš„ç”µå‹è¾“å‡ºä¸ç¨³å®šï¼Œå¯¼è‡´å¶ç°æ˜¾ç¤ºå™¨åˆ†é…åˆ°çš„ç”µå‹æ¯”è¾ƒå°‘ï¼Œæœ€ç»ˆæ— æ³•æ­£å¸¸å·¥ä½œã€‚å¯¹äºè¿™ç±»æƒ…å†µï¼Œç¬”è€…åˆ†äº«ä¸‹è‡ªå·±çš„ä¸€äº›è§£å†³æ–¹æ¡ˆï¼š</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯çœ‹ä¸€ä¸‹è‡ªå·±çš„æ¸¸æˆé…ç½®ï¼Œå¦‚æœè‡ªå·±ç³»ç»Ÿè¶…è´Ÿè·äº†ï¼Œå°±é€‚å½“å‡å°‘ä¸€äº›å‹åŠ›ã€‚æ¯”å¦‚ç¬”è€…çš„caseæ˜¯ï¼Œé¼ æ ‡çš„åˆ·æ–°ç‡è°ƒé«˜åˆ°4000ï¼ŒNVIDIAä½å»¶è¿Ÿè°ƒæˆäº†å¢å¼ºï¼Œé‚£ä¹ˆè¿™ä¼šç»™CPUå¸¦æ¥æ¯”è¾ƒé«˜çš„è´Ÿè·ï¼Œæ‰€ä»¥å¯ä»¥é€‚å½“é™ä½é¼ æ ‡çš„åˆ·æ–°ç‡ï¼Œä½å»¶è¿Ÿè®¾ç½®å¯ä»¥è°ƒæ•´æˆæ™®é€šæ¨¡å¼ã€‚å¦å¤–æ¸¸æˆå¦‚æœä¸é™å¸§æ•°çš„è¯ï¼Œå¯ä»¥æ ¹æ®æ¸¸æˆçš„å®é™…è¡¨ç°é€‚å½“å¯¹FPSåšé™åˆ¶ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥å‡å°‘æ˜¾å¡å‹åŠ›ï¼Œé¿å…å‡ºç°é»‘å±æƒ…å†µã€‚</p>
<p>ç„¶åæ˜¯åœ¨BIOS é‡Œé¢ï¼Œå¯ä»¥å¯¹ç”µå‹è´Ÿè½½åšä¸€äº›è°ƒæ•´ã€‚å¦‚æœæ˜¯æŠ€å˜‰ AORUS çš„ä¸»æ¿ï¼Œå¯ä»¥è°ƒæ•´ Voltageçš„ä¸€äº›Settingsï¼Œæ¯”å¦‚Internal AC/DC Load lineï¼Œæˆ–è€…åƒç¬”è€…æ˜¯è°ƒæ•´CPU VCore Loadline Calibrationæ›²çº¿åˆ°Extremeï¼Œè¿™æ ·é™å‹å°±ä¸ä¼šå¤ªå¤šã€‚å¦‚æœæ˜¯å¾®æ˜Ÿä¸»æ¿ï¼Œå¯ä»¥è°ƒæ•´ CPU Lite Loadçš„æ¨¡å¼å»è¡¥ä¸€äº›ç”µå‹ï¼Œå½“ç„¶å¦‚æœä½ æœºå™¨æ•£çƒ­ä¸å¥½çš„è¯ï¼Œå¯ä»¥åƒç¬”è€…ä¸€æ ·ï¼Œåœ¨æ•°ä½ç”µå‹è®¾ç½®é‡Œé¢ï¼ŒæŠŠCPUé‡è½½çº¿æ ¡å‡†æ§åˆ¶è°ƒæ•´åˆ°Mode3å·¦å³ï¼Œè¿™æ ·è´Ÿè½½ä¹Ÿå°±é™çš„ä¸ä¼šå¤ªå¤šäº†ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>é—®é¢˜æ’æŸ¥</tag>
        <tag>è¶…é¢‘</tag>
        <tag>ç¡¬ä»¶</tag>
        <tag>æ€§èƒ½æµ‹è¯•</tag>
        <tag>ç”µå‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘mcp-goï¼ŒMCPåè®®çš„Golang-SDK</title>
    <url>/2025/04/12/githubdiscovery/mcp_go/</url>
    <content><![CDATA[<p>è¿‘æœŸå¤§æ¨¡å‹Agentåº”ç”¨å¼€å‘æ–¹é¢ï¼ŒMCPçš„æ¦‚å¿µæ¯”è¾ƒæµè¡Œï¼ŒåŸºäºMCPçš„ToolServerèƒ½åŠ›å¼€å‘ä¹Ÿé€æ¸æˆä¸ºä¸»æµè¶‹åŠ¿ã€‚ç”±äºç¬”è€…å·¥ä½œåŸå› ï¼Œä¸»åŠ›æ˜¯Goè¯­è¨€ï¼Œä¸ºäº†è°ƒç ”å¤§æ¨¡å‹åº”ç”¨å¼€å‘ï¼Œä¹Ÿæ¥è§¦åˆ°äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21hcmszbGFicy9tY3AtZ28=" title="https://github.com/mark3labs/mcp-go">mcp-go<i class="fa fa-external-link"></i></span>è¿™å¥—MCPçš„SDKå®ç°ã€‚</p>
<p>å¯¹äºä¼ä¸šå†…éƒ¨è€Œè¨€ï¼Œåœ¨è¿™ä¸ªSDKåŸºç¡€ä¸Šåšå°è£…ï¼ŒåŸºæœ¬ä¸Šå°±èƒ½å¤Ÿå®Œå–„MCP-Serverçš„å¼€å‘ç”Ÿæ€ã€‚å› æ­¤ä»Šå¤©å°±ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸ªSDKé‡Œé¢ï¼Œå®ç°äº†ä»€ä¹ˆä¸œè¥¿ã€‚</p>
<p>é¦–å…ˆæ˜¯Clientè¿æ¥çš„å®ç°ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°æ¯æ¬¡è¿æ¥éƒ½éœ€è¦InitializeRequestã€InitializeResultä»¥åŠInitializeNotificationè¿™<span class="exturl" data-url="aHR0cHM6Ly9tb2RlbGNvbnRleHRwcm90b2NvbC5pby9kb2NzL2NvbmNlcHRzL2FyY2hpdGVjdHVyZQ==" title="https://modelcontextprotocol.io/docs/concepts/architecture">ä¸‰æ¬¡æ¡æ‰‹<i class="fa fa-external-link"></i></span>ã€‚ä»Clientè§’åº¦çœ‹é€»è¾‘æ˜¯è¿™æ ·ï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *StdioMCPClient)</span> <span class="title">Initialize</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	ctx context.Context,</span></span></span><br><span class="line"><span class="function"><span class="params">	request mcp.InitializeRequest,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="params">(*mcp.InitializeResult, error)</span></span> &#123;</span><br><span class="line">	<span class="comment">// This structure ensures Capabilities is always included in JSON</span></span><br><span class="line">	params := <span class="keyword">struct</span> &#123;</span><br><span class="line">		ProtocolVersion <span class="keyword">string</span>                 <span class="string">`json:"protocolVersion"`</span></span><br><span class="line">		ClientInfo      mcp.Implementation     <span class="string">`json:"clientInfo"`</span></span><br><span class="line">		Capabilities    mcp.ClientCapabilities <span class="string">`json:"capabilities"`</span></span><br><span class="line">	&#125;&#123;</span><br><span class="line">		ProtocolVersion: request.Params.ProtocolVersion,</span><br><span class="line">		ClientInfo:      request.Params.ClientInfo,</span><br><span class="line">		Capabilities:    request.Params.Capabilities, <span class="comment">// Will be empty struct if not set</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	response, err := c.sendRequest(ctx, <span class="string">"initialize"</span>, params)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> result mcp.InitializeResult</span><br><span class="line">	<span class="keyword">if</span> err := json.Unmarshal(*response, &amp;result); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">"failed to unmarshal response: %w"</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Store capabilities</span></span><br><span class="line">	c.capabilities = result.Capabilities</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Send initialized notification</span></span><br><span class="line">	notification := mcp.JSONRPCNotification&#123;</span><br><span class="line">		JSONRPC: mcp.JSONRPC_VERSION,</span><br><span class="line">		Notification: mcp.Notification&#123;</span><br><span class="line">			Method: <span class="string">"notifications/initialized"</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	notificationBytes, err := json.Marshal(notification)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(</span><br><span class="line">			<span class="string">"failed to marshal initialized notification: %w"</span>,</span><br><span class="line">			err,</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line">	notificationBytes = <span class="built_in">append</span>(notificationBytes, <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> _, err := c.stdin.Write(notificationBytes); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(</span><br><span class="line">			<span class="string">"failed to send initialized notification: %w"</span>,</span><br><span class="line">			err,</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	c.initialized = <span class="literal">true</span></span><br><span class="line">	<span class="keyword">return</span> &amp;result, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¡æ‰‹çš„æ ¡éªŒå½“å‰è¿˜æ¯”è¾ƒç²—ç³™ï¼Œæ²¡æœ‰å¯¹ç‰ˆæœ¬å·ä¹‹ç±»çš„å…¼å®¹æ€§åšæ ¡éªŒã€‚ä¸¤æ¬¡æ¡æ‰‹åClientç¡®è®¤Notificationï¼ˆå•å‘æ¶ˆæ¯ï¼‰å¯ä»¥å‘å‡ºå»ï¼Œå°±ä»£è¡¨å¯ä»¥å»ºç«‹è¿æ¥äº†ã€‚</p>
<p>ä»åˆ©äºåº”ç”¨å¼€å‘çš„è§’åº¦ï¼Œå¼€å‘æ¡†æ¶æœ‰SDKçš„è¯ï¼Œæœ€å¥½æ˜¯å†å°è£…ä¸€å±‚ClientæŠŠInitializeæ¡æ‰‹æ­¥éª¤ä¹Ÿä»£ç†æ‰ï¼Œç„¶åæŠŠå…¶ä»–List/Callåè®®ä¹Ÿå°è£…æˆæ¥å£ï¼Œè¿™æ ·å¯¹å¼€å‘è€…æ¯”è¾ƒæ–¹ä¾¿ä¸€äº›ã€‚</p>
<p>ç„¶åçœ‹Serverç«¯çš„å®ç°ï¼Œä¸»è¦åŒ…æ‹¬ï¼šèµ„æº/Prompt/Toolçš„ç®¡ç†ã€C2Sçš„Notificationçš„å¤„ç†ï¼Œä»¥åŠS2Cå•ç‚¹Notificationè·Ÿå¹¿æ’­èƒ½åŠ›ã€‚è¯´ç™½äº†å°±æ˜¯æ— çŠ¶æ€ã€é•¿è¿æ¥éƒ½åŒæ—¶èƒ½æ”¯æŒä¸Šã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// NewMCPServer creates a new MCP server instance with the given name, version and options</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewMCPServer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">	name, version <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">	opts ...ServerOption,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> *<span class="title">MCPServer</span></span> &#123;</span><br><span class="line">	s := &amp;MCPServer&#123;</span><br><span class="line">		resources:            <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]resourceEntry),</span><br><span class="line">		resourceTemplates:    <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]resourceTemplateEntry),</span><br><span class="line">		prompts:              <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]mcp.Prompt),</span><br><span class="line">		promptHandlers:       <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]PromptHandlerFunc),</span><br><span class="line">		tools:                <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]ServerTool),</span><br><span class="line">		name:                 name,</span><br><span class="line">		version:              version,</span><br><span class="line">		notificationHandlers: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]NotificationHandlerFunc),</span><br><span class="line">		capabilities: serverCapabilities&#123;</span><br><span class="line">			tools:     <span class="literal">nil</span>,</span><br><span class="line">			resources: <span class="literal">nil</span>,</span><br><span class="line">			prompts:   <span class="literal">nil</span>,</span><br><span class="line">			logging:   <span class="literal">false</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, opt := <span class="keyword">range</span> opts &#123;</span><br><span class="line">		opt(s)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åº”ç”¨è§’åº¦å°±æ¯”è¾ƒç®€å•äº†ï¼ŒServerç«¯å¯ä»¥åŸºäºexamples/everything/main.goçš„å®ç°åšæ‰©å±•ï¼ŒClientç«¯é•¿æœŸæ¥çœ‹ç”¨SSEçš„è¿æ¥æ–¹å¼æ¯”è¾ƒå¤šï¼Œå‚è€ƒclient/sse_test.goçš„å®ç°åšæ‰©å……å³å¯ã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>AI</tag>
        <tag>LLM</tag>
        <tag>MCP</tag>
        <tag>mcp-go</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘æµ…èŠåŸºäºMCPç”Ÿæ€çš„LLM-Agentå¼€å‘</title>
    <url>/2025/04/12/geekdaily/mcp_llm_agent/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨AIå¤§æ¨¡å‹é¢†åŸŸï¼ŒMCPè¿™ä¸ªæ¦‚å¿µéå¸¸ç«ï¼Œå¤§å¤§å°å°çš„å…¬ä¼—å·éƒ½å¼€å§‹å¯¹å¤–ç‚’ä½œè¿™ä¸ªæ¦‚å¿µï¼Œå®£æ•™ä¸€ç§æ–°çš„å¤§æ¨¡å‹Agentå¼€å‘ç”Ÿæ€ã€‚å› ä¸ºå·¥ä½œåŸå› ï¼Œè¿‘æœŸç¬”è€…ä¹Ÿå¯¹MCPå’ŒLLM-Agentå¼€å‘åšäº†ä¸€äº›æ¥è§¦ã€‚å› æ­¤ä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æµ…èŠä¸‹ç¬”è€…å¯¹åŸºäºMCPçš„LLM-Agentå¼€å‘æ–¹é¢ï¼Œè‡ªå·±ç²—æµ…çš„ä¸€äº›ç†è§£ã€‚</p>
<p>é¦–å…ˆè¿˜æ˜¯èŠä¸€ä¸‹ä»€ä¹ˆæ˜¯MCPï¼Œä»¥åŠMCPåœ¨LLM-Agentå¼€å‘æ–¹é¢ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚</p>
<a id="more"></a>
<p>MCPï¼ˆModel Context Protocolï¼Œæ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼‰æ˜¯ç”±<span class="exturl" data-url="aHR0cHM6Ly9tb2RlbGNvbnRleHRwcm90b2NvbC5pby9pbnRyb2R1Y3Rpb24=" title="https://modelcontextprotocol.io/introduction">åšClaudeçš„å…¬å¸<i class="fa fa-external-link"></i></span>åˆ¶å®šçš„ï¼Œå…¶ä¸»è¦çš„ä½œç”¨æ˜¯å¯¹å¤§æ¨¡å‹è®¿é—®ä¸‰æ–¹èƒ½åŠ›ï¼ˆOpenAPIã€å¤šæ¨¡æ€æ•°æ®æºï¼‰å®šä¸‹è§„èŒƒã€‚æƒ³è±¡ä¸‹ï¼Œä¸ç®¡æ˜¯æœ¬åœ°éƒ¨ç½²çš„å¤§æ¨¡å‹è¿˜æ˜¯remoteçš„agentï¼Œæˆ–å¤šæˆ–å°‘éƒ½æœ‰è®¿é—®æœ¬åœ°DBã€è°ƒç”¨å¤–éƒ¨OpenAPIï¼Œæˆ–è€…è·å–å¤–éƒ¨çš„Promptæ–‡æœ¬ã€å›¾ç‰‡ç­‰å¤šæ¨¡æ€èµ„æºçš„éœ€æ±‚ï¼Œè€Œå¯¹äºæ¨¡å‹æœ¬èº«æ¥è®²ï¼Œæ¨¡å‹è‡ªå·±åªèƒ½ç†è§£è‡ªç„¶è¯­è¨€ï¼Œåå€’ç»“æ„åŒ–çš„æ•°æ®ä¸å¥½å»ç†è§£ï¼Œæ‰€ä»¥å¯¹äºAgentå¼€å‘è€…ï¼Œè¿˜éœ€è¦èŠ±å¾ˆå¤šç²¾åŠ›å»å°è£…è¿™äº›ä¸‰æ–¹èƒ½åŠ›ï¼Œæ‰èƒ½å¤Ÿè®©æ¨¡å‹åšæ¯”è¾ƒç²¾ç¡®çš„æ„å›¾è¯†åˆ«ã€‚è€ŒMCPå°±é€šè¿‡ä¸€å¥—åè®®çº¦å®šï¼Œå»è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸åŒçš„ä¸‰æ–¹èƒ½åŠ›ç”¨åŒä¸€å¥—æè¿°æ–¹å¼åšæ‰“æ ‡ï¼Œå¹¶ä¸”åœ¨æ•°æ®ä¼ è¾“å±‚ä¹Ÿå°è£…äº†stdioå’Œsseä¸¤å¥—æ–¹æ¡ˆï¼Œä»è€Œåˆ†åˆ«æ»¡è¶³è®¿é—®æœ¬åœ°èµ„æºå’Œè®¿é—®å¤–éƒ¨èµ„æºçš„éœ€æ±‚ã€‚</p>
<p>ç»“åˆ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmFudGhyb3BpYy5jb20vZW4vZG9jcy9idWlsZC13aXRoLWNsYXVkZS90b29sLXVzZS9vdmVydmlldw==" title="https://docs.anthropic.com/en/docs/build-with-claude/tool-use/overview">Tool use with Claude<i class="fa fa-external-link"></i></span>è¿™ç¯‡æ–‡ç« ï¼Œå¯ä»¥æ›´å¥½ç†è§£MCPè¦è§£å†³çš„é—®é¢˜ã€‚æ¯”å¦‚å¯¹äºClaudeå¤§æ¨¡å‹å®¢æˆ·ç«¯ï¼ŒCallToolçš„è¿‡ç¨‹ï¼Œå…ˆæ˜¯æ ¹æ®UserPromptå»è¯†åˆ«å†³å®šè¦ç”¨å“ªä¸ªToolï¼Œç„¶åæ‰æ˜¯è°ƒç”¨ï¼Œæ‹¿åˆ°ç»“æœåå¤„ç†æˆæ–‡æœ¬å†è¿”å›ã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly9nbGFtYS5haS9ibG9nLzIwMjQtMTEtMjUtbW9kZWwtY29udGV4dC1wcm90b2NvbC1xdWlja3N0YXJ0" title="https://glama.ai/blog/2024-11-25-model-context-protocol-quickstart">è¿™ç¯‡æ–‡æ¡£<i class="fa fa-external-link"></i></span>é‡Œé¢ä¹Ÿå¯ä»¥çœ‹åˆ°æ¯ä¸ªToolå®šä¹‰çš„æ ·å­ï¼Œä¸€èˆ¬ç”¨nameã€descriptionï¼ˆç”¨é€”ï¼‰å’ŒinputSchemaï¼ˆå…¥å‚æ ‡æ³¨ï¼‰ï¼Œå°±å¯ä»¥æ»¡è¶³æ¨¡å‹åšç”¨é€”è¯†åˆ«å’Œå‚æ•°è¯†åˆ«çš„éœ€è¦ã€‚</p>
<p>MCPåè®®ç›¸å½“äºå¯¹å¤§æ¨¡å‹çš„å‰ç«¯ï¼ˆAgentåº”ç”¨ï¼‰å’Œåç«¯ï¼ˆä¸‰æ–¹å·¥å…·ï¼‰åšäº†åˆ†ç¦»ï¼Œæä¾›äº†æ ‡å‡†åŒ–ä¸”å…·å¤‡å®‰å…¨æ€§çš„åè®®ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼ŒMCP-Serverçš„å¸‚åœºç”Ÿæ€ä¹Ÿè¡ç”Ÿäº†å‡ºæ¥ã€‚æ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly9tY3Auc28v" title="https://mcp.so/">mcp.so<i class="fa fa-external-link"></i></span>ï¼Œä½œä¸ºä¸€ä¸ªç±»ä¼¼â€œç½‘å…³â€çš„è§’è‰²ï¼Œå®ç°äº†å¤§è§„æ¨¡MCP-Serverçš„åœ¨çº¿æ‰˜ç®¡ï¼ŒåŒæ ·è¿‘æœŸé˜¿é‡Œäº‘ä¹Ÿæä¾›äº†<span class="exturl" data-url="aHR0cHM6Ly9iYWlsaWFuLmNvbnNvbGUuYWxpeXVuLmNvbS8mYW1wO3RhYj1tY3AjL21jcC1tYXJrZXQ=" title="https://bailian.console.aliyun.com/&amp;tab=mcp#/mcp-market">MCPå¹¿åœº<i class="fa fa-external-link"></i></span>çš„æœåŠ¡ã€‚çœ‹èµ·æ¥è¿™ç§æ¨¡å¼å’Œä¼ ç»Ÿçš„Web-OpenAPIå¸‚åœºæ¯”è¾ƒç±»ä¼¼ï¼Œä½†ä¸åŒç‚¹åœ¨äºMCPä¸»è¦é¢å‘å¤§æ¨¡å‹æœåŠ¡ï¼Œèƒ½å¤Ÿæä¾›å¤šæ¨¡æ€çš„æ•°æ®ï¼ŒWeb-OpenAPIå¹¶ä¸é‡è§†è¿™ä¸ªï¼Œæ‰€ä»¥è¿™ä¸ªæ¦‚å¿µä¹Ÿä¸ç®—éå¸¸é‡å¤ã€‚</p>
<p>å¯¹äºAgentå¼€å‘è€…è€Œè¨€ï¼Œè¦å°è£…ä¸‰æ–¹å·¥å…·ï¼Œé™¤äº†ä»¥å¾€è‡ªä¸»å°è£…æˆ–è€…ä¾é æ¡†æ¶çº¦å®šåšå°è£…ä¹‹å¤–ï¼Œç°åœ¨ä¹Ÿå¯ä»¥ç›´æ¥åˆ©ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21hcmszbGFicy9tY3AtZ28=" title="https://github.com/mark3labs/mcp-go">mcp-go<i class="fa fa-external-link"></i></span>ä¹‹ç±»çš„SDKï¼Œç›´æ¥é€šè¿‡ListToolsã€CallToolç­‰æ“ä½œå®ç°å·¥å…·è°ƒç”¨ï¼Œå¹¶ä¸”å„ç±»æ¡†æ¶ç°åœ¨ä¹Ÿåœ¨é€æ¸è·Ÿè¿›åŸºäºMCPåè®®çš„ä¸‰æ–¹è°ƒç”¨æ¨¡å¼ã€‚ä»é•¿è¿œä¸Šæ¥çœ‹ï¼Œè¿™ç§æ¨¡å¼ç”±å¾ˆå¤§çš„å‘å±•ç©ºé—´ï¼Œä½†çŸ­æœŸæ¥çœ‹ï¼Œè¿™å¥—è¿æ¥çš„ç¨³å®šå¯ç”¨æ€§SLAä¿éšœåŸºå»ºå…¶å®è¿˜æ¯”è¾ƒæ¬ ç¼ºã€‚æ‰€ä»¥ä¸ªäººå»ºè®®å¯¹äºAgentå¼€å‘è€…æ¥è¯´ï¼Œé‡ç‚¹è¿˜æ˜¯å»æ‰“ç£¨è‡ªå·±çš„Toolèƒ½åŠ›æˆ–Agentæ•ˆæœï¼Œä½†ä¹Ÿè¦ä¸ºé•¿æœŸæŠŠToolè¿ç§»åˆ°MCPç”Ÿæ€åšå‡†å¤‡ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>Agent</tag>
        <tag>LLM</tag>
        <tag>MCP</tag>
        <tag>åè®®</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘Goå¤§ä»“monorepoä¸­ä½¿ç”¨wireåšä¾èµ–æ³¨å…¥çš„ç»éªŒ</title>
    <url>/2025/04/04/archiart/go_monorepo_wire/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkuYmxvZy5jc2RuLm5ldC9hcnRpY2xlL2RldGFpbHMvMTQ2MTM0MDI0" title="https://utmhikari.blog.csdn.net/article/details/146134024">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>å½“ä¸­ï¼Œç¬”è€…åˆ†äº«äº†ä¸€å¥—ç®€æ´çš„goå¾®æœåŠ¡monorepoä»£ç æ¶æ„çš„å®ç°ï¼Œä¸»è¦è§£å†³ä¸­å°å›¢é˜ŸååŒå¼€å‘å¾®æœåŠ¡é›†ç¾¤çš„ä»£ç æ¶æ„ç»„ç»‡é—®é¢˜ã€‚ä½†æ˜¯åœ¨å®é™…ä»£ç å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ€ä¹ˆç»„ç»‡ä¸åŒçš„ä¸šåŠ¡æœåŠ¡serviceå®ä¾‹ï¼Œå°±æˆäº†æ¯”è¾ƒæ£˜æ‰‹çš„é—®é¢˜ã€‚</p>
<p>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„åœºæ™¯ï¼Ÿé¦–å…ˆï¼Œä¸åŒçš„ä¸šåŠ¡æœåŠ¡å¯èƒ½ä¼šç”¨åˆ°ç›¸åŒçš„åº•å±‚æœåŠ¡ï¼Œæ¯”å¦‚DBã€ç¼“å­˜ã€MQä»¥åŠä¸‰æ–¹Clientç­‰ç­‰ã€‚å…¶æ¬¡ï¼Œä¸€ä¸ªåº•å±‚æœåŠ¡å®ä¾‹å¯èƒ½ä¼šåœ¨å¤šä¸ªä¸šåŠ¡æœåŠ¡å¤ç”¨ï¼Œä¸€ä¸ªä¸šåŠ¡æœåŠ¡åˆå¯èƒ½æˆä¸ºå¦å¤–ä¸€ä¸ªä¸šåŠ¡æœåŠ¡çš„ä¾èµ–ã€‚å› æ­¤è¿™æ ·ä¸‹æ¥ï¼Œä¸åŒæœåŠ¡å®ä¾‹ä¹‹é—´å°±å­˜åœ¨é”™ç»¼å¤æ‚çš„è”ç³»ï¼Œç”¨ä»£ç ç»„ç»‡èµ·æ¥å°±æ¯”è¾ƒå›°éš¾äº†ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬æ‹¥æœ‰wireå·¥å…·å»åšgoå¯¹è±¡çš„ä¾èµ–æ³¨å…¥ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨ç®€å•çš„ä»£ç å®ç°è§£å†³ä¸Šè¿°é—®é¢˜ã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkuYmxvZy5jc2RuLm5ldC9hcnRpY2xlL2RldGFpbHMvMTI4MTYxNzM4" title="https://utmhikari.blog.csdn.net/article/details/128161738">ä»¥å‰çš„wireæ–‡ç« <i class="fa fa-external-link"></i></span>å½“ä¸­ï¼Œä¹Ÿç®€å•æåˆ°äº†wireå¯¹äºå¾®æœåŠ¡æ¡†æ¶çš„ä½œç”¨ï¼Œä½†è®²è§£çš„ä¸ç®—ç‰¹åˆ«ç²¾è¦ã€‚æ‰€ä»¥ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œç¬”è€…å°±åˆ†äº«ä¸‹åœ¨goå¤§ä»“çš„åœºæ™¯ä¸‹ï¼Œæ€ä¹ˆç”¨wireå»è§£å†³serviceå®ä¾‹ä¾èµ–é—®é¢˜çš„ï¼Œä»¥åŠæ€æ ·æ‰æ˜¯æ›´åŠ æ°å½“çš„æ‰“å¼€æ–¹å¼ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“wireå·¥å…·å¯¹å¤–æš´éœ²äº†ä»€ä¹ˆèƒ½åŠ›ï¼Œæœ‰ä»¥ä¸‹ä¸€äº›ï¼š</p>
<a id="more"></a>
<ul>
<li>NewSetï¼šå£°æ˜ä¸€ç»„Providerï¼ŒProviderå¯ä»¥æ˜¯å¯¹è±¡çš„Constructor/Factoryï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–Provider</li>
<li>Valueï¼šæŠŠä¸€ä¸ªç‰¹å®šçš„å¯¹è±¡ç»™Provideå‡ºå»</li>
<li>InterfaceValueï¼šæŠŠä¸€ä¸ªç‰¹å®šçš„interfaceå¯¹è±¡ç»™Provideå‡ºå»ï¼ˆæ¯”å¦‚context.Contextï¼‰</li>
<li>Structï¼šæŠŠä¸€ä¸ªstructç»™Provideå‡ºå»ï¼ŒåŒæ—¶å¯æŒ‡å®šå…·ä½“è¦è¢«æ›´åº•å±‚æ³¨å…¥å¯¹è±¡çš„å­—æ®µ</li>
<li>Bindï¼šä¸€èˆ¬ç”¨äºå»å£°æ˜æŸä¸€ä¸ªç‰¹å®šçš„interfaceå¯¹è±¡éœ€è¦æŸä¸€ä¸ªç‰¹å®šçš„structå®ä¾‹æ¥å®ç°</li>
<li>FieldsOfï¼šæŠŠå•ä¸ªstructçš„æŸäº›ç‰¹å®šçš„å­—æ®µç»™Provideå‡ºå»</li>
</ul>
<p>å¯¹äºå¤§ä»“çš„æ¯ä¸€ä¸ªå¾®æœåŠ¡æ¥è®²ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨åˆ°è¿™äº›èƒ½åŠ›æ¥æè¿°ä¸åŒæœåŠ¡serviceå®ä¾‹çš„ä¾èµ–ï¼Œè¿™æ ·å°±å¯ä»¥ç”¨wireä¸€æ¬¡æ€§æŠŠæˆ‘ä»¬æ‰€æœ‰serviceå®ä¾‹çš„åˆå§‹åŒ–ä»£ç ç»™ç”Ÿæˆå‡ºæ¥ï¼Œå¹¶ä¸”å¯ä»¥æå‰æ£€æŸ¥ä¾èµ–çš„æ­£ç¡®æ€§ï¼Œä»è€Œruntimeçš„æ—¶å€™å°±ä¸ä¼šå‡ºç°å“ªä¸ªåº•å±‚æœåŠ¡å®ä¾‹æœ‰nilå¼‚å¸¸çš„æƒ…å†µã€‚</p>
<p>å…·ä½“æ€ä¹ˆåšï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨bizä¸‹é¢ä¸€èˆ¬æœ‰handlerã€serviceã€configç­‰å­ç›®å½•ï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸€ä¸ªå­ç›®å½•iocï¼Œç”¨æ¥å­˜æ”¾wireä¾èµ–æ³¨å…¥çš„å†…å®¹ã€‚</p>
<ul>
<li>ioc.goï¼šæ‰§è¡Œåˆå§‹åŒ–é€»è¾‘çš„å…¥å£ï¼Œå­˜æ”¾æš´éœ²ç»™handlerå±‚çš„æ‰€æœ‰ä¸Šå±‚serviceå®ä¾‹ã€‚</li>
<li>wire.goï¼šå£°æ˜æ‰€æœ‰serviceå®ä¾‹çš„ä¾èµ–å…³ç³»ï¼Œå¯åç»­ç”ŸæˆåŒ…å«åˆå§‹åŒ–ä»£ç çš„wire_gen.goã€‚</li>
</ul>
<p>ioc.goé‡Œé¢è¿™æ ·å†™ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> IOC <span class="keyword">struct</span> &#123;</span><br><span class="line">    User service.IUserService <span class="comment">// å»ºè®®å¯¹å¤–æš´éœ²Interfaceç±»å‹çš„service</span></span><br><span class="line">    Task service.ITaskService</span><br><span class="line">    <span class="comment">// ...å…¶ä»–service</span></span><br><span class="line">    DB dal.DB <span class="comment">// interface or pointer</span></span><br><span class="line">    Cache cache.Cache <span class="comment">// interface or pointer</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Instances *IOC</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    instances, err := initIOC()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    Instances = instances</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·handlerå±‚å°±å¯ä»¥é€šè¿‡ioc.Instances.XXXç›´æ¥è·å–serviceå®ä¾‹è°ƒç”¨å¯¹åº”ä¸šåŠ¡ï¼Œç„¶åä¸šåŠ¡çš„å®ç°ä»£ç å°±æ”¾åˆ°serviceå±‚å…·ä½“çš„useræˆ–è€…taskç›®å½•ï¼Œå±‚æ¬¡ç»“æ„å°±æ¯”è¾ƒæ¸…æ™°äº†ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾userçš„å®ç°ä¾èµ–dbæœåŠ¡ï¼Œtaskçš„å®ç°ä¾èµ–userã€dbå’ŒcacheæœåŠ¡ï¼Œé‚£ä¹ˆUserServiceå’ŒTaskServiceçš„ä»£ç å®ç°å¯ä»¥æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> IUserService <span class="keyword">interface</span> &#123;</span><br><span class="line">    GetUser(ctx context.Context, userID <span class="keyword">int64</span>) (*User, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> UserServiceImpl <span class="keyword">struct</span> &#123;</span><br><span class="line">    DB dal.DB</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetUser ä»DBæ‹¿</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *UserServiceImpl)</span> <span class="title">GetUser</span><span class="params">(ctx context.Context, userID <span class="keyword">int64</span>)</span> <span class="params">(*User, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> DB.GetUser(ctx, userID)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// userå®ç°ä¸Šéœ€è¦dbæœåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUserService</span><span class="params">(db dal.DB)</span> <span class="title">IUserService</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;UserServiceImpl&#123;</span><br><span class="line">        DB: db,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> ITaskService <span class="keyword">interface</span> &#123;</span><br><span class="line">    CreateTask(ctx context.Context, userID <span class="keyword">int64</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">    GetTask(ctx context.Context, taskID <span class="keyword">int64</span>) (*Task, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> TaskServiceImpl <span class="keyword">struct</span> &#123;</span><br><span class="line">    DB dal.DB</span><br><span class="line">    Cache cache.Cache</span><br><span class="line">    User IUserService</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateTask æ‹¿userä¿¡æ¯å­˜DB</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TaskServiceImpl)</span> <span class="title">CreateTask</span><span class="params">(ctx context.Context, userID <span class="keyword">int64</span>)</span> <span class="params">(<span class="keyword">int64</span>, error)</span></span> &#123;</span><br><span class="line">    userInfo, err := t.User.GetUser(ctx, userID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    task := &amp;Task&#123;</span><br><span class="line">        Creator: userInfo.Name,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> DB.CreateTask(ctx, task)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetTask å…ˆæ‹¿ç¼“å­˜å†æ‹¿DB</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *TaskServiceImpl)</span> <span class="title">GetTask</span><span class="params">(ctx context.Context, taskID <span class="keyword">int64</span>)</span> <span class="params">(*Task, error)</span></span> &#123;</span><br><span class="line">    taskInfo := <span class="built_in">new</span>(Task)</span><br><span class="line">    <span class="keyword">var</span> err error</span><br><span class="line">    cacheKey := fmt.Sprintf(<span class="string">"task:%d"</span>, taskID)</span><br><span class="line">    <span class="keyword">if</span> err = t.Cache.Load(ctx, cacheKey, taskInfo); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> taskInfo, <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    taskInfo, err = DB.GetTask(ctx, taskID)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    t.Cache.Save(ctx, cacheKey, taskInfo)</span><br><span class="line">    <span class="keyword">return</span> taskInfo, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// taskå®ç°ä¸Šéœ€è¦dbã€cacheå’ŒuseræœåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTaskService</span><span class="params">(db dal.DB, cache cache.Cache, user IUserService)</span> <span class="title">ITaskService</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;TaskServiceImpl&#123;</span><br><span class="line">        DB: db,</span><br><span class="line">        Cache: cache,</span><br><span class="line">        User: IUserService,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šé¢wireä¸ºå‰æï¼Œæ¥ä¸‹æ¥wire.goå°±å¯ä»¥è¿™æ ·å†™ï¼Œä»è€Œç®€å•å£°æ˜æ‰€æœ‰å¯èƒ½å‡ºç°çš„æœåŠ¡å®ä¾‹ï¼Œæ‰“å¹³ä¾èµ–é¡ºåºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ctx = context.Background() <span class="comment">// åˆå§‹åŒ–çš„ctxä¸€èˆ¬å°±æ˜¯background</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åº•å±‚ä¾èµ–</span></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    ctxSet = wire.InterfaceValue(<span class="built_in">new</span>(context.Context), ctx)</span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰é™æ€DBé…ç½®çš„è¯ï¼Œå…ˆinitConfigç„¶åå†ioc.Init</span></span><br><span class="line">    <span class="comment">// cfgæ¨¡å—ä¸»åŠ¨æš´éœ²æ–¹æ³•æ‹¿å¯¹åº”DBé…ç½®ï¼Œè¿™æ ·æ¯”å¦‚ç›¸åŒç±»å‹DBæœ‰å¤šå¥—é…ç½®ä¹Ÿå¯ä»¥è‡ªç”±provideå‡ºæ¥</span></span><br><span class="line">    dbSet = wire.NewSet(dal.NewDB, cfg.GetDB)</span><br><span class="line">    cacheSet = wire.NewSet(cache.NewCache, cfg.GetCache)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€»é›†</span></span><br><span class="line"><span class="keyword">var</span> providerSet = wire.NewSet(</span><br><span class="line">    ctxSet,</span><br><span class="line">    dbSet,</span><br><span class="line">    cacheSet,</span><br><span class="line">    userService.NewUserService,</span><br><span class="line">    taskService.NewTaskService, <span class="comment">// taskä¾èµ–userï¼Œå†™ä¸‹é¢</span></span><br><span class="line">    wire.Struct(<span class="built_in">new</span>(IOC), <span class="string">"*"</span>) <span class="comment">// instancesæ”¾åœ¨æœ€ä¸‹é¢</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initIOC</span><span class="params">()</span> <span class="params">(*IOC, error)</span></span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(wire.Build(providerSet))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">new</span>(IOC), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·wire.Buildè¿‡åï¼Œæ‰€æœ‰æœåŠ¡å®ä¾‹çš„åˆå§‹åŒ–ä»£ç å°±ç”Ÿæˆäº†ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªå¾®æœåŠ¡çš„mainé‡Œé¢è°ƒç”¨ioc.goé‡Œé¢çš„Initï¼Œå°±å¯ä»¥æŠŠæ‰€æœ‰æœåŠ¡å®ä¾‹ç”Ÿæˆå‡ºæ¥ï¼Œezpzï¼</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>monorepo</tag>
        <tag>Golang</tag>
        <tag>wire</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»£ç è‰ºå»Šã€‘pyside6æ¡Œé¢åº”ç”¨èŒƒä¾‹ï¼šhomemade-toolset</title>
    <url>/2025/04/04/codegallery/homemade_toolset/</url>
    <content><![CDATA[<p>åœ¨ç ”å‘æµ‹è¯•æ—¥å¸¸å·¥ä½œä¸­ï¼Œé€šå¸¸ä¼šé‡åˆ°å¾ˆå¤šçç¢çš„äº‹æƒ…ï¼Œå ç”¨æˆ‘ä»¬å·¥ä½œçš„æ—¶é—´å’Œç²¾åŠ›ï¼Œä»è€Œå¯¼è‡´æˆ‘ä»¬ä¸èƒ½æŠŠå¤§éƒ¨åˆ†çš„æ³¨æ„åŠ›æ”¾åœ¨ä¸»è¦çš„å·¥ä½œä¸Šé¢ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé™¤äº†åŠ äººä¹‹å¤–ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå¼€å‘ä¸€äº›æ—¥å¸¸ç”¨çš„æ•ˆç‡å·¥å…·ï¼Œæ¯”å¦‚ä»¥pyqtã€pysideä¸ºä¸»ä½“çš„æ¡Œé¢åº”ç”¨ï¼Œä¸€é”®åŒ–æˆ‘ä»¬çš„æ—¥å¸¸å·¥ä½œï¼Œä»è€Œè§£æ”¾æˆ‘ä»¬å¾ˆå¤šå¤„ç†çç¢äº‹æƒ…çš„ç²¾åŠ›ï¼Œè®©æˆ‘ä»¬æœ‰æ›´å¤šç²¾åŠ›æ‰“ç£¨ä¸»ä¸šï¼Œåˆ›é€ æ›´å¥½çš„å·¥ä½œæˆç»©ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬æ–‡å°±åˆ†äº«ä¸‹ç¬”è€…åœ¨24å¹´ä¸‹åŠå¹´è°ƒç ”å­¦ä¹ pyside6çš„ä¸€äº›æˆæœï¼ŒæŠŠè‡ªå·±åšçš„å°åº”ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9ob21lbWFkZS10b29sc2V0" title="https://github.com/utmhikari/homemade-toolset">homemade-toolset<i class="fa fa-external-link"></i></span>å¼€æºå‡ºæ¥ï¼Œä¾›å„ä½æœ‰éœ€è¦çš„åŒå­¦å‚è€ƒå­¦ä¹ ã€‚</p>
<p>æ•´ä¸ªé¡¹ç›®åŒ…å«æ—¶é—´è½¬æ¢å·¥å…·ã€JSONå·¥å…·ä»¥åŠç±»ä¼¼Postmançš„Requestå·¥å…·ï¼Œé‡‡ç”¨python3.11å’Œpyside6å¼€å‘ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<ul>
<li>appï¼šåº”ç”¨å†…å®¹<ul>
<li><strong>init</strong>.pyï¼šappåˆå§‹åŒ–é€»è¾‘</li>
<li>serviceï¼šä¸šåŠ¡é€»è¾‘</li>
<li>utilï¼šå·¥å…·ç±»</li>
<li>viewï¼šå‰ç«¯é€»è¾‘<ul>
<li>componentï¼šå¯å¤ç”¨çš„uiç»„ä»¶</li>
<li>uiï¼šé€šè¿‡pyside6-designerç”Ÿæˆçš„uiä»£ç </li>
<li>workerï¼šåå°å¼‚æ­¥/å¹¶å‘çš„ä»»åŠ¡ç±»</li>
<li>XXX.pyï¼šä¸»é¡µé¢é€»è¾‘</li>
</ul>
</li>
</ul>
</li>
<li>cfgï¼šé…ç½®æ–‡ä»¶</li>
<li>etcï¼šé™æ€èµ„æº<ul>
<li>uiï¼špyside6-designerçš„uiæ–‡ä»¶</li>
<li>scriptï¼šç ”å‘è„šæœ¬<ul>
<li>deploy.shï¼šappæ‰“åŒ…ï¼Œworkdirä¸ºé¡¹ç›®æ ¹ç›®å½•</li>
<li>uic.pyï¼špyside6-designerçš„uiæ–‡ä»¶è½¬pyæ–‡ä»¶çš„è„šæœ¬ï¼Œworkdirä¸ºé¡¹ç›®æ ¹ç›®å½•</li>
</ul>
</li>
</ul>
</li>
<li>main.pyï¼šç¨‹åºå…¥å£</li>
<li>pysidedeploy.spec</li>
<li>README.mdï¼šé¡¹ç›®ä»‹ç»</li>
</ul>
<p>ä½¿ç”¨æ–¹æ³•ä¸Šï¼Œç›´æ¥é…venvä¸‹å¥½requirementsæ‰§è¡Œmainå³å¯ï¼Œç¼–è¯‘æ‰“åŒ…ç”¨çš„æ˜¯etc/script/deploy.shï¼Œé‡Œé¢æ‰§è¡Œpyside6-deployåšæ‰“åŒ…ï¼Œå¯ä»¥åœ¨pysidedeploy.specåšæ‰“åŒ…é…ç½®ã€‚uiæ–‡ä»¶åœ¨etc/uiç›®å½•ä¸‹ï¼Œå¯ä»¥ç”¨pyside6-designerå»è®¾è®¡ï¼Œç„¶åç»Ÿä¸€é€šè¿‡etc/script/uic.pyè„šæœ¬è½¬ä¸ºpyæ–‡ä»¶ã€‚</p>
<p>å…·ä½“é‡Œé¢çš„ä»£ç å®ç°ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« äº†è§£è¯¦æƒ…ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkuYmxvZy5jc2RuLm5ldC9hcnRpY2xlL2RldGFpbHMvMTQxMTA3MTUw" title="https://utmhikari.blog.csdn.net/article/details/141107150">ã€Pythonéšç¬”ã€‘æ¯”PyQt5æ›´å…ˆè¿›çš„pyside6å®‰è£…å’Œä½¿ç”¨æ–¹æ³•<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkuYmxvZy5jc2RuLm5ldC9hcnRpY2xlL2RldGFpbHMvMTQyODk4MDU1" title="https://utmhikari.blog.csdn.net/article/details/142898055">ã€Pythonéšç¬”ã€‘pyside6ç»˜åˆ¶è¡¨ç›˜å’Œæ•°å­—æ—¶é’Ÿçš„æ–¹æ³•<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkuYmxvZy5jc2RuLm5ldC9hcnRpY2xlL2RldGFpbHMvMTQ0NjM1MTcw" title="https://utmhikari.blog.csdn.net/article/details/144635170">ã€Pythonéšç¬”ã€‘å¦‚ä½•ç”¨pyside6å¼€å‘å¹¶éƒ¨ç½²ç®€å•çš„postmanå·¥å…·<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkuYmxvZy5jc2RuLm5ldC9hcnRpY2xlL2RldGFpbHMvMTQzNDYzNjE1" title="https://utmhikari.blog.csdn.net/article/details/143463615">ã€Pythonéšç¬”ã€‘å°†requestså®ä¾‹è½¬æ¢æˆcurlè¯­å¥<i class="fa fa-external-link"></i></span></li>
</ul>
]]></content>
      <categories>
        <category>ä»£ç è‰ºå»Š</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>pyside6</tag>
        <tag>homemade-toolset</tag>
        <tag>æ¡Œé¢åº”ç”¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘å˜æ›´é£é™©è§‚æµ‹çš„ä»»åŠ¡è°ƒåº¦è®¾è®¡</title>
    <url>/2025/03/09/archiart/change_observation_worker/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjUvMDEvMjYvdGVzdGxpZmUvY2hhbmdlX29ic2VydmVfbG9naWMv" title="https://utmhikari.top/2025/01/26/testlife/change_observe_logic/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­ï¼Œå¯¹äºå˜æ›´é£é™©è§‚æµ‹çš„æµç¨‹é€»è¾‘è®¾è®¡ï¼Œæœ‰æµ…è°ˆä¸€å°éƒ¨åˆ†ã€‚ä½†ä»å®è§‚æ¥è®²ï¼Œä¸€ä¸ªå˜æ›´è§‚æµ‹å¹³å°ï¼Œéœ€è¦å¯¹å¤§é‡çš„è§‚æµ‹ä»»åŠ¡åšç»Ÿä¸€è°ƒåº¦ï¼Œè¿™æ ·æ‰èƒ½æŠŠæ•´ä¸ªè§‚æµ‹å¹³å°ç»™æ”¯æ’‘èµ·æ¥ã€‚å› æ­¤ï¼Œæœ¬æ–‡å°±ç®€å•åˆ†äº«ä¸€ä¸‹ï¼Œå˜æ›´é£é™©è§‚æµ‹çš„ä»»åŠ¡è°ƒåº¦å¯èƒ½æ€æ ·è®¾è®¡ã€‚</p>
<p>è¿™ä¸ªé—®é¢˜å¯ä»¥æ‹†åˆ†ä¸ºå‡ ä¸ªå­é—®é¢˜ï¼šå¤šä»»åŠ¡å¹¶å‘éœ€è¦å¦‚ä½•å¤„ç†ï¼Œä»»åŠ¡è°ƒåº¦çš„æ¶ˆæ¯åè®®éœ€è¦å¦‚ä½•è®¾è®¡ï¼Œä»¥åŠæ€ä¹ˆå»ä¿è¯æ•´ä¸ªè°ƒåº¦ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¤šä»»åŠ¡å¹¶å‘çš„æ•´ä¸ªç³»ç»Ÿè®¾è®¡ã€‚ä¸»è¦æ˜¯ä¸¤ä¸ªè·¯å­ï¼Œä¸€ç§æ–¹å¼æ˜¯æœ‰ä¸€ä¸ªä»»åŠ¡é©±åŠ¨æœåŠ¡å»ä¸æ–­åœ°å‘ä¸€ä¸ªMQå»ç”Ÿäº§å’Œæ¶ˆè´¹ä»»åŠ¡è°ƒåº¦ä¿¡æ¯ï¼Œå¥½æ¯”è¯´åˆ›å»ºä»»åŠ¡çš„è¿‡ç¨‹ï¼ŒHTTPæ¥å£é€»è¾‘å…ˆè®©ä»»åŠ¡è®°å½•è½åº“ï¼Œç„¶åproduceä¸€æ¡ä»»åŠ¡æ‰§è¡Œçš„æ¶ˆæ¯ï¼Œä¹‹åconsumeræ¶ˆè´¹äº†ä»»åŠ¡æ‰§è¡Œæ¶ˆæ¯åï¼Œå°±initializeæ•´ä¸ªè§‚æµ‹ä»»åŠ¡ï¼Œå¼€å§‹æ‰§è¡Œï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­ä¸æ–­ç”Ÿäº§æ¶ˆè´¹pollçš„æ¶ˆæ¯ï¼Œå¦‚æœç”¨RMQçš„è¯ä¹Ÿå¯ä»¥å€ŸåŠ©å»¶è¿Ÿé˜Ÿåˆ—æœºåˆ¶å»å®šæ—¶æ¨è¿›ä»»åŠ¡è¿›ç¨‹ï¼Œç›´åˆ°ä»»åŠ¡ç»“æŸã€‚å¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡ä¸€ä¸ªå¤–éƒ¨çš„cronjobå»æŸ¥è¯¢è¿‘æœŸçš„éç»ˆæ­¢æ€ä»»åŠ¡ï¼Œç„¶åä¸€ä¸ªä¸ªå»æ¨è¿›æ‰§è¡Œï¼Œä¸èµ°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p>
<p>ä¸¤ç§æ–¹å¼å„æœ‰åˆ©å¼Šï¼Œåè€…å› ä¸ºæœ‰å®šæ—¶çš„æŸ¥è¯¢è¿‡ç¨‹ï¼Œå¯¹DBçš„å‹åŠ›ä¼šç¨å¾®å¤§ä¸€äº›ï¼Œå› æ­¤å¦‚æœä»»åŠ¡é‡éå¸¸å¤šçš„è¯ï¼ŒæŸ¥è¯¢æ—¶å»¶ä¼šæ¯”è¾ƒé«˜ï¼Œå¯¼è‡´ä»»åŠ¡æ¨è¿›ç¼“æ…¢ï¼Œè€Œå‰è€…ä¸»è¦ä¾èµ–MQçš„ç¨³å®šæ€§ï¼Œå¦‚æœæ¶ˆè´¹é€»è¾‘ä¸ç¨³å®šï¼Œå®¹æ˜“é€ æˆæ¶ˆæ¯ç§¯å‹æˆ–è€…ä»»åŠ¡æ¨è¿›è¿‡ç¨‹ä¸­æ–­ã€‚æ•´ä½“æ¥çœ‹å‰è€…çš„æ¶æ„ä¼šæ›´åŠ çµæ´»ä¸€äº›ï¼Œç”¨mqåˆ†æ‹…ä¸€äº›ä»»åŠ¡æ¨è¿›å·¥ä½œï¼Œåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œå†å»é™„åŠ ä¸€ä¸ªå¤–éƒ¨çš„cronjobåšå…œåº•ã€‚å¯¹äºMQçš„ç”Ÿäº§æ¶ˆè´¹ï¼Œå¦‚æœä»»åŠ¡é‡æœ‰é¢„ä¼°ï¼Œå¯ä»¥ç”¨å®šå®¹çš„æœåŠ¡å»å¤„ç†produce/consumeé€»è¾‘ï¼Œå½“ç„¶å¦‚æœæœ‰è®¡è´¹è¦æ±‚ï¼Œç”¨faasä¼šæ›´åŠ åˆç†ã€‚</p>
<p>ç¬¬äºŒå—æ˜¯æ¶ˆæ¯åè®®è®¾è®¡ã€‚è¿™å—ä¼šä¸»è¦å…³æ³¨åˆ›å»ºä»»åŠ¡éœ€è¦åŒ…æ‹¬å“ªäº›ä¿¡æ¯ï¼Œå¯ä»¥å¤§è‡´åšè¿™æ ·çš„åˆ†é—¨åˆ«ç±»ï¼š</p>
<ul>
<li>ä»»åŠ¡åˆ›å»ºçš„å…ƒä¿¡æ¯ï¼šå“ªä¸ªjobã€åˆ›å»ºäººã€åˆ›å»ºæ¥æºä»¥åŠä»»åŠ¡çš„è°ƒåº¦å‚æ•°</li>
<li>å·¥å•ï¼ˆé˜¶æ®µï¼‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šå·¥å•æ‰€å±æ¸ é“ã€å·¥å•IDã€å˜æ›´ç±»å‹ã€é˜¶æ®µå”¯ä¸€keyä»¥åŠæ”¾é‡æ¯”ä¾‹ç­‰ä¿¡æ¯</li>
<li>DevOpsçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼šéœ€æ±‚/å‘å¸ƒä¿¡æ¯ã€æµæ°´çº¿IDç­‰ä¿¡æ¯</li>
<li>é£é™©è§‚æµ‹å‚æ•°ï¼šä¸Šä¸‹æ¸¸æœåŠ¡ã€è§‚æµ‹æ—¶é•¿ã€é€šçŸ¥webhookç­‰ä¿¡æ¯</li>
</ul>
<p>è¿™æ ·ï¼Œä¸€ä¸ªè§‚æµ‹ä»»åŠ¡å°±èƒ½å¤Ÿç²¾å‡†å¯¹åº”åˆ°ä¸€æ¬¡å‘å¸ƒã€ä¸€æ¬¡ç‰¹å®šèŠ‚ç‚¹ä»¥åŠä¸€ç»„ç‰¹å®šçš„æ‰§è¡Œç­–ç•¥ï¼Œå°±èƒ½å¤Ÿç¡®å®šæ•´ä¸ªä»»åŠ¡çš„è¿è¡Œæ–¹å¼å’Œè§‚æµ‹å†…å®¹ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªé—®é¢˜æ˜¯ç¨³å®šæ€§ä¿éšœã€‚é™¤äº†ä¸€äº›å¿…è¦çš„ä¸­é—´ä»¶/æœåŠ¡ç›‘æ§å‘Šè­¦ä¹‹å¤–ï¼Œå½±å“æ•´ä¸ªç³»ç»Ÿç¨³å®šæ€§çš„ï¼Œè¿˜æ˜¯producer/consumerå’Œmqè¿™ä¸ªæ­é…ã€‚è¿™é‡Œæœ‰å‡ ä¸ªç‚¹éœ€è¦è€ƒè™‘çš„ï¼š</p>
<ul>
<li>ä»£ç ï¼šproducer/consumerçš„panicéœ€è¦recover+ackï¼Œé˜²æ­¢ä»»åŠ¡è¿›ç¨‹ä¸­æ–­ï¼›channel/singleflight/waitgroupé˜»å¡ä¹‹ç±»é—®é¢˜éœ€è¦æœ‰é‡è¯•æœºåˆ¶ã€æ­»ä¿¡é˜Ÿåˆ—å…œåº•ï¼Œå…ˆä¿è¯è¿›åº¦ä¿¡æ¯ä¸ä¸¢å¤±å†åšä¿®å¤ã€‚</li>
<li>å®¹é‡ï¼šè§‚æµ‹ä»»åŠ¡çš„å¤„ç†å»¶æ—¶ä¸»è¦åœ¨ä»»åŠ¡æ¨è¿›ï¼Œä¸€æ¬¡ä»»åŠ¡æ¨è¿›çš„æ—¶é—´å¯èƒ½å¾ˆé•¿ï¼Œå…œåº•éœ€è¦1ï½2minçš„timeoutï¼Œæ‰€ä»¥é™¤äº†å¯¹æœåŠ¡æœ‰ä¸€ä¸ªåˆç†çš„å®šå®¹ä¹‹å¤–ï¼Œæ•´ä¸ªä»»åŠ¡æ¨è¿›çš„é€»è¾‘å½“ä¸­ï¼Œéœ€è¦æŠŠèƒ½å¤Ÿå¼€goroutineå¼‚æ­¥æ‰§è¡Œçš„æ­¥éª¤å°½å¯èƒ½å•ç‹¬æ‹¿å‡ºæ¥ï¼Œä¼˜å…ˆä¿è¯æ¶ˆè´¹å»¶æ—¶ä¸è¦å¤ªé«˜ã€‚å¦‚æœé‡åˆ°ä¸€ä¸ªè§‚æµ‹é¡¹åˆæœ‰å¤šä¸ªå­ä»»åŠ¡éœ€è¦è°ƒåº¦çš„åœºæ™¯ï¼Œä¸€ä¸ªå¥½çš„æ–¹æ³•æ˜¯æŠŠå¤šä¸ªå­ä»»åŠ¡è°ƒåº¦æ”¾åˆ°å•ç‹¬çš„æœåŠ¡ä¸­è¿›è¡Œï¼Œè¿™æ ·ä¸å½±å“ä¸»æµç¨‹ï¼›å¦‚æœæ˜¯åœ¨æ¶ˆè´¹ä¸è¿‡æ¥äº†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›å…œåº•æœºåˆ¶ï¼Œæ ¹æ®ä»»åŠ¡æ‰§è¡Œæ—¶é—´æˆ–ä»»åŠ¡é‡è¦æ€§ï¼Œè‡ªä¸»é€‚é…å»¶é•¿ä¸‹æ¬¡consumeçš„é—´éš”ï¼Œä»è€Œå‡è½»è‡ªå·±å‹åŠ›ã€‚</li>
</ul>
<p>æ€»ä½“æ¥çœ‹å˜æ›´é£é™©è§‚æµ‹çš„ä»»åŠ¡è°ƒåº¦ï¼Œå¤§ä½“è®¾è®¡æ€è·¯æ–¹é¢ä¸éœ€è¦åšçš„éå¸¸å¤æ‚ï¼Œé‡è¦è¿˜æ˜¯å»æœ‰ä¸€å¥—ç¨³å®šæ€§å…œåº•æœºåˆ¶ï¼Œä¿è¯æ•´ä¸ªç”Ÿäº§æ¶ˆè´¹é“¾è·¯èƒ½å¤ŸæŒç»­ç¨³å®šè¿è½¬ã€‚åç»­æœ‰ä»€ä¹ˆé¢å¤–çš„ç»éªŒï¼Œå†åœ¨è¿™é‡Œè¡¥å……ï½</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>äº‹ä»¶å¾ªç¯</tag>
        <tag>å¼‚æ­¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘Goè¯­è¨€å¾®æœåŠ¡monorepoçš„ä»£ç æ¶æ„è®¾è®¡</title>
    <url>/2025/03/09/archiart/go_monorepo_structure/</url>
    <content><![CDATA[<p>è¿‘æœŸå› ä¸ºé¡¹ç›®æ¶æ„å‡çº§åŸå› ï¼Œç¬”è€…ç€æ‰‹è°ƒç ”ä¸€äº›goé¡¹ç›®monorepoçš„ä»£ç æ¶æ„è®¾è®¡ï¼Œç›®æ ‡æ˜¯é•¿æœŸæŠŠæ—¢æœ‰å¾®æœåŠ¡é¡¹ç›®é‡è¦çš„éƒ¨åˆ†éƒ½è½¬ç§»åˆ°monorepoä¸Šé¢ï¼Œè®©ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ï¼Œåä½œå¼€å‘æ›´åŠ æ–¹ä¾¿ã€‚è™½ç„¶ç»éªŒä¸å¤šï¼Œä½†æ—¢ç„¶æœ‰äº†åˆæ­¥çš„è°ƒç ”ï¼Œä»Šå¤©å°±åˆ†äº«ä¸€ä¸‹ç¬”è€…æ‰€é¢ä¸´åœºæ™¯çš„monorepoè®¾è®¡æ€è·¯ã€‚</p>
<p>ä»è¯­è¨€ç‰¹æ€§ä¸Šè®²ï¼ŒGolangæ˜¯éå¸¸é€‚åˆåšmonorepoçš„ï¼Œä½†æ ¹æ®ä¸åŒé¡¹ç›®ç ”å‘éœ€è¦ï¼Œmonorepoçš„ç›®å½•ç»“æ„å¯ä»¥å®šåˆ¶æˆä¸åŒçš„å½¢å¼ã€‚æ‰€ä»¥è¦åšmonorepoï¼Œé¦–å…ˆè¦å›ç­”çš„é—®é¢˜æ˜¯ï¼Œåšè¿™ä¸ªäº‹æƒ…ä¸»è¦è§£å†³ä»€ä¹ˆç ”å‘é—®é¢˜ï¼Œä¼˜åŒ–äº†ä»€ä¹ˆä¸œè¥¿ï¼Œå¦åˆ™æŠ•å…¥é‡è¿‡å¤šï¼ŒROIå°±ä¼šå¾ˆä½ã€‚</p>
<a id="more"></a>
<p>ç¬”è€…æ‰€å¤„çš„å›¢é˜Ÿåå‘äºä¸­å°è§’è‰²ï¼Œæ¯ä¸ªåŒå­¦éƒ½è´Ÿè´£ä¸€ä¸ªä¸“é¡¹ï¼Œä¸åŒä¸“é¡¹ä¹‹é—´å¯èƒ½å…±äº«å¾ˆå¤šä¸‰æ–¹èƒ½åŠ›çš„å®ç°ï¼Œå¹¶ä¸”å›¢é˜Ÿè·ç¦»ä¸šåŠ¡æ¯”è¾ƒè¿‘ï¼Œç ”å‘æ›´æ³¨é‡çŸ­å¹³å¿«ï¼Œæ‰€ä»¥æ—¢å¾€çš„ä»£ç å®ç°è´¨é‡æ–¹é¢ï¼Œå¹¶ä¸æ˜¯éå¸¸å®Œç¾ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œå¦‚æœç”¨monorepoåšä»£ç æ¶æ„å‡çº§ï¼Œä¸»è¦èƒ½è§£å†³çš„é—®é¢˜ï¼Œä¸€æ˜¯æ›´ç²¾ç®€çš„ä»£ç å’Œæ¨¡å—åŒ–æŠ½è±¡ï¼ŒäºŒæ˜¯å‡å°‘ä¸‰æ–¹èƒ½åŠ›çš„å†—ä½™å®ç°ï¼Œä¸‰æ˜¯é€šè¿‡ä¸€å¥—ç ”å‘å®è·µè§„èŒƒä»£ç ç®¡ç†ï¼Œè¿™æ ·å°±èƒ½å¤Ÿåœ¨ä¿è¯ä»£ç æ˜“æ‰©å±•å’Œæ¨¡å—æ˜“å…¼å®¹çš„åŸºç¡€ä¸Šï¼Œå„ä¸ªæˆå‘˜èƒ½å¤Ÿå°½å¯èƒ½è‡ªç”±å‘æŒ¥ï¼Œä»£ç è´¨é‡ä¹Ÿä¸ä¼šè½»æ˜“ä¸‹é™ï¼Œè¿™æ ·é•¿æœŸå°±èƒ½è®©æ•´ä¸ªå›¢é˜Ÿçš„æŠ€æœ¯è¿­ä»£æ›´åŠ æ•ˆç‡ï¼ŒæœåŠ¡å®ç°çš„ç¨³å®šæ€§ä¼šæ›´é«˜ã€‚</p>
<p>ç„¶åå°±æ˜¯æ•´ä¸ªä»£ç æ¶æ„é•¿ä»€ä¹ˆæ ·å­ã€‚ç¬”è€…çš„é¡¹ç›®ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·è®¾è®¡ï¼š</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">- </span>appï¼šæ‰€æœ‰æœåŠ¡å„è‡ªçš„ä»£ç </span><br><span class="line">  - $&#123;service_group&#125;ï¼šæŒ‰æ¶æ„åˆ’åˆ†çš„æœåŠ¡ç»„ï¼ˆæ¨¡å—ï¼‰</span><br><span class="line"><span class="code">    - $&#123;service_name&#125;ï¼šå•ä¸ªæœåŠ¡çš„ä»£ç ï¼ˆhttp/rpcç­‰ï¼‰</span></span><br><span class="line"><span class="code">      - bizï¼šä¸šåŠ¡é€»è¾‘</span></span><br><span class="line"><span class="code">        - handler</span></span><br><span class="line"><span class="code">        - middleware</span></span><br><span class="line"><span class="code">        - service</span></span><br><span class="line"><span class="code">      - confï¼šé™æ€é…ç½®</span></span><br><span class="line"><span class="code">      - main.go</span></span><br><span class="line"><span class="code">      - build.shï¼šæ¯ä¸ªæœåŠ¡çš„ç¼–è¯‘</span></span><br><span class="line"><span class="bullet">- </span>libï¼šæ‰€æœ‰æœåŠ¡å…¬æœ‰çš„ä»£ç </span><br><span class="line">  - clientï¼šä¸‰æ–¹èƒ½åŠ›çš„clientå®ç°</span><br><span class="line">  - commonï¼šæšä¸¾å®šä¹‰</span><br><span class="line">  - modelï¼šæ•°æ®ç»“æ„ï¼ˆfrom idlï¼‰</span><br><span class="line">  - dalï¼šæ•°æ®è®¿é—®ï¼ˆgormè‡ªåŠ¨ç”Ÿæˆï¼‰</span><br><span class="line">  - utilï¼šå·¥å…·å‡½æ•°</span><br><span class="line"><span class="bullet">- </span>idlï¼šåè®®</span><br><span class="line"><span class="bullet">- </span>scriptï¼šè„šæœ¬ï¼ˆç¼–è¯‘/æœ¬åœ°å¼€å‘ï¼‰</span><br><span class="line"><span class="bullet">- </span>Makefile</span><br><span class="line"><span class="bullet">- </span>go.mod</span><br><span class="line"><span class="bullet">- </span>go.sum</span><br><span class="line"><span class="bullet">- </span>README.md</span><br></pre></td></tr></table></figure>
<p>ç”±äºå¾ˆå¤šæœåŠ¡éœ€è¦å…±äº«æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥åœ¨è®¾è®¡ä¸Šï¼Œidlã€modelåšäº†å•ç‹¬æå‡ºï¼Œè¢«æ‰€æœ‰æœåŠ¡å¯ä»¥å¼•ç”¨ã€‚å¼€å‘çº¦å®šä¸Šï¼Œé€šè¿‡åœ¨scriptã€Makefileåšä¸€äº›è„šæœ¬ï¼Œå°±å¯ä»¥è‡ªåŠ¨æŒ‡å®šæŸæœåŠ¡åˆ›å»º/æ›´æ–°é¡¹ç›®ä»£ç ï¼Œä¹Ÿå¯ä»¥éšæ—¶è‡ªåŠ¨ç”Ÿæˆ/æ›´æ–°åè®®ç»“æ„å’Œgormå®šä¹‰ã€‚</p>
<p>é€šè¿‡è¿™æ ·ä¸€ä¸ªæ¶æ„ï¼Œé¦–å…ˆä»£ç ç²¾ç®€å’Œä¸‰æ–¹èƒ½åŠ›æŠ½è±¡éƒ½å¯ä»¥è§£å†³ã€‚ç„¶åï¼Œç”±äºå„ç±»è„šæœ¬çš„å­˜åœ¨ï¼Œæ¯ä¸ªä¸šåŠ¡ä¸“é¡¹çš„ç ”å‘åŒå­¦å°±ä¸éœ€è¦æŠŠè¿‡å¤šç²¾åŠ›å…³æ³¨åœ¨ä»£ç åº•å±‚æ¶æ„ä¸Šï¼Œå¯ä»¥å¿«é€Ÿé€‚åº”æ•´ä¸ªé¡¹ç›®å¼€å‘ã€‚å°±ç®—é•¿æœŸæœ‰éœ€è¦å•ç‹¬æå‡ºçš„èƒ½åŠ›ï¼Œä»£ç ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“è¿ç§»åˆ°libæ¨¡å—ã€‚è¿™æ ·æ•´ä½“ä¸Šçœ‹ï¼Œæ•´ä¸ªå›¢é˜Ÿçš„ä»£ç è´¨é‡åœ¨æœªæ¥éƒ½èƒ½å¤Ÿæœ‰è´¨çš„æå‡ã€‚</p>
<p>å½“ç„¶ï¼Œä»ç°çŠ¶æ¥çœ‹ï¼Œè¿™ä¸ªé¡¹ç›®ç»“æ„æœªæ¥å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œå¦‚æœå­˜é‡å¤§æœåŠ¡çš„ç ”å‘è¿‡ç¨‹è¦è¿ç§»åˆ°è¿™ä¸ªmonorepoï¼Œå¯èƒ½ä¼šè¸©ä»€ä¹ˆå‘ï¼Œæ¯”å¦‚go-modè¦å¤„ç†å…¼å®¹æ€§é—®é¢˜ï¼ŒæœåŠ¡ç¼–è¯‘éƒ¨ç½²é…ç½®éœ€è¦é‡æ–°è°ƒæ•´ï¼Œç ”å‘è„šæœ¬éœ€è¦åšé¢å¤–çš„å…¼å®¹ï¼Œå¾ˆå¤šæ¨¡å—éœ€è¦æœªæ¥æ‰“æ•£æŒªåˆ°libç­‰ç­‰ã€‚</p>
<p>ä¸Šè¿°è¿™äº›åŸºæœ¬ä¸Šæ˜¯å°é—®é¢˜ï¼Œå¤§çš„é—®é¢˜æ˜¯æ€ä¹ˆåœ¨è¿ç§»é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œä¸å½±å“æ—¢æœ‰çš„ä¸šåŠ¡è¿­ä»£ã€‚æ’é™¤éœ€è¦å‘¨æœ«åŠ ç­çš„çš„æƒ…å†µï¼Œç¬”è€…è®¤ä¸ºä¸€ä¸ªåˆç†çš„è§£å†³æ–¹æ³•æ˜¯ï¼Œåœ¨è¿ç§»å‰æŠ½ä¸€äº›æ—¶é—´é—´éš™ï¼Œå…ˆæ‰¾ä¸€äº›å°çš„å­˜é‡é¡¹ç›®å»åšè¯•ç‚¹è¿ç§»ï¼Œè¸©å‘ï¼Œæ•´ç†æœ€ä½³å®è·µï¼Œç„¶åå†å°è¯•è¿ç§»å¤§é¡¹ç›®ï¼Œè¿™æ ·å°±ä¸è‡³äºä¸€ä¸‹è¿ç§»é‡åˆ°é—®é¢˜å°±é˜»å¡å¾ˆå¤šã€‚è¿ç§»çš„è¯ï¼Œä¹Ÿæ˜¯å…ˆæŠŠæ‰€æœ‰ä»£ç æŒªåˆ°appï¼Œä¿è¯ç¼–è¯‘éƒ¨ç½²æ˜¯é€šçš„ï¼Œç„¶ååœ¨è¿™ä¸ªåŸºç¡€ä¸Šå†åšä»£ç é‡æ„å’Œæ‰“æ•£ï¼ŒæŠŠé‡è¦çš„å…¬æœ‰èƒ½åŠ›ç»™æå–å‡ºæ¥ï¼Œå»è®©ä»£ç é€æ¸æ¼”å˜æˆç†æƒ³çš„å½¢æ€ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>monorepo</tag>
        <tag>Golang</tag>
        <tag>å¾®æœåŠ¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æµ…è°ˆå˜æ›´é£é™©é˜²æ§çš„æ•°æ®è¿è¥</title>
    <url>/2025/02/22/testlife/change_control_data_marketing/</url>
    <content><![CDATA[<p>ä»è´¨é‡ç®¡ç†è§’åº¦æ¥è®²ï¼Œå˜æ›´é£é™©é˜²æ§ç®—æ˜¯ä¸€ç±»é‡è¦çš„æ–¹å‘ï¼Œä»ä¸šåŠ¡çš„è§’åº¦æ¥è®²ï¼Œé€šè¿‡è¿è¥å˜æ›´é£é™©æ•°æ®ï¼Œå¯ä»¥æ›´å¥½äº†è§£å˜æ›´å‘å¸ƒçš„è´¨é‡ï¼Œä»è€Œé¢„é˜²çº¿ä¸Šé—®é¢˜ã€‚ä»Šå¤©å°±æµ…èŠä¸€ä¸‹ï¼Œå˜æ›´é£é™©é˜²æ§çš„æ•°æ®è¿è¥ï¼Œéœ€è¦åšå¥½å“ªäº›æ•°æ®åŸºç¡€ã€‚</p>
<p>ç®€å•æ¥è¯´æœ‰ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼šæ¸ é“é£é™©ã€å‡†å¬æ‹¦æˆªã€å‘å¸ƒæ•ˆç‡ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ¥è®²æ¸ é“é£é™©ã€‚æ¸ é“é£é™©è¿è¥æœ¬è´¨ä¸Šå±äºå˜æ›´ç®¡æ§éƒ¨åˆ†ï¼Œæ‰€æœ‰å˜æ›´å‘å¸ƒçš„æºå¤´éƒ½è¦å½’å±åˆ°ç‰¹å®šçš„æ¸ é“ã€‚ä»ä¸€ä¸ªå˜æ›´é£é™©é˜²æ§å¹³å°çš„è§’åº¦å‡ºå‘ï¼Œå¦‚æœä¸€ä¸ªå˜æ›´æ¸ é“æ¥å…¥äº†é˜²æ§å¹³å°çš„èƒ½åŠ›ï¼Œå°±ç®—åšæ”¶å£ï¼Œæ¸ é“æœ‰ä¸åŒå˜æ›´ç±»å‹ï¼Œç»Ÿè®¡æ¯ç±»å˜æ›´ç±»å‹çš„æ”¶å£ç‡ï¼Œæ˜¯è¡¡é‡æ¸ é“é£é™©çš„åŸºç¡€æ ‡å‡†ã€‚åœ¨æ­¤ä¹‹ä¸Šæ˜¯ç®¡æ§ï¼Œåœ¨æ”¶å£çš„åŸºç¡€ä¸Šï¼Œå¦‚æœä¸€ä¸ªå˜æ›´è¿‡ç¨‹ä¸­ï¼Œé˜²æ§èƒ½åŠ›çš„è¿è¡Œæ¨¡å¼åœ¨é¢„æœŸä¹‹å†…ï¼Œæ¯”å¦‚ä¸æ˜¯åˆ»æ„è·³è¿‡ï¼Œå°±ç®—æ˜¯æœ‰æ•ˆç®¡æ§ï¼Œå¦åˆ™åˆ™ç®—é£é™©é€ƒé€¸ã€‚æœ‰æ•ˆç®¡æ§ä¸å¦ï¼Œæœ¬è´¨èƒ½å¤Ÿåæ˜ ä¸è§„èŒƒçš„å˜æ›´è¡Œä¸ºå¸¦æ¥çš„å˜æ›´é£é™©ã€‚å¦‚æœå˜æ›´æ¸ é“æ”¶å£ç‡é«˜ï¼Œä½†æœ‰æ•ˆç®¡æ§ç‡ä½ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹éœ€è¦è€ƒè™‘ç ”å‘ä½“éªŒçš„é—®é¢˜ï¼Œæ¯”å¦‚æ‹¦æˆªå™ªéŸ³é«˜ï¼Œå‘å¸ƒæ•ˆç‡ä½ï¼Œå¯¼è‡´å®é™…å˜æ›´æ—¶ï¼Œå¤§å®¶æ›´åŠ æ„¿æ„è·³è¿‡è€Œä¸æ˜¯éµå¾ªåˆç†çš„ç®¡æ§æµç¨‹ã€‚è¿™äº›æ•°æ®è¿è¥å°±æ”¾åé¢è¯´ã€‚</p>
<p>è¿™é‡Œéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œæ¸ é“é£é™©å¹¶ä¸ä¼šç›´æ¥å’Œäº‹æ•…é£é™©ç›¸å…³è”ã€‚çº¿ä¸Šäº‹æ•…çš„è¯±å› é€šå¸¸æ˜¯æŸä¸ªæ¸ é“å˜æ›´äº§ç”Ÿï¼Œä½†æ ¹å› å¹¶ä¸ä¸€å®šåœ¨æ¸ é“æœ¬èº«ä¸Šã€‚æ¯”å¦‚ï¼ŒæŸä¸ªå¤§æ•°æ®é‡çš„è„šæœ¬åˆ·æ•°ï¼Œä»£ç é‡Œé¢ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰æ•°æ®ï¼Œä¸é™é€Ÿå»åˆ·DBï¼Œå¯¼è‡´DBæ‰›ä¸ä½ã€‚å¦‚æœæè¿°è¿™ç±»é£é™©çš„è¯ï¼Œå°±æ˜¯åœ¨åˆ·æ•°åœºæ™¯ï¼Œä»£ç å­˜åœ¨é£é™©ï¼Œè€Œä»£ç æ‰¿è½½åœ¨å“ªä¸ªæ¸ é“ï¼Œå°±æ˜¯å¦å¤–ä¸€å›äº‹äº†ã€‚æ‰€ä»¥å®æˆ˜å½“ä¸­ï¼Œé™¤äº†å¯¹æ¯ä¸ªæ¸ é“æœ¬èº«åšé£é™©è¿è¥ä¹‹å¤–ï¼Œæ›´éœ€è¦ä»å˜æ›´åœºæ™¯å‡ºå‘ï¼Œç¡®å®šæ€æ ·çš„èƒ½åŠ›å¯ä»¥æœ‰æ•ˆé™ä½é£é™©ï¼Œç„¶åå†å»çœ‹è¿™äº›èƒ½åŠ›æ€ä¹ˆåº”ç”¨åˆ°å‘å¸ƒæ¸ é“ä¸Šé¢ï¼Œè¿™æ ·æ‰èƒ½å¤ŸçœŸæ­£æŠŠäº‹æ•…é£é™©è§£å†³æ‰ã€‚</p>
<p>ç„¶åè®²ä¸€ä¸‹å‡†å¬æ‹¦æˆªã€‚ç®€å•æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªé˜²æ§èƒ½åŠ›ä¸ºç”¨æˆ·æš´éœ²äº†é£é™©ï¼Œé‚£ä¹ˆç›¸å½“äºäº§ç”Ÿäº†ä¸€æ¬¡æ‹¦æˆªã€‚å¦‚æœç”¨æˆ·è®¤ä¸ºå½“æ¬¡æ‹¦æˆªçš„å†…å®¹æ˜¯åˆç†çš„ï¼Œé‚£ä¹ˆå°±ç®—æ˜¯ä¸€æ¬¡æœ‰æ•ˆç²¾ç¡®çš„æ‹¦æˆªï¼Œå¦‚æœçº¿ä¸Šç¡®å®æœ‰é£é™©ï¼Œé£é™©ä¹ŸåŒæ—¶æš´éœ²å‡ºæ¥äº†ï¼Œé‚£å°±ç®—æ˜¯å¬å›äº†é£é™©ã€‚é€šå¸¸æ¥è®²é£é™©å¬å›æ¯”è¾ƒéš¾ç•Œå®šï¼Œå› ä¸ºåªæœ‰é—®é¢˜äº§ç”Ÿäº†ï¼Œæ‰èƒ½çŸ¥é“é£é™©æ˜¯å¦è¢«å¬å›ï¼Œæœ€å¤šåªèƒ½ç²—ç•¥è®¤ä¸ºï¼Œç”¨æˆ·æ“ä½œå›æ»šäº†ï¼Œå°±ç®—æœ‰é£é™©ã€‚æ‰€ä»¥ï¼Œæœ¬ç€é¿å…é—®é¢˜çš„ç›®çš„ï¼Œåœ¨å‡è®¾çº¿ä¸Šé—®é¢˜æ²¡æœ‰äº§ç”Ÿçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡ç»Ÿè®¡æ‹¦æˆªçš„ç²¾ç¡®ç‡ï¼Œæ¥è¡¡é‡é£é™©é˜²æ§èƒ½åŠ›çš„æŠ€æœ¯è´¨é‡ã€‚</p>
<p>å¯¹äºä¸åŒæ¸ é“ä¸åŒä¸šåŠ¡æœåŠ¡ï¼Œé£é™©æ‹¦æˆªçš„æƒ…å†µæ˜¯ä¸ä¸€æ ·çš„ã€‚é€šå¸¸æ¥è®²å¦‚æœè¦ç”¨ç®—æ³•ä¼˜åŒ–æ‹¦æˆªç­–ç•¥ï¼Œé¦–å…ˆè¦ç§¯ç´¯å¤§é‡çš„å‘å¸ƒå’Œä»¥å¾€çš„å˜æ›´æ•°æ®ï¼Œç„¶ååœ¨é£é™©å¬å›ä¸åŠ£åŒ–çš„å‰æä¸‹ï¼ŒåŸºäºä¸šåŠ¡ã€æ¸ é“ã€æœåŠ¡ã€éœ€æ±‚é‡è¦åº¦ç­‰ç‰¹å¾ï¼Œå»çœ‹å“ªäº›é˜²æ§èƒ½åŠ›çš„é‚£äº›æ‹¦æˆªåœºæ™¯éœ€è¦åšé™å™ªï¼Œå“ªäº›é—®é¢˜å¤šçš„æœåŠ¡éœ€è¦é‡ç‚¹æå‡å‘Šè­¦æ°´å¹³ã€‚ä»è€Œåœ¨é£é™©é˜²æ§å’Œç”¨æˆ·ä½“éªŒè´¨æ£€æ‰¾åˆ°æœ€ä½³çš„å¹³è¡¡ç‚¹ã€‚</p>
<p>æœ€åè®²ä¸€ä¸‹å‘å¸ƒæ•ˆç‡ã€‚å˜æ›´é£é™©é˜²æ§æœ¬èº«æ˜¯è‚¯å®šå¯¹å‘å¸ƒæ•ˆç‡æœ‰æŠ˜æŸçš„ï¼Œæ‰€ä»¥åœ¨è¡¡é‡é˜²æ§èƒ½åŠ›è´¨é‡çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦è€ƒè™‘èƒ½åŠ›æ‰§è¡Œæ˜¯å¦å¯¹å‘å¸ƒæœ¬èº«é€ æˆå½±å“ã€‚æ¯ä¸€æ¬¡å˜æ›´é™¤äº†ä¸Šæ–°éœ€æ±‚å¤–ï¼Œä¹Ÿæœ‰å¯èƒ½åŒ…å«å¯¹æ—¢å¾€ç¼ºé™·çš„ä¿®å¤ï¼Œæˆ–è€…æ˜¯ä¸€äº›hotfixç´§æ€¥ä¿®å¤çº¿ä¸Šé—®é¢˜ï¼Œå¯¹äºå‰è€…æ¥è®²æ›´åŠ å¸Œæœ›é£é™©æ‹¦æˆªæ›´å¸¸è§„ä¸€äº›ï¼Œåè€…åˆ™å¸Œæœ›å‘å¸ƒé€Ÿåº¦æ›´å¿«ä¸€äº›ï¼Œæ‹¦æˆªæ¾ä¸€äº›ã€‚ä»¥åŠï¼Œä¸€äº›æœåŠ¡æ˜¯æµ‹è¯•ç”¨çš„ï¼Œæˆ–è€…æ²¡æœ‰çº¿ä¸Šç”¨é‡ï¼Œç›¸å¯¹æ²¡é‚£ä¹ˆæ ¸å¿ƒï¼Œè€Œå¦ä¸€äº›æœåŠ¡åˆ™éœ€è¦é‡ç‚¹ç…§é¡¾ï¼Œæ‰€ä»¥å¯¹äºå‰è€…ï¼Œå¯ä»¥è€ƒè™‘æ›´å®½æ¾çš„æ‹¦æˆªç­–ç•¥ï¼ŒåŠ é€Ÿå‘å¸ƒè¿›åº¦ã€‚</p>
<p>ä¸€èˆ¬æ¥è®²ï¼Œå‘å¸ƒæ•ˆç‡åˆ†æä¸»è¦æ˜¯åˆ†ææ¯ä¸ªé˜¶æ®µçš„å‡†å…¥å‡†å‡ºè€—æ—¶ï¼Œä»¥åŠç»†ç²’åº¦å°±çœ‹å…·ä½“å“ªäº›å¡ç‚¹èƒ½åŠ›è€—æ—¶æ¯”è¾ƒå¤šã€‚ä¼˜åŒ–ç­–ç•¥æ–¹é¢ï¼Œå¦‚æœåœç•™è§‚æµ‹æ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¯ä»¥é…Œæƒ…ç¼©çŸ­åœç•™è§‚æµ‹æ—¶é—´é…ç½®ï¼›å¦‚æœæ˜¯äººå·¥ç¡®è®¤ä¸åŠæ—¶ï¼Œå¯ä»¥æå‡ç¡®è®¤é€šçŸ¥çš„ç´§æ€¥åº¦ï¼›å¦‚æœæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•è€—æ—¶è¿‡é•¿ï¼Œå¯ä»¥ä¼˜åŒ–è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç ï¼Œé…Œæƒ…ç¼©çŸ­å‡†å‡ºæ—¶é—´ã€‚æ€»è€Œè¨€ä¹‹ï¼Œéœ€è¦æŠŠæ¸ é“å‘å¸ƒã€æµæ°´çº¿æ‰§è¡Œã€é˜²æ§èƒ½åŠ›æ‰§è¡Œçš„æ•°æ®æ‰“é€šï¼Œæ‰èƒ½æ›´å¥½åˆ†æé—®é¢˜ï¼Œæ‰¾åˆ°æ•ˆç‡ä¼˜åŒ–ç‚¹ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>DevOps</tag>
        <tag>æ•°æ®æŒ–æ˜</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>å‡†å…¥å‡†å‡º</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘èŠèŠæŠ€æœ¯äººæå‡äº§å“æ„è¯†çš„ç»éªŒ</title>
    <url>/2025/02/21/geekdaily/geek_sense_of_product/</url>
    <content><![CDATA[<p>æŠ€æœ¯äººåŸ¹å…»äº§å“æ€ç»´ï¼Œè¿™ä¸€ç‚¹æ˜¯æŠ€æœ¯äººåœ¨èŒä¸šæˆé•¿ä¸­ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ã€‚æ— è®ºæ˜¯åšä¸šåŠ¡å¼€å‘ï¼Œè¿˜æ˜¯åšçº¯ç²¹çš„åŸºç¡€æ¶æ„ã€æŠ€æœ¯ä¼˜åŒ–ï¼Œæœ‰äº†äº§å“æ„è¯†ï¼Œæ‰èƒ½æŠŠè‡ªå·±çš„æŠ€æœ¯ä½œå“æ‰“ç£¨åœ°æ›´å¥½ï¼Œèƒ½åœ¨æ›´å¤šå·¥ä½œåœºæ™¯æ´¾ä¸Šç”¨åœºã€‚é‚£ä¹ˆï¼Œä»Šå¤©å°±èŠä¸€ä¸‹ä½œä¸ºæŠ€æœ¯äººï¼Œæœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥æå‡äº§å“æ„è¯†ã€‚</p>
<p>æŠŠè¿™ä¸ªé—®é¢˜ä¸¢ç»™AIï¼Œæ¦‚æ‹¬ä¸€ä¸‹ç­”æ¡ˆæ˜¯å‡ å¤§å—ï¼šç¬¬ä¸€å—æ˜¯å­¦ä¹ äº§å“çŸ¥è¯†ï¼Œæ¯”å¦‚é˜…è¯»ç›¸å…³äº§å“è®¾è®¡ä¹¦ç±ï¼Œå‚ä¸è¯¾ç¨‹è®²åº§ï¼›ç¬¬äºŒå—æ˜¯æ·±å…¥äº†è§£ç”¨æˆ·éœ€æ±‚ï¼ŒåŸ¹å…»ç”¨æˆ·è§†è§’ï¼›ç¬¬ä¸‰å—æ˜¯åŠ å¼ºè·¨éƒ¨é—¨æ²Ÿé€šï¼Œå’Œå…¶å®ƒå›¢é˜Ÿç´§å¯†åˆä½œã€‚AIç»™åˆ°äº†å¾ˆå¥½çš„ä¸€å¥—æ€ç»´æ¡†æ¶ï¼Œå¸®åŠ©æˆ‘ä»¬æŠ€æœ¯äººæ‰¾åˆ°ä¸€äº›æå‡äº§å“æ„è¯†çš„è·¯å¾„ï¼Œä½†å…·ä½“æ€ä¹ˆåšï¼Œæœ€ç»ˆè¿˜æ˜¯è¦ç»“åˆå’±ä»¬è‡ªå·±çš„ç»å†æ¥ã€‚æ‰€ä»¥ä»Šå¤©ï¼Œå°±åˆ†äº«ä¸€ä¸‹ä¸ªäººç»éªŒã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆï¼Œéœ€è¦é—®è‡ªå·±ï¼Œå‡è®¾è‡ªå·±æ˜¯ä¸€ä¸ªæŠ€æœ¯äººï¼Œéœ€è¦åšåˆ°æœ‰äº§å“æ„è¯†å—ï¼Ÿåˆä¸ºä»€ä¹ˆéœ€è¦åšåˆ°ï¼Ÿæœ¬è´¨ä¸Šæ¥è®²ï¼Œå¦‚æœè‡ªå·±çš„æŠ€æœ¯ä½œå“ï¼Œè¦ç»™äººç”¨ï¼Œé‚£å°±å¾—å»åŸ¹å…»äº§å“æ„è¯†ï¼›å¦‚æœåªæ˜¯ç‚«æŠ€ç»ƒæ‰‹ï¼Œä¸ºäº†é¢è¯•ç”¨ï¼Œé‚£ä¹Ÿå¯ä»¥ä¸éœ€è¦äº§å“æ„è¯†ï¼Œå½“ä¸ªç©å…·ï¼Œæœ€åä¸¢åˆ°githubå½“å¤‡èƒä¹Ÿå¯ä»¥ã€‚</p>
<p>ä¸€ä¸ªæŠ€æœ¯äº§å“è¦èƒ½ç»™äººç”¨åˆ°ï¼Œä½ éœ€è¦çŸ¥é“ä½ çš„æŠ€æœ¯æœåŠ¡çš„äººç¾¤æ˜¯è°ï¼Œä»–ä»¬æœŸæœ›ä½ çš„æŠ€æœ¯ä½œå“å¸¦æ¥ä»€ä¹ˆæ ·çš„æ•ˆæœï¼Œä»¥åŠï¼Œå¦‚æœä½ æ­£å¥½ä¹Ÿå¯ä»¥æˆä¸ºè¿™ç±»äººç¾¤çš„è¯ï¼Œä½ è§‰å¾—æ€æ ·çš„æ•ˆæœæ‰æ˜¯æœ€åˆé€‚çš„ã€‚æ¯”å¦‚ï¼Œä½ åœ¨å¤§å…¬å¸ï¼Œä½œä¸ºä¸€ä¸ªä¸­å°è§’è‰²ï¼Œä½ çš„æœåŠ¡å¯¹è±¡å°±æ˜¯ä¸šåŠ¡ï¼Œæœ‰æ—¶å€™ä¸šåŠ¡åŒå­¦çš„å¾ˆå¤šç²¾åŠ›éƒ½æ²¡æ³•é›†ä¸­åœ¨åŸºç¡€æŠ€æœ¯ä¸Šï¼Œæ‰€ä»¥å¸Œæœ›ä½ å¯ä»¥ä¸ºä¸šåŠ¡åšå¾ˆå¤šå®šåˆ¶åŒ–çš„ä¸œè¥¿ã€‚å¯¹äºä¸€ä¸ªæŠ€æœ¯æ¶æ„æ¥è¯´ï¼Œé€šè¿‡ä»€ä¹ˆåº•åº§å»å…¼å®¹æ— å°½çš„å®šåˆ¶åŒ–éœ€æ±‚ï¼Œå°±æ˜¯ä½ çš„æŠ€æœ¯éš¾é¢˜ï¼Œå¦‚æœä½ çš„æŠ€æœ¯åº•åº§æ—¢å¯ä»¥æ»¡è¶³å¾ˆå¤šå®šåˆ¶åŒ–éœ€æ±‚ï¼Œåˆèƒ½å¤Ÿéå¸¸æ–¹ä¾¿åœ°è½¬åŒ–æˆä¸šåŠ¡å¯äº¤äº’çš„å½¢å¼ï¼Œé‚£ä¹ˆå°±è§£å†³äº†è¿™ä¸ªéš¾é¢˜ï¼Œæ»¡è¶³äº†ç”¨æˆ·éœ€æ±‚ã€‚è¿™æ ·ï¼Œä½ çš„æŠ€æœ¯ä½œå“ï¼Œå°±å…·å¤‡äº†äº§å“æ€§è´¨ã€‚åšåŸºç¡€åº•å±‚ä¼˜åŒ–ä¹Ÿæ˜¯ä¸€æ ·ï¼Œæ¯”å¦‚æ¸¸æˆæ€§èƒ½å’Œç¾æœ¯ï¼Œä¼˜åŒ–çš„æœ€ç»ˆç›®çš„ï¼Œä¹Ÿæ˜¯ä¸ºäº†ç»™ç©æ¸¸æˆçš„äººä¸€ä¸ªæ›´å¥½çš„ä½“éªŒã€‚æ‰€ä»¥ï¼Œç”¨å¿ƒåšä½œå“ï¼Œä¸å•åšæŠ€æœ¯ï¼Œè¿™æ˜¯ç¬¬ä¸€æ­¥ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¦‚æœäº§å“åšå¤§äº†ï¼ŒæŠ€æœ¯å±‚é¢ï¼Œè¦æ€ä¹ˆæ»¡è¶³ä¸åŒçš„äº§å“éœ€æ±‚ç›®æ ‡ï¼Ÿå¾ˆå¤šæŠ€æœ¯ä½œå“åœ¨åˆæœŸï¼Œå¯èƒ½æ˜¯ä¸ºäº†ä¸€äº›å¾ˆå°çš„ç—›ç‚¹ï¼Œåšäº†é’ˆå¯¹æ€§çš„è§£å†³ï¼Œæœ€ç»ˆæåˆ°äº†ç¬¬ä¸€æ¡¶é‡‘ï¼Œè®©å¾ˆå¤šäººå¯ä»¥ç”¨ä¸Šï¼Œä½†é•¿æ­¤ä»¥å¾€ï¼Œå°±ä¼šæœ‰å¾ˆå¤šäººæå‡ºä¸åŒçš„è¯‰æ±‚ï¼Œé‡å£éš¾è°ƒã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦å­¦ä¼šåšéœ€æ±‚ç®¡ç†ã€‚é™¤äº†ç…§é¡¾ç”¨æˆ·çš„è¯‰æ±‚ä¹‹å¤–ï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®è‡ªå·±çš„äº§å“éœ€è¦è¾¾åˆ°æ€æ ·çš„å½¢æ€ï¼Œæ ‡æ–°ç«‹å¼‚ï¼Œåšå®šåŸåˆ™ï¼Œè¿™æ ·æ‰èƒ½çŸ¥é“ï¼Œç”¨æˆ·è¯‰æ±‚å“ªäº›å¯¹äºäº§å“æ¼”åŒ–è€Œè¨€æ˜¯å…³é”®çš„ï¼Œå“ªäº›æ˜¯æ¬¡è¦çš„ï¼Œå“ªäº›æ˜¯å¯é€‰çš„ã€‚è¿™æ ·åœ¨æŠ€æœ¯å®ç°ä¸Šï¼Œæˆ‘ä»¬å°±å¯ä»¥åšé€‰æ‹©æ€§çš„æ¼”åŒ–å’Œé‡æ„ï¼Œä¸€æ­¥ä¸€ä¸ªè„šå°ï¼Œè®©æ•´ä¸ªæŠ€æœ¯ä½“ç³»è¶Šæ¥è¶Šä¸°å¯Œï¼Œæœ€ç»ˆèƒ½å¤Ÿæ”¯æŒåˆ°é¢„æœŸçš„äº§å“å½¢æ€ã€‚</p>
<p>åœ¨è¿™æœŸé—´ï¼Œåšå¥½æ•°æ®ç®¡ç†æ˜¯éå¸¸é‡è¦çš„ï¼Œè¦æè¿°ä¸€ä¸ªäº§å“çš„â€œå¥½åâ€ï¼Œå°‘ä¸äº†é€šè¿‡æ•°æ®æŒ‡æ ‡æ¥å¯¹äº§å“çš„æ•ˆæœåšå»ºæ¨¡ã€‚ç”¨æˆ·ä½“éªŒçš„æ¯”å¦‚pvã€uvï¼Œç¨³å®šæ€§çš„æ¯”å¦‚å¯ç”¨æ€§å»¶æ—¶SLIæˆ–è€…æ ‡å‡†profiling-benchmarkï¼Œä»¥åŠä¸šåŠ¡äº‹åŠ¡ç»Ÿè®¡è¿™ç±»ä¸šåŠ¡æ€§è´¨æŒ‡æ ‡ï¼Œéƒ½æ˜¯éœ€è¦æ­å»ºèµ·çœ‹æ¿å®æ—¶è·Ÿè¸ªçš„ã€‚æ—¶å¸¸è·Ÿè¸ªæŒ‡æ ‡ï¼Œä¹Ÿèƒ½å¤Ÿä¸€ç›´æ˜ç¡®ä¸‹ä¸€æ­¥å·¥ä½œçš„æ–¹å‘ï¼Œè€Œä¸æ˜¯åŸåœ°æ‰“è½¬ï¼Œäº§ç”ŸæŠ€æœ¯å†…è€—ã€‚</p>
<p>æœ€åï¼Œå¦‚æœæŠ€æœ¯äº§å“åšçš„éå¸¸æˆç†Ÿäº†ï¼Œç”¨æˆ·éœ€æ±‚å¼€å§‹é€æ¸å¹³ç¼“ç”šè‡³ä¸‹è·Œï¼ŒæŠ€æœ¯ä¼˜åŒ–ä¹Ÿæ²¡æœ‰å¤ªå¤šä½™åœ°ï¼Œä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆåŠï¼Ÿå¦‚æœè¯´åˆ°è¾¾äº†è¿™ä¸ªé˜¶æ®µï¼Œå…¶å®å·²ç»è¯´æ˜æˆ‘ä»¬åœ¨å½“å‰æŠ€æœ¯ä½œå“ä¸Šçš„æŠ•å…¥å·²ç»å–å¾—äº†ä¸€å®šçš„æˆåŠŸï¼Œå¯ä»¥å€ŸåŠ©è¿™ä»½æˆåŠŸï¼Œå»åšæ›´å¤šæå‡å½±å“åŠ›çš„äº‹æƒ…ã€‚å½¢å¼ä¸Šå¯ä»¥å¾ˆä¸°å¯Œï¼ŒåŒ…æ‹¬ä½†ä¸é™äºå†™æŠ€æœ¯åšå®¢è·Ÿæ‹è§†é¢‘ï¼Œå»åˆ†äº«è§£å†³é—®é¢˜çš„ç»éªŒï¼Œä¸ºè‡ªå·±çš„äº§å“æ‰“æ–°å¹¿å‘Šï¼Œå»è®©ä¸€ä¸ªå°ä¼—äº§å“å†å˜æˆå¤§ä¼—äº§å“ã€‚ä½†æœ¬è´¨ä¸Šï¼Œè¿˜æ˜¯è¦å°Šä»è‡ªå·±çš„æœ¬å¿ƒï¼Œè‡ªå·±è¦ä¸¥æ ¼éµå¾ªè‡ªå·±å¯¹äºæŠ€æœ¯ä½œå“çš„è¦æ±‚å’ŒåŸåˆ™ï¼Œè¿™æ ·æ‰èƒ½å…‘ç°æŠ€æœ¯æŠ•å…¥çš„ä»·å€¼ã€‚</p>
<p>æ‰€ä»¥ï¼Œç®€å•æ¥è¯´ï¼Œç”¨å¿ƒåšä½œå“ï¼Œå°±å¥½ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>äº§å“</tag>
        <tag>ChatGPT</tag>
        <tag>é¢è¯•</tag>
        <tag>ä¸ªäººåšå®¢</tag>
        <tag>ç”¨æˆ·</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘å˜æ›´é£é™©è§‚æµ‹çš„æµç¨‹é€»è¾‘è®¾è®¡</title>
    <url>/2025/01/26/testlife/change_observe_logic/</url>
    <content><![CDATA[<p>åœ¨çº¿ä¸ŠæœåŠ¡å˜æ›´è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥é€šè¿‡ä¸€å¥—å®æ—¶è§‚æµ‹æœºåˆ¶å»ç›‘æµ‹çº¿ä¸ŠæœåŠ¡çš„é£é™©ï¼Œä»è€Œèƒ½å¤Ÿç¡®ä¿çº¿ä¸Šç¨³å®šæ€§ï¼Œåœ¨å‡ºé—®é¢˜æ—¶å¯ä»¥åŠæ—¶å›æ»šå˜æ›´ã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±ç®€å•è®²ä¸€ä¸‹å˜æ›´é£é™©è§‚æµ‹çš„æµç¨‹é€»è¾‘éœ€è¦æ€ä¹ˆè®¾è®¡ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦å»ºæ¨¡å˜æ›´è§‚æµ‹çš„è¿‡ç¨‹ã€‚å˜æ›´è§‚æµ‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸€èˆ¬æ¥è®²ï¼Œå½“æœåŠ¡æŸé˜¶æ®µå˜æ›´å¼€å§‹åï¼Œè§‚æµ‹ä¼šå¼€å§‹ï¼Œç„¶åå½“æœåŠ¡æŸé˜¶æ®µå˜æ›´å®Œï¼Œä¸€èˆ¬è¿˜éœ€è¦åœç•™è§‚å¯Ÿä¸€æ®µæ—¶é—´ï¼Œç¡®å®šçº¿ä¸Šæ²¡æœ‰é—ç•™é£é™©ä¹‹åï¼Œè§‚æµ‹æ‰ä¼šç»“æŸã€‚å¯ä»¥ç®€å•çš„è®¤ä¸ºï¼Œä¸€æ¬¡å˜æ›´è§‚æµ‹ï¼Œå…³è”ä¸€æ¬¡å‘å¸ƒçš„æŸä¸€ä¸ªè¿‡ç¨‹ã€‚æ‰€ä»¥ä¸€ä¸ªè§‚æµ‹ä»»åŠ¡ï¼Œç»“æ„æ•°æ®ä¸Šéœ€è¦åŒ…å«å‘å¸ƒå·¥å•çš„å…ƒä¿¡æ¯ã€è§‚æµ‹å‚æ•°çš„å…ƒä¿¡æ¯ï¼Œä»¥åŠä»»åŠ¡è‡ªå·±çš„è¿è½¬çŠ¶æ€ï¼ŒåŒæ—¶æ¯ä¸ªä»»åŠ¡å®ä¾‹éœ€è¦è¢«æœ‰åºçš„è°ƒåº¦èµ·æ¥ï¼Œå› æ­¤æ‰€ä»¥è¦æœ‰ä¸€ä¸ªè°ƒåº¦ç³»ç»Ÿå»å¤„ç†æ¯ä¸ªä»»åŠ¡å®ä¾‹çš„çŠ¶æ€æ¨è¿›ã€‚</p>
<p>ç„¶åï¼Œå†ç»†ä¸€ä¸ªç²’åº¦ï¼Œå¯¹äºä¸€ä¸ªç‰¹å®šçš„å˜æ›´é£é™©ç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦ç”¨ä¸€ä¸ªç‰¹å®šçš„è§‚æµ‹èƒ½åŠ›å»coverï¼Œæ‰€ä»¥å¯¹äºæ¯ä¸ªè§‚æµ‹èƒ½åŠ›ï¼Œä¹Ÿè¦å’Œä¸Šå±‚çš„è§‚æµ‹ä»»åŠ¡ä¸€æ ·ï¼Œæœ‰è‡ªå·±çš„å…ƒä¿¡æ¯å’ŒçŠ¶æ€è½¬æ¢å®šä¹‰ã€‚ä»»åŠ¡å¯¹èƒ½åŠ›æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä¸€ä¸ªè§‚æµ‹ä»»åŠ¡å½“ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸç§ç¼–æ’ï¼ŒæŠŠä¸åŒèƒ½åŠ›åœ¨ä¸åŒçš„æ—¶é—´ç‚¹å¯åŠ¨èµ·æ¥ï¼Œåˆ‡å…¥åˆ°å‘å¸ƒè¿‡ç¨‹çš„ä¸åŒæ—¶æœºï¼Œè¿™æ ·å°±èƒ½å¤Ÿå½¢æˆçµæ´»çš„å˜æ›´è§‚æµ‹ã€‚</p>
<p>ä»è¿™äº›è§’åº¦å‡ºå‘ï¼Œä»¥ä¸€ä¸ªç®€å•çš„ä¸²è¡Œæ€ç»´ï¼Œæ•´ä¸ªå˜æ›´è§‚æµ‹ä»»åŠ¡éœ€è¦åšä»¥ä¸‹çš„åŠ¨ä½œï¼š</p>
<a id="more"></a>
<ul>
<li>ä»»åŠ¡åˆ›å»º<ul>
<li>é¢„å¤„ç†ä»»åŠ¡å¯åŠ¨å‚æ•°ï¼Œç¡®å®šéœ€è¦è§‚æµ‹çš„æœåŠ¡å¯¹è±¡</li>
<li>è·å–è§‚æµ‹ç­–ç•¥ï¼Œç¡®å®šéœ€è¦å¯åŠ¨çš„ç›‘æµ‹èƒ½åŠ›</li>
<li>è½åº“ä¸€æ¡ä»»åŠ¡è®°å½•ï¼Œè°ƒæ•´ä¸ºinitçŠ¶æ€ï¼Œç¼“å­˜è§‚æµ‹èƒ½åŠ›å’ŒæœåŠ¡å¯¹è±¡ç­‰ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
<li>è¿”å›ä»»åŠ¡è®°å½•ï¼Œä»»åŠ¡åˆ›å»ºå®Œæˆ</li>
</ul>
</li>
<li>ä»»åŠ¡æ¨è¿›<ul>
<li>ç¡®è®¤ä»»åŠ¡æ˜¯å¦åœ¨ç»ˆæ­¢æ€ï¼Œå¦‚æœæ²¡æœ‰ç»ˆæ­¢å°±ç»§ç»­æ¨è¿›</li>
<li>ç¡®è®¤ä»»åŠ¡æ˜¯å¦éœ€è¦æå‰ç»ˆæ­¢ï¼ˆæ¯”å¦‚å˜æ›´å–æ¶ˆçš„æƒ…å†µï¼‰</li>
<li>ç¡®è®¤å½“ä¸‹éœ€è¦æ–°å¯åŠ¨å“ªäº›æ£€æµ‹é¡¹ï¼Œå¦‚æœæœ‰éœ€è¦åšå¼‚æ­¥å¯åŠ¨ï¼Œå…³è”è¿™ä¸ªä»»åŠ¡</li>
<li>ç¡®è®¤å·²å¯åŠ¨çš„æ£€æµ‹é¡¹æœ€æ–°çš„çŠ¶æ€å’Œç»“æœæ˜¯ä»€ä¹ˆï¼ŒåšçŠ¶æ€æ¨è¿›åŠ¨ä½œ</li>
<li>å¯¹å½“ä¸‹çš„ç»“æœåšåŠ¨æ€é™å™ªï¼Œå¦‚æœæœ‰å¿…è¦åˆ™å®æ—¶æ—è·¯å‘Šè­¦ï¼Œç¼“å­˜æœ€ç»ˆå†³ç­–çš„ç»“æœ</li>
<li>ç¡®è®¤æ˜¯å¦æ‰€æœ‰æ£€æµ‹é¡¹è¾¾åˆ°ç»ˆæ­¢æ€ï¼Œè¾¾åˆ°åˆ™ç»ˆæ­¢ä»»åŠ¡ï¼Œåšæ‰§è¡Œç»“æœå’Œå‘Šè­¦çš„æœ€ç»ˆè½åº“</li>
</ul>
</li>
</ul>
<p>å½“ç„¶ï¼Œå…¶ä¸­æ¯ä¸ªç‚¹è¿˜å¯ä»¥è¯¦ç»†æŒ–æ˜ï¼Œé¦–å…ˆæ˜¯è§‚æµ‹ç­–ç•¥æ€ä¹ˆå»åŒ¹é…ã€‚ç­–ç•¥çš„åŒ¹é…ï¼Œæ¶‰åŠåˆ°æ¯ä¸ªå˜æ›´æ¸ é“ä¼šé€šè¿‡ä»€ä¹ˆæ ·çš„æ–¹å¼å»ç®¡ç†èµ„æºï¼Œæœ‰äº›æ¸ é“å¯èƒ½å…·å¤‡ä¸šåŠ¡æ€§è´¨ï¼Œé€šè¿‡æ ‘ç»“æ„å»ç®¡ç†æ¯ä¸ªä¸šåŠ¡ä¸‹é¢çš„èµ„æºï¼Œæœ‰äº›åˆ™å¯èƒ½æ˜¯ç®€å•çš„uuidçš„å½¢å¼ã€‚</p>
<p>è¿™é‡Œï¼Œå¦‚æœæ¸ é“æ˜¯é€šè¿‡æ ‘ç»“æ„ç®¡ç†èµ„æºçš„è¯ï¼Œé‚£ä¹ˆéœ€è¦è€ƒè™‘ä¸€æ¡rootåˆ°leafçš„è·¯å¾„ä¸Šï¼Œå¯¹åº”çš„è§‚æµ‹ç­–ç•¥è¦å–å“ªäº›ï¼Œæ˜¯å–leafå°±è¿‘çš„ä¸€ä¸ªï¼Œè¿˜æ˜¯è¯´æ‰€æœ‰éƒ½å–ï¼Œæˆ–è€…æ˜¯å…¶å®ƒæ€ä¹ˆæ ·çš„é€»è¾‘ã€‚ä»ç¬”è€…çš„ç»éªŒæ¥è®²ï¼Œä¸€ä¸ªæ¯”è¾ƒåˆé€‚çš„æ–¹å¼æ˜¯ï¼Œæ‰€æœ‰éƒ½å–ï¼Œä½†æ¯ä¸ªç­–ç•¥éœ€è¦æ’ä¼˜å…ˆçº§ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§å»å»é™¤åŒè´¨çš„æ£€æµ‹é¡¹ã€‚è¿™æ ·é€šè¿‡ç»„åˆä»£æ›¿ç»§æ‰¿çš„æ–¹å¼ï¼Œå¯ä»¥å…¼å®¹æ¸ é“å„ç§ç®¡ç†èµ„æºçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥æ»¡è¶³æ›´å¤šçš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p>ç„¶åæ˜¯ä¸åŒçš„è§‚æµ‹èƒ½åŠ›æ€ä¹ˆå»åšè”åŠ¨ã€‚å¥½æ¯”è¯´ï¼Œå¯¹äºæŸä¸€ä¸ªé£é™©ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå˜æ›´ä¸Šä¸‹æ–‡åˆ†æã€æ•°æ®å‘Šè­¦ç›‘æµ‹ã€ç»“æœé™å™ªã€é£é™©å‘¨çŸ¥ä»¥åŠæ ¹å› åˆ†æè¿™äº›èƒ½åŠ›ç»™ä¸²è”èµ·æ¥ï¼Œå¯¹äºå…¶å®ƒé£é™©ç‚¹åˆå¯èƒ½æœ‰ä¸åŒçš„èƒ½åŠ›è”åŠ¨å’Œåˆ‡å…¥æ¡ä»¶ï¼Œé‚£ä¹ˆæ•´ä¸ªä»»åŠ¡çš„é€»è¾‘ç¼–æ’å°†ä¼šæ˜¯éå¸¸å¤æ‚çš„ï¼Œç®€å•çš„ä¸€ä¸ªå®ç°æ€è·¯æ˜¯é€šè¿‡ä¸€æ¡ä¸»çº¿é“¾è·¯åŠ ä¸Šå¤šæ¡æ”¯çº¿é“¾è·¯å»å…¼å®¹çš„æ–¹å¼ï¼Œä½†è¿™ä¹Ÿå¹¶éæœ€å®Œç¾çš„æè¿°ã€‚</p>
<p>ä»ä¸€ä¸ªäº§å“åŒ–çš„è§’åº¦è®²ï¼Œå˜æ›´è§‚æµ‹ä»è¡Œä¸ºä¸Šçœ‹ï¼Œå…¶å®å¯ä»¥ç”¨ä¸€ä¸ªè¡Œä¸ºæ ‘æ¥æè¿°ï¼Œä¹Ÿå°±æ˜¯è¯´è§‚æµ‹çš„æ¯ä¸€åˆ»ï¼Œæˆ‘éƒ½éœ€è¦åŠ¨æ€åœ°åˆ¤æ–­å“ªä¸ªæ£€æµ‹èƒ½åŠ›è¦å¯åŠ¨ï¼Œå“ªä¸ªèƒ½åŠ›è¦åœæ­¢ï¼Œå“ªä¸ªèƒ½åŠ›çš„ä¸Šæ¸¸ä¾èµ–å®Œæˆäº†å¯ä»¥è¿è¡Œï¼Œç„¶åå¯åŠ¨çš„è¯ä¼ å…¥ä»€ä¹ˆå‚æ•°ï¼Œä¸åŒæ—¶é—´ç‚¹ä¼ çš„å‚æ•°ä¹Ÿä¼šä¸ä¸€æ ·ï¼Œä»¥åŠçº¿ä¸Šå¦‚æœæœ‰å…¶å®ƒçš„å˜æ›´äº‹ä»¶ï¼Œéœ€è¦å¯¹ä»»åŠ¡æ€æ ·åŠ¨æ€è°ƒæ•´ã€‚å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œå¯ä»¥é€šè¿‡å¯è§†åŒ–çš„æ–¹å¼å»ç¼–æ’æ•´ä¸ªè¡Œä¸ºæ ‘ï¼Œè¿™æ ·å°±å¯ä»¥è®©ç”¨æˆ·éå¸¸æ–¹ä¾¿åœ°å»å®šåˆ¶åŒ–ç¼–æ’æ•´ä¸ªè§‚æµ‹ä»»åŠ¡ã€‚</p>
<p>æœ€åå°±æ˜¯å†³ç­–ç»“æœæ€ä¹ˆå’Œå‘å¸ƒå·¥å•è”åŠ¨ã€‚ä»å˜æ›´è´¨é‡ç®¡ç†çš„è§’åº¦æ¥è®²ï¼Œæˆ‘ä»¬é€šå¸¸å¸Œæœ›å˜æ›´è§‚æµ‹å‡ºç°é£é™©æ—¶ï¼Œå¯¹å˜æ›´æ¸ é“çš„å‘å¸ƒè¿‡ç¨‹è¿›è¡Œå¡ç‚¹æˆ–è€…å…¶ä»–æµç¨‹å¹²é¢„æ“ä½œã€‚è¦å®ç°è¿™ä¸ªäº‹æƒ…ï¼Œæ›´å¤šçš„è€ƒè™‘è¿˜æ˜¯å˜æ›´è§‚æµ‹æ–¹å’Œå˜æ›´æ¸ é“æ–¹åœ¨åˆä½œæ¨¡å¼ä¸Šæ€ä¹ˆè¾¾æˆå…±è¯†ã€‚ä¸€èˆ¬æ¥è®²åˆé€‚çš„æ–¹å¼æ˜¯ï¼Œæ¸ é“æœ¬èº«å‘ç°ä»»åŠ¡ç»“æœfailç„¶åå»å¡æµç¨‹ï¼Œä½†é£é™©ç¡®è®¤è·³è¿‡çš„æ“ä½œç»Ÿä¸€æ³¨å†Œç»™å˜æ›´è§‚æµ‹æ–¹ï¼Œåœ¨è·³è¿‡æ—¶å˜æ›´è§‚æµ‹æŠ¥å‘Šè°ƒæ•´ä¸ºskipçŠ¶æ€å¹¶ä¸”skipæ‰æ¸ é“çš„å¡ç‚¹ã€‚è¿™æ ·ä¸€æ¥ä¸ä¼šæœ‰è¿‡å¤šä¾µå…¥çš„æ“ä½œï¼ŒäºŒæ¥ä¹Ÿèƒ½å¤Ÿè¾¾åˆ°å˜æ›´ç®¡æ§çš„æ•ˆæœã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>å¼‚æ­¥</tag>
        <tag>DevOps</tag>
        <tag>è¡Œä¸ºæ ‘</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘å‡è‚¥10kgä¿æŒåŠå¹´çš„ç»éªŒåˆ†äº«</title>
    <url>/2025/01/25/diymemo/ways_to_become_fit/</url>
    <content><![CDATA[<p>ä½œä¸ºç¨‹åºå‘˜ï¼Œè„‘åŠ›åŠ³åŠ¨è€…ï¼Œä¿æŒä¸€ä¸ªå¥åº·çš„èº«ä½“ï¼Œæ˜¯éå¸¸é‡è¦çš„ã€‚å›é¡¾24å¹´è‡ªå·±å–å¾—çš„ç»“æœï¼Œä¸€ä¸ªæ¯”è¾ƒäº®çœ¼çš„å°±æ˜¯å‡è‚¥å‡äº†10kgï¼Œåˆ°è¾¾äº†ä¸€ä¸ªæ¯”è¾ƒå¥åº·çš„ä½“é‡ï¼Œä¿æŒäº†åŠå¹´æ²¡æœ‰åå¼¹ï¼Œå½“ç„¶åˆ°ç°åœ¨ä¹Ÿä¾ç„¶åœ¨ä¿æŒã€‚ä»Šå¤©è¿™ç¯‡æ–‡ç« å°±ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹è‡ªå·±çš„å‡è‚¥å’Œä½“é‡ä¿æŒçš„ç»éªŒã€‚</p>
<p>å‡è‚¥çš„è¦é¢†ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼šå¿ƒæ€ã€åƒã€è¿åŠ¨ä»¥åŠä¼‘æ¯ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯å¿ƒæ€ï¼Œå‡è‚¥çš„è¿‡ç¨‹ä¸­ï¼Œå¿ƒæ€æ˜¯æœ€é‡è¦çš„ã€‚ä¸ºä»€ä¹ˆå¾ˆå¤šäººå‡è‚¥åšæŒä¸ä¸‹å»ï¼Œæˆ–è€…å‡è‚¥ä¸‹å»äº†åˆåå¼¹å›æ¥ï¼Œå‰åŠŸå°½å¼ƒï¼Œä¸»è¦å°±æ˜¯å¿ƒæ€é—®é¢˜ã€‚è¦ä¿æŒä¸€ä¸ªæ€æ ·çš„å¿ƒæ€å‘¢ï¼Ÿä¸€æ˜¯ç«¯æ­£ç›®çš„ï¼Œå‡è‚¥çš„ç›®çš„æ˜¯ä¿æŒå¥åº·ï¼Œåªæœ‰åˆ°äº†æŸä¸ªä½“é‡ï¼Œå¹¶ä¸”ä¿æŒä¸‹å»ï¼Œæ‰èƒ½ä¿æŒå¥åº·ã€‚å¦‚æœæ²¡æœ‰è¿™å±‚é€»è¾‘å»ç‰µå¼•çš„è¯ï¼Œåˆ°äº†æŸä¸ªä½“é‡ï¼Œå°±åˆ°è¾¾è‡ªå·±ç›®æ ‡çš„è¯ï¼Œé‚£è¦åšæ¥ä¸‹æ¥çš„äº‹æƒ…ï¼Œä½“é‡å¯ä¸å°±å›å»äº†ï¼Ÿæ‰€ä»¥ç›®çš„ä¸Šè¦æ˜ç¡®æ˜¯ä¿æŒå¥åº·ï¼Œè€Œä¸”è¿™æ˜¯ä¸€ç”Ÿéƒ½è¦æŒç»­åšçš„äº‹æƒ…ã€‚</p>
<p>äºŒæ˜¯è¦æ¥å—ä½“é‡çš„æ³¢åŠ¨ï¼Œå¥åº·åˆç†çš„å‡è‚¥ä¸æ˜¯ä¸‰äº”å¤©çš„äº‹æƒ…ï¼Œè€Œæ˜¯ä¸€ä»¶å¾ˆé•¿æœŸå¾ˆæ—¥å¸¸çš„å·¥ä½œï¼Œå¦‚æœå¼ºè¡Œé¥¿ä¸‰äº”å¤©ï¼Œé‚£ä¸€æ¥å¾ˆä¸å¥åº·ï¼ŒäºŒæ¥å¾ˆå®¹æ˜“åƒå›æ¥ï¼Œæ‰€ä»¥ä½“é‡çš„å‡è½»æ˜¯éœ€è¦åœ¨å¥åº·çš„å‰æä¸‹ï¼Œé€æ¸çš„å‡è½»ï¼Œè¿™æ ·çš„èŠ‚å¥ä¼šæ¯”è¾ƒåˆç†ã€‚å…·ä½“æ€ä¹ˆé€æ¸çš„å‡è½»ï¼Œå°±è¦çœ‹åç»­çš„åƒã€è¿åŠ¨ä»¥åŠä¼‘æ¯æ€ä¹ˆåšã€‚</p>
<p>ç„¶åå°±è¯´åƒï¼Œä¸€ä¸ªæ˜¯åƒå¤šå°‘ï¼Œä¸€ä¸ªæ˜¯åƒä»€ä¹ˆã€‚</p>
<p>åƒå¤šå°‘ï¼Œéœ€è¦æˆ‘ä»¬æ—¶åˆ»ç›‘è§†è‡ªå·±çš„ä½“é‡ï¼Œç»“åˆæ—¶åˆ»ç›‘æ§æ¥å»æ§åˆ¶ã€‚ä¸€å¤©ç˜¦å¾ˆå¤šï¼Œå¯ä»¥åƒå¤šä¸€ç‚¹ï¼›ç˜¦å¾ˆå°‘ï¼Œå°±åƒå°‘ä¸€ç‚¹ï¼Œä½†å‡è‚¥çš„è¯ï¼Œä¸€å®šè¦ä¿è¯æœ‰çƒ­é‡ç¼ºå£ï¼Œè¿™æ ·æ‰æœ‰å‡ä¸‹å»çš„ç©ºé—´ã€‚å¦‚æœä½“é‡å‡ä¸‹å»ï¼Œæ„Ÿè§‰é¥¿ï¼Œæ§åˆ¶ä¸ä½æƒ³è¦åƒå¤šï¼Œä½†åƒå¤šåˆåå¼¹ï¼Œæ€ä¹ˆåŠï¼Ÿé€šè¿‡é€‚å½“çš„æ¬ºéª—ä¸è®©èº«ä½“ä¹ æƒ¯è¿‡å°‘çš„æ‘„å…¥ï¼Œè®©ä½“é‡æ³¢æµªå‹ä¸‹æ»‘ï¼Œå°±å¯ä»¥è¾¾åˆ°æŒç»­å‡è‚¥çš„æ•ˆæœã€‚</p>
<p>å¦å¤–ä¸€ä¸ªé—®é¢˜æ˜¯åƒä»€ä¹ˆï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯å‡å°‘ä¸»é£Ÿæ‘„å…¥ï¼Œæ¯”å¦‚åƒé¢å°‘åƒä¸€åŠï¼Œåƒé¥­å°‘åƒä¸€åŠï¼Œéƒ½æ˜¯å¯å–çš„åšæ³•ã€‚æ—©é¤å¤šè¥å…»ï¼Œåˆé¤å¤šåƒé¥±ï¼Œæ™šé¤å°‘åƒï¼Œå°½é‡å‡ç¢³æ°´ï¼Œè‚‰èœå¯ä»¥å¤šåƒï¼Œé¥®æ–™å°½é‡å–200calä»¥ä¸‹çš„ï¼Œå°±å·®ä¸å¤šã€‚</p>
<p>ä¹‹åè¯´è¿åŠ¨ï¼Œè¿åŠ¨é™¤äº†æ•£å‘çƒ­é‡å¤–ï¼Œæœ€é‡è¦çš„è¿˜æ˜¯æå‡è‡ªå·±çš„ä»£è°¢èƒ½åŠ›ï¼Œè®©å¿ƒæƒ…å˜å¾—æ›´å¥½ï¼Œä»è€Œè®©å‡è‚¥æ•ˆç‡æ›´é«˜ã€‚æ€ä¹ˆè¿åŠ¨ï¼Œå¦‚æœä½ èƒ½åšæŒæœ‰æ°§è¿åŠ¨çš„è¯ï¼ŒæŒç»­æœ‰æ°§ä¹Ÿå¯ä»¥ï¼Œä½†å¦‚æœæ²¡æœ‰é‚£ä¹ˆå¤šæ—¶é—´ï¼Œå¤šåšåšæ— æ°§æå‡åŸºç¡€ä»£è°¢ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å¸¸è§çš„çƒç±»è¿åŠ¨åŸºæœ¬ä¸Šéƒ½æ˜¯æš´æ±—ï¼Œæ‰€ä»¥æ¯å‘¨æ¥ä¸€ä¸¤æ¬¡æ˜¯å¯ä»¥çš„ã€‚æ¸¸æ³³ä¹Ÿå¯ä»¥ï¼Œä½†æ³¨æ„ä¸è¦æ¸¸å¾—å¤ªå¤šï¼Œæˆ–è€…åƒçš„å¤ªå¤šï¼Œå¦åˆ™å°±è¶Šæ¸¸è¶Šèƒ–ï¼Œå˜æˆå†¬æ³³å¤§çˆ·ã€‚</p>
<p>æœ€åè¯´ä¼‘æ¯ã€‚ä¸ºä»€ä¹ˆè¯´æ—©ç¡æ—©èµ·ï¼Œå…¶å®æ˜¯å› ä¸ºäººæœ‰ç”Ÿç‰©é’Ÿï¼Œä»€ä¹ˆæ—¶é—´è¯¥å¹²ä»€ä¹ˆï¼Œéƒ½æ˜¯æœ‰è§„å¾‹çš„ã€‚æ¯”å¦‚ç¡è§‰ï¼Œå°±å¯ä»¥æ¸…é™¤ä½ èº«ä½“å¤§è„‘ä¸­çš„å¾ˆå¤šåƒåœ¾ï¼Œå¯ä»¥ç†è§£æˆGCï¼Œä½†å¦‚æœä½ ç†¬å¤œï¼Œé”™è¿‡äº†è¿™ä¸ªGCçš„æ—¶æœºï¼Œåƒåœ¾æ²¡æœ‰åŠæ—¶æ¸…ç†ï¼Œé‚£ä¹ˆä½ ç¬¬äºŒå¤©ä¸ä»…å‡ä¸äº†é‡ï¼Œè€Œä¸”ä»£è°¢æ•ˆç‡ä¹Ÿä¼šå˜æ…¢ï¼Œå¯¼è‡´å†ä¹‹åçš„å‡è‚¥æ•ˆæœä¹Ÿå˜å·®ã€‚å…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Œå¦‚æœä½ æ¯å¤©æ—¶åˆ»ç›‘è§†è‡ªå·±çš„ä½“é‡ï¼Œå°è¯•å»å¶å°”ç†¬å‡ å¤©å¤œï¼Œä½ å°±ä¼šæ˜ç™½ã€‚ç®€è€Œè¨€ä¹‹ï¼Œä¼‘æ¯ä¸æ˜¯å•çº¯çš„ç¡è§‰ï¼Œæˆ–è€…é—­ç›®å…»ç¥ï¼Œé‡è¦çš„è¿˜æ˜¯å»æ‰¾åˆ°ä¸€ä¸ªå‡è‚¥çš„è§„å¾‹ï¼Œåœ¨è¿™ä¸ªè§„å¾‹é‡Œå»ç©¿æ’ä¼‘æ¯è¿™ä¸€ç¯èŠ‚ï¼Œä¿è¯ä½ çš„èº«ä½“ä»£è°¢å’Œå¥åº·ï¼Œè¿™æ ·æ‰èƒ½æŠŠå‡è‚¥å’Œä½“é‡ä¿æŒè¿™ä»¶äº‹æƒ…ï¼Œä¸€ç›´å¯ä»¥åšæŒä¸‹å»ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>ç¨³å®šæ€§</tag>
        <tag>é—®é¢˜æ’æŸ¥</tag>
        <tag>å‡è‚¥</tag>
        <tag>å¥åº·æ£€æŸ¥</tag>
        <tag>gc</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘å¦‚ä½•ç”¨pyside6å¼€å‘å¹¶éƒ¨ç½²ç®€å•çš„postmanå·¥å…·</title>
    <url>/2024/12/21/pythonnotes/pyside6_simple_app/</url>
    <content><![CDATA[<p>æœ€è¿‘ä¸€æ®µæ—¶é—´é—²æ¥æ— äº‹ï¼Œç®€å•ç ”ç©¶äº†ä¸€ä¸‹pyside6ï¼Œä¹Ÿå°±æ˜¯PyQt5çš„å‡çº§ç‰ˆã€‚åšè¿™ä¸ªçš„ç›®çš„ï¼Œä¹Ÿæ˜¯å›é¡¾ä¸‹æ¡Œé¢å¼€å‘çš„åŸºç¡€ï¼Œå…´è®¸æœªæ¥å¯èƒ½ç”¨å¾—ä¸Šã€‚è™½ç„¶åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œå¯èƒ½ç”¨åˆ°æ¡Œé¢å¼€å‘çš„åœºæ™¯æ¯”è¾ƒå°‘ï¼Œæ¡Œé¢å·¥å…·çš„æˆæœä¹Ÿæ¯”è¾ƒéš¾åŒ…è£…ï¼Œä½†æœ‰ä¸€ä¸ªè¿™æ ·çš„å·¥å…·ï¼Œç¡®å®å¯ä»¥è§£å†³è®¸å¤šå·¥ä½œæ•ˆç‡æ–¹é¢çš„é—®é¢˜ã€‚</p>
<p>åœ¨ä¹‹å‰ç¬”è€…ä¹Ÿå†™è¿‡å‡ ç¯‡pyside6æ–‡ç« ï¼Œä½†ä¸æ˜¯ç‰¹åˆ«ç³»ç»Ÿï¼Œæ¯”å¦‚è¯´ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjQvMDgvMTEvcHl0aG9ubm90ZXMvcHlzaWRlNl9pbnRyby8=" title="https://utmhikari.top/2024/08/11/pythonnotes/pyside6_intro/">pyside6å®‰è£…<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjQvMTAvMTMvcHl0aG9ubm90ZXMvcHlzaWRlNl9jbG9ja3Mv" title="https://utmhikari.top/2024/10/13/pythonnotes/pyside6_clocks/">pyside6ç»˜åˆ¶æ—¶é’Ÿ<i class="fa fa-external-link"></i></span></li>
</ul>
<p>å› æ­¤ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±ç³»ç»Ÿåˆ†äº«ä¸€ä¸‹ï¼Œæ€ä¹ˆæ ·ç”¨pyside6å†™ä¸€ä¸ªpostmanæ¥å£è°ƒç”¨çš„å°åŠŸèƒ½ï¼Œå¼€å‘å¹¶éƒ¨ç½²å‡ºæ¥ã€‚ä½œä¸ºä¸€ä¸ªè‡ªå·±å†™çš„æ•™å­¦æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« ä¼šé‡ç‚¹æä¸€äº›è‡ªå·±è§‰å¾—å®æ“è¿‡ç¨‹ä¸­çš„è¦ç‚¹ï¼Œå°‘ä¸€äº›ChatGPTå°±èƒ½å›ç­”çš„ä¸œè¥¿ã€‚æœ‰äº†è¿™äº›åŸºç¡€ä¹‹åï¼Œåšå…¶ä»–çš„å·¥å…·éœ€æ±‚ï¼Œä¹Ÿä¼šå˜å¾—æ›´åŠ ç®€å•ä¸€ç‚¹ã€‚</p>
<h2 id="é¡¹ç›®åˆå§‹åŒ–"><a href="#é¡¹ç›®åˆå§‹åŒ–" class="headerlink" title="é¡¹ç›®åˆå§‹åŒ–"></a>é¡¹ç›®åˆå§‹åŒ–</h2><p>å®‰è£…æ–¹é¢ä¸å†èµ˜è¿°ï¼Œè¯¦æƒ…å¯ä»¥çœ‹å®˜ç½‘çš„<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi9nZXR0aW5nc3RhcnRlZC5odG1s" title="https://doc.qt.io/qtforpython-6/gettingstarted.html">Getting Started<i class="fa fa-external-link"></i></span>ä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi90b29scy9pbmRleC5odG1s" title="https://doc.qt.io/qtforpython-6/tools/index.html">Tools<i class="fa fa-external-link"></i></span>çš„éƒ¨åˆ†ï¼Œç„¶åå…ˆå‰çš„æ–‡ç« ä¹ŸåŸºæœ¬ä¸ŠæŠŠç›®å½•ç»„ç»‡å’Œæœ€å°demoç»™è®²æ¸…æ¥šäº†ã€‚</p>
<p>æ ¸å¿ƒè¦è§£å†³çš„é—®é¢˜å°±æ˜¯é€šè¿‡ç›®å½•ç»„ç»‡ï¼ŒæŠŠå·¥ä½œæµçš„æ¯ä¸€ä¸ªæ¨¡å—ç»™æ‹†å‡ºæ¥ï¼Œäº’ä¸å½±å“ã€‚æ¯”å¦‚è¿™æ ·ï¼š</p>
<a id="more"></a>
<ul>
<li>pyside6-designerï¼š.uiæ–‡ä»¶</li>
<li>uiå®šä¹‰pyæ–‡ä»¶</li>
<li>ç»§æ‰¿uiï¼Œå…·ä½“viewçš„pyæ–‡ä»¶</li>
<li>viewmodelå±‚</li>
<li>serviceã€configä¹‹ç±»ï¼Œå’Œç•Œé¢æ— å…³çš„åº•å±‚é€»è¾‘</li>
<li>utilå·¥å…·ç±»</li>
</ul>
<h2 id="ç•Œé¢è®¾è®¡"><a href="#ç•Œé¢è®¾è®¡" class="headerlink" title="ç•Œé¢è®¾è®¡"></a>ç•Œé¢è®¾è®¡</h2><p>ç•Œé¢è®¾è®¡ä¸Šï¼Œç”¨ä¸€ä¸ªTabWidgetå°±å¯ä»¥ç®€å•åšä¸ªé—¨æˆ·å…¥å£ï¼ŒåŒºåˆ†å¤šä¸ªå­åŠŸèƒ½çš„ç•Œé¢ï¼Œæ¯ä¸ªå­åŠŸèƒ½ä¹Ÿå¯ä»¥å•ç‹¬åœ¨ä¸€ä¸ªuiç•Œé¢å»è®¾è®¡ã€‚</p>
<p>æ¯ä¸€ä¸ªWidgeté‡Œé¢éœ€è¦å®šä¹‰ç»„ä»¶çš„æ’ç‰ˆï¼ˆlayoutï¼‰ï¼Œåœ¨designeré‡Œé¢ï¼Œä¸€èˆ¬æ˜¯WidgetåŒ…å«äº†ä¸€ä¸ªç»„ä»¶æ‰èƒ½å¤Ÿç¼–è¾‘layoutã€‚layoutæœ‰å¾ˆå¤šç§ï¼Œå‚ç›´ï¼ˆverticalï¼‰çš„è¯ç±»ä¼¼äºwebå‰ç«¯é‡Œé¢ä¸€ä¸ªä¸ªRowçš„æ’åˆ—ï¼Œæ°´å¹³ï¼ˆhorizontalï¼‰çš„è¯åˆ™ç±»ä¼¼äºä¸€ä¸ªä¸ªColçš„æ’åˆ—ï¼Œæ …æ ¼ï¼ˆGridï¼‰å¸ƒå±€çš„è¯æ¯ä¸ªç»„ä»¶çš„å ç”¨é¢ç§¯å¯èƒ½å’Œæ—è¾¹ç»„ä»¶ç›¸å…³è”ï¼Œè¿˜æœ‰ä¸€ç§è¡¨å•ï¼ˆFormï¼‰å¸ƒå±€åˆ™ä¸“é—¨ç”¨äºå¡«å†™è¡¨å•é…ç½®ç±»ï¼Œæ˜¯label+inputçš„é˜»å¡ã€‚</p>
<p>åœ¨layouté™åˆ¶ä¸‹ï¼Œæ¯ä¸ªç»„ä»¶å¯èƒ½å æ®ä¸€å—åŒºåŸŸï¼Œä½†ç»„ä»¶è‡ªå·±ä¹Ÿæœ‰ä¸€äº›å¡«å……ç­–ç•¥ã€‚åƒPushButtonï¼Œä¸€èˆ¬æ°´å¹³æˆ–å‚ç›´ç­–ç•¥éœ€è¦è°ƒæ•´æˆfixedï¼Œä¿è¯ä¸å¡«å……åˆ°æ•´ä¸ªåŒºåŸŸï¼Œè¦æŒ‰ç…§è‡ªå·±æœ¬èº«çš„å¤§å°æ¥å¡«ï¼Œè€Œæ¯”å¦‚Spacerï¼Œéœ€è¦åšå ä½æŠŠç»„ä»¶åˆ†å‰²æˆå·¦å³ä¸¤å—çš„ï¼Œé»˜è®¤ä¼šè®¾ç½®æˆExpandingæ¥å ä½ã€‚</p>
<p>layoutçš„ä½œç”¨ï¼Œæ¯”æ–¹è¯´ï¼Œåšä¸€ä¸ªjsonæ ¼å¼è½¬æ¢å·¥å…·ï¼Œå¯ä»¥å…ˆç”¨ä¸€ä¸ªHorizontalLayoutè®¾ç½®ä¸¤è¡Œï¼Œç¬¬ä¸€è¡Œå·¥å…·æ ï¼Œç¬¬äºŒè¡Œæ˜¯TextEditè¾“å…¥è¾“å‡ºç•Œé¢ã€‚å·¥å…·æ è®¾ç½®æˆVerticalLayoutï¼Œè£…å‡ ä¸ªButtonå¤–åŠ Spacerå¡«å……ç©ºä½ï¼Œè¾“å…¥è¾“å‡ºå¯ä»¥ç›´æ¥å ç¬¬äºŒè¡Œçš„å·¦å³ä¸¤è¾¹ï¼Œä¹Ÿæ˜¯ææˆVerticalLayoutã€‚å³è¾¹çš„TextEditå¼„æˆåªè¯»ï¼Œå·¦è¾¹çš„TextEditç”¨äºè¾“å…¥yamlã€jsonç­‰å­—ç¬¦ä¸²ï¼Œè¿™æ ·å†ç»“åˆè‡ªå·±å®ç°çš„modelè·Ÿserviceé€»è¾‘ï¼Œæ•´ä¸ªæ¨¡å—å°±å·®ä¸å¤šåšèµ·æ¥äº†ã€‚</p>
<h2 id="postmané€»è¾‘ç¼–å†™"><a href="#postmané€»è¾‘ç¼–å†™" class="headerlink" title="postmané€»è¾‘ç¼–å†™"></a>postmané€»è¾‘ç¼–å†™</h2><p>å·¥å…·é€»è¾‘æ–¹é¢ï¼Œæœ¬æ–‡å°±ç»™ä¸€ä¸ªç®€å•çš„postmanå·¥å…·å®ç°ï¼Œæ»¡è¶³è°ƒhttpæ¥å£æ‹¿è¿”å›ä¿¡æ¯çš„ä¸€ä¸ªéœ€æ±‚ã€‚æ²¡æœ‰å…¨éƒ¨æºç ï¼Œæ²¡æœ‰ä¸€å¼ å›¾ç‰‡ï¼Œåªè¯´è¦ç‚¹ã€‚</p>
<p>é¦–å…ˆï¼Œç•Œé¢è®¾è®¡æ–¹é¢ï¼Œç›´æ¥æŠ„postmançš„ä¸€äº›åŸºæœ¬å…ƒç´ å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚è¯´ï¼š</p>
<ul>
<li>Requestï¼šMethodã€URLã€SubmitButtonã€Headersã€Bodyã€Settings</li>
<li>Responseï¼šHeadersã€Bodyã€StatusCodeã€ElapsedTime</li>
</ul>
<p>æ¯ä¸ªç»„ä»¶å¯èƒ½è¿˜æœ‰æ¯”è¾ƒç»†å¾®çš„éœ€æ±‚ï¼Œæ¯”å¦‚Headerså¯ä»¥åšæˆQTableWidgetçš„å½¢å¼ï¼Œæ”¯æŒå¢åˆ æ”¹åŠŸèƒ½ï¼Œç”¨setRowCountã€setItemã€removeRowä¹‹ç±»çš„æ¥å£å°±å¯ä»¥æ»¡è¶³è¿™äº›æ“ä½œã€‚Settingså¯ä»¥ç®€å•åšæˆFormLayoutï¼Œè®¾ç½®è¶…æ—¶æ—¶é—´å°±å¯ä»¥ã€‚ElapsedTimeåˆ™åœ¨uiè®¾è®¡ä¸Šéœ€è¦ç•™ç©ºå†…å®¹ï¼Œè¯·æ±‚çš„æ—¶å€™åŠ¨æ€æ¸²æŸ“å½“å‰è¯·æ±‚æ¶ˆè€—äº†å¤šå°‘ç§’é’Ÿã€‚</p>
<p>uiè®¾è®¡å·®ä¸å¤šå¥½äº†ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å†™å•ç‹¬çš„ä¸€ä¸ªhttpè¯·æ±‚æ¨¡å—ï¼Œè®©httpè¯·æ±‚çš„æ‰§è¡Œå’Œå®¡è®¡å¯ä»¥ç‹¬ç«‹å‡ºæ¥è¿è¡Œã€‚è¿™æ˜¯å› ä¸ºï¼Œæ¡Œé¢å·¥å…·uiæ¸²æŸ“æ˜¯å¤§å¤´ï¼Œä¸æ˜¯è¯´æ‰§è¡Œäº†ä¸€ä¸ªhttpè¯·æ±‚uiæ¸²æŸ“å°±ä¼šé˜»å¡ï¼Œè¿™æ ·ç•Œé¢å°±ä¼šå¡ä½äº†ã€‚æ€ä¹ˆæ ·ä¸è®©ç•Œé¢å¡ä½è¿™æ˜¯å¦ä¸€ä¸ªè¯é¢˜ï¼Œå…ˆè§£å†³httpè¯·æ±‚ï¼Œè®©å…¶å¯ä»¥å•ç‹¬æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åŸºäºrequestsåº“æ¥å®ç°httpè°ƒç”¨é€»è¾‘ï¼Œéœ€è¦å•ç‹¬æŠŠRequestå’ŒResponseç±»æŠ½è±¡å‡ºæ¥ã€‚ç›´æ¥ä¸Šä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Response</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">                 status_code: int = <span class="number">200</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 headers: Optional[Dict[str, str]] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 body: str = None)</span>:</span></span><br><span class="line">        <span class="comment"># åªéœ€è¦çŠ¶æ€ç ã€headersã€body</span></span><br><span class="line">        self.status_code = status_code</span><br><span class="line">        self.headers = headers <span class="keyword">if</span> isinstance(headers, dict) <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">        self.body = body</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_response</span><span class="params">(cls, resp: requests.Response)</span>:</span>  <span class="comment"># ä»requestsçš„è¿”å›ä¸­æå–å†…å®¹</span></span><br><span class="line">        status_code = resp.status_code</span><br><span class="line">        headers = dict(resp.headers)</span><br><span class="line">        body = resp.text</span><br><span class="line">        <span class="keyword">return</span> cls(status_code, headers, body)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestMethod</span>:</span></span><br><span class="line">    GET = <span class="string">'GET'</span></span><br><span class="line">    POST = <span class="string">'POST'</span></span><br><span class="line">    PUT = <span class="string">'PUT'</span></span><br><span class="line">    DELETE = <span class="string">'DELETE'</span></span><br><span class="line">    PATCH = <span class="string">'PATCH'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_default_request_headers</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">                 url: str = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 method: str = RequestMethod.GET,</span></span></span><br><span class="line"><span class="function"><span class="params">                 headers: Optional[Dict[str, str]] = None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 body: str = <span class="string">''</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 settings: Optional[RequestSettings] = None)</span>:</span></span><br><span class="line">        <span class="comment"># å¯¹åº”ç•Œé¢è®¾ç½®é‡Œå¤´çš„ä¸œè¥¿</span></span><br><span class="line">        self.url = url</span><br><span class="line">        self.method = method</span><br><span class="line">        self.headers = headers <span class="keyword">if</span> isinstance(headers, dict) <span class="keyword">else</span> _default_request_headers()</span><br><span class="line">        self.body = body</span><br><span class="line">        self.settings = settings <span class="keyword">if</span> isinstance(settings, RequestSettings) <span class="keyword">else</span> RequestSettings()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">validate</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.url:</span><br><span class="line">            <span class="keyword">return</span> ValueError(<span class="string">'url is required'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.method:</span><br><span class="line">            <span class="keyword">return</span> ValueError(<span class="string">'method is required'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">args</span><span class="params">(self)</span>:</span>  <span class="comment"># ç»„æˆrequestsçš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="string">'method'</span>: self.method,</span><br><span class="line">            <span class="string">'url'</span>: self.url,</span><br><span class="line">            <span class="string">'headers'</span>: self.headers,</span><br><span class="line">            <span class="string">'data'</span>: self.body.strip(),</span><br><span class="line">            <span class="string">'timeout'</span>: (</span><br><span class="line">                self.settings.connect_timeout_seconds(),</span><br><span class="line">                self.settings.read_timeout_seconds()</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">invoke</span><span class="params">(self)</span> -&gt; (Response, Exception):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            resp = requests.request(**self.args())</span><br><span class="line">            <span class="keyword">return</span> Response.from_response(resp), <span class="literal">None</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span>, e</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†è¿™äº›ä»£ç ä¹‹åï¼Œå•ä¸ªhttpè¯·æ±‚å°±å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œå¹¶ä¸”è¯·æ±‚ã€è¿”å›çš„æ•°æ®ä¸Šä¸‹æ–‡ä¹Ÿå¯ä»¥å•ç‹¬å®¡è®¡ã€‚</p>
<p>æ¥ä¸‹æ¥è¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆæŠŠviewé€»è¾‘å’Œè¿™ä¸ªrequestä¸²è”èµ·æ¥ã€‚è¿™é‡Œéœ€è¦ç”¨åˆ°QThreadåŠ ä¸Šsignalçš„æœºåˆ¶ï¼Œé€šè¿‡ä¸€ä¸ªRequestWorkerä¸²è”ï¼Œä¿è¯httpè¯·æ±‚å¹²æ‰°ä¸åˆ°uiè¿è½¬ã€‚</p>
<p>Viewå±‚é¢ï¼Œé€»è¾‘å¯ä»¥ç®€å†™æˆè¿™æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToolWidget</span><span class="params">(QWidget)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(ToolWidget, self).__init__()</span><br><span class="line">        self.ui = Ui_ToolWidget()</span><br><span class="line">        self.ui.setupUi(self)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># request worker</span></span><br><span class="line">        self._request_worker: Optional[RequestWorkerThread] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># init actions and widget</span></span><br><span class="line">        self._init_actions()</span><br><span class="line">        self._init_widget()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_actions</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># do request</span></span><br><span class="line">        self.ui.requestInvokeButton.clicked.connect(self.invoke_request)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># headers CRUD</span></span><br><span class="line">        self.ui.requestHeadersResetButton.clicked.connect(self.reset_request_headers)</span><br><span class="line">        self.ui.requestHeadersAddButton.clicked.connect(self.add_request_header)</span><br><span class="line">        self.ui.requestHeadersRemoveButton.clicked.connect(self.remove_request_header)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_widget</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># fill in request</span></span><br><span class="line">        default_request = Request()</span><br><span class="line">        self.ui.requestMethodComboBox.setCurrentText(default_request.method)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># request headers</span></span><br><span class="line">        self.reset_request_headers()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># request settings</span></span><br><span class="line">        default_request_settings = default_request.settings</span><br><span class="line">        self.ui.requestSettingsConnectTimeoutLineEdit.setText(str(default_request_settings.connect_timeout))</span><br><span class="line">        self.ui.requestSettingsReadTimeoutLineEdit.setText(str(default_request_settings.read_timeout))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_reset_request_state</span><span class="params">(self)</span>:</span>  <span class="comment"># é‡ç½®requestç•Œé¢å’Œworker</span></span><br><span class="line">        <span class="string">"""clear all previous request states"""</span></span><br><span class="line">        <span class="keyword">if</span> self._request_worker <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># quit+wait+deleteLaterä¸‰è¿</span></span><br><span class="line">            self._request_worker.quit()</span><br><span class="line">            self._request_worker.wait()</span><br><span class="line">            self._request_worker.deleteLater()</span><br><span class="line">            self._request_worker = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        self.ui.requestRespBodyTextEdit.clear()</span><br><span class="line">        self.ui.requestRespHeadersTableWidget.setRowCount(<span class="number">0</span>)</span><br><span class="line">        self.ui.requestRespDetailTextEdit.clear()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">invoke_request</span><span class="params">(self)</span>:</span></span><br><span class="line">        LOGGER.debug(<span class="string">'invoke request -&gt; triggered'</span>)</span><br><span class="line">        <span class="keyword">if</span> self._request_worker <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> self._request_worker.isRunning():</span><br><span class="line">            LOGGER.warning(<span class="string">f'cannot invoke request, request worker is active'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self._reset_request_state()</span><br><span class="line">        req = self._gen_request()</span><br><span class="line">        LOGGER.debug(<span class="string">f'invoke request -&gt; req: <span class="subst">&#123;req.args()&#125;</span>'</span>)</span><br><span class="line">        <span class="comment"># requestä¸åŒé˜¶æ®µçš„äº‹ä»¶ï¼ˆsignalï¼‰ï¼Œä¸²è”åˆ°uiå±‚ä¸åŒçš„å›è°ƒ</span></span><br><span class="line">        self._request_worker = RequestWorkerThread(req, parent=self)</span><br><span class="line">        self._request_worker.signals.start.connect(self.on_request_start)</span><br><span class="line">        self._request_worker.signals.progress.connect(self.on_request_progress)</span><br><span class="line">        self._request_worker.signals.finish.connect(self.on_request_finish)</span><br><span class="line">        self._request_worker.start(priority=QThread.Priority.LowPriority)</span><br><span class="line">        LOGGER.debug(<span class="string">f'invoke request -&gt; thread started'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_request_start</span><span class="params">(self, _)</span>:</span>  <span class="comment"># è¯·æ±‚å¼€å§‹ï¼Œæ­¤æ—¶ä¸èƒ½å†å‘èµ·è¯·æ±‚</span></span><br><span class="line">        LOGGER.debug(<span class="string">f'request start'</span>)</span><br><span class="line">        self.ui.requestInvokeButton.setEnabled(<span class="literal">False</span>)</span><br><span class="line">        self._set_request_status(<span class="string">'æ‰§è¡Œä¸­'</span>)</span><br><span class="line">        self._set_request_duration(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_request_progress</span><span class="params">(self, evt: RequestProgressEvent)</span>:</span>  <span class="comment"># æ˜¾ç¤ºå½“å‰è€—æ—¶ï¼Œç”±workeræä¾›</span></span><br><span class="line">        LOGGER.debug(<span class="string">f'request progress -&gt; seconds: <span class="subst">&#123;evt.seconds&#125;</span>'</span>)</span><br><span class="line">        self._set_request_duration(evt.seconds)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_request_finish</span><span class="params">(self, evt: RequestFinishEvent)</span>:</span>  <span class="comment"># å±•ç¤ºresponseæ•°æ®</span></span><br><span class="line">        LOGGER.debug(<span class="string">f'request finish -&gt; resp: <span class="subst">&#123;str(evt.resp)&#125;</span>, err: <span class="subst">&#123;evt.err&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set resp status</span></span><br><span class="line">        <span class="keyword">if</span> evt.resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">if</span> evt.err <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                self._set_request_status(<span class="string">'æ— å“åº”'</span>)</span><br><span class="line">            <span class="keyword">else</span>:  <span class="comment"># å±•ç¤ºworkeræä¾›çš„é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">                <span class="keyword">if</span> isinstance(evt.err, (Timeout, ConnectTimeout, ReadTimeout)):</span><br><span class="line">                    self._set_request_status(<span class="string">'è¯·æ±‚è¶…æ—¶'</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self._set_request_status(<span class="string">'è¯·æ±‚å¼‚å¸¸'</span>)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å±•ç¤ºçŠ¶æ€ç å¯¹åº”æ–‡æ¡ˆ</span></span><br><span class="line">            status_code = evt.resp.status_code</span><br><span class="line">            <span class="keyword">if</span> <span class="number">200</span> &lt;= status_code &lt; <span class="number">300</span>:</span><br><span class="line">                self._set_request_status(<span class="string">f'<span class="subst">&#123;status_code&#125;</span> æˆåŠŸ'</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="number">300</span> &lt;= status_code &lt; <span class="number">400</span>:</span><br><span class="line">                self._set_request_status(<span class="string">f'<span class="subst">&#123;status_code&#125;</span> é‡å®šå‘'</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="number">400</span> &lt;= status_code &lt; <span class="number">500</span>:</span><br><span class="line">                self._set_request_status(<span class="string">f'<span class="subst">&#123;status_code&#125;</span> å®¢æˆ·ç«¯é”™è¯¯'</span>)</span><br><span class="line">            <span class="keyword">elif</span> <span class="number">500</span> &lt;= status_code &lt; <span class="number">600</span>:</span><br><span class="line">                self._set_request_status(<span class="string">f'<span class="subst">&#123;status_code&#125;</span> æœåŠ¡å™¨é”™è¯¯'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._set_request_status(<span class="string">f'<span class="subst">&#123;status_code&#125;</span> æœªçŸ¥'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set resp duration</span></span><br><span class="line">        self._set_request_duration(evt.seconds)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set resp body</span></span><br><span class="line">        <span class="keyword">if</span> evt.resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.ui.requestRespBodyTextEdit.clear()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            body = json_pretty(evt.resp.body)</span><br><span class="line">            self.ui.requestRespBodyTextEdit.setText(body)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># set resp headers</span></span><br><span class="line">        <span class="keyword">if</span> evt.resp <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.ui.requestRespHeadersTableWidget.setRowCount(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            headers = evt.resp.headers</span><br><span class="line">            headers_size = len(headers.keys())</span><br><span class="line">            self.ui.requestRespHeadersTableWidget.setRowCount(headers_size)</span><br><span class="line">            r = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> sorted(headers.keys()):</span><br><span class="line">                v = headers[k]</span><br><span class="line">                self.ui.requestRespHeadersTableWidget.setItem(r, <span class="number">0</span>, QTableWidgetItem(k))</span><br><span class="line">                self.ui.requestRespHeadersTableWidget.setItem(r, <span class="number">1</span>, QTableWidgetItem(v))</span><br><span class="line">                r += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># set resp detailï¼Œå®¡è®¡ä¿¡æ¯</span></span><br><span class="line">        detail = self._gen_resp_detail(evt)</span><br><span class="line">        self.ui.requestRespDetailTextEdit.setText(detail)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># clear all statesï¼Œè¯·æ±‚å®Œæ¯•åï¼Œæ¸…é™¤å…³è”çš„request worker</span></span><br><span class="line">        <span class="keyword">if</span> self._request_worker:</span><br><span class="line">            self._request_worker.quit()</span><br><span class="line">            self._request_worker.wait()</span><br><span class="line">            self._request_worker.deleteLater()</span><br><span class="line">            self._request_worker = <span class="literal">None</span></span><br><span class="line">        self.ui.requestInvokeButton.setEnabled(<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>è€ŒRequestWorkerå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çœç•¥imports</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”¨å¤šè¿›ç¨‹ï¼ŒæŠŠrequestæ”¾åˆ°å…¶ä»–è¿›ç¨‹é‡Œï¼Œé˜²æ­¢viewå±‚è¿è¡Œpythonä»£ç é˜»å¡</span></span><br><span class="line">_REQUEST_POOL = ProcessPoolExecutor(max_workers=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_executor</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> _REQUEST_POOL</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestStartEvent</span>:</span>  <span class="comment"># è¯·æ±‚å¼€å§‹çš„äº‹ä»¶</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestProgressEvent</span>:</span>  <span class="comment"># è¯·æ±‚ä¸­</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, seconds: float)</span>:</span></span><br><span class="line">        self.seconds = seconds</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestFinishEvent</span>:</span>  <span class="comment"># è¯·æ±‚å®Œæˆï¼Œå¦‚æœå‘èµ·å¤±è´¥æˆ–è€…æœ‰exceptionä¹Ÿç®—å®Œæˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,</span></span></span><br><span class="line"><span class="function"><span class="params">                 req: Optional[Request],</span></span></span><br><span class="line"><span class="function"><span class="params">                 resp: Optional[Response],</span></span></span><br><span class="line"><span class="function"><span class="params">                 err: Optional[Exception],</span></span></span><br><span class="line"><span class="function"><span class="params">                 seconds: float)</span>:</span></span><br><span class="line">        self.req = req</span><br><span class="line">        self.resp = resp</span><br><span class="line">        self.err = err</span><br><span class="line">        self.seconds = seconds</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestSignals</span><span class="params">(QObject)</span>:</span>  <span class="comment"># å®šä¹‰requestçš„ä¿¡å·ï¼ˆäº‹ä»¶ï¼‰</span></span><br><span class="line">    start = Signal(RequestStartEvent)</span><br><span class="line">    progress = Signal(RequestProgressEvent)</span><br><span class="line">    finish = Signal(RequestFinishEvent)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestWorkerThread</span><span class="params">(QThread)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, req: Request, parent=None)</span>:</span></span><br><span class="line">        QThread.__init__(self, parent)</span><br><span class="line">        self.req = req</span><br><span class="line">        self.signals = RequestSignals()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        LOGGER.info(<span class="string">f'do request at thread: <span class="subst">&#123;str(QThread.currentThread())&#125;</span>'</span>)</span><br><span class="line">        req = self.req</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(req, Request):  <span class="comment"># ç±»å‹ä¸ç¬¦ï¼Œç›´æ¥finish</span></span><br><span class="line">            evt = RequestFinishEvent(</span><br><span class="line">                req=<span class="literal">None</span>,</span><br><span class="line">                resp=<span class="literal">None</span>,</span><br><span class="line">                err=ValueError(<span class="string">'req must be Request instance'</span>),</span><br><span class="line">                seconds=<span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            self.signals.finish.emit(evt)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        validate_err = req.validate()</span><br><span class="line">        <span class="keyword">if</span> validate_err:  <span class="comment"># æ ¡éªŒå¤±è´¥ï¼Œç›´æ¥finish</span></span><br><span class="line">            evt = RequestFinishEvent(</span><br><span class="line">                req=req,</span><br><span class="line">                resp=<span class="literal">None</span>,</span><br><span class="line">                err=validate_err,</span><br><span class="line">                seconds=<span class="number">0</span></span><br><span class="line">            )</span><br><span class="line">            self.signals.finish.emit(evt)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self.signals.start.emit(RequestStartEvent())  <span class="comment"># å¼€å§‹è¯·æ±‚ï¼Œå‘äº‹ä»¶</span></span><br><span class="line"></span><br><span class="line">        executor = _executor()</span><br><span class="line">        start_time = timeutil.now()</span><br><span class="line">        future = executor.submit(req.invoke)  <span class="comment"># submitç»™executoråè¿”å›futureï¼Œå¯ä»¥éšæ—¶è°ƒç”¨doneæ–¹æ³•ï¼Œçœ‹invokeæ˜¯å¦å®Œæˆäº†</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> future.done():  <span class="comment"># æ²¡å®Œæˆå°±æŠŠå½“å‰è€—æ—¶emitç»™åˆ°viewå±‚</span></span><br><span class="line">            cur_time = timeutil.now()</span><br><span class="line">            seconds = (cur_time - start_time).total_seconds()</span><br><span class="line">            evt = RequestProgressEvent(</span><br><span class="line">                seconds=seconds</span><br><span class="line">            )</span><br><span class="line">            self.signals.progress.emit(evt)</span><br><span class="line">            sleep_ms = random.randint(<span class="number">50</span>, <span class="number">150</span>)  <span class="comment"># sleepä¸€ä¸ªé—´éš”ï¼Œé˜²æ­¢å½“å‰pyè™šæ‹Ÿæœºé˜»å¡</span></span><br><span class="line">            QThread.msleep(sleep_ms)</span><br><span class="line">        resp, err = future.result()  <span class="comment"># doneäº†ä¹‹åå–resultï¼Œå³Responseå®ä¾‹</span></span><br><span class="line">        end_time = timeutil.now()</span><br><span class="line">        seconds = (end_time - start_time).total_seconds()</span><br><span class="line">        evt = RequestFinishEvent(</span><br><span class="line">            req=req,</span><br><span class="line">            resp=resp,</span><br><span class="line">            err=err,</span><br><span class="line">            seconds=seconds</span><br><span class="line">        )</span><br><span class="line">        self.signals.finish.emit(evt)  <span class="comment"># å®Œæˆè¯·æ±‚ï¼Œå‘äº‹ä»¶</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œé€šè¿‡åœ¨workeré‡ŒæŠŠrequestæ”¾åˆ°ProcessPoolExecutoré‡Œå¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå®æ—¶ç›‘æ§æ‰§è¡Œï¼Œå†ç»“åˆsignalæœºåˆ¶é˜²æ­¢viewå±‚é˜»å¡ï¼Œå°±å¯ä»¥æŠŠç®€å•çš„httpè¯·æ±‚èƒ½åŠ›ä¸²è”èµ·æ¥ã€‚è‡³äºæƒ³äº†è§£ProcessPoolExecutoræ€ä¹ˆè¿ä½œçš„ï¼Œå¯ä»¥å‚è€ƒç¬”è€…ä»¥å‰å†™çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDYvMDgvcHl0aG9ubm90ZXMvcHl0aG9uX3Byb2Nlc3Nwb29sZXhlY3V0b3Iv" title="https://utmhikari.top/2021/06/08/pythonnotes/python_processpoolexecutor/">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ã€‚</p>
<h2 id="é¡¹ç›®éƒ¨ç½²"><a href="#é¡¹ç›®éƒ¨ç½²" class="headerlink" title="é¡¹ç›®éƒ¨ç½²"></a>é¡¹ç›®éƒ¨ç½²</h2><p>éƒ¨ç½²æ–¹é¢å¯ä»¥å‚è€ƒå®˜ç½‘<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi9kZXBsb3ltZW50L2luZGV4Lmh0bWw=" title="https://doc.qt.io/qtforpython-6/deployment/index.html">Deployment<i class="fa fa-external-link"></i></span>æ–‡æ¡£ï¼Œé‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi9kZXBsb3ltZW50L2RlcGxveW1lbnQtcHlzaWRlNi1kZXBsb3kuaHRtbA==" title="https://doc.qt.io/qtforpython-6/deployment/deployment-pyside6-deploy.html">pyside6-deploy<i class="fa fa-external-link"></i></span>å·¥å…·æ¥åšäºŒè¿›åˆ¶çš„éƒ¨ç½²ã€‚éƒ¨ç½²æœ¬èº«å¯èƒ½éœ€è¦å®‰è£…å…¶ä»–çš„pythonåº“ï¼Œæ¯”å¦‚Nuitkaï¼Œè¿™äº›åœ¨è‡ªå·±çš„pythonç¯å¢ƒé‡Œå‡†å¤‡å°±å¥½ã€‚éƒ¨ç½²é»˜è®¤ä¼šç”Ÿæˆpysidedeploy.specæ–‡ä»¶ï¼Œæ˜¯éƒ¨ç½²çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚æœæœ‰éƒ¨ç½²ä¸æˆåŠŸçš„é—®é¢˜å¯ä»¥æ”¹é…ç½®æ–‡ä»¶è§£å†³ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>project_dirï¼šé¡¹ç›®è·¯å¾„ï¼Œç›¸å¯¹äºä½ è¿è¡Œéƒ¨ç½²çš„è·¯å¾„ï¼Œå¡«å†™ä¸€ä¸ªç‚¹å°±è¡Œ</li>
<li>input_fileï¼šç›¸å¯¹çš„å…¥å£æ–‡ä»¶è·¯å¾„ï¼Œæ¯”å¦‚main.py</li>
<li>exec_directoryï¼šç›¸å¯¹çš„è¾“å‡ºè·¯å¾„ï¼Œæ¯”å¦‚outputã€buildã€distä¹‹ç±»ï¼ŒæŒ‰è‡ªå·±æƒ…å†µæ¥</li>
<li>python_pathï¼švenvå¯ä»¥è®¾ç½®æˆç»å¯¹è·¯å¾„</li>
<li>packagesï¼šå¯ä»¥æŒ‡å®šæŸäº›åº“è¦å®‰è£…ï¼Œå¦‚æœå½“å‰pythonç‰ˆæœ¬æ²¡æœ‰å¯¹åº”åº“çš„è¯å¯ä»¥æ”¹ç‰ˆæœ¬å·è¯•è¯•</li>
<li>qml_filesï¼šç›¸å¯¹çš„qmlæ–‡ä»¶è·¯å¾„ã€‚æ²¡æœ‰qmlçš„è¯ï¼Œéœ€è¦éšä¾¿æŒ‡å®šæŸä¸ªæ–‡ä»¶ï¼Œä¸ç„¶ä¼šæŠŠæ•´ä¸ªé¡¹ç›®includeè¿›å»ï¼Œvenvå¼€å‘çš„è¯è¿‡ä¸äº†</li>
</ul>
<p>è®¾ç½®å¥½äº†è·‘é€šä¹‹åï¼Œé¢„æœŸå°±ä¼šåœ¨exec_directoryç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶äº†ã€‚</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>pyside6</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>requests</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘Enigmaå¯†ç æœºçš„åŸç†åŠpythonä»£ç å®ç°</title>
    <url>/2024/12/21/pythonnotes/enigma_implementation/</url>
    <content><![CDATA[<p>æœ€è¿‘ç¬”è€…æ¥è§¦åˆ°äº†Cypherè¿™æ¬¾æ¸¸æˆï¼Œç©æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡æ–‡å­—ã€å›¾ç‰‡ç­‰å„ç§è¡¨è¾¾æ‰‹æ®µç»„æˆçš„è°œé¢ï¼ŒçŒœä¸€æ®µè‹±æ–‡ï¼Œç®—æ˜¯åˆæ­¥æ¥è§¦äº†å¯†ç å­¦çš„ä¸€äº›çŸ¥è¯†ã€‚æ¸¸æˆä¸­æåˆ°äº†å¾ˆå¤šç±»å‹çš„å¯†ç ï¼Œå…¶ä¸­Enigmaå¯†ç æœºå°±æ˜¯å•ç‹¬ä¸€ç§ï¼Œåœ¨ç”µå½±ã€Šæ¨¡ä»¿æ¸¸æˆã€‹ä¸­ï¼Œå¤æ´›å…‹.ç¦å°”æ‘©æ–¯è´¹å°½å¿ƒåŠ›ç ´è§£çš„å¾·å†›å¯†ç ï¼Œä¹Ÿå°±å‡ºè‡ªæ­¤å¯†ç æœºä¹‹æ‰‹ã€‚åœ¨æ¸¸æˆé‡Œï¼Œæœ‰ä¸€é“é¢˜ç›®ä¾¿æ˜¯ï¼Œéœ€è¦æ ¹æ®Enigmaå¯†ç æœºçš„åˆå§‹è®¾ç½®ï¼Œç ´è¯‘ä¸€æ®µå¯†æ–‡ï¼Œå¾—åˆ°æ˜æ–‡ã€‚æ²¡åŠæ³•ï¼Œä¸ºäº†è§£å‡ºæ¥è¿™é“é¢˜ï¼Œåªèƒ½å‘æŒ¥ç¨‹åºå‘˜çš„èŒä¸šæœ¬æ€§ï¼Œå†™ä¸€æ®µç¨‹åºæ¥è·‘ä¸€ä¸‹äº†ã€‚</p>
<p>ä»Šå¤©ï¼Œç¬”è€…å°±åˆ†äº«ä¸€ä¸‹è‡ªå·±ç”¨pythonå®ç°çš„Enigmaå¯†ç æœºï¼Œè™½ç„¶ä»£ç éå¸¸ç²—ç³™ï¼Œæœ‰å¾ˆå¤šä¼˜åŒ–ç©ºé—´ï¼Œä½†æ•´ä½“é€»è¾‘æ¯”è¾ƒæ¸…æ™°ï¼Œå°¤å…¶æ˜¯è§£Cypheræ¸¸æˆé‡Œçš„é¢˜ç›®ï¼Œå·²ç»å¤Ÿç”¨äº†ã€‚</p>
<p>ç®€å•æ¥è®²ï¼Œä¸€ä¸ªEngimaå¯†ç æœºæ˜¯åˆ†å±‚çš„ï¼ŒåŒ…å«ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<a id="more"></a>
<p>ç¬¬ä¸€å±‚æ˜¯Keyboardé”®ç›˜ï¼Œæ˜¯è¾“å…¥è¾“å‡ºçš„éƒ¨åˆ†ï¼Œè¾“å…¥26ä¸ªå­—æ¯ï¼Œè¾“å‡ºçš„å­—æ¯å¯èƒ½æ˜¯26ä¸ªå­—æ¯ä¹‹ä¸€ã€‚ä»æ‰“å­—äººå‘˜çš„è§†è§’ï¼ŒæŒ‰ä¸‹é”®ç›˜ä¸ŠæŸä¸ªå­—æ¯ä¹‹åï¼Œç»è¿‡åŠ å¯†ï¼Œå¯¹åº”å¯†æ–‡çš„å­—æ¯å°±ä¼šäº®èµ·æ¥ã€‚</p>
<p>ç¬¬äºŒå±‚æ˜¯Plugboardæ¥çº¿æ¿ï¼Œæ¥çº¿æ¿æœ¬è´¨ä¸Šä¼šæŠŠä¸€äº›å­—æ¯çš„è¾“å…¥è¾“å‡ºåšäº¤æ¢ï¼Œæ¯”å¦‚Aå’ŒBä¸¤ä¸ªå­—æ¯æ¥èµ·æ¥äº†ï¼Œé‚£ä¹ˆè¾“å…¥Aè¾“å‡ºå°±æ˜¯Bï¼Œåä¹‹è¾“å…¥Bè¾“å‡ºå°±æ˜¯Aï¼Œæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ç½®æ¢å¯†ç ã€‚</p>
<p>ç¬¬ä¸‰å±‚å«åšScrambleræ‰°ç å™¨ï¼Œåœ¨Enigmaæ„æˆé‡Œä¹Ÿå«åšRotorè½¬å­ï¼Œæ˜¯æ•´ä¸ªEnigmaå¯†ç æœºæœ€æ ¸å¿ƒçš„åŠ å¯†éƒ¨åˆ†ã€‚è™½ç„¶æ‰°ç å™¨çš„è¾“å…¥æ˜¯26ä¸ªå­—æ¯ï¼Œè¾“å‡ºä¹Ÿæ˜¯26ä¸ªå­—æ¯çš„å¦ä¸€ç§æ’åˆ—ï¼Œä½†å…¶å¤æ‚åº¦åœ¨äºï¼Œæ¯æ‰“ä¸€ä¸ªå­—æ¯ï¼Œè½¬å­ä¼šè½¬ä¸€ä¸‹ã€‚æ¯”æ–¹è¯´è½¬å­æ˜¯ABCDå¯¹åº”DCBAï¼Œç°åœ¨ä½ è¾“ä¸€ä¸ªAï¼Œè½¬å­å‡ºæ¥ä¸€ä¸ªDï¼Œä½†ä¸‹ä¸€æ¬¡ä½ è¾“Aå°±ä¸æ˜¯Däº†ï¼Œè€Œæ˜¯Cï¼Œè¿™æ˜¯å› ä¸ºè½¬å­è½¬äº†ä¸€ä¸‹ï¼Œå˜æˆBCDAå¯¹åº”CBADï¼Œä½ è¾“Aå…¶å®ä¸€ç›´å¯¹åº”è½¬å­ç¬¬ä¸€ä¸ªä½ç½®ï¼Œä¸‹ä¸€æ¬¡å°±å˜æˆBçš„ä½ç½®äº†ï¼Œæ‰€ä»¥å°±ä¼šå‡ºæ¥Cã€‚æ‰€ä»¥è¯´ï¼Œæœ‰äº†è¿™ä¸ªScramblerï¼ŒåŠ å¯†ä¼šå˜å¾—æ›´åŠ å¤æ‚ï¼Œè€Œä¸”è½¬å­èµ·å§‹ä½ç½®ä¸åŒçš„è¯ï¼Œå‡ºæ¥çš„ç»“æœä¹Ÿä¼šä¸ä¸€æ ·ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè½¬å­è¿˜å¯ä»¥å åŠ ï¼Œæ¯”å¦‚å 3ä¸ªè½¬å­ï¼Œç¬¬1ä¸ªè½¬å­è½¬æ»¡ä¸€åœˆï¼Œç¬¬2ä¸ªè½¬å­è½¬1æ¬¡ï¼Œç¬¬2ä¸ªè½¬å­è½¬æ»¡1åœˆï¼Œç¬¬3ä¸ªè½¬å­è½¬1æ¬¡ã€‚è¿™æ ·å ä¸‹æ¥ï¼Œå¤æ‚åº¦å°±æ›´é«˜äº†ã€‚å¦‚æœä¸äº†è§£æ‰°ç å™¨çš„å­—æ¯æ˜ å°„ï¼Œä¸äº†è§£è½¬å­èµ·å§‹ä½ç½®ï¼ŒåŸºæœ¬ç ´è§£ä¸å‡ºæ¥ã€‚</p>
<p>æœ€åä¸€å±‚æ˜¯Reflectoråå°„å™¨ï¼Œæ˜¯Enigmaæ„æˆé‡Œæœ€é¬¼æ‰çš„è®¾è®¡ã€‚æœ‰äº†è¿™ä¸ªä¸œè¥¿ï¼ŒEnigmaå°±æˆäº†è‡ªå¯¹ç§°åŠ å¯†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ è¾“å…¥æ˜æ–‡ï¼Œå¯èƒ½å‡ºæ¥ä¸€ç»„å¯†æ–‡ï¼Œä½†ä½ å¤ä½åˆ°åˆå§‹è®¾ç½®ä¹‹åï¼Œè¾“å…¥å¯†æ–‡ï¼Œå°±ä¼šæŠŠæœ€å¼€å§‹çš„æ˜æ–‡è¾“å‡ºå‡ºæ¥ã€‚Reflectoræœ¬èº«ä¹Ÿæ˜¯å’ŒPlugboardä¸€æ ·çš„æ¥çº¿æ¿è®¾è®¡ï¼Œä½†åœ¨æ•´ä¸ªåŠ å¯†è¿‡ç¨‹ä¸­åªç»è¿‡ä¸€æ¬¡ï¼Œè€Œä¸åƒå…¶ä»–éƒ¨åˆ†ç»è¿‡ä¸¤æ¬¡ã€‚æ•´ä¸ªåŠ å¯†æ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>Keyboardè¾“å…¥1ä¸ªå­—æ¯</li>
<li>ç¬¬1ä¸ªè½¬å­è½¬ä¸€ä¸‹ï¼Œå¯èƒ½å¸¦åŠ¨åé¢çš„è½¬å­è½¬</li>
<li>ç»è¿‡Plugboardï¼Œçœ‹æ˜¯ä»å½“å‰ä½ç½®å‡ºå£è¾“å‡ºï¼Œè¿˜æ˜¯ä»æŸä¸ªæ¥çº¿ä½ç½®çš„å‡ºå£è¾“å‡º</li>
<li>é€å±‚ç»è¿‡Scramblerè½¬å­1ï½3ï¼Œä»å¯¹åº”ä½ç½®è¾“å…¥ï¼Œä»æ˜ å°„åˆ°çš„å­—æ¯çš„å½“å‰ä½ç½®è¾“å‡º</li>
<li>ç»è¿‡Reflectorï¼Œä»Scramblerè¾“å‡ºçš„ä½ç½®è¾“å…¥ï¼Œä»å¯¹åº”å­—æ¯çš„å½“å‰ä½ç½®è¾“å‡º</li>
<li>é€ä¸ªåå‘ç»è¿‡Scramblerè½¬å­3ï½1ï¼Œä»ä¸Šä¸€ä¸ªè¾“å‡ºçš„ä½ç½®è¾“å…¥ï¼Œä»æ˜ å°„åˆ°çš„å­—æ¯çš„å½“å‰ä½ç½®è¾“å‡º</li>
<li>åå‘ç»è¿‡Plugboardï¼Œå†çœ‹æ˜¯ä»å½“å‰ä½ç½®è¿”å›ç»™Keyboardï¼Œè¿˜æ˜¯æŸä¸ªæ¥çº¿çš„ä½ç½®è¿”å›</li>
<li>åå‘ç»è¿‡Keyboardï¼Œè¾“å‡ºå¯¹åº”ä½ç½®çš„å­—æ¯</li>
</ul>
<p>æ‰€ä»¥æ•´ä¸ªé€»è¾‘æ‹ä¸‹æ¥ï¼ŒEnigmaå¯†ç æœºé‡ç‚¹å¹¶éå­—æ¯ä¹‹é—´çš„æ˜ å°„ï¼Œè€Œæ˜¯ä¸åŒå±‚æ¬¡ä¹‹é—´æ¥çº¿æ‰£å­ç´¢å¼•ä½ç½®çš„æ˜ å°„ã€‚è€Œä¸”ï¼Œå½“ä½ è¾“å…¥æ—¶ï¼Œå…¶å®è¾“å…¥åˆ°è¾“å‡ºçš„å…¨åŠ å¯†è¿‡ç¨‹çš„è¿çº¿å·²ç»è¿å¥½äº†ï¼Œæ‰€ä»¥åè¿‡æ¥ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä½ è¾“å…¥å¯†æ–‡ï¼Œä¹Ÿä¼šè·Ÿç€è¿™æ¡è¿çº¿ï¼Œæœ€ç»ˆèµ°åˆ°æ˜æ–‡å¯¹åº”çš„å­—æ¯ã€‚</p>
<p>æ‹å®Œäº†é€»è¾‘ï¼Œå°±å¯ä»¥å†™ä»£ç äº†ï¼Œå¯ä»¥ç”¨ç®€å•çš„é¢å‘å¯¹è±¡æ–¹å¼ï¼ŒæŠŠæ¯ä¸ªç»„ä»¶å®šä¹‰æ¸…æ¥šã€‚é¦–å…ˆæ˜¯PlugBoardï¼Œå®ç°æ¯”è¾ƒç®€å•çš„å­—æ¯ä½ç½®æ˜ å°„ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_chararray</span><span class="params">(o)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(o, list):</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line">    <span class="keyword">return</span> [c <span class="keyword">for</span> c <span class="keyword">in</span> str(o)]</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alphabetical_letters</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> to_chararray(<span class="string">'abcdefghijklmnopqrstuvwxyz'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Plugboard</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span>  <span class="comment"># should reflect</span></span><br><span class="line">        self.inputs = alphabetical_letters()</span><br><span class="line">        self.outputs = alphabetical_letters()</span><br><span class="line">        self.mapping = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">plug_one</span><span class="params">(self, c1, c2)</span>:</span></span><br><span class="line">        idx1, idx2 = self.inputs.index(c1), self.outputs.index(c2)</span><br><span class="line">        self.mapping[idx1] = idx2</span><br><span class="line">        self.mapping[idx2] = idx1</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">plug_many</span><span class="params">(self, pairs)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> c1, c2 <span class="keyword">in</span> pairs:</span><br><span class="line">            self.plug_one(c1, c2)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proxy</span><span class="params">(self, idx)</span>:</span>  <span class="comment"># inputs/outputs are the same, so forward &amp; backward no differs</span></span><br><span class="line">        <span class="keyword">if</span> idx <span class="keyword">in</span> self.mapping:</span><br><span class="line">            <span class="keyword">return</span> self.mapping[idx]</span><br><span class="line">        <span class="keyword">return</span> idx</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯Scramblerï¼ˆRotorï¼‰ï¼Œéœ€è¦å®ç°æ­£åå‘è¾“å…¥è¾“å‡ºï¼Œä»¥åŠé‡åˆ¶åˆ°æŸä¸ªä½ç½®ï¼ˆå­—æ¯ï¼‰çš„åŠŸèƒ½ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rotate_array</span><span class="params">(arr: list, direction: int)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> direction &gt; <span class="number">0</span>:  <span class="comment"># right</span></span><br><span class="line">        final = arr[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr) - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>):</span><br><span class="line">            arr[i] = arr[i - <span class="number">1</span>]</span><br><span class="line">        arr[<span class="number">0</span>] = final</span><br><span class="line">    <span class="keyword">elif</span> direction &lt; <span class="number">0</span>:  <span class="comment"># left</span></span><br><span class="line">        final = arr[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(arr) - <span class="number">1</span>):</span><br><span class="line">            arr[i] = arr[i + <span class="number">1</span>]</span><br><span class="line">        arr[<span class="number">-1</span>] = final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scrambler</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, inputs, outputs)</span>:</span></span><br><span class="line">        self.inputs = to_chararray(inputs)</span><br><span class="line">        self.outputs = to_chararray(outputs)</span><br><span class="line">        self.direction = <span class="number">-1</span> <span class="comment"># rotate left</span></span><br><span class="line">        self.rotate_cnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span><span class="params">(self, cnt=<span class="number">1</span>)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(cnt):</span><br><span class="line">            rotate_array(self.inputs, self.direction)</span><br><span class="line">            rotate_array(self.outputs, self.direction)</span><br><span class="line">            self.rotate_cnt += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_to_idx</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> range(idx):</span><br><span class="line">            self.rotate() <span class="comment"># æ•´ä¸ªéƒ½è¦è½¬ï¼Œä¸æ˜¯ä¸€è¾¹è½¬</span></span><br><span class="line">        self.rotate_cnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset_to_char</span><span class="params">(self, c)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> self.inputs[<span class="number">0</span>] != c:</span><br><span class="line">            self.rotate() <span class="comment"># çœ‹inputçš„å­—æ¯æ¥è½¬</span></span><br><span class="line">        self.rotate_cnt = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        c = self.inputs[idx]</span><br><span class="line">        <span class="keyword">return</span> self.outputs.index(c)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        c = self.outputs[idx]</span><br><span class="line">        <span class="keyword">return</span> self.inputs.index(c)</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯Reflectorï¼Œæ‰¾åˆ°outputå¯¹åº”ä½ç½®çš„å­—æ¯ï¼Œåå°„åˆ°inputä¸­æ¥çº¿å­—æ¯çš„ä½ç½®ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reflector</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, inputs, outputs)</span>:</span></span><br><span class="line">        self.inputs = to_chararray(inputs)</span><br><span class="line">        self.outputs = to_chararray(outputs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reflect</span><span class="params">(self, idx)</span>:</span></span><br><span class="line">        c = self.outputs[idx]</span><br><span class="line">        <span class="keyword">return</span> self.inputs.index(c)</span><br></pre></td></tr></table></figure>
<p>æœ€åç»„è£…æˆæ•´ä¸ªEnigmaæœºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Enigma</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, plugboard=None, scramblers=None, reflector=None)</span>:</span></span><br><span class="line">        self.keyboard = alphabetical_letters()</span><br><span class="line">        self.plugboard: Plugboard = plugboard</span><br><span class="line">        self.scramblers: List[Scrambler] = scramblers</span><br><span class="line">        self.reflector: Reflector = reflector</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_rotate_scramblers</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(self.scramblers)):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">0</span> <span class="keyword">or</span> (self.scramblers[i<span class="number">-1</span>].rotate_cnt &gt; <span class="number">0</span> <span class="keyword">and</span></span><br><span class="line">                          self.scramblers[i<span class="number">-1</span>].rotate_cnt % len(self.keyboard) == <span class="number">0</span>):</span><br><span class="line">                self.scramblers[i].rotate()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encode_string</span><span class="params">(self, s)</span>:</span></span><br><span class="line">        chars = []</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">            <span class="comment"># input with idx</span></span><br><span class="line">            idx = self.keyboard.index(c)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># plugboard forward</span></span><br><span class="line">            <span class="keyword">if</span> self.plugboard:</span><br><span class="line">                idx = self.plugboard.proxy(idx)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># scramblers forward</span></span><br><span class="line">            <span class="keyword">if</span> self.scramblers:</span><br><span class="line">                self._rotate_scramblers()</span><br><span class="line">                <span class="keyword">for</span> scrambler <span class="keyword">in</span> self.scramblers:</span><br><span class="line">                    idx = scrambler.forward(idx)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># reflect and backward</span></span><br><span class="line">            <span class="keyword">if</span> self.reflector:</span><br><span class="line">                idx = self.reflector.reflect(idx)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> self.scramblers:</span><br><span class="line">                    scramblers_cnt = len(self.scramblers)</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(scramblers_cnt):</span><br><span class="line">                        scrambler = self.scramblers[scramblers_cnt<span class="number">-1</span>-i]</span><br><span class="line">                        idx = scrambler.backward(idx)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> self.plugboard:</span><br><span class="line">                    idx = self.plugboard.proxy(idx)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># output char of final idx</span></span><br><span class="line">            chars.append(self.keyboard[idx])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(chars)</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†è¿™äº›ä»£ç ä¹‹åï¼Œæ”»å…‹Cypheræ¸¸æˆä¸­çš„å…³å¡ä¹Ÿå°±å˜å¾—éå¸¸å®¹æ˜“äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">debug</span><span class="params">()</span>:</span></span><br><span class="line">    input_string = <span class="string">'gyhrvflrxy'</span></span><br><span class="line"></span><br><span class="line">    plugboard = Plugboard()</span><br><span class="line">    plugboard.plug_many([</span><br><span class="line">        (<span class="string">'a'</span>, <span class="string">'b'</span>),</span><br><span class="line">        (<span class="string">'s'</span>, <span class="string">'z'</span>),</span><br><span class="line">        (<span class="string">'u'</span>, <span class="string">'y'</span>),</span><br><span class="line">        (<span class="string">'g'</span>, <span class="string">'h'</span>),</span><br><span class="line">        (<span class="string">'l'</span>, <span class="string">'q'</span>),</span><br><span class="line">        (<span class="string">'e'</span>, <span class="string">'n'</span>)</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># scramblers</span></span><br><span class="line">    scrambler_1 = Scrambler(</span><br><span class="line">        inputs=alphabetical_letters(),</span><br><span class="line">        outputs=<span class="string">'uwygadfpvzbeckmthxslrinqoj'</span></span><br><span class="line">    )</span><br><span class="line">    scrambler_1.reset_to_char(<span class="string">'e'</span>)</span><br><span class="line"></span><br><span class="line">    scrambler_2 = Scrambler(</span><br><span class="line">        inputs=alphabetical_letters(),</span><br><span class="line">        outputs=<span class="string">'ajpczwrlfbdkotyuqgenhxmivs'</span></span><br><span class="line">    )</span><br><span class="line">    scrambler_2.reset_to_char(<span class="string">'a'</span>)</span><br><span class="line"></span><br><span class="line">    scrambler_3 = Scrambler(</span><br><span class="line">        inputs=alphabetical_letters(),</span><br><span class="line">        outputs=<span class="string">'tagbpcsdqeufvnzhyixjwlrkom'</span></span><br><span class="line">    )</span><br><span class="line">    scrambler_3.reset_to_char(<span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># reflector</span></span><br><span class="line">    reflector = Reflector(</span><br><span class="line">        inputs=alphabetical_letters(),</span><br><span class="line">        outputs=<span class="string">'yruhqsldpxngokmiebfzcwvjat'</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    enigma = Enigma(</span><br><span class="line">        plugboard=plugboard,</span><br><span class="line">        scramblers=[</span><br><span class="line">            scrambler_2,</span><br><span class="line">            scrambler_1,</span><br><span class="line">            scrambler_3,</span><br><span class="line">        ],</span><br><span class="line">        reflector=reflector</span><br><span class="line">    )</span><br><span class="line">    encoded = enigma.encode_string(input_string)</span><br><span class="line">    print(encoded)  <span class="comment"># blitzkrieg</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    debug()</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>Enigma</tag>
        <tag>å¯†ç å­¦</tag>
        <tag>Cypher</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘æœåŠ¡æ¶æ„ç¨³å®šæ€§çš„åŸºç¡€ä¿éšœ</title>
    <url>/2024/11/03/archiart/stability_basics/</url>
    <content><![CDATA[<p>ä¸€ä¸ªäº§å“éšç€ä¸æ–­ç ”å‘ï¼Œå…¶æœåŠ¡æ¶æ„çš„å¤æ‚åº¦ä¼šè¶Šæ¥è¶Šé«˜ã€‚éšç€äº§å“çš„ç”¨æˆ·ä½“é‡å˜å¤§ï¼Œä¸ºäº†ä¿è¯äº§å“èƒ½å¤Ÿé•¿çº¿è¿è¥ï¼Œå°±éœ€è¦ä¿è¯æ•´ä¸ªæœåŠ¡æ¶æ„çš„ç¨³å®šæ€§ã€‚å› æ­¤ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±ä»å®æ“çš„è§’åº¦ï¼Œç²—æµ…è®¨è®ºä¸€ä¸‹ï¼ŒæœåŠ¡æ¶æ„çš„ç¨³å®šæ€§éœ€è¦å¦‚ä½•åšåˆ°åŸºç¡€ä¿éšœã€‚</p>
<p>æ—¢ç„¶æ˜¯åŸºäºå®æ“çš„è§’åº¦ï¼Œé‚£ä¹ˆç†è®ºä¸Šçš„ä¸œè¥¿ä¸ä¼šæ¶‰åŠçš„å¤ªæ·±åˆ»ã€‚å¥½æ¯”è¯´ï¼Œè°ˆåˆ°ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å°±ä¼šè€ƒè™‘SLIã€SLOã€SLAè¿™äº›åŸºç¡€æ¦‚å¿µï¼Œä½†è¿™äº›æ¯”è¾ƒå®è§‚ã€‚æ‹¿OKRä¸¾ä¾‹å­çš„è¯ï¼ŒOæ˜¯SLAï¼ŒKRæ˜¯SLOï¼Œè€ŒSLIåˆ™æ˜¯KRå…·ä½“çš„æŒ‡æ ‡å®šä¹‰ã€‚æ‰€ä»¥è¿™ç¯‡æ–‡ç« ä¸»è¦è®²å¦‚ä½•ä¿è¯SLIä»¥åŠå…¶ä»–æŒ‡æ ‡ï¼Œé—´æ¥æ»¡è¶³SLOã€SLAçš„éœ€è¦ã€‚</p>
<a id="more"></a>
<p>å¯¹äºå¤–éƒ¨å®¢æˆ·æ¥è®²ï¼Œæ ¸å¿ƒæœåŠ¡çš„SLIæŒ‡æ ‡æ˜¯éœ€è¦ä¼˜å…ˆä¿è¯çš„ï¼Œè€Œå‘¨è¾¹æœåŠ¡çš„SLIæŒ‡æ ‡åˆ™å¯ä»¥åšä¸ºæ ¸å¿ƒæœåŠ¡çš„ä¸‹é’»æŒ‡æ ‡æ¥çœ‹å¾…ã€‚SLIæŒ‡æ ‡ä¸€èˆ¬æ˜¯ä¸Šæ¸¸è§†è§’çš„æœåŠ¡å¯ç”¨æ€§ï¼Œå¦‚æœä¸€ä¸ªè¯·æ±‚è¿”å›ä¸€äº›4å­—å¤´ã€5å­—å¤´çš„é”™è¯¯ç ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®¤ä¸ºä¸Šæ¸¸è§†è§’æœåŠ¡ä¸å¯ç”¨ã€‚ç”±äº5å­—å¤´ä¸»è¦æ˜¯æœåŠ¡å™¨é”™è¯¯ï¼Œå› æ­¤5å­—å¤´çš„é—®é¢˜éœ€è¦case-by-caseæ’æŸ¥æœåŠ¡ç«¯å®ç°é—®é¢˜è¿›è¡Œå¤„ç†ï¼Œè€Œ4å­—å¤´åˆ™ä¸ä¸€å®šã€‚æ¯”å¦‚ä¸€ä¸ªåªèƒ½POSTçš„è·¯ç”±ï¼Œå¼ºè¡ŒGETï¼Œå°±æœ‰å¯èƒ½æ„é€ å‡ºä¸€ä¸ª404ï¼›ä¸€ä¸ªè®¾è®¡ä¸Šé¢„è®¡å»¶æ—¶è¾ƒé•¿çš„æ¥å£ï¼Œå®¢æˆ·ç«¯å¦‚æœæå‰æ–­å¼€ï¼Œnginxä¹Ÿå¯èƒ½ç»™ä¸€ä¸ª499çš„é”™è¯¯ã€‚ç©¶å…¶æ€§è´¨ï¼Œ4å­—å¤´çš„é”™è¯¯å¯ä»¥é€‚å½“åšè¿‡æ»¤ï¼Œä½†ä¹Ÿä¸æ’æœåŠ¡ç«¯è‡ªå·±å¯ä»¥æŠŠæ¥å£å®ç°ç»™ä¼˜åŒ–æ‰ï¼Œä¸»åŠ¨è§£å†³é—®é¢˜ã€‚</p>
<p>ä¸ºäº†ä¿è¯SLIçš„é«˜æŒ‡æ ‡ï¼Œåˆšåˆšæåˆ°ï¼Œé™¤äº†å‘¨è¾¹æœåŠ¡çš„SLIæŒ‡æ ‡å¤–ï¼Œå…¶ä»–å½“å‰æœåŠ¡çš„é»„é‡‘æŒ‡æ ‡ä¹Ÿå¿…ä¸å¯å°‘ã€‚ä¸Šä¸‹æ¸¸çš„è¯·æ±‚é”™è¯¯ï¼Œå¯ä»¥åæ˜ å½“å‰æœåŠ¡å…·ä½“å‡ºç°å“ªäº›é”™è¯¯æˆ–è€…ä¸åˆç†çš„è¯·æ±‚ï¼Œä»¥åŠæœåŠ¡å¤„ç†ä¸šåŠ¡è¿‡ç¨‹ä¸­å“ªäº›ç¯èŠ‚å‡ºäº†å¼‚å¸¸ï¼›å®¹å™¨çš„CPU/MEMç­‰èµ„æºå ç”¨ï¼Œå¯ä»¥åæ˜ æœåŠ¡åœ¨å“ªäº›å…·ä½“çš„æ—¶åˆ»å‡ºç°æ€§èƒ½é—®é¢˜ï¼›é”™è¯¯å’Œå´©æºƒæ—¥å¿—ï¼Œåˆ™ç›´æ¥åæ˜ å…·ä½“å‡ºç°çš„ä¸šåŠ¡é€»è¾‘æˆ–è€…æ€§èƒ½é—®é¢˜æ˜¯ä»€ä¹ˆã€‚</p>
<p>å¯¹äºSLIçš„æ¯›åˆºï¼Œå¯ä»¥å°†åŒä¸€æ—¶é—´æ®µä¸‰ç±»ä¸‹é’»æŒ‡æ ‡ç»“åˆèµ·æ¥çœ‹ï¼Œæ‰¾åˆ°ä¸€äº›æ¯›åˆºä¸Šçš„å…±æ€§ï¼Œå¯¹äºè¯·æ±‚é”™è¯¯ï¼Œå¯ä»¥æ‰¾åˆ°ä¸€äº›traceçš„ä¾‹å­åšåˆ†æï¼›å¯¹äºæ€§èƒ½å ç”¨é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡æŠ“å–ç«ç„°å›¾æ¥çœ‹å½“å‰æŸä¸ªæ—¶é—´æ®µå“ªäº›å‡½æ•°å ç”¨çš„æ—¶é—´æ¯”è¾ƒå¤šï¼Œç„¶åå†åšå®šç‚¹ä¼˜åŒ–ï¼›å¯¹äºé”™è¯¯å´©æºƒæ—¥å¿—é—®é¢˜ï¼Œå¯ä»¥åšæ—¥å¿—èšåˆåˆ†æï¼Œçœ‹å“ªäº›ç±»å‹çš„æ—¥å¿—å‡ºç°çš„æ¯”è¾ƒå¤šï¼Œå“ªäº›æ—¥å¿—åœ¨æŸä¸ªæ—¶åˆ»æœ‰ä¸Šæ¶¨æ³¢åŠ¨ï¼Œæ‰¾åˆ°ä¸€äº›å…³é”®å­—å…±æ€§ç‰¹å¾ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥ç³»ç»Ÿæ€§æŸ¥è¯å¯èƒ½å¯¼è‡´å¯ç”¨æ€§é™ä½çš„åŸå› ï¼Œä»è€Œé€ä¸ªæ’é™¤å‡»ç ´ã€‚</p>
<p>é™¤äº†æ ¸å¿ƒæœåŠ¡å’Œå‘¨è¾¹æœåŠ¡ä¹‹å¤–ï¼Œä¸­é—´ä»¶çš„é—®é¢˜ä¹Ÿæ˜¯éœ€è¦å…³æ³¨çš„ï¼Œæ¯”å¦‚DBçš„è¡¨å¯ç”¨æ€§ã€æ¶ˆæ¯é˜Ÿåˆ—çš„ååé‡å»¶æ—¶ï¼Œä»¥åŠç¼“å­˜çš„è®¿é—®é”™è¯¯ç‡ç­‰ç­‰ã€‚å¯¹äºDBè€Œè¨€ï¼Œå¯ä»¥é‡ç‚¹å…³æ³¨æ…¢æŸ¥è¯¢ã€è¿æ¥æ•°ä¸Šé™å’Œä¸»ä»å»¶æ—¶ç­‰æ€§èƒ½æŒ‡æ ‡ï¼Œå¦‚æœæœ‰æ…¢æŸ¥æˆ–è€…è¿æ¥æ•°æ‰“æ»¡é‚£è¦è€ƒè™‘ä»£ç hitç´¢å¼•ä»¥åŠè¿æ¥ï¼ˆæ± ï¼‰æœªåŠæ—¶é‡Šæ”¾é—®é¢˜ï¼Œæ˜¯éœ€è¦æœåŠ¡å™¨å…³å¿ƒçš„ï¼Œå¦‚æœæœ‰ä¸»ä»å»¶æ—¶ï¼Œåˆ™éœ€è¦çœ‹æ˜¯ä¸æ˜¯åŒæ—¶åˆ»æœ‰DDLä¹‹ç±»çš„æ“ä½œé”è¡¨ï¼Œå¯¼è‡´å¤§é‡æ•°æ®ä¸èƒ½åŠæ—¶åŒæ­¥ï¼Œæˆ–è€…çº¯ç²¹æ˜¯DBè¿ç»´åŸå› ã€‚å¯¹äºç¼“å­˜è€Œè¨€ï¼Œå¦‚æœç¼“å­˜è®¿é—®é”™è¯¯ï¼Œå¯ä»¥ä¼˜å…ˆçœ‹ä¸‹æ˜¯å¦å› ä¸ºé«˜å»¶æ—¶å¼•èµ·ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œçœ‹ä¸‹æ˜¯å¦æœ‰å¤§keyå ç”¨äº†ç¼“å­˜è¾ƒå¤šçš„å†…å­˜ï¼Œæˆ–è€…é¢‘ç¹å¯¹äºå¤§keyåšæ“ä½œå¯¼è‡´ç¼“å­˜å¤„ç†ä¸è¿‡æ¥ã€‚ä¹‹åï¼ŒDBå’Œç¼“å­˜éƒ½éœ€è¦æ³¨æ„é›†ç¾¤åˆ†ç‰‡çš„åœºæ™¯ä¸‹ï¼Œå•ä¸ªå®ä¾‹çš„æ€§èƒ½é—®é¢˜ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦å­˜åœ¨æŸäº›çƒ­ç‚¹æ•°æ®ã€‚</p>
<p>å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œé™¤äº†è¿ç»´åŸå› å¤–ï¼Œå°¤å…¶æ˜¯ä½œä¸ºæ¶ˆè´¹è€…çš„æœåŠ¡ï¼Œéœ€è¦ç›‘æ§ä¸Šæ¶ˆè´¹é€»è¾‘çš„å¤„ç†å»¶æ—¶ã€‚å°¤å…¶ï¼Œå¦‚æœæ¶ˆè´¹é€»è¾‘æ¶‰åŠåˆ°å’Œç¬¬ä¸‰æ–¹å¹³å°çš„äº¤äº’ï¼Œéœ€è¦è€ƒè™‘ç¬¬ä¸‰æ–¹å¹³å°æ˜¯å¦ç¨³å®šï¼Œå¦‚è‹¥ä¸ç¨³å®šï¼Œåˆ™éœ€è¦èµ°å¦å¤–çš„æ¶ˆæ¯å¤„ç†å¼‚æ­¥é€»è¾‘å…œåº•ï¼Œåšä¸€ä¸ªç›¸å¯¹ä¼˜é›…çš„fixã€‚å¦‚æœä»£ç å±‚é¢æ²¡æ³•ä¼˜åŒ–çš„è¯ï¼Œé€šè¿‡æ‰©å®¹æœåŠ¡åˆ™æ˜¯æœ€ç²—æš´ç›´æ¥çš„è§£å†³æ–¹å¼ã€‚</p>
<p>æœ€åï¼Œé™¤äº†æœåŠ¡æœ¬èº«çš„æŒ‡æ ‡ä¹‹å¤–ï¼Œä»ä¸šåŠ¡è§’åº¦è€Œè¨€ä¹Ÿéœ€è¦æ¢³ç†ä¸šåŠ¡çš„æ ¸å¿ƒé‡è¦é“¾è·¯ï¼Œè¡¥å……æ‰“ç‚¹metricsä¸ŠæŠ¥ï¼Œä»è€Œåœ¨ç›‘æ§æœåŠ¡æ€§è´¨æŒ‡æ ‡çš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥åŠæ—¶å‘ç°ä¸€äº›ä¸šåŠ¡æ€§è´¨çš„é—®é¢˜ã€‚ä¸šåŠ¡é”™è¯¯æœ€ç»ˆä¼šå¯¼è‡´æœåŠ¡å¯ç”¨æ€§ä¸‹é™ï¼Œè¿™æ ·é€šè¿‡ç»“åˆåŒæ—¶é—´æ®µçš„æŒ‡æ ‡èšåˆåˆ†æï¼ŒæœåŠ¡SLIçš„ä¸‹é™é—®é¢˜å°±å¯èƒ½ä¼šæ›´åŠ å®¹æ˜“è¢«å®šä½åˆ°ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ç¨³å®šæ€§</tag>
        <tag>å¾®æœåŠ¡</tag>
        <tag>é—®é¢˜æ’æŸ¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘å°†requestså®ä¾‹è½¬æ¢æˆcurlè¯­å¥</title>
    <url>/2024/11/03/pythonnotes/requests_to_curl/</url>
    <content><![CDATA[<p>åœ¨æŸäº›pythonçš„å·¥å…·æ¨¡å—å¼€å‘åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ ¹æ®ç”¨æˆ·ç»™å®šçš„webè¯·æ±‚è¾“å…¥ï¼Œæ¥è½¬åŒ–æˆä¸€ä¸ªcurlçš„è¾“å‡ºï¼Œç”¨äºä¸€äº›ç½‘ç»œè¯·æ±‚æµ‹è¯•ï¼Œæˆ–è€…æ–¹ä¾¿å¼€å‘ä¹‹é—´äº¤æµä¿¡æ¯ã€‚ç”±äºpythonçš„webè¯·æ±‚åŸºæœ¬ä¸Šä¸€ä¸‡ä¸ªäººé‡Œé¢ä¹æˆä¹éƒ½ç”¨requestsï¼Œå› æ­¤ä»Šå¤©è¿™ç¯‡æ–‡ç« å°±ç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œå¦‚ä½•åœ¨pythoné‡Œé¢å°†requestså®ä¾‹è½¬åŒ–æˆcurlè¯­å¥ã€‚</p>
<p>è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€ä¸ªå«åš<span class="exturl" data-url="aHR0cHM6Ly9weXBpLm9yZy9wcm9qZWN0L2N1cmxpZnkv" title="https://pypi.org/project/curlify/">curlify<i class="fa fa-external-link"></i></span>çš„å·¥å…·åº“æ¥è¾¾åˆ°æ•ˆæœã€‚curlifyæä¾›äº†ä¸€ä¸ªto_curlå‡½æ•°ï¼Œå¯ä»¥å°†ä¸€ä¸ªè¯·æ±‚å®ä¾‹è½¬åŒ–æˆcurlè¯­å¥ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_curl</span><span class="params">(request, compressed=False, verify=True)</span>:</span></span><br><span class="line">    parts = [</span><br><span class="line">        (<span class="string">'curl'</span>, <span class="literal">None</span>),</span><br><span class="line">        (<span class="string">'-X'</span>, request.method),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> sorted(request.headers.items()):</span><br><span class="line">        parts += [(<span class="string">'-H'</span>, <span class="string">'&#123;0&#125;: &#123;1&#125;'</span>.format(k, v))]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.body:</span><br><span class="line">        body = request.body</span><br><span class="line">        <span class="keyword">if</span> isinstance(body, bytes):</span><br><span class="line">            body = body.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        parts += [(<span class="string">'-d'</span>, body)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> compressed:</span><br><span class="line">        parts += [(<span class="string">'--compressed'</span>, <span class="literal">None</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> verify:</span><br><span class="line">        parts += [(<span class="string">'--insecure'</span>, <span class="literal">None</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸‹ç•¥ï¼Œä¸»è¦æ˜¯ç»„è£…å‘½ä»¤</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå‘ç‚¹åœ¨äºï¼Œæˆ‘ä»¬æœ‰æ—¶å€™æŠŠrequestsè½¬åŒ–ä¸ºcurlï¼Œå¾—åœ¨è¯·æ±‚ä¹‹å‰å»åšï¼Œè€Œæˆ‘ä»¬ä¸€èˆ¬ç”¨requests.getã€requests.requestæ—¶å€™ï¼Œå…¶å®å·²ç»æŠŠè¯·æ±‚å‘é€å‡ºå»äº†ã€‚å› æ­¤ï¼Œè¿™ä¸ªæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ç®€å•æ¢ç§˜ä¸€ä¸‹requestsçš„æºç å®ç°ï¼Œæ¥çœ‹éœ€è¦æ€ä¹ˆåšæ‰èƒ½ç»™åˆ°ä¸€ä¸ªè¯·æ±‚å‘é€ä¹‹å‰çš„requestså®ä¾‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(self)</span>:</span>  <span class="comment"># requests.session.requestï¼Œå‚æ•°ç•¥</span></span><br><span class="line">    req = Request(</span><br><span class="line">        method=method.upper(),</span><br><span class="line">        url=url,</span><br><span class="line">        <span class="comment"># å…¶ä»–å‚æ•°ç•¥</span></span><br><span class="line">    )</span><br><span class="line">    prep = self.prepare_request(req)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prepare_request</span><span class="params">(self, req)</span>:</span></span><br><span class="line">    p = PreparedRequest()</span><br><span class="line">    p.prepare(</span><br><span class="line">        method=request.method.upper(),</span><br><span class="line">        url=request.url,</span><br><span class="line">        files=request.files,</span><br><span class="line">        data=request.data,</span><br><span class="line">        json=request.json,</span><br><span class="line">        headers=merge_setting(</span><br><span class="line">            request.headers, self.headers, dict_class=CaseInsensitiveDict</span><br><span class="line">        ),</span><br><span class="line">        params=merge_setting(request.params, self.params),</span><br><span class="line">        auth=merge_setting(auth, self.auth),</span><br><span class="line">        cookies=merged_cookies,</span><br><span class="line">        hooks=merge_hooks(request.hooks, self.hooks),</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure>
<p>ä»requestsæºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¯·æ±‚ä¹‹å‰ï¼Œä¼šæ„é€ ä¸€ä¸ªPreparedRequestå®ä¾‹ï¼Œæ¥å­˜å‚¨æ‰€æœ‰çš„è¯·æ±‚å‚æ•°ã€‚å› æ­¤ï¼Œå¦‚æœç»™å®šè¯·æ±‚å‚æ•°çš„è¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ˜¾å¼æ„é€ ä¸€ä¸ªPreparedRequestå®ä¾‹ï¼Œç„¶åè°ƒç”¨to_curlå‡½æ•°ï¼Œå°†PreparedRequestè½¬åŒ–ä¸ºcurlè¯­å¥ï¼Œæ»¡è¶³åœ¨è¯·æ±‚å‘èµ·ä¹‹é—´è½¬åŒ–çš„éœ€è¦ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_curl</span><span class="params">(self)</span>:</span></span><br><span class="line">    prepared_request = requests.PreparedRequest()</span><br><span class="line">    prepared_request.prepare_method(self.method)</span><br><span class="line">    prepared_request.prepare_url(self.url, <span class="literal">None</span>)</span><br><span class="line">    prepared_request.prepare_headers(self.headers)</span><br><span class="line">    prepared_request.prepare_body(self.body.strip(), <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> curlify.to_curl(prepared_request)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>webå¼€å‘</tag>
        <tag>requests</tag>
        <tag>curl</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘ç”±é¢è¯•å®˜è§’åº¦ç»™æ ¡æ‹›ç”Ÿçš„å¤§å‚é¢è¯•è¦ç‚¹</title>
    <url>/2024/10/16/geekdaily/rookie_interview/</url>
    <content><![CDATA[<p>åˆåˆ°äº†ä¸€å¹´ä¸€åº¦çš„æ ¡æ‹›å­£ï¼Œä»Šå¹´ç”±äºå›¢é˜ŸåŒæ—¶æ‹›è˜åç«¯å’Œæ™ºèƒ½åŒ–æ–¹å‘çš„åŒå­¦ï¼Œå¸å¼•äº†å¾ˆå¤šä¸åŒç®—æ³•é¢†åŸŸã€åç«¯é¢†åŸŸä»¥åŠç”šè‡³å·²ç»åœ¨å¤§å‚å®ä¹ è¿‡çš„åŒå­¦çš„ç®€å†ï¼Œå¯è°“æ˜¯æ¯å¹´éƒ½éå¸¸ä¼˜ç§€ã€‚è‡³å°‘æ¯”èµ·ç¬”è€…æœ¬äººæ ¡æ‹›é‚£ä¸ªæ—¶å€™ï¼Œæ˜¯è¦ä¼˜ç§€çš„å¾ˆå¤šï¼Œä¸æ˜¯ä¸€ç‚¹åŠç‚¹ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªé¢è¯•å®˜ï¼Œç¬”è€…é¢å¯¹çš„æ˜¯å¾ˆå¤šä¸åŒæ–¹å‘çš„åŒå­¦çš„ç®€å†ï¼Œæœ‰äº›æ–¹å‘è¯´å®åœ¨çš„ç¬”è€…è‡ªå·±ä¹Ÿå¯¹ç›¸å…³çš„æŠ€æœ¯äº†è§£çš„ä¸é‚£ä¹ˆæ¸…æ™°ã€‚ä½†æ—¢ç„¶æ˜¯é¢è¯•äº†ï¼Œå°±å¿…é¡»æœ‰ä¸ªæŠŠæ¡ï¼Œå¿ƒä¸­å¾—æœ‰æ†ç§¤ï¼Œå®å¯å¼ºæ€ï¼Œä¹Ÿä¸èƒ½é”™é€‰ï¼Œä¸ç„¶å°±å¾—åŒè¾“ã€‚è¿™ç¯‡æ–‡ç« ï¼Œå°±ä»é¢è¯•å®˜çš„è§’åº¦ï¼Œç»™å„ä½ä»Šå¹´çš„æ ¡æ‹›ç”Ÿï¼Œæ˜å¹´çš„æ ¡æ‹›ç”Ÿï¼Œä»¥åŠæœªæ¥çš„æ ¡æ‹›ç”Ÿï¼ŒèŠä¸€ä¸‹å¤§å‚é¢è¯•çš„ä¸€äº›è¦ç‚¹ã€‚è™½ç„¶åªæ˜¯ä¸€å®¶ä¹‹è¨€ï¼Œä½†ç§ä»¥ä¸ºè¿˜æ˜¯æ¯”è¾ƒå…·å¤‡å‚è€ƒä»·å€¼çš„ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯èŠä¸€ä¸‹æ ¡æ‹›ç›¸å¯¹äºç¤¾æ‹›çš„å…³é”®ä¸åŒç‚¹ã€‚ç¤¾æ‹›ï¼Œä½œä¸ºé¢è¯•å®˜ä¼šç€é‡è€ƒå¯Ÿä¸€ç‚¹æ˜¯ï¼Œå€™é€‰äººçš„èµ„å†èƒŒæ™¯å’Œå²—ä½åŒ¹é…åº¦æ˜¯å¦é«˜ï¼Œæˆ–è€…å€™é€‰äººåšçš„äº‹æƒ…ï¼Œåšäº‹çš„æ€è·¯ï¼Œæ˜¯å¦ç›´æ¥å¯¹å²—ä½å·¥ä½œå†…å®¹æœ‰æ‰€å¢ç›Šã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯æ¥äº†å°±å¾—ç›´æ¥ä¸Šæ‰‹ï¼Œæ²¡æœ‰ä»€ä¹ˆåŸ¹å…»æœŸï¼Œä¸è¡Œå°±outã€‚æ‰€ä»¥ä¼šçœ‹åˆ°ï¼Œå¾ˆå¤šç¤¾æ‹›åŒå­¦è™½ç„¶å±¥å†éå¸¸ä¼˜ç§€ï¼Œä½†åœ¨å¤šè½®é¢è¯•é‡Œè¿˜æ˜¯å¤±è´¥äº†ï¼Œå…¶ä¸­æ½œåœ¨çš„ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„åŸå› å°±æ˜¯åŒ¹é…åº¦ä¸é«˜ã€‚æ ¡æ‹›åˆ™ä¸ç„¶ï¼Œæ ¡æ‹›å¯¹äºå²—ä½åŒ¹é…åº¦è€ƒå¯Ÿçš„å¹¶ä¸æ˜¯é‚£ä¹ˆç›´æ¥ï¼Œæˆ–è€…è¯´æ¯”èµ·åŒ¹é…åº¦ï¼Œæ›´çœ‹é‡å€™é€‰äººå¯¹äºè¿™ä¸ªå²—ä½å·¥ä½œæ€§è´¨çš„äº†è§£ï¼Œä»¥åŠå¯¹äºä»äº‹è¿™ä¸ªå²—ä½çš„æ„æ„¿ã€‚ä½ æœ‰äº†æ„æ„¿ï¼Œä½œä¸ºé¢è¯•å®˜è§’åº¦ï¼Œå°±ä¼šè§‰å¾—ï¼Œåœ¨æœªæ¥çš„å·¥ä½œé‡Œï¼Œå¯ä»¥æœ‰å¾ˆå¤šè¯å¯ä»¥èŠï¼Œå¯ä»¥æœ‰å¾ˆå¤šäº‹æƒ…å¯ä»¥ä¸€èµ·åšï¼Œæ€»ä½“æ˜¯ä¸€ä¸ªåŒèµ¢çš„ç»“æœã€‚</p>
<p>å‡è®¾ä½ åŸæ¥æ²¡æœ‰å‚ä¸è¿‡å®ä¹ ï¼Œå¹¶éæœ€ä¼˜ç§€çš„é‚£ä¸€ä¸ªï¼Œä½†æ˜¯æœ‰å¹¸é€šè¿‡ç®€å†ç­›é€‰ï¼Œé¢è¯•å…¶ä»–é—®é¢˜ç­”å¾—éƒ½OKï¼Œå¹¶ä¸”å…³é”®æ˜¯å¯¹äºå²—ä½çš„äº†è§£æ¯”è¾ƒå¤šï¼Œæœ‰è‡ªå·±æ˜ç¡®å–œæ¬¢åšçš„æ–¹å‘ï¼Œå¹¶ä¸”ä¹Ÿå¯¹ä¸šç•Œåšçš„äº‹æƒ…æœ‰ä¸€å®šçš„è‡ªæˆ‘è®¤çŸ¥ï¼Œé‚£ä¹ˆè¿™ä¸€ç‚¹å°±éå¸¸åŠ åˆ†ã€‚æ¯”èµ·æ‹›è˜ä¸€ä¸ªä¼˜ç§€ä½†æ²¡æœ‰æ„æ„¿çš„äººï¼Œä¸€ä¸ªå¹¶éæœ€ä¼˜ç§€ä½†æœ‰æ„æ„¿çš„äººï¼Œåˆä½œèµ·æ¥ä¸€å®šæ›´æ˜¯1+1å¤§äº2çš„æ•ˆæœã€‚å½“ç„¶ï¼ŒåŒ¹é…åº¦ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ç¯ï¼Œå¦‚æœä½ çš„çŸ¥è¯†ç§¯ç´¯å’Œå²—ä½éœ€è¦çš„æŠ€æœ¯æ ˆå®åœ¨äº¤é›†å¤ªå°‘ï¼Œé‚£ä¹Ÿæ˜¯ä¸åˆé€‚çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦äº†è§£è‡ªå·±çœŸå®çš„éœ€æ±‚ã€‚</p>
<p>å…¶æ¬¡ï¼Œè¯´åˆ°ä¼ä¸šä¸å€™é€‰äººçš„åŒèµ¢ï¼Œè·‘ä¸äº†æ²Ÿé€šèƒ½åŠ›ã€‚åœ¨å·¥ä½œåœºåˆï¼Œå°¤å…¶æ˜¯å¤§å‚ï¼Œä½œä¸ºç ”å‘ï¼Œä½ æ¥è§¦çš„äººç¾¤ä¸ä¸€å®šåªæ˜¯æŠ€æœ¯åŒå­¦ï¼Œä¹Ÿå¯èƒ½æ˜¯äº§å“ï¼Œä¹Ÿå¯èƒ½æ˜¯æµ‹è¯•ï¼Œæˆ–è€…å…¶ä»–é«˜èŒçº§ä½èŒçº§çš„åŒå­¦ã€‚å¦‚æœè¦è¾¾åˆ°å…±åŒå·¥ä½œç›®æ ‡ï¼Œå°±å¿…é¡»å’Œä¸åŒèƒŒæ™¯çš„åŒå­¦ç´§å¯†æ²Ÿé€šï¼Œå¯»æ‰¾å…±è¯†ï¼Œè¿™æ ·æ‰èƒ½å®Œç¾é…åˆèµ·æ¥ã€‚æ‰€ä»¥åŸºäºè¿™ä¸ªé€»è¾‘ï¼Œå¯¹äºå€™é€‰äººè€Œè¨€ï¼Œé™¤äº†æŠ€æœ¯çš„ç¡¬å®åŠ›å¤–ï¼Œå·¥ä½œæ²Ÿé€šä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ç¯ã€‚</p>
<p>æ€ä¹ˆä¸ªå·¥ä½œæ²Ÿé€šæ³•ï¼Ÿæˆ‘ä»¬å¯ä»¥æ€è€ƒä¸‹ï¼Œå·¥ä½œåœºåˆï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸€ä¸ªå›¢é˜Ÿäº§ç”Ÿï¼Œæ˜¯å› ä¸ºæœ‰äº†å…±åŒçš„å·¥ä½œç›®æ ‡ï¼Œæ‰æœ‰äº†è¿™ä¹ˆä¸ªå›¢é˜Ÿï¼Œæ‰€ä»¥ä¸€åˆ‡çš„å·¥ä½œæ²Ÿé€šéƒ½æ˜¯åŸºäºå·¥ä½œç›®æ ‡çš„æ¨è¿›è€Œç”Ÿçš„ã€‚å¥½æ¯”è¯´ï¼Œé¢è¯•å®˜è®©ä½ ä¸€å¼€å§‹ä»‹ç»ä½ å®ä¹ æˆ–è€…é¡¹ç›®é‡Œåšäº†ä»€ä¹ˆï¼Œå…¶å®æ½œåœ¨æ˜¯å¸Œæœ›ä½ å›ç­”ï¼Œä½ å·¥ä½œçš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œç„¶åé€å±‚å¾€ä¸‹æ‹†è§£ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªç›®æ ‡ï¼Œè¿™ä¸ªç›®æ ‡èƒ½è§£å†³å•¥é—®é¢˜ï¼Œé€šè¿‡ä»€ä¹ˆæ€è·¯ä»€ä¹ˆæ‰§è¡Œæ–¹å¼è¾¾åˆ°äº†è¿™ä¸ªç›®æ ‡ï¼Œæœ€åæ‰æ˜¯å…·ä½“æ€è·¯çš„è®¾è®¡å’Œæ‰§è¡Œçš„ç»†èŠ‚ã€‚å°è¯•å»äº†è§£åšäº‹çš„æœ¬è´¨ï¼Œå’Œå·¥ä½œä¼™ä¼´è¾¾åˆ°æ›´èæ´½çš„æ²Ÿé€šï¼Œè¿™æ ·çš„ç‰¹è´¨å°±ä¼šéå¸¸åŠ åˆ†ã€‚</p>
<p>å¾ˆå¤šç ”å‘åŒå­¦å¹¶ä¸ä¸€å®šä»¥æ²Ÿé€šè§é•¿ï¼Œå¦‚æœæ˜¯è¿™æ ·çš„æƒ…å†µï¼Œå°±éœ€è¦è€ƒè™‘è‡ªå·±çš„å·¥ä½œéœ€æ±‚æ˜¯å¦å’Œå²—ä½å®é™…çš„éœ€è¦åŒ¹é…ï¼Œå¦‚æœè¦è¿›åˆ°ä¸šåŠ¡é‡Œè‚¯å®šéœ€è¦ä¸€å®šçš„æ²Ÿé€šèƒ½åŠ›ï¼Œå¦‚æœæ˜¯å»åšåŸºå»ºé‚£å¯èƒ½æ›´åŠ åå‘äºæŠ€æœ¯æ–¹é¢çš„æ²‰æ·€ã€‚æ€»è€Œè¨€ä¹‹ï¼Œè™½ç„¶ç¡¬å®åŠ›çš„ç¢¾å‹åœ¨æŸç§ç¨‹åº¦ä¸Šå¯ä»¥æŠ¹å¹³æ²Ÿé€šèƒ½åŠ›çš„ä¸è¶³ï¼Œä½†ä¸è®ºæ€ä¹ˆæ ·ï¼Œæ²Ÿé€šä¸å¥½éƒ½ä¸æ˜¯è¾¾ä¸æˆå·¥ä½œç›®æ ‡çš„å€Ÿå£ï¼Œå·¥ä½œåšäº‹çš„ä¸€ä¸ªå®—æ—¨è¿˜æ˜¯ä¸æ–­å‘å·¥ä½œç›®æ ‡å‰è¿›ã€‚ä¸€ä¸ªå€™é€‰äººï¼Œä¸ç®¡æ˜¯æŠ€æœ¯ä¸Šçš„æ²Ÿé€šè¿˜æ˜¯ä¸šåŠ¡ä¸Šçš„æ²Ÿé€šï¼Œè°ˆåæ¸…æ™°ï¼Œæœ‰å…±æƒ…èƒ½åŠ›ï¼Œæœ‰ç›®æ ‡æ„Ÿï¼Œå°±æ˜¯ä¼˜ç§€ã€‚</p>
<p>ç„¶åæ‰æ˜¯æŠ€æœ¯çš„ç§¯ç´¯ã€‚å¯¹äºæŠ€æœ¯ç¡¬å®åŠ›çš„é¢è¯•ï¼Œä¸åŒçš„é¢è¯•å®˜æœ‰ä¸åŒçš„é£æ ¼ï¼Œæœ‰è€ƒå…«è‚¡æ–‡çš„ï¼Œä¹Ÿæœ‰ç›´æ¥æŒ‰ç…§å¯¹æ ‡è‡ªå·±çš„èƒ½åŠ›æ¥è€ƒå¯Ÿçš„ï¼Œä¹Ÿæœ‰ç¬”è€…è¿™ç§å°è¯•challengeå€™é€‰äººè‡ªå·±çš„æŠ€æœ¯ç§¯æ·€çš„ã€‚å¦‚æœé‡åˆ°ç¬”è€…è¿™ç§é¢è¯•å®˜ï¼Œå°±æ˜¯æ·±åº¦å’Œå¹¿åº¦ç»¼åˆçš„è€ƒå¯Ÿäº†ã€‚æ·±åº¦æ–¹é¢ï¼Œå¯¹äºè‡ªå·±ç†Ÿæ‚‰çš„æŠ€æœ¯é¢†åŸŸï¼Œè¦ç†Ÿæ‚‰é€ï¼Œå¾—æœ‰è‡ªå·±çš„ä¸€å¥—é€»è¾‘å’Œè§£å†³æŠ€æœ¯é—®é¢˜çš„æ€è·¯ï¼Œå¯¹å¸¸è§å…«è‚¡æ–‡ä¹Ÿæœ‰è‡ªå·±çš„ä¸€å¥—ç†è§£ï¼›å¹¿åº¦æ–¹é¢ï¼Œå’Œç¨å¾®ä¸åŒæŠ€æœ¯é¢†åŸŸåŒå­¦çš„äº¤æµï¼Œæ¯”å¦‚å’Œç¬”è€…äº¤æµçš„æ—¶å€™ï¼Œèƒ½å¤Ÿç†è§£ä¸åŒé¢†åŸŸæŠ€æœ¯çš„æ¦‚å¿µï¼Œå¹¶ä¸”èƒ½åšåˆ°ç†è§£æ¦‚å¿µé—´çš„è”ç³»ï¼Œä¸¾ä¸€åä¸‰ï¼ŒæŠŠè¦è§£å†³çš„æŠ€æœ¯é—®é¢˜ï¼Œè§£å†³çš„æ€è·¯å’Œè¿‡ç¨‹ï¼Œå¯ä»¥é€šè¿‡ä¸åŒé¢†åŸŸçš„æ¦‚å¿µç±»æ¯”æ¸…æ¥šã€‚å¦‚æœå£è¿°æ—¶å€™èƒ½åšåˆ°è¿™äº›ï¼Œç€å®éå¸¸åŠ åˆ†ï¼Œå¯èƒ½é¢è¯•å®˜åœ¨è€ƒå¯Ÿcodingé¢˜ç›®çš„æ—¶å€™ï¼Œå°±ç®—ä½ ä¸€æ—¶ç´§å¼ ï¼Œä¹Ÿä¼šç»™è¶³ä½ é¢å­ã€‚</p>
<p>ä¸€ä¸ªé¢è¯•å®˜ä¼šé¢å¯¹å¾ˆå¤šä¸åŒæŠ€æœ¯èƒŒæ™¯çš„å€™é€‰äººï¼Œæ‰€ä»¥å¦‚æœåœ¨å¤§å®¶æŸä¸€é¢†åŸŸç¡¬å®åŠ›ä½“æ„Ÿéƒ½å·®ä¸å¤šçš„æƒ…å†µä¸‹ï¼Œå°±ä¼šè€ƒè™‘å·¥ä½œæ„æ„¿ã€æ²Ÿé€šåˆä½œèƒ½åŠ›ï¼Œç„¶åå°±æ˜¯è€ƒå¯Ÿä½ å¯¹è‡ªå·±æ“…é•¿æŠ€æœ¯çš„ç†è§£åŠ›çªä¸çªå‡ºã€‚æ‰€ä»¥ç¡¬å®åŠ›æ–¹é¢ï¼Œå„ä½å€™é€‰äººéœ€è¦æ‰“ç£¨å¥½è‡ªå·±çš„æŠ€æœ¯é£æ ¼ï¼Œå……åˆ†é˜è¿°ä¸€äº›è‡ªå·±çš„æŠ€æœ¯è´¡çŒ®ï¼Œæ¯”å¦‚è®ºæ–‡ã€ä¸ªäººåšå®¢ã€å¼€æºcommitterä¹‹ç±»çš„å¤´è¡”ã€‚åˆä½œå…±èµ¢æ–¹é¢å¯ä»¥æ˜¯ä¸€å¼ ç™½çº¸ï¼Œä½†è‡ªå·±æ“…é•¿çš„å†…å®¹ä¸€å®šè¦å»ºç«‹å£å’ï¼ŒæŠŠå·¥ä½œçš„å†…å®¹ã€æŠ€æœ¯çš„ç»†èŠ‚æ¯ä¸ªè„‰ç»œéƒ½é¢†ä¼šæ¸…æ¥šï¼Œäº‰å–æˆä¸ºæ­¦åŠ›å€¼æœ€é«˜çš„é‚£ä¸€ä¸ªã€‚</p>
<p>æœ€åå°±æ˜¯é¢è¯•çš„ä¸´åœºè¡¨ç°ã€‚ä½œä¸ºæŠ€æœ¯å²—ä½çš„é¢è¯•å®˜ï¼Œè€ƒè™‘åˆ°æ ¡æ‹›ç”Ÿå®é™…ä¸Šæ˜¯é›¶ç»éªŒçš„ç¤¾æ‹›ç”Ÿï¼Œæˆ‘ä»¬ä¸ä¼šæŠŠå€™é€‰äººç´§å¼ ç»“å·´ï¼Œè¡£ç€ä¸å¾—ä½“ï¼Œæˆ–æ˜¯æ€§æ ¼å†…ç§€ä¹‹ç±»çš„åœºå¤–å› ç´ å½“ä½œå€™é€‰äººçš„ä¸€ç±»ç¼ºç‚¹ï¼ˆå½“ç„¶ä¸åŒå²—ä½æœ‰ä¸åŒè¦æ±‚ï¼‰ï¼Œæ¯”èµ·è¿™äº›ï¼Œæ›´é‡è¦çš„å…³æ³¨ç‚¹è¿˜æ˜¯åœ¨äºï¼Œå‡è®¾ä»¥åå’Œå€™é€‰äººä¸€èµ·å…±äº‹ï¼Œèƒ½ä¸èƒ½è¾¾åˆ°å¾ˆèæ´½çš„æ²Ÿé€šï¼Œèƒ½ä¸èƒ½å…±åŒåä½œï¼Œè¾¾åˆ°åŒèµ¢ã€‚é¢è¯•å®˜æœ‰ä¹‰åŠ¡å»è¥é€ ä¸€ä¸ªè¶³å¤Ÿè½»æ¾ï¼Œè®©å€™é€‰äººå¯ä»¥å°½æƒ…å‘æŒ¥çš„é¢è¯•æ°›å›´ï¼Œå¦‚æœé¢è¯•è¿‡ç¨‹ä¸­ï¼Œå®åœ¨æ²¡æœ‰è¾¾åˆ°è¿™ä¸€ç‚¹ï¼Œé‚£å°±è¯´æ˜åŒæ–¹ä¸å¤§å¥‘åˆã€‚å¯¹äºå„ä½æ ¡æ‹›ç”Ÿè€Œè¨€ï¼Œä¹Ÿè¦æ—¶åˆ»è®°ä½ï¼Œé¢è¯•æ˜¯ä¸€ç§åŒå‘é€‰æ‹©ï¼Œè¦å……åˆ†è®¤è¯†å¹¶å°Šé‡è‡ªå·±å†…å¿ƒçš„çœŸå®æƒ³æ³•ã€‚é€‰æ‹©å¯¹çš„æ–¹å‘ï¼Œå¯¹çš„åŒäº‹ï¼Œå°±æ›´ä½³å®¹æ˜“è·å¾—å¯¹çš„ç»“æœã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>é¢è¯•</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>ä¸ªäººåšå®¢</tag>
        <tag>æ•™ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘é€šè¿‡é™ä½ç”µå‹å’ŒProcess Lassoå·¥å…·ä¼˜åŒ–CPUè¶…é¢‘è¡¨ç°</title>
    <url>/2024/10/16/diymemo/overclock_core/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjQvMTAvMTMvZGl5bWVtby9vdmVyY2xvY2tfdHJ5Lw==" title="https://utmhikari.top/2024/10/13/diymemo/overclock_try/">ä¸Šä¸€ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>å½“ä¸­ï¼Œç¬”è€…ä»‹ç»äº†ä¸€äº›ä½œä¸ºæ–°æ‰‹å°ç™½è¶…é¢‘CPUå’ŒNVIDIAæ˜¾å¡çš„ç»éªŒã€‚ä»Šå¤©åˆæœ‰äº†æ›´æ–°ï¼Œç¬”è€…é€šè¿‡é™ä½CPUå·¥ä½œç”µå‹ï¼Œå¹¶ä¸”ç»“åˆProcess Lassoå¯¹ç¨‹åºåšCPUè°ƒåº¦ä¼˜åŒ–ï¼ŒæˆåŠŸå†ä¸€æ¬¡å‡çº§äº†CPUçš„è¡¨ç°ï¼ŒCS2çš„benchmarkåˆæé«˜äº†50å·¦å³çš„fpsã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« ï¼Œå°±ä»‹ç»ä¸€ä¸‹ç¬”è€…åœ¨è¿™æ–¹é¢çš„ä¸€äº›å®è·µã€‚é…ç½®æ–¹é¢å†å¤è¿°ä¸€æ¬¡ï¼šä¸»æ¿æ˜¯å¾®æ˜Ÿz690åˆ€é”‹tiï¼Œcpuæ˜¯i9-12900kfï¼Œæ•£çƒ­ç”¨çš„è¿½é£è€…å†°çµm25-360ï¼Œgpuæ˜¯3070tiï¼Œå†…å­˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€é™‹çš„ddr4ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯ç”µå‹çš„è°ƒæ•´ï¼Œå¦‚æœç”µå‹è¿‡ä½ï¼Œé‚£ä¹ˆåŠŸç‡å°±ä¼šä½ï¼ŒCPUå®é™…å·¥ä½œçš„æ—¶å€™å°±ä¸ç¨³å®šï¼›å¦‚æœç”µå‹è¿‡é«˜ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šè¿‡çƒ­ï¼Œå¯¼è‡´CPUæ•£çƒ­å‡ºç°é—®é¢˜ã€‚å› ä¸ºç¬”è€…çš„æ•£çƒ­æ¯”è¾ƒæ‰æ€¥ï¼Œæ‰€ä»¥ä¸€ä¸ªå®—æ—¨æ˜¯åœ¨å°½é‡é«˜çš„CPUé¢‘ç‡ä¸‹ï¼Œç”¨å°½é‡ä½çš„ç”µå‹åŒæ—¶ç¡®ä¿è¿è¡Œç¨³å®šã€‚æ‰‹æ³•ä¹Ÿæ˜¯å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9iYnMubmdhLmNuL3JlYWQucGhwP3RpZD0zMDc0MTkzNiZhbXA7cmFuZD0xNzgmYW1wO3JhbmQ9MzUz" title="https://bbs.nga.cn/read.php?tid=30741936&amp;rand=178&amp;rand=353">è¿™ä¸€ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ï¼Œå…ˆç”¨overrideæ’å®šç”µå‹çœ‹æŸé¢‘ç‡ä¸‹ä¸»æ¿é»˜è®¤ç»™çš„ç”µå‹æ˜¯å¤šå°‘ï¼Œç„¶åå†è°ƒæˆadaptive+offsetæ¨¡å¼é™ä½ç”µå‹ï¼Œçœ‹é™ä½åèƒ½ä¸èƒ½æ•£çƒ­OK+è¿è¡Œç¨³å®šã€‚é€šè¿‡ä¸æ–­çš„è°ƒè¯•ï¼Œæœ€ç»ˆä¹Ÿæ˜¯æ‘¸åˆ°äº†ä¸€å¥—æ¯”è¾ƒåˆé€‚çš„å‚æ•°ï¼ŒåŸå…ˆå¤§æ ¸åªèƒ½ç¿åˆ°4.6Ghzï¼Œç°åœ¨èƒ½å‡åˆ°5.0Ghzï¼Œé…å¥—-0.1vçš„offsetï¼Œç”µå‹é™åˆ°1.2vï¼Œaida64çƒ¤10minå¯ä¿æŒç¨³å®šï¼Œæ—¥å¸¸ä½¿ç”¨æš‚æ—¶æ²¡å•¥é—®é¢˜ã€‚å¤§æ ¸5.1Ghzä¸‹ç”µå‹å³ä¾¿é™äº†æ•£çƒ­ä¹ŸæŠµæŠ—ä¸ä½ï¼Œè€Œ5.2Ghzä¸‹æ’å®šç”µå‹å°±1.37vï¼Œä¹Ÿå°±ä¸å¥½å…¼é¡¾æ•£çƒ­å’Œç”µå‹äº†ï¼Œæ²¡æœ‰å†ç»§ç»­è°ƒè¯•ã€‚</p>
<p>ç„¶åæ˜¯Process Lassoï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥è°ƒæ•´ç¨‹åºçš„å·¥ä½œä¼˜å…ˆçº§å’ŒCPUäº²å’Œåº¦ï¼Œå¯¹äºå…·å¤‡å¤§å°æ ¸çš„i9-12900kfæ¥è¯´ï¼Œè¿™ä¸ªå·¥å…·çš„æ„ä¹‰éå¸¸é‡å¤§ã€‚æ¯”å¦‚cs2ï¼Œå°±å¯ä»¥è°ƒæ•´CPUä¼˜å…ˆçº§ä¸ºå®æ—¶ï¼Œäº²å’Œåº¦ç»™åˆ°æ‰€æœ‰å¤§æ ¸ï¼Œå¯åŠ¨é¡¹-threadsè®¾ç½®ä¸ºå¤§æ ¸æ•°é‡+1ï¼Œå¹¶ä¸”å¦‚æœéœ€è¦å±•ç¤ºRTSSå¾—è®¾ç½®-allow_third_party_softwareã€‚è€Œå…¶ä»–æ¯”å¦‚360ä¹‹ç±»çš„æ—¥å¸¸ç¨‹åºï¼Œäº²å’Œåº¦ç»™å°æ ¸ï¼Œä¼˜å…ˆçº§é€‚å½“æ”¾ä½å°±å¯ä»¥ã€‚è¿™æ ·æ¸¸æˆè¿è¡Œå°±èƒ½å……åˆ†è§£æ”¾å¤§æ ¸çš„æ½œåŠ›ï¼Œè¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>è¶…é¢‘</tag>
        <tag>ç¡¬ä»¶</tag>
        <tag>CPU</tag>
        <tag>æ€§èƒ½æµ‹è¯•</tag>
        <tag>Process Lasso</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘æ–°æ‰‹å°ç™½è¶…é¢‘i9-12900kfå’Œ3070tiç»éªŒåˆ†äº«</title>
    <url>/2024/10/13/diymemo/overclock_try/</url>
    <content><![CDATA[<p>æœ€è¿‘cs2æ›´æ–°äº†ä¹‹åï¼Œå› ä¸ºæ€»æ˜¯è§£å†³fpsè¿‡é«˜çš„é—®é¢˜ï¼Œå¯¼è‡´æ¸¸æˆæ€§èƒ½é™çš„éå¸¸æ˜æ˜¾ã€‚ç¬”è€…ç»„çš„è€åœŸæœºå­å…ˆå‰ä¸€ç›´æ²¡æœ‰æè¶…é¢‘ï¼Œç°åœ¨ä¹Ÿä¸å¾—ä¸ç¿ä¸€ä¸‹ä¿è¯æ¸¸æˆèƒ½å¤Ÿç¨å¾®æµç•…çš„è¿ä½œï¼Œæœ€ç»ˆæ¯”ä»¥å‰ç¨å¾®æå‡äº†50fpså·¦å³ï¼Œcs2çš„dust2-benchmarkåœ°å›¾èƒ½å‹‰å¼ºè¾¾åˆ°å¹³å‡400fpsã€‚æœ¬æ–‡å°±åˆ†äº«ä¸€ä¸‹ç¬”è€…åœ¨è¿™å—çš„ç²—æµ…ç»éªŒï¼Œæœ‰ä»€ä¹ˆæŠ€æœ¯æ¦‚å¿µæ€§é—®é¢˜ä¹Ÿéº»çƒ¦å¤§å®¶æŒ‡æ­£ã€‚</p>
<p>é…ç½®æ–¹é¢ï¼Œç¬”è€…ä¸»æ¿æ˜¯å¾®æ˜Ÿz690åˆ€é”‹tiï¼Œcpuæ˜¯i9-12900kfï¼Œæ•£çƒ­ç”¨çš„è¿½é£è€…å†°çµm25-360ï¼Œgpuæ˜¯3070tiï¼Œå†…å­˜æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€é™‹çš„ddr4ï¼Œå½“ç„¶ddr5ä¸»æ¿ä¹Ÿæ²¡æ³•æ”¯æŒï¼Œå¯ä»¥è¯´æ•´ä½“æ˜¯éå¸¸ä¹ä¸äº†ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯cpuçš„è¶…é¢‘ï¼Œæ•´ä½“çš„ç»“è®ºæ˜¯ç¿ä¸åˆ°cpuæœ¬èº«æœ€å¤§çš„5Ghzä»¥ä¸Šï¼Œåªèƒ½æœ‰é™åº¦åœ°ç¿ã€‚è°ƒè¯•çš„è¯ï¼Œä¸€äº›å¤–éƒ¨çš„æ–‡ç« å¯ä»¥å‚è€ƒï¼Œæ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly9iYnMubmdhLmNuL3JlYWQucGhwP3RpZD0zMDc0MTkzNiZhbXA7cmFuZD0xNzg=" title="https://bbs.nga.cn/read.php?tid=30741936&amp;rand=178">è¿™ä¸€ç¯‡<i class="fa fa-external-link"></i></span>ï¼Œè®¾ç½®æ’å®šç”µå‹ï¼Œæ¯æ¬¡è°ƒæ•´é¢‘ç‡åï¼Œçœ‹ç”µå‹ç»™çš„æ€ä¹ˆæ ·ï¼Œå¦‚æœæ’å®šç”µå‹è¶…è¿‡1.3vçš„è¯å·¥ä½œæ¸©åº¦å°±ä¼šä¸Šå»ï¼Œç³»ç»Ÿä¼šä¸ç¨³ï¼Œå¾—è€ƒè™‘æ‰‹åŠ¨è®¾ç½®ç”µå‹offsetè¿™ç§é«˜ç«¯æ“ä½œï¼Œæˆ–è€…æ˜¯é™æœ€é«˜é¢‘è¿™ç±»å°ç™½æ“ä½œã€‚æ„Ÿè§‰æ’å®šç”µå‹å·®ä¸å¤š1.2vå‡ºå¤´ï¼Œç»™çš„okä¹‹åï¼Œå°±å¯ä»¥è¿›ç³»ç»Ÿæ‹¿aida64çƒ¤é¸¡ï¼Œfpuæµ‹è¯•ï¼Œçœ‹æ•£çƒ­èƒ½ä¸èƒ½è·Ÿå¾—ä¸Šï¼Œå¦‚æœç¬é—´99åº¦é‚£å°±å¾—é™é¢‘äº†ï¼Œå¦‚æœä¸æ˜¯çš„è¯å¯ä»¥çœ‹çœ‹ç”µå‹ç»™çš„ä½ä¸ä½ï¼Œcpué¢‘ç‡ç¨³ä¸ç¨³ï¼Œèƒ½ä¸overheatå°±å·®ä¸å¤šå¯ä»¥ç”¨äº†ã€‚ç¬”è€…æœ€ç»ˆè®¾ç½®çš„æ˜¯å¤§æ ¸ç¿46å°æ ¸/ringæ˜¯38ï¼Œçƒ¤é¸¡90åº¦å‡ºå¤´ï¼Œæ•£çƒ­éå¸¸æ‰æ€¥ï¼Œä½†ä¼°è®¡æ—¥å¸¸æ¸©åº¦ä¹Ÿä¸Šä¸å»ï¼Œæ—¶åˆ»æ³¨æ„é£æ‰‡å£°éŸ³å°±è¡Œã€‚æ€»è€Œè¨€ä¹‹ï¼Œå¾—æ‰¾åˆ°ä¸€ä¸ªcpué¢‘ç‡å’Œæ¸©åº¦çš„å¹³è¡¡ã€‚12900kfæœ¬èº«å‘çƒ­æ¯”è¾ƒçŒ›ï¼Œæ•£çƒ­å®¹æ˜“è·Ÿä¸ä¸Šï¼Œåªå¥½è¯´cpué¢‘ç‡å°½å¯èƒ½é«˜ï¼Œæ¸©åº¦å°½å¯èƒ½ç¨³å®šä¸è¿‡çƒ­ï¼Œç„¶åç³»ç»Ÿå°½å¯èƒ½ç¨³å®šï¼Œå°±è¡Œã€‚</p>
<p>å…¶æ¬¡æ˜¯æ˜¾å¡è¶…é¢‘ã€‚ç”±äºç¬”è€…ç”¨çš„æ˜¯å¾®æ˜Ÿä¸»æ¿ï¼Œæ‰€ä»¥é€‰æ‹©ä¸‹è½½å°é£æœºï¼ˆMSI Afterburnerï¼‰ç„¶åæ‰§è¡ŒOC-Scanneråšæ— è„‘è¶…é¢‘å³å¯ï¼Œå‚è€ƒæ–‡æ¡£æ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3JlYWQvY3YzNjkxNzYyOC8=" title="https://www.bilibili.com/read/cv36917628/">è¿™ä¸€ç¯‡<i class="fa fa-external-link"></i></span>ï¼Œæœ€ç»ˆå­˜äº†ä¸€ä¸ªæ˜¾å­˜+200MHzç„¶åæ ¸å¿ƒé¢‘ç‡èµ°ä¸€ä¸ªæ‰«æåçš„æ›²çº¿çš„è®¾ç½®ã€‚è™½ç„¶NVIDIAé‡Œé¢çš„â€œæ¸¸æˆå†…è¦†ç›–â€èƒ½åŠ›ä¹Ÿå¯ä»¥åšåˆ°è¶…é¢‘ï¼Œä½†é£é—»æ•ˆæœæ²¡æœ‰å°é£æœºå¥½ï¼Œæ‰€ä»¥è¿˜æ˜¯ç”¨äº†å°é£æœºæ“ä½œï¼Œæ²¡æœ‰ç”¨æ¸¸æˆå†…è¦†ç›–ã€‚</p>
<p>æœ€ååœ¨è¿™äº›åŸºç¡€ä¸Šä¹Ÿè¿˜æœ‰ç‚¹å¾®è°ƒï¼Œæ¯”å¦‚cpuå…³æ‰è¶…çº¿ç¨‹ï¼Œæ˜¾å¡å»æ‰ä½å»¶æ—¶æ¨¡å¼ä¹‹ç±»ï¼Œè¿™äº›åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMTkvMDkvMjEvZGl5bWVtby9jc2dvLw==" title="https://utmhikari.top/2019/09/21/diymemo/csgo/">ä»¥å‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ä¹Ÿæœ‰èŠè¿‡ã€‚åœ¨cs2å®æµ‹çœ‹åˆ°çš„æ•ˆæœï¼Œæ„Ÿè§‰ç“¶é¢ˆè¿˜æ˜¯åœ¨cpuï¼Œä½†å› ä¸ºæ•£çƒ­è·Ÿä¸ä¸Šï¼Œæ‰€ä»¥åªèƒ½æœ‰é™åœ°ä¼˜åŒ–äº†ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>è¶…é¢‘</tag>
        <tag>ç¡¬ä»¶</tag>
        <tag>CPU</tag>
        <tag>æ˜¾å¡</tag>
        <tag>æ€§èƒ½æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘pyside6ç»˜åˆ¶è¡¨ç›˜å’Œæ•°å­—æ—¶é’Ÿçš„æ–¹æ³•</title>
    <url>/2024/10/13/pythonnotes/pyside6_clocks/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨é‡ç©pyside/pyqtæ¡Œé¢å¼€å‘çš„å†…å®¹ï¼Œè®¡åˆ’åšä¸€äº›æ—¥å¸¸å·¥å…·æ¥è‡ªç”¨ï¼Œé¡ºå¸¦ç»ƒç»ƒæ‰‹ã€‚æ­£å¥½åˆšé‡åˆ°ä¸€ä¸ªé—®é¢˜æ˜¯ç”»æ—¶é’Ÿï¼ˆè¡¨ç›˜+æ•°å­—ï¼‰ï¼ŒæŸ¥äº†å¾ˆå¤šèµ„æ–™éƒ½ç¨å¾®è°ƒè¯•äº†ä¸‹æ‰æœ€ç»ˆè§£å†³ï¼Œæœ¬æ–‡å³åˆ†äº«ä¸€ä¸‹è§£å†³æ–¹æ³•ã€‚</p>
<p>é¦–å…ˆæ˜¯æ•°å­—æ—¶é’Ÿã€‚ç”±äºpyside6æœ¬èº«æœ‰QLCDNumberæ§ä»¶çš„æ”¯æŒï¼Œæ‰€ä»¥ç»˜åˆ¶èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œå®˜ç½‘ä¹Ÿç»™äº†ä¸€ä¸ª<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi9leGFtcGxlcy9leGFtcGxlX3dpZGdldHNfd2lkZ2V0c19kaWdpdGFsY2xvY2suaHRtbA==" title="https://doc.qt.io/qtforpython-6/examples/example_widgets_widgets_digitalclock.html">ä¾‹å­<i class="fa fa-external-link"></i></span>ã€‚ç¬”è€…è‡ªå·±åˆ™åœ¨è¿™ä¸ªåŸºç¡€ä¸Šåšäº†ä¸‹ä¿®æ”¹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PySide6.QtCore <span class="keyword">import</span> QTime, QTimer, Slot</span><br><span class="line"><span class="keyword">from</span> PySide6.QtWidgets <span class="keyword">import</span> QApplication, QLCDNumber</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DigitalClock</span><span class="params">(QLCDNumber)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent=None)</span>:</span></span><br><span class="line">        super().__init__(parent)</span><br><span class="line">        self.setSegmentStyle(QLCDNumber.Flat) <span class="comment"># è®¾ç½®æ˜¾ç¤ºæ ·å¼ï¼Œå¯ä»¥çœ‹å“ªä¸ªæ¯”è¾ƒç¾è§‚</span></span><br><span class="line">        self.setDigitCount(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å®šæ—¶å™¨æ¯ç§’æ›´æ–°</span></span><br><span class="line">        self.timer = QTimer(self)</span><br><span class="line">        self.timer.timeout.connect(self.show_time)</span><br><span class="line">        self.timer.start(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">        self.show_time()</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Slot()</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_time</span><span class="params">(self)</span>:</span></span><br><span class="line">        time = QTime.currentTime()</span><br><span class="line">        text = time.toString(<span class="string">"hh:mm:ss"</span>) <span class="comment"># ç›´æ¥æ ¼å¼åŒ–æ˜¾ç¤ºå³å¯</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Blinking effectï¼Œè§†æƒ…å†µä½¿ç”¨</span></span><br><span class="line">        <span class="comment"># if (time.second() % 2) == 0:</span></span><br><span class="line">        <span class="comment">#     text = text.replace(":", " ")</span></span><br><span class="line"></span><br><span class="line">        self.display(text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>: <span class="comment"># æµ‹è¯•ä»£ç </span></span><br><span class="line">    app = QApplication(sys.argv)</span><br><span class="line">    clock = DigitalClock()</span><br><span class="line">    clock.show()</span><br><span class="line">    sys.exit(app.exec())</span><br></pre></td></tr></table></figure>
<p>è€Œè¡¨ç›˜æ—¶é’Ÿåˆ™ç›¸å¯¹éš¾ä¸€äº›ï¼Œä¸»è¦æ˜¯éœ€è¦æ‹¿åˆ°ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ•ˆæœã€‚ç»è¿‡ä¸€ç•ªå¯»æ‰¾ï¼Œåœ¨<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi9leGFtcGxlcy9leGFtcGxlX2d1aV9hbmFsb2djbG9jay5odG1s" title="https://doc.qt.io/qtforpython-6/examples/example_gui_analogclock.html">è¿™ä¸ªä¾‹å­<i class="fa fa-external-link"></i></span>é‡Œé¢å±•ç¤ºçš„æ•ˆæœæ¯”è¾ƒä¸é”™ã€‚ç¬”è€…ä¹Ÿæ˜¯åœ¨è¿™ä¸ªåŸºç¡€ä¸Šåšäº†ä¸€ç‚¹è°ƒæ•´ï¼Œè¯¦ç»†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PySide6 <span class="keyword">import</span> QtCore, QtGui, QtWidgets</span><br><span class="line"><span class="keyword">from</span> PySide6.QtCore <span class="keyword">import</span> QPoint, QTimer, QTime, Qt</span><br><span class="line"><span class="keyword">from</span> PySide6.QtGui <span class="keyword">import</span> QGuiApplication, QPainter, QPalette, QPolygon</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnalogClock</span><span class="params">(QtWidgets.QWidget)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent=None)</span>:</span></span><br><span class="line">        super(AnalogClock, self).__init__(parent)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># æ¯1sæ›´æ–°ç»˜å›¾</span></span><br><span class="line">        self._timer = QtCore.QTimer(self)</span><br><span class="line">        self._timer.timeout.connect(self.update)</span><br><span class="line">        self._timer.start(<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># ç»˜åˆ¶æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆï¼Œç²—ç»†å½¢çŠ¶å¯ä»¥è°ƒæ•´QPointå‚æ•°</span></span><br><span class="line">        self._hour_hand = QPolygon([</span><br><span class="line">            QPoint(<span class="number">4</span>, <span class="number">14</span>),</span><br><span class="line">            QPoint(<span class="number">-4</span>, <span class="number">14</span>),</span><br><span class="line">            QPoint(<span class="number">-3</span>, <span class="number">-55</span>),</span><br><span class="line">            QPoint(<span class="number">3</span>, <span class="number">-55</span>)</span><br><span class="line">        ])</span><br><span class="line">        self._minute_hand = QPolygon([</span><br><span class="line">            QPoint(<span class="number">4</span>, <span class="number">14</span>),</span><br><span class="line">            QPoint(<span class="number">-4</span>, <span class="number">14</span>),</span><br><span class="line">            QPoint(<span class="number">-3</span>, <span class="number">-85</span>),</span><br><span class="line">            QPoint(<span class="number">3</span>, <span class="number">-85</span>)</span><br><span class="line">        ])</span><br><span class="line">        self._seconds_hand = QPolygon([</span><br><span class="line">            QPoint(<span class="number">1</span>, <span class="number">14</span>),</span><br><span class="line">            QPoint(<span class="number">-1</span>, <span class="number">14</span>),</span><br><span class="line">            QPoint(<span class="number">-1</span>, <span class="number">-90</span>),</span><br><span class="line">            QPoint(<span class="number">1</span>, <span class="number">-90</span>)</span><br><span class="line">        ])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è°ƒè‰²æ¿ï¼Œè°ƒæ•´æ—¶é’ˆã€åˆ†é’ˆã€ç§’é’ˆå’ŒèƒŒæ™¯è‰²</span></span><br><span class="line">        palette = qApp.palette()</span><br><span class="line">        self._background_color = palette.color(QPalette.ColorRole.Base)</span><br><span class="line">        self._hour_color = palette.color(QPalette.ColorRole.Text)</span><br><span class="line">        self._minute_color = palette.color(QPalette.ColorRole.Text)</span><br><span class="line">        self._seconds_color = palette.color(QPalette.ColorRole.Accent)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">paintEvent</span><span class="params">(self, event)</span>:</span>  <span class="comment"># é‡è½½paintEventå‡½æ•°æ¥ç”»å›¾</span></span><br><span class="line">        width = self.width()</span><br><span class="line">        height = self.height()</span><br><span class="line">        side = min(width, height)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> QPainter(self) <span class="keyword">as</span> painter:  <span class="comment"># painteræœ‰å‰åå¤„ç†ï¼Œwithä¸€ä¸‹</span></span><br><span class="line">            <span class="comment"># ç»˜åˆ¶èƒŒæ™¯</span></span><br><span class="line">            painter.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height, self._background_color)</span><br><span class="line">            painter.setRenderHint(QPainter.Antialiasing)</span><br><span class="line">            painter.translate(width / <span class="number">2</span>, height / <span class="number">2</span>)</span><br><span class="line">            painter.scale(side / <span class="number">200.0</span>, side / <span class="number">200.0</span>)</span><br><span class="line"></span><br><span class="line">            time = QTime.currentTime()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># é€šè¿‡setBrushè®¾ç½®ç»˜å›¾é¢œè‰²ï¼Œç»˜åˆ¶æ—¶é’ˆ</span></span><br><span class="line">            painter.setPen(Qt.NoPen)</span><br><span class="line">            painter.setBrush(self._hour_color)</span><br><span class="line">            painter.save()</span><br><span class="line">            painter.rotate(<span class="number">30.0</span> * ((time.hour() + time.minute() / <span class="number">60.0</span>)))</span><br><span class="line">            painter.drawConvexPolygon(self._hour_hand)</span><br><span class="line">            painter.restore()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç»˜åˆ¶å°æ—¶çš„12ç‚¹</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">12</span>):</span><br><span class="line">                painter.drawRect(<span class="number">73</span>, <span class="number">-3</span>, <span class="number">16</span>, <span class="number">6</span>)</span><br><span class="line">                painter.rotate(<span class="number">30.0</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç»˜åˆ¶åˆ†é’ˆ</span></span><br><span class="line">            painter.setBrush(self._minute_color)</span><br><span class="line">            painter.save()</span><br><span class="line">            painter.rotate(<span class="number">6.0</span> * time.minute())</span><br><span class="line">            painter.drawConvexPolygon(self._minute_hand)</span><br><span class="line">            painter.restore()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç»˜åˆ¶ç§’é’ˆï¼Œå¸¦ä¸€ä¸ªé’ˆå¤´</span></span><br><span class="line">            painter.setBrush(self._seconds_color)</span><br><span class="line">            painter.save()</span><br><span class="line">            painter.rotate(<span class="number">6.0</span> * time.second())</span><br><span class="line">            painter.drawConvexPolygon(self._seconds_hand)</span><br><span class="line">            painter.drawEllipse(<span class="number">-3</span>, <span class="number">-3</span>, <span class="number">6</span>, <span class="number">6</span>)</span><br><span class="line">            painter.drawEllipse(<span class="number">-5</span>, <span class="number">-68</span>, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">            painter.restore()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># ç»˜åˆ¶åˆ†é’Ÿçš„60åˆ†</span></span><br><span class="line">            painter.setPen(self._minute_color)</span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">60</span>):</span><br><span class="line">                painter.drawLine(<span class="number">92</span>, <span class="number">0</span>, <span class="number">96</span>, <span class="number">0</span>)</span><br><span class="line">                painter.rotate(<span class="number">6.0</span>)</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>pyside6</tag>
        <tag>æ¡Œé¢åº”ç”¨</tag>
        <tag>æ¸²æŸ“</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘è°ˆç ”å‘æµ‹è¯•äººå‘˜åœ¨AIæ—¶ä»£ä¸­çš„è‡ªæˆ‘æˆé•¿</title>
    <url>/2024/09/16/testlife/ai_era_challenge/</url>
    <content><![CDATA[<p>ç ”å‘æµ‹è¯•ä¸åˆ†å®¶ï¼Œåœ¨AIæ—¶ä»£ï¼ŒLLM/GPTæŠ€æœ¯çš„å†²å‡»ä¹‹ä¸‹ï¼Œä¸è®ºæ˜¯ç ”å‘è¿˜æ˜¯æµ‹è¯•äººå‘˜éƒ½å¯èƒ½ä¼šæ‹…å¿§ï¼ŒAIæ˜¯å¦ä¼šå–ä»£è‡ªå·±çš„å·¥ä½œã€‚ä»ç¬”è€…çš„è§’åº¦çœ‹æ¥ï¼Œè¿™æ ¹æœ¬ä¸æ˜¯ä¸€ä¸ªéœ€è¦æ‹…å¿ƒçš„é—®é¢˜ï¼Œå°±å’Œå›´æ£‹ä¸€æ ·ï¼Œåœ¨AlphaGoä¹‹åï¼Œå¤§å®¶éƒ½ä¼šåˆ©ç”¨AIæ¥å­¦ä¹ å›´æ£‹ï¼Œè¶…è¶Šä»¥å‰æ—¶ä»£çš„äººã€‚è€Œä½œä¸ºç ”å‘æˆ–è€…æµ‹è¯•äººå‘˜çš„ä½ ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨AIæŠ€æœ¯çš„äº§ç‰©ï¼Œå®ç°è¿›ä¸€æ­¥çš„è‡ªæˆ‘æå‡ã€‚</p>
<p>ä»Šå¤©ï¼Œç¬”è€…å†³å®šç®€å•èŠä¸€ä¸‹ï¼ŒAIæ—¶ä»£ä¸‹ï¼Œç ”å‘æµ‹è¯•äººå‘˜å®ç°è‡ªæˆ‘æˆé•¿çš„ä¸€äº›æ–¹æ³•ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆéœ€è¦è®¤è¯†å½“å‰æµè¡Œçš„AIæŠ€æœ¯ï¼Œæœ¬è´¨çš„æé™åœ¨å“ªé‡Œã€‚ä»¥ChatGPTç±»å·¥å…·ä¸ºä¾‹ï¼ŒLLMå†å¤§ä¹Ÿæ˜¯äººç±»çŸ¥è¯†çš„ç»“æ™¶ï¼Œä¸Šçº¿ä¸ä¼šè¶…è¶Šäººç±»æ•´ä½“çš„æ™ºæ…§ï¼Œä½†ç»“åˆGPTå¯¹è¯æŠ€æœ¯ï¼Œä¸€æ˜¯èƒ½å¤Ÿå…·å¤‡çŸ¥è¯†ç”Ÿæˆèƒ½åŠ›ï¼ŒäºŒæ˜¯å…·å¤‡æ¯”å•ä¸ªäººç±»æ›´å¤§çš„ç®—åŠ›ï¼Œå› æ­¤è¿™ç±»æ•ˆç‡å·¥å…·å¯ä»¥è§£å†³è®¸å¤šè‡ªå·±å·¥ä½œä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚æŸ¥è¯¢æŸç±»å…«è‚¡æ–‡çŸ¥è¯†ï¼Œç”Ÿäº§ä¸€äº›æ–‡æ¡ˆå›¾ç‰‡å¤§çº²ï¼Œç”šè‡³æ—¥å¸¸èŠèŠäººç”Ÿï¼Œè¡¥å……æƒ…ç»ªä»·å€¼ï¼Œéƒ½æ˜¯å¯ä»¥çš„åšæ³•ã€‚</p>
<p>è¿™é‡Œé‡ç‚¹æ˜¯ï¼Œéœ€è¦ä¸“æ³¨äºè‡ªå·±çš„éœ€æ±‚ï¼Œçº³AIä¸ºå·±ç”¨ï¼Œè€Œä¸æ˜¯è¢«å…«è‚¡æ–‡ç©ï¼Œè¢«promptç©ï¼Œè¢«å¤æ‚ä¸çŸ¥é“å“ªé‡Œä¸‹æ‰‹çš„AIç†è®ºç©ã€‚æ¯”å¦‚è¯´ä»Šå¤©è¿™ä¸ªå‘½é¢˜ï¼Œå¦‚æœé‡åˆ°äº†ï¼Œä¸å¦¨é—®é—®GPTï¼Œçœ‹ä¸€ä¸‹GPTè‡ªå·±èƒ½å¤Ÿæç‚¼å‡ºä»€ä¹ˆç»“è®ºã€‚GPTç»™å‡ºçš„ç­”æ¡ˆå¯èƒ½ä¼šæœ‰é‚£ä¹ˆä¸€äº›ï¼šé¢†åŸŸæ·±è€•ã€å‘å±•è½¯æŠ€èƒ½ã€å…³æ³¨AIæ— æ³•æ›¿ä»£çš„é¢†åŸŸï¼Œä»¥åŠæŒç»­å¹¿æ³›å­¦ä¹ ç­‰ç­‰æ–¹å¼ï¼Œè¿™äº›ç­”æ¡ˆè™½ç„¶æ¯”è¾ƒæµ…å°è¾„æ­¢ï¼Œåªæä¾›å¤§æ–¹å‘ï¼Œä¸æä¾›å…·ä½“æ‰§è¡Œçš„æ–¹æ³•ï¼Œä½†è‡³å°‘æœ‰å‚è€ƒçš„ä»·å€¼ï¼Œæ¯•ç«Ÿé€‰æ‹©é¢˜æ¯”å¼€æ”¾é¢˜æ›´åŠ å¥½åšã€‚</p>
<p>è¦è‡ªæˆ‘æˆé•¿ï¼Œè¿˜æ˜¯å¾—å…ˆæ‹†è§£è‡ªå·±çš„éœ€æ±‚ç›®æ ‡ï¼Œå¤šé—®è‡ªå·±å‡ ä¸ªé—®é¢˜ï¼ŒæŠŠä¸œè¥¿éƒ½æŠ›å‡ºæ¥ã€‚æ¯”å¦‚ä½ æ˜¯ä¸€ä¸ªæµ‹è¯•å¼€å‘ï¼Œåœ¨èŒä¸šå‘å±•ä¸Šå¯ä»¥å¤šæƒ³æƒ³è¿™äº›ï¼Œä»¥ååšç®¡ç†è¿˜æ˜¯åšæŠ€æœ¯ï¼ŒåšæŠ€æœ¯åšä»€ä¹ˆæ–¹å‘çš„æŠ€æœ¯ï¼Œè¦åšç²¾å‡†æµ‹è¯•çš„è¯å¹¿åº¦è¦†ç›–å“ªäº›åœºæ™¯ï¼Œæ·±åº¦ç²¾å‡†åˆ°ä»€ä¹ˆå±‚æ¬¡ï¼Œä»€ä¹ˆæŒ‡æ ‡æ¥è¡¡é‡å¥½åï¼Œæ€æ ·è®ºè¯ç²¾å‡†æµ‹è¯•æå‡äº†äº§å“ç ”å‘çš„è´¨é‡ï¼Œåç»­å›¢é˜Ÿå¦‚æœäººå¤šäº†ï¼Œéœ€è¦å¦‚ä½•åˆ†å·¥ï¼Œåœ¨ç¡®ä¿å›¢é˜Ÿçš„äº§å‡ºçš„åŒæ—¶ï¼Œä¿è¯å¤§å®¶çš„å·¥ä½œç§¯ææ€§å’Œè‡ªæˆ‘æˆé•¿ã€‚ç„¶åæ‰æ˜¯ï¼Œè§£å†³è¿™äº›é—®é¢˜ï¼Œæ€ä¹ˆå»åˆ‡å…¥AIã€‚æ¯”æ–¹è¯´æŠ€æœ¯ç±»é—®é¢˜çš„è§£å†³ï¼Œæœ‰è¿™å‡ ç§å¯èƒ½æ€§ï¼š</p>
<ul>
<li>ç²¾å‡†æµ‹è¯•ï¼šç›´æ¥é€šè¿‡LLMåˆ†æå˜æ›´ä»£ç å«ä¹‰ï¼Œå®šä½åˆ°å…·ä½“çš„ç”¨ä¾‹æˆ–è€…è‡ªä¸»ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šé€šè¿‡ä»£ç åˆ†æè‡ªåŠ¨ç”Ÿæˆå•æµ‹ç”¨ä¾‹ï¼Œå‡å°‘ç”¨ä¾‹ç¼–å†™çš„ç ”å‘æˆæœ¬</li>
<li>SRE/åŸºç¡€æ¶æ„ï¼šé€šè¿‡ç»“åˆAIå®šä½åˆ†æçº¿ä¸Šé—®é¢˜ï¼Œæä¾›é—®é¢˜åˆ†æå’Œåº”æ€¥è§£å†³æ–¹æ¡ˆ</li>
<li>DevOpsè´¨é‡ï¼šé€šè¿‡åˆ†æå˜æ›´å†…å®¹å’Œçº¿ä¸ŠæœåŠ¡æŒ‡æ ‡/å‘Šè­¦å˜åŒ–ï¼Œæ¨æ–­é—®é¢˜æˆå› å’Œå˜æ›´å¼‚å¸¸ä¸¥é‡åº¦</li>
</ul>
<p>æ‹†åˆ†äº†å…·ä½“æ–¹å‘ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯çœ‹å“ªäº›æ˜¯è‡ªå·±åšï¼Œå“ªäº›æ˜¯è‡ªå·±å¸¦çš„äººåšï¼Œæˆ–è€…æ˜¯ç¬¬ä¸‰æ–¹å·²æœ‰èƒ½åŠ›å¯ä»¥æä¾›ï¼Œå¯ä»¥é€šè¿‡æ²Ÿé€šåˆä½œè¾¾åˆ°ç›®çš„ã€‚è¿™æ ·ï¼Œè§£å†³äº†ä¸€ä¸ªåˆä¸€ä¸ªçš„é—®é¢˜ï¼Œè‡ªå·±çš„è§†è§’çˆ¬åˆ°æ›´é«˜ï¼Œè‡ªç„¶å¯ä»¥ä½“ä¼šåˆ°è‡ªå·±çš„æˆé•¿ã€‚</p>
<p>æœ€åï¼ŒAIæ˜¯äººé€ çš„ï¼Œç¤¾ä¼šè§„åˆ™ä¹Ÿæ˜¯äººé€ çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿‡ä»½æ‹…å¿§AIï¼Œä¸è¦æ‹…å¿§MOSSä¼šä¸ä¼šè¢«é€ å‡ºæ¥ï¼Œæ¯”èµ·æ‹…å¿§ç¤¾ä¼šï¼Œæ›´åº”è¯¥æ‹…å¿§è‡ªå·±ï¼Œé€‚å½“é€¼ä¸€ä¸‹è‡ªå·±ã€‚æå®šäººï¼Œæå®šäº‹ï¼Œè‡ªç„¶å¯ä»¥æˆé•¿ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>æ•ˆç‡å·¥å…·</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>LLM</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘åˆ†äº«ä¸€äº›è®©ç¼–ç¨‹å·¥ä½œæ•ˆç‡ç¿»å€çš„å®ç”¨å·¥å…·</title>
    <url>/2024/09/15/diymemo/code_tools/</url>
    <content><![CDATA[<p>å¯¹äºä¸€ä¸ªç¨‹åºå‘˜è€Œè¨€ï¼Œæ‹¥æœ‰ä¸€å¥—åˆç†çš„ç¼–ç¨‹å·¥å…·é›†ï¼Œä¾¿å¯ä»¥è®©ç¼–ç¨‹å·¥ä½œäº‹åŠåŠŸå€ã€‚æœ¬ç¯‡æ–‡ç« å°±åˆ†äº«ä¸‹ç¬”è€…å½“å‰ä½¿ç”¨çš„ä¸€äº›å®ç”¨ææ•ˆçš„ç¼–ç¨‹å‘¨è¾¹å·¥å…·ã€‚</p>
<p>é¦–å…ˆéœ€è¦å£°æ˜çš„æ˜¯ï¼ŒDIYä¸€å¥—ç¼–ç¨‹å·¥å…·ï¼Œä¸€å®šéœ€è¦è´´åˆè‡ªå·±çš„å·¥ä½œæˆ–è€…ç”Ÿæ´»éœ€æ±‚ã€‚å¥½æ¯”è¯´ï¼Œä½ æ˜¯å‰ç«¯ï¼Œä½ æ˜¯åç«¯ï¼Œæˆ–è€…ä½ æ˜¯æå®‰å“iOSå®¢æˆ·ç«¯çš„ï¼Œæå›¾å½¢å­¦æ¸²æŸ“çš„ï¼Œé‚£è‚¯å®šç”¨åˆ°çš„å·¥å…·éƒ½ä¸ä¸€æ ·ã€‚ç¬”è€…ä¸»è¦å·¥ä½œæ˜¯äº’è”ç½‘åç«¯æ–¹å‘ï¼Œä¹Ÿå…¼é¡¾ä¸€äº›å‰ç«¯å¼€å‘ã€æ¡Œé¢å·¥å…·ä¹‹ç±»çš„å…¨æ ˆå¼€å‘å†…å®¹ï¼Œä¸€èˆ¬ç”¨Macbookåšå¼€å‘ï¼Œè€Œä¸æ˜¯åƒæ¸¸æˆç¨‹åºå‘˜ä¸€æ ·ç”¨Windowsæ¯”è¾ƒå¤šã€‚æ‰€ä»¥æœ¬æ–‡åˆ†äº«çš„ä¸€äº›å·¥å…·ï¼Œè™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒæ™®ç½—å¤§ä¼—ï¼Œä½†ä¹Ÿæœ‰ä¸€å®šçš„å€¾å‘æ€§ã€‚</p>
<a id="more"></a>
<p>ç„¶åçœ‹IDEï¼Œè¿™éƒ¨åˆ†ç¬”è€…é€‰ç”¨çš„ç»„åˆæ˜¯GoLand+PyCharm+VSCodeã€‚å¯¹äºpythonç¼–ç¨‹æ— éœ€å¤šè®²ï¼Œå¦‚æœä¸æ˜¯ä¸€äº›ç§‘ç ”ç®—æ³•ç”¨é€”çš„è¯ï¼ŒPyCharmæ˜¯æœ€ä¸ºæ— è„‘çš„é€‰æ‹©ã€‚å¯¹äºGoç¼–ç¨‹è€Œè¨€ï¼ŒGoLandæ¯”VSCodeçš„ä¸€ç‚¹å¥½å¤„æ˜¯GoLandé…ç½®Goå¼€å‘ç¯å¢ƒï¼ˆGOROOTã€Proxyä¹‹ç±»ï¼‰æ›´åŠ æ–¹ä¾¿ï¼Œå½“ç„¶PyCharmä¹Ÿæ˜¯è¿™ä¸ªä¼˜åŠ¿ï¼ŒVSCodeåˆ™æœ‰ä¸€äº›å­¦ä¹ æˆæœ¬ã€‚ä¸‡èƒ½çš„VSCodeæ˜¯ç”¨æ¥å…œåº•çš„ï¼ŒVSCodeå¯ä»¥ç”¨æ¥åšå‰ç«¯å¼€å‘ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥ä¸´æ—¶reviewä»£ç ï¼Œæ¯”èµ·é‡ç ”å‘è¿‡ç¨‹çš„JetBrainså…¨å¥—æ¥è¯´ï¼ŒVSCodeæ›´åŠ ä¸“å±äºç¨‹åºå‘˜æ—¥å¸¸çš„éœ€è¦ã€‚</p>
<p>æ’ä»¶æ–¹é¢ï¼Œé¦–å…ˆè¦æå‡ä»£ç ç¼–å†™æ•ˆç‡ï¼Œéœ€è¦ä¸€ä¸ªå®ç”¨çš„AIä»£ç è¡¥å…¨å·¥å…·ï¼Œæ¯”å¦‚é€šä¹‰çµç ã€æ–‡å¿ƒä¸€è¨€ç­‰ï¼Œå¯ä»¥éšæ„åœ¨<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC82NzIxNjA5NDM=" title="https://zhuanlan.zhihu.com/p/672160943">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­æŒ‘ä¸€ä¸ªå…è´¹çš„ã€‚è¿™æ ·çš„è¯ï¼Œåƒåå°ç¡¬ç¼–ç ä¸€äº›é…ç½®ï¼Œæ¶‰åŠåˆ°é‡å¤æ€§å·¥ä½œï¼Œåœ¨Golangã€Pythonæ²¡æœ‰å®å»å‡å°‘ç¼–ç é‡çš„æƒ…å†µä¸‹ï¼ŒAIè‡ªåŠ¨è¡¥å…¨å°±å¯ä»¥æ˜¾è‘—å‘æŒ¥ä½œç”¨ã€‚ç„¶åå°±æ¯”è¾ƒè§ä»è§æ™ºï¼Œæ¯”å¦‚å½©è™¹æ‹¬å·ä¹‹ç±»çš„ä»£ç é«˜äº®çš„æ’ä»¶å¯ä»¥æŒ‰éœ€å®‰è£…ï¼Œç”¨äºç”Ÿæˆgitignoreä¹‹ç±»çš„ignoreæ’ä»¶ä¹Ÿæ˜¯å¿…å¤‡ï¼Œç„¶åä¸€äº›eslintä¹‹ç±»çš„å‰ç«¯è§„èŒƒç±»æ’ä»¶ã€å·¥ä½œç”¨åˆ°çš„æœåŠ¡éƒ¨ç½²ã€ç¯å¢ƒé…ç½®ç±»æ’ä»¶ä¹Ÿçœ‹ç€æ¥ã€‚å¦‚æœæ˜¯è„‘åŠ›æ‰€åŠï¼Œæ¯”å¦‚å¾ˆç†Ÿæ‚‰æŸäº›shellã€gitå‘½ä»¤ï¼Œå°±ä¸éœ€è¦è£…å¤ªå¤šçš„æ’ä»¶ï¼›å¦‚æœè„‘åŠ›ä¸å¤Ÿï¼Œæ¯”å¦‚é‡å¤æ€§åŠ³åŠ¨è¿™ç§ï¼Œå°±å¯ä»¥çœ‹çœ‹æœ‰æ²¡æœ‰é€šè¿‡æ’ä»¶å»æ”¹å˜ç°çŠ¶çš„å¯èƒ½ã€‚</p>
<p>ä¹‹åçœ‹æ–‡æœ¬ç¼–è¾‘å™¨ã€‚é¦–å…ˆæƒ³åˆ°çš„è¿˜æ˜¯VSCodeï¼Œä½†VSCodeåœ¨ç¬”è€…è¿™é‡Œå·²ç»æ˜¯ä¸€ä¸ªIDEäº†ï¼Œæ‰€ä»¥æ›´åŠ éœ€è¦ä¸€ä¸ªè½»é‡çº§çš„å·¥å…·ã€‚å¯¹äºWindowså¼€å‘è€Œè¨€Notepad++ä¸€åº¦æ˜¯æœ€æ— è„‘çš„é€‰æ‹©ï¼Œä½†å› ä¸ºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œé€‰ç”¨ä¸€ä¸ªæ›´åŠ æœ‰å‰é€”çš„æ–‡æœ¬ç¼–è¾‘å™¨ä¼šæ›´å¥½ï¼Œå¹³æ›¿çš„æ¯”å¦‚SublimeTextç ´è§£ç‰ˆã€Notepadâ€“ä»¥åŠNotepad3ä¹‹ç±»ã€‚MacOSçš„è¯ï¼Œç¬”è€…ç”¨çš„æ˜¯CotEditorï¼ŒAppStoreé‡Œå°±å¯ä»¥å®‰è£…ï¼ŒåŸºæœ¬ä¸Šæ»¡è¶³å¹³å¸¸çœ‹æ–‡æœ¬ã€æ‰“è‰ç¨¿ã€åšjsonè½¬æ¢ï¼ˆéœ€è¦è‡ªå®šä¹‰è„šæœ¬ï¼‰ä¹‹ç±»çš„éœ€è¦ï¼Œéå¸¸å®ç”¨ã€‚CotEditorä¸€ä¸ªç¾ä¸­ä¸è¶³çš„æ˜¯æ‰“å¼€éå¸¸å¤§çš„æ–‡æœ¬æ¯”è¾ƒåƒåŠ›ï¼Œè¿™ä¸ªæ—¶å€™å°±å¾—ç”¨MacOSé»˜è®¤çš„æ–‡æœ¬ç¼–è¾‘æˆ–è€…vimæ¥æ»¡è¶³æŸ¥å¤§æ–‡ä»¶çš„éœ€è¦äº†ã€‚</p>
<p>æåˆ°vimï¼Œè¿™é‡Œæƒ³è¯´ï¼Œç¬”è€…å¹¶évimçš„èµ„æ·±ç©å®¶ï¼Œä¹Ÿåªæ˜¯æœ‰éœ€è¦é‡‡ç”¨ã€‚vimçš„å¯æ‰©å±•æ€§å¾ˆå¼ºï¼Œå¦‚æœå¤§å®¶è‡ªå·±æƒ³æŠŠvimæ‰“é€ æˆç‹¬ä¸€æ— äºŒçš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç”šè‡³æ˜¯IDEï¼Œä¹Ÿæ˜¯å¯å–çš„ã€‚å¯¹äºæ–°æ‰‹ç©å®¶æ¥è¯´ï¼Œç¬”è€…è¿˜æ˜¯æ¨èæ ¹æ®å…·ä½“å·¥ä½œåœºæ™¯ï¼Œèµ°æœ€ç•…é”€æœ€æ— è„‘çš„é€‰æ‹©ï¼Œè¿™æ ·å­æ³¨æ„åŠ›æ‰èƒ½é›†ä¸­åœ¨ç”Ÿäº§ä¸Šï¼Œvimçš„è¯<span class="exturl" data-url="aHR0cHM6Ly9ydWFueWlmZW5nLmNvbS9ibG9nLzIwMTgvMDkvdmltcmMuaHRtbA==" title="https://ruanyifeng.com/blog/2018/09/vimrc.html">å…¥é—¨<i class="fa fa-external-link"></i></span>ä¸€ä¸‹å°±å¯ä»¥ã€‚</p>
<p>ç»ˆç«¯å·¥å…·çš„è¯ï¼Œç¬”è€…ç”¨çš„æ˜¯iTerm2å¸¦ä¸Š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29obXl6c2gvb2hteXpzaA==" title="https://github.com/ohmyzsh/ohmyzsh">OhMyZsh<i class="fa fa-external-link"></i></span>å’Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JvbWthdHYvcG93ZXJsZXZlbDEwaw==" title="https://github.com/romkatv/powerlevel10k">powerlevel10k<i class="fa fa-external-link"></i></span>ï¼Œå°±å¯ä»¥æ‰“é€ ä¸€ä¸ªç®€å•èˆ’é€‚çš„ç»ˆç«¯ç•Œé¢ï¼Œé…ç½®æ–¹å¼ç½‘ä¸Šä¹Ÿæœ‰ä¸€å¤§å †ï¼Œä¸å†èµ˜è¿°ã€‚</p>
<p>é‡è¦çš„ä¸€ä¸ªäº‹æƒ…æ˜¯ï¼Œæ¡Œé¢å¯ä»¥å¤‡ä¸€æ¬¾AIæ£€ç´¢å¯¹è¯ç±»å·¥å…·ï¼Œç”¨æ¥ä»£æ›¿stackoverflowåšæ—¥å¸¸æŠ€æœ¯æŸ¥è¯¢å·¥ä½œï¼Œè¿™æ ·ä¹Ÿèƒ½å¤Ÿæå‡å¾ˆå¤šå·¥ä½œæ•ˆç‡ã€‚æœ‰ç§‘å­¦ä¸Šç½‘çš„è¯å¯ä»¥ç”¨poeï¼Œå®¶ç”¨çš„è¯æ¯”è¾ƒæ¨èæ™ºæ™®æ¸…è¨€ï¼Œå…è´¹è€Œä¸”åŸºæœ¬å¯ä»¥æ»¡è¶³æ—¥å¸¸ç¼–ç éœ€æ±‚ã€‚</p>
<p>æœ€åè¿˜æ˜¯è¦æä¸€å˜´ï¼Œå®ç”¨çš„ç¼–ç¨‹å·¥å…·è¿œè¿œä¸æ­¢ç¬”è€…æåˆ°çš„è¿™äº›ï¼Œä½†å¦‚æœç²¾åŠ›ä¸æ‰€åŠï¼Œæ²¡æœ‰æ—¶é—´å»å­¦ä¹ ç†Ÿæ‚‰çš„è¯ï¼Œè£…å†å¤šçš„æ’ä»¶åå€’ä¼šå‡å°‘è‡ªå·±çš„ä¸“æ³¨ã€‚æ‰€ä»¥é‡è¦çš„ï¼Œè¿˜æ˜¯æ‰¾åˆ°è‡ªå·±æœ€çœŸå®çš„éœ€æ±‚ï¼Œè®©è‡ªå·±ä¸“æ³¨äºæœ€é‡è¦çš„å·¥ä½œä¸­ï¼Œæ‰èƒ½å¤Ÿæ˜¾è‘—æå‡ç¼–ç¨‹æ•ˆç‡ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>Jetbrains</tag>
        <tag>IDE</tag>
        <tag>æ•ˆç‡å·¥å…·</tag>
        <tag>ä»£ç é«˜äº®</tag>
        <tag>shell</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘åˆ†äº«ä¸‹è‡ªå·±å¯¹äºå¹³è¡¡æ—¥å¸¸å·¥ä½œå’Œå­¦ä¹ æå‡çš„è§‚ç‚¹</title>
    <url>/2024/08/17/testlife/work_and_study/</url>
    <content><![CDATA[<p>æ—¥å¸¸å·¥ä½œæ€»æ˜¯çç¢çš„ï¼Œå°¤å…¶æ˜¯æŠ€æœ¯å²—ï¼Œæ²‰æµ¸åœ¨æ—¥å¸¸çš„éœ€æ±‚å¼€å‘ã€éœ€æ±‚æµ‹è¯•å’Œbugfixé‡Œï¼Œå¾ˆå®¹æ˜“å¯¹å·¥ä½œç¯å¢ƒå½¢æˆä¾èµ–ï¼Œå¯¼è‡´æ²¡æœ‰æˆé•¿ç©ºé—´ã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ï¼Œæ€ä¹ˆæ ·å»å¹³è¡¡æ—¥å¸¸å·¥ä½œå’Œè‡ªæˆ‘çš„å­¦ä¹ æå‡å‘¢ï¼Ÿä»Šå¤©ï¼Œç¬”è€…å°±é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œåˆ†äº«ä¸‹è‡ªå·±çš„è§‚ç‚¹ã€‚</p>
<p>æ ¸å¿ƒçš„æ€æƒ³æ˜¯ï¼šå·¥ä½œåªæ˜¯ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ï¼Œè¦è‡ªå·±æŒæ§è‡ªå·±çš„ç”Ÿæ´»ï¼Œä¸è¦è®©å·¥ä½œæŒæ§è‡ªå·±çš„ç”Ÿæ´»ã€‚è¦ç›¸ä¿¡è‡ªå·±çš„ç›´è§‰ï¼Œä¸è¦è¿‡åˆ†æ¶ˆè€—è‡ªå·±ï¼ŒåšæŒå»åšè‡ªæˆ‘æå‡çš„äº‹æƒ…ï¼Œæ— è®ºæ˜¯ä¸æ˜¯é€šè¿‡å·¥ä½œå»å®ç°ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è‡ªå·±çœŸå®çš„æå‡éœ€æ±‚ã€‚èµšé’±ã€æŠ€æœ¯å½±å“åŠ›ï¼Œè¿™äº›éƒ½æ˜¯ä½œä¸ºæŠ€æœ¯äººå¯ä»¥è‡ªæˆ‘æå‡çš„ç‚¹ã€‚ä»å·¥ä½œçš„è§’åº¦ï¼Œèµšé’±æ˜¯æœ€ç»ˆç›®çš„ï¼Œä½†æ˜¯æŠ€æœ¯ä¸Šçš„æˆæœå’Œå½±å“åŠ›ï¼Œä¸ä»…æ˜¯å€¼å¾—æŠ•å…¥çš„ä¸­é—´äº§ç‰©ï¼Œè€Œä¸”åœ¨ç¤¾ä¼šç”Ÿæ´»å½“ä¸­ä¹Ÿèƒ½å¤Ÿä½“ç°ä»·å€¼ã€‚è¿™å…¶ä¸­ï¼Œå°±ä¼šæ¶‰åŠåˆ°ä¸¤è€…ä¹‹é—´çš„å¹³è¡¡ã€‚æ‰€ä»¥ç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯ï¼Œå…ˆå»æ€è€ƒè‡ªå·±çœŸå®éœ€æ±‚æ˜¯ä»€ä¹ˆï¼Œæ˜¯èµšé’±ï¼Œæ˜¯å½±å“åŠ›ï¼Œè¿˜æ˜¯ä¸¤æ‰‹éƒ½è¦æŠ“ï¼Ÿå†³å®šä¸€ä¸ªå¤§æ¦‚çš„æ–¹å‘ï¼Œç„¶åå†ä¸‹æ‰‹å»å†³ç­–ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬å†å»æ€è€ƒå·¥ä½œå’Œç”Ÿæ´»çš„è¾©è¯å…³ç³»ã€‚è€ƒè™‘å·¥ä½œè¿™ä¸ªäº‹æƒ…ï¼Œå·¥ä½œå½“ä¸­æˆ‘ä»¬ä¼šé‡åˆ°å¾ˆå¤šæŠ€æœ¯éš¾é¢˜ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªå»è§£å†³äº†ï¼Œè¿™æ ·å¯ä»¥æå‡æˆ‘ä»¬çš„æŠ€æœ¯ç¡¬å®åŠ›ï¼›é‡åˆ°å¾ˆå¤šè·¨éƒ¨é—¨æ²Ÿé€šçš„åœºæ™¯ï¼Œæˆ‘ä»¬å‡ºæ‰‹å»åè°ƒè§£å†³äº†ï¼Œè¿™æ ·å¯ä»¥æå‡æˆ‘ä»¬çš„ç¤¾ä¼šç”Ÿå­˜èƒ½åŠ›ï¼›æŠŠä¸€ä¸ªæŠ€æœ¯æˆæœåšå‡ºæ¥äº†ï¼Œè·å¾—äº†é«˜é¢çš„æŠ¥é…¬ï¼Œè¿™æ ·å°±å¯ä»¥èµšæ›´å¤šçš„é’±ã€‚æ‰€ä»¥æ•´ä½“æ¥è®²ï¼Œå·¥ä½œè¿™ä»¶äº‹æƒ…ï¼Œç†è®ºä¸Šæ˜¯æœ‰è‡ªæˆ‘å­¦ä¹ æå‡ä»¥åŠç¤¾ä¼šä»·å€¼æå‡çš„æ½œåŠ›çš„ã€‚</p>
<p>ä½†æ˜¯ï¼Œä»æœ€ç»ˆç›®çš„æ¥è®²ï¼Œå·¥ä½œä¹Ÿæ˜¯å…·æœ‰å±€é™æ€§çš„ã€‚æŠ›å¼€å·¥ä½œè¿™ä¸ªäº‹æƒ…ï¼Œå¦‚æœæƒ³èµšé’±ï¼Œé‚£ä¹ˆä¸ä»…ä»…æ˜¯é€šè¿‡æŠ€æœ¯çš„æ‰‹æ®µå¯ä»¥èµšï¼Œè¿˜æœ‰å¾ˆå¤šå…¶å®ƒçš„æ‰‹æ®µå¯ä»¥å‘æ˜ï¼Œå¼€ç½‘åº—ã€åšç›´æ’­ã€å†™å°è¯´ï¼Œéƒ½å¯ä»¥æˆä¸ºèµšé’±çš„æ‰‹æ®µï¼›æŠ€æœ¯å½±å“åŠ›æ–¹é¢ï¼Œå•çº¯çš„å·¥ä½œå¾ˆå¤šåœºæ™¯ä¸‹åªèƒ½æå‡è‡ªå·±çš„å†…éƒ¨å½±å“åŠ›ï¼Œåªæœ‰ä¸»åŠ¨å»å‘åšå®¢ã€å‘æ•™ç¨‹ï¼Œç»“åˆä¸€äº›å®£å‘æ‰‹æ®µï¼Œæ‰èƒ½å¤Ÿæ›´è¿›ä¸€æ­¥æå‡è‡ªå·±çš„å¤–éƒ¨å½±å“åŠ›ã€‚</p>
<p>è¿™æ ·çœ‹ä¸‹æ¥ï¼Œå·¥ä½œä¹‹å†…å’Œå·¥ä½œä¹‹å¤–ï¼Œéƒ½å¹¶ä¸èƒ½ç›´æ¥è¯´å“ªä¸ªäº‹æƒ…å¯¹è‡ªå·±æœªæ¥ç”Ÿæ´»æ›´å¥½ï¼Œä½†æœ‰ä¸€ç‚¹å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œå·¥ä½œçš„å¾ˆå¤šäº‹æƒ…æ˜¯æˆ‘ä»¬è‡ªå·±ä¸å¯æ§çš„ï¼Œè€Œå·¥ä½œä¹‹å¤–çš„äº‹æƒ…ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†æŒ‰ç…§è‡ªå·±çš„æ„æ„¿å»æŠ•å…¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨å·¥ä½œä¹‹å†…çš„ä¸å¯æ§çš„äº‹æƒ…ï¼Œè¿™äº›äº‹æƒ…çš„å‘å±•å¯¹æˆ‘ä»¬æœªæ¥çš„æå‡æ˜¯æœ‰ç›Šçš„è¿˜æ˜¯æœ‰å®³çš„ã€‚å¦‚æœæœ‰ç›Šï¼Œå·¥ä½œå¯ä»¥å¸¦æ¥è‡ªæˆ‘æŠ€æœ¯æå‡ã€äººè„‰å‡çº§ï¼Œé‚£ä¹ˆå¯ä»¥èŠ±æ—¶é—´æŠ•å…¥ï¼›å¦‚æœæœ‰å®³ï¼Œç›´è§‰ä¸Šä»¤äººå†…è€—ï¼Œé‚£ä¹ˆåº”è¯¥è€ƒè™‘å¦å¯»ä»–è·¯ï¼Œæˆ–è€…é¢„å¤‡åæ‰‹ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œåšæµ‹è¯•ï¼Œåšè´¨é‡ï¼Œå³ä¾¿æ˜¯åœ¨åŒä¸€ä¸ªé¢†åŸŸï¼Œå·¥ä½œçš„å†…å®¹ã€æŠ€æœ¯æ·±åº¦ã€èŒè´£scopeç­‰æ–¹é¢ï¼Œéƒ½ä¼šæœ‰éå¸¸å¤§çš„å·®å¼‚ã€‚æœ€åŸºç¡€çš„å·¥ä½œæ˜¯ç‚¹ç‚¹ç‚¹è½¯ä»¶æµ‹è¯•ï¼Œå¾€ä¸Šé¢å°±æ˜¯å»åšæµ‹è¯•å·¥å…·ï¼Œå†å¾€ä¸Šé¢å¯èƒ½å°±ä¼šåˆ†æˆå¾ˆå¤šä¸ªæ–¹å‘ï¼Œæ¯”å¦‚è´Ÿè´£ä¸€å—ä¸šåŠ¡çš„äº§å“å’Œäº¤ä»˜è´¨é‡ã€è´Ÿè´£éƒ¨é—¨çº§çš„å·¥å…·å¹³å°æ¶æ„å»ºè®¾ã€è´Ÿè´£å¤§ä¸šåŠ¡çº¿çš„GPT/ä»£ç åˆ†ææŠ€æœ¯å»ºè®¾ç­‰ï¼Œå†å†å¾€ä¸Šä¹Ÿè®¸æ˜¯ç‰µå¤´åšå¤šæ¡ä¸šåŠ¡çº¿çš„è´¨é‡ç®¡ç†ï¼Œæˆ–è€…æ˜¯æµ‹è¯•/è´¨é‡/DevOpsæŸä¸ªæŠ€æœ¯é¢†åŸŸå¤§æ–¹å‘çš„è´Ÿè´£äººã€‚æ¯ä¸ªäººéƒ½çŸ¥é“ï¼Œå¾€ä¸Šçš„å·¥ä½œå†…å®¹æ›´åŠ ä»¤äººå…´å¥‹ï¼Œæ›´åŠ åˆ©äºæˆé•¿ï¼Œä½†æ˜¯å½“ä¸‹çš„å·¥ä½œï¼Œå¦‚æœä»èŒè´£ä¸Šä¸æ˜¯ä¸ºä¸‹ä¸€ä¸ªèŒçº§çš„å·¥ä½œåšé“ºå«çš„è¯ï¼Œé‚£ä¹ˆå°±æ°¸è¿œä¼šæ¡†ä½è‡ªå·±ã€‚æ‰€ä»¥è¯´ï¼Œå·¥ä½œä¹‹ä½™ï¼Œä¸€å®šè¦ä¸»åŠ¨ä»æ›´é«˜ç»´åº¦ï¼Œæˆ–è€…è¯´æ—è§‚è€…/ä¸Šå¸è§†è§’ï¼Œå»è¯„ä»·è‡ªå·±çš„å·¥ä½œå†…å®¹ã€‚è¿™æ ·æ‰å¯ä»¥çŸ¥é“ï¼Œå·¥ä½œè¿™ä»¶äº‹æƒ…èƒ½å¦ä¸ºä½ çš„æœªæ¥ç”Ÿæ´»å¸¦æ¥æ›´å¤šç›Šå¤„ï¼Œèƒ½å¤Ÿåœ¨ä¸€æ®µæ—¶é—´å†…æŠµæ¶ˆæ›´å¤šçš„ç”Ÿæ´»é£é™©ï¼Œè¿˜æ˜¯è¯´åœ¨å·¥ä½œä¹‹å¤–ï¼Œä¸»åŠ¨å¯»æ±‚å…¶ä»–å¯èƒ½æ€§ï¼Œæ‰æ˜¯ä¸€æ¡æ›´åˆé€‚çš„ç”Ÿå­˜é“è·¯ã€‚</p>
<p>æœ€åï¼Œè¿˜æ˜¯ä¸€å¥è¯ï¼Œæ¯”èµ·å¹³è¡¡æ—¥å¸¸å·¥ä½œå’Œå­¦ä¹ æå‡ï¼Œæ›´ä¸Šå±‚çš„ä¸€ä¸ªæ€è·¯æ˜¯ï¼Œæ€ä¹ˆå¹³è¡¡è‡ªå·±ä¸å¯æ§çš„ç”Ÿæ´»å’Œè‡ªå·±å¯æ§çš„ç”Ÿæ´»ã€‚è§£å†³æ–¹æ³•æ˜¯ï¼Œè‡ªå·±å¯æ§çš„ç”Ÿæ´»ï¼Œä»¥åŠä¸å¯æ§ä½†ä¸ºè‡ªå·±å­¦ä¹ æå‡å¸¦æ¥æ­£åé¦ˆçš„ç”Ÿæ´»ï¼Œæˆ‘ä»¬éœ€è¦ä¸»åŠ¨å‡ºå‡»ï¼Œè®©è¿™ä¸¤ç±»äº‹æƒ…å»å æ®è‡ªå·±æ›´å¤šçš„æ—¶é—´ï¼</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘å¯¹ä½ä»£ç å¼€å‘æ¨¡å¼çš„ä¸€äº›æ€è€ƒå’Œæƒ³æ³•</title>
    <url>/2024/08/17/geekdaily/low_code_talk/</url>
    <content><![CDATA[<p>ä½ä»£ç è¿™ä¸ªåè¯è¯´èµ·æ¥å·²ç»æœ‰äº›å¹´å¤´äº†ï¼Œå¹¿ä¹‰ä¸Šæ¥è®²å¯ä»¥è¯´æ˜¯è¾¾åˆ°è¿™ä¹ˆä¸€ç§æ•ˆæœï¼Œå³å°½é‡å‡å°‘é€šè¿‡ç¼–å†™ä»£ç çš„æ–¹å¼æ¥å®Œæˆç ”å‘ä»»åŠ¡ï¼Œç”šè‡³éƒ¨ç½²äº¤ä»˜æ•´ä¸ªæŠ€æœ¯äº§å“ã€‚é‚£ä¹ˆä½ä»£ç æ¨¡å¼åˆ°åº•å€¼ä¸å€¼å¾—å¼„ï¼Œæœ‰ä»€ä¹ˆä¼˜åŠ¿å’Œç¼ºé™·ï¼Œæœ¬ç¯‡æ–‡ç« ç¬”è€…å°±æ¥èŠä¸€èŠè‡ªå·±å¯¹äºä½ä»£ç çš„ä¸€äº›æ€è€ƒè·Ÿæƒ³æ³•ã€‚</p>
<p>åšæŠ€æœ¯çš„éƒ½çŸ¥é“ï¼Œå®é™…å·¥ä½œåœºåˆä¸Šï¼Œä¸èƒ½ä¸ºäº†æŠ€æœ¯è€ŒæŠ€æœ¯ã€‚ä½ä»£ç ä¹Ÿæ˜¯ä¸€æ ·ï¼Œè¿™é—¨æŠ€æœ¯æœ€é‡ç‚¹è§£å†³çš„é—®é¢˜æ˜¯ï¼Œè®©ä¸æ‡‚ä»£ç çš„äººå¯ä»¥é€šè¿‡ä¸€å¥—å·¥å…·æ¥å®Œæˆè‡ªå·±å¼€å‘çš„ä½œå“ï¼Œæ‰€ä»¥ä»äº§å“è§’åº¦ï¼Œä½ä»£ç å·¥å…·åº”å½“æ›´åŠ å€¾å‘äºæå‡æ˜“ç”¨æ€§ï¼Œè€Œéæå‡åŠŸèƒ½æ€§ã€‚å‡è®¾æˆ‘è¦å¼€å‘ä¸€ä¸ªæœåŠ¡ï¼Œæˆ‘æ‰‹å†™ä»£ç +æ‰‹åŠ¨éƒ¨ç½²éœ€è¦3å¤©ï¼Œè€Œå­¦ä¹ ä½ä»£ç å·¥å…·+å®ŒæˆæœåŠ¡æ­å»ºåªéœ€è¦1å¤©ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å¢ƒä¸‹ï¼Œä½ä»£ç å·¥å…·å°±èƒ½å¤Ÿå…‘ç°è‡ªå·±çš„ä»·å€¼ã€‚</p>
<a id="more"></a>
<p>æ‰€ä»¥ä½ä»£ç æ¨¡å¼å€¼ä¸å€¼å¾—å¼„ï¼Œæœ€å…ˆå†³çš„æ¡ä»¶æ˜¯ï¼Œä½ä»£ç æ‰€åº”ç”¨åˆ°çš„é¢†åŸŸäº§å“ï¼Œæ˜¯ä¸æ˜¯é€šè¿‡å†™ä»£ç çš„æ–¹å¼å·¥ä½œé‡éå¸¸å¤§ã€‚å¥½æ¯”è¯´ï¼Œæˆ‘è¦æ¸²æŸ“ä¸€äº›å›¾å½¢ï¼Œé‚£ä¹ˆå°±éœ€è¦æ¶‰åŠå¤æ‚çš„æ•°å­¦è®¡ç®—ï¼Œç›´æ¥æ•²ä»£ç æ˜¯éå¸¸å›°éš¾çš„ï¼Œä½†å¦‚æœæˆ‘æœ‰ä¸€äº›ä½ä»£ç å·¥å…·ï¼Œå¯ä»¥é€šè¿‡è¿ç®—èŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»æè¿°è®¡ç®—è¿‡ç¨‹ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥é€šè¿‡ä¸€äº›å›¾å½¢çš„æ‹–æ‹½ï¼Œå°±å¯ä»¥è¾¾åˆ°æ¸²æŸ“å›¾å½¢çš„ç›®çš„ã€‚UEã€Unityä¹‹ç±»çš„æ¸¸æˆå¼•æ“éƒ½æ˜¯è¿™æ ·åšçš„ï¼Œé€šè¿‡å›¾å½¢åŒ–çš„è§†å›¾æ“ä½œï¼Œå‡å°‘äº†æ¸¸æˆå¼€å‘è€…çš„å·¥ä½œæˆæœ¬ã€‚å¯¹äºæ¸¸æˆã€ä»¿çœŸé¢†åŸŸè€Œè¨€ï¼Œæœ‰æ—¶å€™ä¸å¿…åšåˆ°éå¸¸ä¸¥è‹›çš„æ•ˆæœï¼Œé€šè¿‡æ­£å‘çš„è¿ç®—æµç¨‹æ„æ€ä¸€ä¸‹å³å¯ï¼Œå› æ­¤å›¾å½¢åŒ–çš„é€»è¾‘æè¿°å¯èƒ½å¹¶ä¸æ²¡æœ‰æƒ³è±¡ä¸­é‚£ä¹ˆå¤æ‚ï¼Œåå€’æ˜¯æ­£å¸¸çš„ä¸šåŠ¡åç«¯é€»è¾‘ï¼Œå……æ–¥äº†å¾ˆå¤šé˜²å¾¡æ€§ä»£ç ï¼Œå¹¶ä¸”å¯èƒ½é“¾è·¯æ¯”è¾ƒé•¿ï¼Œè¿™ç±»åœºæ™¯å°±ä¸é€‚åˆç”¨å›¾å½¢åŒ–çš„æ–¹å¼æè¿°é€»è¾‘ã€‚</p>
<p>ä½ä»£ç æ¨¡å¼è¦å…‘ç°ä»·å€¼ï¼Œè¿˜æœ‰æ¯”è¾ƒå®¢è§‚çš„å› ç´ æ˜¯ï¼Œæ‰€åº”ç”¨åˆ°çš„é¢†åŸŸéœ€è¦æœ‰ä¸€å®šçš„ç”¨æˆ·åŸºç¡€ã€‚ä½ä»£ç å·¥å…·çš„ç»´æŠ¤é‡æ˜¯éå¸¸å¤§çš„ï¼Œé¦–å…ˆåº•å±‚éœ€è¦å¯¹ä»£ç æœ¬èº«ä»¥åŠä¸šåŠ¡æµç¨‹ä¹‹ç±»çš„èŠ‚ç‚¹åšå°è£…ï¼Œèµ·åˆ°ä¸€ä¸ªå®çš„ä½œç”¨ï¼Œç„¶åä¸Šå±‚è¿˜éœ€è¦åšæµç¨‹èŠ‚ç‚¹çš„å›¾å½¢åŒ–å±•ç°ï¼Œå¹¶ä¸”è¿˜è¦åšçš„ç¾è§‚æ˜“ç”¨ï¼Œä»¥å°½åŠ›å‡å°‘ä»£ç ç¼–å†™ã€èŠ‚ç‚¹é…ç½®ä»¥åŠé¢†åŸŸç†è§£æˆæœ¬ï¼Œè¿™äº›ä¸æ˜¯ç®€å•ä¸‰äº”ä¸ªäººå°±å¾ˆå¿«åšå‡ºæ¥çš„ï¼Œè€Œä¸”ä¹Ÿå¾—åšçš„ç¾è§‚åšçš„ç¨³å®šæ‰èƒ½å¤Ÿäº¤ä»˜ç”¨æˆ·ä½¿ç”¨ï¼Œå¦åˆ™ç”¨æˆ·ä¹Ÿç©ä¸è½¬ã€‚å¦‚æœè¯´ä½ä»£ç å·¥å…·æ‰€é…åˆçš„äº§å“ç”¨æˆ·é‡ä¸å¤§ï¼Œé‚£ä¹ˆå³ä¾¿åšæˆäº†ï¼Œæ—¶é—´æˆæœ¬ä¹Ÿä¸ä¸€å®šèƒ½å¤Ÿè¢«ç”¨æˆ·æ”¶ç›Šæ‰“å¹³ã€‚ä»ä¼ä¸šè¿è¥çš„è§’åº¦æ¥è¯´ï¼Œè¿™ä¸€éƒ¨åˆ†å·¥ä½œé‡è¿˜ä¸å¦‚ç”¨æ¥åšæ›´æœ‰ä»·å€¼çš„äº‹æƒ…ï¼Œæ¯”å¦‚å¯¹å…¶ä»–é¢†åŸŸçš„äº§å“åˆ›æ–°ï¼Œæˆ–è€…æ˜¯å·²æœ‰äº§å“çš„æŠ€æœ¯å¤ç”¨ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œä½ä»£ç å¼€å‘æ¨¡å¼å€¼ä¸å€¼å¾—åšï¼Œä»æŠ€æœ¯ä¸Šè®²è‚¯å®šæ˜¯å€¼å¾—çš„ï¼Œå¯¹äºç”¨æˆ·çš„æ”¶ç›Šæ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œä½†ä»ä¼ä¸šè¿è¥è¿˜æœ‰ç ”å‘å›¢é˜Ÿå‘å±•è§’åº¦æ¥è¯´æˆæœ¬ä¼šæ¯”è¾ƒå¤§ï¼Œå³ä¾¿æœ‰ç”¨æˆ·æ”¶ç›Šä¹Ÿä¸ä¸€å®šèƒ½å¤ŸæŠµæ¶ˆæˆæœ¬ã€‚æ‰€ä»¥å¦‚æœè¦æŠ•å…¥åšä½ä»£ç å·¥å…·ï¼Œæœ€å¥½äº§å“æœ¬èº«æœ‰ä¸€å®šçš„ç”¨æˆ·åŸºç¡€å’ŒæŠ€æœ¯ç”Ÿæ€åŸºç¡€ï¼Œè¿™æ ·æ‰èƒ½é”¦ä¸Šæ·»èŠ±ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ç¼–ç¨‹</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>ç ”å‘æ•ˆèƒ½</tag>
        <tag>ä½ä»£ç </tag>
        <tag>æ¸¸æˆå¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘æ¯”PyQt5æ›´å…ˆè¿›çš„pyside6å®‰è£…å’Œä½¿ç”¨æ–¹æ³•</title>
    <url>/2024/08/11/pythonnotes/pyside6_intro/</url>
    <content><![CDATA[<p>æœ€è¿‘å› ä¸ºè‡ªç ”æ—¥å¸¸å¼€å‘å·¥å…·çš„éœ€æ±‚ï¼Œå†³å®šé‡æ–°æ‹¾èµ·PyQt5ä¹‹ç±»çš„æ¡Œé¢å·¥å…·å¼€å‘æŠ€æœ¯æ ˆï¼Œä¸ºå•¥é€‰ç”¨PyQtï¼Œä¸€æ˜¯å› ä¸ºç¬”è€…æ¯”è¾ƒç²¾é€špythonï¼ŒäºŒæ˜¯å› ä¸ºä¸éœ€è¦åœ¨å¤–è§‚ä¸Šåšä»€ä¹ˆç‰¹åˆ«çš„ä¸œè¥¿ã€‚ç»è¿‡ä¸€ç•ªè°ƒç ”ï¼Œå‘ç°å½“å‰çš„PyQt5ç‰ˆæœ¬å·²ç»è¿‡æ—¶ï¼Œç”¨pyside6ä¼šæ›´åŠ è´´åˆç°åœ¨çš„éœ€æ±‚ã€‚å› æ­¤ç¬”è€…ä¹Ÿç®€å•éƒ¨ç½²äº†ä¸‹pyside6çš„å¼€å‘ç¯å¢ƒï¼Œé€šè¿‡è¿™ç¯‡æ–‡ç« åˆ†äº«ä¸€ä¸‹å¦‚ä½•æ“ä½œã€‚</p>
<p>å…ˆå¼ºè°ƒä¸€ç‚¹æ˜¯ï¼Œæ‰€æœ‰çš„èµ„æ–™éƒ½å¯ä»¥åœ¨<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi9xdWlja3N0YXJ0Lmh0bWw=" title="https://doc.qt.io/qtforpython-6/quickstart.html">å®˜ç½‘<i class="fa fa-external-link"></i></span>æŸ¥åˆ°ã€‚å¦‚æœæœ‰ç‰¹åˆ«ç–‘é—®çš„åœ°æ–¹ï¼Œå‚è€ƒå®˜ç½‘ï¼Œå®åœ¨ä¸è¡Œå°±stackoverflowæˆ–è€…gptï¼Œä¹Ÿè®¸å¯ä»¥æ›´å¿«è§£å†³é—®é¢˜ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯æŠ˜è…¾é¡¹ç›®å·¥ä½œåŒºã€‚ä»ä¸ªäººå¼€å‘è§’åº¦ï¼Œç¬”è€…æ¨èæ‰€æœ‰çš„æ¡Œé¢å¼€å‘é¡¹ç›®éƒ½æ”¾åœ¨ä¸€ä¸ªpyside6çš„å·¥ä½œåŒºï¼Œå¹¶é‡‡ç”¨venvæ¥å®‰è£…pyside6ç›¸å…³åº“å’Œå·¥å…·ã€‚</p>
<p>pyside6çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æŠŠuiæ–‡ä»¶è½¬åŒ–ä¸ºpythonä»£ç çš„pyside6-uicï¼Œä»¥åŠç¼–è¾‘uiçš„å¯è§†åŒ–å·¥å…·pyside6-designerä¹‹ç±»ã€‚å¦‚æœæ˜¯venvå®‰pyside6çš„è¯ï¼Œè¿™äº›å·¥å…·éƒ½é›†æˆåˆ°äº†<code>${project_dir}/.venv/bin</code>ä¸‹é¢ï¼Œæœ‰éœ€è¦çš„è¯ä¹Ÿå¯ä»¥exportåˆ°pathé‡Œï¼Œå…·ä½“ä½œç”¨è¯¦ç»†å¯ä»¥å‚è€ƒå®˜ç½‘çš„<span class="exturl" data-url="aHR0cHM6Ly9kb2MucXQuaW8vcXRmb3JweXRob24tNi90b29scy9pbmRleC5odG1s" title="https://doc.qt.io/qtforpython-6/tools/index.html">è¿™ä»½èµ„æ–™<i class="fa fa-external-link"></i></span>ã€‚é€šè¿‡è¿™äº›å·¥å…·åŠ ä¸Šä¸€äº›è„šæœ¬ï¼Œå°±èƒ½ç®€å•æ‰“é€šuiç¼–è¾‘-&gt;uiè½¬ç -&gt;ä»£ç ç¼–å†™-&gt;éƒ¨ç½²å‘å¸ƒçš„å¼€å‘é“¾è·¯ï¼ˆp.s. éƒ¨ç½²å‘å¸ƒç›¸å…³çš„è°ƒç ”æš‚æ—¶ä¸å¤šï¼‰ã€‚</p>
<p>ä»£ç ç»„ç»‡æ–¹é¢ï¼Œæ¨èå…ˆæ˜¯æŠŠå·¥å…·ç±»ã€ä¸šåŠ¡é€»è¾‘å’Œuié€»è¾‘å‡ ä¸ªæ¨¡å—åˆ†ç¦»å¼€ï¼Œç„¶åé‡è¦ä¸€ç‚¹æ˜¯ï¼ŒæŠŠuiç”Ÿæˆä»£ç å’Œå®é™…çš„windowè·Ÿwidgetç±»ç»™åˆ†å¼€æ¥ï¼Œåšåˆ°viewå’Œmodelçš„åŒºåˆ†ã€‚è¿™æ ·ä¸€æ¥æ˜¯å¤§å°å±‚æ¬¡æ¯”è¾ƒåˆ†æ˜ï¼Œä¸ä¼šå‡ºç°å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼ŒäºŒæ¥æ˜¯ä»uiç”Ÿæˆçš„ä»£ç ï¼Œä¹Ÿä¸ä¼šç›´æ¥å½±å“åˆ°å·²æœ‰ä»£ç çš„å®ç°ï¼Œåšæ”¹åŠ¨ä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿ã€‚ä»¥ç¬”è€…çš„é¡¹ç›®ä¸ºä¾‹ï¼Œç¬”è€…ç”¨ä¸€ä¸ªappæ–‡ä»¶å¤¹æ¥å­˜å‚¨æ‰€æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡æœ€å¤–å±‚çš„main.pyé©±åŠ¨appè¿è¡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨appçš„<strong>init</strong>.pyå¯åŠ¨æ•´ä¸ªé¡¹ç›®</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">APP: Optional[QtWidgets.QApplication] = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> APP</span><br><span class="line">    APP = QtWidgets.QApplication([])</span><br><span class="line"></span><br><span class="line">    window = MainWindow()</span><br><span class="line">    window.ensure_center()</span><br><span class="line">    window.show()</span><br><span class="line"></span><br><span class="line">    sys.exit(APP.exec())</span><br></pre></td></tr></table></figure>
<p>æœ€ååœ¨æ¯ä¸ªuiç±»å®ç°é‡Œé¢æ¥åˆå§‹åŒ–è·Ÿå®šä¹‰ç•Œé¢é€»è¾‘ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span><span class="params">(QMainWindow)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(MainWindow, self).__init__()</span><br><span class="line">        self.ui = Ui_MainWindow()</span><br><span class="line">        self.ui.setupUi(self)</span><br><span class="line"></span><br><span class="line">        self._init_actions()</span><br><span class="line">        self._init_widget()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_actions</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.ui.actionAbout.triggered.connect(self.show_about)</span><br><span class="line">        self.ui.actionExit.triggered.connect(self.close)</span><br><span class="line"></span><br><span class="line">        self.ui.actionSupport.triggered.connect(self.show_support)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_init_widget</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># ä¸»åŠ¨setä¸­å¿ƒwidgetï¼Œåç»­å¯ä»¥é€šè¿‡é…ç½®åŒ–æ–¹å¼çµæ´»è®¾ç½®ä¸åŒçš„ç•Œé¢</span></span><br><span class="line">        self.setCentralWidget(ToolWidget())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">closeEvent</span><span class="params">(self, event)</span>:</span>  <span class="comment"># å…³é—­çª—å£æ—¶è§¦å‘</span></span><br><span class="line">        reply = QMessageBox.question(</span><br><span class="line">            self, <span class="string">'ç¡®è®¤'</span>, <span class="string">'æ˜¯å¦è¦é€€å‡ºç¨‹åºï¼Ÿ'</span>,</span><br><span class="line">            QMessageBox.StandardButton.Yes | QMessageBox.StandardButton.No,</span><br><span class="line">            QMessageBox.StandardButton.Yes)</span><br><span class="line">        <span class="keyword">if</span> reply == QMessageBox.StandardButton.Yes:</span><br><span class="line">            event.accept()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            event.ignore()</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä¾¿æ˜¯ä¸€ä¸ªç®€å•çš„pyside6å®‰è£…å’Œä½¿ç”¨æ–¹æ³•ã€‚åé¢å¦‚æœæ¢ç´¢åˆ°ä¸€äº›æ–°çš„ä¸œè¥¿ï¼Œå†æ‹¿å‡ºæ¥åˆ†äº«ï½</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>pyside6</tag>
        <tag>PyQt5</tag>
        <tag>Qt</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘Goè¯­è¨€å­¦ä¹ å¹²è´§â€”â€”ä»é›¶å•æ’Golangç³»åˆ—åˆé›†</title>
    <url>/2024/08/11/geekdaily/gofromzero_collection/</url>
    <content><![CDATA[<p>åœ¨åç«¯å¼€å‘é¢†åŸŸï¼ŒGolangå·²ç»æˆä¸ºéå¸¸æµè¡Œçš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ï¼Œå¹¶ä¸”ç”Ÿæ€ä¹Ÿéå¸¸æˆç†Ÿã€‚è™½ç„¶åœ¨åº”ç”¨è§„æ¨¡ä¸Šç¦»Javaè¿˜æœ‰ä¸€æ®µè·ç¦»ï¼Œä½†å…¶ä¸­å¾ˆå¤šç¼–ç¨‹æŠ€å·§è·Ÿæ€è·¯è¿˜æ˜¯å€¼å¾—å­¦ä¹ çš„ï¼Œä¸€æ˜¯æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šçš„codingçº¦æŸï¼ŒäºŒæ˜¯å®é™…å·¥ä½œä¸­ä¹Ÿæœ‰å¯èƒ½ç”¨çš„ä¸Šã€‚</p>
<p>åœ¨è¿‘ä¸€ä¸¤å¹´ï¼Œç¬”è€…çš„å·¥ä½œä¹Ÿé€æ¸ä»ä¸»pythonè½¬ä¸ºä¸»goè¯­è¨€ï¼Œå¯¹äºGolangä¹Ÿæœ‰ä¸€äº›ç®€å•çš„å­¦ä¹ å¿ƒå¾—ã€‚å€ŸåŠ©ä»Šå¤©è¿™ä¸ªæœºä¼šï¼Œä¹Ÿå°†ã€Šä»é›¶å•æ’Golangã€‹ç³»åˆ—åšäº†ç²¾ç¼–ï¼Œæ•´åˆæˆç”µå­ä¹¦å¯¹å¤–å‘å¸ƒã€‚è¿™ä¸ªç³»åˆ—å…¶å®æ‹–äº†æ¯”è¾ƒä¹…çš„æ—¶é—´æ‰æå®šï¼Œä¸€å¼€å§‹å› ä¸ºåšè¿ç»´å¹³å°å¼€å‘çš„éœ€è¦ï¼Œå‰å‡ ç¯‡æ–‡ç« ä¸»è¦ä¸¾äº†dockerã€k8sç›¸å…³çš„ä¸€äº›å®æˆ˜æ¡ˆä¾‹ï¼Œæ²¡æœ‰å¯¹Golangçš„åŸºç¡€åŸç†åšå¤ªå¤šçš„æ·±æŒ–ï¼Œç„¶åä¹Ÿå› ä¸ºä¸ªäººåŸå› æç½®äº†ä¸€æ®µæ—¶é—´ã€‚ä½†å‡ å¹´åå› ä¸ºè½¬è¡Œï¼Œéœ€è¦ä¸»Golangï¼Œäºæ˜¯ä¹ŸæŠ½ç©ºæŠŠGolangçš„ä¸€äº›åŸºæœ¬æœºåˆ¶ç»™æ·±å…¥æ¢ç´¢äº†äº›ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç³»åˆ—æ²‰æ·€çš„éƒ½æ˜¯è‡ªå·±çš„æƒ³æ³•ï¼Œæ²¡ä»€ä¹ˆå½¢è€Œä¸Šå­¦çš„ä¸œè¥¿ï¼Œæ›´å¤šæ˜¯ä»ä¸€ä¸ªcodingç»éªŒè€…è½¬Golangçš„è§†è§’æ¥æ’°å†™å†…å®¹ã€‚ä¸è®ºä½ æ˜¯åˆå­¦Golangï¼Œè¿˜æ˜¯ä»å…¶ä»–è¯­è¨€è½¬è¿‡æ¥ï¼Œéƒ½å¯ä»¥å‚è€ƒè¿™ä¸ªç³»åˆ—ï¼Œå¸®åŠ©ä½ åœ¨å­¦ä¹ Golangçš„è¿‡ç¨‹ä¸­æ‰¾åˆ°ä¸€äº›æ€è·¯å’Œçµæ„Ÿã€‚</p>
<p>ä»¥ä¸‹æ˜¯ç›¸å…³èµ„æ–™ï¼š</p>
<a id="more"></a>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5jc2RuLm5ldC9kb3dubG9hZC91MDEzODQyNTAxLzg5NjI4NDM2" title="https://download.csdn.net/download/u013842501/89628436">ã€Šä»é›¶å•æ’Golangã€‹ç²¾ç¼–PDF<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nb2Zyb216ZXJv" title="https://github.com/utmhikari/gofromzero">ã€Šä»é›¶å•æ’Golangã€‹GitHubæºç <i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvJUU0JUJCJThFJUU5JTlCJUI2JUU1JThEJTk1JUU2JThFJTkyR29sYW5nLw==" title="https://utmhikari.top/categories/%E4%BB%8E%E9%9B%B6%E5%8D%95%E6%8E%92Golang/">ã€Šä»é›¶å•æ’Golangã€‹åŸæ–‡ç³»åˆ—<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vY29sdW1uLzcyOTcxNDQ1NjYyNTEwNDQ5MDI=" title="https://juejin.cn/column/7297144566251044902">ã€Šä»é›¶å•æ’Golangã€‹æ˜é‡‘ä¸“æ <i class="fa fa-external-link"></i></span></li>
</ul>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ç¼–ç¨‹</tag>
        <tag>Golang</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>æºç åˆ†æ</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘Golangä¸€ä¸ªçš„sliceæ•°æ®æ›¿æ¢çš„bugæ’æŸ¥</title>
    <url>/2024/07/20/geekdaily/golang_slice_bug/</url>
    <content><![CDATA[<p>ä¸Šå‘¨æŸå¤©ä¸‹ç­å‰ï¼Œæ¥åˆ°åŒäº‹è½¬æ¥ä¸€ä¸ªbugè¦æ’æŸ¥ï¼Œç—‡çŠ¶æ˜¯ä»£ç é‡æ„ä¹‹åæŸäº›ä¸šåŠ¡æ•ˆæœä¸ç¬¦åˆé¢„æœŸï¼Œç”±äºä»£ç é‡æ„äººæ˜¯ç¬”è€…ï¼Œäºæ˜¯blameåˆ°ç¬”è€…è¿™è¾¹ã€‚ç»è¿‡10minå·¦å³çš„æ’æŸ¥å’Œå°è¯•åï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼šæ—¢å¾€é€»è¾‘æ²¡æœ‰æ”¹åŠ¨ï¼Œé‡æ„æ—¶å€™å‡ºç¬”è¯¯äº†ã€‚</p>
<p>ç®€å•æ¥è®²ï¼Œé‡æ„ä¹‹å‰çš„ä»£ç å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">beforeRefactor</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> configListExpr = fetchConfigListExpr()</span><br><span class="line">    </span><br><span class="line">    newConfigListExpr := replaceConfigVariables(configListExpr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> configList []Config</span><br><span class="line">    <span class="keyword">if</span> err := json.Unmarshal([]<span class="keyword">byte</span>(newConfigListExpr), &amp;configList); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"unmarshal configList err: "</span> + err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> configList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œæ”¹é€ ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œå› ä¸ºç±»ä¼¼äºreplaceVariablesè¿™ç±»å¯¹configListæ‰¹é‡å¤„ç†çš„æµç¨‹æ›´å¤šï¼Œæ‰€ä»¥å®šä¹‰äº†å¾ˆå¤šå‡½æ•°èŠ‚ç‚¹å»å¯¹configListåšæ‰¹é‡çš„æ›¿æ¢ä»¥åŠå†…éƒ¨å±æ€§çš„ä¿®æ”¹ã€‚å› æ­¤é‡æ„æ—¶å€™ï¼Œå°±æŠŠreplaceConfigVariablesåšäº†æ›´ç»†ç²’åº¦çš„è½¬æ¢ï¼Œç„¶ååŒæ—¶æŠŠæ•´ä¸ªconfigListæ›¿æ¢é€»è¾‘ä¹Ÿé¡ºå¸¦ä¿®æ”¹äº†ä¸‹ã€‚å¤§æ¦‚æ”¹æˆäº†è¿™æ ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">afterRefactor</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> configList []Config = fetchConfigList()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, config := <span class="keyword">range</span> configList &#123;</span><br><span class="line">        urlList := config.URLList</span><br><span class="line">        newURLList = replaceURLListVariables(urlList)</span><br><span class="line">        config.URLList = newURLList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> configList</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ˜¯å­˜åœ¨é—®é¢˜çš„ã€‚ç”±äºè¿™æ¬¡é‡æ„æçš„ä»£ç å¾ˆå¤šï¼Œcræ—¶å€™æ²¡æœ‰å‘ç°ï¼›ç„¶åä¸€å¼€å§‹æ’æŸ¥ä»¥ä¸ºæ˜¯é‡æ„å¼•èµ·çš„ä¸šåŠ¡é€»è¾‘å˜æ›´ï¼Œæ‰€ä»¥å¿½ç•¥äº†Golangæœ¬èº«æœºåˆ¶å¯¼è‡´çš„é—®é¢˜ã€‚è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œéå†sliceçš„æ—¶å€™ï¼Œè¦æƒ³æ”¹åŠ¨åŸæ¥sliceé‡Œæˆå‘˜çš„å±æ€§ï¼Œä¸åº”è¯¥ç”¨configè¿™ä¸ªå¤åˆ¶å“ï¼Œè€Œå¾—ç”¨configListå–ä¸‹æ ‡è¿™ç§æ–¹å¼æ¥å–åˆ°åŸå§‹çš„æˆå‘˜å®ä¾‹ï¼Œæˆ–è€…å¹²è„†æŠŠconfigListæ•´ä¸ªå…¨æ–°æ›¿æ¢ï¼Œè¿™æ ·æ‰å¯ä»¥è¾¾åˆ°æ•ˆæœã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>é‡æ„</tag>
        <tag>Golang</tag>
        <tag>é—®é¢˜æ’æŸ¥</tag>
        <tag>slice</tag>
        <tag>æŒ‡é’ˆ</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘å¤§è§„æ¨¡ä¸šåŠ¡é€»è¾‘è¿ç§»å®è·µ</title>
    <url>/2024/07/20/archiart/large_scale_migration/</url>
    <content><![CDATA[<p>å¯¹äºä¸€ä¸ªæˆç†Ÿçš„å·¥ç¨‹é¡¹ç›®è€Œè¨€ï¼Œå› ä¸ºé¡¹ç›®æœªæ¥å‘å±•æˆ–æ˜¯å’Œä¼ä¸šå†…éƒ¨æ›´æ·±åº¦èåˆçš„éœ€è¦ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹æ—¢æœ‰ä¸šåŠ¡é€»è¾‘åšå¾ˆå¤§è§„æ¨¡çš„æ”¹åŠ¨ï¼Œæ¶‰åŠåˆ°å¤šæ–¹é¢çš„é€»è¾‘è¿ç§»å’Œä»£ç é‡æ„ï¼Œæ‰èƒ½å¤Ÿè¾¾åˆ°ä¸‹ä¸€ä»£äº§å“æ‰€éœ€è¦çš„æ•ˆæœã€‚</p>
<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±æ¥å‰–æä¸€ä¸‹å¦‚ä½•åšå¥½è¿™ä»¶äº‹æƒ…ï¼Œå°¤å…¶æ˜¯åœ¨å†å²ç§¯æ·€éå¸¸åšé‡çš„åœºæ™¯ï¼Œéœ€è¦é€šè¿‡æ€ä¹ˆæ ·çš„æ‰‹æ®µï¼ŒæŠŠè¿™ä¸ªé—®é¢˜è§£å†³å¥½ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆç¬¬ä¸€ä»¶äº‹æƒ…æ˜¯ï¼Œäº†è§£èƒŒæ™¯ã€‚ä¸ºä»€ä¹ˆè¦åšè¿™ä»¶äº‹æƒ…ï¼Œå®ƒå¯¹äºå›¢é˜Ÿå’Œå…¬å¸çš„ä¸šåŠ¡ä»·å€¼ä»¥åŠæŠ€æœ¯å±‚é¢çš„ä»·å€¼åœ¨å“ªé‡Œï¼Ÿä»ä¸€ä¸ªæ‰“å·¥äººçš„è§†è§’ï¼Œä¸€ä¸ªå¤§è§„æ¨¡çš„ä¸šåŠ¡é€»è¾‘è¿ç§»ï¼ŒèƒŒåä¸€å®šæ˜¯æœ‰å¤§å›¢é˜Ÿç”šè‡³å…¬å¸å±‚é¢çš„åº•å±‚é€»è¾‘åœ¨ç‰µå¼•ï¼Œå¦‚æœä½œä¸ºè´Ÿè´£äººä¸å»äº†è§£åº•å±‚é€»è¾‘ï¼Œé‚£ä¹Ÿå°±ä¸å¥½æŠŠæ¡ä¸šåŠ¡è¿ç§»çš„æ–¹å‘ï¼Œæœ€ç»ˆå°±æœ‰æ»¡è¶³ä¸äº†æŠ€æœ¯è·Ÿäº§å“æ•ˆæœçš„é£é™©ã€‚</p>
<p>å¥½æ¯”è¯´ï¼Œä»ä¸šåŠ¡è§’åº¦ï¼Œé€šè¿‡ä¼˜åŒ–æ€§èƒ½å’Œçº¿ä¸Šè¡¨ç°é—®é¢˜ï¼Œæ˜ç¡®å†å²é—ç•™æ½œè§„åˆ™ï¼Œæå‡ç”¨æˆ·ä½¿ç”¨ä½“éªŒï¼Œå‡å°‘ç”¨æˆ·é€‚åº”æˆæœ¬ï¼Œæå‡å·¥ç¨‹é¡¹ç›®åœ¨å…¬å¸å†…éƒ¨çš„å½±å“åŠ›ï¼Œæˆä¸ºæ›´åŠ ç»Ÿä¸€åŒ–çš„æ ‡å‡†ã€‚è¿™äº›éƒ½å¯èƒ½æ˜¯è¿™ä¸ªé¡¹ç›®åšå¤§è§„æ¨¡è¿ç§»çš„ç†ç”±ã€‚ç„¶åï¼Œä»æŠ€æœ¯è§’åº¦ä¸Šï¼Œæ¯”å¦‚é€šè¿‡é‡æ„ä»£ç ï¼Œæ•´ä¸ªé¡¹ç›®èƒ½å¤Ÿå‘ˆç°æ›´åŠ å¹²å‡€ç®€æ´çš„ä»£ç å®ç°ï¼Œæ›´åŠ ç»Ÿä¸€çš„å…³ç³»ç»“æ„å’Œé€»è¾‘æ€è·¯ï¼Œæ›´é«˜å†…èšï¼Œæ›´æ˜“æ‰©å±•ï¼Œæå‡é¡¹ç›®ä»£ç å’ŒæœåŠ¡æ¶æ„çš„å¯æ‰©å±•æ½œåŠ›ã€‚è¿™äº›ä¹Ÿéƒ½æ˜¯ä¸šåŠ¡è¿ç§»å·¥ä½œå¯ä»¥éšä¹‹å¸¦æ¥çš„æŠ€æœ¯ä»·å€¼ã€‚å……åˆ†äº†è§£å®Œè¿™ä»¶äº‹æƒ…çš„èƒŒæ™¯ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ›´åŠ ç²¾ç¡®åœ°ä¸‹æ‰‹ã€‚</p>
<p>åšä¸šåŠ¡é€»è¾‘è¿ç§»ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼Œè¦ç»´æŒåŸå…ˆçš„äº§å“è¡¨ç°ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å¾ˆå¤šç§æŠ€æœ¯æ‰‹æ®µï¼Œæ¯”å¦‚ä»£ç é‡æ„å°±æ˜¯ä¸€ç§æœ€ç›´æ¥çš„æ–¹å¼ã€‚ä½†æ˜¯ï¼Œé™¤äº†ä»£ç é‡æ„ä¹‹å¤–ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹å¼ï¼Ÿæ¯”å¦‚é‡æ–°å†™ä¸€ä¸ªå·¥ç¨‹ï¼Œæˆ–è€…æŠŠæŸäº›æ¨¡å—ä½œä¸ºå•ç‹¬çš„æœåŠ¡æ‹†åˆ†å‡ºæ¥ï¼Ÿæˆ–è€…è¯´ï¼Œåœ¨å½“å‰è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œä¸ºä»€ä¹ˆé‡æ„æ—¢æœ‰ä»£ç æ˜¯æœ€å¥½çš„è§£å†³æ–¹å¼ï¼Ÿæœ‰ä»€ä¹ˆç†ç”±å¯ä»¥è®ºè¯è¿™ä¸€ç‚¹ï¼Ÿè¿™äº›ï¼Œéƒ½æ˜¯åœ¨å‡†å¤‡å·¥ä½œè¿‡ç¨‹ä¸­éœ€è¦æ€è€ƒçš„é—®é¢˜ã€‚</p>
<p>æœ‰äº›æ—¶å€™ï¼Œä¸ºäº†æ»¡è¶³å’±ä»¬è´Ÿè´£äººè‡ªèº«çš„æŠ€æœ¯ä¿¡ä»°å’Œæ§åˆ¶æ¬²ï¼Œé‡å†™å·¥ç¨‹å°±æ˜¯ä¸€ç§æœ€å®Œç¾çš„æ‰‹æ®µã€‚ä½†æ˜¯ï¼Œé‡å†™å·¥ç¨‹è€—æ—¶è€—äººåŠ›éå¸¸å¤§ï¼Œå¹¶ä¸”ä¼šæ”¹å˜ç”¨æˆ·ä¹ æƒ¯ï¼Œæ‰€ä»¥ç°å®ä¸Šä¸ä¸€å®šæ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚ä½†å¦‚æœè¯´ï¼Œæ—¢å¾€å·¥ç¨‹å’ŒæŸäº›ç‰¹å®šçš„åœºæ™¯è€¦åˆåº¦å¤ªé«˜ï¼Œä½†ä»£ç è´¨é‡å¤ªå·®ï¼Œå¯¼è‡´ä»£ç æ— æ³•æ‹†åˆ†ï¼ŒæŠ€æœ¯å±‚é¢ä¸Šå®Œå…¨ä¸æ»¡è¶³è¦æ±‚ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±å¯ä»¥è€ƒè™‘é‡å†™ï¼Œä¸ä»…å¯ä»¥å®ç°æ•ˆæœï¼Œä¹Ÿå¯ä»¥è§£å†³å¾ˆå¤šä»¥å¾€çš„æŠ€æœ¯é—®é¢˜ï¼Œä¸€ä¸¾ä¸¤å¾—ã€‚</p>
<p>æ‹†åˆ†æœåŠ¡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯ä»¥é€‰æ‹©çš„ä¸¾æªï¼Œä½†å‰ææ˜¯è¦é‡æ„çš„éƒ¨åˆ†æ˜¯ç‹¬ç«‹çš„æ¨¡å—ï¼Œå®¹æ˜“è¢«å•ç‹¬æå‡ºæ¥ã€‚å¦‚æœè¯´æ—¢å¾€çš„ä»£ç å…³ç³»ç¹æ‚ï¼Œå­˜åœ¨å¾ˆå¤šæ½œè§„åˆ™ï¼Œå†…éƒ¨ä¹‹é—´å­˜åœ¨å¾ˆå¤šä¸€æ—¶åŠä¼šä¸èƒ½å˜æ¸…çš„ä¾èµ–ï¼Œé‚£ä¹ˆåœ¨ä¸šåŠ¡é€»è¾‘å‡çº§æœŸé—´ï¼ŒåŒæ—¶ç›²ç›®æ‹†åˆ†æœåŠ¡ï¼Œä¹Ÿæ˜¯å…·æœ‰é£é™©çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªåˆé€‚çš„ä¸¾æªæ˜¯å…ˆé‡æ„æ—¢æœ‰ä»£ç ï¼Œå†åœ¨é‡æ„çš„åŸºç¡€ä¸Šå»æ‹†ã€‚æ­¤å¤–ï¼Œæ‹†åˆ†æœåŠ¡æœ¬èº«ä¹Ÿä¼šå¼•å…¥é¢å¤–çš„æœåŠ¡æ¶æ„å¤æ‚åº¦ï¼Œæ‰€ä»¥ä¸€å®šè¦æ˜ç¡®æ‹†åˆ†æœåŠ¡å¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´åŠ å¿«éƒ¨ç½²é€Ÿåº¦ï¼Œå‡å°‘éæ ¸å¿ƒæ¨¡å—å¯¹L0æœåŠ¡å¸¦æ¥çš„å½±å“ï¼Œéƒ½å¯ä»¥æˆä¸ºæ‹†åˆ†æœåŠ¡å¸¦æ¥çš„ä»·å€¼ã€‚</p>
<p>æ‰€ä»¥æœ€ç»ˆï¼Œä¸šåŠ¡é€»è¾‘è¿ç§»ï¼Œè¿˜æ˜¯å¿…ç„¶ä¼šèµ°åˆ°ä»£ç é‡æ„ç¯èŠ‚ã€‚é‚£ä¹ˆé‡æ„è¦æ€ä¹ˆåšï¼Ÿæ€ä¹ˆæ ·èƒ½å¤Ÿä¿è¯é‡æ„å…ˆåï¼Œç”¨æˆ·ä½“éªŒä¸å—å½±å“ï¼Ÿæœ‰ä¸€ä¸ªåˆé€‚çš„æ€è·¯æ˜¯ï¼Œé€šè¿‡é…ç½®å¼€å…³ï¼Œæ§åˆ¶ä¸šåŠ¡é€»è¾‘èµ°åˆ°æ—¢å¾€çš„é“¾è·¯ï¼Œè¿˜æ˜¯å‡çº§åçš„é“¾è·¯ã€‚å½“ç„¶åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£æ•´ä¸ªä»£ç çš„è„‰ç»œï¼Œä¸šåŠ¡é“¾ä¸Šæ¯ä¸€ä¸ªç¯èŠ‚çš„èŒè´£ï¼Œç„¶åéœ€è¦å¯¹æ¯ä¸ªç¯èŠ‚æ„é€ æµ‹è¯•ç”¨ä¾‹ï¼Œä»€ä¹ˆåœºæ™¯æµ‹ä»€ä¹ˆï¼Œä»¥ä¾¿åœ¨é‡æ„æ—¶å€™å¯ä»¥éšæ—¶éªŒè¯ã€‚å¯¹äºé…ç½®çš„å¼€å…³ï¼Œä¹Ÿä¸å•çº¯æ˜¯ä¸€ä¸ªtrue-or-falseçš„ç²’åº¦ï¼Œç²’åº¦å¯ä»¥è®¾ç½®çš„æ›´ç»†ï¼Œæ›´åŠ å€¾å‘äºä¸€ä¸ªç°åº¦filterçš„è®¾è®¡â€”â€”åœ¨ä¸šåŠ¡é€»è¾‘çš„å‰ç½®åˆ¤æ–­ä¸­ï¼Œå¦‚æœç°åº¦åˆ™èµ°æ–°çš„é€»è¾‘ï¼Œæ²¡æœ‰è¢«ç™½å°±æ˜¯èµ°è€çš„é€»è¾‘ã€‚é€šè¿‡å¼€å…³æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å…¼å®¹ä¸šåŠ¡è¿ç§»è¿‡ç¨‹çš„å„ç±»ä¸­é—´æ€ï¼Œä»è€Œæ»¡è¶³ç”¨æˆ·æ— æ„Ÿçš„éœ€è¦ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç”±äºä¸­é—´æ€çš„å­˜åœ¨ï¼Œé‚£ä¹ˆåœ¨å†…æµ‹å’Œç°åº¦è¿‡ç¨‹ä¸­ï¼ŒåŠ¿å¿…æœ‰å¾ˆå¤šéœ€æ±‚éœ€è¦åŒå†™åˆ°è€çš„é€»è¾‘å’Œæ–°çš„é€»è¾‘ã€‚å¤šäººå¼€å‘åœºæ™¯ä¸‹ï¼Œå¦‚æœå›¢é˜Ÿå†…éƒ¨æ²¡æœ‰å¯¹é½è¿™ä¸ªå£å¾„ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æ–°è€é€»è¾‘æ•ˆæœä¸ä¸€è‡´çš„é£é™©ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦ä¿è¯å›¢é˜Ÿå†…éƒ¨å¯¹è¿™ä»¶äº‹æƒ…ä¹Ÿèƒ½è¾¾æˆä¸€äº›å…±è¯†ï¼Œå°¤å…¶æ˜¯éœ€è¦åŒæ­¥è¿™æ¬¡è¿ç§»å¯¹äºå›¢é˜Ÿå†…æˆå‘˜åšå¼€å‘å·¥ä½œçš„å½±å“ã€‚é€šè¿‡å‡å°‘å£å¤´ä¸Šçš„ä¿¡æ¯å·®ï¼Œä»è€Œå‡å°‘ä»£ç ä¸Šçš„ä¿¡æ¯å·®ã€‚</p>
<p>ä¹‹åæ˜¯è¿ç§»çš„æ‰§è¡Œã€‚å¤§è§„æ¨¡çš„ä¸šåŠ¡é€»è¾‘è¿ç§»æ€»æ˜¯æœ‰é£é™©çš„ï¼Œå› æ­¤ä»äº§å“è§’åº¦ï¼Œå¯¹æ ¸å¿ƒç”¨æˆ·åŒæ­¥é£é™©ï¼Œåšå…¬å‘Šå‘¨çŸ¥ï¼Œå¯¹æ‰€æœ‰ç”¨æˆ·åŒæ­¥è¿ç§»äº‹é¡¹ä»¥åŠéœ€è¦æ”¹å˜çš„ç”¨æˆ·ä¹ æƒ¯ï¼Œéƒ½æ˜¯ä¸€ä¸ªè´£ä»»äººéœ€è¦åšçš„äº‹æƒ…ã€‚åœ¨è¿ç§»å®æ“æ–¹é¢ï¼Œä¹Ÿéœ€è¦åšåˆ°æœ‰å†…æµ‹ã€ç°åº¦æ”¾é‡ã€å…¨é‡æ”¾é‡çš„è¿‡ç¨‹ï¼Œå¥½æ¯”è¯´æ¶‰åŠåˆ°æ•°æ®è¿ç§»ï¼Œæ”¾é‡å¯ä»¥éµå¾ª10%-&gt;30%-&gt;60%çš„åŸåˆ™ï¼Œç­–ç•¥æ–¹é¢å¯ä»¥æ ¹æ®ç”¨æˆ·çš„ä½“é‡å’Œä¸åŒä¸šåŠ¡çš„æ•°æ®å­˜å‚¨é‡æ¥å†³å®šå…·ä½“æ”¾é‡çš„å†…å®¹ï¼Œè¿™æ ·å°±å…¼é¡¾æ•°æ®è¿ç§»çš„æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚</p>
<p>å½“ç„¶ï¼Œæ¯”èµ·å¯¹å¤–å‘¨çŸ¥é£é™©ï¼Œå¯¹å†…ä¹Ÿéœ€è¦åšå¥½ç¨³å®šæ€§ä¿éšœï¼Œä¿éšœä¸šåŠ¡é€»è¾‘è¿ç§»è¿‡ç¨‹ä¸­é£é™©å°½é‡å‡å°‘ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—ä¸šåŠ¡ç›‘æ§å’ŒæœåŠ¡ç›‘æ§æ¥åšä¸€ä¸ªå¤§è‡´çš„æŠŠæ¡ï¼Œæ¯”å¦‚ä¸šåŠ¡æŒ‡æ ‡æ–¹é¢è§‚å¯Ÿäº‹åŠ¡æˆåŠŸ/é”™è¯¯ç‡ï¼Œäº‹åŠ¡/ç»“æœé‡çº§çš„å˜åŒ–ï¼ŒæœåŠ¡ç›‘æ§å…³æ³¨latencyã€é”™è¯¯æ—¥å¿—ã€é”™è¯¯è¯·æ±‚ã€panicå´©æºƒä»¥åŠcpu/memoryä¹‹ç±»é€šç”¨å®¹å™¨çš„ç›‘æ§ã€‚å…¶æ¬¡ï¼Œå¯¹äºä¸šåŠ¡æ•ˆæœï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æŸäº›èµ°æ–°ä¸šåŠ¡é€»è¾‘çš„caseé‡Œï¼ŒåŒæ—¶ç°åº¦ä¸€äº›ç”¨æˆ·æ— æ„Ÿçš„è€ä¸šåŠ¡é€»è¾‘æµç¨‹ï¼Œåšä¸€ä¸‹abdiffï¼Œä»è€Œç›´è§‚å¯¹æ¯”æœ€ç»ˆçš„è¿ç§»æ•ˆæœã€‚é€šè¿‡è¿™äº›æ‰‹æ®µï¼Œå°±å¯ä»¥åœ¨çº¿ä¸Šè¿ç§»ä¹‹å‰ï¼Œå°½å¯èƒ½åœ¨çº¿ä¸‹å‘ç°æ›´å¤šçš„é—®é¢˜ï¼Œå‡å°‘çº¿ä¸Šé£é™©ã€‚</p>
<p>æœ€åä¸€ç‚¹ï¼Œå°±æ˜¯å¤§è§„æ¨¡çš„è¿ç§»ï¼Œæœ€å¥½æ˜¯å’ŒåŸæ¥çš„æ•ˆæœä¿æŒä¸€è‡´ï¼ŒåŸåˆ™ä¸Šå°½é‡ä¸è¦å¼•å…¥å…¶ä»–ä¸šåŠ¡æœºåˆ¶å±‚é¢çš„çš„é©æ–°ã€‚ç”¨æˆ·å¯¹äºäº§å“çš„ç©æ³•æ˜¯ä¸°å¯Œå¤šæ ·çš„ï¼Œç”šè‡³æ¯”äº§å“æ›´äº†è§£äº§å“ï¼Œæ¯”å¦‚æ¸¸æˆï¼Œç©å®¶çš„æ”»ç•¥èƒ½åŠ›æ°¸è¿œé¢†å…ˆäºæ¸¸æˆç­–åˆ’ï¼Œç©å®¶å‘ç°bugçš„èƒ½åŠ›æ°¸è¿œé¢†å…ˆäºæ¸¸æˆæµ‹è¯•ã€‚è¿ç§»è¿‡ç¨‹æœ¬èº«å°±å¯èƒ½ä¼šæ”¹å˜å¾ˆå¤šç”¨æˆ·ä¹ æƒ¯ï¼Œæ‰€ä»¥å¦‚æœè¿ç§»ä¹‹åï¼Œè¿˜é¡ºå¸¦åšä¸€äº›æœºåˆ¶ä¸Šçš„é©æ–°ï¼Œé‚£å°±æœ‰è¿èƒŒç”¨æˆ·ä¹ æƒ¯çš„é£é™©ï¼Œæœ€ç»ˆå°±ä¼šå¯¼è‡´äº§å“è¡¨ç°ä¸ç¬¦åˆé¢„æœŸã€‚å¦‚æœä¸€å®šè¦åœ¨è¿ç§»æœŸé—´åšä¸€äº›æœºåˆ¶ä¸Šçš„å˜åŠ¨ï¼Œé‚£ä¹ˆåœ¨çº¿ä¸‹å°±éœ€è¦åšå……åˆ†çš„ç”¨æˆ·è¡Œä¸ºè°ƒç ”ï¼Œå¦åˆ™å»ºè®®æ˜¯åœ¨è¿ç§»ä¹‹åï¼Œæ ¹æ®ç”¨æˆ·å…·ä½“çš„åé¦ˆï¼Œå†é€‰æ‹©æ€§ä¸‹æ‰‹ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>é‡æ„</tag>
        <tag>æ•°æ®è¿ç§»</tag>
        <tag>ç¨³å®šæ€§</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘ä»£ç æ¶æ„æ²»ç†ä¹‹å››å±‚å¢ƒç•Œ</title>
    <url>/2024/06/02/archiart/code_architecture_thinkings/</url>
    <content><![CDATA[<p>æœ€è¿‘é€æ¸å¼€å§‹å†™ä¸€äº›ç®€å•ä¸”ç¨å¾®åŠ¡è™šçš„æ–‡ç« ã€‚åŸå› æœ‰æŒºå¤šï¼Œå…¶ä¸€æ˜¯ï¼Œè‡ªå·±çš„å·¥ä½œå†…å®¹å’Œä¼ä¸šçš„å†…éƒ¨æƒ…å†µç»‘å®šçš„æ›´åŠ æ·±å…¥äº†ï¼Œè®¸å¤šä¿¡æ¯å¦‚æœè¦åœ¨äº’è”ç½‘ä¸Šåˆ†äº«ï¼Œéœ€è¦è€ƒè™‘åœ¨å¾ˆå¤šåœ°æ–¹åšåŠ å·¥ï¼›å…¶äºŒæ˜¯ï¼Œè¿‡åˆ†æ‹˜æ³¥äºéå¸¸æ·±åº¦çš„æŠ€æœ¯æŒ–æ˜ï¼Œå¯èƒ½åªèƒ½æ¶‰åŠåˆ°ä¸€äº›ç‰¹å®šçš„é¢†åŸŸï¼Œä¸åˆ©äºæŠ€æœ¯åšå®¢çš„æŒç»­è¿è¥ï¼Œå¹¶ä¸”ä»è¯»è€…çš„è§†è§’ï¼Œå½¢å¼ç®€å•ä½†å†…å®¹å¯Œæœ‰æ€è€ƒçš„å¹²è´§ï¼Œæ‰æ˜¯çœŸæ­£æœ‰ä»·å€¼çš„äº§å‡ºã€‚</p>
<p>å› æ­¤ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±ä»ç¬”è€…è‡ªå·±çš„è§’åº¦ï¼Œè°ˆä¸€ä¸‹ä»£ç æ¶æ„æ²»ç†çš„å››å±‚å¢ƒç•Œï¼ŒæŠŠè¯»è€…è‡ªå·±æœ€æ·±å±‚çš„æ€è€ƒå†…å®¹ç»™è§£å‰–å‡ºæ¥ã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©åˆ°ä¸€äº›åœ¨ä»£ç æ¶æ„æ²»ç†å·¥ä½œæ–¹é¢ï¼Œæ„Ÿå—åˆ°ç—›ç‚¹çš„åŒè¡Œä»¬ï¼Œè®©å¤§å®¶å¯ä»¥é€šè¿‡æ–‡ç« æåˆ°çš„ä¸€äº›æ€ç»´å·¥å…·ï¼Œå»è§£å†³å®é™…å·¥ä½œä¸­ä»£ç æ¶æ„æ²»ç†æ–¹é¢çš„é—®é¢˜ã€‚</p>
<p>è¿™å››å±‚å¢ƒç•Œåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>å¥—è®¾è®¡æ¨¡å¼</li>
<li>è‡ªä¸Šè€Œä¸‹éœ€æ±‚æ‹†è§£</li>
<li>è‡ªåº•å‘ä¸Šæ¨¡å—æŠ½è±¡</li>
<li>ç½‘çŠ¶æ¦‚å¿µèšç±»åˆ†å±‚</li>
</ol>
<a id="more"></a>
<p>ç¬¬ä¸€å±‚å¢ƒç•Œæ˜¯å¥—è®¾è®¡æ¨¡å¼ã€‚çŠ¹è®°å¾—åˆšå¼€å§‹æ¥è§¦ä»£ç å·¥ç¨‹æ¶æ„çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è¢«çŒè¾“äº†å¾ˆå¤šè®¾è®¡æ¨¡å¼ç›¸å…³çš„æ¦‚å¿µï¼Œå°åˆ°å·¥å‚ã€è´£ä»»é“¾ï¼Œå¤§åˆ°DDDã€BDDã€‚è¿™äº›çœ‹èµ·æ¥å¾ˆé«˜å¤§ä¸Šçš„åå­—ï¼Œå®ƒä»¬çš„å®è´¨æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å·¥å…·ï¼Œæ˜¯æœ€ä¸ºåŸºç¡€çš„ä»£ç æ¶æ„æ€ç»´å·¥å…·ã€‚ä¸€ä¸ªå·¥å…·è¦æœ‰ç”¨æ­¦ä¹‹åœ°ï¼Œå¿…ç„¶æœ‰å…¶èƒŒååˆé€‚çš„ä¸šåŠ¡åœºæ™¯ã€‚ç†è®ºä¸Šæ¥è®²ï¼Œå¤§å¤šæ•°çš„ä»£ç æ¶æ„é—®é¢˜ï¼Œé€šè¿‡å¥—è®¾è®¡æ¨¡å¼ï¼Œéµå¾ªåŸºæœ¬çš„é‡æ„åŸåˆ™ï¼Œéƒ½æ˜¯å¯ä»¥è§£å†³çš„ã€‚</p>
<p>è®¾è®¡æ¨¡å¼ä¸èƒ½è§£å†³çš„é—®é¢˜æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæœªçŸ¥çš„é¢†åŸŸã€‚é€šä¿—åœ°ç†è§£ï¼Œè®¾è®¡æ¨¡å¼å°±æ˜¯å‰äººå·²æœ‰çš„ç»éªŒï¼Œåœ¨æŸç±»ä¸šåŠ¡æˆ–è€…æŠ€æœ¯åœºæ™¯ä¹‹ä¸‹ï¼Œæ²‰æ·€å‡ºæ¥çš„ä¸€å¥—ä»£ç èŒƒå¼ã€‚ä½†é¢å¯¹æœªçŸ¥çš„é¢†åŸŸï¼Œä»¥å‰çš„è®¾è®¡æ¨¡å¼æ˜¯å¦å¯ä»¥èµ·ä½œç”¨ï¼Œå“ªäº›è®¾è®¡æ¨¡å¼æœ€ä¸ºé€‚åˆï¼Œéƒ½ä¸æ˜¯èƒ½å¤Ÿç›´æ¥æ— è„‘ç¡®å®šçš„ã€‚æœªçŸ¥çš„é¢†åŸŸèƒŒåï¼Œæœ¬è´¨ä¸Šæ˜¯æœªçŸ¥çš„æ¦‚å¿µè”ç³»ï¼Œå¦‚æœç›´æ¥å¥—ç”¨æŸç±»è®¾è®¡æ¨¡å¼ï¼Œé‚£ä¹ˆå°†æ¥å¦‚æœå¼•å…¥æ–°çš„éœ€æ±‚åœºæ™¯ï¼Œæ—¢å¾€çš„è®¾è®¡æ¨¡å¼ä¸é€‚ç”¨ï¼Œå°±ä¼šå‡ºç°é‡æ„æˆæœ¬ã€‚</p>
<p>ç°ä»Šæœ‰å¾ˆå¤šæŠ€æœ¯åŒè¡Œçš„ç®€å†æˆ–è€…PPTä¸Šï¼Œéƒ½å¯èƒ½å†™é€šè¿‡DDDã€BDDçš„æ€æƒ³ï¼Œè§£å†³äº†æŸç±»æŠ€æœ¯é—®é¢˜ã€‚ä»ç¬”è€…çš„è§’åº¦è®¤ä¸ºï¼Œä¸åŒé¢†åŸŸçš„æ¦‚å¿µæ¨¡å‹å…¶å®æ˜¯äº”èŠ±å…«é—¨çš„ï¼Œå¦‚æœçœŸçš„æŸç±»åœºæ™¯ç”¨äº†ç»å…¸æ–¹æ³•è§£å†³ï¼Œè¦ä¹ˆæ˜¯è¿™ç±»åœºæ™¯å·²ç»è¢«ç ”ç©¶é€äº†ï¼Œæ¶æ„å±‚é¢ç¼ºä¹åˆ›æ–°æ½œè´¨ï¼Œè¦ä¹ˆæ˜¯è‡ªèº«å®åŠ›ä¸è¶³ï¼Œå¯¹æŠ€æœ¯ç¼ºä¹ç‹¬ç«‹æ€è€ƒï¼Œæ²¡æœ‰èƒ½åŠ›å»çµæ´»è°ƒé…ä»£ç çš„æ¶æ„ï¼Œåªèƒ½é€šè¿‡æ—¢æœ‰çš„æ€ç»´å»ç”Ÿæ¬ç¡¬å¥—ã€‚å¦‚æœæœ‰æ„è¯†åœ¨ç®€å†æˆ–PPTé‡çªå‡ºè¿™ç±»ä¿¡æ¯ï¼Œè¿™æ ·çš„äººæ‰ï¼Œå‡ä½¿é¢å¯¹æœªçŸ¥çš„ä¸šåŠ¡æˆ–æŠ€æœ¯é¢†åŸŸï¼Œä¸€å®šå¾ˆéš¾æœ‰èƒ½åŠ›å»coverä½ä»£ç æ¶æ„ã€‚å¥—è®¾è®¡æ¨¡å¼çš„æ˜¯ä¸€ç±»äººï¼Œå¦‚ä»Šï¼Œå¥—GPTçš„ä¹Ÿæ˜¯è¿™ä¸€ç±»äººã€‚</p>
<p>ç¬¬äºŒå±‚å¢ƒç•Œæ˜¯è‡ªä¸Šè€Œä¸‹éœ€æ±‚æ‹†è§£ã€‚éœ€æ±‚æ‹†è§£å¯ä»¥è§£å†³æœªçŸ¥é¢†åŸŸä»£ç å»ºæ¨¡çš„é—®é¢˜ï¼Œå¼¥è¡¥çº¯è®¾è®¡æ¨¡å¼çš„ä¸è¶³ã€‚åšä»£ç æ¶æ„ï¼Œæœ¬èº«å³æ˜¯å¯¹æŸç±»ä¸šåŠ¡æˆ–æŠ€æœ¯åœºæ™¯çš„å»ºæ¨¡ï¼Œå½“æˆ‘ä»¬éœ€è¦è§£å†³æŸäº›å…·ä½“çš„é—®é¢˜æ—¶ï¼Œä¸€ä¸ªæœ€ç®€ä¾¿çš„åŠæ³•æ˜¯å¯¹éœ€æ±‚æœ¬èº«åšæ‹†è§£ï¼Œæ¯”å¦‚ç”¨é‡‘å­—å¡”æ¨¡å‹ï¼ŒæŠŠå¤§çš„é—®é¢˜åˆ’åˆ†ä¸ºå°çš„é—®é¢˜ï¼Œç„¶ååˆ†è€Œæ²»ä¹‹ã€‚è¿™æ ·çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å»æ„å»ºå‡ºæ¨¡å—åŒ–ã€ä½è€¦åˆçš„ä»£ç æ¶æ„æ¨¡å‹ï¼Œå› ä¸ºæ¯ä¸€ä¸ªéœ€æ±‚çš„å­é—®é¢˜éƒ½å¯ä»¥ç”¨å•ç‹¬çš„ä¸€å¥—ä»£ç å»è§£å†³ã€‚å¹¶ä¸”ï¼Œåœ¨ååŒå¼€å‘åœºæ™¯ä¸‹ï¼Œè¿˜èƒ½å¤Ÿä¿è¯å„å¸å…¶èŒï¼Œäº’ä¸å¹²æ‰°ï¼Œå½¢æˆä¸€å¥—å¾ˆå®Œå–„çš„å¼€å‘ä½“ç³»ã€‚</p>
<p>è‡ªä¸Šè€Œä¸‹éœ€æ±‚æ‹†è§£ï¼Œè§£å†³ä¸äº†çš„é—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ï¼šè®¤çŸ¥çš„ä¸€è‡´æ€§ã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjQvMDIvMTUvYXJjaGlhcnQvc3VzdGFpbmFibGVfYXJjaGl0ZWN0dXJlLw==" title="https://utmhikari.top/2024/02/15/archiart/sustainable_architecture/">å…ˆå‰çš„ä¸€ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>é‡Œï¼Œé€šè¿‡ä¸€ä¸ªè‡ªåŠ¨åŒ–æ¡†æ¶çš„ä¾‹å­å°±è¯´æ˜äº†è¿™ä¸ªé“ç†ï¼Œéœ€æ±‚æ‹†è§£æ˜¯è‡ªä¸Šè€Œä¸‹çš„ï¼Œä½†æŠ€æœ¯å®ç°æ˜¯è‡ªåº•å‘ä¸Šçš„ã€‚ä¸ºä»€ä¹ˆè¦è‡ªåº•å‘ä¸Šï¼Œå…¶æœ¬è´¨è¯‰æ±‚å°±æ˜¯åœ¨å·¥ç¨‹åˆå§‹åŒ–ç¯èŠ‚ï¼ŒæŠŠæœ€åŸºç¡€çš„è®¤çŸ¥æ¦‚å¿µç»™ç»Ÿä¸€æŠ½è±¡èµ·æ¥ï¼Œè®¤çŸ¥çš„ä¸€è‡´æ€§è¶Šå¤šï¼Œä»£ç éœ€è¦å—è¿«ç»´æŠ¤çš„å†…å®¹å°±ä¼šè¶Šå°‘ã€‚å¦‚æœåœ¨å·¥ç¨‹ä»£ç å¼€å‘æ–¹é¢ï¼Œæ— è„‘é€šè¿‡éœ€æ±‚æ‹†è§£çš„æ–¹å¼æ„å»ºä¸åŒçš„æ¨¡å—ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šå‡ºç°å¾ˆå¤šå…·å¤‡é‡å¤æ„ä¹‰çš„ä»£ç ã€‚ä¹…è€Œä¹…ä¹‹ï¼Œå°±ä¼šå½¢æˆæŠ€æœ¯å€ºã€‚</p>
<p>å› æ­¤ï¼Œè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è¸å…¥ç¬¬ä¸‰å±‚å¢ƒç•Œï¼Œè‡ªåº•å‘ä¸Šæ¨¡å—æŠ½è±¡ã€‚å½“éœ€æ±‚è‡ªä¸Šè€Œä¸‹æ‹†è§£å®Œæˆåï¼Œè¿˜æœ‰ä¸€ä¸ªé‡è¦æ­¥éª¤æ˜¯ï¼ŒæŠŠæœ€åº•å±‚éœ€æ±‚æ¶‰åŠçš„å…±æ€§æ¦‚å¿µç»™æŠ½è±¡å‡ºæ¥ï¼Œæ„å»ºæˆä¸€å¥—å…¬ç”¨åŸºæ¶ã€‚è¿™å¥—åŸºæ¶ä¸ä»…æ˜¯æå‡äº†ä»£ç çš„æ˜“ç»´æŠ¤æ€§ï¼Œè€Œä¸”æ›´é‡è¦çš„ï¼Œæ˜¯å†³å®šäº†è¿™ä¸ªé¢†åŸŸçš„åŸºæœ¬æ¦‚å¿µè®¤çŸ¥ã€‚ä»¥æ¸¸æˆå¼€å‘ä¸ºä¾‹å­ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯ç ”å‘å›¢é˜Ÿï¼Œé™¤äº†ä¸šåŠ¡Gameplayç ”å‘çš„æˆå‘˜ä¹‹å¤–ï¼Œä¸€å®šè¿˜æœ‰éƒ¨åˆ†æˆå‘˜ä¼šä¸“æ”»æ¸¸æˆå¼•æ“çš„ç ”å‘ï¼Œå»åšå¥½æ•´å—å®¢æˆ·ç«¯ä»£ç çš„åŸºæ¶ã€‚æœ‰äº†è¿™ä¸ªåŸºæ¶ï¼Œå°±ä¸å®¹æ˜“å‡ºç°ä½ å®ç°ä¸€å¥—ï¼Œæˆ‘å®ç°ä¸€å¥—çš„é—®é¢˜ï¼Œä»è€Œè®©æ•´ä¸ªå·¥ç¨‹æ¶æ„çš„åº•å±‚é€»è¾‘éƒ½é€šé¡ºèµ·æ¥ã€‚</p>
<p>å¯¹äºä¸€äº›å°çš„ç ”å‘å›¢é˜Ÿï¼Œæˆ–è€…æ˜¯ä¸ªäººå¼€å‘è€…ï¼Œåœ¨å·¥ç¨‹ä»£ç çš„å‘ˆç°æ–¹é¢ï¼Œå¾ˆå®¹æ˜“å‡ºç°è¸å…¥ç¬¬äºŒå±‚å¢ƒç•Œï¼Œä½†æ— æ³•è¸å…¥ç¬¬ä¸‰å±‚å¢ƒç•Œçš„æƒ…å†µï¼Œå¯¼è‡´å·¥ç¨‹èƒ½åŠ›ä¸èƒ½é•¿ä¹…è¿­ä»£ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•å°±æ˜¯ï¼Œä¸‹æ‰‹æ…¢ä¸€æ‹ã€‚å¦‚æœæ˜¯åœ¨æ—¶é—´ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œéœ€è¦æ³¨æ„åœ¨å†™å®ŒdemoæœŸä»£ç ä¹‹åï¼Œé¡ºä¾¿æ„æ€å¥½ä»£ç é‡æ„çš„è·¯å¾„ï¼Œç•™æœ‰åæ‰‹ã€‚åšå‡º10åˆ†ï¼Œäº¤ä»˜7åˆ†ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä¿è¯å·¥ä½œäº§å‡ºçš„å¼¹æ€§ã€‚</p>
<p>å½“ç„¶ï¼Œè‡ªåº•å‘ä¸Šæ¨¡å—æŠ½è±¡ï¼Œä¹Ÿæœ‰è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯æ¦‚å¿µåˆ†å±‚ã€‚å¦‚æœä¸€å‘³é™·å…¥å…±æ€§æŠ½è±¡ï¼Œä¸€å‘³é€šè¿‡ã€åŠ ä¸€å±‚ã€‘çš„æ–¹æ³•è§£å†³æŠ€æœ¯é—®é¢˜ï¼Œå°±å®¹æ˜“å‡ºç°å±‚æ¬¡å†—ä½™ï¼Œéš¾ä»¥é‡æ„çš„æƒ…å†µã€‚ä¸€å¥—æŠ½è±¡ä¸‹æ¥ï¼Œçœ‹èµ·æ¥ä»£ç å¯è¯»æ€§ä¸é”™ï¼Œä½†æ•´ä¸ªå·¥ç¨‹çš„å†…åœ¨ç»“æ„å¤ªå¤æ‚ï¼Œå°±ä¼šå¯¼è‡´å¯è¯»æ€§ä¸é«˜ã€‚è™½ç„¶æ¯å—ä»£ç çš„è´£ä»»æ˜¯åˆ†æ˜äº†ï¼Œä½†ä¸åŒæ¨¡å—ä¹‹é—´çš„å…³ç³»å¾ˆä¸æ¸…æ™°ã€‚Aè°ƒäº†Bï¼ŒBè°ƒäº†Cï¼ŒCåˆè°ƒäº†Aï¼Œä»è€Œå¯¼è‡´ä»£ç ä¹‹é—´å‡ºç°å¾ªç¯ä¾èµ–çš„é£é™©ã€‚ç„¶åï¼Œå“ªå¤©é¡¹ç›®éœ€è¦å‡çº§äº†ï¼Œè¦ä¹ˆå°±æ˜¯å¼„ä¸ªV2ï¼Œè¦ä¹ˆè¿˜å¾€åŸæ¥çš„å±‚æ¬¡ä¸ŠåŠ ï¼Œè¿™æ ·å°±ä¼šé™ä½æ•´ä¸ªé¡¹ç›®çš„å¯è¿ç§»å¯å¤ç”¨èƒ½åŠ›ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦è¸å…¥ç¬¬å››å±‚å¢ƒç•Œï¼Œç½‘çŠ¶æ¦‚å¿µèšç±»åˆ†å±‚ã€‚æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸ªæœ¬è´¨æ˜¯ï¼Œä¸è®ºæ˜¯é‚£ç§ä¸šåŠ¡æˆ–æŠ€æœ¯é¢†åŸŸï¼Œåº•å±‚æ¦‚å¿µä¹‹é—´çš„å…³ç³»ï¼Œéƒ½æ˜¯ç½‘çŠ¶ç»“æ„çš„ã€‚é€šè¿‡çº¯ä»£ç çš„æ–¹å¼ï¼Œä¸å¯èƒ½æ¨¡æ‹Ÿç½‘çŠ¶ç»“æ„çš„æ¦‚å¿µï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡èšç±»åˆ†å±‚çš„æ–¹å¼ï¼ŒæŠŠä¸€äº›åŒè´¨çš„æ¦‚å¿µæ”¾åˆ°ç›¸åŒçš„å±‚æ¬¡ï¼Œå¹¶ä¸”åŒæ—¶ä¿è¯å±‚æ¬¡çš„æ•°é‡å°½é‡å°‘ï¼Œä»è€Œåœ¨å°½å¯èƒ½ç®€æ˜å·¥ç¨‹æ¶æ„çš„åŒæ—¶ï¼Œè¾¾åˆ°éœ€æ±‚é¢„æœŸçš„æ•ˆæœã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•å»æŠŠèšç±»åˆ†å±‚è¿™ä¸ªäº‹æƒ…ç»™åšå¥½å‘¢ï¼Ÿä¸€ä¸ªé‡è¦çš„å…³é”®ç‚¹å°±æ˜¯ï¼Œæ ¹æ®ä¸åŒçš„è§†è§’ï¼Œæ¥åˆ’åˆ†ä¸åŒçš„å±‚æ¬¡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªåç«¯æœåŠ¡ï¼Œä»æœåŠ¡æ¡†æ¶çš„è§†è§’ï¼Œå¯ä»¥åˆ†å‡ºæ¥handler/service/dal/utilå‡ ä¸ªå±‚æ¬¡ï¼›ä»ä¸šåŠ¡è§†è§’ï¼Œå¯ä»¥åœ¨serviceå†…éƒ¨ï¼Œåˆ†å‡ºæ¥app/core/3rdç­‰å‡ ä¸ªå±‚æ¬¡ï¼ˆå½“ç„¶ï¼Œå¾®æœåŠ¡çš„è¯ï¼Œå¯ä»¥æŠŠ3rdæåˆ°å¤–é¢ï¼Œappè·Ÿcoreéƒ½ä¸è¦ï¼‰ã€‚åŸºæœ¬ä¸Šä¸€ä¸ªåç«¯é¡¹ç›®ï¼Œä»£ç æœ€å¤š3ï½4å±‚å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œå¦‚æœè¿˜å­˜åœ¨éœ€è¦åŠ ä¸€å±‚çš„æƒ…å†µï¼Œå°±ä»æ›´é«˜çš„æœåŠ¡æ¶æ„ç»´åº¦å»è§£å†³ï¼Œè€Œä¸æ˜¯å†æ‹˜æ³¥äºå·²æœ‰çš„ä»£ç é¡¹ç›®ã€‚</p>
<p>åˆ†æ¸…æ¯å—ä»£ç çš„è´£ä»»å¾ˆé‡è¦ï¼Œä½†å¦‚ä½•æ„å»ºæ¯å—ä»£ç çš„å±‚æ¬¡æ¢¯åº¦ä¹Ÿå¾ˆé‡è¦ã€‚è§£å†³äº†ä½è€¦åˆé—®é¢˜ï¼Œä¹Ÿè¦è§£å†³é«˜å†…èšé—®é¢˜ï¼Œè¿™æ ·æ‰èƒ½è®©æ•´ä¸ªä»£ç çš„æ¶æ„å˜å¾—æ¸¸åˆƒæœ‰ä½™ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>é‡æ„</tag>
        <tag>é¢è¯•</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘æ·±åœ³ä¸‡è±¡å¤©åœ°é¤é¦†æ¢åº—ç‚¹è¯„</title>
    <url>/2024/05/12/diymemo/sz_wxtd/</url>
    <content><![CDATA[<p>ç¬¬ä¸€æ¬¡åœ¨æŠ€æœ¯åšå®¢é‡Œé¢å†™ç”Ÿæ´»æ—¥è®°ï¼Œä¹Ÿç®—æ˜¯ç ´äº†ä¸ªå°å¤©è’ã€‚ä¸ªäººä»¥ä¸ºï¼Œåšå®¢æ˜¯ä¸ªäººç”Ÿæ´»æ€è€ƒçš„è½½ä½“ï¼Œè€ŒæŠ€æœ¯åªå ç”Ÿæ´»çš„ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆåšå®¢é‡Œä¸ºä»€ä¹ˆä¸€å®šè¦é™åˆ¶åªèƒ½å¤Ÿå†™æŠ€æœ¯å†…å®¹ï¼Œä¸èƒ½å†™ç‚¹å…¶å®ƒç”Ÿæ´»ä¸Šçš„ä¸œè¥¿å‘¢ï¼Ÿæ€æ¥æƒ³å»ï¼Œè¿‘å‡ å¹´åœ¨<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTQlQjglODclRTglQjElQTElRTUlQTQlQTklRTUlOUMlQjAvMTA2Nzg1OTg=" title="https://baike.baidu.com/item/%E4%B8%87%E8%B1%A1%E5%A4%A9%E5%9C%B0/10678598">æ·±åœ³ä¸‡è±¡å¤©åœ°<i class="fa fa-external-link"></i></span>å’Œå¥¹ä¸€èµ·æ¢è¿‡ä¸å°‘é¤é¦†ï¼Œåƒè¿‡ä¸å°‘ä¸œè¥¿ã€‚äºæ˜¯ä¹ï¼Œå†³å®šå†™ä¸€ç¯‡ä¸‡è±¡å¤©åœ°é¤é¦†æ¢åº—ç‚¹è¯„ï¼Œç»™æ²¡æ¥è¿‡æˆ–è€…æƒ³æ¥æ·±åœ³ä¸‡è±¡å¤©åœ°çš„äººä¸€äº›å‚è€ƒï¼Œå°‘ç‚¹è¸©å‘ã€‚</p>
<p>æœ¬æ–‡è¯„ä»·çº¯ç²¹ç»¼åˆå¥¹å’Œè‡ªå·±çš„ä¸»è§‚æ„è§ï¼Œèƒƒå£åˆ†å¸ƒäºåŒ—äº¬ã€æ±Ÿå—è·Ÿå¹¿ä¸œï¼Œç¨åå’¸å£ã€‚æœ‰äº›åº—å¯èƒ½å¾ˆé•¿æ—¶é—´æ²¡å»äº†ï¼Œæ‰€ä»¥åªèƒ½åŸºäºä¸»è§‚å°è±¡ç»™åˆ†ã€‚æ»¡åˆ†5æ˜Ÿï¼Œ4æ˜Ÿä»¥ä¸Šæ¨èåœ¨çº¿ä¸‹åšå¤šåˆ·ã€‚è¯¦ç»†è¯„åˆ†å†…å®¹å¦‚ä¸‹:</p>
<a id="more"></a>
<p><img src="/uploads/diymemo/sz_wxtd/wxtd_score.png" alt="è¯„åˆ†è¡¨æ ¼"></p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>ä¸ªäººåšå®¢</tag>
        <tag>ç”¨æˆ·</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘ç”¨çˆ¬è™«+clean-mark+zhihu-on-vscodeæ¬è¿æŠ€æœ¯åšå®¢åˆ°çŸ¥ä¹</title>
    <url>/2024/05/01/diymemo/zhihu_blog_migrate/</url>
    <content><![CDATA[<p>ä»Šå¤©çµå…‰ä¸€é—ªï¼Œå†³å®šè°ƒç ”ä¸€ä¸‹è‡ªå·±çš„æŠ€æœ¯åšå®¢ï¼Œå¯ä»¥æ€æ ·æ–¹ä¾¿è¿ç§»åˆ°å…¶å®ƒç¤¾åª’å¹³å°ã€‚æƒ³è¦è¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼ŒæŠŠè‡ªå·±åœ¨æ˜é‡‘çš„ä¸“æ ï¼š<span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vY29sdW1uLzcyNDAzMzM3NzkyMjMzMzA4NzI=" title="https://juejin.cn/column/7240333779223330872">ä»1åˆ°âˆç²¾é€šPython<i class="fa fa-external-link"></i></span>ï¼Œè¿ç§»åˆ°çŸ¥ä¹ä¸Šé¢å»ã€‚</p>
<p>ç®€å•èŠ±äº†ä¸¤ä¸‰å°æ—¶æ—¶é—´ï¼Œæ‰¾åˆ°ä¸€ä¸ªæ¯”è¾ƒå¿«æ·çš„æ–¹æ³•ï¼Œå°±æ˜¯ç»“åˆpythonçˆ¬è™«ã€clean-markå·¥å…·å’Œzhihu-on-vscodeæ’ä»¶ï¼Œå®ç°ä»æ˜é‡‘åˆ°çŸ¥ä¹çš„æ–‡ç« æ¬è¿ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ˜¯çˆ¬è™«ï¼Œç»™å®šä¸€ä¸ªæ˜é‡‘ä¸“æ çš„urlï¼Œç›´æ¥getå°±èƒ½æ‹¿åˆ°æ•´ä¸ªç½‘é¡µä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿™ä¸ªä¸“æ çš„æ ‡é¢˜ã€æè¿°è¿˜æœ‰æ‰€æœ‰æ–‡ç« çš„æ ‡é¢˜è·ŸURLã€‚ç”¨BeautifulSoupå†™ä¸ª50è¡Œå·¦å³è§£æä¸€ä¸‹ï¼Œå°±èƒ½å¤ŸæŠŠæ‰€æœ‰ä¿¡æ¯ç»™æ‹¿å‡ºæ¥ã€‚</p>
<p>ç„¶åæ˜¯ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nyb3Fhei9jbGVhbi1tYXJr" title="https://github.com/croqaz/clean-mark">clean-mark<i class="fa fa-external-link"></i></span>ï¼Œéå†æ‰€æœ‰çš„æ–‡ç« urlï¼Œå°±èƒ½å¤ŸæŠŠæ‰€æœ‰æ–‡ç« çš„markdownç»™æ‹¿å‡ºæ¥ã€‚</p>
<p>æœ€åæ˜¯ç”¨zhihu-on-vscodeæ’ä»¶ï¼ŒæŠŠmarkdownæ–‡ä»¶ç›´æ¥ä¸Šä¼ åˆ°çŸ¥ä¹ã€‚çŸ¥ä¹å¹³å°æœ¬èº«ä¸æ”¯æŒå¤åˆ¶markdownæ–‡æœ¬ï¼Œä½†æ”¯æŒå¯¼å…¥markdownæ–‡ä»¶ã€‚è¿™ä¸ªæ’ä»¶æŠŠçŸ¥ä¹çš„å¹³å°äº¤äº’æ”¶æ•›åˆ°äº†vscodeé‡Œï¼Œå¹¶ä¸”èƒ½ç›´æ¥ä¸Šä¼ markdownåˆ°ä¸“æ ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<p>é€šè¿‡è¿™ä¸‰ä¸ªå·¥å…·çš„ç»“åˆï¼Œç¬”è€…èŠ±äº†ä¸€ä¸ªä¸Šåˆï¼Œå°±å®ç°äº†æ‰€æœ‰Pythonä¸“æ æ–‡ç« çš„æ¬è¿ã€‚æ–°ä¸“æ çš„é“¾æ¥åœ¨<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL2NvbHVtbi9jXzE3NjkwMzY5NTI2ODUzNzk1ODU=" title="https://www.zhihu.com/column/c_1769036952685379585">è¿™é‡Œ<i class="fa fa-external-link"></i></span>ï¼Œå¦‚æœä½ æƒ³å½»åº•æ‹¿æPythonï¼Œé‚£è¿™ä¸ªå°±æ˜¯ä½ çš„èœã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
        <tag>BeautifulSoup</tag>
        <tag>clean-mark</tag>
        <tag>zhihu-on-vscode</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘è¯»2023ç¾å›¢æŠ€æœ¯å¹´è´§çš„ä¸€äº›ç¬”è®°</title>
    <url>/2024/05/01/geekdaily/meituan_tech_notes/</url>
    <content><![CDATA[<p>æ­£ç›´åŠ³åŠ¨èŠ‚ï¼Œç¿»äº†ä¸‹2023å¹´ç¾å›¢çš„<span class="exturl" data-url="aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMjQvMDIvMDEvMjAyMy1zcHJpbmctZmVzdGl2YWwtcHJlc2VudC5odG1s" title="https://tech.meituan.com/2024/02/01/2023-spring-festival-present.html">æŠ€æœ¯å¹´è´§<i class="fa fa-external-link"></i></span>ï¼ŒæŒ‘é€‰äº†ä¸€äº›å’Œå˜æ›´é£é™©é˜²æ§å’Œç¨³å®šæ€§å»ºè®¾ç›¸å…³ä¸»é¢˜çš„æ–‡ç« åšäº†ä¸‹æµ…è¯»ã€‚æœ¬æ–‡ä»…ç®€å•è®°ä¸€ä¸‹é˜…è¯»ç¬”è®°ã€‚</p>
<p>æ€»å…±é€‰è¯»äº†3ç¯‡æ–‡ç« ï¼Œåˆ†åˆ«æ˜¯ã€ŠåŸºäºAI+æ•°æ®é©±åŠ¨çš„æ…¢æŸ¥è¯¢ç´¢å¼•æ¨èã€‹ã€ã€Šä»£ç å˜æ›´é£é™©å¯è§†åŒ–ç³»ç»Ÿå»ºè®¾ä¸å®è·µã€‹ï¼Œä»¥åŠã€ŠAIOpsåœ¨ç¾å›¢çš„æ¢ç´¢ä¸å®è·µâ€”â€”äº‹ä»¶ç®¡ç†ç¯‡ã€‹ã€‚</p>
<a id="more"></a>
<p>ç¬¬ä¸€ç¯‡æ˜¯AIæ¨èæ…¢æŸ¥è¯¢ç´¢å¼•ã€‚å®ç°æ¨èä¸»è¦çš„æ–¹å¼æ˜¯ï¼Œæ”¶é›†å¤§é‡çº¿ä¸ŠSQLçš„ç´¢å¼•å¼•ç”¨æ•°æ®ï¼Œä½œä¸ºè®­ç»ƒé›†ï¼Œå†æ ¹æ®çº¿ä¸Šæ…¢æŸ¥è¯¢çš„å®é™…æƒ…å†µï¼Œå»æ¨æ–­è¡¥å……å“ªä¸€ç»„ç´¢å¼•æ¯”è¾ƒåˆé€‚ã€‚è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥ä½œä¸ºæ…¢æŸ¥è¯¢æ²»ç†çš„ä¸€ä¸ªç¯èŠ‚ï¼Œå¹¶ä¸”é€šè¿‡ç›¸ä¼¼åº“è¡¨çš„ç´¢å¼•åˆ†æï¼Œç”šè‡³åœ¨æ…¢æŸ¥è¯¢æ²¡æœ‰å‡ºç°çš„æƒ…å†µä¸‹â€œæ²»æœªç—…â€ï¼Œè€Œä¸æ˜¯ç­‰åˆ°æ…¢æŸ¥è¯¢å®é™…å‡ºç°åå†åšç´§æ€¥ä¿®å¤ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹æ˜¯æŒºæœ‰ä»·å€¼çš„ã€‚</p>
<p>ç¬¬äºŒç¯‡æ˜¯ä»£ç é£é™©å¯è§†åŒ–å»ºè®¾ã€‚å®é™…é˜…è¯»çš„æ—¶å€™ï¼Œæ¯”èµ·ä»£ç åˆ†æçš„æŠ€æœ¯ï¼Œä¼šæ›´åŠ å…³æ³¨è¿™å¥—å¯è§†åŒ–èƒ½åŠ›æ‰€èµ‹èƒ½çš„åœºæ™¯ã€‚ä»å˜æ›´é£é™©é˜²æ§è§’åº¦ï¼Œå˜æ›´å½±å“é¢åˆ†æä¸€ç›´æ˜¯ä¸€ç±»éš¾ç‚¹ï¼Œè¿™å¥—æ–¹æ¡ˆåˆ™ä»ä»£ç å·¥ç¨‹ç±»å‹ã€é£é™©ç‰¹å¾è¯†åˆ«ã€å¯å®šåˆ¶åŒ–é£é™©ã€å•æœåŠ¡/è·¨æœåŠ¡å½±å“ç­‰å±‚é¢åšäº†å¤šç»´åº¦çš„åˆ†æï¼Œå¹¶ä¸”è¿™äº›åˆ†æå†…å®¹å¯ä»¥é¢å¤–è¾…åŠ©åˆ°é…ç½®å˜æ›´å½±å“åˆ¤æ–­å’Œæ¥å£è‡ªåŠ¨åŒ–ç”¨ä¾‹æ¨èä¸Šï¼Œæ•´ä½“æ¥çœ‹å¯åº”ç”¨çš„åœºæ™¯æ¯”è¾ƒå¹¿æ³›ã€‚</p>
<p>åŒæ—¶ï¼Œåœ¨ä»£ç é£é™©å¯è¯»æ€§æ–¹é¢ï¼Œæä¾›äº†ä¸Šä¸‹æ¸¸è·³è½¬å’Œå®æ—¶é“¾è·¯æ‹“æ‰‘çš„è¯•å›¾ï¼Œä»CRçš„è§’åº¦æ¥è¯´ä¹Ÿæ˜¯éå¸¸åŠæ—¶çš„ï¼Œè€Œä¸æ˜¯ç­‰åˆ°å˜æ›´ä¸Šçº¿çš„æ—¶å€™å†ç»™ä¸€ä¸ªè¡€ç¼˜åˆ†æçš„å½±å“é¢è§†å›¾ã€‚</p>
<p>ç¬¬ä¸‰ç¯‡æ˜¯AIOpsåœ¨ç¾å›¢çš„æ¢ç´¢ä¸å®è·µï¼Œä¸»è¦ä¾§é‡äºäº‹ä»¶ç®¡ç†éƒ¨åˆ†ã€‚å˜æ›´äº‹ä»¶æ˜¯ç†è§£å˜æ›´è¿‡ç¨‹çš„æ ¸å¿ƒä¿¡æ¯æ¥æºï¼Œä½†å­˜åœ¨æ•°æ®å¤æ‚å¤šæ ·åŒ–ã€é¢†åŸŸçŸ¥è¯†å¼ºç­‰å¤æ‚çš„é—®é¢˜ã€‚ä»äº‹ä»¶ç®¡ç†è§’åº¦ï¼Œç¾å›¢ç»™å‡ºäº†é£é™©é¢„é˜²ã€æ•…éšœå‘ç°ã€äº‹ä»¶å¤„ç†å’Œäº‹ä»¶è¿è¥ç­‰å‡ ä¸ªç»´åº¦çš„èƒ½åŠ›ã€‚</p>
<p>åœ¨é£é™©è¯†åˆ«æ–¹é¢ï¼Œä¸»è¦ä¾èµ–é…ç½®æ–‡æœ¬/ç»“æ„åˆæ³•æ€§æ£€æŸ¥ä»¥åŠç°åº¦&amp;æœªå˜æ›´&amp;å†å²å˜æ›´çš„ABDiffå»æ¢æµ‹æŒ‡æ ‡å¼‚å¸¸ã€‚åœ¨æ•…éšœå‘ç°å’Œäº‹ä»¶å¤„ç†æ–¹é¢ï¼Œä¸»è¦é€šè¿‡å¼‚å¸¸é“¾è·¯æ‹“å±•è§†å›¾ã€ç›¸ä¼¼äº‹ä»¶æ¨èï¼Œå¸®åŠ©å˜æ›´äººåŠæ—¶çœ‹æ¸…çº¿ä¸Šé—®é¢˜ï¼Œæ‰¾åˆ°å¯å€Ÿé‰´çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨äº‹ä»¶è¿è¥æ–¹é¢ï¼Œåˆ™æä¾›äº†ä¸€å¥—å¤ç›˜ç³»ç»Ÿã€‚æ•´ä½“æ¥çœ‹ï¼Œèƒ½å¤Ÿæ»¡è¶³å˜æ›´é£é™©ç®¡ç†çš„åŸºæœ¬è¯‰æ±‚ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>AI</tag>
        <tag>DevOps</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>æ…¢æŸ¥è¯¢</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘ç”¨OCRå’Œå¤§æ¨¡å‹GPTç”Ÿæˆçš„ã€Šè½¯ä»¶ç ”å‘æ•ˆèƒ½æƒå¨æŒ‡å—ã€‹è¯»ä¹¦ç¬”è®°</title>
    <url>/2024/04/21/diymemo/devops_ai_memo/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><span class="exturl" data-url="aHR0cHM6Ly9ib29rLmRvdWJhbi5jb20vc3ViamVjdC8zNjExNjM3NS8=" title="https://book.douban.com/subject/36116375/">ã€Šè½¯ä»¶ç ”å‘æ•ˆèƒ½æƒå¨æŒ‡å—ã€‹<i class="fa fa-external-link"></i></span>ä¸€ä¹¦ï¼Œå¯¹äºè½¯ä»¶ç ”å‘æ•ˆèƒ½DevOpsé¢†åŸŸåšä»€ä¹ˆäº‹æƒ…ï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œç»™å‡ºäº†éå¸¸å…¨é¢è¯¦å°½çš„è¯´æ˜ã€‚è¿™æœ¬ä¹¦çš„ç²¾åï¼ŒåŸºæœ¬å…¨éƒ¨éƒ½æµ“ç¼©åœ¨ä¸€å¼ é™„å±çš„æµ·æŠ¥ä¸Šï¼Œæµ·æŠ¥è®²è¿°äº†æ¯ä¸ªç« èŠ‚çš„ç²¾ç®€æ‘˜è¦ï¼Œå¯ä»¥è¯´æ˜¯ç°æˆçš„è¯»ä¹¦ç¬”è®°ã€‚</p>
<p>2024å¹´ï¼Œç›¸å¯¹äºå¤æ—©çš„çº¸è´¨è½½ä½“ï¼Œç”¨ç”µå­ä½œä¸ºè½½ä½“çš„æ–‡çŒ®åœ¨ç»´æŠ¤ä¸Šæˆæœ¬æ›´ä¸ºä½å»‰ï¼Œå¹¶ä¸”ä¹Ÿé€æ¸æˆä¸ºäº†æœ€ä¼˜çš„æ–‡çŒ®é˜…è¯»æ–¹æ¡ˆã€‚å› æ­¤ï¼Œé¡ºå¸¦å€Ÿç€AIçš„ä¸œé£ï¼Œç¬”è€…å†³å®šç”¨AIæŠ€æœ¯ï¼Œå°†è¿™ä»½æµ·æŠ¥è½¬åŒ–æˆä¸€ä»½ç”µå­ç‰ˆçš„è¯»ä¹¦ç¬”è®°ï¼Œé€šè¿‡OCRè¯†åˆ«+GPTæ¶¦è‰²+äººå·¥æ ¡å¯¹ï¼ŒæŠŠè¿™æœ¬ä¹¦æ‰€æœ‰çš„ç²¾åç»™æ‘˜å½•ä¸‹æ¥ã€‚</p>
<p>ä»¥ä¸‹ï¼Œä¾¿æ˜¯è¯»ä¹¦ç¬”è®°çš„æ­£æ–‡ã€‚</p>
<a id="more"></a>
<h2 id="ç¬¬1ç« -ç ”å‘æ•ˆèƒ½æ¦‚è¿°"><a href="#ç¬¬1ç« -ç ”å‘æ•ˆèƒ½æ¦‚è¿°" class="headerlink" title="ç¬¬1ç«  ç ”å‘æ•ˆèƒ½æ¦‚è¿°"></a>ç¬¬1ç«  ç ”å‘æ•ˆèƒ½æ¦‚è¿°</h2><h3 id="1-1-ç ”å‘æ•ˆèƒ½çš„å®šä¹‰ã€ç›®æ ‡åŠè§£å†³çš„é—®é¢˜"><a href="#1-1-ç ”å‘æ•ˆèƒ½çš„å®šä¹‰ã€ç›®æ ‡åŠè§£å†³çš„é—®é¢˜" class="headerlink" title="1.1 ç ”å‘æ•ˆèƒ½çš„å®šä¹‰ã€ç›®æ ‡åŠè§£å†³çš„é—®é¢˜"></a>1.1 ç ”å‘æ•ˆèƒ½çš„å®šä¹‰ã€ç›®æ ‡åŠè§£å†³çš„é—®é¢˜</h3><p>ç ”å‘æ•ˆèƒ½ï¼ŒæŒ‡çš„æ˜¯åœ¨ç ”å‘è¿‡ç¨‹ä¸­å®ç°é«˜æ•ˆã€é«˜è´¨é‡ã€å¯é å’Œå¯æŒç»­çš„ä¸šåŠ¡ä»·å€¼äº¤ä»˜çš„èƒ½åŠ›ã€‚è¿™æ—¢æ¶‰åŠç¡®ä¿â€œåšæ­£ç¡®çš„äº‹æƒ…â€ï¼Œä¹Ÿå¼ºè°ƒâ€œæ­£ç¡®åœ°åšäº‹æƒ…å¹¶è¿½æ±‚é€Ÿåº¦â€ã€‚åœ¨ç»„ç»‡å±‚é¢ï¼Œç ”å‘æ•ˆèƒ½çš„æ ¸å¿ƒåœ¨äºé€šè¿‡ä¼˜åŒ–æµç¨‹å’Œå·¥å…·ï¼Œæå‡å›¢é˜Ÿçš„äº§å‡ºæ•ˆç‡å’Œè´¨é‡ã€‚è€Œåœ¨ä¸ªäººå±‚é¢ï¼Œå®ƒæ›´æ³¨é‡ä¸ªäººçš„èƒ½åŠ›æˆé•¿å’Œèªæ˜åœ°å·¥ä½œï¼Œè€Œéä»…ä»…æ˜¯æŠ•å…¥çš„åŠªåŠ›ã€‚éšç€è½¯ä»¶è§„æ¨¡å’Œå¤æ‚æ€§çš„æå‡ï¼Œç ”å‘æ•ˆèƒ½éœ€è¦è§£å†³å¦‚ä½•ä¿æŒé«˜æ•ˆå¹¶å‡ç¼“æ•ˆèƒ½æ¶åŒ–çš„æŒ‘æˆ˜ã€‚</p>
<h3 id="1-2-ç ”å‘æ•ˆèƒ½çš„å®è·µæ¡†æ¶"><a href="#1-2-ç ”å‘æ•ˆèƒ½çš„å®è·µæ¡†æ¶" class="headerlink" title="1.2 ç ”å‘æ•ˆèƒ½çš„å®è·µæ¡†æ¶"></a>1.2 ç ”å‘æ•ˆèƒ½çš„å®è·µæ¡†æ¶</h3><p>æ„å»ºç ”å‘æ•ˆèƒ½çš„â€œé»„é‡‘ä¸‰è§’â€ï¼Œæ¶µç›–æ•ˆèƒ½å®è·µã€æ•ˆèƒ½å¹³å°å’Œæ•ˆèƒ½åº¦é‡ä¸‰ä¸ªå…³é”®éƒ¨åˆ†ï¼Œä¸‰è€…ç›¸äº’ä¿ƒè¿›ï¼Œå…±åŒæå‡ç ”å‘æ•ˆèƒ½ã€‚åšæŒæ­£ç¡®çš„ä»·å€¼ä¸»å¼ ï¼Œç¡®ä¿åœ¨åšæ­£ç¡®çš„äº‹æƒ…çš„åŒæ—¶ï¼Œä¹Ÿè¿½æ±‚æ­£ç¡®çš„å·¥ä½œæ–¹å¼ã€‚æ•ˆèƒ½å®è·µåº”å› åœ°åˆ¶å®œï¼Œä»¥è§£å†³ç“¶é¢ˆä¸ºç›®æ ‡ï¼ŒæŒç»­æ”¹è¿›ã€‚æ•ˆèƒ½å¹³å°åº”æ»¡è¶³ç ”å‘åœºæ™¯éœ€æ±‚ï¼Œæ³¨é‡å·¥å…·é—´çš„è¿é€šæ€§ã€‚æ•ˆèƒ½åº¦é‡åˆ™åº”æŒ‡å¯¼å¹¶é©±åŠ¨æœ‰æ•ˆçš„æ•ˆèƒ½æå‡ï¼ŒåŸºäºæ•°æ®é©±åŠ¨å’Œå®éªŒæ€ç»´è¿›è¡Œã€‚</p>
<h3 id="1-3-ç ”å‘æ•ˆèƒ½çš„å®æ–½ç­–ç•¥"><a href="#1-3-ç ”å‘æ•ˆèƒ½çš„å®æ–½ç­–ç•¥" class="headerlink" title="1.3 ç ”å‘æ•ˆèƒ½çš„å®æ–½ç­–ç•¥"></a>1.3 ç ”å‘æ•ˆèƒ½çš„å®æ–½ç­–ç•¥</h3><p>å®æ–½ç ”å‘æ•ˆèƒ½æå‡æ—¶ï¼Œåº”æ³¨é‡è§£å†³å®é™…çš„ç ”å‘â€œç—›ç‚¹â€å’Œé—®é¢˜ï¼Œé¿å…å½¢å¼ä¸»ä¹‰æˆ–è™šå‡ç¹è£ã€‚è¿™éœ€è¦ä¸šåŠ¡ç ”å‘å›¢é˜Ÿã€å·¥å…·å¹³å°å›¢é˜Ÿã€æ•ˆèƒ½ä¸“å®¶æˆ–æ•™ç»ƒå›¢é˜Ÿä»¥åŠç»„ç»‡çº§ç ”æ•ˆç®¡ç†å›¢é˜Ÿå…±åŒåä½œã€‚æ˜ç¡®å„è‡ªçš„è§’è‰²å’ŒèŒè´£ï¼Œç¡®ä¿ç­–ç•¥åœ¨ä¸åŒåœºæ™¯ä¸‹çš„çµæ´»æ€§å’Œå®ç”¨æ€§ã€‚åŒæ—¶ï¼Œç ”å‘æ•ˆèƒ½åº”æœåŠ¡äºä¸šåŠ¡ï¼Œè€Œéè®©ä¸šåŠ¡è¿å°±æ•ˆèƒ½ã€‚</p>
<h3 id="1-4-ç ”å‘æ•ˆèƒ½çš„æ ¸å¿ƒä»·å€¼è§‚å’Œå¸¸è§è¯¯åŒº"><a href="#1-4-ç ”å‘æ•ˆèƒ½çš„æ ¸å¿ƒä»·å€¼è§‚å’Œå¸¸è§è¯¯åŒº" class="headerlink" title="1.4 ç ”å‘æ•ˆèƒ½çš„æ ¸å¿ƒä»·å€¼è§‚å’Œå¸¸è§è¯¯åŒº"></a>1.4 ç ”å‘æ•ˆèƒ½çš„æ ¸å¿ƒä»·å€¼è§‚å’Œå¸¸è§è¯¯åŒº</h3><p>ç ”å‘æ•ˆèƒ½çš„æ ¸å¿ƒä»·å€¼è§‚åŒ…æ‹¬ä»¥ä¸šåŠ¡ä»·å€¼ä¸ºå¯¼å‘ã€ä¼˜åŒ–å…¨å±€æµåŠ¨ã€è¿½æ±‚å·¥ç¨‹å“è¶Šå’Œå–„ç”¨æ•°æ®æ€ç»´ã€‚åœ¨å®æ–½è¿‡ç¨‹ä¸­ï¼Œåº”é¿å…çš„å¸¸è§è¯¯åŒºåŒ…æ‹¬ç¼ºä¹ç³»ç»ŸåŒ–è§„åˆ’ã€ç›²ç›®æ¨è¡Œä¸€è‡´æ€§ã€å½¢å¼ä¸»ä¹‰å·¥ç¨‹å®è·µã€å¿½è§†ä¸Šä¸‹æ–‡å·®å¼‚ç…§æ¬æ–¹æ¡ˆã€å¿½è§†å¼€å‘è€…ä½“éªŒä»¥åŠä¸æ°å½“ä½¿ç”¨åº¦é‡ç­‰ã€‚</p>
<h2 id="ç¬¬2ç« -éœ€æ±‚åŠæ•æ·åä½œé¢†åŸŸå®è·µ"><a href="#ç¬¬2ç« -éœ€æ±‚åŠæ•æ·åä½œé¢†åŸŸå®è·µ" class="headerlink" title="ç¬¬2ç«  éœ€æ±‚åŠæ•æ·åä½œé¢†åŸŸå®è·µ"></a>ç¬¬2ç«  éœ€æ±‚åŠæ•æ·åä½œé¢†åŸŸå®è·µ</h2><h3 id="2-1-ä¸šåŠ¡æ¢ç´¢"><a href="#2-1-ä¸šåŠ¡æ¢ç´¢" class="headerlink" title="2.1 ä¸šåŠ¡æ¢ç´¢"></a>2.1 ä¸šåŠ¡æ¢ç´¢</h3><p>é€šè¿‡å•†ä¸šæ¨¡å¼ç”»å¸ƒæ˜ç¡®ç›®æ ‡å®¢æˆ·ï¼Œæå‡ºåˆç†è§£å†³æ–¹æ¡ˆï¼Œå¹¶æ¢ç´¢å·®å¼‚åŒ–ç«äº‰ä¼˜åŠ¿ã€‚è¿ç”¨è®¾è®¡æ€ç»´ä¸ç”¨æˆ·å…±æƒ…ï¼Œå®šä¹‰ç”¨æˆ·é—®é¢˜å¹¶æ¢ç´¢åˆ›æ–°ç‚¹å­ã€‚åˆ©ç”¨å½±å“åœ°å›¾è¿æ¥ä¸šåŠ¡ç›®æ ‡ä¸å®ç°æ–¹å¼ï¼Œæ˜ç¡®è¡ŒåŠ¨è®¡åˆ’å’Œæ‰€éœ€ç‰¹æ€§ã€‚è§„åˆ’äº§å“è·¯çº¿å›¾ï¼Œç¡®ä¿äº§å“ç›®æ ‡ä¸ç‰¹æ€§å¼€å‘çš„æ—¶é—´è¡¨å’ŒåŠªåŠ›ç›¸åŒ¹é…ã€‚ä»¥æœ€å°åŒ–å¯è¡Œäº§å“ï¼ˆMVPï¼‰ä¸ºèµ·ç‚¹ï¼Œé€šè¿‡â€œæ„å»º-è¡¡é‡-å­¦ä¹ â€å¾ªç¯è¿›è¡Œå¿«é€Ÿè¿­ä»£å’Œä¼˜åŒ–ã€‚åˆ©ç”¨ç²¾ç›Šæ•°æ®åˆ†æé©±åŠ¨äº§å“å†³ç­–ï¼ŒæŒç»­æ”¹è¿›å¹¶æ»¡è¶³ç”¨æˆ·éœ€æ±‚ã€‚</p>
<h3 id="2-2-ç²¾ç›Šéœ€æ±‚"><a href="#2-2-ç²¾ç›Šéœ€æ±‚" class="headerlink" title="2.2 ç²¾ç›Šéœ€æ±‚"></a>2.2 ç²¾ç›Šéœ€æ±‚</h3><p>é‡‡ç”¨æ¡ç›®åŒ–çš„ç”¨æˆ·æ•…äº‹è¡¨è¾¾ç²¾ç›Šéœ€æ±‚ï¼Œç¡®ä¿éœ€æ±‚å…·æœ‰3Cç‰¹å¾å’ŒINVESTåŸåˆ™ã€‚é€šè¿‡æ•…äº‹æ ‘ç»“æ„ç®¡ç†äº§å“å…¨é‡å’Œä¸åŒå±‚çº§çš„éœ€æ±‚ï¼Œä¿æŒéœ€æ±‚çš„å±‚æ¬¡ç»“æ„å’Œæ¸…æ™°æ€§ã€‚ç²¾ç›Šéœ€æ±‚é€šå¸¸é‡‡ç”¨2~3å±‚ç»“æ„ï¼Œå¦‚ä¸šåŠ¡éœ€æ±‚-äº§å“éœ€æ±‚-å·¥ä½œä»»åŠ¡ï¼Œä»¥ç¡®ä¿éœ€æ±‚çš„æ˜ç¡®æ€§å’Œå¯ç®¡ç†æ€§ã€‚</p>
<h3 id="2-3-å®ä¾‹åŒ–éœ€æ±‚"><a href="#2-3-å®ä¾‹åŒ–éœ€æ±‚" class="headerlink" title="2.3 å®ä¾‹åŒ–éœ€æ±‚"></a>2.3 å®ä¾‹åŒ–éœ€æ±‚</h3><p>ä½¿ç”¨â€œå‡å®šï¼ˆGivenï¼‰-å½“ï¼ˆWhenï¼‰-é‚£ä¹ˆï¼ˆThenï¼‰â€çš„è¯­è¨€å°†éœ€æ±‚æè¿°ä¸ºå®ä¾‹ï¼Œç¡®ä¿éœ€æ±‚çœŸå®å¯æµ‹ä¸”åŒ…å«éåŠŸèƒ½æ€§éœ€æ±‚ã€‚åœ¨éœ€æ±‚è¯´æ˜ä¸­ç»“åˆå®ä¾‹å’Œé¢†åŸŸå»ºæ¨¡ï¼Œæé«˜éœ€æ±‚çš„ç†è§£å’Œå®ç°æ•ˆç‡ã€‚</p>
<h3 id="2-4-æ•æ·åä½œ"><a href="#2-4-æ•æ·åä½œ" class="headerlink" title="2.4 æ•æ·åä½œ"></a>2.4 æ•æ·åä½œ</h3><p>åŸºäºæ•æ·å®£è¨€çš„ä»·å€¼è§‚å’ŒåŸåˆ™è¿›è¡Œåä½œï¼Œä¿ƒè¿›å›¢é˜Ÿé«˜æ•ˆæ²Ÿé€šå’Œåä½œã€‚æ•æ·åä½œåœ¨è§„æ¨¡ä¸º10äººå·¦å³çš„å°è§„æ¨¡æ•æ·å›¢é˜Ÿä¸­æœ€ä¸ºæœ‰æ•ˆï¼Œæœ‰åŠ©äºæå‡å›¢é˜Ÿçš„å“åº”é€Ÿåº¦å’Œåˆ›æ–°èƒ½åŠ›ã€‚</p>
<h3 id="2-5-å¯è§†åŒ–ç®¡ç†"><a href="#2-5-å¯è§†åŒ–ç®¡ç†" class="headerlink" title="2.5 å¯è§†åŒ–ç®¡ç†"></a>2.5 å¯è§†åŒ–ç®¡ç†</h3><p>è¿ç”¨æ³¢ç‰¹ä»·å€¼é“¾åˆ†ææ–¹æ³•ï¼Œæ·±å…¥å‰–æç ”å‘è¿‡ç¨‹ä¸­çš„åŸºç¡€æ€§ä¸æ”¯æŒæ€§æ´»åŠ¨ã€‚é€šè¿‡ä»·å€¼æµå›¾ï¼Œæ˜ å°„å¹¶å±•ç¤ºç ”å‘è¿‡ç¨‹ä¸­ä»·å€¼çš„æµåŠ¨è·¯å¾„ã€‚å€ŸåŠ©çœ‹æ¿ï¼Œå®ç°äº§ç ”å…¨æµç¨‹çš„ç›´è§‚å¯è§†åŒ–ï¼Œä¾¿äºå›¢é˜Ÿæˆå‘˜å¿«é€Ÿäº†è§£è¿›åº¦å’ŒçŠ¶æ€ã€‚åŒæ—¶ï¼Œè¿ç”¨ç´¯ç§¯æµå›¾ç­‰ç»Ÿè®¡åˆ†æå·¥å…·ï¼Œæ·±å…¥æŒ–æ˜çœ‹æ¿ä¸­çš„å…³é”®ä¿¡æ¯ï¼Œä¸ºå†³ç­–å’Œä¼˜åŒ–æä¾›ä¾æ®ã€‚</p>
<h3 id="2-6-è§„æ¨¡åŒ–æ•æ·äº¤ä»˜"><a href="#2-6-è§„æ¨¡åŒ–æ•æ·äº¤ä»˜" class="headerlink" title="2.6 è§„æ¨¡åŒ–æ•æ·äº¤ä»˜"></a>2.6 è§„æ¨¡åŒ–æ•æ·äº¤ä»˜</h3><p>å›´ç»•ä»·å€¼æµï¼Œæˆ‘ä»¬ç»„å»ºäº†ä¸€æ”¯ç”±å¤šä¸ªå°è§„æ¨¡æ•æ·å›¢é˜Ÿæ„æˆçš„å¤§è§„æ¨¡æ•æ·å›¢é˜Ÿã€‚è§„æ¨¡åŒ–æ•æ·æ¶æ„çš„æ ¸å¿ƒä»»åŠ¡æ˜¯è§£è€¦ï¼ŒåŠ›æ±‚å»é™¤ä¸å¿…è¦çš„è§„æ¨¡åŒ–å…ƒç´ ã€‚å¯¹äºä¸é¢‘ç¹ã€å½±å“å¤§ã€å®æ–½æ—¶é—´é•¿çš„ä¸¾æªï¼Œæˆ‘ä»¬ä¼šåœ¨ç®¡ç†å±‚å†³ç­–åï¼Œå°†å…¶æ‹†è§£æˆæ›´å°ã€æ›´æ˜“äºç®¡ç†çš„éœ€æ±‚ã€‚åœ¨è§„æ¨¡åŒ–çš„æ•æ·æµç¨‹ä¸­ï¼Œæˆ‘ä»¬å¼ºè°ƒèŠ‚å¥çš„ä¸€è‡´æ€§ï¼Œç¡®ä¿å…¨å‘˜åŒæ­¥å¯åŠ¨ã€è®¡åˆ’å’Œè¿­ä»£äº¤ä»˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç«¯åˆ°ç«¯çš„æ•æ·DevOpså¹³å°ï¼Œä»¥æ”¯æŒå¤šä¸ªå°è§„æ¨¡æ•æ·å›¢é˜Ÿçš„åä½œä½“éªŒï¼Œä»¥åŠå¤§å‹è§£å†³æ–¹æ¡ˆçš„æŒç»­äº¤ä»˜ã€‚</p>
<h2 id="ç¬¬3ç« -å¼€å‘é¢†åŸŸå®è·µ"><a href="#ç¬¬3ç« -å¼€å‘é¢†åŸŸå®è·µ" class="headerlink" title="ç¬¬3ç«  å¼€å‘é¢†åŸŸå®è·µ"></a>ç¬¬3ç«  å¼€å‘é¢†åŸŸå®è·µ</h2><h3 id="3-1-åˆ†æ”¯æ¨¡å‹"><a href="#3-1-åˆ†æ”¯æ¨¡å‹" class="headerlink" title="3.1 åˆ†æ”¯æ¨¡å‹"></a>3.1 åˆ†æ”¯æ¨¡å‹</h3><p>åˆ†æ”¯æ¨¡å‹æ˜¯é…ç½®ç®¡ç†çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œå¯¹äºå›¢é˜Ÿåä½œç®¡ç†è‡³å…³é‡è¦ã€‚å¸¸è§çš„åˆ†æ”¯æ¨¡å‹åŒ…æ‹¬ä¸»å¹²åˆ†æ”¯å¼€å‘æ¨¡å‹å’Œç‰¹æ€§åˆ†æ”¯å¼€å‘æ¨¡å‹ã€‚å›¢é˜Ÿåº”æ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹ã€å›¢é˜Ÿè§„æ¨¡åŠå½“å‰é˜¶æ®µé€‰æ‹©æœ€é€‚åˆçš„åˆ†æ”¯æ¨¡å‹ï¼Œå½¢æˆç¬¦åˆè‡ªèº«çš„æœ€ä½³å®è·µã€‚æ²¡æœ‰ç»å¯¹ç†æƒ³çš„åˆ†æ”¯æ¨¡å‹ï¼Œåªæœ‰æœ€é€‚åˆå›¢é˜Ÿç°çŠ¶å’Œä¸Šä¸‹æ–‡ç¯å¢ƒçš„æ¨¡å‹ã€‚</p>
<h3 id="3-2-æœ¬åœ°å¼€å‘"><a href="#3-2-æœ¬åœ°å¼€å‘" class="headerlink" title="3.2 æœ¬åœ°å¼€å‘"></a>3.2 æœ¬åœ°å¼€å‘</h3><p>é«˜æ•ˆæœ¬åœ°å¼€å‘çš„å®—æ—¨åœ¨äºæå‡å¼€å‘è€…çš„ç¼–ç æ•ˆèƒ½ï¼Œå‡å°‘é˜»ç¢å’Œä¸å¿…è¦çš„å¹²æ‰°ã€‚å»ºç«‹è§„èŒƒåŒ–å’Œè‡ªåŠ¨åŒ–çš„ç ”å‘æµç¨‹æ˜¯å®ç°é«˜æ•ˆå¼€å‘çš„å…³é”®ï¼Œä¹Ÿæ˜¯æŒç»­ä¼˜åŒ–å’ŒæŠ•å…¥çš„é‡ç‚¹ã€‚åœ¨æ„å»ºé«˜æ•ˆå¼€å‘ç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬éµå¾ªä»¥ä¸‹åŸåˆ™ï¼šå»ºç«‹ç¬¦åˆå›¢é˜Ÿç‰¹ç‚¹çš„ç ”å‘è§„èŒƒï¼›åˆ©ç”¨èµ„æºæ¢å–æ—¶é—´ï¼›å®ç°æœåŠ¡åŒ–ã€è‡ªåŠ©å¼çš„ç¯å¢ƒè·å–ï¼›ç¡®ä¿ç¯å¢ƒçš„ä¸€ä½“åŒ–å’Œä¸€è‡´æ€§ã€‚</p>
<h3 id="3-3-äº‘å¼€å‘"><a href="#3-3-äº‘å¼€å‘" class="headerlink" title="3.3 äº‘å¼€å‘"></a>3.3 äº‘å¼€å‘</h3><p>äº‘å¼€å‘æ˜¯è§£å†³æœ¬åœ°èµ„æºä¸è¶³ã€å¼€å‘ç¯å¢ƒå·®å¼‚ä»¥åŠäº‘åŸç”Ÿç¯å¢ƒä¸‹å¼€å‘æŒ‘æˆ˜çš„æœ‰æ•ˆæ‰‹æ®µã€‚äº‘å¼€å‘æ¶‰åŠå…±äº«äº‘ç«¯ç¯å¢ƒã€åŸºäºK8s Namespaceçš„éš”ç¦»å¼€å‘ç¯å¢ƒå’ŒåŸºäºIstio Meshçš„é€»è¾‘éš”ç¦»å¼€å‘ç¯å¢ƒã€‚æ­¤å¤–ï¼Œé€šè¿‡å®¹å™¨åº”ç”¨çƒ­åŠ è½½ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°äº‘ç«¯å¼€å‘ç¼–ç çš„å®æ—¶ç”Ÿæ•ˆï¼Œè¿›ä¸€æ­¥æé«˜å¼€å‘æ•ˆç‡ã€‚</p>
<h3 id="3-4-ä»£ç å¹³å®¡"><a href="#3-4-ä»£ç å¹³å®¡" class="headerlink" title="3.4 ä»£ç å¹³å®¡"></a>3.4 ä»£ç å¹³å®¡</h3><p>ä»£ç è¯„å®¡æ˜¯è´¨é‡å†…å»ºçš„æ ¸å¿ƒå®è·µä¹‹ä¸€ï¼Œä½“ç°äº†å·¥ç¨‹å¸ˆæ–‡åŒ–çš„åŸºçŸ³ã€‚ä¸åŒç±»å‹çš„ä»£ç è¯„å®¡å®è·µå…·æœ‰å„è‡ªçš„ç‰¹ç‚¹ï¼Œé€‚ç”¨äºä¸åŒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚åœ¨è¿›è¡Œä»£ç è®²å®¡æ—¶ï¼Œæˆ‘ä»¬æ—¢è¦å…³æ³¨ä¸šåŠ¡ä»·å€¼çš„æ­£ç¡®äº¤ä»˜ï¼Œä¹Ÿè¦è€ƒè™‘ä»£ç çš„é•¿æœŸå¯ç»´æŠ¤æ€§ã€‚</p>
<h3 id="3-5-å•å…ƒæµ‹è¯•"><a href="#3-5-å•å…ƒæµ‹è¯•" class="headerlink" title="3.5 å•å…ƒæµ‹è¯•"></a>3.5 å•å…ƒæµ‹è¯•</h3><p>å•å…ƒæµ‹è¯•æ˜¯æµ‹è¯•å·¦ç§»çš„å…³é”®å®è·µä¹‹ä¸€ï¼Œä¸ºé«˜è´¨é‡æµ‹è¯•ç­–ç•¥å¥ å®šäº†åŸºç¡€ã€‚æˆ‘ä»¬åº”åŒç­‰å¯¹å¾…å•å…ƒæµ‹è¯•ä»£ç ä¸ä¸šåŠ¡ä»£ç ï¼Œå…³æ³¨å…¶å¯ç»´æŠ¤æ€§ã€æµ‹è¯•æœ‰æ•ˆæ€§ã€æ‰§è¡Œæ—¶é—´å’Œç¨³å®šæ€§ã€‚å•å…ƒæµ‹è¯•çš„æ¨è¿›æ˜¯ä¸€é¡¹é•¿æœŸæŠ•èµ„ï¼Œéœ€è¦ç»“åˆå›¢é˜Ÿç°çŠ¶ï¼Œå¾ªåºæ¸è¿›åœ°æŒç»­æå‡ã€‚</p>
<h3 id="3-6-ä»£ç æ‰«æ"><a href="#3-6-ä»£ç æ‰«æ" class="headerlink" title="3.6 ä»£ç æ‰«æ"></a>3.6 ä»£ç æ‰«æ</h3><p>ä»£ç æ‰«æèƒ½å¤Ÿåœ¨æ—©æœŸå‘ç°ä»£ç é—®é¢˜ï¼Œä»è€Œé™ä½è§£å†³æˆæœ¬ã€‚ä¿®æ­£ä»£ç æ‰«æå‘ç°çš„é—®é¢˜ä¸ä¿®å¤ä»£ç ç¼ºé™·ç±»ä¼¼ï¼Œéƒ½éœ€è¦é€šè¿‡å›å½’æµ‹è¯•æ¥éªŒè¯ã€‚åœ¨å®æ–½ä»£ç æ‰«ææ—¶ï¼Œæˆ‘ä»¬åº”ä¿æŒçµæ´»å’Œå› åœ°åˆ¶å®œçš„æ€åº¦ï¼Œé¿å…ç›²ç›®å¼•å…¥å¯¼è‡´å›¢é˜Ÿè´Ÿæ‹…å¢åŠ ã€‚</p>
<h3 id="3-7-ç¼–è¯‘æ„å»º"><a href="#3-7-ç¼–è¯‘æ„å»º" class="headerlink" title="3.7 ç¼–è¯‘æ„å»º"></a>3.7 ç¼–è¯‘æ„å»º</h3><p>ä¼˜ç§€çš„å›¢é˜Ÿåº”æ¯å¤©è‡ªåŠ¨åŒ–å®Œæˆæœ€æ–°çš„ä»£ç æ„å»ºå¹¶å‘å¸ƒåˆ°æµ‹è¯•å¹³å°ã€‚é’ˆå¯¹ä¼ ç»Ÿæœ¬åœ°ç¼–è¯‘æ„å»ºçš„é—®é¢˜ï¼Œä¸šç•Œå·²å‘å±•å‡ºåˆ†å¸ƒå¼æ„å»ºã€ç¼–è¯‘ç¼“å­˜å’Œäº‘ç«¯æ„å»ºç­‰æŠ€æœ¯ã€‚åœ¨é€‰æ‹©ç¼–è¯‘æ„å»ºå¹³å°æ—¶ï¼Œæˆ‘ä»¬åº”å…³æ³¨å…¶æ¥å…¥æˆæœ¬ï¼Œå°½é‡å®ç°æ— ä¾µå…¥å¼æ¥å…¥ã€‚ç¼–è¯‘æ„å»ºçš„ä¼˜åŒ–æ˜¯ä¸€ä¸ªä¸æ–­è¿­ä»£çš„è¿‡ç¨‹ï¼Œè€Œç¼–è¯‘è¿‡ç¨‹çš„å¯è§†åŒ–åˆ™ä¸ºæŒç»­ä¼˜åŒ–æä¾›äº†æ•°æ®æ”¯æŒã€‚</p>
<h3 id="3-8-æ¶æ„è®¾è®¡"><a href="#3-8-æ¶æ„è®¾è®¡" class="headerlink" title="3.8 æ¶æ„è®¾è®¡"></a>3.8 æ¶æ„è®¾è®¡</h3><p>æ¶æ„è®¾è®¡çš„è´¨é‡å¯¹éœ€æ±‚ã€å¼€å‘ã€æµ‹è¯•å’Œè¿ç»´ç­‰å¤§éƒ¨åˆ†ç ”å‘æ•ˆèƒ½é¢†åŸŸçš„æå‡èµ·ç€å†³å®šæ€§ä½œç”¨ã€‚æ¶æ„è®¾è®¡çš„åˆè¡·ä¸æ˜¯ä¸ºäº†æ»¡è¶³æ¨¡å¼å’ŒåŸåˆ™ï¼Œè€Œæ˜¯åœ¨æ·±å…¥ç†è§£å’Œåˆ†æä¸šåŠ¡ç›®æ ‡åï¼Œè®¾è®¡æˆ–é€‰å–ä¸ç›®æ ‡é«˜åº¦å…³è”çš„æœ€ä¼˜è§£ã€‚</p>
<h3 id="3-9-ä½ä»£ç åº”ç”¨"><a href="#3-9-ä½ä»£ç åº”ç”¨" class="headerlink" title="3.9 ä½ä»£ç åº”ç”¨"></a>3.9 ä½ä»£ç åº”ç”¨</h3><p>ä½ä»£ç ï¼Œä½œä¸ºä¸€ç§å¯è§†åŒ–çš„è½¯ä»¶å¼€å‘æ–¹å¼ï¼Œæœ‰æ•ˆç¼©çŸ­äº†ç ”å‘å‘¨æœŸï¼Œå¹¶æ˜¾è‘—é™ä½äº†ç ”å‘æˆæœ¬ã€‚è¿™ç§æ–¹æ³•ä¸­ï¼Œå¯è§†åŒ–æµç¨‹å’Œå¯è§†åŒ–æ”¹ä¸°æœºæ˜¯å¸¸ç”¨çš„æŠ€æœ¯æ‰‹æ®µã€‚åœ¨å›½æœºä»£é…ç¨‹èŠ‚ç‚¹ä¸­ï¼Œæ¤å…¥ä¸é…ç½®è´¨é‡å¡ç‚¹ï¼Œæ˜¯æ¨åŠ¨è´¨é‡å·¦ç§»å’Œå³ç§»çš„å…³é”®å®è·µã€‚</p>
<h3 id="3-10æµ‹è¯•é©±åŠ¨å¼€å‘"><a href="#3-10æµ‹è¯•é©±åŠ¨å¼€å‘" class="headerlink" title="3.10æµ‹è¯•é©±åŠ¨å¼€å‘"></a>3.10æµ‹è¯•é©±åŠ¨å¼€å‘</h3><p>æµ‹è¯•é©±åŠ¨å¼€å‘æ˜¯ä¸€ç§å¼ºè°ƒæµ‹è¯•åœ¨å…ˆã€ç¼–ç åœ¨åçš„å¼€å‘å®è·µã€‚å®ƒç¡®ä¿äº†ä»£ç çš„å¾®è§‚è´¨é‡ï¼ŒçœŸæ­£å®ç°äº†è´¨é‡å†…å»ºçš„ç›®æ ‡ã€‚æµ‹è¯•é©±åŠ¨å¼€å‘åŸåˆ™åŒ…æ‹¬ï¼šå…ˆå†™æµ‹è¯•ä»£ç ï¼Œå†å†™äº§å“ä»£ç ï¼›åªå…è®¸ç¼–å†™èƒ½å¤Ÿå¯¼è‡´å¤±è´¥çš„å•å…ƒæµ‹è¯•ï¼›ä»¥åŠåªå…è®¸ç¼–å†™åˆšå¥½èƒ½å¤Ÿå¯¼è‡´ä¸€ä¸ªå¤±è´¥çš„å•å…ƒæµ‹è¯•è¿‡çš„äº§å“ä»£ç ã€‚</p>
<h2 id="ç¬¬4ç« -æµ‹è¯•é¢†åŸŸå®è·µ"><a href="#ç¬¬4ç« -æµ‹è¯•é¢†åŸŸå®è·µ" class="headerlink" title="ç¬¬4ç«  æµ‹è¯•é¢†åŸŸå®è·µ"></a>ç¬¬4ç«  æµ‹è¯•é¢†åŸŸå®è·µ</h2><h3 id="4-1-æµ‹è¯•ç¯å¢ƒç®¡ç†"><a href="#4-1-æµ‹è¯•ç¯å¢ƒç®¡ç†" class="headerlink" title="4.1 æµ‹è¯•ç¯å¢ƒç®¡ç†"></a>4.1 æµ‹è¯•ç¯å¢ƒç®¡ç†</h3><p>ç¨³å®šä¸”å®Œå¤‡çš„æµ‹è¯•ç¯å¢ƒæ˜¯è‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œçš„é‡è¦ä¿éšœã€‚æµ‹è¯•ç¯å¢ƒç®¡ç†ä¸ä»…æ˜¯æŸä¸ªéƒ¨é—¨æˆ–è§’è‰²çš„è´£ä»»ï¼Œæ¯ä¸ªäººéƒ½æ—¢æ˜¯æµ‹è¯•ç¯å¢ƒçš„ä½¿ç”¨è€…ï¼Œä¹Ÿæ˜¯å…¶å»ºè®¾è€…ã€‚é€šè¿‡åŸºå‡†ç¯å¢ƒå’ŒåŠŸèƒ½ç¯å¢ƒçš„é…åˆä½¿ç”¨ï¼Œä¸€å¥—å¾®æœåŠ¡ç¯å¢ƒå¯ä»¥æ»¡è¶³å¤šä¸ªéœ€æ±‚å¹¶è¡Œæµ‹è¯•çš„åœºæ™¯ã€‚åŒæ—¶ï¼Œæµ‹è¯•ç¯å¢ƒéœ€è¦å…¨ç”Ÿå‘½å‘¨æœŸçš„å®Œæ•´ç®¡ç†æ‰‹æ®µï¼ŒåŒ…æ‹¬ç¯å¢ƒçš„åˆ›å»ºã€æ›´æ–°ã€è®¿é—®ã€é”€æ¯ã€æ ¡éªŒã€åº¦é‡ç­‰ã€‚</p>
<h3 id="4-2-è‡ªåŠ¨åŒ–éªŒæ”¶æµ‹è¯•"><a href="#4-2-è‡ªåŠ¨åŒ–éªŒæ”¶æµ‹è¯•" class="headerlink" title="4.2 è‡ªåŠ¨åŒ–éªŒæ”¶æµ‹è¯•"></a>4.2 è‡ªåŠ¨åŒ–éªŒæ”¶æµ‹è¯•</h3><p>åœ¨é€‰æ‹©è‡ªåŠ¨åŒ–æ¡†æ¶æ—¶ï¼Œé™¤äº†è€ƒè™‘æ¡†æ¶çš„æŠ€æœ¯ç‰¹æ€§å¤–ï¼Œè¿˜éœ€å……åˆ†è€ƒè™‘å›¢é˜Ÿçš„äººå‘˜èƒ½åŠ›ã€‚è‡ªåŠ¨åŒ–éªŒæ”¶æµ‹è¯•ç”¨ä¾‹éœ€æŒç»­ç»´æŠ¤ï¼Œä»¥ç¡®ä¿å…¶é«˜ç¨³å®šæ€§å’Œå¯ç”¨æ€§ã€‚å°½ç®¡è‡ªåŠ¨åŒ–éªŒæ”¶æµ‹è¯•åœ¨ç°é˜¶æ®µä¸èƒ½å®Œå…¨æ›¿ä»£æ‰‹å·¥æµ‹è¯•ï¼Œä½†å®ƒä»ç„¶æ˜¯æå‡æµ‹è¯•æ•ˆç‡å’Œè´¨é‡çš„é‡è¦æ‰‹æ®µã€‚</p>
<h3 id="4-3-è‡ªåŠ¨åŒ–æ¥å£æµ‹è¯•"><a href="#4-3-è‡ªåŠ¨åŒ–æ¥å£æµ‹è¯•" class="headerlink" title="4.3 è‡ªåŠ¨åŒ–æ¥å£æµ‹è¯•"></a>4.3 è‡ªåŠ¨åŒ–æ¥å£æµ‹è¯•</h3><p>åœ¨å½“å‰çš„æµ‹è¯•ä½“ç³»ä¸­ï¼Œæ¥å£æµ‹è¯•çš„é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚è‡ªåŠ¨åŒ–æ¥å£æµ‹è¯•æ¶µç›–äº†åè®®å®¢æˆ·ç«¯æ¨¡æ‹Ÿã€æ¥å£é€»è¾‘æ¨¡æ‹Ÿã€æ•°æ®é©±åŠ¨ã€è‡ªåŠ¨åŒ–æ‰§è¡Œã€æ–­è¨€æ“ä½œã€å…³é”®å­—é©±åŠ¨ã€æµ‹è¯•æ›¿èº«ç­‰å…³é”®æŠ€æœ¯ã€‚åŒæ—¶ï¼Œå…³æ³¨ç¼ºé™·è‡ªåŠ¨æäº¤å’Œè¯¯æŠ¥ç¼ºé™·è‡ªåŠ¨è¿‡æ»¤æ˜¯æé«˜æµ‹è¯•æ•ˆç‡å’Œå‡†ç¡®æ€§çš„å…³é”®æ–¹å‘ã€‚</p>
<h3 id="4-4-æµ‹è¯•æ•°æ®ç®¡ç†"><a href="#4-4-æµ‹è¯•æ•°æ®ç®¡ç†" class="headerlink" title="4.4 æµ‹è¯•æ•°æ®ç®¡ç†"></a>4.4 æµ‹è¯•æ•°æ®ç®¡ç†</h3><p>æµ‹è¯•æ•°æ®ç®¡ç†éœ€è¦åœ¨è¯„ä¼°æŠ•å…¥äº§å‡ºæ¯”çš„åŸºç¡€ä¸Šè¿›è¡Œï¼Œä¸æ˜¯æ‰€æœ‰æµ‹è¯•æ•°æ®éƒ½éœ€è¦æå‰å‡†å¤‡ï¼Œä¹Ÿä¸æ˜¯æ‰€æœ‰æµ‹è¯•æ•°æ®éƒ½æ— æ³•å‡†å¤‡ã€‚æµ‹è¯•æ•°æ®ç®¡ç†éœ€è¦ä¸æµ‹è¯•å·¥ä½œç´§å¯†ç»“åˆï¼ŒæŒ‰éœ€å»ºè®¾ï¼Œå¹¶åŠæ—¶ç»´æŠ¤å’Œæ›´æ–°ã€‚æµ‹è¯•æ•°æ®äº§ç”Ÿçš„ä»·å€¼æ˜¯è¡¡é‡æµ‹è¯•æ•°æ®ç®¡ç†æ•ˆæœçš„å”¯ä¸€æ ‡å‡†ã€‚</p>
<h3 id="4-5-æ€§èƒ½æµ‹è¯•"><a href="#4-5-æ€§èƒ½æµ‹è¯•" class="headerlink" title="4.5 æ€§èƒ½æµ‹è¯•"></a>4.5 æ€§èƒ½æµ‹è¯•</h3><p>æ€§èƒ½æµ‹è¯•æ˜¯è¯„ä¼°ç³»ç»Ÿå®¹é‡å¤§å°ã€å“åº”é€Ÿåº¦å’Œå¹¶å‘èƒ½åŠ›çš„é‡è¦æ‰‹æ®µã€‚æ€§èƒ½æµ‹è¯•å®è·µåŒ…æ‹¬æµ‹è¯•ç¯å¢ƒã€æµ‹è¯•æ•°æ®ã€æµ‹è¯•ç­–ç•¥ã€æµ‹è¯•å·¥å…·ã€æµ‹è¯•ç»“æœäº”ä¸ªè¦ç´ ã€‚æ€§èƒ½æµ‹è¯•å¯ä»¥æŒ‰ç…§å•æœºè¯„ä¼°ã€é›†ç¾¤è¯„ä¼°ã€æ‰©ç¼©å®¹å¯¹æ¯”ä¸‰ç§æ–¹å¼å¼€å±•ã€‚</p>
<h3 id="4-6-å…¨é“¾è·¯æµ‹è¯•"><a href="#4-6-å…¨é“¾è·¯æµ‹è¯•" class="headerlink" title="4.6 å…¨é“¾è·¯æµ‹è¯•"></a>4.6 å…¨é“¾è·¯æµ‹è¯•</h3><p>å…¨é“¾è·¯å‹æµ‹ä¸­çš„é“¾è·¯å¯åˆ†ä¸ºè°ƒç”¨é“¾è·¯å’Œä¸šåŠ¡é“¾è·¯ä¸¤ç§å½¢å¼ã€‚è°ƒç”¨é“¾è·¯çš„å‹æµ‹ä¸»è¦åº”ç”¨äºå•ä¸ªç³»ç»Ÿæˆ–ä¸šåŠ¡åœºæ™¯çš„å®¹é‡è¯„ä¼°ï¼›è€Œä¸šåŠ¡é“¾è·¯å‹æµ‹åˆ™æ˜¯å¯¹å¤šä¸ªæœ‰ä¸šåŠ¡å…³è”çš„åœºæ™¯æ‰€äº§ç”Ÿçš„è°ƒç”¨é“¾è·¯é›†åˆè¿›è¡Œè¯„ä¼°ã€‚å…¨é“¾è·¯å‹æµ‹æ˜¯ä¸€ç§å·¥ç¨‹å®è·µï¼Œè€Œéå•æŒ‡å¹³å°å»ºè®¾ã€‚æµé‡å½•åˆ¶å›æ”¾æŠ€æœ¯ä¸°å¯Œäº†å…¨é“¾è·¯å‹æµ‹å®è·µçš„æ‰‹æ®µï¼Œå¯åœ¨æ­¤åŸºç¡€ä¸Šæ ¹æ®ä¸šåŠ¡åœºæ™¯å¯¹å½•åˆ¶çš„æ•°æ®è¿›è¡Œä¿®æ­£å’ŒéªŒè¯ã€‚</p>
<h3 id="4-7-å®‰å…¨æµ‹è¯•"><a href="#4-7-å®‰å…¨æµ‹è¯•" class="headerlink" title="4.7 å®‰å…¨æµ‹è¯•"></a>4.7 å®‰å…¨æµ‹è¯•</h3><p>å®‰å…¨é£é™©æŠŠæ§æ˜¯å…¨ä½“å‚ä¸æ–¹çš„å…±åŒè´£ä»»ï¼Œè€ŒéæŸä¸ªéƒ¨é—¨æˆ–è§’è‰²çš„ä¸“å±ä»»åŠ¡ã€‚å®‰å…¨æµ‹è¯•éœ€è¦èå…¥ç ”å‘æµç¨‹çš„å„ä¸ªç¯èŠ‚ï¼Œä»¥ä¸€ç§æ½œç§»é»˜åŒ–çš„æ–¹å¼å‘æŒ¥ä½œç”¨ã€‚é€šè¿‡å®‰å…¨æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥åŠæ—¶å‘ç°å’Œä¿®å¤æ½œåœ¨çš„å®‰å…¨é£é™©ï¼Œä»è€Œç¡®ä¿äº§å“çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p>
<h3 id="4-8-ç²¾å‡†æµ‹è¯•"><a href="#4-8-ç²¾å‡†æµ‹è¯•" class="headerlink" title="4.8 ç²¾å‡†æµ‹è¯•"></a>4.8 ç²¾å‡†æµ‹è¯•</h3><p>ä¼ ç»Ÿé»‘ç›’æµ‹è¯•å­˜åœ¨è¯¸å¤šæŒ‘æˆ˜ï¼Œå¦‚æµ‹è¯•è¿‡ç¨‹ä¸å¯é ã€æµ‹è¯•èŒƒå›´ä¸æ˜ç¡®ã€æ•ˆæœè¯„ä¼°æ¨¡ç³Šä¸”æ»åç­‰ã€‚è€Œç²¾å‡†æµ‹è¯•åˆ™ä»è½¯ä»¶ç³»ç»Ÿçš„é€»è¾‘ã€å˜æ›´ã€è¦†ç›–ä¸‰ä¸ªåº•å±‚å…³æ³¨ç‚¹è¿›è¡Œåˆ†æå’Œåº¦é‡ã€‚é€šè¿‡ç²¾å‡†æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å‡†ç¡®åœ°æ‰¾åˆ°å‘ç”Ÿå˜æ›´çš„ä»£ç æ®µï¼Œç›‘æ§æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„è¦†ç›–ç‡ï¼Œä»è€ŒæŒ‡å¯¼æµ‹è¯•ç”¨ä¾‹çš„é€‰å–ï¼Œå®ç°å˜æ›´ä»£ç çš„æœ€å¤§è¦†ç›–åº¦ã€‚</p>
<h3 id="4-9-æµ‹è¯•ä¸­å°"><a href="#4-9-æµ‹è¯•ä¸­å°" class="headerlink" title="4.9 æµ‹è¯•ä¸­å°"></a>4.9 æµ‹è¯•ä¸­å°</h3><p>æµ‹è¯•ä¸­å°æ—¨åœ¨èµ‹èƒ½å¼€å‘äººå‘˜å¼€å±•é«˜æ•ˆç‡ã€é«˜è´¨é‡çš„æµ‹è¯•å·¥ä½œã€‚é€šè¿‡å…¨å±€æ¶æ„è®¾è®¡ï¼Œæµ‹è¯•ä¸­å°ä¸ºæå‡æµ‹è¯•æ•ˆç‡æä¾›äº†æ›´æ¸…æ™°ã€æ›´ç›´è§‚çš„å…¨å±€è§†é‡ã€‚æµ‹è¯•ä¸­å°åŒ…æ‹¬æµ‹è¯•æ‰§è¡ŒæœåŠ¡ã€æµ‹è¯•æ•°æ®æœåŠ¡ã€æµ‹è¯•æ‰§è¡Œç¯å¢ƒç­‰å…³é”®ç»„ä»¶ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›å…¨é¢ã€é«˜æ•ˆçš„æµ‹è¯•æ”¯æŒã€‚</p>
<h2 id="ç¬¬5ç« -CI-CD-é¢†åŸŸå®è·µ"><a href="#ç¬¬5ç« -CI-CD-é¢†åŸŸå®è·µ" class="headerlink" title="ç¬¬5ç«  CI / CD é¢†åŸŸå®è·µ"></a>ç¬¬5ç«  CI / CD é¢†åŸŸå®è·µ</h2><h3 id="5-1-æŒç»­é›†æˆ"><a href="#5-1-æŒç»­é›†æˆ" class="headerlink" title="5.1 æŒç»­é›†æˆ"></a>5.1 æŒç»­é›†æˆ</h3><p>æŒç»­é›†æˆå¼ºè°ƒé¢‘ç¹åœ°å°†ä»£ç æ”¹åŠ¨é›†æˆåˆ°å…±äº«åˆ†æ”¯ï¼Œå¹¶è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ã€‚é€šè¿‡æ„å»ºæµæ°´çº¿çš„å¼•å…¥ï¼Œç¡®ä¿å„æ­¥éª¤è¿…é€Ÿå®Œæˆï¼ŒåŠæ—¶å‘ç°å¹¶ä¿®å¤é›†æˆé—®é¢˜ã€‚å®æ–½æŒç»­é›†æˆæ—¶ï¼Œéœ€é¿å…æ•™æ¡ä¸»ä¹‰ï¼Œå› åœ°åˆ¶å®œï¼Œä»¥æ»¡è¶³å›¢é˜Ÿéœ€æ±‚ã€‚</p>
<h3 id="5-2-æŒç»­äº¤ä»˜"><a href="#5-2-æŒç»­äº¤ä»˜" class="headerlink" title="5.2 æŒç»­äº¤ä»˜"></a>5.2 æŒç»­äº¤ä»˜</h3><p>æŒç»­äº¤ä»˜æ—¨åœ¨ä»¥å®‰å…¨ã€å¿«é€Ÿã€å¯æŒç»­çš„æ–¹å¼å°†å˜æ›´äº¤ä»˜è‡³ç”Ÿäº§ç¯å¢ƒæˆ–ç”¨æˆ·æ‰‹ä¸­ã€‚å®ƒæ˜¯æŒç»­é›†æˆçš„å»¶ä¼¸ï¼Œå¼ºè°ƒç‰ˆæœ¬æ§åˆ¶ã€è‡ªåŠ¨åŒ–ã€å¿«é€Ÿæ‰§è¡Œå’ŒåŠæ—¶ä¿®å¤ã€‚å…¶æ ¸å¿ƒç›®æ ‡æ˜¯ç¼©çŸ­å¼€å‘åˆ°å‘å¸ƒçš„æ—¶é—´ï¼Œæé«˜å‘å¸ƒçš„å¯é æ€§ã€‚é€ç‰¹æ€§å‘å¸ƒçš„é›†æˆæ–¹å¼ï¼Œæ˜¯å¯¹ç‰¹æ€§å‘å¸ƒé€Ÿåº¦æè‡´è¿½æ±‚çš„ä½“ç°ã€‚</p>
<h3 id="5-3-å˜æ›´ç®¡ç†"><a href="#5-3-å˜æ›´ç®¡ç†" class="headerlink" title="5.3 å˜æ›´ç®¡ç†"></a>5.3 å˜æ›´ç®¡ç†</h3><p>å˜æ›´ç®¡ç†ç¡®ä¿è½¯ä»¶å¼€å‘ä¸­çš„æ‰€æœ‰å˜æ›´å‡è¢«è®°å½•å’Œè¿½æº¯ã€‚éµå¾ªå¯ç°åº¦ã€å¯ç›‘æ§ã€å¯å›æ»šçš„ä¸‰å¤§åŸåˆ™ï¼Œå¯¹åŸºç¡€è®¾æ–½ã€ä»£ç åŸºçº¿ã€é…ç½®é¡¹ã€ä¾èµ–é¡¹ã€æ•°æ®åº“åŠç”Ÿäº§å‘å¸ƒç­‰å˜æ›´è¿›è¡Œæœ‰æ•ˆç®¡ç†ã€‚æœ€ä½³å®è·µåŒ…æ‹¬è‡ªåŠ¨åŒ–å˜æ›´è¿‡ç¨‹ã€å»ºç«‹è¯„å®¡æœºåˆ¶ã€ç¡®ä¿å¯è¿½æº¯æ€§ã€ç°åº¦å‘å¸ƒå’Œå›æ»šèƒ½åŠ›ã€‚</p>
<h3 id="5-4-éƒ¨ç½²è‡ªåŠ¨åŒ–"><a href="#5-4-éƒ¨ç½²è‡ªåŠ¨åŒ–" class="headerlink" title="5.4 éƒ¨ç½²è‡ªåŠ¨åŒ–"></a>5.4 éƒ¨ç½²è‡ªåŠ¨åŒ–</h3><p>éƒ¨ç½²è‡ªåŠ¨åŒ–å…è®¸ç”¨æˆ·é€šè¿‡ä¸€é”®å¼æ“ä½œå°†è½¯ä»¶éƒ¨ç½²è‡³æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒï¼Œå…¨ç¨‹è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹å·¥å¹²é¢„ã€‚æ¯ä¸ªç¯å¢ƒä½¿ç”¨ç›¸åŒçš„éƒ¨ç½²æµç¨‹ï¼Œç¡®ä¿è½¯ä»¶åŒ…çš„ä¸€è‡´æ€§ã€‚åˆ©ç”¨ç‰ˆæœ¬æ§åˆ¶çš„ä»£ç ä»“åº“ï¼Œä¾¿äºåˆ›å»ºç‰¹å®šçŠ¶æ€çš„ç¯å¢ƒã€‚</p>
<h3 id="5-5-åˆ¶å“ç®¡ç†"><a href="#5-5-åˆ¶å“ç®¡ç†" class="headerlink" title="5.5 åˆ¶å“ç®¡ç†"></a>5.5 åˆ¶å“ç®¡ç†</h3><p>åˆ¶å“æ˜¯è½¯ä»¶èµ„äº§çš„å…³é”®éƒ¨åˆ†ï¼Œå­˜æ”¾åœ¨åˆ¶å“åº“ä¸­ä»¥é˜²æŸåæˆ–ä¸¢å¤±ï¼ŒåŒæ—¶ä¾¿äºæŸ¥æ‰¾å’Œè¿½æº¯ã€‚é™¤äº†åˆ¶å“æœ¬èº«ï¼Œè¿˜éœ€ç®¡ç†å…¶å…ƒæ•°æ®ï¼Œå¦‚è´¨é‡ç­‰çº§å’Œä¸æºä»£ç çš„å…³è”å…³ç³»ã€‚åˆ¶å“ä»“åº“æ˜¯ä¼ä¸šè½¯ä»¶èµ„äº§ç®¡ç†å¹³å°ï¼Œä¸ºåˆè§„ã€å®‰å…¨ä½¿ç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶æä¾›ä¿éšœã€‚</p>
<h3 id="5-6-å‘å¸ƒç­–ç•¥"><a href="#5-6-å‘å¸ƒç­–ç•¥" class="headerlink" title="5.6 å‘å¸ƒç­–ç•¥"></a>5.6 å‘å¸ƒç­–ç•¥</h3><p>ç†è§£å’Œåˆ¶å®šå‘å¸ƒç­–ç•¥çš„å‰ææ˜¯æ˜ç¡®éƒ¨ç½²ä¸å‘å¸ƒçš„å·®å¼‚ã€‚æ²¡æœ‰é€šç”¨çš„æœ€ä½³ç­–ç•¥ï¼Œåªæœ‰æœ€é€‚åˆåœºæ™¯çš„ç­–ç•¥ã€‚é€‰æ‹©å‘å¸ƒç­–ç•¥æ—¶ï¼Œéœ€ç»¼åˆè€ƒè™‘æŠ€æœ¯å’Œä¸šåŠ¡å› ç´ ã€‚å¸¸è§çš„ç­–ç•¥åŒ…æ‹¬åœæœºéƒ¨ç½²ã€æ»šåŠ¨æ›´æ–°ã€è“ç»¿éƒ¨ç½²ç­‰ã€‚å®ç°è¿™äº›ç­–ç•¥éœ€å…³æ³¨è´Ÿè½½å‡è¡¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½ç­‰æŠ€æœ¯è¦ç‚¹ã€‚</p>
<h3 id="5-7-æ•°æ®åº“å˜æ›´"><a href="#5-7-æ•°æ®åº“å˜æ›´" class="headerlink" title="5.7 æ•°æ®åº“å˜æ›´"></a>5.7 æ•°æ®åº“å˜æ›´</h3><p>æ•°æ®å¼€å‘äººå‘˜åº”åƒåº”ç”¨å¼€å‘äººå‘˜ä¸€æ ·ç®¡ç†æ•°æ®åº“èµ„äº§ï¼Œç¡®ä¿æ•°æ®åº“æ¶æ„å…·å¤‡æ¼”è¿›èƒ½åŠ›ã€‚é‡è§†æ•°æ®åº“Schemaè„šæœ¬çš„å˜æ›´ç®¡ç†ï¼Œå®æ–½ç‰ˆæœ¬æ§åˆ¶å’Œå‘å¸ƒæµç¨‹ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿›è¡Œå˜æ›´æ—¶ï¼Œç¡®ä¿å‡çº§è¿ç§»çš„å®‰å…¨å¯é ä»¥åŠæ•°æ®çš„ä¿æŠ¤å’Œéšç§ã€‚</p>
<h3 id="5-8-é…ç½®å‚æ•°ç®¡ç†"><a href="#5-8-é…ç½®å‚æ•°ç®¡ç†" class="headerlink" title="5.8 é…ç½®å‚æ•°ç®¡ç†"></a>5.8 é…ç½®å‚æ•°ç®¡ç†</h3><p>ç³»ç»Ÿé…ç½®å‚æ•°å’Œä¸šåŠ¡é…ç½®å‚æ•°å‡åº”å¾—åˆ°å¦¥å–„ç®¡ç†ã€‚æ ¹æ®é…ç½®å‚æ•°çš„æ€§è´¨å’Œé€‚ç”¨åœºæ™¯ï¼Œé€‰æ‹©åˆé€‚çš„ç®¡ç†æ–¹æ³•ã€‚è‹¥é…ç½®å‚æ•°éšæºä»£ç æ¼”è¿›ï¼Œå»ºè®®ä¸æºä»£ç ä¸€åŒçº³å…¥é›†æˆå‘å¸ƒæµç¨‹ï¼›è‹¥é…ç½®å‚æ•°å€¼éšç¯å¢ƒå˜åŒ–ï¼Œåˆ™æ— éœ€ä¸æºä»£ç åŒæ­¥ã€‚</p>
<h2 id="ç¬¬6ç« -è¿ç»´é¢†åŸŸå®è·µ"><a href="#ç¬¬6ç« -è¿ç»´é¢†åŸŸå®è·µ" class="headerlink" title="ç¬¬6ç«  è¿ç»´é¢†åŸŸå®è·µ"></a>ç¬¬6ç«  è¿ç»´é¢†åŸŸå®è·µ</h2><h3 id="6-1-äº‘åŸç”ŸåŸºç¡€è®¾æ–½"><a href="#6-1-äº‘åŸç”ŸåŸºç¡€è®¾æ–½" class="headerlink" title="6.1 äº‘åŸç”ŸåŸºç¡€è®¾æ–½"></a>6.1 äº‘åŸç”ŸåŸºç¡€è®¾æ–½</h3><p>äº‘åŸç”Ÿä¸ä»…æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œæ›´æ˜¯ä¸€ç§æ€æƒ³ï¼Œèåˆäº†æŠ€æœ¯ä¸ä¼ä¸šç®¡ç†æ–¹æ³•ã€‚å®ƒä¸ºæŠ€æœ¯åˆ›æ–°å’Œæµç¨‹æ”¹è¿›æä¾›äº†åšå®çš„æ”¯æ’‘å¹³å°ï¼Œå…·å¤‡å®¹å™¨åŒ–çš„ä¸€è‡´æ€§è¿è¡Œç¯å¢ƒã€å£°æ˜å¼APIç³»ç»Ÿå’Œç»Ÿä¸€çš„å¯è§‚æµ‹æ€§æ–¹æ¡ˆç­‰æ ¸å¿ƒèƒ½åŠ›ã€‚</p>
<h3 id="6-2-å¯è§‚æµ‹æ€§"><a href="#6-2-å¯è§‚æµ‹æ€§" class="headerlink" title="6.2 å¯è§‚æµ‹æ€§"></a>6.2 å¯è§‚æµ‹æ€§</h3><p>å¯è§‚æµ‹æ€§æ¶µç›–äº‹ä»¶æ—¥å¿—ã€é“¾è·¯è¿½è¸ªå’ŒèšåˆæŒ‡æ ‡ä¸‰ä¸ªæ–¹å‘ã€‚å®ƒå¸®åŠ©ä¼ä¸šå®æ—¶ç›‘æ§ã€åˆ†æå¹¶è¯Šæ–­å¤æ‚ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼Œç¡®ä¿ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚é€šè¿‡å®æ–½å¯è§‚æµ‹æ€§ç­–ç•¥ï¼Œä¼ä¸šèƒ½å¤ŸåŠæ—¶å‘ç°é—®é¢˜ã€å¿«é€Ÿå“åº”ï¼Œä»è€Œæå‡ç³»ç»Ÿè¿ç»´çš„æ•ˆç‡å’Œè´¨é‡ã€‚</p>
<h3 id="6-3-å…¨æ™¯ç›‘æ§"><a href="#6-3-å…¨æ™¯ç›‘æ§" class="headerlink" title="6.3 å…¨æ™¯ç›‘æ§"></a>6.3 å…¨æ™¯ç›‘æ§</h3><p>å…¨æ™¯ç›‘æ§ï¼Œä½œä¸ºä¸€ç§å…¨é¢çš„å¯è§‚æµ‹æ€§è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿæ·±å…¥æ´å¯Ÿç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µï¼Œä»è€ŒåŠ©åŠ›ä¼ä¸šå®ç°ä¸šåŠ¡çš„é€æ˜åŒ–ã€æå‡å¯¹é—®é¢˜çš„å“åº”é€Ÿåº¦ï¼Œå¹¶åŠ å¼ºå¯¹å…¨å±€çš„æŠŠæ§ã€‚å®ƒæ¶µç›–äº†ç›‘æ§æ•°æ®é‡‡é›†ã€ä¼ è¾“ã€å­˜å‚¨ã€å¯è§†åŒ–ã€è­¦æƒ…è¯„ä¼°ã€ç›‘æ§å‘Šè­¦å’Œæ•°æ®åˆ†æç­‰å¤šä¸ªå…³é”®ç¯èŠ‚ã€‚æœ‰æ•ˆçš„å…¨æ™¯ç›‘æ§ä¸ä»…èƒ½å¤Ÿé™ä½è¿ç»´é£é™©ï¼Œè¿˜èƒ½å¸®åŠ©å¼€å‘å·¥ç¨‹å¸ˆåœ¨è½¯ä»¶å¼€å‘å’Œäº¤ä»˜è¿‡ç¨‹ä¸­æå‡æ•ˆèƒ½ï¼Œç¡®ä¿åŸºäºç›‘æ§æ•°æ®åšå‡ºæ­£ç¡®çš„å†³ç­–ã€‚</p>
<h3 id="6-4-æ™ºèƒ½è¿ç»´"><a href="#6-4-æ™ºèƒ½è¿ç»´" class="headerlink" title="6.4 æ™ºèƒ½è¿ç»´"></a>6.4 æ™ºèƒ½è¿ç»´</h3><p>ç»“åˆäººå·¥æ™ºèƒ½æŠ€æœ¯ä¸ä¼ ç»Ÿè‡ªåŠ¨åŒ–è¿ç»´ï¼ŒAIOpsï¼ˆæ™ºèƒ½è¿ç»´ï¼‰å¤§å¹…æå‡äº†è¿ç»´çš„æ•ˆèƒ½ã€‚å…¶æ ¸å¿ƒå…³é”®æŠ€æœ¯åŒ…æ‹¬æ•°æ®é‡‡é›†ã€å¤„ç†ã€å­˜å‚¨ã€åˆ†æå’ŒAIOpsç®—æ³•ã€‚åœ¨è¿è¥ä¿éšœã€æˆæœ¬ä¼˜åŒ–å’Œæ•ˆç‡æå‡ä¸‰å¤§åº”ç”¨åœºæ™¯ä¸­ï¼ŒAIOpså±•ç°å‡ºäº†å·¨å¤§çš„æ½œåŠ›ã€‚å¸¸è§çš„ç®—æ³•æŠ€æœ¯æœ‰æŒ‡æ ‡è¶‹åŠ¿é¢„æµ‹ã€æŒ‡æ ‡èšç±»ã€å¤šæŒ‡æ ‡è”åŠ¨å…³è”æŒ–æ˜ç­‰ï¼Œå®ƒä»¬å…±åŒä¸ºä¼ä¸šçš„è¿ç»´å·¥ä½œæä¾›å¼ºæœ‰åŠ›çš„æ”¯æŒã€‚</p>
<h3 id="6-5-æ··æ²Œå·¥ç¨‹"><a href="#6-5-æ··æ²Œå·¥ç¨‹" class="headerlink" title="6.5 æ··æ²Œå·¥ç¨‹"></a>6.5 æ··æ²Œå·¥ç¨‹</h3><p>æ··æ²Œå·¥ç¨‹æ˜¯ä¸€é¡¹æ—¨åœ¨æå‡å¤æ‚ç³»ç»Ÿç¨³å®šæ€§çš„èµ‹èƒ½æ´»åŠ¨ã€‚é€šè¿‡æ•…éšœæ³¨å…¥å®éªŒï¼Œå®ƒå¢å¼ºäº†å„è§’è‰²ä¹‹é—´çš„åä½œï¼Œä»è€Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚æ··æ²Œå·¥ç¨‹ä¸ä»…åˆ†æç³»ç»Ÿè¿è¡Œå’Œå¤±æ•ˆæ¨¡å¼ä»¥äº†è§£å¤æ‚ç³»ç»Ÿï¼Œè¿˜é€šè¿‡æ”¹è¿›ç³»ç»Ÿç¨³å®šæ€§å’Œå¯è§‚æµ‹æœºåˆ¶ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„éŸ§æ€§å’Œæ•…éšœå“åº”é€Ÿåº¦ã€‚</p>
<h3 id="6-6-ChatOps"><a href="#6-6-ChatOps" class="headerlink" title="6.6 ChatOps"></a>6.6 ChatOps</h3><p>ChatOpsï¼Œä¸€ç§æ–°å‹æ™ºèƒ½å·¥ä½œæ–¹å¼ï¼Œå·§å¦™åœ°è¿æ¥äº†äººã€æœºå™¨äººå’Œå·¥å…·ã€‚å®ƒä»¥åœ¨çº¿æ²Ÿé€šå¹³å°ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡æœºå™¨äººä¸åç«¯æœåŠ¡çš„æ— ç¼å¯¹æ¥ï¼Œå®ç°äº†é«˜æ•ˆçš„å·¥ä½œæµç¨‹ã€‚ChatOpsç”±è‡ªåŠ¨åŒ–çš„æµç¨‹ã€èŠå¤©å®¤ï¼ˆæ§åˆ¶ä¸­å¿ƒï¼‰ã€æœºå™¨äººï¼ˆè¿æ¥ä¸­å¿ƒï¼‰å’ŒåŸºç¡€è®¾æ–½å››ä¸ªä¸»è¦éƒ¨åˆ†æ„æˆã€‚éšç€æŠ€æœ¯çš„å‘å±•ï¼ŒChatOpsæ­£é€æ¸ä»ç®€å•çš„æŒ‡ä»¤é©±åŠ¨å‘æ•°æ®å’Œæµç¨‹é©±åŠ¨è½¬å˜ã€‚</p>
<h2 id="ç¬¬7ç« -è¿è¥é¢†åŸŸå®è·µ"><a href="#ç¬¬7ç« -è¿è¥é¢†åŸŸå®è·µ" class="headerlink" title="ç¬¬7ç«  è¿è¥é¢†åŸŸå®è·µ"></a>ç¬¬7ç«  è¿è¥é¢†åŸŸå®è·µ</h2><p>è¿è¥é¢†åŸŸçš„èŒƒç•´å¹¿æ³›ï¼Œé€šå¸¸æ¶µç›–äº†To Bã€To Cã€To Eå’ŒTo Gå››å¤§ç±»ã€‚äº§å“ä¸Šçº¿åï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„å¢é•¿æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä»0-1å’Œ1-Nä¸¤ä¸ªé˜¶æ®µçš„æœ‰æ•ˆè¿è¥ã€‚ç»“åˆWhoã€Whatã€Whenå’ŒWhereçš„ç»´åº¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶å®šå’Œæ¨å¹¿æœ‰é’ˆå¯¹æ€§çš„å¢é•¿ç­–ç•¥ã€‚ä¸€ç§æ™®é€‚ä¸”æ•ˆæœæ˜¾è‘—çš„è¿è¥ç­–ç•¥æ˜¯é‡‡ç”¨äº§å“ç ”å‘å®˜æ–¹å®£ä¼ å’Œä¸šåŠ¡ç”¨æˆ·KOLç«™å°ç›¸ç»“åˆçš„æ–¹å¼ï¼Œä»¥ä¼ é€’äº§å“çš„ç‹¬ç‰¹ä»·å€¼ã€‚åœ¨å‡å°‘äººå·¥è¿è¥æ–¹é¢ï¼Œæœ‰ä¸‰ä¸ªå®ç”¨çš„æ–¹æ³•ï¼šåˆ¶å®šè¯¦ç»†çš„äº§å“æ“ä½œSOPï¼ˆæ ‡å‡†ä½œä¸šç¨‹åºï¼‰ã€ä½¿ç”¨äº§å“å°åŠ©æ‰‹å…¬ç”¨è´¦å·è¿›è¡Œé—®é¢˜è§£ç­”ï¼Œä»¥åŠè®¾ç½®ä½¿ç”¨é—¨æ§›ï¼Œç¡®ä¿ç”¨æˆ·é€šè¿‡è€ƒè¯•åæ‰èƒ½å¼€å¯è´¦å·ã€‚</p>
<h2 id="ç¬¬8ç« -ç»„ç»‡å’Œæ–‡åŒ–é¢†åŸŸå®è·µ"><a href="#ç¬¬8ç« -ç»„ç»‡å’Œæ–‡åŒ–é¢†åŸŸå®è·µ" class="headerlink" title="ç¬¬8ç«  ç»„ç»‡å’Œæ–‡åŒ–é¢†åŸŸå®è·µ"></a>ç¬¬8ç«  ç»„ç»‡å’Œæ–‡åŒ–é¢†åŸŸå®è·µ</h2><h3 id="8-1-æ•æ·ç»„ç»‡"><a href="#8-1-æ•æ·ç»„ç»‡" class="headerlink" title="8.1 æ•æ·ç»„ç»‡"></a>8.1 æ•æ·ç»„ç»‡</h3><p>æ•æ·ç»„ç»‡è‡´åŠ›äºå°†ä¼ ç»Ÿçš„å›ºåŒ–ç­‰çº§å®˜åƒšæ€§ç»“æ„è½¬å˜ä¸ºå……æ»¡ç”Ÿå‘½åŠ›çš„æœ‰æœºä½“ã€‚å®ƒä¸ä»…å…³ä¹å•ç‚¹èƒ½åŠ›ï¼Œè€Œæ˜¯æ¶‰åŠåˆ°æˆ˜ç•¥ã€æ¶æ„ã€æµç¨‹ã€äººå‘˜å’ŒæŠ€æœ¯ç­‰å¤šä¸ªå±‚é¢çš„ç³»ç»Ÿå·¥ç¨‹ã€‚å®ç°æ•æ·ç»„ç»‡çš„è½åœ°éœ€è¦éµå¾ªä¸€ä¸ªæ ¸å¿ƒåŸåˆ™ã€ä¸¤ä¸ªå¿…è¦æ”¯æŸ±ã€ä¸‰ç§åä½œæ¨¡å¼ä»¥åŠå››ç±»å›¢é˜Ÿç±»å‹ã€‚</p>
<h3 id="8-2-æ•…éšœå¤ç›˜"><a href="#8-2-æ•…éšœå¤ç›˜" class="headerlink" title="8.2 æ•…éšœå¤ç›˜"></a>8.2 æ•…éšœå¤ç›˜</h3><p>å›¢é˜Ÿçš„å¤ç›˜èƒ½åŠ›ç›´æ¥å†³å®šäº†å…¶è¿›æ­¥ç©ºé—´çš„å¤§å°ã€‚åœ¨å¤æ‚ç³»ç»Ÿä¸­ï¼Œç”±äºé«˜ç½‘ç»œå¯†åº¦å’Œå¼ºè€¦åˆæ€§ï¼Œæ•…éšœå¾€å¾€éš¾ä»¥å®Œå…¨é¿å…ã€‚ç„¶è€Œï¼Œå…³é”®åœ¨äºè®¤è¯†åˆ°æ•…éšœåªæ˜¯è¡¨è±¡ï¼ŒèƒŒåçš„æŠ€æœ¯å’Œç®¡ç†é—®é¢˜æ‰æ˜¯æ ¹æœ¬æ‰€åœ¨ã€‚æˆ‘ä»¬éœ€è¦åŒ…å®¹å¤±è´¥ï¼Œä½†ç»ä¸å…è®¸çŠ¯é”™ã€‚åœ¨å¤ç›˜è¿‡ç¨‹ä¸­ï¼Œåº”é¿å…ä»…å…³æ³¨å”¯ä¸€æ ¹å› ã€‚</p>
<h3 id="8-3-å·¥ç¨‹å¸ˆæ–‡åŒ–"><a href="#8-3-å·¥ç¨‹å¸ˆæ–‡åŒ–" class="headerlink" title="8.3 å·¥ç¨‹å¸ˆæ–‡åŒ–"></a>8.3 å·¥ç¨‹å¸ˆæ–‡åŒ–</h3><p>æ–‡åŒ–å¯¹äºä¼ä¸šçš„æˆè´¥è‡³å…³é‡è¦ã€‚å»ºç«‹ç¬¦åˆå…¬å¸ç‰¹ç‚¹å’Œæ–‡åŒ–ä½“ç³»çš„æ ¸å¿ƒä»·å€¼è§‚ï¼Œå¯¹äºå…¬å¸çš„å¥åº·å‘å±•å…·æœ‰é‡å¤§æ„ä¹‰ã€‚ä¼˜ç§€å·¥ç¨‹å¸ˆæ–‡åŒ–é€šå¸¸å…·å¤‡å¹³ç­‰ã€é«˜æ•ˆå’Œåˆ›æ–°ç­‰å…±æ€§ç‰¹å¾ã€‚è€Œè¿™äº›ä»·å€¼è§‚çš„å¡‘é€ å’Œä¼ æ‰¿ï¼Œæ˜¯å®ç°å·¥ç¨‹å¸ˆæ–‡åŒ–çš„åŸºçŸ³å’Œæ ¸å¿ƒã€‚å·¥ç¨‹å¸ˆæ–‡åŒ–ï¼Œè™½é‡è¦ï¼Œå´éä¼ä¸šæˆåŠŸçš„å”¯ä¸€å› ç´ ï¼Œæˆ‘ä»¬ä¸åº”è¿‡åº¦ç¥åŒ–ã€‚å®é™…ä¸Šï¼Œå·¥ç¨‹å¸ˆæ–‡åŒ–åŒæ ·éœ€è¦æŒç»­çš„â€œç»´æŠ¤â€ä¸æ»‹å…»ã€‚</p>
<h3 id="ç¬¬9ç« -ç ”å‘æ•ˆèƒ½å¹³å°çš„â€œåŒæµâ€æ¨¡å‹"><a href="#ç¬¬9ç« -ç ”å‘æ•ˆèƒ½å¹³å°çš„â€œåŒæµâ€æ¨¡å‹" class="headerlink" title="ç¬¬9ç«  ç ”å‘æ•ˆèƒ½å¹³å°çš„â€œåŒæµâ€æ¨¡å‹"></a>ç¬¬9ç«  ç ”å‘æ•ˆèƒ½å¹³å°çš„â€œåŒæµâ€æ¨¡å‹</h3><p>åœ¨å¤šä¸ªå·¥å…·å¹³å°é—´é¢‘ç¹åˆ‡æ¢ï¼Œä¸ºç ”å‘äººå‘˜å¸¦æ¥ç ”å‘æµç¨‹ä¸Šçš„å·¨å¤§æŒ‘æˆ˜ã€‚è€Œâ€œä¸€ç«™å¼â€ä¸â€œä¸€é”®å¼â€çš„ç ”å‘æ•ˆèƒ½å¹³å°åˆ™èƒ½æœ‰æ•ˆé™ä½è¿™ç§è®¤çŸ¥è´Ÿè·ï¼Œè®©ç ”å‘äººå‘˜å¾—ä»¥æ›´ä¸“æ³¨äºåˆ›é€ çœŸæ­£çš„ä»·å€¼ï¼Œè€Œéé™·å…¥çç¢çš„äº‹åŠ¡æ€§å·¥ä½œã€‚è¿™ç§â€œåŒæµâ€æ¨¡å‹ç¡®ä¿äº†éœ€æ±‚ä»·å€¼æµä¸ç ”å‘å·¥ä½œæµä¹‹é—´çš„é«˜æ•ˆååŒä¸è‡ªåŠ¨åŒ–çš„æµç•…è”åŠ¨ã€‚</p>
<h2 id="ç¬¬10ç« -è‡ªç ”å·¥å…·ä½“ç³»"><a href="#ç¬¬10ç« -è‡ªç ”å·¥å…·ä½“ç³»" class="headerlink" title="ç¬¬10ç«  è‡ªç ”å·¥å…·ä½“ç³»"></a>ç¬¬10ç«  è‡ªç ”å·¥å…·ä½“ç³»</h2><h3 id="10-1æ•æ·åä½œåŸŸå·¥å…·"><a href="#10-1æ•æ·åä½œåŸŸå·¥å…·" class="headerlink" title="10.1æ•æ·åä½œåŸŸå·¥å…·"></a>10.1æ•æ·åä½œåŸŸå·¥å…·</h3><p>æ•æ·åä½œåŸŸå·¥å…·æ—¨åœ¨æ»¡è¶³ä¼ä¸šçš„æ•æ·åä½œéœ€æ±‚ï¼Œæ¨åŠ¨æ•æ·æ–‡åŒ–çš„ç”Ÿé•¿ï¼Œä½¿æ•æ·å®è·µå¾—ä»¥çœŸæ­£è½åœ°ã€‚å…¶ä¸­ï¼Œæ¶µç›–äº†è§„åˆ’ä¸è¿‡ç¨‹ç®¡ç†ã€éœ€æ±‚ç®¡ç†ã€æµ‹è¯•ç®¡ç†ã€æ–‡æ¡£ååŒä¸çŸ¥è¯†åº“ï¼Œä»¥åŠåº¦é‡ä¸æŒç»­æ”¹è¿›ç­‰å…³é”®ç¯èŠ‚ï¼Œå…±åŒæ„æˆäº†æ•æ·åä½œçš„å…¨æ™¯å›¾ã€‚è€Œäº§ä¸šç ”å‘éœ€æ±‚å·¥ä½œæµçš„çµæ´»ååŒï¼Œåˆ™ç¡®ä¿äº†éœ€æ±‚çš„é€å±‚æ‹†è§£ä¸è‡ªåŠ¨åŒ–çš„ç´§å¯†å…³è”ã€‚è¿­ä»£ç®¡ç†åˆ™æ”¯æŒäº§å“åˆ¶å’Œé¡¹ç›®åˆ¶ä¸¤å¤§æ¨¡å¼ï¼Œæ»¡è¶³ä¸åŒå‘å¸ƒèŠ‚å¥çš„éœ€æ±‚ã€‚</p>
<h3 id="10-2-ä»£ç åŸŸå·¥å…·"><a href="#10-2-ä»£ç åŸŸå·¥å…·" class="headerlink" title="10.2 ä»£ç åŸŸå·¥å…·"></a>10.2 ä»£ç åŸŸå·¥å…·</h3><p>ä»£ç åŸŸå·¥å…·æ˜¯è½¯ä»¶å¼€å‘å·¥ç¨‹å¸ˆçš„æ ¸å¿ƒè£…å¤‡ï¼Œå…¶èƒ½åŠ›æ°´å¹³ç›´æ¥åæ˜ äº†å…¬å¸çš„è½¯ä»¶å·¥ç¨‹å®åŠ›ä¸å·¥ç¨‹å½±å“åŠ›ã€‚è¿™äº›å·¥å…·ä¸ä»…é™äºå¼€å‘å·¥å…·ï¼ˆDevToolsï¼‰ï¼Œæ›´åº”æœç€ç ”å‘åŸºç¡€è®¾æ–½ï¼ˆDevlnfraï¼‰çš„æ–¹å‘è¿ˆè¿›ã€‚</p>
<h3 id="10-3-æµ‹è¯•åŸŸå·¥å…·"><a href="#10-3-æµ‹è¯•åŸŸå·¥å…·" class="headerlink" title="10.3 æµ‹è¯•åŸŸå·¥å…·"></a>10.3 æµ‹è¯•åŸŸå·¥å…·</h3><p>æµ‹è¯•åŸŸå·¥å…·æ¶µç›–äº†æµ‹è¯•è¿‡ç¨‹ç®¡ç†ä¸æµ‹è¯•èµ„äº§ç®¡ç†ä¸¤å¤§ç»´åº¦ï¼Œéœ€è¦ç‹¬ç«‹è®¾è®¡ã€‚æµ‹è¯•æµæ°´çº¿ä¸ç ”å‘æµæ°´çº¿çš„ç´§å¯†ååŒï¼Œé€šè¿‡æµ‹è¯•å·¦ç§»å’Œå³ç§»çš„å®è·µï¼Œå®ç°äº†å…¨é“¾è·¯çš„æµ‹è¯•èƒ½åŠ›ã€‚è€Œè‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œä½“ç³»ï¼Œåˆ™æ˜¯æå‡ç ”å‘æ•ˆèƒ½çš„å…³é”®ã€‚</p>
<h3 id="10-4-CI-CDåŸŸå·¥å…·"><a href="#10-4-CI-CDåŸŸå·¥å…·" class="headerlink" title="10.4 CI/CDåŸŸå·¥å…·"></a>10.4 CI/CDåŸŸå·¥å…·</h3><p>è½¯ä»¶äº¤ä»˜æ•ˆç‡çš„æå‡æ¥æºäºé¢†åŸŸå†…çš„æ‰§è¡Œæ•ˆç‡å’Œé¢†åŸŸé—´çš„ååŒæ•ˆç‡ï¼Œå®ç°äº†ä»äººé©±åŠ¨å·¥å…·åˆ°å·¥å…·é©±åŠ¨äººçš„è½¬å˜ã€‚CI/CDåŸŸå·¥å…·çš„ä»·å€¼ä½“ç°åœ¨è¿‡ç¨‹ååŒã€ä¿¡æ¯ååŒå’Œç»„ç»‡ååŒä¸‰ä¸ªæ–¹é¢ï¼Œå°¤å…¶åœ¨è§„æ¨¡è¶Šå¤§çš„æƒ…å†µä¸‹ï¼Œå…¶æ•ˆæœè¶Šä¸ºæ˜¾è‘—ã€‚è€Œå…¶å…­å¤§é€šç”¨è®¾è®¡åŸåˆ™ï¼Œå¯ä»¥è¯´æ˜¯å¿…ä¸å¯å°‘çš„ã€‚å¯¹äºCI/CDåŸŸå·¥å…·æ¥è¯´ï¼Œå…¶æœªæ¥çš„å‘å±•æ–¹å‘æ˜¯äº‘åŸç”Ÿå’Œä»·å€¼æµäº¤ä»˜å¹³å°ï¼Œè¿™æ˜¯ä¸å¯é€†è½¬çš„è¶‹åŠ¿ã€‚</p>
<h3 id="10-5-è¿ç»´åŸŸå·¥å…·"><a href="#10-5-è¿ç»´åŸŸå·¥å…·" class="headerlink" title="10.5 è¿ç»´åŸŸå·¥å…·"></a>10.5 è¿ç»´åŸŸå·¥å…·</h3><p>åœ¨æ„å»ºè¿ç»´å¹³å°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å…¶é€šç”¨æ€§ï¼ŒåŒæ—¶å…¼é¡¾å¯é æ€§ã€å¯é‡ç”¨æ€§å’Œå¯é‡å¤æ€§ï¼Œä»¥é™ä½è‡ªåŠ¨åŒ–æŠ€æœ¯çš„é—¨æ§›å’Œå‡å°‘é‡å¤å»ºè®¾çš„æˆæœ¬ã€‚è€ŒX-Opsç†å¿µï¼Œå·²åœ¨DevOpsã€DataOpsã€AlOpsã€MLOpsã€GitOpså’ŒCloudOpsç­‰å®è·µä¸­å¾—åˆ°å¹¿æ³›è®¤å¯å¹¶è½åœ°ã€‚å¯¹äºè¿ç»´åŸŸå·¥å…·çš„å‘å±•ï¼Œæˆ‘ä»¬æœ‰äº”å¤§è¶‹åŠ¿å¯ä»¥æœŸå¾…ï¼šäº‘åŸç”ŸåŒ–ã€ä½ä»£ç åŒ–ã€ç§»åŠ¨ç«¯èƒ½åŠ›ã€å¼€å‘å’Œè¿ç»´çš„æ·±åº¦èåˆï¼Œä»¥åŠè¿ç»´æœåŠ¡åŒ–ä¸æ™ºèƒ½åŒ–ã€‚</p>
<h3 id="10-6-ç§»åŠ¨ç ”å‘å¹³å°"><a href="#10-6-ç§»åŠ¨ç ”å‘å¹³å°" class="headerlink" title="10.6 ç§»åŠ¨ç ”å‘å¹³å°"></a>10.6 ç§»åŠ¨ç ”å‘å¹³å°</h3><p>ç§»åŠ¨ç ”å‘å¹³å°çš„å®—æ—¨åœ¨äºåŠ é€Ÿç«¯åˆ°ç«¯çš„ç ”å‘äº¤ä»˜æ•ˆç‡ï¼Œæå‡Appçš„çº¿ä¸Šå“è´¨ï¼Œå¹¶é™ä½ä»£ç å¼€å‘æˆæœ¬ã€‚ä»ç”¨æˆ·åœºæ™¯å‡ºå‘ï¼Œç§»åŠ¨ç ”å‘å¹³å°æ¶µç›–äº†ç§»åŠ¨ç ”å‘ã€è´¨é‡ã€åº”ç”¨æ€§èƒ½ç›‘æ§ã€ä½ä»£ç ã€Webç ”å‘ã€é¡¹ç›®ç®¡ç†ç­‰å…­å¤§å»ºè®¾æ–¹å‘ã€‚è€Œæœªæ¥ï¼Œæˆ‘ä»¬å¯ä»¥æœŸå¾…ç§»åŠ¨ç ”å‘å¹³å°çš„ä¸‰å¤§å‘å±•æ–¹å‘ï¼šäº‘IDEåŒ–ã€è·¨ç«¯å¼€å‘ã€æµ‹è¯•å·¦ç§»ã€‚</p>
<h3 id="10-7-ä¸€ä½“åŒ–ååŒå¹³å°"><a href="#10-7-ä¸€ä½“åŒ–ååŒå¹³å°" class="headerlink" title="10.7 ä¸€ä½“åŒ–ååŒå¹³å°"></a>10.7 ä¸€ä½“åŒ–ååŒå¹³å°</h3><p>å•ç‚¹å·¥å…·çš„ä¸²è”æ— æ³•æœ‰æ•ˆè§£å†³ç ”å‘æ•ˆèƒ½çš„â€œç—›ç‚¹â€ï¼Œå› æ­¤ï¼Œä¼ä¸šéœ€è¦é€šè¿‡ä¸€ä½“åŒ–ååŒå¹³å°æ¥æé«˜ç«¯åˆ°ç«¯çš„ä»·å€¼æµåŠ¨æ•ˆç‡ã€‚ä¸€ä½“åŒ–ååŒå¹³å°çš„ä»·å€¼åœ¨äºæœ€å¤§åŒ–è½¯ä»¶å·¥ç¨‹ç†å¿µçš„è½åœ°ï¼Œå®ç°æ•°å­—åŒ–ç ”å‘ç®¡ç†ï¼Œä»¥åŠæä¾›æ²‰æµ¸å¼çš„ç ”å‘ä½“éªŒã€‚åœ¨é›†æˆä¸€ä½“åŒ–ååŒå¹³å°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¯„ä¼°é—­ç¯æ•ˆç‡æ æ†ï¼Œæ˜ç¡®é›†æˆçš„è¾¹ç•Œå’Œæ·±åº¦ã€‚</p>
<h3 id="10-8-ä»£ç æ™ºèƒ½åŒ–å·¥å…·"><a href="#10-8-ä»£ç æ™ºèƒ½åŒ–å·¥å…·" class="headerlink" title="10.8 ä»£ç æ™ºèƒ½åŒ–å·¥å…·"></a>10.8 ä»£ç æ™ºèƒ½åŒ–å·¥å…·</h3><p>ä»£ç æ™ºèƒ½åŒ–å·¥å…·ä¸»è¦ä¾èµ–ä»£ç é™æ€åˆ†æã€ç¼–è¯‘å™¨çš„å‰ç«¯æŠ€æœ¯ç­‰æ‰‹æ®µï¼Œå¹¶ç»“åˆAIã€æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ç­‰æŠ€æœ¯ã€‚åœ¨ä½¿ç”¨è¿™äº›å·¥å…·æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä»£ç çš„è¯­æ³•å’Œè¯­ä¹‰ç‰¹å¾ï¼Œå¦‚ASTã€å®šä¹‰-å¼•ç”¨å…³ç³»ã€å‡½æ•°è°ƒç”¨å…³ç³»ã€æ§åˆ¶æµã€æ•°æ®æµç­‰ã€‚é€šè¿‡æ™ºèƒ½è¯­è¨€æœåŠ¡é€šç”¨æ¡†æ¶SLSCFï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»£ç æäº¤å‰ã€æäº¤ä¸­å’Œæäº¤åå„ç¯èŠ‚å®ç°ä»£ç æ™ºèƒ½åŒ–çš„å®è·µã€‚å…¶ä¸­ï¼Œä»£ç è¡¥å…¨ã€æœç´¢å’Œæ¨èæ˜¯æ™ºèƒ½åŒ–è¾…åŠ©ç ”å‘æ•ˆç‡æå‡çš„ä¸‰å¤§åœºæ™¯ã€‚</p>
<h2 id="ç¬¬11ç« -å¼€æºå·¥å…·é›†æˆ"><a href="#ç¬¬11ç« -å¼€æºå·¥å…·é›†æˆ" class="headerlink" title="ç¬¬11ç«  å¼€æºå·¥å…·é›†æˆ"></a>ç¬¬11ç«  å¼€æºå·¥å…·é›†æˆ</h2><p>åˆç†é‡‡ç”¨å¼€æºå·¥å…·ï¼Œä¼ä¸šå†…éƒ¨èƒ½å¤Ÿé¿å…é‡å¤é€ è½®ï¼Œä½†è¿™ä¹Ÿå¯èƒ½å¼•å‘å·¥å…·å­¤å²›å’Œç¢ç‰‡åŒ–ç ”å‘çš„é—®é¢˜ã€‚å¼€æºDevOpså·¥å…·çš„é€‰å‹å’Œå¯¼å…¥ï¼Œä¸ä»…æ¶‰åŠå­¦ä¹ è°ƒç ”æˆæœ¬ï¼Œè¿˜æ¶‰åŠå·¥å…·é—´çš„é›†æˆå’Œåˆ‡æ¢é—®é¢˜ã€‚å› æ­¤ï¼Œé’ˆå¯¹å¼€æºå·¥å…·çš„é€‰å‹ä¸å¯¼å…¥ï¼Œéœ€è¦å…·ä½“é—®é¢˜å…·ä½“åˆ†æï¼Œéš¾ä»¥ç»™å‡ºä¸€åˆ€åˆ‡ã€é€‚åˆæ‰€æœ‰åœºæ™¯çš„å»ºè®®ã€‚ä¸ºäº†æœ‰æ•ˆåœ°è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å€Ÿé‰´åˆ†å±‚â€œæ¾è€¦åˆâ€çš„æ–¹å¼ï¼ŒåŒ…æ‹¬èƒ½åŠ›åº•åº§ã€å·¥å…·é€‚é…å±‚å’Œå·¥å…·é›†æˆï¼Œè¿™æ ·çš„è®¾è®¡æ–¹æ¡ˆæœ‰åŠ©äºå®ç°æ›´é«˜æ•ˆçš„å·¥å…·é›†æˆã€‚</p>
<h2 id="ç¬¬12ç« -ç ”å‘æ•ˆèƒ½åº¦é‡"><a href="#ç¬¬12ç« -ç ”å‘æ•ˆèƒ½åº¦é‡" class="headerlink" title="ç¬¬12ç«  ç ”å‘æ•ˆèƒ½åº¦é‡"></a>ç¬¬12ç«  ç ”å‘æ•ˆèƒ½åº¦é‡</h2><h3 id="12-1-åº¦é‡æ¡†æ¶"><a href="#12-1-åº¦é‡æ¡†æ¶" class="headerlink" title="12.1 åº¦é‡æ¡†æ¶"></a>12.1 åº¦é‡æ¡†æ¶</h3><p>ç ”å‘æ•ˆèƒ½åº¦é‡æ¡†æ¶å¯ä»¥æ¦‚æ‹¬ä¸ºE3Iæ¡†æ¶ã€‚è™½ç„¶è½¯ä»¶ç ”å‘æ•ˆèƒ½åº¦é‡çš„å†…æ¶µå’Œå¤–å»¶ä¸°å¯Œå¤šæ ·ï¼Œä½†æˆ‘ä»¬å¯ä»¥æçº²æŒˆé¢†åœ°æ¦‚æ‹¬å…¶è¦ä¹‰ã€‚å…¶å†…æ¶µä¸»è¦å½’ç»“ä¸ºæ•ˆæœï¼ˆEffectivenessï¼‰ã€æ•ˆç‡ï¼ˆEfficiencyï¼‰å’Œå“è¶Šèƒ½åŠ›ï¼ˆExcellenceï¼‰è¿™ä¸‰ä¸ªâ€œEâ€ã€‚å¤–å»¶åˆ™ä¸»è¦å½’ç±»ä¸ºäº¤ä»˜ä»·å€¼ã€äº¤ä»˜é€Ÿç‡ã€äº¤ä»˜è´¨é‡ã€äº¤ä»˜æˆæœ¬å’Œäº¤ä»˜èƒ½åŠ›è¿™äº”ä¸ªè®¤çŸ¥åŸŸã€‚ä¸ºäº†æå‡è½¯ä»¶ç ”å‘æ•ˆèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨åº¦é‡ï¼ˆMeasureï¼‰-åˆ†æï¼ˆAnalyzeï¼‰-å›é¡¾ï¼ˆReviewï¼‰-æ”¹è¿›ï¼ˆImproveï¼‰çš„MARIå¾ªç¯ã€‚</p>
<h3 id="12-2-æŒ‡æ ‡ä½“ç³»"><a href="#12-2-æŒ‡æ ‡ä½“ç³»" class="headerlink" title="12.2 æŒ‡æ ‡ä½“ç³»"></a>12.2 æŒ‡æ ‡ä½“ç³»</h3><p>åº¦é‡æŒ‡æ ‡ä½“ç³»çš„è®¾è®¡å¿…é¡»ç´§å¯†å›´ç»•å›¢é˜Ÿç ”å‘æ•ˆèƒ½åº¦é‡çš„ç›®æ ‡ã€‚å®ƒæ˜¯ä¸€ç³»åˆ—å¯é‡åŒ–ç ”å‘æ•ˆèƒ½æ°´å¹³çš„æŒ‡æ ‡é›†åˆï¼Œéœ€è¦ä½¿ç”¨å¤šä¸ªæŒ‡æ ‡ä»ä¸åŒç»´åº¦æ¥ç»¼åˆè¯„ä¼°ä¸åˆ†æã€‚åˆç†çš„æŒ‡æ ‡ä½“ç³»è®¾è®¡ï¼Œå¿…é¡»èƒ½å¤Ÿå‡†ç¡®åæ˜ å‡ºç ”å‘è¿‡ç¨‹ä¸­çš„é—®é¢˜æˆ–å¾…æ”¹è¿›ç‚¹ã€‚æ•ˆèƒ½æŒ‡æ ‡å’Œæ•ˆèƒ½åº¦é‡åº”è¯¥å¼•å¯¼ç ”å‘å›¢é˜Ÿåšå‡ºçœŸæ­£èƒ½è§£å†³é—®é¢˜çš„è¡Œä¸ºï¼Œè€Œä¸ä»…ä»…æ˜¯è¿½æ±‚æ•°æ®ä¸Šçš„å¥½çœ‹ã€‚</p>
<h3 id="12-3æ•ˆèƒ½åˆ†æ"><a href="#12-3æ•ˆèƒ½åˆ†æ" class="headerlink" title="12.3æ•ˆèƒ½åˆ†æ"></a>12.3æ•ˆèƒ½åˆ†æ</h3><p>æ•ˆèƒ½åˆ†ææ˜¯é€šè¿‡ç§‘å­¦çš„æ–¹æ³•ï¼Œæ·±å…¥åˆ†ææ•°æ®ä¸ç ”å‘æ´»åŠ¨çš„å› æœå’Œå…³è”å…³ç³»ï¼Œè¿›è€Œæ‰¾åˆ°ç ”å‘â€ç—›ç‚¹â€ã€å¯æ”¹è¿›é¡¹å’Œå€¼å¾—æ€»ç»“çš„ç»éªŒæ•ˆèƒ½è¯Šæ–­åˆ†æå¯ä»¥ä½¿ç”¨åˆ¤å®šè¡¨ã€è¶‹åŠ¿åˆ†æç­‰æ–¹æ³•ï¼Œæ•ˆèƒ½ä¼˜åŒ–ã€é—®é¢˜åˆ†æå¯ä»¥ä½¿ç”¨é€»è¾‘æ ‘ã€ä¸‹é’»åˆ†æã€ç›¸å…³æ€§åˆ†æç­‰æ–¹æ³•è¦è¿›è¡Œç³»ç»Ÿæ€§çš„æ•ˆèƒ½åˆ†æï¼Œä¸èƒ½é™·å…¥å±€éƒ¨æ€ç»´ï¼Œé¿å…é™·äºâ€æ•°å­—æ¸¸æˆâ€â€åæ˜ éƒ¨åˆ†äº‹å®â€ç­‰å›°å¢ƒè¦æ³¨é‡æ•ˆèƒ½åˆ†æçš„æŒç»­æ€§ï¼ŒæŒç»­åæ€ä¸ä¼˜åŒ–ï¼Œä»¥ç¡®ä¿åœ¨å‘æ•ˆèƒ½æå‡ç›®æ ‡é è¿‘ã€‚</p>
<h3 id="12-4-åº¦é‡å¹³å°"><a href="#12-4-åº¦é‡å¹³å°" class="headerlink" title="12.4 åº¦é‡å¹³å°"></a>12.4 åº¦é‡å¹³å°</h3><p>åº¦é‡å¹³å°çš„è®¾è®¡å¯ä»¥æ‹†åˆ†æˆæ•°æ®é‡‡é›†ã€æ•°æ®è®¡ç®—ã€æ•°æ®åˆ†æå’Œå±•ç°å‡ å±‚ç»„ä»¶ä¸ºæ»¡è¶³ä¸åŒæ•°æ®æºçš„é‡‡é›†å’Œè®¡ç®—åˆ†æï¼Œåœ¨æ•°æ®æ¥å…¥ä¹‹å‰å°±éœ€è¦è®¾è®¡ç»Ÿä¸€çš„æ•°æ®æŠ½è±¡å’Œå…³è”æ˜ å°„æœºåˆ¶ä»¥é¢å‘å¯¹è±¡çš„æ€è·¯æ¥è®¾è®¡ç”»åƒæ•°æ®å’ŒæŒ‡æ ‡ä½“ç³»ï¼Œé¿å…å•çº¯çš„æŒ‡æ ‡å †ç§¯é€šè¿‡å¤šç»´åº¦æ•°æ®åˆ†ææŒ–æ˜å¯¹è±¡ä»¥åŠæŒ‡æ ‡ä¹‹é—´çš„å˜åŒ–è§„å¾‹ï¼Œä»è€Œæ‰¾åˆ°å½±å“æ•ˆèƒ½çš„å…³é”®å› ç´ ã€‚</p>
<h3 id="12-5-ä¸“é¡¹åº¦é‡åˆ†æ"><a href="#12-5-ä¸“é¡¹åº¦é‡åˆ†æ" class="headerlink" title="12.5 ä¸“é¡¹åº¦é‡åˆ†æ"></a>12.5 ä¸“é¡¹åº¦é‡åˆ†æ</h3><h4 id="12-5-1-éœ€æ±‚ä»·å€¼æµåˆ†æ"><a href="#12-5-1-éœ€æ±‚ä»·å€¼æµåˆ†æ" class="headerlink" title="12.5.1 éœ€æ±‚ä»·å€¼æµåˆ†æ"></a>12.5.1 éœ€æ±‚ä»·å€¼æµåˆ†æ</h4><p>éœ€æ±‚ä»·å€¼æµåˆ†æçš„äº”ä¸ªæ ¸å¿ƒåº¦é‡æŒ‡æ ‡åˆ†åˆ«æ˜¯æµåŠ¨æ—¶é—´ã€æµåŠ¨é€Ÿç‡ã€æµåŠ¨è´Ÿè½½ã€æµåŠ¨æ•ˆç‡ã€æµåŠ¨åˆ†å¸ƒå°†äº”ä¸ªæ ¸å¿ƒåº¦é‡æŒ‡æ ‡ç»“åˆåœ¨ä¸€èµ·å¯ä»¥åˆ»ç”»éœ€æ±‚äº¤ä»˜çš„å®Œæ•´è¿‡ç¨‹ï¼Œå›ç­”å…³äºäº¤ä»˜æ•ˆç‡çš„æœ¬è´¨é—®é¢˜é€šè¿‡ä»·å€¼æµåˆ†æï¼Œå¯ä»¥å‘ç°ç ”å‘è¿‡ç¨‹éšè—çš„é—®é¢˜å’Œç“¶é¢ˆç‚¹ï¼Œé‡‡å–é’ˆå¯¹æ€§çš„è¡ŒåŠ¨å¯ä»¥æœ‰æ•ˆä¿ƒè¿›æ•ˆèƒ½æå‡éœ€æ±‚ä»·å€¼æµåˆ†æçš„å‰ææ˜¯æ•°æ®çš„å‡†ç¡®æ€§ï¼Œéœ€è¦é€šè¿‡ç®¡ç†æˆ–è€…è‡ªåŠ¨åŒ–æŠ€æœ¯æ‰‹æ®µç»™äºˆä¿éšœï¼Œè¿™æ ·åˆ†æçš„ç»“æœæ‰èƒ½ååº”å®é™…æƒ…å†µã€‚</p>
<h4 id="12-5-2-ä»£ç çš„åº¦é‡åˆ†æ"><a href="#12-5-2-ä»£ç çš„åº¦é‡åˆ†æ" class="headerlink" title="12.5.2 ä»£ç çš„åº¦é‡åˆ†æ"></a>12.5.2 ä»£ç çš„åº¦é‡åˆ†æ</h4><p>ä»£ç åˆ†æå¯ä»¥è¡¥è¶³å¯¹ç ”å‘äº§å‡ºä¾§è€Œéè¿‡ç¨‹ä¾§çš„åº¦é‡ï¼Œæå¤§æå‡åº¦é‡ä½“ç³»çš„å®Œæ•´æ€§å’Œæœ‰æ•ˆæ€§ã€‚ä½œä¸ºä»£ç åº¦é‡çš„å…¸å‹ä»£è¡¨ï¼Œâ€å¼€å‘å½“é‡â€å¯ä»¥åæ˜ ç ”å‘äº§å‡ºçš„å¤æ‚åº¦ï¼Œåœ¨äº¤ä»˜é€Ÿç‡ã€äº¤ä»˜è´¨é‡å’Œäº¤ä»˜æˆæœ¬ç­‰é¢†åŸŸéƒ½æœ‰é‡è¦åº”ç”¨ç¼ºé™·å¯†åº¦ã€ç¼ºé™·ä¿®å¤å·¥ä½œé‡ã€å‡½æ•°å¤æ‚åº¦ã€å‡½æ•°å½±å“åŠ›ã€ä»£ç é‡å¤åº¦ç­‰å…¶ä»–ä»£ç åº¦é‡æŒ‡æ ‡ï¼Œå¯¹æ”¹è¿›å·¥ç¨‹è´¨é‡ä¹Ÿæœ‰é‡è¦ä½œç”¨å¼€å‘è€…çš„ä»£ç è´¡çŒ®ã€ä»£ç è´¨é‡ã€æŠ€æœ¯ç»éªŒéƒ½èƒ½åœ¨ä»£ç ä¸­ä½“ç°ï¼Œä¹Ÿèƒ½é€šè¿‡ä»£ç åˆ†æè¿›è¡Œåº¦é‡ã€‚</p>
<h4 id="12-5-3-ä»£ç è¯„å®¡åº¦é‡åˆ†æ"><a href="#12-5-3-ä»£ç è¯„å®¡åº¦é‡åˆ†æ" class="headerlink" title="12.5.3 ä»£ç è¯„å®¡åº¦é‡åˆ†æ"></a>12.5.3 ä»£ç è¯„å®¡åº¦é‡åˆ†æ</h4><p>ä»CRå‘èµ·ã€CRè¯„è®ºã€CRé¢—ç²’ã€è¯„å®¡çŠ¶æ€ä»¥åŠè¯„å®¡æŠ•å…¥ç­‰é‡åŒ–æŒ‡æ ‡è®¾è®¡ä¸­ï¼Œå¯ä»¥å‘ç°ä»£ç è¯„å®¡æµç¨‹ä¸­çš„é—®é¢˜å¹¶æ”¹å–„å…¶æ´»åŠ¨çš„å¼€å±•åœ¨è¿›è¡Œä»£ç è¯„å®¡æ•°æ®åˆ†ææ—¶ï¼Œå¯ä»¥é‡‡ç”¨è¶‹åŠ¿åˆ†æã€å¯¹æ¯”åˆ†æã€åˆ†å¸ƒåˆ†æã€ç»“æ„åˆ†æã€æ¼æ–—åˆ†æç­‰æ–¹æ³•ã€‚Pythonè‡ªåŠ¨åŒ–æ•°æ®åˆ†ææ˜¯ä¸€ä¸ªæˆæœ¬æ¯”è¾ƒä½ï¼Œé€‚ç”¨äºéœ€è¦å¤§æ‰¹é‡å¤åˆ¶çš„ä¸€ä¸ªä¸é”™çš„æ•°æ®åˆ†æå®æ–½å·¥å…·ã€‚</p>
<h3 id="12-6-åº¦é‡çš„æˆåŠŸè¦ç´ "><a href="#12-6-åº¦é‡çš„æˆåŠŸè¦ç´ " class="headerlink" title="12.6 åº¦é‡çš„æˆåŠŸè¦ç´ "></a>12.6 åº¦é‡çš„æˆåŠŸè¦ç´ </h3><p>ç ”å‘æ•ˆèƒ½åº¦é‡è¦åšæŒæ•°æ®é©±åŠ¨å’Œå®éªŒç²¾ç¥ï¼Œè®©ç ”å‘æ•ˆèƒ½å¯é‡åŒ–ã€å¯åˆ†æã€å¯æå‡æ¨¡å¼ï¼Œé¿å…â€è¸©å‘â€æ‰èƒ½èµ°å¾—æ›´è¿œ â€œæˆåŠŸå¤§éƒ½ç›¸ä¼¼ï¼Œå¤±è´¥å„æœ‰ä¸åŒâ€ï¼Œè®¤æ¸…æ•ˆèƒ½åº¦é‡çš„åå¤§ååº¦é‡ä½“ç³»å»ºè®¾éœ€è¦ç»¼åˆè€ƒè™‘åº¦é‡çš„ç”¨æˆ·åœºæ™¯ã€åº¦é‡çš„æŒ‡æ ‡ä½“ç³»ã€åº¦é‡çš„æ¨¡å‹è®¾è®¡ã€åº¦é‡çš„äº§å“å»ºè®¾ã€åº¦é‡çš„è¿ä½œæ¨¡å¼ç ”å‘æ•ˆèƒ½åº¦é‡æ˜¯å¤æ‚çš„ç³»ç»Ÿæ€§å·¥ç¨‹ï¼Œé¡¶å±‚è§„åˆ’å¾ˆé‡è¦ï¼Œéœ€è¦æŠŠåº¦é‡å¼•å¯¼åˆ°æ­£ç¡®çš„æ–¹å‘ä¸Šæ¥ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>OCR</tag>
        <tag>AI</tag>
        <tag>ChatGPT</tag>
        <tag>DevOps</tag>
        <tag>ç ”å‘æ•ˆèƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬åå…­è¯ï¼šchannelçš„ç”¨æ³•å’ŒåŸºæœ¬åŸåˆ™</title>
    <url>/2024/04/13/gofromzero/16_channel/</url>
    <content><![CDATA[<p>åœ¨åŸºäºGolangçš„åç«¯å¼€å‘ä¸­ï¼Œchannelæ˜¯ä¸€ä¸ªå¿…é¡»è¦æŒæ¡çš„å¹¶å‘ç¼–ç¨‹æ¦‚å¿µã€‚å’Œpythonçš„queueä¸€æ ·ï¼Œchannelåœ¨ä¸åŒçš„goroutineé‡Œæ‰¿æ‹…ç€ä¼ é€’ä¿¡æ¯çš„ä½œç”¨ï¼Œä½¿å¾—ä¸šåŠ¡é€»è¾‘çš„çŠ¶æ€ä¸Šä¸‹æ–‡å¯ä»¥åœ¨ä¸åŒçš„goroutineä¸­å…±äº«ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹channelçš„ç”¨æ³•è¿˜æœ‰ä¸€äº›ä½¿ç”¨ä¸Šçš„åŸºæœ¬åŸåˆ™ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨åˆ°channelã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ï¼Œåœ¨ä¸»æµç¨‹é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›å¯åŠ¨ä¸€ä¸ªæ–¹ä¾¿å¤„ç†panicçš„goroutineï¼Œå¼‚æ­¥è·‘ä¸€ä¸ªä»»åŠ¡ï¼Œç„¶åä¸»æµç¨‹ç­‰å¾…è¿™ä¸ªgoroutineç»™joinè¿›æ¥ã€‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±å¯ä»¥ç”¨åˆ°channelï¼Œä»£ç è¿™æ ·å†™ï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAsyncTask</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    joiner := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    log.Printf(<span class="string">"[main] start async task..."</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">                log.Printf(<span class="string">"[goroutine] panic: %v"</span>, r)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">close</span>(joiner)</span><br><span class="line">        &#125;()</span><br><span class="line"></span><br><span class="line">        log.Printf(<span class="string">"[goroutine] start async task..."</span>)</span><br><span class="line">        time.Sleep(<span class="number">5</span> * time.Second) <span class="comment">// task logic</span></span><br><span class="line">        log.Printf(<span class="string">"[goroutine] end async task!"</span>)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    log.Printf(<span class="string">"[main] wait for join..."</span>)</span><br><span class="line">    &lt;-joiner</span><br><span class="line">    log.Printf(<span class="string">"[main] async task joined!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªchannelï¼Œå‘èµ·å¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶åœ¨ä¸»æµç¨‹é˜»å¡åœ°å»æ¥æ”¶è¿™ä¸ªchannelçš„äº‹ä»¶ã€‚åœ¨å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼ŒæŠŠchannelç»™closeæ‰ï¼Œè¿™æ ·ä¸»æµç¨‹å¯ä»¥æ¥æ”¶åˆ°channelç»™closeæ‰çš„äº‹ä»¶ï¼Œå°±èƒ½ç»§ç»­åé¢çš„é€»è¾‘ã€‚è¿™æ ·ï¼Œå°±è¾¾åˆ°äº†ä»»åŠ¡çº¿ç¨‹joinçš„æ•ˆæœã€‚</p>
<p>åœ¨ä¸Šè¿°çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ç”¨åˆ°çš„channelç›¸å¯¹äºæ¶ˆæ¯å‘é€æ–¹æ˜¯é˜»å¡çš„ï¼Œå¦‚æœå‘é€æ–¹ç»™è¿™ä¸ªchannelå‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œæ¥æ”¶æ–¹çš„é€»è¾‘è¿˜æ²¡æœ‰è·‘åˆ°çš„è¯ï¼Œé‚£ä¹ˆå‘é€æ–¹å°±ä¼šä¸€ç›´é˜»å¡åœ¨å‘é€é€»è¾‘ã€‚å‡ä½¿æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªç±»dispatcherï¼ˆå¤šconsumerï¼‰çš„è°ƒåº¦æ¨¡å‹ï¼Œä¸æ–­åœ°å»æ ¹æ®æ¶ˆæ¯å†…å®¹æŠŠæ¶ˆæ¯åˆ†å‘åˆ°ä¸åŒconsumer-workerä¸Šï¼Œé‚£ä¹ˆé‡‡ç”¨å¯¹äºå‘é€æ–¹é˜»å¡çš„channelçš„è¯ï¼Œå°±æœ‰å¯èƒ½å› ä¸ºdispatcheråœ¨å¤„ç†è¿‡ç¨‹ä¸­äº§ç”Ÿç“¶é¢ˆï¼Œé€ æˆå‘é€æ–¹ç­‰å¾…è¶…æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°éé˜»å¡çš„channelï¼Œä¹Ÿå°±æ˜¯åœ¨å®šä¹‰channelæ—¶ï¼Œä¹Ÿå»å£°æ˜è¿™ä¸ªchannelçš„bufferå¤§å°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æœ‰è¶³å¤Ÿçš„ç¼“å†²åŒºå»ç¼“å­˜æ¶ˆæ¯ï¼Œè§£å†³å‘é€æ–¹çš„æ— é™ç­‰å¾…é—®é¢˜ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// channel chan instance</span></span><br><span class="line"><span class="keyword">var</span> channel <span class="keyword">chan</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// bufSize for non-blocking channel</span></span><br><span class="line"><span class="keyword">const</span> bufSize = <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initBlockingChannel</span><span class="params">()</span></span> &#123;</span><br><span class="line">    channel = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initNonBlockingChannel</span><span class="params">()</span></span> &#123;</span><br><span class="line">    channel = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, bufSize)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">exampleProduceMsg</span><span class="params">()</span></span> &#123;</span><br><span class="line">    msg := <span class="number">1</span></span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> channel &lt;- msg:</span><br><span class="line">        log.Printf(<span class="string">"sent msg: %v"</span>, msg)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        log.Printf(<span class="string">"send msg failed!"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œæ¶ˆè´¹ä¸€ä¸ªchannelï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªloopï¼Œæ¥å¾ªç¯å¤„ç†channelå‘é€è¿‡æ¥çš„å†…å®¹ã€‚æ¯”å¦‚ä¸€ä¸ªdispatcherï¼Œå°±éœ€è¦ä¸€ä¸ªforå¾ªç¯ï¼Œä¸æ–­æ‹¿æ¶ˆæ¯ï¼ŒæŠŠæ¶ˆæ¯å‘ç»™ä¸‹æ¸¸çš„ä»»åŠ¡handlerï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">launchConsumer</span><span class="params">(c &lt;-<span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    numMsgs := <span class="number">0</span></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        log.Printf(<span class="string">"[Consumer] overall received %d msgs!"</span>, numMsgs)</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">for</span> &#123; <span class="comment">// å…¶å®ƒå†™æ³•ï¼šfor msg := range c</span></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> msg, ok := &lt;-c:</span><br><span class="line">            <span class="keyword">if</span> ok &#123; <span class="comment">// æ”¶åˆ°äº†æ¶ˆæ¯</span></span><br><span class="line">                log.Printf(<span class="string">"[Consumer] received msg: %v"</span>, msg)</span><br><span class="line">                numMsgs++</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// channel closed</span></span><br><span class="line">                log.Printf(<span class="string">"[Consumer] channel closed!"</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>channelä½¿ç”¨çš„åŸºæœ¬åŸåˆ™æ˜¯ï¼Œä»producerç«¯å»closeæ‰channelã€‚produceç«¯è§¦å‘closeåï¼Œconsumerç«¯å°±èƒ½å¤ŸçŸ¥é“channelè¢«closeæ‰ï¼Œè¿›è€Œç»“æŸæ‰è‡ªå·±çš„chunkã€‚è€Œå¦‚æœæ˜¯consumerç«¯ä¸»åŠ¨closeï¼Œproducerç«¯åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ï¼Œå¾€channelå‘é€æ¶ˆæ¯ï¼Œå°±ä¼španicã€‚</p>
<p>å› æ­¤ï¼Œä¸ºäº†è§„é¿è¿™ä¸ªé£é™©ï¼Œä¸€æ˜¯è¦ä»producerå»å…³channelï¼Œè€Œæ˜¯ä¸è®ºæ˜¯æ€æ ·çš„ç”Ÿäº§æ¶ˆè´¹æ¨¡å‹ï¼Œéƒ½éœ€è¦ä¿è¯channelä»…è¢«closeä¸€æ¬¡ã€‚ç®€å•æ¥è®²ï¼Œcloseæ‰channelçš„æ“ä½œï¼Œæ”¾åˆ°produceræœ€å¤–å±‚å‡½æ•°çš„deferé‡Œé¢ï¼Œå°±èƒ½è§£å†³é—®é¢˜ã€‚</p>
<p>å¯¹äºå•ä¸ªproducerçš„æ¨¡æ‹Ÿï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åšä¸€ä¸ªforå¾ªç¯ï¼Œå»ä¸æ–­å‘é€æ¶ˆæ¯ã€‚ä¸­é€”æ‰“æ–­çš„æ–¹å¼é‡‡ç”¨å¯cancelçš„contextï¼Œå½“å¾ªç¯è¿‡ç¨‹ä¸­æ£€æµ‹åˆ°contextè¢«cancelæ‰ï¼Œå°±åœæ­¢å‘é€æ¶ˆæ¯ã€‚æ•´ä¸ªä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">launchSingleProducer</span><span class="params">(c <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        log.Printf(<span class="string">"[SingleProducer] close channel..."</span>)</span><br><span class="line">        <span class="built_in">close</span>(channel)</span><br><span class="line">    &#125;()</span><br><span class="line">    numMsgs := <span class="number">10</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numMsgs; i++ &#123;</span><br><span class="line">        log.Printf(<span class="string">"[SingleProducer] start send msg: %v"</span>, i)</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> c &lt;- i:</span><br><span class="line">            log.Printf(<span class="string">"[SingleProducer] finish send msg: %v"</span>, i)</span><br><span class="line">            time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">            log.Printf(<span class="string">"[SingleProducer] context done!"</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            log.Printf(<span class="string">"[SingleProducer] send msg failed..."</span>)</span><br><span class="line">            time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>golangä¸­ctxçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸åŒçš„goroutineä¸­å…±äº«ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjMvMDQvMDEvZ29mcm9temVyby8xMF9jb250ZXh0Lw==" title="https://utmhikari.top/2023/04/01/gofromzero/10_context/">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>å¯¹äºcontextæ¨¡å—çš„ä»‹ç»ã€‚åœ¨å•ä¸ªproduceråœºæ™¯ä¸‹ï¼Œæ¯æ¬¡å¾ªç¯ï¼Œæˆ‘ä»¬å¯ä»¥selectä¸åŒçš„ä¿¡é“ï¼Œçœ‹å½“åˆ»æ˜¯å¯ä»¥ç»™channelå‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¿˜æ˜¯æ”¶åˆ°äº†ctxä¸Šä¸‹æ–‡ç»“æŸçš„äº‹ä»¶ã€‚å¦‚æœä¸Šä¸‹æ–‡ç»“æŸæ‰ï¼Œå°±ç»ˆæ­¢æ•´ä¸ªproducerã€‚closeæ“ä½œï¼Œæ”¾åˆ°deferé‡Œæ‰§è¡Œå³å¯ã€‚</p>
<p>consumerç«¯å¤„ç†å¤šä¸ªchannelçš„å‘é€/æ¥æ”¶äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¾ªç¯+selectçš„é€šç”¨æ¨¡ç‰ˆå»å®ç°ã€‚æ¯è½®å¾ªç¯ï¼Œå°±selectå•ä¸ªchannelçš„å•ä¸ªäº‹ä»¶æ¥å¤„ç†ï¼Œä»£ç å†™èµ·æ¥ä¹Ÿç®€æ´æ˜äº†ã€‚</p>
<p>å¯¹äºå¤šä¸ªproducerçš„æ¨¡æ‹Ÿï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªwaitGroupå»ç®¡ç†å¤šä¸ªproducerçš„è¿›åº¦ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjMvMDgvMDYvZ29mcm9temVyby8xM193YWl0Z3JvdXAv" title="https://utmhikari.top/2023/08/06/gofromzero/13_waitgroup/">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>æ¥äº†è§£waitGroupçš„ç”¨æ³•ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ¯ä¸ªproducerçš„è¡Œä¸ºåˆ™æ˜¯åœ¨forå¾ªç¯é‡Œå‘æ¶ˆæ¯ï¼Œç›´åˆ°æ¶ˆæ¯å‘å®Œæˆ–è€…contextç»“æŸæ‰ï¼Œæ‰ç»“æŸå•ä¸ªproducerçš„è¿›åº¦ã€‚åœ¨ä¸»goroutineä¸­ï¼Œåªéœ€è¦waitè¿™ä¸ªwaitGroupï¼Œç„¶ååœ¨deferä¸­closeæ‰channelå³å¯ã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">launchMultiProducers</span><span class="params">(c <span class="keyword">chan</span>&lt;- <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        log.Printf(<span class="string">"[SingleProducer] close channel..."</span>)</span><br><span class="line">        <span class="built_in">close</span>(channel)</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    produce := <span class="function"><span class="keyword">func</span><span class="params">(id <span class="keyword">int</span>, numMsgs <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numMsgs; i++ &#123;</span><br><span class="line">            msg := id*<span class="number">10000</span> + i</span><br><span class="line">            log.Printf(<span class="string">"[MultiProducers] [%d] start send msg: %v"</span>, id, msg)</span><br><span class="line">            <span class="keyword">select</span> &#123;</span><br><span class="line">            <span class="keyword">case</span> c &lt;- i:</span><br><span class="line">                log.Printf(<span class="string">"[MultiProducers] [%d] finish send msg: %v"</span>, id, msg)</span><br><span class="line">                time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">            <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">                log.Printf(<span class="string">"[MultiProducers] [%d] context done, break!"</span>, id)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                log.Printf(<span class="string">"[SingleProducer] send msg failed..."</span>)</span><br><span class="line">                time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.Printf(<span class="string">"[MultiProducers] [%d] finish send all msgs!"</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    numIDs := <span class="number">10</span></span><br><span class="line">    numMsgsEach := <span class="number">10</span></span><br><span class="line">    waitGroup := sync.WaitGroup&#123;&#125;</span><br><span class="line"></span><br><span class="line">    log.Printf(<span class="string">"[MultiProducers] launch producers..."</span>)</span><br><span class="line">    <span class="keyword">for</span> x := <span class="number">1</span>; x &lt;= numIDs; x++ &#123;</span><br><span class="line">        waitGroup.Add(<span class="number">1</span>)</span><br><span class="line">        id := x</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> waitGroup.Done()</span><br><span class="line">            produce(id, numMsgsEach)</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    waitGroup.Wait()</span><br><span class="line">    log.Printf(<span class="string">"[MultiProducers] finish all producers!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>å¹¶å‘</tag>
        <tag>channel</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘å˜æ›´å…ƒä¿¡æ¯åˆ†ææ¡†æ¶è®¾è®¡</title>
    <url>/2024/04/04/archiart/change_analysis_framework/</url>
    <content><![CDATA[<p>åœ¨å˜æ›´é£é™©é˜²æ§é¢†åŸŸï¼Œå¯¹äºçº¿ä¸Šå˜æ›´å…ƒä¿¡æ¯çš„åˆ†ææ˜¯éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯å› ä¸ºï¼Œåªæœ‰ç†è§£äº†å˜æ›´å…ƒä¿¡æ¯ï¼Œç»“åˆè‡ªä¸»å®šåˆ¶çš„å˜æ›´è§„èŒƒï¼Œæ‰èƒ½å¤ŸçŸ¥é“å…·ä½“çš„å˜æ›´é£é™©åœ¨å“ªé‡Œã€‚ä¸åŒçš„å˜æ›´é£é™©é˜²å¾¡èƒ½åŠ›ï¼Œå®ç°çš„æ€è·¯å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œå› æ­¤å¾ˆæœ‰å¯èƒ½å‡ºç°å¯¹äºä¸€æ¬¡å˜æ›´ï¼Œåœ¨ä¿¡æ¯çš„ç†è§£ä¸Šæœ‰æ‰€ä¸ä¸€è‡´ï¼Œä»è€Œå¯¼è‡´æ£€æµ‹ç»“æœä¸å¤Ÿç½®ä¿¡ã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç‹¬ç«‹çš„å˜æ›´å…ƒä¿¡æ¯åˆ†ææ¡†æ¶ï¼ŒæŠŠæ‰€æœ‰çš„å˜æ›´å…ƒä¿¡æ¯åˆ†æè¿‡ç¨‹å’Œç»“æœéƒ½å½’åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿå½“ä¸­ã€‚è¿™æ ·ï¼Œä»å˜æ›´é£é™©é˜²å¾¡èƒ½åŠ›çš„è§†è§’ï¼Œå˜æ›´åˆ†æçš„ç»“æœéƒ½æ˜¯å…±äº«çš„ã€å…¨å±€çš„ã€ä¸€è‡´çš„ï¼Œä»è€Œèƒ½æœ€å¤§é™åº¦æå‡å˜æ›´é£é™©é˜²å¾¡èƒ½åŠ›å¯æŒ–æ˜çš„æ½œåŠ›ã€‚</p>
<p>æœ¬æ–‡ï¼Œå°±ç®€å•èŠä¸€ä¸‹ï¼Œå˜æ›´å…ƒä¿¡æ¯åˆ†ææ¡†æ¶è®¾è®¡çš„éƒ¨åˆ†é‡ç‚¹ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå˜æ›´å…ƒä¿¡æ¯çš„æ¥æºæ˜¯ä»€ä¹ˆï¼Ÿç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœè¦è·å–åˆ°å˜æ›´å…ƒä¿¡æ¯ï¼Œä¸€ä¸ªå˜æ›´å¹³å°éœ€è¦åœ¨å‘èµ·å˜æ›´ã€å˜æ›´æœŸé—´å’Œå˜æ›´ç»“æŸä¹‹åï¼Œéƒ½ä¸ŠæŠ¥å’Œå½“æ¬¡å˜æ›´ç›¸å…³çš„å…ƒä¿¡æ¯ç»™åˆ°åˆ†ææ¡†æ¶ã€‚å¦‚æœæŠŠä¸€ä¸ªä¼ä¸šå†…éƒ¨æ‰€æœ‰çš„å˜æ›´å¹³å°éƒ½è€ƒè™‘åˆ°ä¸€èµ·ï¼Œé‚£ä¹ˆå˜æ›´ä¸ŠæŠ¥æ¬¡æ•°é‡çº§æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤ä¸€ä¸ªæ¯”è¾ƒå¥½çš„æ–¹æ³•æ˜¯ï¼Œé€šè¿‡ä¸€ä¸ªå˜æ›´äº‹ä»¶MQå»æ‰¿è½½å˜æ›´å…ƒä¿¡æ¯çš„ä¸ŠæŠ¥å’Œæ¶ˆè´¹ï¼Œä»è€Œèµ·åˆ°å‡è¡¡æ€§èƒ½çš„ä½œç”¨ã€‚åœ¨è¿™æ ·çš„åŸºç¡€ä¸Šï¼Œå˜æ›´å…ƒä¿¡æ¯åˆ†æå·¥ä½œï¼Œå°±å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼ŒåŸºäºå˜æ›´äº‹ä»¶é©±åŠ¨çš„æ¨¡å¼ã€‚</p>
<p>å…¶æ¬¡é—®é¢˜æ˜¯ï¼Œåˆ†æçš„å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥ç®€å•åˆ’åˆ†æˆä¸‰ç±»ã€‚ç¬¬ä¸€ç±»æ˜¯å˜æ›´çš„å¯¹è±¡æœ¬èº«ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦äº†è§£åˆ°ï¼ŒæŸä¸ªæœåŠ¡çš„ä¸Šä¸‹æ¸¸é“¾è·¯å¦‚ä½•ï¼Œé‡è¦åº¦å¦‚ä½•ï¼Œæ˜¯å¦æ¶‰åŠèµ„æŸé£é™©ï¼Œè¿™äº›éƒ½æ˜¯æœåŠ¡æœ¬èº«çš„å±æ€§ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯åœ¨å˜æ›´è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘çš„ï¼›ç¬¬äºŒç±»æ˜¯å˜æ›´å·¥å•è¿‡ç¨‹ï¼Œè¿™ä¸ªæ˜¯æ ¸å¿ƒçš„å˜æ›´å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­æŸæ¬¡å˜æ›´æ˜¯å¦å­˜åœ¨é£é™©ï¼Œå°±éœ€è¦å¯¹ä¸€æ¬¡å˜æ›´å·¥å•è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚æ˜¯å¦åœ¨é«˜å³°æœŸå‘å¸ƒï¼Œæ˜¯å¦é€šè¿‡ç®¡æ§èµ¦å…ï¼Œå˜æ›´çš„éœ€æ±‚èƒŒæ™¯ç­‰ç­‰ï¼Œéƒ½æ˜¯å˜æ›´å·¥å•ç»´åº¦çš„åˆ†æä¿¡æ¯ï¼›ç¬¬ä¸‰ç±»æ˜¯å˜æ›´é˜¶æ®µï¼Œè¿™æ˜¯åœ¨å˜æ›´å·¥å•ç»´åº¦ä¸Šï¼Œå‘ä¸‹æ‹†è§£å‡ºæ¥çš„ä¸€ç±»åˆ†æå¯¹è±¡ï¼Œæè¿°å˜æ›´è¿‡ç¨‹æ¯ä¸€ä¸ªé˜¶æ®µçš„å®é™…æƒ…å†µï¼Œå°¤å…¶æ˜¯å°æ‰¹æ¬¡ç°åº¦é˜¶æ®µçš„å˜æ›´å…ƒä¿¡æ¯ï¼Œæ˜¯å˜æ›´é£é™©é˜²å¾¡éœ€è¦ç€é‡å»å…³æ³¨çš„ã€‚</p>
<p>å˜æ›´äº‹ä»¶ä¸ŠæŠ¥çš„ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯å˜æ›´å·¥å•æˆ–è€…å˜æ›´é˜¶æ®µç»´åº¦çš„ï¼Œè€Œå˜æ›´æœåŠ¡å®ä½“è¿™ä¸ªç»´åº¦ï¼Œåœ¨äº‹ä»¶å†…å®¹é‡Œï¼Œä¸ä¸€å®šä¼šæœ‰æ ‡å‡†åŒ–çš„ä½“ç°ã€‚å› æ­¤ï¼Œå¦‚æœè¦å°†å˜æ›´äº‹ä»¶å’Œå˜æ›´å…ƒä¿¡æ¯åˆ†æç»“æœåšæ˜ å°„ï¼Œå°±éœ€è¦æ ‡å‡†åŒ–ä¸‰ç±»å˜æ›´åˆ†æçš„å¯¹è±¡çš„æ•°æ®ç»“æ„å’Œå…ƒä¿¡æ¯æå–é€»è¾‘ã€‚</p>
<p>ç„¶åä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåˆ†æç»“æœä¼šæ€ä¹ˆå‡ºæ¥ï¼Ÿè¿™é‡Œæœ‰å¤šç§å¯èƒ½æ€§ï¼Œä¸€ç§å¯èƒ½æ€§æ˜¯æ¡†æ¶æœ¬èº«åœ¨æ¥æ”¶åˆ°å˜æ›´äº‹ä»¶åï¼ŒæŠŠäº‹ä»¶dispatchç»™ç¬¦åˆäº‹ä»¶è¿‡æ»¤æ¡ä»¶çš„å˜æ›´å…ƒä¿¡æ¯åˆ†æå™¨ï¼›å¦ä¸€ç§å¯èƒ½æ€§æ˜¯ï¼Œåˆ†æå™¨ç¦»çº¿ï¼ˆå®šæ—¶ï¼‰è¿è¡Œï¼Œä¸Šä¼ ç»“æœç»™åˆ°å˜æ›´åˆ†ææ¡†æ¶ã€‚ä¸ºäº†å…¼å®¹è¿™ä¸¤ç§å¯èƒ½æ€§ï¼Œæˆ‘ä»¬å°±éœ€è¦æ ‡å‡†åŒ–åˆ†æç»“æœçš„å­˜å‚¨æ¥å£ï¼Œä»¥åŠåˆ†æå¯¹è±¡çš„ç”Ÿæˆé€»è¾‘ã€‚å°¤å…¶æ˜¯ï¼Œæœ‰äº†åè€…ä»¥åï¼Œä¸è®ºæ˜¯å—æ§è¢«è°ƒåº¦çš„åˆ†æå™¨ï¼Œè¿˜æ˜¯ç¦»çº¿åˆ†æå™¨ï¼Œéƒ½èƒ½é€šè¿‡æŸç§æ–¹å¼ï¼Œå°†åˆ†æç»“æœæ˜ å°„åˆ°å…·ä½“çš„åˆ†æå¯¹è±¡ï¼Œè¿™æ ·å°±æ»¡è¶³äº†å…¼å®¹çš„éœ€è¦ã€‚</p>
<p>æœ€åä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¦‚ä½•æ”¯æŒåˆ†æå™¨çš„è¿ä½œï¼Ÿä¸è®ºæ˜¯ç¦»çº¿è¿˜æ˜¯å—æ§çš„åˆ†æå™¨ï¼Œæœ‰å¯èƒ½å®è´¨ä¹Ÿæ˜¯ä¸€ä¸ªå˜æ›´äº‹ä»¶æ¶ˆè´¹è€…ï¼Œæ˜¯ä¸€ä¸ªå¤šèŠ‚ç‚¹è¿è¡Œçš„æœåŠ¡ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿåˆ†æç¼“å­˜æ•°æ®å…±äº«çš„é—®é¢˜ã€‚å› æ­¤ï¼Œåˆ†ææ¡†æ¶åœ¨ç ”å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿéœ€è¦è€ƒè™‘å»ºè®¾ä¸€äº›å·¥å…·æˆ–è€…åˆ†æå™¨æ¡†æ¶ï¼Œå»æå‡åˆ†æå™¨çš„å¼€å‘æ•ˆç‡ã€‚å°±å’Œæ¸¸æˆå¼•æ“ä¸€æ ·ï¼Œé€šè¿‡å·¥å…·æ’ä»¶ï¼Œä¸ºæ¸¸æˆå¼€å‘èµ‹èƒ½ã€‚</p>
<p>ä»¥ä¸Šä¾¿æ˜¯å˜æ›´å…ƒä¿¡æ¯åˆ†ææ¡†æ¶è®¾è®¡çš„ä¸€äº›é‡ç‚¹æ€è·¯å’Œè€ƒé‡ã€‚è§£å†³äº†ä»¥ä¸Šé—®é¢˜ï¼Œä¸€ä¸ªç®€çº¦çš„å˜æ›´å…ƒä¿¡æ¯åˆ†ææ¡†æ¶åˆ™å‘¼ä¹‹æ¬²å‡ºã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>äº‹ä»¶å¾ªç¯</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘æå‡å‘å¸ƒé£é™©æ£€æŸ¥å‡†ç¡®ç‡çš„ä¸€äº›æ€è·¯</title>
    <url>/2024/03/03/geekdaily/release_check_optimization/</url>
    <content><![CDATA[<p>åœ¨æœåŠ¡æˆ–è€…å…¶å®ƒçº¿ä¸Šèµ„æºå‘å¸ƒæ–°ç‰ˆæœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æœ‰å¿…è¦ä¸ºå‘å¸ƒä¿¡æ¯æœ¬èº«å’Œä¸Šçº¿çš„èµ„æºåšé£é™©æ£€æŸ¥ï¼Œä»¥ç¡®è®¤å‘å¸ƒå†…å®¹ä¸ä¼šå¯¹çº¿ä¸Šé€ æˆå½±å“ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨æ£€æŸ¥èƒ½åŠ›é“ºå«æ—¶ï¼Œä¸€ä¸ªä¸»æ—¨çš„æ€è·¯æ˜¯ä¿è¯é—®é¢˜çš„å¬å›ç‡ï¼Œå³æ£€æŸ¥èƒ½åŠ›æœ¬èº«å¿…é¡»ç†è®ºä¸Šå¯ä»¥æ‹¦æˆªæ›´å¤šçš„é£é™©ï¼Œè¿™æ ·æ‰èƒ½å¤ŸåŸºæœ¬é™åº¦ä¿è¯å‘å¸ƒè¿‡ç¨‹çš„å®‰å…¨ã€‚ä½†éšç€æ£€æŸ¥èƒ½åŠ›é›†åˆå˜å¾—æˆç†Ÿï¼Œä¸šåŠ¡ä¹Ÿè‚¯å®šä¼šæœ‰å¯¹æ£€æŸ¥èƒ½åŠ›ä¼˜åŒ–çš„éœ€æ±‚ï¼Œéœ€è¦æå‡æ£€æŸ¥çš„å‡†ç¡®ç‡ï¼Œä¸è‡³äºå‡ºç°å¤ªå¤šæ— ç”¨çš„å™ªéŸ³ï¼Œè¿™ä¹Ÿæˆä¸ºäº†é£é™©æ£€æŸ¥æå‡å¯é æ€§çš„ä¸€é¡¹æŒ‘æˆ˜ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬æ–‡å°±æµ…è°ˆä¸€ä¸‹ï¼Œæå‡å‘å¸ƒé£é™©æ£€æŸ¥å‡†ç¡®ç‡çš„ä¸€äº›æ€è·¯ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾æå‡å‡†ç¡®ç‡çš„æŠ“æ‰‹ï¼Œä¹Ÿå°±æ˜¯è¯´ä»å“ªäº›ç‚¹å…¥æ‰‹ï¼Œå¯ä»¥æ¯”è¾ƒæœ‰æ•ˆæå‡æ•°æ®ã€‚å¯¹äºä¸€æ¬¡å‘å¸ƒè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåº”ç”¨å¤šç§æ£€æŸ¥èƒ½åŠ›ï¼Œè€Œæ¯ç§æ£€æŸ¥èƒ½åŠ›æ¯æ¬¡è¿è¡Œå¯èƒ½ä¼šæ£€æŸ¥å¤šä¸ªæ£€æŸ¥é¡¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£åˆ°æ¯ä¸ªæ£€æŸ¥èƒ½åŠ›åˆ¤å®šä¸ºå¤±è´¥æ—¶ï¼Œå‘å¸ƒäººå›æ»šå‘å¸ƒæˆ–æ˜¯è·³è¿‡æ£€æŸ¥çš„æƒ…å†µï¼Œä»¥åŠè¿™äº›æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ£€æŸ¥é¡¹å…·ä½“çš„åˆ¤å®šç»“æœä¸ºå¤šå°‘ã€‚è¿™æ ·å°±èƒ½å¤Ÿäº†è§£å“ªäº›æ£€æŸ¥é¡¹çš„é€»è¾‘æ¯”è¾ƒé è°±ï¼Œå“ªäº›æ£€æŸ¥é¡¹çš„é€»è¾‘éœ€è¦åšä¼˜åŒ–ã€‚å¦‚æœå¯ä»¥æ‰¾åˆ°ä¸€äº›å…¸å‹çš„æ¡ˆä¾‹ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿæˆä¸ºçªç ´å£ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªWeb-Serviceå‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæ£€æŸ¥æœåŠ¡çš„æ€§èƒ½å’Œä¸šåŠ¡ç›‘æ§æŒ‡æ ‡ã€‚é’ˆå¯¹å•ä¸ªä¸šåŠ¡æŒ‡æ ‡ï¼Œå¯èƒ½å­˜åœ¨ä¸åŒçš„å‘Šè­¦ç­‰çº§ï¼Œæ¯”å¦‚è¶…è¿‡æŸä¸ªé˜ˆå€¼æ˜¯Warningï¼Œç„¶åå†è¶…è¿‡ä¸€ä¸ªæ›´é«˜çš„é˜ˆå€¼åˆ™æ˜¯Fatalã€‚åœ¨å¼€å‘æ£€æŸ¥èƒ½åŠ›çš„æ—¶å€™ï¼Œä¸ºäº†æ–¹ä¾¿äº¤ä»˜ï¼Œæˆ‘ä»¬å¯èƒ½åˆ¤å®šå¦‚æœæŸä¸ªæŒ‡æ ‡ä¸ºFatalï¼Œåˆ™æ•´ä¸ªæ£€æŸ¥éƒ½å¤±è´¥ã€‚ä½†äº‹å®ä¸Šï¼Œå¦‚æœè¿™ä¸ªæŒ‡æ ‡å®é™…è¡¨å¾çš„é£é™©ç¨‹åº¦ä¸é«˜ï¼Œå³ä¾¿åœ¨å‘Šè­¦ä¸Šæ˜¯Fatalï¼Œä½†å‘å¸ƒè¿‡ç¨‹å¯èƒ½è¿˜æ˜¯ä¼šè¢«äººä¸ºå¼ºåˆ¶è·³è¿‡ã€‚è¿™æ ·çš„ç›‘æ§æŒ‡æ ‡ï¼Œå°±æ˜¯éœ€è¦ä¼˜åŒ–çš„å…¸å‹æ¡ˆä¾‹ã€‚</p>
<p>ç„¶åï¼Œæ‰æ˜¯çœ‹å¦‚ä½•å®æ–½ä¼˜åŒ–æ‰‹æ®µã€‚æ¯”å¦‚ï¼Œä¸Šé¢æåˆ°çš„ç›‘æ§æŒ‡æ ‡ä¸¥é‡ç¨‹åº¦ä¸èƒ½å¾ˆå¥½åæ˜ é£é™©åº¦çš„é—®é¢˜ï¼Œå°±æœ‰ä¸¤ç§ä¼˜åŒ–æ–¹å‘ï¼šä¸€ç§æ˜¯è°ƒæ•´æŒ‡æ ‡æœ¬èº«çš„è®¾å®šé˜ˆå€¼ï¼Œä¸€ç§æ˜¯åœ¨æ£€æŸ¥è¿‡ç¨‹åšé£é™©è¯„åˆ†ï¼Œå¹¶ä¸ºè¿™ç§æŒ‡æ ‡ç»™ä¸€ä¸ªç›¸å¯¹è¾ƒä½çš„é£é™©æƒé‡å€¼ã€‚æˆ–è€…ï¼Œä»å¤§çš„è§’åº¦ï¼Œåœ¨ç›‘æµ‹åˆ°ä¸€ä¸ªFatalå‘Šè­¦ä¹‹åï¼Œå…ˆå’Œå˜æ›´å‰çº¿ä¸Šç¯å¢ƒçš„ç›‘æ§å‘Šè­¦æƒ…å†µåšå¯¹æ¯”ï¼Œå¦‚æœæƒ…å†µå’Œå˜æ›´å‰ç±»ä¼¼ï¼Œé‚£ä¹ˆä¹Ÿæ— éœ€ç»™ä¸€ä¸ªéå¸¸ä¸¥é‡çš„æ£€æŸ¥å¤±è´¥å‘Šè­¦ã€‚å¦‚æœæ˜¯æŒç»­æ€§åœ°åšæ£€æµ‹ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦è€ƒè™‘å¼‚å¸¸å‘Šè­¦çš„æŒç»­æ€§ï¼Œé˜²æ­¢å› ä¸ºéƒ¨åˆ†æ¯›åˆºå¯¼è‡´æœ€ç»ˆåˆ¤å®šç»“æœä¸ç½®ä¿¡ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ£€æŸ¥çš„ç»“æœï¼Œä¹Ÿåˆ†ä¸ºFatalå’ŒWarningä¸¤ä¸ªçº§åˆ«ï¼Œåœ¨æ•°æ®ä¸Šä¹Ÿæœ‰ä¸€ä¸ªå¾ˆåŸºç¡€çš„ä¼˜åŒ–ç‚¹ï¼Œå°±æ˜¯å°†Fatalç»“æœå’ŒWarningç»“æœçš„å‡†ç¡®ç‡åšåŒºåˆ†ã€‚å¦‚æœä¸€ä¸ªæ£€æŸ¥é¡¹å­˜åœ¨ä¸ç½®ä¿¡çš„æƒ…å†µï¼Œä½†æ£€æŸ¥é¡¹æ˜¯åŸºç¡€çš„å¿…é¡»çš„ï¼Œå°±éœ€è¦åšé£é™©é™çº§ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒFatalç»“æœçš„å¯é æ€§æ˜¯éœ€è¦éå¸¸é«˜çš„ï¼Œè€ŒWarningå¯æ˜¯ç›¸å¯¹å¯å®¹å¿å™ªéŸ³çš„ã€‚å› æ­¤ï¼Œéœ€è¦å¯¹å„æ£€æŸ¥èƒ½åŠ›ä¹Ÿåšç»“æœä¼˜å…ˆçº§åˆ’åˆ†ï¼Œå¯¹äºç›¸å¯¹æ›´æœ‰ç½®ä¿¡åº¦çš„æ£€æŸ¥èƒ½åŠ›æˆ–æ£€æŸ¥é¡¹ï¼Œåº”å½“è€ƒè™‘åšæ›´åŠ ä¸¥æ ¼çš„é£é™©åˆ¤å®šï¼Œå¯¹äºæ•´ä½“çš„é£é™©è¯„å®šä¼˜å…ˆçº§æ›´é«˜ï¼Œè€Œç½®ä¿¡åº¦è¾ƒå°çš„ï¼Œåˆ™åœ¨é£é™©è¯„å®šä¸­ï¼Œä¼˜å…ˆçº§æ”¾ä½ã€‚</p>
<p>æœ€åï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†æå‡æ£€æŸ¥å‡†ç¡®ç‡ï¼Œä½†å¬å›ç‡æ˜¯ä¸èƒ½ä¸¢çš„ï¼Œä¸èƒ½å› ä¸ºæå‡äº†å‡†ç¡®æ€§ï¼Œå¯¼è‡´å¯æ‹¦æˆªçš„é£é™©é¢å˜å°ã€‚æ£€æŸ¥å‡†ç¡®ç‡æå‡ä¸»è¦æ˜¯åŸºäºç”¨æˆ·ä½“éªŒçš„ä¼˜åŒ–ï¼Œè€Œå¬å›ç‡æ‰æ˜¯çœŸæ­£é¢å‘æ£€æŸ¥èƒ½åŠ›çš„SLAã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>ç¨³å®šæ€§</tag>
        <tag>DevOps</tag>
        <tag>æŒç»­é›†æˆ</tag>
        <tag>ç ”å‘æ•ˆèƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘å¯æŒç»­æ€§æ¶æ„è®¾è®¡çš„ç§˜è¯€</title>
    <url>/2024/02/15/archiart/sustainable_architecture/</url>
    <content><![CDATA[<p>ä»Šå¤©é—²èŠä¸€ä¸‹å¯æŒç»­æ€§æ¶æ„è®¾è®¡çš„ç§˜è¯€ï¼Œæ€»å…±å…«ä¸ªå­—ï¼šæ¦‚å¿µæ‹†è§£ï¼Œé‡ç»„æ”¹é€ ã€‚</p>
<p>è¯´åˆ°æ–°å¼€å‘ä¸€ä¸ªæŠ€æœ¯å·¥ç¨‹ï¼Œå¾ˆå¤šåŒå­¦ä¼šå¼•ç”¨éœ€æ±‚æ‹†è§£çš„æ€è·¯ï¼Œè‡ªé¡¶å‘ä¸‹æ‹†è§£å­éœ€æ±‚ï¼Œåšå¯¹åº”çš„å±‚æ¬¡æ¨¡å—è®¾è®¡ï¼Œç„¶åç›´æ¥æŒ‰ç…§æ‹†è§£ç»“æœåˆ†æ¨¡å—ç¼–ç ã€‚ä¾ç…§è¿™æ ·çš„æ€è·¯ï¼Œè™½ç„¶æœ€ç»ˆæ¶æ„å½¢æ€æ¯”è¾ƒç¬¦åˆé¢„æœŸï¼Œä½†ä¸ä¸€å®šèƒ½å¤Ÿä¿éšœé•¿çº¿è¿­ä»£ã€‚è¿™æ˜¯å› ä¸ºï¼ŒæŠ€æœ¯å®ç°å§‹ç»ˆæ˜¯è‡ªåº•å‘ä¸Šï¼Œè€Œä¸æ˜¯è‡ªé¡¶å‘ä¸‹çš„ï¼Œå¦‚æœè¯´åœ¨æ‹†è§£è¿‡ç¨‹ä¸­ï¼Œæ€è€ƒæ·±åº¦ä¸å¤Ÿï¼Œæ²¡æœ‰è§¦åŠåˆ°åº•å±‚æ¦‚å¿µçš„ç²’åº¦ï¼Œé‚£ä¹ˆæŠ€æœ¯å®ç°çš„ç»“æœï¼Œå¿…ç„¶æ˜¯å¤±å»å¯æ‰©å±•æ€§â€”â€”ä¸Šå±‚éšå«çš„åº•å±‚æ¦‚å¿µè·Ÿéœ€æ±‚å¼ºç»‘å®šï¼Œå¯¼è‡´åº•å±‚åŠŸèƒ½æ— æ³•æ‹†åˆ†å‡ºæ¥ï¼Œä¸èƒ½é€‚é…æ›´å¤šåœºæ™¯ï¼Œæœ€ç»ˆä¸æ–­å †ç§¯ï¼Œå°±äº§ç”Ÿäº†æŠ€æœ¯å€ºã€‚</p>
<p>è¿™ä¸ªé—®é¢˜éœ€è¦å¦‚ä½•è§£å†³ï¼Ÿä¸¾ä¸€ä¸ªæ¸¸æˆé¢†åŸŸçš„ä¾‹å­ã€‚ä»¥å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¸ºä¾‹ï¼Œæˆ‘ä»¬æœŸæœ›çš„ä¸€ä¸ªæ•ˆæœï¼Œæ˜¯è¦é€šè¿‡å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥ä»£æ›¿äººåŠ›åšæ¸¸æˆåœºæ™¯éå†ï¼Œè§£å†³éå†å†’çƒŸæµ‹è¯•è€—æ—¶çš„é—®é¢˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ç®€å•åšå­é—®é¢˜æ‹†è§£ï¼š</p>
<a id="more"></a>
<ul>
<li>è‡ªåŠ¨åŒ–çš„è®¾å¤‡ï¼Ÿå®‰å“è®¾å¤‡ã€‚</li>
<li>è‡ªåŠ¨åŒ–çš„é©±åŠ¨æ–¹å¼ï¼ŸUI+Luaè„šæœ¬é©±åŠ¨ã€‚</li>
<li>è¦åšè‡ªåŠ¨åŒ–çš„ä¸šåŠ¡æ¨¡å—ï¼Ÿå‰¯æœ¬ã€å¤§ä¸–ç•Œå¯»å®å’Œå¯»è·¯ç³»ç»Ÿã€‚</li>
<li>ç”¨ä¾‹çš„è§¦å‘æ–¹å¼ï¼Ÿæœ¬åœ°PCä¸Šäººå·¥æ‰§è¡Œã€‚</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸éš¾è®¾è®¡ä¸€ä¸ªç®€å•çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œé‡Œé¢åŒ…å«è®¾å¤‡è¿æ¥ã€UI/è„šæœ¬é©±åŠ¨ã€ç”¨ä¾‹ç®¡ç†ä»¥åŠCMDæ‰§è¡Œå››ä¸ªæ¨¡å—ã€‚æ¡†æ¶å±‚å®ç°è¿™äº›å°±å®Œäº‹ï¼Œä¹‹åå°±å¯ä»¥ä¸“æ³¨ç¼–å†™æ¯ä¸ªåœºæ™¯çš„æµç¨‹é€»è¾‘äº†ã€‚æ¸¸æˆæµ‹è¯•ä¸šç•Œï¼Œä¹ŸåŸºæœ¬æ­¢æ­¥äºæ­¤ã€‚</p>
<p>è¿™æ ·çš„ä¸€ä¸ªæ¡†æ¶ï¼Œèƒ½å¤Ÿæ”¯æ’‘çš„äº†æ›´å¤šè‡ªåŠ¨åŒ–ç”¨ä¾‹çš„ç»´æŠ¤ä¹ˆï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ã€‚ç©¶å…¶åŸå› ï¼Œå°±æ˜¯æ¡†æ¶åœ¨è®¾è®¡æ—¶ï¼Œä»…ä»…è€ƒè™‘äº†éœ€æ±‚æ•ˆæœï¼Œåšäº†æµ…å±‚çš„é—®é¢˜æ‹†è§£ï¼Œè€Œæ²¡æœ‰è€ƒè™‘æŠ€æœ¯å®ç°çš„ä¾èµ–å…³ç³»ï¼Œåšæ·±å±‚æ¬¡çš„åŸºç¡€æ¦‚å¿µæ‹†è§£ã€‚å¦‚æœæ¡†æ¶åªæœ‰è¿™äº›åŠŸèƒ½ï¼Œé‚£ä¹ˆå†™å‡ºæ¥çš„è‡ªåŠ¨åŒ–ç”¨ä¾‹ä»£ç å¿…ç„¶æ˜¯åˆè‡­åˆé•¿ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</p>
<p>ä»£ç å†—é•¿çš„é—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿéœ€è¦æŠ½å–å…±æ€§ï¼Œåšæ›´ç»†ç²’åº¦çš„æ¨¡å—åŒ–ã€‚å…±æ€§åœ¨å“ªé‡Œï¼Ÿæœ‰ä¸¤ä¸ªç‚¹ã€‚é¦–å…ˆæ˜¯ç©å®¶æ“ä½œï¼Œæ¯”å¦‚ä¼ é€åˆ°ä¸–ç•Œçš„æŸä¸ªåæ ‡ï¼Œå’ŒæŸä¸ªç‰©ä»¶äº¤äº’ï¼Œè¿›å…¥é€€å‡ºæŸä¸ªUIçŠ¶æ€ï¼Œè¿™äº›æ“ä½œæ˜¯å¾ˆå¤šè‡ªåŠ¨åŒ–ç”¨ä¾‹éƒ½å…±æœ‰çš„ï¼Œæ‰€ä»¥å¯ä»¥å•ç‹¬æå‡ºæ¥ã€‚å…¶æ¬¡æ˜¯è¡Œä¸ºæ¨¡å¼ï¼Œæ¯”å¦‚æ‰“ä¸»çº¿ä»»åŠ¡å’Œæ”¯çº¿å‰¯æœ¬ï¼Œéƒ½éµå¾ªä¸€å¥—è¡Œä¸ºæ¨¡å¼â€”â€”æ¥ä¸€ä¸ªä»»åŠ¡ï¼Œå®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œå†åˆ¤æ–­æ•´ä¸ªä»»åŠ¡æµç¨‹æ˜¯å¦ç»“æŸã€‚è¿™äº›è¡Œä¸ºæ¨¡å¼å¯ä»¥æŠ½è±¡æˆå•ç‹¬çš„ç±»ï¼Œå®é™…æ‰§è¡Œåªéœ€è¦å…³æ³¨ç‰¹å®šå…¥å‚ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½ç¼–ç æ•´ä¸ªæµç¨‹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ç”¨ä¾‹ä»£ç é‡ã€‚</p>
<p>é€šè¿‡æŠ½è±¡ç©å®¶æ“ä½œå’Œè¡Œä¸ºæ¨¡å¼ï¼Œä¸ä»…å¯ä»¥æœ‰æ•ˆæå‡ç¼–ç æ•ˆç‡ï¼Œè€Œä¸”ä¹Ÿèƒ½å¤Ÿé™ä½ç»´æŠ¤æˆæœ¬ã€‚è¿™ä¾¿æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶æå‡å“è´¨çš„è¦ç‚¹ã€‚</p>
<p>æ¦‚å¿µæ‹†è§£ï¼Œé‡ç»„æ”¹é€ ï¼Œå…¶æ ¸å¿ƒè¦æ€è€ƒçš„ä¾¿æ˜¯ï¼Œå¦‚ä½•åœ¨è‡ªé¡¶å‘ä¸‹çš„éœ€æ±‚æ‹†è§£å’Œè‡ªåº•å‘ä¸Šçš„æŠ€æœ¯å®ç°ä¹‹é—´ï¼Œä¸æ–­ä¼˜åŒ–è¿™ä¸ªâ€œæœ€å¤§å…¬çº¦æ•°â€ã€‚éœ€æ±‚æ˜¯ä¸å¯æ§çš„ï¼ŒæŠ€æœ¯å®ç°æ˜¯å¯æ§çš„ï¼Œå°±å’Œæ‰“éº»å°†ä¸€æ ·ï¼Œæˆ‘ä»¬æ°¸è¿œæ— æ³•ç¡®è®¤ä¸‹ä¸€ä¸ªè¿›å¼ ä¸€å®šæ˜¯ä»€ä¹ˆç‰Œï¼Œä½†ç»„ç‰Œçš„æƒåˆ©ä¸€å®šæ°¸è¿œæŒæ¡åœ¨æˆ‘ä»¬è‡ªå·±æ‰‹ä¸­ã€‚å› æ­¤ï¼Œä¸ºäº†è®©æŠ€æœ¯å®ç°èƒ½å¤Ÿæ›´å…·å¤‡å¯æŒç»­æ€§ï¼Œæˆ‘ä»¬æ‰éœ€è¦æŠŠæ‰€æœ‰æ¦‚å¿µæ‰“ç¢ï¼Œç†é¡ºæ¦‚å¿µä¹‹é—´çš„ä¾èµ–å’Œå±‚æ¬¡å…³ç³»ï¼Œå†æ ¹æ®çµæ´»ç»„åˆä¸åŒçš„æ¦‚å¿µä½“ç³»ï¼Œä»¥è¾¾åˆ°ä¸åŒéœ€æ±‚é¢„æœŸçš„æ•ˆæœã€‚é™¤äº†å‘ç€é¢„æœŸçš„ç‰Œå‹ç»„ç‰Œä¹‹å¤–ï¼Œä¹Ÿè¦å…¼é¡¾å…¶å®ƒç‰Œå‹çš„å¯èƒ½æ€§ï¼ŒæŠŠç‰Œæ‰“æ´»ã€‚è¿™æ ·åšæŠ€æœ¯è®¾è®¡ï¼Œå°±å¯ä»¥åº”å¯¹é¢‘ç¹çš„éœ€æ±‚å˜æ›´ï¼Œä¸è‡³äºç§¯é‡éš¾è¿”ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>å¾®æœåŠ¡</tag>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘èš‚èšå˜æ›´ç®¡æ§å¹³å°AlterShieldè®¾è®¡åˆ†æ</title>
    <url>/2024/02/04/githubdiscovery/altershield_design/</url>
    <content><![CDATA[<p>æŠ€æœ¯é£é™©ï¼Œä½œä¸ºè´¨é‡ä¿éšœé¢†åŸŸçš„é‡è¦çš„ä¸€ç¯ï¼Œä¸»è¦ç ”ç©¶å¦‚ä½•é€šè¿‡è§£å†³æ–¹æ¡ˆå’ŒæŠ€æœ¯æ‰‹æ®µï¼Œè§£å†³ä¼ä¸šå†…ä¸šåŠ¡åœ¨åŸºç¡€è¿ç»´ã€æ—¥å¸¸è¿è¥å’Œå˜æ›´ä¸Šçº¿è¿‡ç¨‹ä¸­çš„ç¨³å®šæ€§é—®é¢˜ï¼Œä¿è¯ä¸šåŠ¡é£é™©å¾—åˆ°æ”¶æ•›ã€‚åœ¨å›½å†…ï¼Œèš‚èšé‡‘æœåœ¨è¿™ä¸ªæ–¹å‘ä¸Šæœ‰æ²‰æ·€å¾ˆå¤šæ–¹æ³•è®ºå’Œå®è·µç»éªŒã€‚å˜æ›´ç®¡æ§æ˜¯æŠ€æœ¯é£é™©åœ°ä¸€ä¸ªå­é¢†åŸŸï¼Œä¸»è¦çš„ç›®æ ‡æ˜¯åœ¨å˜æ›´è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡å¯¹å˜æ›´æµç¨‹çš„ç®¡æ§ä»‹å…¥ï¼Œæå‰å‘ç°å˜æ›´è¿‡ç¨‹å­˜åœ¨çš„äº‹æ•…é£é™©ï¼Œæˆ–è€…é˜»æ­¢å˜æ›´è¿‡ç¨‹çš„é”™è¯¯è¿›ä¸€æ­¥æ‰©å¤§å½±å“é¢ã€‚åœ¨è¿™ä¸ªå­é¢†åŸŸï¼Œèš‚èšå¼€æºäº†<span class="exturl" data-url="aHR0cHM6Ly9hbHRlcnNoaWVsZC5pby96aC1DTi9kb2NzL2ludHJvZHVjdGlvbi93aGF0LWlzLWFsdGVyc2hpZWxkLw==" title="https://altershield.io/zh-CN/docs/introduction/what-is-altershield/">AlterShieldå˜æ›´ç®¡æ§å¹³å°<i class="fa fa-external-link"></i></span>ï¼Œæä¾›äº†ä¸€å¥—å˜æ›´é£é™©é˜²å¾¡çš„è§£å†³æ–¹æ¡ˆã€‚ä»Šå¤©ï¼Œæœ¬æ–‡å°±æµ…æä¸‹AlterShieldå¹³å°æ•´ä½“çš„è®¾è®¡ï¼Œé€‚ç”¨çš„åœºæ™¯ä»¥åŠå±€é™æ€§ã€‚</p>
<p>AlterShieldçš„æºç å¯ä»¥å‚è€ƒè¿™ä¸ª<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RyYWFzLXN0YWNrL2FsdGVyc2hpZWxk" title="https://github.com/traas-stack/altershield">GitHub-Repo<i class="fa fa-external-link"></i></span>ã€‚æ•´ä½“çš„<span class="exturl" data-url="aHR0cHM6Ly9hbHRlcnNoaWVsZC5pby96aC1DTi9ibG9nL3dlbGNvbWUtYWx0ZXJzaGllbGQtdjAuMQ==" title="https://altershield.io/zh-CN/blog/welcome-altershield-v0.1">æŠ€æœ¯æ¶æ„<i class="fa fa-external-link"></i></span>ï¼Œä¸»è¦åŒ…å«å‡ å—éƒ¨åˆ†ï¼š</p>
<a id="more"></a>
<ul>
<li>OCMS-SDKï¼šé¢å‘å˜æ›´æ¸ é“å’ŒK8Sè¿ç»´å¹³å°çš„æ¥å…¥å±‚ï¼Œçº¦å®šäº†ç»Ÿä¸€çš„å˜æ›´ä¿¡æ¯åè®®å’Œå˜æ›´æŠ€æœ¯åè®®çš„å®šä¹‰</li>
<li>Defender-Frameworkï¼šå˜æ›´é˜²å¾¡æ¡†æ¶ï¼Œæä¾›å¼‚å¸¸æ£€æµ‹ã€å‘å¸ƒçª—å£å°ç¦ç­‰å˜æ›´é˜²å¾¡èƒ½åŠ›ï¼Œç”¨äºæ£€æµ‹å˜æ›´é£é™©</li>
<li>Analyzer-Frameworkï¼šå˜æ›´åˆ†ææ¡†æ¶ï¼Œæä¾›å½±å“é¢åˆ†æã€å˜æ›´åˆ†çº§ç­‰å˜æ›´è¿‡ç¨‹åˆ†æèƒ½åŠ›ï¼Œç”¨äºæå‰åˆ†æå˜æ›´å†…å®¹ï¼Œä¸ºå˜æ›´é˜²å¾¡èƒ½åŠ›æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯è¾“å…¥</li>
</ul>
<p>æœ€åº•å±‚çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ˜¯å˜æ›´ä¿¡æ¯åè®®å’Œå˜æ›´æŠ€æœ¯åè®®ã€‚é¦–å…ˆæ˜¯å˜æ›´ä¿¡æ¯åè®®ï¼Œæ•´ä¸ªåè®®æè¿°äº†ä¸€æ¬¡å˜æ›´æœ€åŸºç¡€çš„5W1Hä¿¡æ¯ï¼š</p>
<ul>
<li>Whoï¼šå˜æ›´äºº</li>
<li>Whenï¼šå˜æ›´æ—¶é—´</li>
<li>Whyï¼šå˜æ›´èƒŒæ™¯</li>
<li>Whereï¼šå˜æ›´æ¸ é“</li>
<li>Howï¼šå˜æ›´æ“ä½œ</li>
<li>Whatï¼šå˜æ›´å¯¹è±¡</li>
</ul>
<p>ä»»ä½•æ¸ é“ä»»æ„å˜æ›´æ“ä½œï¼Œå…¶ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯éƒ½å¯ä»¥ç”¨è¿™ä¸ª5W1Hè¡¨ç¤ºæ³•æè¿°ï¼Œç®€æ´æ–¹ä¾¿ï¼Œåˆ©äºå®šä½å’Œå›æº¯ã€‚</p>
<p>å…¶æ¬¡æ˜¯å˜æ›´æŠ€æœ¯åè®®ã€‚å˜æ›´æŠ€æœ¯åè®®æå‡ºäº†å˜æ›´ä»£é™…çš„æ¦‚å¿µï¼Œç”¨äºæè¿°å˜æ›´é˜²æ§èƒ½åŠ›å¯ä»‹å…¥å˜æ›´è¿‡ç¨‹çš„ä¸åŒæ–¹å¼ã€‚å˜æ›´ä»£é™…è¿™ä¸ªæ¦‚å¿µç²—çœ‹å¾ˆæœ‰é˜¿é‡Œå‘³ï¼Œæ¯”è¾ƒéš¾ä»¥ç†è§£ï¼Œä½†æˆ‘ä»¬å¦‚æœåˆ†å˜æ›´æ¸ é“å’ŒAlterShieldè§†è§’æ¥çœ‹çš„è¯ï¼Œä¸éš¾å‘ç°ä¸åŒçš„å˜æ›´ä»£é™…å®é™…ä»£è¡¨ç€å˜æ›´æ¸ é“å¯é€‰æ¥å…¥AlterShieldçš„ä¸åŒæ–¹å¼ã€‚ä¸€äº›å˜æ›´æ¸ é“å¯é€‰åªæä¾›äº‹ä»¶ä¿¡æ¯ï¼Œå¦ä¸€äº›å˜æ›´æ¸ é“ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨å˜æ›´ä¸åŒé˜¶æ®µå¼•ç”¨AlterShieldçš„æ‹¦æˆªå¡å£ï¼Œä»å˜æ›´æ¸ é“æ–¹è§†è§’ï¼Œä¸éœ€è¦éå¸¸å…³æ³¨å…·ä½“æœ‰ä»€ä¹ˆå˜æ›´é˜²å¾¡èƒ½åŠ›å¯ç”¨ï¼Œåªéœ€è¦æ³¨å†Œè‡ªèº«çš„æ¥å…¥æ–¹å¼ï¼Œç»™å®šå‡ ä¸ªå¯åº”ç”¨é˜²æ§èƒ½åŠ›çš„åˆ‡ç‚¹å³å¯ï¼›è€Œä»AlterShieldè§’åº¦ï¼Œåªéœ€è¦ç»™ä¸šåŠ¡å¼€æ”¾èƒ½åŠ›ï¼Œè®©ä¸šåŠ¡å¯é’ˆå¯¹ä¸åŒå¹³å°å‘å¸ƒï¼Œé…ç½®ä¸åŒåˆ‡é¢èƒ½åŠ›ï¼Œä»è€Œè¾¾åˆ°å˜æ›´é˜²æ§çš„æ•ˆæœã€‚</p>
<p>å˜æ›´ä»£é™…è¿™æ ·çš„æ¨¡å¼ï¼Œéœ€è¦ä¾èµ–AlterShieldçš„å¼€å‘æ–¹å’Œä¸»æµçš„å˜æ›´æ¸ é“åšåˆ°æ·±åº¦å¯†åˆ‡çš„é…åˆï¼Œä¹Ÿéœ€è¦ä¼ä¸šå†…éƒ¨ä¸ºæ‰€æœ‰å˜æ›´æ¸ é“çº¦å®šä¸€å¥—å˜æ›´æµç¨‹çš„è§„èŒƒä½œä¸ºä»£é™…æ¦‚å¿µçš„æ”¯æ’‘ã€‚å› æ­¤ï¼Œå¦‚æœå˜æ›´ç®¡æ§å¹³å°ä¸æ˜¯å’Œå˜æ›´æ¸ é“æ·±åº¦å…±å»ºï¼Œä»¥åŠå¯¹äºå˜æ›´æ¸ é“çš„å˜æ›´æµç¨‹è§„èŒƒçº¦æŸä¸å¼ºçƒˆçš„è¯ï¼Œå¼•ç”¨å˜æ›´ä»£é™…çš„æ¨¡å¼å¯èƒ½ä¸å¤Ÿçµæ´»ï¼Œä½†éœ€è¦ä¿è¯è‡³å°‘æœ‰G0ï¼ˆå˜æ›´äº‹ä»¶ï¼‰çš„æ¥å…¥æ–¹æ¡ˆã€‚å¯¹äºé«˜å‘å¸ƒé¢‘æ¬¡ï¼Œä¸ä¸šåŠ¡æ ¸å¿ƒé“¾è·¯å¼ºç›¸å…³çš„å‘å¸ƒæ¸ é“ï¼Œéœ€è¦æœ‰ç²’åº¦æ›´é«˜ï¼ˆä»£é™…æ›´å¤§ï¼‰çš„æ¥å…¥æ–¹æ¡ˆï¼Œå»å°½å¯èƒ½åœ¨æ›´å¤šçš„æ—¶é—´ç‚¹å‘ç°æ›´å¤šçš„å˜æ›´é£é™©ã€‚</p>
<p>æœ€åç®€å•çœ‹ä¸€ä¸‹å˜æ›´é˜²å¾¡èƒ½åŠ›ã€‚å½“å‰åœ¨æ–‡æ¡£ä¸­ï¼Œä»‹ç»äº†4ç§å˜æ›´é˜²å¾¡èƒ½åŠ›ï¼š</p>
<ul>
<li>æ—¶åºæŒ‡æ ‡å¼‚å¸¸æ£€æµ‹ï¼šç»™å®šä¸€æ‰¹æ£€æµ‹æŒ‡æ ‡ï¼Œå¯¹æ¯”å˜æ›´æœŸé—´è¿™æ‰¹æŒ‡æ ‡è·Ÿå˜æ›´å‰ã€å†å²å˜æ›´çš„ç›¸ä¼¼åº¦ï¼Œæ¥æ¨æ–­æœ¬æ¬¡å˜æ›´æ˜¯å¦æœ‰æŒ‡æ ‡å¼‚å¸¸</li>
<li>æ—¥å¿—å¼‚å¸¸æ£€æµ‹ï¼šæ£€æµ‹é”™è¯¯æ—¥å¿—ä¸­ï¼Œæ˜¯å¦æœ‰é”™è¯¯æˆ–è€…å¼‚å¸¸å †æ ˆä¿¡æ¯</li>
<li>é“¾è·¯å¼‚å¸¸æ£€æµ‹ï¼šæ£€æµ‹ä¸€æ¡ä¸Šä¸‹é“¾è·¯ä¸Šï¼Œå˜æ›´æœŸé—´æ˜¯å¦æœ‰æŸä¸ªèŠ‚ç‚¹çªç„¶å‘ç”Ÿå¼‚å¸¸</li>
<li>é…ç½®å€¼è‡ªé€‚åº”æ ¡éªŒï¼šè®­ç»ƒæ—¢å¾€çš„å˜æ›´å†…å®¹ï¼Œæ¨æ–­æ›´æ–°çš„KVæ˜¯å¦å¯èƒ½æœ‰äººå·¥å¡«å†™é”™è¯¯é—®é¢˜</li>
</ul>
<p>å˜æ›´é˜²å¾¡èƒ½åŠ›çš„æ–¹æ¡ˆåŸºæœ¬æ˜¯é€šç”¨çš„ï¼Œè€Œä¸”åƒæ—¥å¿—å¼‚å¸¸ã€é…ç½®æ ¡éªŒç­‰èƒ½åŠ›ï¼Œåœ¨èƒ½åŠ›åŸºç¡€ä¸Šï¼Œéœ€è¦æ”¯æŒä¸šåŠ¡è‡ªå®šä¹‰ã€‚æŒ‡æ ‡ã€æ—¥å¿—å’Œé“¾è·¯å¼‚å¸¸æ£€æµ‹ï¼Œå¦‚æœèƒ½å¤Ÿç»“åˆä¼ä¸šå†…éƒ¨å¯¹äºæ€§èƒ½æ‰“ç‚¹ã€æ—¥å¿—æ”¶é›†ã€é“¾è·¯æ‰“æ ‡ç­‰åŸºç¡€æ¶æ„èƒ½åŠ›è¿›è¡Œå»ºè®¾ï¼Œæ˜¯æ›´åŠ åˆé€‚ä¸”å…·å¤‡è¿œè§çš„æ–¹å¼ã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>DevOps</tag>
        <tag>è´¨é‡ä¿éšœ</tag>
        <tag>AlterShield</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘æ…¢æŸ¥è¯¢çš„é£é™©æ²»ç†æ€è·¯</title>
    <url>/2024/01/07/testlife/slow_query_risk/</url>
    <content><![CDATA[<p>åœ¨çº¿ä¸Šç¯å¢ƒè¿ç»´è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ²»ç†æ…¢æŸ¥è¯¢çš„é£é™©ã€‚æ…¢æŸ¥è¯¢ä¼šå¼•èµ·DBæ€§èƒ½é—®é¢˜ï¼Œå¹¶ä¸”å½“çº¿ä¸Šç¯å¢ƒæµé‡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå‡ºç°å› å¤§é‡æ…¢æŸ¥è¯¢å †ç§¯å¯¼è‡´DBè¢«æ‰“æŒ‚çš„æƒ…å†µã€‚å› æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« åˆ†äº«ä¸€ä¸‹æ…¢æŸ¥è¯¢çš„é£é™©æ²»ç†æ€è·¯ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°æ…¢æŸ¥è¯¢ã€‚é€šå¸¸å¯¹äºå¤§è¡¨ï¼Œæœªæ­£ç¡®å¼•ç”¨ç´¢å¼•å¯¼è‡´å…¨è¡¨æ‰«æï¼Œå°±ä¼šå‡ºç°æ…¢æŸ¥è¯¢ã€‚æ…¢æŸ¥è¯¢å‡ºç°ä¹Ÿä¼šç»å†ä»æ— åˆ°æœ‰çš„è¿‡ç¨‹ï¼Œè€Œä¸ºä½•ä»æ— åˆ°æœ‰ï¼Œå°±æ¶‰åŠåˆ°ä¸šåŠ¡å˜æ›´ã€‚ä»¥ä¸‹å‡ ç§ä¸šåŠ¡å˜æ›´åœºæ™¯å°±æœ‰å¯èƒ½å¯¼è‡´æ…¢æŸ¥è¯¢çš„äº§ç”Ÿï¼š</p>
<a id="more"></a>
<ul>
<li>ä¸šåŠ¡ä»£ç å˜æ›´ï¼šä»£ç é€»è¾‘æ²¡æœ‰æ­£ç¡®å¼•ç”¨ç´¢å¼•</li>
<li>DMLå˜æ›´ï¼šWHEREæ¡ä»¶æ²¡æœ‰æ­£ç¡®å¼•ç”¨ç´¢å¼•</li>
<li>DDLç´¢å¼•å˜æ›´ï¼šçº¿ä¸Šä»£ç è¿˜å¼•ç”¨åŸæ¥çš„ç´¢å¼•ï¼Œå¯¼è‡´å®é™…ç´¢å¼•æœªå¼•ç”¨æ­£ç¡®</li>
</ul>
<p>æ…¢æŸ¥è¯¢çš„ç‰¹å¾ï¼Œä»ä¸šåŠ¡è§†è§’æ˜¯DBå“åº”é€Ÿåº¦å˜æ…¢ï¼Œè€Œä»DBè§†è§’æ˜¯æ€§èƒ½å ç”¨å˜å¤§ã€‚ä»äº‹åæ’æŸ¥çš„è§’åº¦ï¼Œä»¥MySQLä¸ºä¾‹ï¼Œå½“å˜æ›´åç–‘ä¼¼å‘ç”Ÿæ…¢æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç»“åˆ<span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL3Nsb3ctcXVlcnktbG9nLmh0bWw=" title="https://dev.mysql.com/doc/refman/8.0/en/slow-query-log.html">Slow Query Log<i class="fa fa-external-link"></i></span>ä¸<span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL215c3FsZHVtcHNsb3cuaHRtbA==" title="https://dev.mysql.com/doc/refman/8.0/en/mysqldumpslow.html">mysqldumpslow<i class="fa fa-external-link"></i></span>æ¥æŸ¥çœ‹å…·ä½“æ˜¯å“ªäº›æŸ¥è¯¢è¯­å¥å‡ºç°äº†æ…¢æŸ¥è¯¢ã€‚</p>
<p>ä¹‹åï¼Œæˆ‘ä»¬æ‰éœ€è¦é’ˆå¯¹å¯èƒ½å‡ºç°æ…¢æŸ¥è¯¢çš„åœºæ™¯ï¼Œè®¾å®šé¢„é˜²çš„æ‰‹æ®µï¼Œå°½å¯èƒ½é¿å…äº‹åæ­¢æŸã€‚é’ˆå¯¹ä¸Šè¿°å‡ ç§å˜æ›´é£é™©ï¼Œæˆ‘ä»¬å¯ä»¥å„ä¸ªå‡»ç ´ï¼š</p>
<ul>
<li>ä¸šåŠ¡ä»£ç å˜æ›´ï¼šä»£ç å¼•ç”¨DBæ‰«æã€çº¿ä¸‹æŸ¥è¯¢æ²»ç†</li>
<li>DMLå˜æ›´ï¼šEXPLAIN</li>
<li>DDLç´¢å¼•å˜æ›´ï¼šä»£ç å¼•ç”¨DBæ‰«æã€çº¿ä¸‹æŸ¥è¯¢æ²»ç†</li>
</ul>
<p>DMLå˜æ›´çš„æƒ…å†µæ¯”è¾ƒå¥½è§£ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vOC4wL2VuL2V4cGxhaW4uaHRtbA==" title="https://dev.mysql.com/doc/refman/8.0/en/explain.html">EXPLAIN<i class="fa fa-external-link"></i></span>çš„æ‰‹æ®µè§£æDMLï¼ˆæŸ¥è¯¢é€»è¾‘ï¼‰é¢„æœŸä¼šä½¿ç”¨åˆ°çš„ç´¢å¼•ã€æ‰«æè¡Œæ•°å’Œå½±å“è¡Œæ•°ã€‚å¦‚æœæŸ¥è¯¢çš„æ˜¯å¤§è¡¨ï¼Œå¹¶ä¸”æ²¡æœ‰å¼•ç”¨ç´¢å¼•ï¼Œæˆ–è€…æ‰«æ/å½±å“è¡Œæ•°è¿‡é«˜ï¼Œåˆ™éœ€è¦æ³¨æ„çœŸå®æ‰§è¡Œæ—¶å€™ï¼Œå¯èƒ½ä¼šé€ æˆæ…¢æŸ¥å½±å“ã€‚</p>
<p>ä¸šåŠ¡ä»£ç æˆ–DDLç´¢å¼•å˜æ›´çš„æƒ…å†µï¼Œåˆ™éœ€è¦æŠŠå˜æ›´å†…å®¹æ‰«æå’Œçº¿ä¸‹æ²»ç†å…³è”ä¸Šï¼Œæ¥ç¡®å®šå½“æ¬¡å˜æ›´æ˜¯å¦æœ‰é£é™©ã€‚åœ¨ä¸šåŠ¡ä»£ç çº¿ä¸‹æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¯”å¦‚æå–ORM-Logçš„æ–¹å¼è§£æä¸€äº›å…ˆä¸‹ä»£ç ç”Ÿæˆçš„SQLï¼Œç„¶åæ”¾åˆ°çº¿ä¸Šåº“EXPLAINï¼Œä»è€Œå‘ç°çº¿ä¸‹å˜æ›´å¯èƒ½å¯¼è‡´çº¿ä¸Šæ…¢æŸ¥çš„ä¸€äº›caseã€‚åœ¨ä»£ç å˜æ›´å‘å¸ƒåˆ°çº¿ä¸Šçš„æ—¶å€™ï¼Œä¸€æ–¹é¢å¯ä»¥é€šè¿‡åˆ†æä»£ç å¼•ç”¨æ¥åˆ¤æ–­ä»£ç æ˜¯å¦æ­£ç¡®å¼•ç”¨ç´¢å¼•ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å†æ¬¡ç¡®è®¤çº¿ä¸‹å‘ç°çš„SQLé£é™©æ˜¯å¦å·²ç»ç¡®è®¤ä¿®å¤ï¼Œä»è€Œé¿å…é£é™©å¤¹å¸¦åˆ°çº¿ä¸Šã€‚DDLç´¢å¼•å˜æ›´åŒç†ï¼Œåœ¨æ‰§è¡ŒDDLå‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¡€ç¼˜å…³ç³»æ‰¾åˆ°ä¸Šæ¸¸çš„æœåŠ¡ï¼Œæ ¹æ®æœåŠ¡ä»£ç å†å²çš„åˆ†æç»“æœä»¥åŠçº¿ä¸‹æå–SQLçš„è®°å½•ï¼Œæ¥åˆ¤æ–­å˜æ›´åä¼šå¦å‡ºç°ç´¢å¼•æœªæ­£ç¡®å¼•ç”¨çš„æƒ…å†µã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>å˜æ›´é£é™©</tag>
        <tag>SQL</tag>
        <tag>æ•°æ®åº“</tag>
        <tag>æ…¢æŸ¥è¯¢</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ•°æ®åŒæ­¥å’Œè¿ç§»çš„å˜æ›´æ³¨æ„äº‹é¡¹</title>
    <url>/2023/12/09/testlife/data_sync_warn/</url>
    <content><![CDATA[<p>æ•°æ®åŒæ­¥æˆ–è€…è¿ç§»æ“ä½œä¹Ÿç®—æ˜¯çº¿ä¸Šæ•°æ®å˜æ›´çš„ä¸€ç§ç±»å‹ã€‚ç”±äºæ¶‰åŠçš„æ•°æ®é‡éå¸¸å¤§ï¼Œä¸€æ—¦å‘ç”Ÿæ•…éšœï¼Œä¼šç›´æ¥å½±å“çº¿ä¸Šä¸šåŠ¡ï¼Œå¹¶ä¸”è¾ƒéš¾æ­¢æŸã€‚ä»å˜æ›´é£é™©ç®¡æ§çš„è§’åº¦è€ƒè™‘ï¼Œæ•°æ®åŒæ­¥æˆ–è¿ç§»æ“ä½œä¹Ÿéœ€è¦èµ°åˆç†çš„å‘å¸ƒçª—å£ï¼Œå¹¶ä¸”åœ¨æ“ä½œå‰ä¹Ÿéœ€è¦åšè¶³å¤Ÿçš„å½±å“åˆ†æã€‚æœ¬æ–‡å°±æ¥èŠä¸€ä¸‹æ•°æ®åŒæ­¥å’Œè¿ç§»çš„å˜æ›´æœŸé—´æ³¨æ„äº‹é¡¹ã€‚</p>
<p>æ•°æ®åŒæ­¥æŒ‰ç…§æŒç»­çŠ¶æ€çš„ä¸åŒå¯ä»¥åˆ†ä¸ºä¸€æ¬¡æ€§åŒæ­¥è·ŸæŒç»­æ€§åŒæ­¥ã€‚ä»è´¨é‡ä¿éšœçš„è§’åº¦ï¼Œè¦é™ä½æŒç»­æ€§åŒæ­¥çš„é£é™©ï¼Œéœ€è¦é¢å¤–è€ƒè™‘æ•°æ®è·Ÿç»„ä»¶æ€§èƒ½çš„ç›‘æ§ï¼Œå…¶å®ƒæ–¹é¢çš„è€ƒè™‘ä¸¤è€…æ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ã€‚æ•°æ®åŒæ­¥çš„æ“ä½œæ‰‹æ³•ä¹Ÿæœ‰å¾ˆå¤šç§ï¼Œæ—¢å¯ä»¥é€šè¿‡æ­å»ºä¸­é—´ä»¶ï¼Œå®ç°ä¸€ä¸ªå¯¼å…¥binlogåˆ°MQç„¶åå†å¯¼åˆ°å…¶å®ƒå­˜å‚¨çš„é€šè·¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå»ºä¸šåŠ¡æœåŠ¡ï¼Œé€šè¿‡æ‰¹é‡åˆ·æ•°çš„æ–¹å¼ä¸»åŠ¨å¯¼å…¥å¤§é‡æ•°æ®ã€‚å¯¹äºåè€…ï¼Œåœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjMvMDcvMDkvdGVzdGxpZmUvZGF0YV93YXNoX3Jpc2sv" title="https://utmhikari.top/2023/07/09/testlife/data_wash_risk/">ä»¥å‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>å½“ä¸­å·²ç»æåˆ°äº†ä¸€äº›é€šç”¨çš„é£é™©ç‚¹ï¼Œä½†å¦‚æœè€ƒè™‘åˆ°æ•°æ®åŒæ­¥çš„éœ€è¦ï¼Œè¿˜ä¼šæœ‰ä¸€äº›é¢å¤–çš„è€ƒé‡ã€‚</p>
<a id="more"></a>
<p>ç¬¬ä¸€å—æ˜¯å‹åŠ›ï¼Œæ•°æ®åŒæ­¥çš„å‹åŠ›ç›¸æ¯”äºä¸€èˆ¬ä¿®æ•°æ˜¯æ›´åŠ å¤§çš„ï¼Œæºå­˜å‚¨æœ‰è¯»çš„å‹åŠ›ï¼Œè€Œç›®æ ‡å­˜å‚¨æœ‰å†™çš„å‹åŠ›ï¼Œå¹¶ä¸”ç”±äºä¸€èˆ¬è¯»æ“ä½œå¯èƒ½ä¼šåˆ†æ•£åˆ°å¤šä¸ªå­˜å‚¨èŠ‚ç‚¹ï¼Œå†™å‹åŠ›å¯¹äºå•ç‚¹å­˜å‚¨çš„å½±å“ä¼šæ›´å¤§ï¼Œå› æ­¤éœ€è¦é‡ç‚¹è€ƒè™‘ç›®æ ‡èŠ‚ç‚¹å½“å‰çš„QPSæƒ…å†µï¼Œé€‰æ‹©ä¸€ä¸ªç›¸å¯¹åˆé€‚çš„æ•°å­—ã€‚</p>
<p>ç¬¬äºŒå—çš„è€ƒé‡ç‚¹æ˜¯åŒæ­¥æ•°æ®çš„ç­›é€‰å’Œè½¬åŒ–ã€‚é€šå¸¸å¦‚æœæ¶‰åŠåˆ°å¼‚æ„æ•°æ®å­˜å‚¨ï¼ŒåŒæ­¥é“¾è·¯ä¸Šéœ€è¦æ‰§è¡Œæ•°æ®è½¬åŒ–çš„æœåŠ¡èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹ä¹Ÿä¼šæ‰¿å—ä¸€å®šçš„å‹åŠ›ã€‚å¦‚æœæœåŠ¡èŠ‚ç‚¹çš„QPSè¿‡é«˜ï¼Œå¯èƒ½ä¼šå½±å“æœåŠ¡èŠ‚ç‚¹è¿å¸¦çš„ä¸€äº›æœåŠ¡ï¼Œæˆ–è€…ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æœåŠ¡èŠ‚ç‚¹æ³¨å†Œçš„ç½‘å…³è§¦å‘é™æµï¼Œè¿™æ ·å°±æœ‰ä¸šåŠ¡ä¸å¯ç”¨çš„é£é™©ã€‚åŒæ—¶ï¼Œæ•°æ®è½¬åŒ–æœ¬èº«çš„ä»£ç é€»è¾‘ä¹Ÿéœ€è¦ä¿è¯å¥å£®æ€§ï¼Œå¦‚æœè§¦å‘äº†corner-caseå¯¼è‡´æœåŠ¡æŠ¥é”™ï¼Œä¹Ÿæœ‰å¯èƒ½å½±å“ç”šè‡³é˜»å¡æ•°æ®åŒæ­¥ã€‚</p>
<p>ç¬¬ä¸‰å—çš„è€ƒé‡ç‚¹æ˜¯æ•°æ®æ ¡éªŒã€‚å°¤å…¶é’ˆå¯¹æ‰¹é‡è°ƒç”¨æœåŠ¡æ¥å£å¯¼å…¥æ•°æ®çš„æƒ…å†µï¼Œéœ€è¦é€šè¿‡ä¸€å®šçš„æœºåˆ¶å»éªŒè¯æ•°æ®çš„æ­£ç¡®æ€§ï¼Œä¿è¯åŒæ­¥çš„æ•°æ®ç”Ÿæ•ˆå¹¶å¯¹ç¬¦åˆä¸šåŠ¡éœ€æ±‚è¡¨ç°ã€‚æ ¡éªŒæ–¹é¢ï¼Œéœ€è¦è¡¥ä¸Šå°æ—¶çº§ã€æ—¥çº§çš„æ•°æ®å¯¹è´¦ï¼›å‘å¸ƒè¿‡ç¨‹æœ¬èº«ï¼Œä¹Ÿéœ€è¦ä¿è¯æœ‰é˜¶æ®µæ€§çš„ç°åº¦è¿‡ç¨‹ï¼Œå¹¶å°½å¯èƒ½éšæœºé´é€‰æ•°æ®ï¼Œç¡®ä¿å…¨é‡å‘å¸ƒå‰æ•°æ®éªŒè¯æ— è¯¯ã€‚</p>
<p>æœ€åå†å›åˆ°å‹åŠ›ã€‚è¿™å—è®¨è®ºçš„æ˜¯æ•°æ®åŒæ­¥å·²ç»åœ¨çº¿ä¸Šç¨³å®šè¿è¡Œæ—¶ï¼Œå…¶å®ƒå˜æ›´éœ€è¦è€ƒè™‘åˆ°çº¿ä¸Šå·²æœ‰çš„æ•°æ®åŒæ­¥é“¾è·¯ã€‚å¥½æ¯”è¯´DBæ•°æ®çš„å¢é‡æŒç»­æ€§åŒæ­¥ï¼Œå¦‚æœçº¿ä¸Šæœ‰å¤§æ‰¹é‡çš„ä¿®æ”¹æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¯èƒ½å¯¼è‡´æ½œåœ¨çš„æ•°æ®åŒæ­¥é“¾è·¯å› ä¸ºçªç„¶çš„å‹åŠ›å‘ç”Ÿé˜»å¡ï¼Œå½±å“æŸäº›ä¸šåŠ¡å¯ç”¨æ€§ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦æ¢³ç†å˜æ›´æ“ä½œæ¶‰åŠçš„DBï¼Œä»¥åŠDBæ¶‰åŠçš„æ•°æ®åŒæ­¥é“¾è·¯ï¼Œé€šè¿‡å°æµé‡ç°åº¦çš„æ–¹å¼åˆæ­¥æ£€æµ‹å‹åŠ›çŠ¶å†µå¦‚ä½•ï¼Œå†é€æ­¥åœ°ä¿®æ”¹å¹¶å‘å‚æ•°ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„å˜æ›´æ–¹å¼ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>æ•°æ®è¿ç§»</tag>
        <tag>è´¨é‡ä¿éšœ</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>æ•°æ®å˜æ›´</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¶æ„è‰ºæœ¯ã€‘ä¸€äº›é€šç”¨çš„ä»£ç ä¼˜åŒ–æ²»ç†ç»éªŒ</title>
    <url>/2023/11/04/archiart/code_optimization_ways/</url>
    <content><![CDATA[<p>åœ¨æ¥æ‰‹ä»¥å‰çš„é¡¹ç›®åšå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°å› ä¸ºæ—¢æœ‰ä»£ç ç†è§£å›°éš¾ï¼Œå¯¼è‡´ä»£ç éš¾ä»¥åˆ æ”¹ï¼Œé—®é¢˜éš¾ä»¥æ’æŸ¥çš„æƒ…å†µã€‚ä¸€ä»½å¯Œå«æŠ€æœ¯å€ºçš„ä»£ç ï¼Œä¸è®ºå¯¹äºå½“ä¸‹çš„é—®é¢˜è§£å†³ï¼Œè¿˜æ˜¯æœªæ¥çš„éœ€æ±‚å¼€å‘ï¼Œéƒ½ä¼šå½¢æˆç´¯èµ˜ã€‚å› æ­¤ï¼Œæœ¬æ–‡å°±åˆ†äº«ä¸€äº›é€šç”¨çš„ä»£ç ä¼˜åŒ–å’Œæ²»ç†ç»éªŒã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ä»å·¥ä½œçš„è§’åº¦å»çœ‹å¾…ä»£ç ä¼˜åŒ–è¿™ä»¶äº‹æƒ…ã€‚éœ€è¦æ‹æ¸…æ¥šå‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>å½“å‰å·¥ä½œéœ€è¦ç ”å‘ä»€ä¹ˆå†…å®¹ï¼Ÿæœªæ¥å¯èƒ½ç ”å‘ä»€ä¹ˆå†…å®¹ï¼Ÿ</li>
<li>å†å²çš„ä»£ç å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿæœ‰å“ªäº›ä¼˜åŒ–çš„æ–¹æ³•ï¼Ÿ</li>
<li>ä»å†å²ä»£ç åˆ°ç ”å‘çš„å†…å®¹ï¼Œä¸­é—´æˆ‘ä»¬éœ€è¦è¡¥å……ä»€ä¹ˆï¼Ÿæ˜¯å¦ç¡®å®æœ‰å¿…è¦ä¼˜åŒ–å†å²çš„ä»£ç ï¼Ÿ</li>
</ul>
<p>æ¯”èµ·ä¸ºæŠ€æœ¯è€ŒæŠ€æœ¯åœ°å»åšä»£ç é‡æ„ç”šè‡³é‡å†™ï¼Œé”šå®šå½“å‰çš„ç›®æ ‡ï¼ŒæŒ‰éœ€ä¼˜åŒ–æ‰æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚å¦‚æœå†å²ä»£ç å­˜åœ¨æ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œå½±å“äº†æ ¸å¿ƒçš„ä¸šåŠ¡ï¼Œé‚£ä¹ˆå¿…é¡»å¼ºè¡Œå»åšä¿®å¤ï¼Œä¸è®ºä»£ç å®ç°æ˜¯å¦ç¬¦åˆè‡ªå·±çš„å®¡ç¾ã€‚å¦‚æœå†å²ä»£ç å†™çš„ä¸é‚£ä¹ˆç¾è§‚ï¼Œä½†çº¿ä¸Šè·‘çš„è¿˜æ¯”è¾ƒç¨³å®šï¼Œé‚£ä¹ˆä¹Ÿä¸å»ºè®®ç›´æ¥åšä¼˜åŒ–ï¼Œæ›´å¤šçš„ä¼˜å…ˆçº§åº”è¯¥æ”¾åœ¨æ–°ç ”å‘çš„å†…å®¹ä¸Šé¢ã€‚</p>
<a id="more"></a>
<p>ä¸€èˆ¬æˆ‘ä»¬è§‰å¾—å†™çš„ä¸å¥½çš„ä»£ç ï¼Œå¯èƒ½å­˜åœ¨ä»¥ä¸‹å‡ ç±»é—®é¢˜ï¼š</p>
<ul>
<li>å‘½åä¸è§„èŒƒï¼Œæ²¡æœ‰æ˜ç¡®è¡¨ç¤ºä»£ç èƒŒåçš„ä¸šåŠ¡/é¢†åŸŸå«ä¹‰</li>
<li>æ²¡æœ‰æŒ‰æœ€å°çš„ç²’åº¦åšæ¡ä»¶åˆ¤æ–­ï¼Œç†è®ºä¸Šæ— æ³•è¦†ç›–æ‰€æœ‰çš„corner-case</li>
<li>ä¸šåŠ¡æµç¨‹ç¼ºä¹æ‹†åˆ†ï¼Œç¼ºä¹æ¨¡å—åŒ–</li>
<li>æ²¡æœ‰æŒ‰ç…§è¯­è¨€ç‰¹æ€§åšç›®å½•æˆ–æ–‡ä»¶ç»„ç»‡</li>
</ul>
<p>è¿™å‡ ç±»é—®é¢˜éƒ½æœ‰å¯¹åº”çš„ä¼˜åŒ–æ–¹æ³•ã€‚é¦–å…ˆå‘½åé—®é¢˜ï¼Œè¿™ä¸ªè¾ƒä¸ºå¥½è§£ï¼Œäº†è§£ä¸€æ®µåŠŸèƒ½çš„ä»£ç å®ç°ä¹‹å‰ï¼Œè‡ªå·±å¿ƒä¸­è¦å¯¹é¢„æœŸçš„å®ç°é€»è¾‘æœ‰æ•°ï¼Œè¿™æ ·ç¢°åˆ°ç–‘ä¼¼æ²¡æœ‰è¯´æ¸…æ¥šçš„é€»è¾‘ï¼Œä¹Ÿå¯ä»¥è¾ƒå¥½æ¨æ–­è¿™äº›é€»è¾‘å…·ä½“è¦åšä»€ä¹ˆï¼Œå½“ç„¶å¦‚æœæ˜¯æ”¹å‘½åçš„è¯è¿˜æ˜¯å»ºè®®æ…¢æ…¢æ”¹ï¼›å…¶æ¬¡æ˜¯åˆ¤æ–­ä¸æ¸…é—®é¢˜ï¼Œä¸»è¦çš„å…³æ³¨ç‚¹æ˜¯æœªè¦†ç›–çš„corner-caseåœ¨çº¿ä¸Šä»€ä¹ˆæƒ…å†µä¸‹å¯èƒ½å¤ç°ï¼Œé£é™©æ€ä¹ˆæ ·ï¼Œæ’ä¸ªä¼˜å…ˆçº§å»ä¿®ï¼Œä¸å»ºè®®ä¸€æ¬¡æ€§å…¨éƒ¨ä¿®å®Œï¼›å†è€…æ˜¯é€»è¾‘æ‹†åˆ†é—®é¢˜ï¼Œæ¨èæ˜¯ä»…å½“åœ¨éœ€è¦æ‰©å……å†…å®¹çš„æƒ…å†µä¸‹æ‰åŠ¨æ—¢æœ‰é€»è¾‘ï¼Œå¦åˆ™å¦‚æœè‡ªå·±ç†Ÿæ‚‰æ•´ä¸ªæµç¨‹çš„é€»è¾‘ï¼Œä¸æ‹†ä¹Ÿå¯ä»¥ï¼›æœ€åæ˜¯æ–‡ä»¶ç»„ç»‡é—®é¢˜ï¼Œç¬”è€…ä¹Ÿç»å†è¿‡ä¸€ä¸ªGolangé¡¹ç›®ï¼Œé‡Œé¢æŒ‰ç…§pythonå†™æ³•æ¥ç»„ç»‡goä»£ç ï¼Œè¿™ä¸ªé—®é¢˜çš„è§£æ³•åªèƒ½æ˜¯æŠŠæ–°çš„é€»è¾‘æ”¾åˆ°æ–°çš„ç›®å½•ï¼Œéå¿…è¦ä¸åŠ¨æ—§é€»è¾‘ã€‚</p>
<p>è™½ç„¶è¯´ä»£ç æœ¬èº«å­˜åœ¨é—®é¢˜ï¼Œç†è®ºä¸Šå¿…é¡»è¦ä¼˜åŒ–ï¼Œä½†ç»“åˆé¡¹ç›®æ’æœŸï¼Œå·¥ä½œçš„ä¼˜å…ˆçº§ï¼Œä¸å¯èƒ½è¯´ä¸€ä¸ªé¡¹ç›®çš„ä»£ç è¦æ¯æ—¶æ¯åˆ»éƒ½å°½å–„å°½ç¾ã€‚åœ¨å¤šäººåä½œçš„ç ”å‘åœºæ™¯ä¸‹ï¼Œæ¯”èµ·å†™å‡ºæœ€ç¾çš„ä»£ç ï¼Œä¸å¦‚å†™å‡ºè¶³å¤Ÿç¨³çš„ä»£ç ã€‚æ²»ç†ä»£ç é—®é¢˜ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè¦ç»“åˆå…·ä½“çš„å·¥ä½œæƒ…å†µå’Œä»£ç ç¨³å®šæ€§åšå¥½å¹³è¡¡ã€‚</p>
]]></content>
      <categories>
        <category>æ¶æ„è‰ºæœ¯</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>åç«¯å¼€å‘</tag>
        <tag>é‡æ„</tag>
        <tag>Golang</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ¸¸æˆä¸šåŠ¡æµ‹è¯•è½åœ°ç²¾å‡†æµ‹è¯•ä¸“é¡¹çš„ä¸€äº›æ€è·¯</title>
    <url>/2023/10/02/testlife/game_precise_test/</url>
    <content><![CDATA[<p>ç²¾å‡†æµ‹è¯•åœ¨äº’è”ç½‘é¢†åŸŸæœ‰å¹¿æ³›çš„åº”ç”¨ã€‚ä»¥å˜æ›´ä¸ºå‡ºå‘ç‚¹ï¼Œé€šè¿‡å¯¹å˜æ›´å†…å®¹è¿›è¡Œåˆ†æï¼Œå¯ä»¥ç¡®å®šå•æ¬¡å˜æ›´å…·ä½“æ¶‰åŠåˆ°å“ªäº›æ¨¡å—å’ŒåŠŸèƒ½ç‚¹ï¼Œä»¥åŠæ˜¯å¦å­˜åœ¨å¤¹å¸¦é£é™©ï¼Œä»è€Œä»QAçš„è§†è§’ï¼Œå¯ä»¥çŸ¥é“å“ªäº›åŠŸèƒ½æ¨¡å—éœ€è¦åšæµ‹è¯•ï¼Œä»¥åŠå“ªäº›å˜æ›´å†…å®¹ä¸ç¬¦åˆé¢„æœŸã€‚ç›¸æ¯”äºäº’è”ç½‘QAï¼Œæ¸¸æˆQAæ¥å…¥ä¸šåŠ¡é¡¹ç›®ç ”å‘è¿‡ç¨‹å¹¶æ²¡æœ‰é‚£ä¹ˆæ·±å…¥ï¼Œæ¯”å¦‚é¡¹ç›®ä»£ç æƒé™åŸºæœ¬ä¸Šæ¸¸æˆQAä¸ä¼šæ‹¥æœ‰ï¼Œä½†å³ä¾¿å¦‚æ­¤ï¼Œè¦åœ¨æ¸¸æˆæµ‹è¯•é¢†åŸŸåº”ç”¨ç²¾å‡†æµ‹è¯•ä¸“é¡¹æŠ€æœ¯ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šæ€è·¯å¯å¾ªã€‚</p>
<p>å› æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« ï¼Œç¬”è€…ä»¥è‡ªèº«ç»éªŒä¸ºå‡ºå‘ç‚¹ï¼Œè®²è¿°ä¸€ä¸‹åœ¨æ¸¸æˆä¸šåŠ¡æµ‹è¯•è½åœ°ç²¾å‡†æµ‹è¯•ä¸“é¡¹çš„ä¸€äº›æ€è·¯ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ¥çœ‹ï¼Œæ¸¸æˆä¸šåŠ¡æµ‹è¯•åœºæ™¯ï¼Œç²¾å‡†æµ‹è¯•è¦åˆ†æä»€ä¹ˆä»¥åŠæµ‹ä»€ä¹ˆã€‚ç²¾å‡†æµ‹è¯•ä¸€èˆ¬ä¼šé‡‡ç”¨ä»£ç è¦†ç›–æŠ€æœ¯æ¥åˆ†æå•æ¬¡å˜æ›´æ‰€å½±å“çš„èŒƒå›´ï¼Œä¹ŸåŒ…æ‹¬åˆ†æå˜æ›´å¯¹ä¸Šä¸‹æ¸¸æœåŠ¡è·ŸDBçš„å½±å“ã€‚ä½†æ˜¯ï¼Œæ¸¸æˆæœåŠ¡æ¶æ„ç›¸æ¯”äºäº’è”ç½‘å¾®æœåŠ¡æ¶æ„ï¼Œä¸Šä¸‹æ¸¸ä¸šåŠ¡é“¾è·¯ä¸ä¼šéå¸¸æ·±ã€‚å› æ­¤ï¼Œä»æ¸¸æˆæµ‹è¯•è§’åº¦ï¼Œä»£ç å˜æ›´å†…å®¹å¯ä»¥æ›´åŠ ç²¾ç¡®å®šä½åˆ°å…·ä½“å“ªä¸ªç³»ç»Ÿå“ªä¸ªåŠŸèƒ½ç‚¹æœ‰æ‰€æ”¹åŠ¨ï¼Œç†è®ºä¸Šä¼šæ›´å®¹æ˜“è¯„ä¼°å“ªäº›æµ‹è¯•ç‚¹éœ€è¦æµ‹è¯•ã€‚</p>
<p>å¦‚æœæ¸¸æˆQAä¸å…·æœ‰é¡¹ç›®ä»£ç æƒé™çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥é€€è€Œæ±‚å…¶æ¬¡ï¼Œå¯ä»¥ä»ä¸šåŠ¡é…ç½®æˆ–è€…åè®®å®šä¹‰å˜æ›´çš„è§’åº¦ï¼Œæ¥æ¨æ–­å“ªäº›ç³»ç»Ÿå“ªäº›æ¨¡å—éœ€è¦åšå›å½’æµ‹è¯•ã€‚è™½ç„¶è¿™ç±»å˜æ›´çš„ä¿¡æ¯ç²’åº¦ä¸åŠä»£ç å˜æ›´ï¼Œä¸ä¸€å®šéå¸¸ç²¾å‡†ï¼Œä½†è‡³å°‘ä¹Ÿå¯ä»¥å‘ç°å¤¹å¸¦çš„å˜æ›´é£é™©ã€‚æ¸¸æˆæœ¬èº«ä½œä¸ºä¸€ä¸ªå¾®ç¼©çš„ä¸–ç•Œæ¨¡æ‹Ÿï¼Œå„ç±»ç©æ³•ç³»ç»Ÿåœ¨å®ç°ä¸Šï¼Œé€»è¾‘è€¦åˆçš„å¯èƒ½æ€§æ˜¯å¾ˆé«˜çš„ã€‚å› æ­¤ï¼Œåœ¨æ—¥å¸¸è¿­ä»£æœŸé—´ï¼Œå¦‚æœèƒ½å¤Ÿç¡®è®¤æ›´å¤šçš„å¤¹å¸¦é£é™©ï¼Œå¯¹äºæ¸¸æˆå¤§ç‰ˆæœ¬å‘å¸ƒçš„è´¨é‡é˜²æ§æ˜¯æœ‰æ‰€æ”¶ç›Šçš„ã€‚</p>
<p>ç„¶åæ¥çœ‹ï¼Œè¦åœ¨æ¸¸æˆä¸šåŠ¡æµ‹è¯•åœºæ™¯è½åœ°ç²¾å‡†æµ‹è¯•ï¼Œéœ€è¦åšäº›ä»€ä¹ˆã€‚ä»æ¸¸æˆä¸šåŠ¡æµ‹è¯•è§†è§’ï¼Œè¦æŠŠç²¾å‡†æµ‹è¯•ä¸“é¡¹è½èµ·æ¥çš„è¯ï¼Œä¸€æœŸçš„å¾…æµ‹ç³»ç»Ÿé€‰å‹æ˜¯éå¸¸å…³é”®çš„ã€‚å¯¹äºå¼ºå®¢æˆ·ç«¯ç±»å‹çš„ç³»ç»Ÿç©æ³•ï¼Œæ¯”å¦‚æ—¶è£…ï¼ˆå±•ç¤ºï¼‰ã€è½½å…·ã€æªæ¢°ç­‰ï¼Œæ›´é‡çš„é€»è¾‘ä¼šè½åœ¨å®¢æˆ·ç«¯ç”¨äºä»¿çœŸæ¨¡æ‹Ÿçš„ä»£ç ï¼Œæˆ–æ˜¯ActorçŠ¶æ€åŒæ­¥çš„ä»£ç ï¼Œä¸šåŠ¡å±æ€§å¹¶ä¸é«˜ï¼Œå› æ­¤åšå˜æ›´åˆ†æä¼šæ¯”è¾ƒå›°éš¾ï¼Œå¹¶ä¸é€‚åˆåšç²¾å‡†æµ‹è¯•çš„åˆæ­¥æ¨å¹¿ã€‚åä¹‹ï¼Œç±»ä¼¼å‰¯æœ¬ä»»åŠ¡ã€è¿è¥æ´»åŠ¨ã€æˆå°±æ”¶é›†ã€å•†åŸäº¤æ˜“ç­‰ç±»å‹çš„ç³»ç»Ÿï¼Œä¸€æ˜¯ä»£ç æ›´èƒ½ä½“ç°ä¸šåŠ¡å±æ€§ï¼ŒäºŒæ˜¯å®ç°æœºåˆ¶å¯èƒ½å’Œå…¶å®ƒç³»ç»Ÿç©æ³•æœ‰æ‰€äº¤é›†ï¼Œå› æ­¤æ¯”è¾ƒé€‚åˆåšåˆæ­¥æ¨å¹¿ã€‚</p>
<p>ç²¾å‡†æµ‹è¯•çš„æ•´ä½“è½åœ°æ–¹é¢ï¼Œä¸å»ºè®®åšæ¯”è¾ƒæ¿€è¿›åœ°åšæ¨åŠ¨ã€‚è¿™æ˜¯å› ä¸ºï¼Œç²¾å‡†æµ‹è¯•æœ¬èº«å±äºä¸“é¡¹èŒƒç•´ï¼Œä»å®æ“è§’åº¦ï¼Œä¼šå­˜åœ¨é¢å¤–çš„å·¥ä½œé‡ï¼Œå¹¶ä¸èƒ½å®Œå…¨æ›¿ä»£æ—¥å¸¸åœ°åŠŸèƒ½æµ‹è¯•å·¥ä½œã€‚å› æ­¤ï¼Œæ¨èä»…åœˆå®šç‰¹å®šèŒƒå›´åšæ•´ä½“è½åœ°ï¼Œæ–¹å¼æ¯”å¦‚ï¼šå¯¹äºæ•´ä¸ªé¡¹ç›®æµ‹è¯•ç»„ï¼Œä»¥åŒå‘¨æˆ–è€…æœˆä¸ºå‘¨æœŸåšä¸€è½®å˜æ›´æ‰«æï¼Œä¸‹å‘åˆ°å„ç³»ç»Ÿowneråšå˜æ›´å†…å®¹ç¡®è®¤ï¼›ä»…é’ˆå¯¹ç‰¹å®šç³»ç»Ÿæ¨¡å—çš„æµ‹è¯•å°ç»„ï¼Œå•ç‹¬åšå˜æ›´å¯¹åº”æµ‹è¯•ç‚¹çš„æ ‡æ³¨ï¼Œä»¥åŠå®æ—¶ç›‘æ§å˜æ›´å†…å®¹ï¼Œåšæ›´ç»†ç²’åº¦æ›´æ—¥å¸¸çš„ç²¾å‡†æµ‹è¯•ã€‚ç›®æ ‡æ”¶ç›Šå±‚é¢ï¼Œéƒ½å¯ä»¥é€šè¿‡ã€ä¸“é¡¹å‘ç°Bugæ•°ã€‘è¿™ä¸€æŒ‡æ ‡æ¥è¡¡é‡ï¼Œè¿™æ˜¯å› ä¸ºï¼Œé¡¹ç›®æ—¥å¸¸è¿­ä»£æœŸé—´ï¼Œç”±Bugæ•°å¯ä»¥ç›´æ¥åæ˜ ç²¾å‡†æµ‹è¯•æ‰€èƒ½å‘ç°çš„é—®é¢˜ã€‚</p>
<p>æœ€åï¼Œéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œç²¾å‡†æµ‹è¯•æœ¬èº«ä¹Ÿæ˜¯æ¸¸æˆä¸šåŠ¡æµ‹è¯•é”¦ä¸Šæ·»èŠ±çš„ä¸€éƒ¨åˆ†ã€‚ä»å®è§‚çš„è§’åº¦çœ‹ï¼Œç²¾å‡†æµ‹è¯•å¯ä»¥å‘ç°å¤¹å¸¦é£é™©ï¼Œå¯ä»¥é€šè¿‡ç²¾å‡†å®šä½æµ‹è¯•ç‚¹æå‡æµ‹è¯•èƒ½æ•ˆï¼Œä½†ä¸“é¡¹è½åœ°æœ¬èº«ä¹Ÿä¼šè€—è´¹ä¸€å®šçš„æ—¶é—´äººåŠ›ï¼Œä»¥åŠç†è§£ä¸“é¡¹çŸ¥è¯†è·Ÿç›®çš„çš„æˆæœ¬ã€‚ä»æ¸¸æˆé¡¹ç›®æ•´ä½“è´¨é‡ä¿éšœè§’åº¦çœ‹ï¼Œå…·ä½“æ˜¯å¦è¦æŠ•å…¥åšç²¾å‡†æµ‹è¯•ï¼Œæ”¶ç›Šèƒ½å¦è¾¾åˆ°é¢„æœŸï¼Œè¿˜éœ€è¦è°¨æ…æ–Ÿé…Œå†³ç­–ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>ä¸“é¡¹æµ‹è¯•</tag>
        <tag>æµ‹è¯•</tag>
        <tag>åŠŸèƒ½æµ‹è¯•</tag>
        <tag>ç²¾å‡†æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘ä¿®å¤Win10å¯åŠ¨å‡ºç°è“å±0xc0000185é”™è¯¯çš„ä¸€äº›æ–¹æ³•</title>
    <url>/2023/09/17/diymemo/win10_0xc0000185/</url>
    <content><![CDATA[<p>è¿‘äº›æ—¥å­æƒ³åˆ°è‡ªå·±å°˜å°å·²ä¹…çš„ç¬”è®°æœ¬ç”µè„‘æ²¡æœ‰å¼€æœºäº†ï¼Œå¾ˆå¤šè½¯ä»¶é©±åŠ¨ä¹‹ç±»çš„æ²¡æœ‰æ›´æ–°ï¼Œå°±æ‰“ç®—æŠŠç”µè„‘å¼€èµ·æ¥åšä¸€è½®æ‰¹é‡å‡çº§ã€‚ä½†å¼€ç”µè„‘çš„æ—¶å€™å¾ˆä¹…æ²¡æœ‰è¿›å…¥Win10æ¡Œé¢ï¼Œç­‰äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´è“å±æç¤º0xc0000185é”™è¯¯ï¼Œè¯´ç³»ç»Ÿéœ€è¦æ¢å¤ã€‚ç»å†äº†ä¸€ç•ªæŠ˜è…¾ä¹‹åï¼Œç¬”è€…è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è™½ç„¶ä¸æ˜ç¡®è¿™ä¸ªé—®é¢˜çš„æ ¹å› åœ¨å“ªé‡Œï¼Œä½†è¿˜æ˜¯åˆ†äº«ä¸€ä¸‹è‡ªå·±æ”¶é›†åˆ°çš„ä¸€äº›è§£å†³æ–¹å¼ã€‚</p>
<p>é¦–å…ˆï¼Œé‡è£…ç³»ç»Ÿè‚¯å®šæ˜¯èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸ä¸€å®šéœ€è¦çœŸçš„é‡è£…ï¼Œè¿™ä¸ªæˆæœ¬å¤ªå¤§äº†ã€‚åä¹‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨é‡è£…ç³»ç»Ÿæ‰€éœ€è¦çš„ä¸œè¥¿ï¼Œä¸€ä¸ªè‡ªå¸¦WinPEç³»ç»Ÿçš„Uç›˜ï¼ŒæŠŠUç›˜æ’åˆ°ç”µè„‘é‡Œï¼Œé‡å¯ç”µè„‘ï¼Œåœ¨è‡ªå·±ç”µè„‘çš„BIOSé‡Œé€‰æ‹©ä¼˜å…ˆå¼•å¯¼Uç›˜çš„WinPEç³»ç»Ÿï¼Œè¿™æ ·ä¸‹æ¬¡å¯åŠ¨ç”µè„‘æ—¶å€™å°±èƒ½è¿›å»ã€‚å¸‚é¢ä¸Šåšè£…æœºæœåŠ¡ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šç”¨åˆ°è¿™ç§ç³»ç»Ÿï¼Œè€Œè¿™æ ·çš„Uç›˜ä¹Ÿå¾ˆå¥½åšï¼Œæœ‰ä¸€ä¸ªç©ºçš„Uç›˜ï¼Œç„¶ååœ¨è€æ¯›æ¡ƒä¹‹ç±»çš„ç½‘ç«™æ‰¾ä¸€ä¸ªä¸€é”®åˆ¶ä½œçš„è½¯ä»¶æ“ä½œå°±å¯ä»¥ã€‚</p>
<a id="more"></a>
<p>ç”±äº0xc0000185é”™è¯¯çš„åŸå› ä¹‹ä¸€ï¼Œå¯èƒ½æ˜¯<span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3RhcmRpcy96bS9hcnQvMzU5OTkxMDk1P3NvdXJjZV9pZD0xMDA1" title="https://www.zhihu.com/tardis/zm/art/359991095?source_id=1005">Win10æ“ä½œç³»ç»Ÿå¼•å¯¼æ–‡ä»¶æŸå<i class="fa fa-external-link"></i></span>ï¼Œå› æ­¤è¿›å…¥WinPEç³»ç»Ÿï¼Œå‡è®¾ä½ ç”¨è€æ¯›æ¡ƒåˆ¶ä½œUç›˜çš„è¯ï¼Œä¼šè‡ªå¸¦BCDå¼•å¯¼ä¿®å¤å·¥å…·ã€‚å¯ä»¥ç”¨è¿™ä¸ªå·¥å…·ç»™Win10æ“ä½œç³»ç»Ÿæ‰€åœ¨çš„ç¡¬ç›˜åšå¼•å¯¼æ–‡ä»¶ä¿®å¤æ“ä½œè¯•è¯•çœ‹ã€‚</p>
<p>å…¶æ¬¡æ˜¯å¯ä»¥ç”¨åˆ é™¤æ³¨å†Œè¡¨æŸä¸ªé”®å€¼çš„æ–¹å¼ã€‚å…·ä½“å¯ä»¥çœ‹<span class="exturl" data-url="aHR0cHM6Ly93d3cuamI1MS5uZXQvb3Mvd2luMTAvNzMzMjI5Lmh0bWw=" title="https://www.jb51.net/os/win10/733229.html">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ã€‚ä½†è¿™é‡Œä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè¿›ä¸äº†æ¡Œé¢ï¼Œæ€ä¹ˆåˆ æ³¨å†Œè¡¨ï¼Ÿè¿™é‡Œï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘çœ‹èƒ½å¦è¿›å…¥Win10çš„å®‰å…¨æ¨¡å¼ï¼Œæ—¢ç„¶æ­£å¸¸æ¡Œé¢è¿›ä¸å»ï¼Œå¯ä»¥è¿›ç®€åŒ–çš„å®‰å…¨æ¨¡å¼çœ‹è¡Œä¸è¡Œï¼Œè¡Œçš„è¯å°±å¯ä»¥æ“ä½œï¼Œä¸è¡Œçš„è¯å†æƒ³å…¶å®ƒåŠæ³•ï¼Œæ¯”å¦‚åœ¨WinPEé‡Œæ“ä½œã€‚å¦‚æœèƒ½å¤ŸæˆåŠŸè¿›å…¥å®‰å…¨æ¨¡å¼ï¼Œå’Œç¬”è€…ä¸€æ ·ï¼Œé‚£ä¹ˆä¹Ÿè®°å¾—æ¸…ç†ä¸€ä¸‹ç³»ç»Ÿï¼Œä¿®å¤ä¸€ä¸‹æ³¨å†Œè¡¨ï¼Œå‡è®¾ä½ æœ‰ä¸€äº›å®‰å…¨è½¯ä»¶æˆ–è€…ç³»ç»Ÿæ¸…ç†è½¯ä»¶çš„è¯ã€‚è¦å°½å¯èƒ½è®©ç³»ç»Ÿæ¢å¤åˆ°ä¸€ä¸ªæ¯”è¾ƒå¹²å‡€çš„çŠ¶æ€ã€‚</p>
<p>æœ€åï¼Œå¦‚æœæ˜¯å°˜å°å·²ä¹…çš„ç¬”è®°æœ¬çš„è¯ï¼Œä¹Ÿéœ€è¦å°½é‡æŠŠç”µå……åˆ°ä¸€ä¸ªæ¯”è¾ƒè¶³çš„çŠ¶æ€ã€‚è¿™é‡ŒYYä¸€ç§å¯èƒ½æ˜¯ï¼Œç³»ç»Ÿç”¨äº†æ¯”è¾ƒé«˜æ€§èƒ½çš„æ¨¡å¼ï¼Œä½†ç¬”è®°æœ¬æœ¬èº«ç”µé‡å°‘ï¼Œå¯¼è‡´ç³»ç»Ÿæ— æ³•æ­£å¸¸å¯åŠ¨ã€‚è™½ç„¶è¿™ä¸€ç‚¹ä¸æ˜¯å¾ˆç»å¾—èµ·æ¨æ•²ï¼Œä½†å®é™…è§£å†³è¿™ä¸ªé—®é¢˜æ—¶ï¼Œå¯ä»¥å°è¯•æ’é™¤ä¸€ä¸‹è¿™ä¸ªå˜é‡ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>Win10</tag>
        <tag>BIOS</tag>
        <tag>WinPE</tag>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
        <tag>ç³»ç»Ÿè®¾ç½®</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æµ…è°ˆæ¸¸æˆç­–åˆ’é…ç½®è¡¨æ£€æŸ¥çš„æŠ€æœ¯è®¾è®¡</title>
    <url>/2023/09/17/testlife/game_table_check/</url>
    <content><![CDATA[<p>è¿‘æœŸåœ¨<span class="exturl" data-url="aHR0cHM6Ly90ZXN0ZXJob21lLmNvbS8=" title="https://testerhome.com/">testerhome<i class="fa fa-external-link"></i></span>çš„æ¸¸æˆæµ‹è¯•èŠ‚ç‚¹é‡Œï¼Œçœ‹åˆ°ä¸€ä¸ªå¾ˆæœ‰è¶£çš„<span class="exturl" data-url="aHR0cHM6Ly90ZXN0ZXJob21lLmNvbS90b3BpY3MvMzc2NDk=" title="https://testerhome.com/topics/37649">å¸–å­<i class="fa fa-external-link"></i></span>ï¼šé’ˆå¯¹æ¸¸æˆç­–åˆ’çš„é…ç½®è¡¨æµ‹è¯•ï¼Œæ˜¯å¦æœ‰å¼€æºçš„æ¡†æ¶å¯ä»¥ç”¨ï¼Ÿé™¤äº†é—®é¢˜æœ¬èº«ä¹‹å¤–ï¼Œå¸–å­çš„æ¥¼ä¸»ä¹Ÿé™„äº†ä¸€å¼ æ•´ä¸ªé…ç½®è¡¨æµ‹è¯•å·¥å…·çš„è®¾è®¡å›¾ï¼Œç”±SVNå˜æ›´ç›‘æ§ã€å‘èµ·æ£€æŸ¥æœ€ååˆ°æ¶ˆæ¯é€šçŸ¥ï¼Œç»„æˆäº†ä¸€ä¸ªæŒç»­é›†æˆçš„é…ç½®è¡¨æµ‹è¯•ä¸“é¡¹å·¥ç¨‹ã€‚ä¸ºæ­¤ï¼Œé’ˆå¯¹è¿™ä¸ªåœºæ™¯ï¼Œç¬”è€…ä¹Ÿå¸Œæœ›è¾“å‡ºä¸€äº›è‡ªå·±å¯¹äºé…ç½®è¡¨æ£€æŸ¥æµ‹è¯•æŠ€æœ¯çš„ä¸€äº›æ€è€ƒã€‚</p>
<p>æœ¬ç¯‡æ–‡ç« è®²è¿°ä¸¤å—å†…å®¹ï¼Œç¬¬ä¸€å—è®²ä¸‹æµ‹è¯•æ¡†æ¶çš„å¼€æºï¼Œç¬¬äºŒå—è®²ä¸‹ä¸“é¡¹æŠ€æœ¯çš„è®¾è®¡ã€‚é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹é…ç½®è¡¨æµ‹è¯•æ¡†æ¶å¼€æºè¿™å—çš„é—®é¢˜ã€‚</p>
<a id="more"></a>
<p>å¼€æºçš„æŠ€æœ¯äº§å“æœ‰å¾ˆå¤šç§ï¼Œå¯ä»¥æ˜¯æ—¥å¸¸çš„ç©å…·ï¼Œå¯ä»¥æ˜¯ä¸ºäº†è§£å†³ç‰¹å®šé—®é¢˜çš„å·¥å…·ï¼Œä¹Ÿå¯ä»¥æ˜¯æå‡å½±å“åŠ›çš„ç­¹ç ã€‚å¦‚æœå•çº¯åªæ˜¯é’ˆå¯¹é…ç½®è¡¨æµ‹è¯•æ¡†æ¶è€Œè¨€ï¼Œä¸è€ƒè™‘ä¸šåŠ¡æ–¹é¢çš„éœ€è¦ï¼Œè¿™ç±»æ¡†æ¶å¦‚æœå¼€æºå‡ºæ¥ï¼Œå½¢æ€åˆ™ç›¸å¯¹ç±»ä¼¼æ—¥å¸¸ç©å…·æˆ–è€…å·¥å…·çš„ç±»å‹ï¼Œä½†èƒ½ä¸èƒ½ç›´æ¥ç”¨ä¸Šï¼Œå°±å€¼å¾—å•†æ¦·äº†ã€‚ä¸åŒçš„å·¥ä½œå®¤ï¼Œç”¨çš„ç­–åˆ’é…ç½®è¡¨å¯èƒ½æ–‡ä»¶æ ¼å¼ä¸åŒï¼Œè¡¨æ ¼æ’ç‰ˆä¸åŒï¼Œæ•°æ®ç»“æ„ä¸åŒï¼Œå› æ­¤ä¸ä¸€å®šè¯´ä¸€ä¸ªé¡¹ç›®çš„é…ç½®è¡¨æ£€æŸ¥å·¥å…·ï¼Œå°±ä¸€å®šå¯ä»¥é€šç”¨åˆ°å¦å¤–ä¸€ä¸ªé¡¹ç›®é‡Œã€‚è€Œä¸”ï¼Œå¦‚æœå¼€æºçš„æ¡†æ¶éœ€è¦ä¸ºæˆ‘æ‰€ç”¨ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯æ¡†æ¶æœ¬èº«æ˜¯å…·å¤‡è¾ƒé«˜é˜²å¾¡æ€§çš„ï¼Œä¸èƒ½è¯´å®é™…ç”¨çš„æ—¶å€™è¦æ’æŸ¥ä¸€å †æ¡†æ¶æœ¬èº«çš„bugã€‚ä»è¿™ä¸€ç‚¹è€ƒè™‘ï¼Œå¤§å¤šæ•°ä¸šåŠ¡æµ‹è¯•å›¢é˜Ÿå†…éƒ¨å¼€å‘å‡ºæ¥çš„æ£€æŸ¥å·¥å…·ï¼Œå¾ˆå¤§æ¦‚ç‡åªæ˜¯è·‘é€šäº†åŸºç¡€æµç¨‹ï¼Œè€Œå¹¶éä¸€ä¸ªå¾ˆå…·å¤‡é˜²å¾¡æ€§çš„æŠ€æœ¯äº§å“ã€‚å› æ­¤å¦‚æœæŠŠè¿™ç±»æ¡†æ¶æ‹¿å‡ºæ¥å¼€æºï¼Œé‚£ä½¿ç”¨èµ·æ¥ä¹Ÿä¼šç›¸å½“éº»çƒ¦ã€‚</p>
<p>å› æ­¤ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯å¦è¦ä½¿ç”¨å¼€æºçš„æµ‹è¯•æ¡†æ¶ï¼Œç¬”è€…çš„å»ºè®®æ˜¯å¦‚æœéœ€è¦å¿«é€Ÿäº¤ä»˜æ˜¯å¯ä»¥è€ƒè™‘ï¼Œgithubè·Ÿgiteeä¸Šè‚¯å®šæœ‰ç±»ä¼¼çš„repoï¼Œä½†å¦‚æœè¦æ‰“æŒä¹…æˆ˜ï¼Œå¼€æºçš„è‚¯å®šä¸å¦‚è‡ªå®¶çš„å¥½ã€‚</p>
<p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯é…ç½®è¡¨æµ‹è¯•ä¸“é¡¹æŠ€æœ¯çš„è®¾è®¡ã€‚ä¸ºä»€ä¹ˆæŠŠè¯é¢˜æ‰¯å¾—è¿™ä¹ˆå¤§ï¼Ÿæ˜¯å› ä¸ºå¦‚æœåšé…ç½®è¡¨æ£€æŸ¥ï¼Œä¸ç»“åˆæ¸¸æˆä¸šåŠ¡æ¥åšæ˜¯æ— æ„ä¹‰çš„ï¼Œå°¤å…¶æ˜¯æˆ‘ä»¬éœ€è¦åšåˆ°æŒç»­äº¤ä»˜ã€æŒç»­åé¦ˆï¼Œæå‡æ•´ä¸ªé¡¹ç›®å›¢é˜Ÿçš„äº¤ä»˜è´¨é‡ï¼Œä¸åªæ˜¯è¦è€ƒè™‘æ£€æŸ¥æœ¬èº«ï¼Œå¯¹å“ªäº›é…ç½®è¡¨åšæ£€æŸ¥ï¼Œæ£€æŸ¥ä»€ä¹ˆï¼Œç”¨ä»€ä¹ˆæ–¹å¼å±•ç°å‡ºæ¥ï¼Œè¿™äº›éƒ½æ˜¯æ•´ä¸ªä¸“é¡¹æ‰€éœ€è¦è€ƒè™‘çš„ã€‚æˆ‘ä»¬æ‰€è¦è§£å†³çš„æœ€ç»ˆé—®é¢˜ï¼Œæ˜¯æå‡é…ç½®è¡¨çš„è´¨é‡ï¼Œæ‰€ç”¨åˆ°çš„æ‰‹æ®µï¼Œæ˜¯é…ç½®è¡¨æ£€æŸ¥æ¡†æ¶ï¼Œè¿˜æœ‰ä¸€å¥—CIæµ‹è¯•æµæ°´çº¿ã€‚</p>
<p>é¦–å…ˆå†å›åˆ°é…ç½®è¡¨æ£€æŸ¥æ¡†æ¶ã€‚è¡¨æ ¼ç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åˆ’åˆ†ä¸ºkey-valueä¸¤ä¸ªéƒ¨åˆ†ï¼Œå…¶ä¸­keyå¯èƒ½åŒ…å«idç±»å‹çš„ä¸»é”®ã€‚è€Œé’ˆå¯¹valueï¼Œé™¤äº†åŸºç¡€çš„æ•°å€¼ã€å­—ç¬¦ä¸²ç±»å‹ä¹‹å¤–ï¼Œåœ¨è½¬è¡¨è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæœ‰å¯èƒ½è¢«è½¬åŒ–æˆjsonç±»å‹çš„æ•°æ®ã€‚å› æ­¤æˆ‘ä»¬åœ¨å†™æ£€æŸ¥é€»è¾‘æ—¶ï¼Œä¸ä»…è¦è€ƒè™‘åˆ°ç®€å•çš„kvæ˜ å°„ï¼Œè¿˜è¦è€ƒè™‘åˆ°å¼‚æ„åŒ–çš„æ•°æ®å€¼ï¼Œå†…éƒ¨åº”è¯¥å¦‚ä½•è§£æã€‚å¦‚æœä»é€šç”¨åŒ–çš„å±‚é¢è€ƒè™‘ï¼Œç”¨mongodbæˆ–è€…eså­˜å‚¨è¡¨æ ¼æ•°æ®æ˜¯ä¸é”™çš„å½¢å¼ï¼Œè¿™æ ·æˆ‘ä»¬åªéœ€è¦ç»„åˆä¸€äº›ç‰¹å®šçš„æ£€ç´¢è§„åˆ™æŸ¥è¯¢â€é”™è´¦â€æ•°æ®å³å¯è¾¾åˆ°æ•°æ®æ£€æŸ¥çš„ç›®çš„ã€‚å½“ç„¶ï¼Œå¦‚æœåœ¨å†…å­˜é‡Œé¢åšæ•°æ®æŸ¥è¯¢ä¹Ÿå¯ä»¥ï¼Œä½†éœ€è¦ä½ çš„ä¸»æœºå…·æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ã€‚</p>
<p>ç„¶åæ¥åˆ°æ£€æŸ¥ä»€ä¹ˆæ•°æ®ã€‚é€šå¸¸ä¸è®ºæ˜¯ç”¨SVNè¿˜æ˜¯ç”¨Gitæ¥å­˜å‚¨é…ç½®æ•°æ®ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥å®æ—¶ç›‘å¬repoçš„å˜åŒ–ï¼Œæ¥å†³å®šéœ€è¦æ£€æŸ¥å“ªäº›è¡¨æ ¼çš„æ•°æ®ã€‚ä»æŒç»­é›†æˆçš„è§’åº¦æ¥è¯´ï¼Œæµç¨‹æ­å»ºèµ·æ¥å¹¶ä¸éš¾ï¼Œä½†éš¾ç‚¹åœ¨äºæ€§èƒ½è·Ÿæ•ˆç‡æ–¹é¢çš„ä¼˜åŒ–ã€‚</p>
<p>å¦‚æœä¸€ä¸ªæ¸¸æˆé¡¹ç›®æ¶‰åŠåˆ°å¤šæ¸ é“å¤šå›½å®¶å‘å¸ƒï¼Œé‚£ä¹ˆå¿…é¡»è¦å¤„ç†å¤šç‰ˆæœ¬å…±å­˜çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åŒä¸€ä¸ªæ—¶é—´çª—å£ï¼Œå¯èƒ½è¦æ£€æŸ¥ä¸åŒåˆ†æ”¯ä¸åŒæäº¤çš„è¡¨æ ¼æ•°æ®ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå°±å¿…é¡»æœ‰ä¸€å¥—æ£€æŸ¥ä»»åŠ¡è°ƒåº¦+æ•°æ®å½’æ¡£çš„æœºåˆ¶ï¼Œä¸è®ºä»€ä¹ˆåˆ†æ”¯æœ‰å˜åŒ–ï¼Œéƒ½å¯ä»¥æœ€ç»ˆæ”¶æ•›åˆ°ä¸€æ¬¡æ£€æŸ¥ä»»åŠ¡ï¼Œä¿è¯æ¯ä¸€æ¬¡æ£€æŸ¥è¿‡ç¨‹éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚åŒæ—¶ï¼Œå·¥å…·å¼€å‘è€…ä¹Ÿéœ€è¦æ ¹æ®è‡ªå·±ä¸»æœºèµ„æºçš„å¤šå°‘ï¼Œå†³å®šä¸€ä¸ªæ—¶é—´çª—å£é‡Œï¼Œæœ‰å¤šå°‘ä»»åŠ¡å¯ä»¥å¹¶è¡Œã€‚è€ƒè™‘äº†è¿™äº›ç‚¹ï¼Œå°±èƒ½è§£å†³å¤šç‰ˆæœ¬å…±å­˜çš„é—®é¢˜ã€‚</p>
<p>ç„¶åæ˜¯æ£€æŸ¥ä»»åŠ¡æœ¬èº«ã€‚å¯¹äºä¸šåŠ¡ï¼Œæœ€ç†æƒ³çš„æƒ…å†µæ˜¯èƒ½å¤Ÿæ¯ä¸€æ¬¡æäº¤é…ç½®æ—¶å€™éƒ½åšä¸€æ¬¡æ£€æŸ¥ï¼Œä½†å¦‚æœæäº¤çš„å†…å®¹å’Œé…ç½®æœ¬èº«æ— å…³ï¼Œæˆ–è€…ä¸åœ¨ä¸šåŠ¡å¸Œæœ›æ£€æŸ¥çš„é…ç½®é‡Œï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿä¸€æ¬¡æ— æ•ˆæ£€æŸ¥ã€‚å› æ­¤ä¸ºäº†æå‡æ•ˆç‡ï¼Œå°±éœ€è¦åšé¢„æ£€æŸ¥ï¼Œçœ‹æäº¤çš„å†…å®¹å’Œè‡ªå·±æ ‡è®°çš„éœ€è¦æ£€æŸ¥çš„å†…å®¹æ˜¯å¦ç›¸å…³ï¼Œå¦‚æœç›¸å…³æ‰åšæ£€æŸ¥ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ç‚¹æ˜¯å˜æ›´çš„é…ç½®æ–‡ä»¶å¯èƒ½åªæœ‰å¾ˆå°ä¸€éƒ¨åˆ†ï¼Œé‚£ä¹ˆå¦‚æœåœ¨æŠ€æœ¯è®¾è®¡æ–¹é¢æ˜¯å…¨é‡ä¸‹è½½æ•°æ®çš„è¯ï¼Œå¯èƒ½ä¸‹è½½æœ¬èº«ä¼šæ¯”åšè§„åˆ™æ£€æŸ¥è´¹æ—¶å¾ˆå¤šã€‚å› æ­¤åœ¨æ•°æ®æ›´æ–°æ–¹é¢ï¼Œå¦‚æœèƒ½åšåˆ°è°ƒåº¦ä¸åŒåˆ†æ”¯çš„repoï¼Œèƒ½å¤Ÿåšåˆ°æŒ‰éœ€æ›´æ–°æ•°æ®ï¼Œé‚£æ•´ä¸ªæ£€æŸ¥è¿‡ç¨‹çš„æ•ˆç‡å°±ä¼šéå¸¸å¿«ã€‚</p>
<p>æ€»ä½“æ¥è¯´ï¼Œé…ç½®è¡¨æµ‹è¯•ä¸“é¡¹æŠ€æœ¯ï¼Œåšå°äº†å¯ä»¥åšæˆæ—¥å¸¸æµ‹è¯•çš„å·¥å…·ï¼Œåšå¤§äº†ä¹Ÿå¯ä»¥æˆä¸ºä¸€ä¸ªåºå¤§çš„å·¥ç¨‹ã€‚å…·ä½“åšå¤šå°‘ï¼Œåšæˆæ€æ ·çš„å½¢å¼ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦è¡¡é‡ä¸šåŠ¡å…·ä½“éœ€æ±‚å¦‚ä½•ï¼Œä»¥åŠäº¤ä»˜æ—¶é—´æ˜¯å¦ç´§å¼ ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>è¡¨æ ¼æ£€æŸ¥</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>æŒç»­é›†æˆ</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬åäº”è¯ï¼šç”¨sync.Onceå®ç°æ‡’åŠ è½½çš„ç”¨æ³•å’Œå‘ç‚¹</title>
    <url>/2023/09/03/gofromzero/15_sync_once/</url>
    <content><![CDATA[<p>åœ¨ä½¿ç”¨Golangåšåç«¯å¼€å‘çš„å·¥ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦å£°æ˜ä¸€äº›ä¸€äº›é…ç½®ç±»æˆ–æœåŠ¡å•ä¾‹ç­‰åœ¨ä¸šåŠ¡é€»è¾‘å±‚é¢è¾ƒä¸ºåº•å±‚çš„å®ä¾‹ã€‚ä¸ºäº†èŠ‚çœå†…å­˜æˆ–æ˜¯å†·å¯åŠ¨å¼€é”€ï¼Œæˆ‘ä»¬é€šå¸¸é‡‡ç”¨lazy-loadæ‡’åŠ è½½çš„æ–¹å¼å»åˆå§‹åŒ–è¿™äº›å®ä¾‹ã€‚åˆå§‹åŒ–å•ä¾‹è¿™ä¸ªè¡Œä¸ºæ˜¯ä¸€ä¸ªéå¸¸ç»å…¸çš„å¹¶å‘å¤„ç†çš„æ¡ˆä¾‹ï¼Œæ¯”å¦‚åœ¨javaå½“ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ç”¨åˆ°å»ºç«‹åŒé‡é”+volatileçš„æ–¹å¼ä¿è¯åˆå§‹åŒ–é€»è¾‘åªè¢«è®¿é—®ä¸€æ¬¡ï¼Œå¹¶ä¸”æ‰€æœ‰çº¿ç¨‹æœ€ç»ˆéƒ½å¯ä»¥è¯»å–åˆ°åˆå§‹åŒ–å®Œæˆçš„å®ä¾‹äº§ç‰©ã€‚è¿™æ®µç»å…¸çš„ä»£ç å¯ä»¥æŒ‰å¦‚ä¸‹çš„æ–¹å¼ç¼–å†™ï¼š</p>
<a id="more"></a>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å‚è€ƒï¼šhttps://blog.csdn.net/qq_27489007/article/details/84966680</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton uniqueSingleton;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == uniqueSingleton) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == uniqueSingleton) &#123;</span><br><span class="line">                    uniqueSingleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> uniqueSingleton;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†åœ¨Golangé‡Œé¢ï¼Œå®ç°æ‡’åŠ è½½çš„æ–¹å¼å¯ä»¥ç®€å•çš„å¤šï¼Œç”¨å†…ç½®çš„sync.Onceå°±èƒ½æ»¡è¶³ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªuserå•ä¾‹ï¼Œéœ€è¦è¢«1000ä¸ªçº¿ç¨‹è¯»å–å¹¶æ‰“å°ï¼Œå°±å¯ä»¥è¿™æ ·å­å†™ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">    Age  <span class="keyword">int</span>    <span class="string">`json:"age"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user *User</span><br><span class="line"><span class="keyword">var</span> userOnce sync.Once</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initUser</span><span class="params">()</span></span> &#123;</span><br><span class="line">    user = &amp;User&#123;&#125;</span><br><span class="line">    cfgStr := <span class="string">`&#123;"name":"foobar","age":18&#125;`</span></span><br><span class="line">    <span class="keyword">if</span> err := json.Unmarshal([]<span class="keyword">byte</span>(cfgStr), user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"load user err: "</span> + err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getUser</span><span class="params">()</span> *<span class="title">User</span></span> &#123;</span><br><span class="line">    userOnce.Do(initUser)</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestSyncOnce</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="number">1000</span>; i++ &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            curUser := getUser()</span><br><span class="line">            t.Logf(<span class="string">"[%d] got user: %+v"</span>, n, curUser)</span><br><span class="line">        &#125;(i)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç é‡Œï¼Œé¦–å…ˆæ˜¯é€šè¿‡<code>var userOnce sync.Once</code>å£°æ˜äº†ä¸€ä¸ª<code>sync.Once</code>å®ä¾‹ï¼Œç„¶ååœ¨<code>getUser</code>å½“ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†<code>userOnce.Do(initUser)</code>è¿™ä¸ªæ“ä½œã€‚å‡è®¾ä¸€ä¸ªgoroutineæœ€å…ˆåˆ°è¾¾è¿™ä¸ªæ“ä½œï¼Œå°±ä¼šä¸Šé”å¹¶æ‰§è¡Œ<code>initUser</code>ï¼Œå…¶å®ƒgoroutineåˆ°è¾¾ä¹‹åï¼Œå¾—ç­‰ç¬¬ä¸€ä¸ªgoroutineæ‰§è¡Œå®Œ<code>initUser</code>ä¹‹åï¼Œæ‰ä¼šç»§ç»­<code>return user</code>ã€‚è¿™æ ·ï¼Œå°±èƒ½ä¸€æ¥ä¿è¯<code>initUser</code>åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼ŒäºŒæ¥æ‰€æœ‰goroutineéƒ½èƒ½å¤Ÿæœ€ç»ˆè¯»åˆ°åˆå§‹åŒ–å®Œæˆçš„userå•ä¾‹ã€‚</p>
<p><code>sync.Once</code>çš„å·¥ä½œæœºç†ä¹Ÿå¾ˆç®€å•ï¼Œé€šè¿‡ä¸€ä¸ªé”å’Œä¸€ä¸ªflagå°±èƒ½å¤Ÿå®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Once)</span> <span class="title">Do</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> atomic.LoadUint32(&amp;o.done) == <span class="number">0</span> &#123; <span class="comment">// å¦‚æœæ˜¯1è¡¨ç¤ºå·²ç»å®Œæˆäº†ï¼Œè·³è¿‡</span></span><br><span class="line">		o.doSlow(f)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Once)</span> <span class="title">doSlow</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">	o.m.Lock() <span class="comment">// åªæœ‰1ä¸ªgoroutineèƒ½æ‹¿åˆ°é”ï¼Œå…¶å®ƒçš„ç­‰å¾…</span></span><br><span class="line">	<span class="keyword">defer</span> o.m.Unlock()</span><br><span class="line">	<span class="keyword">if</span> o.done == <span class="number">0</span> &#123; <span class="comment">// å¦‚æœè¿˜æ˜¯0è¡¨ç¤ºç¬¬ä¸€ä¸ªæ¥çš„ï¼Œä¸æ˜¯0å°±è¡¨ç¤ºå·²ç»æœ‰goroutineåšå®Œäº†</span></span><br><span class="line">		<span class="keyword">defer</span> atomic.StoreUint32(&amp;o.done, <span class="number">1</span>)</span><br><span class="line">		f()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¹Ÿéœ€è¦æ³¨æ„ï¼Œ<code>sync.Once</code>ä½¿ç”¨ä¸Šé¢æœ‰ä¸€ä¸ªå‘ç‚¹ï¼Œä¸èƒ½ä¹Ÿä¸éœ€è¦åƒjavaä¸€æ ·ä¸ºå•ä¾‹æå‰åšnilåˆ¤æ–­ã€‚æ¯”å¦‚ä¸‹é¢ä¸€æ®µä»£ç æ˜¯æœ‰é—®é¢˜çš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">initUser</span><span class="params">()</span></span> &#123;</span><br><span class="line">    user = &amp;User&#123;&#125; <span class="comment">// å…ˆç»™ä¸€ä¸ªzero-valueå®ä¾‹</span></span><br><span class="line">    cfgStr := <span class="string">`&#123;"name":"foobar","age":18&#125;`</span> <span class="comment">// ç„¶ååŠ è½½jsonå†…å®¹ï¼Œå®Œæˆåˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> err := json.Unmarshal([]<span class="keyword">byte</span>(cfgStr), user); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(<span class="string">"load user err: "</span> + err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getUser</span><span class="params">()</span> *<span class="title">User</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> user == <span class="literal">nil</span> &#123;</span><br><span class="line">        userOnce.Do(initUser)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> user</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºGolangæ²¡æœ‰volatileå…³é”®å­—ï¼Œä¸èƒ½æ§åˆ¶å•ä¾‹åœ¨å†…å­˜çš„å¯è§æ€§ï¼Œé‚£ä¹ˆå¤šgoroutineå¹¶å‘æ—¶ï¼Œå°±æœ‰å¯èƒ½å‡ºç°è¿™æ ·çš„æ‰§è¡Œæ—¶åºï¼š</p>
<ul>
<li><code>goroutine-A</code>è¿‡äº†<code>getUser</code>çš„<code>user == nil</code>åˆ¤æ–­ï¼Œè¿›å…¥åˆ°äº†<code>initUser</code>é€»è¾‘ï¼Œèµ°åˆ°äº†<code>cfgStr := XXX</code>ä¸€è¡Œ</li>
<li>æ­¤æ—¶åˆ‡æ¢åˆ°<code>goroutine-B</code>ï¼Œå› ä¸º<code>goroutine-A</code>åœ¨<code>initUser</code>å·²ç»èµ°è¿‡äº†<code>user = &amp;User{}</code>ä¸€è¡Œï¼Œæ‰€ä»¥è·³è¿‡äº†<code>user == nil</code>åˆ¤æ–­ï¼Œç›´æ¥è¿”å›æ²¡æœ‰å®Œå…¨åˆå§‹åŒ–çš„<code>user</code>å®ä¾‹ï¼Œç„¶åä¸€ç›´å¾€ä¸‹è¿è¡Œï¼Œå°±æ²¡åˆ‡å›ç»™<code>goroutine-A</code></li>
</ul>
<p>è¿™æ ·çš„ç»“æœï¼Œå°±å¯¼è‡´æœ‰goroutineæ‹¿åˆ°æœªåˆå§‹åŒ–å®Œæˆçš„å®ä¾‹å¾€åè¿è¡Œï¼Œåé¢å°±å‡ºé—®é¢˜äº†ã€‚æ‰€ä»¥å®æˆ˜å½“ä¸­éœ€è¦ç•™æ„ï¼Œç”¨<code>sync.Once</code>æ—¶ï¼Œä¸èƒ½ä¹Ÿä¸éœ€è¦åŠ è¿™äº›nilåˆ¤æ–­ï¼Œå°±èƒ½æ»¡è¶³æ‡’åŠ è½½å•ä¾‹/é…ç½®ä¹‹ç±»çš„é€»è¾‘ã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>å¹¶å‘</tag>
        <tag>Once</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬åå››è¯ï¼šä½¿ç”¨rateå’Œratelimitå®ç°é™æµé™é€Ÿ</title>
    <url>/2023/08/26/gofromzero/14_ratelimit/</url>
    <content><![CDATA[<p>åœ¨ç ”å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé¢å¯¹åˆ°å¤„ç†å¹¶å‘é€»è¾‘çš„åœºæ™¯ï¼Œå°¤å…¶æ˜¯æœ‰æ—¶å€™åœ¨ä¸ç¬¬ä¸‰æ–¹å¹³å°å¯¹æ¥çš„åœºæ™¯ä¸‹ï¼Œä¼šé‡åˆ°è¯·æ±‚é™æµé™QPSçš„è¦æ±‚ã€‚å¯¹äºé™æµæˆ–è€…é™é€Ÿï¼Œæˆ‘ä»¬é€šå¸¸ä¼šç”¨ä¸¤ç§ç®—æ³•æ¥æ»¡è¶³éœ€è¦ï¼š</p>
<ul>
<li>ä»¤ç‰Œæ¡¶ç®—æ³•ï¼šåœ¨ç‰¹å®šå®¹é‡çš„æ¡¶é‡Œé¢è£…ä»¤ç‰Œï¼Œå½“ä»¤ç‰Œæ•°é‡å°äºæ¡¶çš„å®¹é‡æ—¶ï¼Œä¼šæŒç»­ä»¥æˆ‘ä»¬é¢„æœŸçš„é™æµé€Ÿç‡ç”Ÿäº§ä»¤ç‰Œï¼›ä¸ç®¡æ¡¶é‡Œé¢æ˜¯ä¸æ˜¯ç©ºçš„ï¼Œä¸šåŠ¡éƒ½å¾—ç­‰åˆ°æ‹¿åˆ°ä»¤ç‰Œï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œä¸šåŠ¡é€»è¾‘</li>
<li>æ¼æ¡¶ç®—æ³•ï¼šä¸šåŠ¡å…ˆç»Ÿä¸€è¿›å…¥æ¡¶é‡Œï¼Œæ¡¶æ»¡äº†ä¹‹åï¼Œä¼šä»¥æˆ‘ä»¬é¢„æœŸçš„é™æµé€Ÿç‡ï¼Œä¸€ä¸ªä¸ªæŠŠåœ¨ç­‰å¾…çš„ä¸šåŠ¡æ¼å‡ºå»ï¼Œç„¶åå„ä¸ªä¸šåŠ¡æ‰å¼€å§‹æ‰§è¡Œä¸šåŠ¡é€»è¾‘</li>
</ul>
<p>è¿™ä¸¤ç§ç®—æ³•ï¼Œè™½ç„¶å®é™…QPSæ•°å€¼å¯èƒ½éƒ½ä¼šæœ‰æ³¢åŠ¨ï¼Œä½†éƒ½èƒ½æŠŠé€Ÿç‡é™åˆ¶åœ¨ä¸€ä¸ªåˆç†çš„æ°´ä½ã€‚åœ¨Golangé‡Œé¢ï¼Œè¿™ä¸¤ç§ç®—æ³•éƒ½æœ‰ç°æˆçš„å®ç°å¯ä»¥ç›´æ¥ç”¨ã€‚å’±ä»¬ä»Šå¤©ï¼Œå°±æ¥çœ‹çœ‹è¿™å—çš„ä¾‹å­ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæ¥çœ‹çœ‹ä»¤ç‰Œæ¡¶ç®—æ³•ï¼Œåœ¨Golangè‡ªå¸¦çš„rateåº“ä¸­ï¼Œå°±æœ‰äº†ä¸€ä»½ä»¤ç‰Œæ¡¶ç®—æ³•çš„å®ç°ã€‚æˆ‘ä»¬ä¸Šä¸€ä¸‹ä»£ç çš„ä¾‹å­ï¼Œæ¥çœ‹ä¸€ä¸‹rateåº“çš„åŸºæœ¬ç”¨æ³•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"golang.org/x/time/rate"</span> <span class="comment">// éœ€è¦importçš„rateåº“ï¼Œå…¶å®ƒimportæš‚æ—¶å¿½ç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿæˆ0-&gt;Xçš„æ•°æ®é›†</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">generateData</span><span class="params">(num <span class="keyword">int</span>)</span> []<span class="title">any</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> data []any</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; num; i++ &#123;</span><br><span class="line">        data = <span class="built_in">append</span>(data, i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†æ•°æ®ï¼Œæ•°å­—*10</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(obj any)</span> <span class="params">(any, error)</span></span> &#123;</span><br><span class="line">    integer, ok := obj.(<span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">"invalid integer"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    time.Sleep(<span class="number">1</span>)</span><br><span class="line">    nextInteger := integer * <span class="number">10</span></span><br><span class="line">    <span class="keyword">if</span> integer%<span class="number">99</span> == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> nextInteger, errors.New(<span class="string">"not a happy number"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nextInteger, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRate</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    limit := rate.Limit(<span class="number">50</span>) <span class="comment">// QPSï¼š50</span></span><br><span class="line">    burst := <span class="number">25</span> <span class="comment">// æ¡¶å®¹é‡25</span></span><br><span class="line">    limiter := rate.NewLimiter(limit, burst)</span><br><span class="line">    size := <span class="number">500</span> <span class="comment">// æ•°æ®é‡500</span></span><br><span class="line"></span><br><span class="line">    data := generateData(size)</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    startTime := time.Now()</span><br><span class="line">    <span class="keyword">for</span> i, item := <span class="keyword">range</span> data &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(idx <span class="keyword">int</span>, obj any)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            <span class="comment">// æ‹¿åˆ°ä»¤ç‰Œ</span></span><br><span class="line">            <span class="keyword">if</span> err := limiter.Wait(context.Background()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"[%d] [EXCEPTION] wait err: %v"</span>, idx, err)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">            processed, err := process(obj)</span><br><span class="line">            <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"[%d] [ERROR] processed: %v, err: %v"</span>, idx, processed, err)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"[%d] [OK] processed: %v"</span>, idx, processed)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(i, item)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">    endTime := time.Now()</span><br><span class="line">    t.Logf(<span class="string">"start: %v, end: %v, seconds: %v"</span>, startTime, endTime, endTime.Sub(startTime).Seconds())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>limiter := rate.NewLimiter(limit, burst)</code>çš„å½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªä»¤ç‰Œç”Ÿæˆé€Ÿç‡ä¸ºlimitï¼Œå®¹é‡ä¸ºburstçš„ä»¤ç‰Œæ¡¶ã€‚åœ¨ä¸šåŠ¡é‡Œï¼Œåˆ™é€šè¿‡<code>limiter.Wait(ctx)</code>çš„æ–¹å¼æ‹¿åˆ°ä¸€ä¸ªä»¤ç‰Œï¼Œæ‰§è¡Œé€»è¾‘ã€‚ç»“åˆå…ˆå‰è®²è¿‡çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjMvMDgvMDYvZ29mcm9temVyby8xM193YWl0Z3JvdXAv" title="https://utmhikari.top/2023/08/06/gofromzero/13_waitgroup/">WaitGroup<i class="fa fa-external-link"></i></span>ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®ç°å¼€å¤šä¸ªgoroutineå¼‚æ­¥æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶é…åˆlimiteræ¥åšä¸šåŠ¡é€»è¾‘çš„é™é€Ÿã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä»é•¿çº¿æ¥çœ‹ï¼Œlimitçš„å¤§å°æ˜¯èƒ½å¤Ÿå†³å®šä¸€ä¸ªåŸºç¡€çš„é™é€Ÿé€Ÿç‡ï¼Œä½†ä»çŸ­çº¿è§’åº¦æ¥çœ‹ï¼Œburstè¿™ä¸ªæ¡¶å…·å¤‡äº†ç¼“å†²ä½œç”¨ï¼Œåœ¨å†·å¯åŠ¨æ—¶ï¼Œç”±äºburstçš„å­˜åœ¨ï¼Œåˆå§‹çš„QPSä¼šæ¯”å®é™…é¢„ä¼°çš„è¾ƒå¤§ã€‚å› æ­¤ï¼Œä¸šåŠ¡é€šè¿‡ä»¤ç‰Œæ¡¶æ–¹å¼é™é€Ÿæ—¶ï¼Œå¦‚æœéœ€è¦é™åˆ¶å†·å¯åŠ¨æ—¶çš„ç¬æ—¶é€Ÿç‡ï¼Œéœ€è¦ç•™æ„æŠŠburstçš„å€¼è®¾ç½®å°ä¸€äº›ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å†æ¥çœ‹é€šè¿‡æ¼æ¡¶ç®—æ³•æ¥é™é€Ÿçš„ä¾‹å­ï¼Œè¿™å›éœ€è¦ç”¨åˆ°ä¸€ä¸ªå¼€æºåº“<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ViZXItZ28vcmF0ZWxpbWl0" title="https://github.com/uber-go/ratelimit">uber-go/ratelimit<i class="fa fa-external-link"></i></span>æ¥å®ç°ã€‚ä¾‹å­ä¹Ÿéå¸¸ç®€å•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestRateLimit</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    limiter := ratelimit.New(<span class="number">50</span>) <span class="comment">// æ¼æ¡¶é€Ÿç‡50</span></span><br><span class="line">    size := <span class="number">500</span></span><br><span class="line"></span><br><span class="line">    data := generateData(size)</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    startTime := time.Now()</span><br><span class="line">    <span class="keyword">for</span> i, item := <span class="keyword">range</span> data &#123;</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(idx <span class="keyword">int</span>, obj any)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            limiter.Take() <span class="comment">// å…¥æ¡¶å¾…æ¼</span></span><br><span class="line">            processed, err := process(obj)</span><br><span class="line">            <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"[%d] [ERROR] processed: %v, err: %v"</span>, idx, processed, err)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"[%d] [OK] processed: %v"</span>, idx, processed)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(i, item)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">    endTime := time.Now()</span><br><span class="line">    t.Logf(<span class="string">"start: %v, end: %v, seconds: %v"</span>, startTime, endTime, endTime.Sub(startTime).Seconds())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ratelimit</code>åº“é€Ÿç‡çš„å•ä½å¯ä»¥ç±»æ¯”ä¸ºQPSï¼Œé€šè¿‡<code>ratelimit.New</code>ï¼Œå¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªæŒ‡å®šQPSé™åˆ¶çš„é™æµå™¨ã€‚æ‰§è¡Œä¸šåŠ¡é€»è¾‘å‰ï¼Œéœ€è¦é€šè¿‡<code>limiter.Take()</code>é€»è¾‘ç­‰å¾…æ¼å‡ºæ¥åï¼Œæ‰èƒ½æ‰§è¡Œåç»­çš„é€»è¾‘ã€‚è¿™æ ·ä¾¿å®ç°äº†é™æµçš„æ•ˆæœã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>é™é€Ÿ</tag>
        <tag>é™æµ</tag>
        <tag>ä»¤ç‰Œæ¡¶ç®—æ³•</tag>
        <tag>æ¼æ¡¶ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬åä¸‰è¯ï¼šä½¿ç”¨WaitGroupç­‰å¾…å¤šè·¯å¹¶è¡Œçš„å¼‚æ­¥ä»»åŠ¡</title>
    <url>/2023/08/06/gofromzero/13_waitgroup/</url>
    <content><![CDATA[<p>åœ¨åç«¯å¼€å‘å½“ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼šè¯·æ±‚ç»™äº†æ‰¹é‡çš„è¾“å…¥ï¼Œå¯¹äºæ¯ä¸€ä¸ªè¾“å…¥ï¼Œæˆ‘ä»¬éƒ½è¦ç»™å¤–éƒ¨å‘è¯·æ±‚ç­‰å¾…è¿”å›ï¼Œç„¶åæ‰èƒ½ç»§ç»­å…¶å®ƒè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘ã€‚åœ¨è¿™æ ·çš„caseä¸‹ï¼Œå¦‚æœæ¯ä¸€ä¸ªè¾“å…¥ä¸²è¡Œå¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå¾ˆå¤§ä¸€éƒ¨åˆ†æ—¶é—´éƒ½ä¼šæŸè€—åœ¨ç»™å¤–éƒ¨å‘è¯·æ±‚è¿™ä¸ªç¯èŠ‚ï¼Œå› æ­¤æˆ‘ä»¬ä¼šå¸Œæœ›æŠŠè¿™äº›è¯·æ±‚æ”¾åˆ°å„ä¸ªgoroutineé‡Œå¼‚æ­¥æ‰§è¡Œï¼Œç­‰å¾…æ‰¹é‡æ‰§è¡Œå®Œæˆä¹‹åå†ç»§ç»­åé¢çš„é€»è¾‘ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨åˆ°è¿™ä¸ªä¸œè¥¿ï¼šsync.WaitGroup</p>
<p>WaitGroupæä¾›äº†å¢å‡è®¡æ•°ä»¥åŠé˜»å¡ç­‰å¾…è®¡æ•°å½’é›¶çš„çº¿ç¨‹å®‰å…¨æ¥å£ã€‚å½“ä¸»goroutineå¢åŠ è®¡æ•°å¹¶ç­‰å¾…çš„æ—¶å€™ï¼Œå­goroutineçš„é€»è¾‘ä¸­è‹¥å¼•ç”¨äº†ä¸€ä¸ªWaitGroupå®ä¾‹çš„è¯ï¼Œä¹Ÿå¯ä»¥åœ¨ç»“æŸï¼ˆdeferï¼‰çš„æ—¶å€™å»å‡å°‘è®¡æ•°ï¼Œè¿™æ ·å½“ä¸»goroutineè‡ªæ—‹ç­‰å¾…è®¡æ•°å½’é›¶æ—¶ï¼Œç­‰å¾…çš„é€»è¾‘å°±è¿”å›äº†ï¼Œå°±ç»§ç»­åé¢çš„å†…å®¹ã€‚æ•´ä½“ä¸Šï¼Œå°±è¾¾åˆ°äº†ç­‰å¾…å¤šè·¯å¹¶è¡Œçš„å¼‚æ­¥ä»»åŠ¡è¿™ä¸€æ•ˆæœã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„ä»£ç æ¡ˆä¾‹å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestWaitGroup</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line">    startTime := time.Now()</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">        n := i + <span class="number">1</span></span><br><span class="line">        sleepTime := time.Duration(n) * time.Second</span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line"></span><br><span class="line">            t.Logf(<span class="string">"task %d started"</span>, n)</span><br><span class="line">            time.Sleep(sleepTime)</span><br><span class="line">            t.Logf(<span class="string">"task %d ended"</span>, n)</span><br><span class="line">        &#125;()</span><br><span class="line">    &#125;</span><br><span class="line">    t.Logf(<span class="string">"waiting for all tasks done..."</span>)</span><br><span class="line">    wg.Wait()</span><br><span class="line">    endTime := time.Now()</span><br><span class="line">    t.Logf(<span class="string">"all tasks done! elapsed time: %v"</span>, endTime.Sub(startTime))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªé€»è¾‘å¾ˆç®€å•ï¼Œæˆ‘ä»¬èµ·äº†5ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡åˆ†åˆ«sleepä¸Š1åˆ°5ç§’ã€‚ä¸»goroutineæ­¤æ—¶åœ¨æ¯ä¸ªä»»åŠ¡å¼€å§‹å‰ï¼Œç»™WaitGroupå®ä¾‹wgåŠ ä¸Š1ä¸ªè®¡æ•°ï¼Œè€Œåœ¨å­goroutineé‡Œï¼Œdeferåœ°è°ƒç”¨wg.Doneå‡å°‘è®¡æ•°ã€‚ä¸»goroutineèµ·å®Œä»»åŠ¡ä¹‹åï¼Œç›´æ¥è°ƒç”¨wg.Waitè‡ªé€‰ç­‰å¾…ã€‚è¿™æ ·5såç­‰æ‰€æœ‰ä»»åŠ¡Doneï¼Œä¸»goroutineå°±ä¼šæ¥ä¸‹æ¥æ‰“å°æ¶ˆè€—æ—¶é—´çš„æ—¥å¿—ä¿¡æ¯äº†ã€‚</p>
<p>æ‰“å°çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">=== RUN   TestWaitGroup</span><br><span class="line">    wg_test.go:26: waiting for all tasks done...</span><br><span class="line">    wg_test.go:21: task 5 started</span><br><span class="line">    wg_test.go:21: task 1 started</span><br><span class="line">    wg_test.go:21: task 2 started</span><br><span class="line">    wg_test.go:21: task 3 started</span><br><span class="line">    wg_test.go:21: task 4 started</span><br><span class="line">    wg_test.go:23: task 1 ended</span><br><span class="line">    wg_test.go:23: task 2 ended</span><br><span class="line">    wg_test.go:23: task 3 ended</span><br><span class="line">    wg_test.go:23: task 4 ended</span><br><span class="line">    wg_test.go:23: task 5 ended</span><br><span class="line">    wg_test.go:29: all tasks done! elapsed time: 5.0015089s</span><br><span class="line">--- PASS: TestWaitGroup (5.00s)</span><br><span class="line">PASS</span><br></pre></td></tr></table></figure>
<p>WaitGroupçš„ç”¨æ³•éå¸¸ç®€å•ï¼Œä½†è¿™é‡Œæ³¨æ„çš„æ˜¯ï¼Œå®é™…é‡åˆ°è¿™ç§ç¼–ç¨‹åœºæ™¯ï¼Œä¸€èˆ¬ä¼šæ¶‰åŠåˆ°å¤šä»»åŠ¡è¿è¡Œç»“æœæ”¶é›†è¿˜æœ‰ç¨‹åºå¼‚å¸¸å¤„ç†ç›¸å…³çš„å†…å®¹ã€‚å› æ­¤ï¼Œåƒrecoveræˆ–è€…selectè¶…æ—¶ç­‰ä¸€äº›å­goroutineä»»åŠ¡å¼‚å¸¸å¤„ç†çš„é€»è¾‘ï¼Œå¯èƒ½è§†å®é™…æƒ…å†µéƒ½å¾—é…åˆåŠ ä¸Šã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>å¼‚æ­¥</tag>
        <tag>Golang</tag>
        <tag>å¹¶è¡Œ</tag>
        <tag>WaitGroup</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ‰¹é‡åˆ·æ•°çš„å‘å¸ƒæµç¨‹ä¸é£é™©ç‚¹</title>
    <url>/2023/07/09/testlife/data_wash_risk/</url>
    <content><![CDATA[<p>åœ¨é¡¹ç›®æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ‰¹é‡åˆ·æ•°ä¹Ÿæ˜¯æœ‰ä¸€å®šé¢‘ç‡çš„å˜æ›´åœºæ™¯ä¹‹ä¸€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å®¹æ˜“äº§ç”Ÿé£é™©çš„ä¸€ç§å˜æ›´æ“ä½œã€‚æœ¬æ–‡å°±æ¥èŠä¸‹ï¼Œæ‰¹é‡åˆ·æ•°çš„å‘å¸ƒéœ€è¦ç»å†å“ªäº›æµç¨‹ï¼Œä»¥åŠæµç¨‹ä¸­æ¯ä¸ªç¯èŠ‚ä¸­æœ‰ä»€ä¹ˆé£é™©ç‚¹éœ€è¦è€ƒè™‘ã€‚</p>
<p>é¦–å…ˆéœ€è¦äº†è§£æ‰¹é‡åˆ·æ•°è¿™ä¸ªæ“ä½œæ˜¯ä¸ªä»€ä¹ˆæ„ä¹‰ã€‚æ— è®ºæ˜¯æ–°å¢/åˆ é™¤ä¸€äº›æ•°æ®ä¹Ÿå¥½ï¼Œè¿˜æ˜¯UPDATEæŸäº›å·²æœ‰çº¿ä¸Šæ•°æ®ä¹Ÿå¥½ï¼Œå…¶èƒŒåè¦ä¹ˆå¯¹åº”ç€ä¸€ä¸ªæ–°ä¸šåŠ¡å¼€å‘ï¼Œè¦ä¹ˆå¯¹åº”ç€ä¸€ä¸ªbugfixã€‚å› æ­¤ï¼Œæ‰¹é‡åˆ·æ•°çš„æœ¬è´¨å…¶å®å°±æ˜¯ä¸€ä¸ªä¸šåŠ¡éœ€æ±‚ï¼Œéœ€è¦æœ‰å®Œæ•´çš„ä¸€å¥—éœ€æ±‚è¯„å®¡ -&gt; æŠ€æœ¯è¯„å®¡ -&gt; çº¿ä¸‹æµ‹è¯• -&gt; çº¿ä¸Šå‘å¸ƒ -&gt; å‘å¸ƒéªŒè¯çš„è¿‡ç¨‹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªç¯èŠ‚æ˜¯éœ€æ±‚è¯„å®¡ã€‚éœ€æ±‚è¯„å®¡çš„ä¸»è¦çš„ç›®çš„ï¼Œä¸€æ˜¯ä¸ºäº†åšåˆ·æ•°çš„å¯è¡Œæ€§è¯„ä¼°ï¼ŒäºŒæ˜¯åšåˆ·æ•°è®°å½•å½’æ¡£ã€‚</p>
<a id="more"></a>
<p>ç”±äºåˆ·æ•°çš„æ—¶é—´é•¿&amp;éš¾ä»¥å›æ»šçš„ç‰¹æ€§ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œä¿®å¤é—®é¢˜æˆ–æ˜¯å¼€å‘æ–°éœ€æ±‚ï¼Œä¸€èˆ¬æ˜¯ä¸éœ€è¦åˆ·æ•°æ“ä½œçš„ã€‚å¦‚æœéœ€è¦åšåˆ·æ•°æ“ä½œï¼Œé‚£ä¹ˆå°±éœ€è¦æä¾›éœ€æ±‚èƒŒæ™¯ä¿¡æ¯ï¼Œä»¥åŠä¸ºä»€ä¹ˆä¸€å®šéœ€è¦åˆ·æ•°æ“ä½œæ¥è¾¾åˆ°éœ€æ±‚ç›®çš„ï¼Œè¿™æ ·ï¼Œä»PMå’ŒTLè§’åº¦ï¼Œå¯ä»¥åˆæ­¥è¯„ä¼°åˆ·æ•°çš„å¿…è¦æ€§ï¼Œä»¥åŠæ˜¯å¦æœ‰æ›´å¥½çš„workaroundã€‚å¦‚æœéœ€è¦åšåˆ·æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªéœ€æ±‚å°±å¯ä»¥è¢«å½’æ¡£åˆ°ç‰¹å®šçš„ä¸šåŠ¡æ¨¡å—é‡Œï¼Œä»¥æ–¹ä¾¿åšè¿›åº¦è·Ÿè¸ªå’Œæ–¹æ¡ˆå›æº¯ã€‚æ›´ç”šè€…ï¼Œå¦‚æœéœ€æ±‚ç®¡ç†å¹³å°è‡ªå¸¦æµç¨‹ç®¡ç†å’Œå®¡æ‰¹åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œè®¸å¤šreviewè·Ÿå®¡æ‰¹æ“ä½œéƒ½å¯ä»¥ç»Ÿä¸€æ”¶æ•›åˆ°éœ€æ±‚ç®¡ç†å¹³å°å½“ä¸­ï¼Œè¿™ä¹Ÿæ˜¯ç¬¦åˆä¸šåŠ¡ä¹ æƒ¯çš„ä¸€ç§è½åœ°æ–¹å¼ã€‚</p>
<p>ä¹‹åç¬¬äºŒä¸ªç¯èŠ‚ä¾¿æ˜¯æŠ€æœ¯è¯„å®¡ã€‚æŠ€æœ¯è¯„å®¡æ˜¯æ•´ä¸ªæ‰¹é‡åˆ·æ•°è¿‡ç¨‹ä¸­æœ€ä¸ºé‡è¦çš„ä¸€ç¯ï¼Œå› ä¸ºåœ¨è¿™ä¸€é˜¶æ®µï¼Œå°±å¿…é¡»è€ƒè™‘åˆ°æ•´ä¸ªåˆ·æ•°è¿‡ç¨‹éœ€è¦å¦‚ä½•æ“ä½œï¼Œä¸Šçº¿åˆ†æ€æ ·çš„æ­¥éª¤ï¼Œä»¥åŠå‡ºç°é—®é¢˜å¦‚ä½•æ­¢æŸï¼Œåˆ·æ•°æ­£ç¡®æ€§å¦‚ä½•éªŒè¯ã€‚å°±è§„é¿é£é™©è€Œè¨€ï¼Œå…·ä½“æœ‰éœ€è¦è€ƒé‡ä»¥ä¸‹ç‚¹ï¼š</p>
<ul>
<li>ä¸Šä¸‹æ¸¸å…³ç³»ï¼šå˜æ¸…åˆ·æ•°DB/æœåŠ¡æ¶‰åŠçš„ä¸Šä¸‹æ¸¸ä¸šåŠ¡é“¾è·¯ï¼Œå°¤å…¶ç•™æ„åˆ·æ•°æ“ä½œè§¦å‘ä¸‹æ¸¸æ•°æ®åŒæ­¥/æ¶ˆè´¹ä»»åŠ¡çš„åœºæ™¯æ—¶ï¼Œå¼•å‘è¿‡é«˜å¹¶å‘/QPSçš„é—®é¢˜ã€‚é™¤äº†ç¡®è®¤ä¸Šä¸‹æ¸¸é“¾è·¯çš„å®Œæ•´æ€§è·Ÿåˆç†æ€§å¤–ï¼Œè¿˜éœ€è¦é€šè¿‡å†å²è¿è¡Œæ•°æ®ï¼Œä¼°ç®—ä¸€ä¸ªåˆç†çš„å¹¶å‘åº¦ã€‚</li>
<li>SQLå½±å“é¢ï¼šDMLåœºæ™¯ä¸‹éœ€è¦æœ‰EXPLAINåˆ†æå½±å“è¡Œæ•°/å‘½ä¸­ç´¢å¼•æƒ…å†µï¼ŒDDLåœºæ™¯ä¸‹ç•™æ„ä¸»ä»åŒæ­¥å»¶è¿Ÿç»™ä¸šåŠ¡å¸¦æ¥çš„å½±å“ã€‚å¿…è¦æ—¶ï¼Œæ‹‰DBAåšæ€§èƒ½è·Ÿé£é™©è¯„ä¼°ã€‚</li>
<li>ç»“æœéªŒè¯ï¼šåœ¨ä¸šåŠ¡å±‚é¢ï¼Œéœ€è¦å¦‚ä½•éªŒè¯åˆ·æ•°çš„æ•ˆæœï¼Œéœ€è¦å‘¨çŸ¥å“ªäº›è´Ÿè´£äººï¼Œå¦‚ä½•ç¡®è®¤æ•°æ®æœ‰æ•ˆæ€§ã€‚è¿™é‡Œå°¤å…¶å»ºè®®ï¼Œæµ‹è¯•/å¯¹è´¦æ–¹æ¡ˆçš„è¯„ä¼°è¿‡ç¨‹ï¼Œä»¥åŠå®é™…ä¸Šçº¿/åˆ·æ•°åéªŒè¯çš„è¿‡ç¨‹ï¼Œå¼ºåˆ¶QAä»‹å…¥ï¼Œé˜²æ­¢äº§ç”Ÿä¸šåŠ¡è´¨é‡é£é™©ã€‚</li>
<li>æ“ä½œæ‰‹æ³•ï¼šåˆ·æ•°æ˜¯ä¸€æ¬¡æ€§æ“ä½œè¿˜æ˜¯åˆ†æ‰¹æ“ä½œï¼Œé€‰å–çš„caseè¦†ç›–å“ªäº›ï¼Œåˆ†æ‰¹å’Œè§‚å¯Ÿçš„èŠ‚å¥å¦‚ä½•ï¼Œå¦‚ä½•éªŒè¯åˆ·æ•°çš„æ­£ç¡®æ€§</li>
<li>è¿‡ç¨‹ç›‘æ§ï¼šåˆ·æ•°æœŸé—´ï¼Œéœ€è¦å…³æ³¨å“ªäº›ä¸šåŠ¡å’Œæ€§èƒ½ç›‘æ§æŒ‡æ ‡ï¼Œç›‘æ§å‘Šè­¦éœ€è¦çŸ¥ä¼šåˆ°è°ï¼Œçº§åˆ«å¦‚ä½•</li>
<li>å›æ»šæ­¢æŸï¼šå¦‚æœåˆ·æ•°æ“ä½œä¸ç¬¦åˆé¢„æœŸï¼Œæ€æ ·å¿«é€Ÿå›æ»šï¼Œé¿å…å‡ºé”™åå› ä¸ºç¼ºå¤±å›æ»šæ–¹æ¡ˆå¯¼è‡´äºŒæ¬¡çŠ¯é”™é£é™©</li>
</ul>
<p>æŠ€æœ¯è¯„å®¡ä¹‹åæ˜¯çº¿ä¸‹æµ‹è¯•ã€‚çº¿ä¸‹æµ‹è¯•æœ€åŸºç¡€çš„ä¿éšœæ˜¯ä¸šåŠ¡åŠŸèƒ½æ­£å¸¸ï¼Œä½†è¿™é‡Œæœ‰ä¸€ä¸ªé£é™©æ˜¯ï¼Œçº¿ä¸Šåˆ·æ•°çš„é‡ï¼Œç›¸å¯¹äºçº¿ä¸‹æµ‹è¯•çš„é‡ï¼Œå®é™…æ˜¯å¤šå¾—å¤šçš„ã€‚åƒæ˜¯SQLæœªå‘½ä¸­ç´¢å¼•ã€ä»¥åŠä¸‹æ¸¸MQå †ç§¯æ¶ˆè´¹ä¹‹ç±»çš„æ“ä½œï¼Œåœ¨çº¿ä¸‹æµ‹è¯•æ—¶æœŸï¼Œå¤§æ¦‚ç‡æ²¡æœ‰åŠæ³•æš´éœ²å‡ºæ¥ã€‚è€Œè€ƒè™‘åˆ°åˆ·æ•°éœ€æ±‚çš„ç´§æ€¥ç¨‹åº¦ï¼Œä¸€èˆ¬ä¹Ÿå¾ˆéš¾ç´§æ€¥æ„é€ å¾ˆé‡é‡çº§çš„æ•°æ®è·Ÿä¸Šä¸‹æ–‡æ¥è¿˜åŸçº¿ä¸Šåœºæ™¯ã€‚å› æ­¤ä¸šåŠ¡å±‚é¢ï¼Œè§„é¿è¿™ç±»é£é™©çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œåœ¨æŠ€æœ¯è¯„å®¡ç¯èŠ‚å»è¯„ä¼°å“ªäº›é—®é¢˜æ˜¯å°æ•°æ®é‡æµ‹è¯•æ—¶æ— æ³•æš´éœ²çš„ï¼Œå¹¶åœ¨çº¿ä¸‹æµ‹è¯•ç¯èŠ‚ä¸­ç»™äºˆä¸€ä¸ªå¤æŸ¥checklistå…œåº•ã€‚</p>
<p>çº¿ä¸‹æµ‹è¯•å®Œæ¯•ä¹‹åï¼Œå°±åˆ°äº†çº¿ä¸Šå‘å¸ƒç¯èŠ‚ï¼Œè¿™å…¶ä¸­æœ‰å‡ ç‚¹éœ€è¦è€ƒè™‘ã€‚é¦–å…ˆæ˜¯é€‰æ‹©å‘å¸ƒçš„æ—¶æ®µï¼Œä¸€èˆ¬è€Œè¨€éœ€è¦åœ¨ä¸Šä¸‹æ¸¸ä¸šåŠ¡çš„éé«˜å³°æœŸå‘å¸ƒï¼Œä»¥åŠéèŠ‚å‡æ—¥å‘å¸ƒï¼Œä¼šæ¯”è¾ƒä¿é™©ã€‚å…¶æ¬¡æ˜¯å‘å¸ƒçš„ä¸Šçº¿å®¡æ‰¹ç¯èŠ‚ï¼Œé™¤äº†é€‰å®šåˆé€‚çš„å®¡æ‰¹äººæ“ä½œå¤–ï¼Œæ“ä½œçš„ä¿¡æ¯ä»¥åŠåç»­å‘å¸ƒè¿‡ç¨‹çš„ä¿¡æ¯ï¼Œéœ€è¦å‘¨çŸ¥åˆ°ä¸Šä¸‹æ¸¸å…³è”äººã€‚ä¹‹åæ˜¯å‘å¸ƒçš„èŠ‚å¥ï¼Œä¸€èˆ¬é‡‡å–åˆ†æ‰¹æ¬¡å‘å¸ƒçš„æ–¹å¼ï¼Œæ¯”å¦‚å…ˆæŒ‰ä¸šåŠ¡ç”¨ä¾‹æœ€å°é›†åˆ·10ä¸ªä»¥å†…çš„æ•°æ®é‡ï¼Œç„¶ååˆ·20%å·¦å³ï¼Œæœ€ååˆ·å‰©ä¸‹80%ã€‚åˆ†æ‰¹å‘å¸ƒè¿‡ç¨‹ä¸­ï¼Œéœ€è¦æœ‰è¶³å¤Ÿçš„è§‚å¯Ÿæ—¶é—´ï¼Œé˜²æ­¢å‘å¸ƒè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸ä½†æ¥ä¸åŠå›æ»šã€‚</p>
<p>çº¿ä¸Šå‘å¸ƒçš„é£é™©ï¼Œé™¤äº†æ¥æºäºæ–¹æ¡ˆè®¾è®¡å±‚é¢ï¼Œæ“ä½œå±‚é¢çš„é£é™©ä¹Ÿä¸å¯é¿å…ã€‚å¦‚æœæ•°æ®é‡å¤§ï¼Œåˆ·æ•°å¹¶å‘QPSè¿‡é«˜ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“å¼•å‘ä¸‹æ¸¸çš„é—®é¢˜ã€‚å› æ­¤å»ºè®®æ¯ä¸€æ‰¹æ¬¡å‘å¸ƒæ“ä½œå®é™…å‘èµ·æ—¶ï¼Œæœ‰å¦ä¸€äººçŸ¥ä¼šæˆ–è€…reviewæ“ä½œç»†èŠ‚ã€‚å¦‚æœå‡ºç°ä¸ç¬¦åˆæŠ€æœ¯æ–¹æ¡ˆçš„æ“ä½œï¼Œä¹Ÿå¯ä»¥åŠæ—¶é˜»æ­¢ã€‚åŒæ—¶ï¼Œå‘å¸ƒè¿‡ç¨‹ä¸­çš„ä¸šåŠ¡/æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼Œä¸Šä¸‹æ¸¸/DBAè´Ÿè´£äººä¹Ÿæœ‰ä¹‰åŠ¡ä¸€èµ·å…³æ³¨ï¼Œè¦å…³æ³¨çš„ä¿¡æ¯ç‚¹ï¼Œä¹Ÿéœ€è¦åœ¨å‘å¸ƒå‰çš„æ–¹æ¡ˆé‡Œï¼Œåšå¥½è¯¦ç»†åˆ†å·¥ã€‚</p>
<p>çº¿ä¸Šå‘å¸ƒè¿‡åï¼Œå°±æ˜¯æœ€ç»ˆçš„æµ‹è¯•éªŒè¯è·Ÿå¯¹è´¦äº†ã€‚è¿™é‡Œå°¤å…¶æ³¨æ„çš„æ˜¯ï¼ŒéªŒè¯å’Œå¯¹è´¦æ“ä½œï¼Œåœ¨å°æ‰¹æ¬¡å‘å¸ƒçš„æ—¶å€™ï¼Œå°±å¯ä»¥è¿›è¡Œæ“ä½œï¼Œæˆ–è€…æ˜¯åšæˆå®æ—¶åŒ–å·¡æ£€çš„å½¢å¼ï¼Œä¾¿äºåŠæ—¶éªŒè¯å‘å¸ƒå¯é æ€§ï¼Œä¹Ÿèƒ½å¤Ÿæ»¡è¶³æŸäº›å®šæ—¶åˆ·æ•°ä»»åŠ¡çš„éœ€æ±‚ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œåˆ·æ•°æ“ä½œï¼Œä»éœ€æ±‚æå‡ºåˆ°å‘å¸ƒå®Œæˆï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯éå¸¸ç´§å‡‘è·Ÿç´§å¼ çš„ã€‚ä½†æœ€é‡è¦çš„ä¸€ç‚¹ï¼Œè¿˜æ˜¯å¾—ä¿è¯åˆ·æ•°çš„ç¨³å®šæ€§ï¼Œå³ä¾¿å¯èƒ½ä¼šæœ‰æ—¶é—´å±‚é¢çš„æŸå¤±ã€‚æ²‰æ·€ä¸€å¥—åˆ·æ•°æµç¨‹SOPï¼Œå½’çº³å¯èƒ½çš„é£é™©ç‚¹è·Ÿå¤„ç†æ–¹æ¡ˆï¼Œèƒ½å¤Ÿæœ‰æ•ˆæå‡åˆ·æ•°æ“ä½œçš„è§„èŒƒæ€§è·Ÿç¨³å®šæ€§ã€‚ä»¥åˆ·æ•°æµç¨‹ä¸ºæŒ‡å¯¼ï¼ŒåŒæ ·ä¹Ÿèƒ½ä¿è¯å‘å¸ƒçš„æ•ˆç‡ï¼Œä¹Ÿèƒ½è§„é¿åˆ°ä¸­é€”å‡ºç°æ„å¤–çš„æƒ…å†µä¸‹ï¼Œä¸çŸ¥å¦‚ä½•å¤„ç†ï¼Œå¯¼è‡´å‘å¸ƒè„æ•°æ®æˆ–è€…æ›´å¤§çš„äº‹æ•…å½±å“ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>DevOps</tag>
        <tag>æŒç»­é›†æˆ</tag>
        <tag>æ•°æ®å˜æ›´</tag>
        <tag>æ‰¹é‡åˆ·æ•°</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘SQLå˜æ›´çš„é—®é¢˜æ‹¦æˆªæ‰‹æ®µ</title>
    <url>/2023/07/08/testlife/sql_change_block/</url>
    <content><![CDATA[<p>åœ¨DBåšå˜æ›´å‘å¸ƒçš„å„ç±»åœºæ™¯å½“ä¸­ï¼Œé€šè¿‡SQLæ›´æ”¹DBæ•°æ®å†…å®¹ï¼Œæ˜¯æœ€ä¸ºå¸¸è§çš„åœºæ™¯ã€‚æ—¢ç„¶æ˜¯æœ€ä¸ºå¸¸è§çš„åœºæ™¯ï¼Œé‚£ä¹ˆå¯èƒ½äº§ç”Ÿçº¿ä¸Šé—®é¢˜çš„æ¦‚ç‡ä¹Ÿå°±è¶Šå¤§ã€‚æœ¬ç¯‡æ–‡ç« å°±æ¥æ¢è®¨ä¸€ä¸‹ï¼Œè¦å°½é‡å‡å°‘SQLå‘å¸ƒäº§ç”Ÿçº¿ä¸Šé—®é¢˜çš„å¯èƒ½æ€§ï¼Œéœ€è¦é‡‡å–ä»€ä¹ˆæ ·çš„æ‰‹æ®µã€‚</p>
<p>é¦–å…ˆæ˜¯é’ˆå¯¹SQLè¯­å¥æœ¬èº«è€Œè¨€ï¼Œéœ€è¦åšç§¯ç´¯æ£€æŸ¥ã€‚å‡è®¾ç”¨çš„æ˜¯MySQLï¼Œé‚£ä¹ˆSQLç±»å‹å¤§ä½“å¯èƒ½åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>æ–°å¢ç±»ï¼šCREATEè¡¨/åˆ—/ç´¢å¼•ã€INSERTæ•°æ®</li>
<li>æ›´æ”¹ç±»ï¼šUPDATEæ•°æ®</li>
<li>åˆ é™¤ç±»ï¼šDELETEæ•°æ®ã€DROPè¡¨/åˆ—/ç´¢å¼•ï¼ˆåŒ…å«æ›¿æ¢åœºæ™¯ï¼‰ã€TRUNCATE</li>
</ul>
<p>é’ˆå¯¹è¿™äº›SQLç±»å‹ï¼Œå…¶äº§ç”Ÿçº¿ä¸Šé£é™©çš„æ¦‚ç‡ä¹Ÿä¸å°½ç›¸åŒï¼Œéœ€è¦åˆ†åˆ«è¿›è¡Œæ²»ç†ã€‚</p>
<a id="more"></a>
<p>é’ˆå¯¹åˆ é™¤ç±»SQLï¼Œæœ¬èº«å°±éœ€è¦ç›´æ¥æ‹¦æˆªå‘Šè­¦ã€‚ä»å˜æ›´ç®¡æ§çš„è§†è§’ï¼Œåˆ é™¤ç±»çš„å˜æ›´å»ºè®®éœ€è¦äºŒæ¬¡ç¡®è®¤ç›®çš„ä»¥åŠå›æ»šçš„æ–¹å¼ã€‚é’ˆå¯¹DELETEæ•°æ®çš„æ“ä½œä¸€èˆ¬ä¸æ¨èï¼Œä»ä¸šåŠ¡è§†è§’æ¥çœ‹ï¼Œé€šè¿‡è½¯åˆ é™¤çš„æ–¹å¼ä¸€èˆ¬ç›¸å¯¹æ›´åŠ åˆç†ï¼Œä¸€æ¥å›æ»šæ–¹ä¾¿ï¼ŒäºŒæ¥ä¸ä¼šç ´åè‡ªå¢ä¸»é”®çš„è¿ç»­æ€§ï¼›é’ˆå¯¹DROPç±»ï¼Œéœ€è¦ç¡®è®¤åˆ é™¤çš„è¡¨ã€åˆ—ã€ç´¢å¼•æ˜¯å¦åœ¨ç”¨ï¼Œæ˜¯å¦æœ‰ä¸Šä¸‹çº§ä¾èµ–ã€‚å¦‚æœå­˜åœ¨çš„è¯ï¼Œéœ€è¦ç¡®è®¤ä¾èµ–æ˜¯å¦åœ¨ç”¨ï¼Œé˜²æ­¢ä¸šåŠ¡é€»è¾‘ä¸å¯ç”¨çš„æƒ…å†µã€‚</p>
<p>é’ˆå¯¹UPDATEç±»æ“ä½œï¼Œç”±äºå®¹æ˜“å›æ»šï¼Œå»ºè®®äºŒæ¬¡ç¡®è®¤å›æ»šSQLã€‚æ­¤å¤–ï¼ŒUPDATEçš„æ‰«æè¡Œæ•°å’Œå½±å“è¡Œæ•°ä¸å®œè¿‡é•¿ï¼Œé€šè¿‡EXPLAINçš„æ–¹å¼ï¼Œå¯ä»¥ç›´åˆ°UPDATEæ“ä½œå…·ä½“ç”¨åˆ°äº†å“ªä¸ªç´¢å¼•ï¼Œæ‰«æè¡Œæ•°å’Œå½±å“è¡Œæ•°æ˜¯å¤šå°‘ã€‚å¦‚æœæ‰«æè¡Œæ•°/å½±å“è¡Œæ•°è¿‡é«˜ï¼ŒåŠ¿å¿…ä¼šå¼•èµ·æ…¢æŸ¥è¯¢çš„é—®é¢˜ï¼›è€Œå¦‚æœæ›´æ–°é‡çº§ä¸é«˜çš„æƒ…å†µä¸‹ï¼Œå½±å“è¡Œæ•°æ¯”æ‰«æè¡Œæ•°ä½å¾ˆå¤šï¼Œä¹Ÿéœ€è¦ç¡®è®¤ä¸‹æ˜¯å¦æœ‰è¯¯åœˆé€‰æ•°æ®çš„é—®é¢˜ã€‚é’ˆå¯¹åè€…ï¼Œå¦‚æœDBé›†ç¾¤æ˜¯masterå†™slaveè¯»çš„æƒ…å†µä¸‹ï¼Œå»ºè®®å…ˆSELECTåœˆé€‰å‡ºæ•°æ®ï¼Œç»Ÿè®¡ä¸»é”®ï¼Œå†ä¾ç…§ä¸»é”®åšæ­£å¼UPDATEå‘å¸ƒã€‚</p>
<p>é’ˆå¯¹CREATE/INSERTç±»æ“ä½œï¼Œè¿™ç±»æ“ä½œé£é™©ç›¸å¯¹äºUPDATE/DELETEè¾ƒä½ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„ç‚¹ã€‚INSERTç±»æ“ä½œï¼Œéœ€è¦ç¡®è®¤æœªè¢«å£°æ˜å­—æ®µçš„é»˜è®¤å€¼å…·ä½“çš„ä¸šåŠ¡å«ä¹‰ï¼Œå¦‚æœå­˜åœ¨ä¸šåŠ¡å«ä¹‰ï¼Œéœ€è¦ç¡®è®¤æ˜¯å¦ç¬¦åˆé¢„æœŸï¼›CREATEç±»æ“ä½œï¼Œé’ˆå¯¹è¡¨ä¸»è¦ç¡®è®¤ç´¢å¼•ã€åˆ—æ˜¯å¦åŠ å…¨ï¼Œé’ˆå¯¹ç´¢å¼•ä¸»è¦ç¡®è®¤æ˜¯å¦å­˜åœ¨é‡å¤å‰ç¼€å¯¼è‡´å†—ä½™çš„æƒ…å†µã€‚</p>
<p>ç„¶åæ˜¯é’ˆå¯¹DBæœ¬èº«è€Œè¨€ã€‚DBçš„æ€§èƒ½ç›‘æ§ï¼ŒåŒ…æ‹¬è¯·æ±‚å»¶æ—¶ã€QPSã€ä¸»ä»åŒæ­¥å»¶æ—¶ã€æ…¢æŸ¥ç­‰å†…å®¹ï¼Œä»¥åŠä¸Šä¸‹æ¸¸æœåŠ¡çš„æ€§èƒ½ç›‘æ§ï¼Œä¸šåŠ¡å¯¹è´¦ï¼Œéƒ½éœ€è¦ç¡®ä¿å®Œæ•´å¯ç”¨ã€‚è¿™é‡Œå°¤å…¶é’ˆå¯¹DDLç±»æ“ä½œï¼Œå¦‚æœæ˜¯å¯¹å¤§è¡¨çš„ç´¢å¼•/åˆ—åšæ–°å¢æˆ–åˆ æ”¹ï¼Œå®¹æ˜“å¯¼è‡´åŒæ­¥å»¶æ—¶ï¼Œè¿›è€Œå¯¼è‡´DBæ€§èƒ½å‡ºç°å¼€é”€ï¼Œæˆ–è€…ä¸šåŠ¡ä¸å¯ç”¨ã€‚å› æ­¤è¿™ç§æƒ…å†µï¼Œå»ºè®®éœ€è¦åœ¨éé«˜å³°æœŸæ“ä½œï¼Œå‡å°å˜æ›´çš„å½±å“é¢ã€‚</p>
<p>æ•´ä½“æ¥çœ‹ï¼ŒSQLå‘å¸ƒæ˜¯ä¸šåŠ¡å˜æ›´ä¸­æ¯”è¾ƒé¢‘ç¹çš„ä¸€éƒ¨åˆ†ã€‚è¦åšåˆ°æ‹¦æˆªé—®é¢˜ï¼Œå‡å°‘çº¿ä¸Šé—®é¢˜å½±å“é¢ï¼Œä¸Šè¿°çš„ç­–ç•¥å¯ä»¥åšä¸€ä¸ªæ€»ä½“å‚è€ƒã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>DevOps</tag>
        <tag>MySQL</tag>
        <tag>SQL</tag>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬åäºŒè¯ï¼šç”¨singleflightè§£å†³å•æœåŠ¡å¤„ç†é«˜å¹¶å‘ä»»åŠ¡çš„é—®é¢˜</title>
    <url>/2023/07/01/gofromzero/12_singleflight/</url>
    <content><![CDATA[<p>åœ¨åç«¯å¼€å‘åœºæ™¯ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°é«˜å¹¶å‘çš„äº‹åŠ¡å¤„ç†é€»è¾‘ã€‚è™½ç„¶åœ¨å¾®æœåŠ¡æ²»ç†çš„æœºåˆ¶ä¸‹ï¼Œèƒ½å¤Ÿå®ç°å¤šä¸ªæ— çŠ¶æ€æœåŠ¡èŠ‚ç‚¹+è´Ÿè½½å‡è¡¡é«˜å¹¶å‘å¤„ç†è¯·æ±‚ï¼Œä½†å¯¹äºå•ä¸ªæœåŠ¡èŠ‚ç‚¹æ¥è®²ï¼Œå¦‚æœå­˜åœ¨æŸäº›è€—æ—¶çš„ä»»åŠ¡éœ€è¦è¢«é«˜å¹¶å‘è®¿é—®ï¼Œé‚£ä¹ˆå¦‚æœæ²¡æœ‰ä¸€å¥—å¦¥å–„çš„æœºåˆ¶å¤„ç†ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°å¤§é‡è¿™ç±»ä»»åŠ¡å®ä¾‹å †ç§¯ï¼Œå¯¼è‡´ä»»åŠ¡è¿”å›å»¶è¿Ÿï¼Œæˆ–è€…èŠ‚ç‚¹å†…å­˜æš´æ¶¨çš„æƒ…å†µã€‚ä»Šå¤©ï¼Œå°±æ¥ä»‹ç»Golangå†…éƒ¨å¤„ç†è¿™ç§åœºæ™¯çš„ä¸€å¥—æ–¹æ¡ˆï¼šsingleflightã€‚</p>
<h2 id="singleflightçš„åº”ç”¨åœºæ™¯"><a href="#singleflightçš„åº”ç”¨åœºæ™¯" class="headerlink" title="singleflightçš„åº”ç”¨åœºæ™¯"></a>singleflightçš„åº”ç”¨åœºæ™¯</h2><p>singleflightä¸»è¦è§£å†³å•æœåŠ¡å¤„ç†é«˜å¹¶å‘ä»»åŠ¡é—®é¢˜ï¼Œå°¤å…¶æ˜¯æœåŠ¡å†·å¯åŠ¨æ—¶å€™æ²¡æœ‰è¶³å¤Ÿè¯·æ±‚hitåˆ°ç¼“å­˜çš„åœºæ™¯ã€‚å‡è®¾ä¸šåŠ¡æœ‰ä¸€ä¸ªã€è·å–Tokenã€‘çš„åœºæ™¯ï¼Œå­˜åœ¨å¦‚ä¸‹çš„å®é™…çº¦æŸï¼š</p>
<ul>
<li>è®¿é—®æ–¹å¼ï¼šä¸€ä¸ªä¸šåŠ¡ï¼ˆBusinessï¼‰ï¼Œè·å–ä¸€ä¸ªç‰¹å®šåŒºåŸŸï¼ˆRegionï¼‰çš„Token</li>
<li>TokenåŒºåŸŸï¼šåˆ†ä¸ºæ¬§äºšç¾éå››ä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸè·å–Tokençš„æ—¶é—´ä¸ä¸€æ ·ï¼Œä½†æ— è®ºæ€ä¹ˆè¾“å…¥ï¼Œéƒ½éœ€è¦ã€å‡ ç§’ã€‘åæ‰èƒ½å¾—åˆ°ç»“æœ</li>
<li>è®¿é—®é‡çº§ï¼šå•ä¸ªä¸šåŠ¡ä¸‹å¯èƒ½å­˜åœ¨å¾ˆå¤šéœ€è¦è·å–Tokençš„æœåŠ¡ï¼Œæ€»çš„è®¿é—®è¿™ä¸ªæ¥å£çš„QPSå¯èƒ½è¾¾åˆ°ã€ç™¾çº§æˆ–åƒçº§ã€‘</li>
<li>æœåŠ¡æ•°é‡ï¼šä½ åªæœ‰ã€1ã€‘ä¸ªæœåŠ¡èŠ‚ç‚¹å®ä¾‹å¤„ç†è¿™äº›è¯·æ±‚</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯èƒ½ä¼šè€ƒè™‘é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼ï¼š</p>
<a id="more"></a>
<ul>
<li>å¯¹äºä¸€ç±»ä»»åŠ¡ï¼Œç”¨ä¸€ä¸ªç‹¬ç‰¹çš„Keyæ ‡è¯†ï¼šBusiness+Region</li>
<li>å½“ä¸€ç±»ä»»åŠ¡è¢«è§¦å‘æ—¶ï¼Œç”¨ä¸€ä¸ªmutexåŠ é”ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆä¹‹åï¼Œæ‰è§£é”</li>
<li>ç”¨ä¸€ä¸ªmapæ¥å­˜å‚¨æ‰€æœ‰ä»»åŠ¡Keyå’Œä»»åŠ¡é”</li>
<li>å¦‚æœæŸç±»ä»»åŠ¡åœ¨è¿è¡Œæ—¶ï¼Œåˆè¢«å…¶å®ƒæ¥æºè§¦å‘ä¸€æ¬¡ï¼Œé‚£ä¹ˆè¿™äº›è§¦å‘åªéœ€è¦è‡ªå·±åšè½®è¯¢ï¼Œç­‰ä»»åŠ¡å®Œæˆæ‹¿ç»“æœå°±è¡Œ</li>
<li>ç¼“å­˜è¿™äº›ä»»åŠ¡æ‰§è¡Œçš„ç»“æœï¼ŒçŸ­æœŸå†…ç”Ÿæ•ˆ</li>
</ul>
<p>ä½†è¿™æ ·çš„æ–¹å¼ï¼Œå®ç°èµ·æ¥ï¼Œä¹Ÿæ˜¯éå¸¸éº»çƒ¦çš„ã€‚è€Œé€šè¿‡singleflightï¼Œå°±å¯ä»¥è§£å†³æ‰é™¤äº†ç¼“å­˜ä¹‹å¤–çš„å…¶å®ƒé—®é¢˜ã€‚</p>
<h2 id="singleflightçš„å†™æ³•"><a href="#singleflightçš„å†™æ³•" class="headerlink" title="singleflightçš„å†™æ³•"></a>singleflightçš„å†™æ³•</h2><p>è®©æˆ‘ä»¬æŠŠä¸Šé¢çš„åœºæ™¯è½¬åŒ–ä¸ºå®é™…ä»£ç æ¥çœ‹çœ‹ã€‚é¦–å…ˆï¼Œæ˜¯è·å–Tokençš„é€»è¾‘ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    RegionAmerica = <span class="string">"America"</span></span><br><span class="line">    RegionEurope  = <span class="string">"Europe"</span></span><br><span class="line">    RegionAsia    = <span class="string">"Asia"</span></span><br><span class="line">    RegionAfrica  = <span class="string">"Africa"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mpRegionWaitTime = <span class="keyword">map</span>[<span class="keyword">string</span>]time.Duration&#123;</span><br><span class="line">    RegionAmerica: <span class="number">5</span> * time.Second,</span><br><span class="line">    RegionEurope:  <span class="number">3</span> * time.Second,</span><br><span class="line">    RegionAfrica:  <span class="number">4</span> * time.Second,</span><br><span class="line">    RegionAsia:    <span class="number">2</span> * time.Second,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getToken</span><span class="params">(region <span class="keyword">string</span>, business <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></span> &#123;</span><br><span class="line">    waitTime, ok := mpRegionWaitTime[region]</span><br><span class="line">    <span class="keyword">if</span> !ok || waitTime == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span>, errors.New(<span class="string">"unsupported region: "</span> + region)</span><br><span class="line">    &#125;</span><br><span class="line">    log.Printf(<span class="string">"[getToken] region: %s, business: %s, wait-time: %v"</span>, region, business, waitTime)</span><br><span class="line">    time.Sleep(waitTime)</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%s|%s|%d"</span>, region, business, time.Now().UnixMilli()), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„ä»£ç å«ä¹‰é‡Œï¼Œæ¯ä¸ªregionçš„tokenï¼Œéƒ½è‡³å°‘ç­‰å¾…2ç§’é’Ÿæ‰èƒ½æ‹¿åˆ°ç»“æœã€‚</p>
<p>ç„¶åå°±æ˜¯ç”¨singleflightæ¥è§£å†³è¿™ä¸ªäº‹æƒ…äº†ã€‚æˆ‘ä»¬éœ€è¦æŠŠè·å–tokenå°è£…æˆä¸€ä¸ªTaskçš„å½¢å¼ï¼Œé€šè¿‡singleflightçš„æœºåˆ¶æ¥æŒ‰æ ‡è¯†æ‰¹é‡å¤„ç†ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> getTokenGroup singleflight.Group</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GetTokenTask <span class="keyword">struct</span> &#123;</span><br><span class="line">    Region   <span class="keyword">string</span></span><br><span class="line">    Business <span class="keyword">string</span></span><br><span class="line">    callback <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">func</span> <span class="params">(t *GetTokenTask)</span> <span class="title">key</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"%s|%s"</span>, t.Region, t.Business)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *GetTokenTask)</span> <span class="title">Do</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    key := t.key()</span><br><span class="line">    v, err, _ := getTokenGroup.Do(key, t.callback)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Printf(<span class="string">"[GetTokenTask] [%s] get token err: %v"</span>, key, err)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">    token, ok := v.(<span class="keyword">string</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        log.Printf(<span class="string">"[GetTokenTask] [%s] convert token to string err"</span>, key)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">    &#125;</span><br><span class="line">    log.Printf(<span class="string">"[GetTokenTask] [%s] got token: %s"</span>, key, token)</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newGetTokenTask</span><span class="params">(region <span class="keyword">string</span>, business <span class="keyword">string</span>)</span> *<span class="title">GetTokenTask</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;GetTokenTask&#123;</span><br><span class="line">        Region:   region,</span><br><span class="line">        Business: business,</span><br><span class="line">        callback: <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getToken(region, business)</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™é‡Œï¼Œæ¯ä¸€ä¸ªGetTokenTaskï¼Œä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„ä»»åŠ¡æ ‡è¯†keyã€‚æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ªsingleflight.Groupå®ä¾‹ï¼Œå¹¶é€šè¿‡å®ä¾‹çš„Doæ–¹æ³•ï¼Œæ¥å°è£…å¤„ç†å¯¹åº”keyçš„ä»»åŠ¡ã€‚</p>
<p>é€šè¿‡è¿™æ ·çš„å°è£…ï¼Œå½“æŸä¸ªä»»åŠ¡å·²ç»åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œå¦‚æœå…¶å®ƒç›¸åŒkeyçš„ä»»åŠ¡åˆšè¢«è§¦å‘ï¼Œé‚£ä¹ˆè¿™äº›ä»»åŠ¡ä¸ä¼šå®é™…è¿è¡Œï¼Œè€Œæ˜¯ç­‰å¾…å·²ç»è¿è¡Œçš„ä»»åŠ¡çš„æœ‰äº†ç»“æœï¼Œå°±ç›´æ¥è¿”å›ã€‚è¿™æ ·ï¼Œå°±èŠ‚çœäº†ä»»åŠ¡å®é™…è¿è¡Œçš„æ¬¡æ•°äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€æ®µæµ‹è¯•ä»£ç æ¥çœ‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestGetToken</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    numTasks := <span class="number">1000</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1 business, random region</span></span><br><span class="line">    business := <span class="string">"gofromzero"</span></span><br><span class="line">    regions := []<span class="keyword">string</span>&#123;RegionAmerica, RegionEurope, RegionAsia, RegionAfrica&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// run multiple tasks</span></span><br><span class="line">    t.Logf(<span class="string">"start %d tasks..."</span>, numTasks)</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numTasks; i++ &#123;</span><br><span class="line">        num := i + <span class="number">1</span></span><br><span class="line">        wg.Add(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(n <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">            <span class="keyword">defer</span> wg.Done()</span><br><span class="line">            idx := n % <span class="built_in">len</span>(regions)</span><br><span class="line">            region := regions[idx]</span><br><span class="line">            token := GetToken(region, business)</span><br><span class="line">            <span class="keyword">if</span> token == <span class="string">""</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"[task:%d] get token failed!"</span>, n)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"[task:%d] got token -&gt; %s"</span>, n, token)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;(num)</span><br><span class="line">        time.Sleep(<span class="number">1</span> * time.Millisecond)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line"></span><br><span class="line">    t.Logf(<span class="string">"finish!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»»åŠ¡æ€»å…±æœ‰1000ä¸ªï¼Œä½†å®é™…è¿è¡Œåˆ°<code>getToken</code>å‡½æ•°çš„æ¬¡æ•°ï¼Œä»…ä»…åªæœ‰4æ¬¡ã€‚è¿™æ ·ï¼Œå°±è¾¾åˆ°äº†é¢„æœŸçš„æ•ˆæœã€‚</p>
<p>æœ€åéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè€ƒè™‘åˆ°ä¸€èˆ¬è·å–Tokençš„é€»è¾‘ï¼ŒTokenæœ¬èº«ä¸€èˆ¬ä¼šæœ‰ç”Ÿæ•ˆæ—¶é—´ã€‚å› æ­¤æœ€å¥½åœ¨<code>getToken</code>é€»è¾‘ä¸­ï¼Œå¢åŠ ä¸€ä¸ªç¼“å­˜ç»“æœçš„é€»è¾‘ï¼Œè¿™æ ·åç»­çš„è·å–Tokenä»»åŠ¡å°±ä¸å¿…å†å¤šç­‰å‡ ç§’é’Ÿæ‰èƒ½æ‹¿åˆ°ç»“æœäº†ï¼Œå¯ä»¥ä¼˜å…ˆèµ°ç¼“å­˜ã€‚</p>
<h2 id="singleflightçš„æºç åˆ†æ"><a href="#singleflightçš„æºç åˆ†æ" class="headerlink" title="singleflightçš„æºç åˆ†æ"></a>singleflightçš„æºç åˆ†æ</h2><p>singleflightçš„ç”¨æ³•æ˜ç™½äº†ï¼Œè¿›é˜¶åœ°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹singleflightæºç æ€ä¹ˆå®ç°çš„ã€‚</p>
<p>é¦–å…ˆæ˜¯singleflight.Groupçš„å®šä¹‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Group <span class="keyword">struct</span> &#123;</span><br><span class="line">	mu sync.Mutex       <span class="comment">// protects m</span></span><br><span class="line">	m  <span class="keyword">map</span>[<span class="keyword">string</span>]*call <span class="comment">// lazily initialized</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> call <span class="keyword">struct</span> &#123;</span><br><span class="line">	wg sync.WaitGroup</span><br><span class="line">	val <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	err error</span><br><span class="line">	dups  <span class="keyword">int</span></span><br><span class="line">	chans []<span class="keyword">chan</span>&lt;- Result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªsingleflight.Groupä¸­ï¼Œä¼šé€šè¿‡ä¸€ä¸ªmapæ¥ç»´æŠ¤ä»»åŠ¡æ ‡è¯†keyå’Œä»»åŠ¡å®ä¾‹callçš„å…³ç³»ã€‚</p>
<p>åœ¨æ¯ä¸ªcallä¸­ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>valã€errï¼šä»»åŠ¡è¿”å›çš„ç»“æœ</li>
<li>chansï¼šåœ¨é€šè¿‡chanæ¥æ”¶è¿”å›ç»“æœåœºæ™¯ä¸‹ï¼Œæ‰€æœ‰ä»»åŠ¡çš„channelsï¼ˆæœ¬æ–‡æœªä¸¾ä¾‹ï¼Œè¯»è€…æœ‰å…´è¶£å¯è‡ªè¡Œäº†è§£ï¼‰</li>
<li>wgï¼šå½“ä»»åŠ¡å·²ç»åœ¨è¿è¡Œæ—¶ï¼Œå¾€åçš„è§¦å‘ä¸ºäº†ç­‰å¾…ä»»åŠ¡å®Œæˆéœ€è¦ç”¨çš„WaitGroup</li>
<li>dupï¼šè¿™ä¸ªä»»åŠ¡çš„å®é™…å¹¶å‘é‡ï¼ˆä»»åŠ¡è§¦å‘+è¿è¡Œè¿‡ç¨‹ä¸­æ€»å…±è¢«è§¦å‘çš„æ¬¡æ•°ä¹‹å’Œï¼‰</li>
</ul>
<p>é€šè¿‡Doè¿è¡Œä»»åŠ¡çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *Group)</span> <span class="title">Do</span><span class="params">(key <span class="keyword">string</span>, fn <span class="keyword">func</span>()</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span>) <span class="params">(v <span class="keyword">interface</span>&#123;&#125;, err error, shared <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	g.mu.Lock()</span><br><span class="line">	<span class="keyword">if</span> g.m == <span class="literal">nil</span> &#123;</span><br><span class="line">		g.m = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*call)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> c, ok := g.m[key]; ok &#123;</span><br><span class="line">		c.dups++</span><br><span class="line">		g.mu.Unlock()</span><br><span class="line">		c.wg.Wait()</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> e, ok := c.err.(*panicError); ok &#123;</span><br><span class="line">			<span class="built_in">panic</span>(e)</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> c.err == errGoexit &#123;</span><br><span class="line">			runtime.Goexit()</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> c.val, c.err, <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">	c := <span class="built_in">new</span>(call)</span><br><span class="line">	c.wg.Add(<span class="number">1</span>)</span><br><span class="line">	g.m[key] = c</span><br><span class="line">	g.mu.Unlock()</span><br><span class="line"></span><br><span class="line">	g.doCall(c, key, fn)</span><br><span class="line">	<span class="keyword">return</span> c.val, c.err, c.dups &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªé€»è¾‘å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä»»åŠ¡å·²ç»åœ¨è¿è¡Œï¼ˆå³<code>c, ok := g.m[key]; ok</code>åˆ†æ”¯ï¼‰ï¼šå¢åŠ å¹¶å‘è®¡æ•°ï¼Œç­‰å¾…wgï¼Œç›´æ¥è¿”å›ç»“æœ</li>
<li>ä»»åŠ¡æ²¡æœ‰è¿è¡Œï¼šåˆå§‹åŒ–callå®ä¾‹ï¼Œæ³¨å†Œåˆ°Groupä¸­ï¼Œå¢åŠ wgè®¡æ•°ï¼ŒdoCallè¿è¡Œä»»åŠ¡</li>
</ul>
<p>åœ¨doCallä¸­çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *Group)</span> <span class="title">doCall</span><span class="params">(c *call, key <span class="keyword">string</span>, fn <span class="keyword">func</span>()</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span>)</span> &#123;</span><br><span class="line">	normalReturn := <span class="literal">false</span></span><br><span class="line">	recovered := <span class="literal">false</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">if</span> !normalReturn &amp;&amp; !recovered &#123;</span><br><span class="line">			c.err = errGoexit</span><br><span class="line">		&#125;</span><br><span class="line">		g.mu.Lock()</span><br><span class="line">		<span class="keyword">defer</span> g.mu.Unlock()</span><br><span class="line">		c.wg.Done()</span><br><span class="line">		<span class="keyword">if</span> g.m[key] == c &#123;</span><br><span class="line">			<span class="built_in">delete</span>(g.m, key)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> e, ok := c.err.(*panicError); ok &#123;</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(c.chans) &gt; <span class="number">0</span> &#123;</span><br><span class="line">				<span class="keyword">go</span> <span class="built_in">panic</span>(e)</span><br><span class="line">				<span class="keyword">select</span> &#123;&#125;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="built_in">panic</span>(e)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> c.err == errGoexit &#123;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">for</span> _, ch := <span class="keyword">range</span> c.chans &#123;</span><br><span class="line">				ch &lt;- Result&#123;c.val, c.err, c.dups &gt; <span class="number">0</span>&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">if</span> !normalReturn &#123;</span><br><span class="line">				<span class="keyword">if</span> r := <span class="built_in">recover</span>(); r != <span class="literal">nil</span> &#123;</span><br><span class="line">					c.err = newPanicError(r)</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line">		c.val, c.err = fn()</span><br><span class="line">		normalReturn = <span class="literal">true</span></span><br><span class="line">	&#125;()</span><br><span class="line">	<span class="keyword">if</span> !normalReturn &#123;</span><br><span class="line">		recovered = <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿‡æ»¤æ‰ä¸€äº›å¤„ç†runtimeå¼‚å¸¸çš„é€»è¾‘ï¼Œå®é™…åªæœ‰è¿™ä¹ˆäº›å…³é”®å†…å®¹ï¼š</p>
<ul>
<li><code>c.val, c.err = fn()</code>ï¼šæ‰§è¡Œä»»åŠ¡ï¼Œè¿”å›ç»“æœ</li>
<li>è½¬åˆ°æœ€å¤–éƒ¨çš„deferé€»è¾‘ -&gt; <code>c.wg.Done()</code>ï¼šå…¶å®ƒè§¦å‘çš„<code>wg.Wait()</code>é€šè¿‡äº†ï¼Œç›´æ¥æ‹¿åˆ°ç»“æœè¿”å›</li>
<li><code>delete(g.m, key)</code>ï¼Œä»Groupä¸­æ¸…é™¤æ‰è‡ªå·±è¿™ä¸ªä»»åŠ¡å®ä¾‹</li>
</ul>
<p>è¿™æ ·ï¼Œæ•´ä¸ªsingleflightçš„callå°±å®Œæˆä¸€ç»„ä»»åŠ¡å¤„ç†äº†ã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>å¹¶å‘</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>singleflight</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘å·¥ä½œä¸­å¤±è¯¯äº†ï¼Œåº”è¯¥å¦‚ä½•å¯¹å¾…ï¼Ÿ</title>
    <url>/2023/06/11/diymemo/handle_mistakes/</url>
    <content><![CDATA[<p>ä»Šå¤©æ•´ç†åšå®¢æ—¶ï¼Œæ°å¥½ç„åˆ°CSDNåˆ›ä½œæ´»åŠ¨é‡Œï¼Œæœ€è¿‘åœ¨æè¿™ä¸ªä¸»é¢˜ï¼š<span class="exturl" data-url="aHR0cHM6Ly9hY3Rpdml0eS5jc2RuLm5ldC9jcmVhdEFjdGl2aXR5P2lkPTEwNDY3" title="https://activity.csdn.net/creatActivity?id=10467">å¦‚ä½•å¯¹å¾…å·¥ä½œä¸­çš„å¤±è¯¯<i class="fa fa-external-link"></i></span>ï¼Ÿç¬”è€…ä¸ªäººè§‰å¾—ï¼Œè¿™ä¸ªè¯é¢˜æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ï¼Œå°¤å…¶æ˜¯åœ¨ç°åœ¨ç»æµå½¢åŠ¿ä¸å¥½ï¼Œäººäººéƒ½æ‹…å¿§å¤±ä¸šçš„æƒ…å†µä¸‹ï¼Œæ€ä¹ˆæ ·å¯¹å¾…å·¥ä½œçš„å¤±è¯¯ï¼Œç”šè‡³æ˜¯å·¥ä½œæœ¬èº«ï¼Œä¸è®ºæ˜¯ä»å¿ƒæ€ä¸Šï¼Œè¿˜æ˜¯ä»ç­–ç•¥ï¼ˆæŠ“æ‰‹ï¼‰ä¸Šï¼Œéƒ½æ˜¯å€¼å¾—å»æ·±å…¥è®¨è®ºçš„ã€‚å› æ­¤ï¼Œç¬”è€…å†³å®šä¸ºã€DIYå°è®°ã€‘ç³»åˆ—ç‰¹åˆ«æ’°å†™ä¸€ç¯‡æ–‡ç« ï¼Œæ¥è°ˆä¸€ä¸‹å·¥ä½œä¸­å¤±è¯¯äº†ä¹‹åï¼Œåˆ°åº•éœ€è¦å¦‚ä½•å¯¹å¾…ã€‚</p>
<p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œå°±ä»¥CSDNåˆ›ä½œæ¨¡æ¿é‡Œçš„å‡ ä¸ªé—®é¢˜å…¥æ‰‹ï¼Œæ¥è®¨è®ºè¿™ä¸ªè¯é¢˜å§ï¼</p>
<a id="more"></a>
<h2 id="ä¸€ã€åœ¨é¢å¯¹å¤±è¯¯è€Œå¸¦æ¥çš„æŒ‡è´£å’Œæ²®ä¸§æ—¶ï¼Œä½ æ˜¯å¦‚ä½•åšçš„ï¼Ÿ"><a href="#ä¸€ã€åœ¨é¢å¯¹å¤±è¯¯è€Œå¸¦æ¥çš„æŒ‡è´£å’Œæ²®ä¸§æ—¶ï¼Œä½ æ˜¯å¦‚ä½•åšçš„ï¼Ÿ" class="headerlink" title="ä¸€ã€åœ¨é¢å¯¹å¤±è¯¯è€Œå¸¦æ¥çš„æŒ‡è´£å’Œæ²®ä¸§æ—¶ï¼Œä½ æ˜¯å¦‚ä½•åšçš„ï¼Ÿ"></a>ä¸€ã€åœ¨é¢å¯¹å¤±è¯¯è€Œå¸¦æ¥çš„æŒ‡è´£å’Œæ²®ä¸§æ—¶ï¼Œä½ æ˜¯å¦‚ä½•åšçš„ï¼Ÿ</h2><p>é¦–å…ˆæˆ‘ä»¬è¦å˜æ¸…ä¸€ç‚¹ï¼Œå°¤å…¶å‡è®¾ä½ æ˜¯åœ¨æ‰“å·¥ï¼Œè€Œä¸æ˜¯ä½œä¸ºä¸€ä¸ªè€æ¿ã€‚æ‰“å·¥äººèšåœ¨ä¸€èµ·ï¼Œæ˜¯å› ä¸ºåˆ©ç›Šèšåœ¨ä¸€èµ·çš„ï¼Œä¸šåŠ¡å¥½äº†å¤§å®¶ä¸€èµ·åƒå¤§é”…é¥­ï¼Œä¸šåŠ¡ä¸å¥½é‚£å°±å¾—åƒæ•£ä¼™é¥­ã€‚ä½ çš„ä¸€ä¸ªå¤±è¯¯ï¼Œå®é™…ç‰µåŠ¨ç€çš„ï¼Œå°±æ˜¯æ•´ä¸ªä¸šåŠ¡çš„åˆ©ç›Šã€‚è¢«äººæŒ‡è´£ï¼Œå¯èƒ½ä¹Ÿåœ¨æ‰€éš¾å…ï¼›è‡ªå·±æ²®ä¸§ï¼Œæœ¬è´¨ä¹Ÿæ˜¯å› ä¸ºè‡ªå·±çš„å¿ƒåŠ›æ— æ³•æ»¡è¶³è‡ªå·±çš„è´£ä»»æ„Ÿï¼Œä¹Ÿæ˜¯æƒ…æœ‰å¯åŸã€‚å·¥ä½œå¤±è¯¯å¸¦æ¥æŒ‡è´£å’Œæ²®ä¸§ï¼Œå®¢è§‚ä¸Šéƒ½æ˜¯åˆç†çš„è¡¨ç°ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸è®ºæ˜¯æŒ‡è´£åˆ«äººï¼Œè¿˜æ˜¯è‡ªå·±æ²®ä¸§ï¼Œè¿™ä¸¤ç§è¡Œä¸ºå¯¹äºé¿å…å¤±è¯¯è¿™ä»¶äº‹æƒ…ï¼Œå®é™…éƒ½æ˜¯æ— ç”¨åŠŸã€‚å·¥ä½œçš„å†…å®¹æœ¬èº«ï¼Œå°±æ˜¯ä¸€ä»¶ä»¶é—®é¢˜çš„è§£å†³ã€‚è€Œå¼¥è¡¥å·¥ä½œå¤±è¯¯ï¼Œä¹Ÿæ˜¯å·¥ä½œä¸­éœ€è¦è§£å†³çš„é—®é¢˜ä¹‹ä¸€ã€‚</p>
<p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸šåŠ¡é‡Œç›¸å…³è”çš„åŒå­¦éƒ½éœ€è¦æ‹…èµ·è´£ä»»æ¥ï¼Œé€šåŠ›åˆä½œï¼Œå»ºç«‹é˜²èŒƒæœºåˆ¶ï¼Œå»è®©ç±»ä¼¼çš„å¤±è¯¯ä¸å†å‘ç”Ÿã€‚ä»è‡ªå·±çš„è§’åº¦å‡ºå‘ï¼Œå°±æ˜¯å¾—åšå‡ ä¸ªäº‹æƒ…ï¼š</p>
<ul>
<li>æ­¢æŸï¼Œä¿®å¤ç¼ºé™·ï¼Œè§£å†³é¢å‰çš„é—®é¢˜</li>
<li>äº‹åé›†ä¸­å¤ç›˜ï¼Œçœ‹å“ªäº›ç¯èŠ‚å‡ºç°äº†é—®é¢˜ï¼Œä¼˜åŒ–å¤§å®¶åç»­çš„å·¥ä½œå’Œé…åˆæ–¹å¼</li>
</ul>
<h2 id="äºŒã€å‘ç”Ÿäº†å¤±è¯¯ä¹‹åï¼Œä½ æ˜¯å¦‚ä½•æ‰¾åˆ°é—®é¢˜çš„ï¼Ÿå¦‚ä½•é¿å…åªçœ‹åˆ°è¡¨é¢ç°è±¡è€Œå¿½ç•¥äº†æ ¹æœ¬é—®é¢˜ï¼Ÿ"><a href="#äºŒã€å‘ç”Ÿäº†å¤±è¯¯ä¹‹åï¼Œä½ æ˜¯å¦‚ä½•æ‰¾åˆ°é—®é¢˜çš„ï¼Ÿå¦‚ä½•é¿å…åªçœ‹åˆ°è¡¨é¢ç°è±¡è€Œå¿½ç•¥äº†æ ¹æœ¬é—®é¢˜ï¼Ÿ" class="headerlink" title="äºŒã€å‘ç”Ÿäº†å¤±è¯¯ä¹‹åï¼Œä½ æ˜¯å¦‚ä½•æ‰¾åˆ°é—®é¢˜çš„ï¼Ÿå¦‚ä½•é¿å…åªçœ‹åˆ°è¡¨é¢ç°è±¡è€Œå¿½ç•¥äº†æ ¹æœ¬é—®é¢˜ï¼Ÿ"></a>äºŒã€å‘ç”Ÿäº†å¤±è¯¯ä¹‹åï¼Œä½ æ˜¯å¦‚ä½•æ‰¾åˆ°é—®é¢˜çš„ï¼Ÿå¦‚ä½•é¿å…åªçœ‹åˆ°è¡¨é¢ç°è±¡è€Œå¿½ç•¥äº†æ ¹æœ¬é—®é¢˜ï¼Ÿ</h2><p>å¦‚ä½•æ‰¾åˆ°é—®é¢˜ï¼Œç¬¬ä¸€å—æ˜¯éœ€è¦åæ¨ä»€ä¹ˆæ—¶é—´ç‚¹åšäº†äº›ä»€ä¹ˆï¼Œä¸åªæ˜¯ä½ è‡ªå·±ï¼Œä¹Ÿéœ€è¦å‚è€ƒå…³è”åŒå­¦ä»¥åŠçº¿ä¸Šè¿ä½œçš„æ—¶é—´çº¿ã€‚æŠŠè¿™äº›ä¿¡æ¯å› ç´ æ‹¼å‡‘èµ·æ¥ï¼Œå°±å¯èƒ½å¾—åˆ°å‡ ç§å¯èƒ½åœºæ™¯ï¼š</p>
<ul>
<li>æŠ€æœ¯å¤±è¯¯ï¼šæˆ‘çš„ä»£ç æœ¬èº«å°±æœ‰bugï¼Œæœ‰äº›ä¸šåŠ¡åœºæ™¯/æŠ€æœ¯ç»†èŠ‚æ²¡æœ‰è€ƒè™‘ï¼Œå¯¼è‡´æœ‰çº¿ä¸Šé—®é¢˜</li>
<li>ä¸šåŠ¡å¤±è¯¯ï¼šæˆ‘åšçš„äº‹æƒ…ï¼Œå¦‚æœä»€ä¹ˆæ—¶å€™ç»™AåŒå­¦è¯„ä¼°ä¸‹ï¼Œç»™BåŒå­¦æµ‹è¯•ä¸‹ï¼Œå¯èƒ½ä¸ä¼šå‘ç”Ÿå¤±è¯¯</li>
<li>æ— æ„ŸçŸ¥å¤±è¯¯ï¼šXåŒå­¦å¦‚æœåœ¨ä»€ä¹ˆæ—¶å€™æ—©ä¸€ç‚¹å‘Šè¯‰æˆ‘ä»€ä¹ˆä¿¡æ¯ï¼Œæˆ‘å¯èƒ½å°±ä¸ä¼šåšå‡ºè¿™ç§è¡Œä¸ºï¼Œå¯¼è‡´â€å¤±è¯¯â€äº§ç”Ÿ</li>
</ul>
<p>è¿™äº›å°±æ˜¯æ‰€è°“é—®é¢˜çš„â€è¡¨é¢ç°è±¡â€äº†ã€‚å…¶ä¸­çš„æ ¹æœ¬åŸå› å¯èƒ½ä¼šæ˜¯ï¼š</p>
<ul>
<li>æŠ€æœ¯å¤±è¯¯ï¼šæŠ€æœ¯è®¾è®¡/äº¤æ¥æ–‡æ¡£ä¸è§„èŒƒï¼Œéƒ¨åˆ†åœºæ™¯æ²¡æœ‰æ¸…æ™°è¯´æ˜</li>
<li>ä¸šåŠ¡å¤±è¯¯ï¼šç¼ºä¹æ ‡å‡†ä¸Šçº¿æµç¨‹ï¼Œä¸Šçº¿å†…å®¹æ²¡æœ‰æ–¹æ¡ˆreviewæœºåˆ¶</li>
<li>æ— æ„ŸçŸ¥å¤±è¯¯ï¼šä¸šåŠ¡ä¸Šä¸‹æ¸¸ç¼ºä¹ä¿¡æ¯äº’é€šæ¸ é“ï¼Œä¸Šæ¸¸å˜æ›´å½±å“ä¸‹æ¸¸æ„ŸçŸ¥ä¸åˆ°</li>
</ul>
<p>é‚£ä¹ˆè§£å†³è¿™äº›æ ¹æœ¬åŸå› ï¼Œå°±å¾—ï¼š</p>
<ul>
<li>æŠ€æœ¯å¤±è¯¯ï¼šé’ˆå¯¹å¤±è¯¯å†…å®¹ï¼Œé‡æ–°reviewå¹¶å½»åº•æ¢³ç†æ¸…æ¥šå®ç°ç»†èŠ‚ã€‚å¹¶ä¸”ï¼Œä¿®å¤é€»è¾‘ä¸€æ­¥åˆ°ä½ï¼Œé˜²æ­¢å®é™…åªå¼¥è¡¥äº†å†°å±±ä¸€è§’ã€‚</li>
<li>ä¸šåŠ¡å¤±è¯¯ï¼šå»ºç«‹èµ·æ–‡å­—ç‰ˆçš„ä¸Šçº¿æµç¨‹å’Œæ ‡å‡†æŒç»­é›†æˆï¼ˆDevOpsï¼‰å·¥ä½œæµï¼Œä¸Šçº¿å†…å®¹çš„éœ€æ±‚èƒŒæ™¯ã€æŠ€æœ¯è®¾è®¡ã€Reviewå®¡æ‰¹è®°å½•ã€å‘å¸ƒè¿‡ç¨‹è®°å½•å…¨éƒ¨ç•™ç—•ã€‚ä¸€æ¥é€šè¿‡èƒ½è®©æ›´å¤šäººæ„ŸçŸ¥ï¼Œé¿å…å¤±è¯¯åœ¨çº¿ä¸Šå‘ˆç°çš„å¯èƒ½æ€§ï¼›äºŒæ¥å¦‚æœçœŸçš„æœ‰å‘ç”Ÿé—®é¢˜ï¼Œé€šè¿‡æ“ä½œç•™ç—•ä¹Ÿèƒ½å¤Ÿæ–¹ä¾¿å›æº¯æ’æŸ¥ã€‚</li>
<li>æ— æ„ŸçŸ¥å¤±è¯¯ï¼šä¸Šä¸‹æ¸¸å»ºç«‹è”é˜²è”æ§æœºåˆ¶ï¼Œè”åˆæ¢³ç†ä¸Šæ¸¸å˜æ›´å½±å“ä¸‹æ¸¸çš„åœºæ™¯ã€‚ä¸Šæ¸¸å»ºç«‹å˜æ›´å‘¨çŸ¥æœºåˆ¶ï¼Œå¿…è¦æ—¶å¢åŠ æ¼”ç»ƒç¯èŠ‚ï¼Œä½¿å¾—ä¸‹æ¸¸ä¸šåŠ¡ç¬¬ä¸€æ—¶é—´èƒ½æ„ŸçŸ¥å˜æ›´é£é™©ï¼Œç¡®ç«‹å¯¹ç­–ã€‚</li>
</ul>
<p>ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œä»åˆä½œçš„è§’åº¦æ¥è®²ï¼Œå¾ˆå¤šå·¥ä½œå¤±è¯¯èƒŒåï¼Œå¯èƒ½æ˜¯ä¸šåŠ¡è¿ä½œæœºåˆ¶çš„é—®é¢˜ï¼Œä»…é è‡ªå·±ä¸€ä¸ªäººï¼Œè¿˜æ˜¯å¾ˆéš¾å½»åº•è§£å†³é—®é¢˜çš„ã€‚è¯´å¥å®åœ¨è¯ï¼Œè¦è§£å†³æ ¹æœ¬é—®é¢˜ï¼Œè¿˜å¾—é æ‰€è°“çš„æ‹‰é€šå¯¹é½ï¼Œåšå¥½å¤ç›˜ï¼Œå¤§å®¶é€šåŠ›åä½œï¼Œæ‰“å¥½ç»„åˆæ‹³ã€‚</p>
<h2 id="ä¸‰ã€åœ¨å·¥ä½œä¸­æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšæ‰èƒ½é™ä½å¤±è¯¯ç‡ï¼Œåˆ†äº«ä¸€ä¸‹ä½ çš„å·¥ä½œæŠ€å·§å’Œæ–¹æ³•å§ï¼"><a href="#ä¸‰ã€åœ¨å·¥ä½œä¸­æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšæ‰èƒ½é™ä½å¤±è¯¯ç‡ï¼Œåˆ†äº«ä¸€ä¸‹ä½ çš„å·¥ä½œæŠ€å·§å’Œæ–¹æ³•å§ï¼" class="headerlink" title="ä¸‰ã€åœ¨å·¥ä½œä¸­æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšæ‰èƒ½é™ä½å¤±è¯¯ç‡ï¼Œåˆ†äº«ä¸€ä¸‹ä½ çš„å·¥ä½œæŠ€å·§å’Œæ–¹æ³•å§ï¼"></a>ä¸‰ã€åœ¨å·¥ä½œä¸­æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåšæ‰èƒ½é™ä½å¤±è¯¯ç‡ï¼Œåˆ†äº«ä¸€ä¸‹ä½ çš„å·¥ä½œæŠ€å·§å’Œæ–¹æ³•å§ï¼</h2><p>ç¬”è€…è‡ªå·±æ˜¯ç¨‹åºå‘˜ï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œå°±ä»ç¨‹åºå‘˜è§’åº¦æ¥å›ç­”ä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆæ˜¯ç¨‹åºè®¾è®¡/å®ç°çš„æ–¹é¢ã€‚è™½ç„¶é¢è¯•é‡Œå¤´ç»å¸¸ä¼šæœ‰å…«è‚¡æ–‡çš„å‡ºç°ï¼Œä½†åœ¨å®é™…å†™ä¸šåŠ¡ä»£ç å½“ä¸­ï¼Œå…«è‚¡æ–‡ä»£ç çš„æˆåˆ†å…¶å®ä¸ä¼šå¤ªå¤šï¼Œæ›´å¤šçš„æ˜¯æˆ‘ä»¬éœ€è¦é€šè¿‡ä»£ç ï¼Œå»æ¨¡æ‹ŸæŸä¸€é¢†åŸŸä¸šåŠ¡çš„è¿ä½œè¿‡ç¨‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸šåŠ¡æœ¬èº«çš„éœ€æ±‚ï¼Œæœ€ç»ˆå‘ˆç°çš„æ•ˆæœï¼Œä»¥åŠåœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å®šä¹‰å“ªäº›æ¦‚å¿µï¼Œæ¯ä¸ªæ¦‚å¿µä¹‹é—´è”ç³»æ˜¯ä»€ä¹ˆã€‚æŠŠä½ è¦ä»£ç å®ç°çš„ä¸œè¥¿ï¼Œå…ˆåœ¨å¤§è„‘ä¸Šæˆ–è€…åœ¨è‰ç¨¿çº¸ä¸Šè¿‡ä¸€éï¼Œç„¶åå†å¡«ä¸Šä»£ç ï¼Œè¿™æ ·å°±èƒ½æœ‰æ•ˆé¿å…ä»£ç å†™åˆ°ä¸€åŠï¼Œå‘ç°å®ç°æœ‰é—®é¢˜ï¼Œå†å¼¥è¡¥ä¹Ÿä¸ºæ—¶å·²æ™šçš„çª˜å¢ƒã€‚</p>
<p>è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨åšæ¶æ„è®¾è®¡çš„æ—¶å€™ï¼Œå¯èƒ½æ˜¯è‡ªé¡¶å‘ä¸‹çš„ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸€ä¸ªç›®æ ‡ï¼Œé€šè¿‡å±‚å±‚åˆ†è§£ï¼Œæ¥ç¡®å®šæŠ€æœ¯å‘ˆç°çš„æ–¹æ¡ˆã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨ç¼–ç çš„æ—¶å€™ï¼Œæ˜¯è‡ªåº•å‘ä¸Šçš„ï¼Œé¦–å…ˆè¦æŠŠæ¯ä¸ªç»†åˆ†æ¨¡å—å®ç°äº†ï¼Œç„¶åå±‚å±‚å †ç§¯ï¼Œä»è€Œè¾¾åˆ°æœ€ç»ˆçš„æ•ˆæœã€‚å› æ­¤ï¼Œæ¦‚å¿µçš„å®šä¹‰ï¼Œæ¦‚å¿µé—´çš„è”ç³»ï¼Œä¸€å®šè¦æƒ³å¥½ï¼Œæ‰å¯ä»¥ä¸‹ç¬”ã€‚</p>
<p>ç„¶åæ˜¯æ²Ÿé€šäº¤æµçš„å±‚é¢ã€‚ä¸šåŠ¡é‡Œä¸åŒçº¿çš„åŒå­¦ï¼ŒæŒæ¡çš„ä¿¡æ¯æ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœä½ åœ¨ç¼–ç æ—¶å€™æœ‰å®ç°æ•ˆæœä¸Šçš„ç–‘é—®ï¼Œä¸å¦¨å’Œäº§å“åŒå­¦å¯¹ä¸€å¯¹ï¼Œæ•ˆæœèƒ½ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼›å¦‚æœä½ å¯¹è§‰å¾—ä»£ç é‡Œå¾ˆå¤šbadcaseå¾ˆéš¾ä¸€æ—¶æ¢³ç†åˆ°ï¼Œä¸å¦¨é—®é—®æµ‹è¯•åŒå­¦ï¼Œå¯¹ä¸€ä¸‹ç”¨ä¾‹ï¼Œæˆ–è€…æµ‹ä¸€è½®ï¼Œçœ‹æœ‰ä»€ä¹ˆå…·ä½“çš„é—®é¢˜å‘ˆç°ï¼›å¦‚æœä½ ä¸ç¡®å®šæ“ä½œæŸä¸ªæ¥å£ä¼šä¸ä¼šæœ‰å±é™©ï¼Œä¸å¦¨é—®é—®æ¥å£çš„å¼€å‘äººï¼Œæˆ–è€…æ¥å£ä¸‹æ¸¸çš„è´Ÿè´£äººï¼Œä¸€èµ·æ‹‰æ¥çœ‹ä¸€ä¸‹ä¼šä¸ä¼šæœ‰ä»€ä¹ˆcaseæ²¡æœ‰è€ƒè™‘åˆ°ï¼Œæˆ–è®¸å°±èƒ½è§„é¿æŸä¸€æ¬¡å±é™©çš„æ“ä½œã€‚</p>
<p>å·¥ä½œä¸­å¾ˆå¤šä»¤äººçº ç»“çš„é—®é¢˜ï¼Œå…¶å®å¯èƒ½æ‰¾å¯¹ä¸ªäººï¼ŒèŠä¸€ä¸¤å¥è¯å°±å¯ä»¥è§£å†³ã€‚æœ‰åŒå­¦å¯èƒ½è§‰å¾—ï¼Œå½“ç¤¾ç‰›æ‰¾äººèŠå¤©ï¼Œæ˜¯ä¸€ä»¶å›°éš¾éº»çƒ¦çš„äº‹æƒ…ã€‚ä½†å¦‚æœä½ æ˜¯æŠ±æœ‰â€è§„é¿å¤±è¯¯â€çš„å·¥ä½œæ€åº¦çš„è¯ï¼Œå½“ç¤¾ç‰›æ‰¾äººèŠå¤©ï¼Œæ‰æ˜¯å·¥ä½œä¸­å¿…é¡»è¦åšçš„äº‹æƒ…ã€‚</p>
<h2 id="å››ã€æ€æ ·æ‰èƒ½åœ¨é”™è¯¯ä¸­ä¸æ–­å¸å–æ•™è®­ï¼Œè®©è‡ªå·±å¾—åˆ°æ›´å¤šæˆé•¿å‘¢ï¼Ÿ"><a href="#å››ã€æ€æ ·æ‰èƒ½åœ¨é”™è¯¯ä¸­ä¸æ–­å¸å–æ•™è®­ï¼Œè®©è‡ªå·±å¾—åˆ°æ›´å¤šæˆé•¿å‘¢ï¼Ÿ" class="headerlink" title="å››ã€æ€æ ·æ‰èƒ½åœ¨é”™è¯¯ä¸­ä¸æ–­å¸å–æ•™è®­ï¼Œè®©è‡ªå·±å¾—åˆ°æ›´å¤šæˆé•¿å‘¢ï¼Ÿ"></a>å››ã€æ€æ ·æ‰èƒ½åœ¨é”™è¯¯ä¸­ä¸æ–­å¸å–æ•™è®­ï¼Œè®©è‡ªå·±å¾—åˆ°æ›´å¤šæˆé•¿å‘¢ï¼Ÿ</h2><p>å¦‚æœå¯ä»¥çš„è¯ï¼Œç¬”è€…å¸Œæœ›å¤§å®¶çš„å¿ƒæ€æ˜¯ï¼Œå‡å°‘çŠ¯é”™ï¼Œå‡å°‘é€šè¿‡è¿™ç§æ–¹å¼â€æˆé•¿â€çš„æœºä¼šã€‚å°±ç®—çŠ¯é”™æœ¬èº«çœŸçš„ä¸èƒ½é¿å…ï¼Œä¹Ÿå¾—æ±‚ä¸€ä¸ªå·¥ä½œæ€åº¦ï¼Œå°½é‡ä¸è®©è‡ªå·±çš„é”™è¯¯æ”¾å¤§ï¼Œå½±å“åˆ°æ•´ä¸ªä¸šåŠ¡çš„è¿ä½œã€‚</p>
<p>æ¯”èµ·ä»é”™è¯¯ä¸­å¸å–æ•™è®­ï¼Œå·¥ä½œæ›´åº”è¯¥å…³æ³¨çš„ï¼Œæ˜¯æ‹¿åˆ°æ›´å¤šçš„å·¥ä½œç»“æœã€‚æ‹¿åˆ°æ›´å¤šç»“æœçš„è¿‡ç¨‹é‡Œï¼Œè‡ªç„¶ä¼šæœ‰æ›´å¤šçš„æˆé•¿ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å·¥ä½œå¤±è¯¯æ— æ³•å½»åº•é¿å…ã€‚å¦‚æœä½ å¯¹ä½ çš„å·¥ä½œå†…å®¹å¾ˆæœ‰è´£ä»»æ„Ÿï¼Œé‚£ä¹ˆå¦‚æœçœŸçš„å¤±è¯¯äº†ï¼Œå°±ä¸è¦æ²‰æµ¸åœ¨å¤±è¯¯çš„æ²®ä¸§é‡Œï¼Œå¾—å»è§£å†³å·¥ä½œå¤±è¯¯ï¼Œæ‰æ˜¯çœŸæ­£å¯¹çš„èµ·ä½ çš„è´£ä»»æ„Ÿã€‚æ‰€ä»¥ï¼Œå¦ç„¶é¢å¯¹å§ï¼</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
        <tag>é¢è¯•</tag>
        <tag>æŒç»­é›†æˆ</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>ç ”å‘æ•ˆèƒ½</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘ç”¨pythonå†™webå‰ç«¯ä¹‹reactpyæ¢ç´¢</title>
    <url>/2023/06/10/githubdiscovery/reactpy/</url>
    <content><![CDATA[<p>ä½ æœ‰æƒ³è±¡è¿‡ç”¨pythonæ¥å†™webå‰ç«¯è¿™ç§æ“ä½œä¹ˆï¼Ÿè¿‘æœŸåœ¨github-trendingä¸Šå°±æœ‰è¿™æ ·çš„ä¸€ä¸ªé¡¹ç›®<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlYWN0aXZlLXB5dGhvbi9yZWFjdHB5" title="https://github.com/reactive-python/reactpy">reactpy<i class="fa fa-external-link"></i></span>ï¼Œå¯ä»¥æ»¡è¶³ä½ åœ¨pythonä¸Šå†™webå‰ç«¯çš„æ¬²æœ›ã€‚ä¸ºæ­¤ï¼Œç¬”è€…ä¹Ÿå†³å®šè¸©è¸©å‘ï¼Œçœ‹çœ‹è¿™ä¸ªé¡¹ç›®çš„å½¢å¼åˆ°åº•å¦‚ä½•ï¼Œèƒ½ä¸èƒ½å¾ˆæ–¹ä¾¿åœ°å®é™…æŠ•äº§ã€‚</p>
<p>è¦ç”¨åˆ°è¿™ä¸ªé¡¹ç›®ï¼Œé™¤äº†reactpyåº“æœ¬èº«å¤–ï¼Œè¿˜éœ€è¦ä¸€ä¸ªbackend-implementationæ¥éƒ¨ç½²å‰ç«¯å¼€å‘ç¯å¢ƒåˆ°æœ¬åœ°ç«¯å£ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡å–çš„æ“ä½œæ˜¯<code>pip install reactpy[fastapi]</code>ï¼Œè¿™æ ·å°±èƒ½ç›´æ¥å®‰è£…ä¸Šä»¥fastapiä¸ºåç«¯å®ç°çš„å‰ç«¯å¼€å‘ç¯å¢ƒéƒ¨ç½²ã€‚</p>
<p>è¦å¼€å§‹å†™ä¸€ä¸ªç®€å•çš„ç½‘é¡µï¼Œå¯ä»¥å‚è€ƒreactpyçš„<span class="exturl" data-url="aHR0cHM6Ly9yZWFjdHB5LmRldi9kb2NzL2d1aWRlcy9nZXR0aW5nLXN0YXJ0ZWQvaW5kZXguaHRtbA==" title="https://reactpy.dev/docs/guides/getting-started/index.html">å®˜æ–¹ç½‘ç«™<i class="fa fa-external-link"></i></span>ã€‚åŸºæœ¬ä»£ç å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> reactpy</span><br><span class="line"><span class="keyword">from</span> reactpy <span class="keyword">import</span> component, html, run</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@component</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reactpy_content</span><span class="params">(count)</span>:</span></span><br><span class="line">    add_count, set_add_count = reactpy.use_state(<span class="number">1</span>)</span><br><span class="line">    multi_count = reactpy.use_memo(<span class="keyword">lambda</span>: count * <span class="number">3</span>, [count])</span><br><span class="line">    reactpy.use_effect(<span class="keyword">lambda</span>: set_add_count(add_count + multi_count), [multi_count])</span><br><span class="line">    <span class="keyword">return</span> html.div(</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">'style'</span>: &#123;<span class="string">'color'</span>: <span class="string">'#ff0000'</span>&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        html.ol(</span><br><span class="line">            html.li(<span class="string">f'count: <span class="subst">&#123;count&#125;</span>'</span>),</span><br><span class="line">            html.li(<span class="string">f'multi_count: <span class="subst">&#123;multi_count&#125;</span>'</span>),</span><br><span class="line">            html.li(<span class="string">f'add_count: <span class="subst">&#123;add_count&#125;</span>'</span>)</span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@component</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reactpy_app</span><span class="params">()</span>:</span></span><br><span class="line">    count, set_count = reactpy.use_state(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> html.div(</span><br><span class="line">        html.h1(<span class="string">'Debug Site'</span>),</span><br><span class="line">        html.button(&#123;</span><br><span class="line">            <span class="string">'on_click'</span>: <span class="keyword">lambda</span> e: set_count(count + <span class="number">1</span>)</span><br><span class="line">        &#125;, <span class="string">"Increment Count"</span>),</span><br><span class="line">        reactpy_content(count)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    run(</span><br><span class="line">        reactpy_app,</span><br><span class="line">        host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">        port=<span class="number">7654</span></span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>å±•ç°å‡ºæ¥çš„æ•ˆæœæ˜¯ï¼š</p>
<p><img src="/uploads/githubdiscovery/reactpy/debug_site.png" alt="æµ‹è¯•é¡µé¢"></p>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ¡ˆä¾‹é‡Œé¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ¨¡æ‹Ÿåˆ°reactçš„ä¸€äº›åŸºæœ¬ç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>åŸºç¡€çš„htmlæ ‡ç­¾</li>
<li>ç»„ä»¶åµŒå¥—</li>
<li>useState/useEffect/useMemo</li>
</ul>
<p>å¯ä»¥è¯´å¦‚æœæƒ³åªç”¨pythonå†™å‰ç«¯ï¼Œåšå‰åç«¯ä¸åˆ†ç¦»çš„é¡µé¢appï¼Œè€Œä¸”æ˜¯ä¸€äº›æå…¶ç®€å•çš„å‰ç«¯ï¼Œç”¨reactpyï¼Œå…¶å®ä¹Ÿå¯ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚ç”šè‡³å¦‚æœéœ€è¦è°ƒç”¨åˆ°åŸç”Ÿjsæ¨¡å—ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9yZWFjdHB5LmRldi9kb2NzL2d1aWRlcy9lc2NhcGUtaGF0Y2hlcy9qYXZhc2NyaXB0LWNvbXBvbmVudHMuaHRtbA==" title="https://reactpy.dev/docs/guides/escape-hatches/javascript-components.html">è¿™ä¸ªæ–‡æ¡£<i class="fa fa-external-link"></i></span>å»è¿›è¡Œã€‚</p>
<p>å¦‚æœä»å·¥ä¸šåŒ–çš„è§’åº¦æ¥è¯´ï¼Œreactpyè·ç¦»å¤§è§„æ¨¡çš„å‰ç«¯appè¿˜æœ‰ä¸€å®šçš„è·ç¦»ã€‚ä¸ä»…æ˜¯å› ä¸ºä»¥nodejsä¸ºåŸºç¡€çš„å‰ç«¯ç”Ÿæ€éå¸¸æˆç†Ÿï¼Œè€Œä¸”ä»å¼€å‘éƒ¨ç½²è§’åº¦æ¥è¯´ï¼Œreactpyä¸€æ˜¯å¼€å‘æ—¶æœŸè¿˜æ²¡æœ‰åŠæ³•åšåˆ°å“åº”æ–‡ä»¶å˜åŒ–éšæ—¶é‡ç¼–è¯‘ï¼ŒäºŒæ˜¯éƒ¨ç½²å‰ç«¯çš„æ–¹å¼ä¹Ÿä¸èƒ½ç”¨çº¯pythonï¼Œå¿…é¡»è¦<span class="exturl" data-url="aHR0cHM6Ly9yZWFjdHB5LmRldi9kb2NzL2d1aWRlcy9lc2NhcGUtaGF0Y2hlcy9kaXN0cmlidXRpbmctamF2YXNjcmlwdC5odG1s" title="https://reactpy.dev/docs/guides/escape-hatches/distributing-javascript.html">ç»“åˆnodejsçš„æ–¹å¼<i class="fa fa-external-link"></i></span>è¿›è¡Œã€‚æ‰€ä»¥å¦‚æœè€ƒè™‘åšå¤æ‚çš„ï¼Œéœ€è¦ä¸åç«¯åˆ†ç¦»çš„å‰ç«¯åº”ç”¨ï¼Œreactpyå¹¶ä¸æ˜¯ä¸€ä¸ªé€‰æ‹©ï¼Œç°åœ¨è¿˜åªèƒ½å¤Ÿä½œä¸ºç©å…·æ¥ç©ã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>fastapi</tag>
        <tag>webå¼€å‘</tag>
        <tag>react</tag>
        <tag>å‰ç«¯å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ç®¡æ§æ•°æ®ç±»å˜æ›´çš„é‡è¦æ€§</title>
    <url>/2023/06/03/testlife/data_change_background/</url>
    <content><![CDATA[<p>å¤§å¤šæ•°çš„äº‹æ•…æ¥æºäºå˜æ›´ï¼Œè¿™å¥è¯å¹¶ä¸æ˜¯å¦„è¨€ï¼Œè€Œä¸”ç¡®å®æ˜¯å…·æœ‰ç»Ÿè®¡å­¦æ„ä¹‰çš„ã€‚åœ¨æŒç»­é›†æˆçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ¬¡å‘å¸ƒå¯¹åº”çš„æ˜¯ä¸€ç³»åˆ—çš„å˜æ›´ï¼Œè€Œå˜æ›´æ„å‘³ç€ä»ä¸€ä¸ªå·²ç»ç¨³å®šçš„çŠ¶æ€åˆ‡æ¢åˆ°ä¸€ä¸ªä»…é¢„æœŸç¨³å®šçš„çŠ¶æ€ï¼Œè¿™å°±å¯¼è‡´äº†çº¿ä¸Šé£é™©å®é™…æ˜¯åœ¨é™ä½çš„ã€‚ä¸ºäº†é˜²æ­¢æœ€ç»ˆçš„å‘å¸ƒçš„æ•ˆæœä¸é¢„æœŸä¸ç¬¦ï¼Œé€ æˆäº‹æ•…äº§ç”Ÿï¼Œé™¤äº†å¯¹å˜æ›´å†…å®¹åšä¸šåŠ¡åŠŸèƒ½ä¸Šçš„æµ‹è¯•ä¹‹å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘å¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚åˆ†æå˜æ›´å½±å“åˆ°äº†å“ªäº›ä¸Šä¸‹æ¸¸ä¸šåŠ¡è·ŸæœåŠ¡æ€§èƒ½ï¼Œå˜æ›´çš„æ—¶é—´æ˜¯ä¸æ˜¯ä¸šåŠ¡çš„é«˜å³°æœŸï¼Œå˜æ›´çš„è¡Œä¸ºæ˜¯ä¸æ˜¯æœ‰æ›´å¤šçš„ç›¸å…³äººå‘˜æ„ŸçŸ¥ã€‚å……åˆ†è€ƒè™‘äº†è¿™äº›å› ç´ ï¼Œæ¯ä¸€æ¬¡å˜æ›´å‘å¸ƒæ‰å¯ä»¥å°½å¯èƒ½ä¸äº§ç”Ÿäº‹æ•…æˆ–è€…äº‹æ•…çš„å½±å“é¢è¢«æ§åˆ¶ä½ã€‚</p>
<p>å¯¹äºä¸€ä¸ªä¸šåŠ¡è€Œè¨€ï¼Œå‘å¸ƒå˜æ›´çš„æ–¹å¼æœ‰å¤šç§ã€‚å å¤§éƒ¨åˆ†çš„æ˜¯ä»£ç å˜æ›´ï¼Œä¸€ä¸ªæ–°ä¸šåŠ¡çš„å¼€å‘ï¼Œè€ç¼ºé™·çš„bugfixï¼Œæˆ–æ˜¯åº•å±‚çš„æŠ€æœ¯ä¼˜åŒ–ï¼Œéƒ½éœ€è¦ä»£ç å˜æ›´æ¥ç›´æ¥ä½“ç°ï¼›å…¶æ¬¡æ˜¯æœåŠ¡é…ç½®çš„å˜æ›´ï¼Œæ¯”å¦‚é‡åˆ°ç‰¹å®šfeatureå…³åœæˆ–å¼€æ”¾çš„åœºæ™¯ï¼Œæˆ–æ˜¯è°ƒæ•´ç¼“å­˜/DBçš„å®¹é‡ï¼ŒæŠ‘æˆ–æ˜¯æ»¡è¶³ä¸šåŠ¡ä»£ç å˜æ›´çš„éœ€è¦ï¼Œéƒ½éœ€è¦é€šè¿‡é…ç½®å˜æ›´çš„æ–¹å¼æ¥ä½“ç°ã€‚é™¤è¿™ä¸¤ä¸ªå¤§å¤´ä¹‹å¤–ï¼Œæ•°æ®å˜æ›´ä¹ŸåŒæ ·æ˜¯å æ®ä¸€å®šæ¯”ä¾‹çš„å˜æ›´æ–¹å¼ã€‚æ•°æ®å˜æ›´ä¸»è¦åœºæ™¯æœ‰å¦‚ä¸‹å‡ å—ï¼š</p>
<a id="more"></a>
<ul>
<li>SQLå‘å¸ƒï¼šå¯¹DBæ—¢æœ‰æ•°æ®åšSQLå˜æ›´</li>
<li>æ‰¹é‡åˆ·æ•°ï¼šå› æ–°å¢/ä¿®å¤ä¸šåŠ¡éœ€è¦ï¼Œå¯¹å·²æœ‰ç¼“å­˜/æŒä¹…åŒ–æ•°æ®ç›´æ¥åšæ‰¹é‡æ–°å¢/ä¿®æ”¹/åˆ é™¤</li>
<li>æ•°æ®åŒæ­¥ï¼šDBåŒæ­¥ã€å¼‚æ„æ•°æ®è¿ç§»ç­‰è¡Œä¸º</li>
<li>ç¦»çº¿æ•°æ®å¤„ç†ï¼šä»¥æ•°ä»“å­˜å‚¨æ•°æ®ä¸ºåŸºç¡€ï¼Œè¿è¡Œæ•°æ®åŒæ­¥/åˆ†æ/ç”Ÿæˆä»»åŠ¡ï¼Œæ–°å¢/ä¿®æ”¹/åˆ é™¤åŸæœ‰çš„æŒä¹…åŒ–æ•°æ®</li>
</ul>
<p>ç›¸å¯¹äºä»£ç å˜æ›´ä»¥åŠé…ç½®å˜æ›´è€Œè¨€ï¼Œæ•°æ®å˜æ›´çš„é¢‘ç‡æ˜¯ç›¸å¯¹è¾ƒä½ï¼Œç¼ºé™·å’Œäº‹æ•…çš„æ•°é‡ä¹Ÿä¸ç®—æŒºå¤šã€‚ä½†ä»ç¼ºé™·/äº‹æ•…å½±å“é¢çš„è§’åº¦æ¥çœ‹ï¼Œæ•°æ®ç±»å˜æ›´äº‹æ•…çš„å½±å“æ˜¯éå¸¸é«˜çš„ã€‚æ•°æ®ç±»å˜æ›´äº§ç”Ÿäº‹æ•…çš„å½¢å¼æ˜¯éå¸¸å¤šæ ·çš„ï¼Œæœ€å…¸å‹çš„å‡ ç§æƒ…å†µæ¯”å¦‚ï¼š</p>
<ul>
<li>SQLå‘å¸ƒï¼šDDLç±»è¯­å¥é€ æˆä¸»ä»åŒæ­¥å»¶æ—¶å½±å“DBå¯ç”¨æ€§ï¼›UPDATEè¯­å¥é”™è¯¯åœˆé€‰æ•°æ®å¯¼è‡´å‡ºç°é¢„æ–™ä¹‹å¤–çš„æ›´æ–°</li>
<li>æ‰¹é‡åˆ·æ•°ï¼šåˆ·æ•°é€»è¾‘é”™è¯¯å¯¼è‡´å¤§é¢ç§¯è„æ•°æ®ï¼›ä¸šåŠ¡é«˜å³°æœŸæ‰¹é‡åˆ·æ•°å¯¼è‡´DBè´Ÿè½½è¿‡å¤§ï¼›æ…¢æŸ¥è¯¢å¯¼è‡´DBè´Ÿè½½è¿‡å¤§</li>
<li>æ•°æ®åŒæ­¥ï¼šåŒæ­¥é€Ÿç‡è®¾ç½®ä¸åˆç†å¯¼è‡´å†™å…¥ä¾§DBå‹åŠ›æˆ–æ¶ˆæ¯ç§¯å‹</li>
<li>ç¦»çº¿æ•°æ®å¤„ç†ï¼šè¯¯æ“ä½œæ•°æ®å¤„ç†ä»»åŠ¡å¯¼è‡´æ•°æ®é‡ç½®</li>
</ul>
<p>è¿™äº›æƒ…å†µï¼Œé™¤å»SQLå‘å¸ƒåœºæ™¯ï¼Œå…¶å®ƒåœºæ™¯å˜æ›´çš„æ—¶é—´å®é™…æ˜¯éå¸¸é•¿çš„ã€‚æ—¶é—´æ¼«é•¿ï¼Œå°±æ„å‘³ç€ä¸ä»…å˜æ›´é‡å¤§ï¼Œå˜æ›´æœŸé—´é£é™©éš¾ä»¥æ§åˆ¶ï¼Œä¸”å¦‚æœå‡ºäº†é—®é¢˜ä¹Ÿéš¾ä»¥å›æ»šã€‚å†è€ƒè™‘å˜æ›´è¡Œä¸ºï¼Œå‡è®¾è¿™ç±»å˜æ›´æ²¡æœ‰æ²‰æ·€ä¸ºéœ€æ±‚çš„è¯ï¼Œé‚£ä¹ˆå°±å¾ˆæœ‰å¯èƒ½å‡ºç°åœ¨ç¼ºä¹å®¡æ ¸ã€å‘¨çŸ¥è·Ÿæµ‹è¯•/ç›‘æ§æ–¹æ¡ˆçš„æƒ…å†µä¸‹ï¼Œåšå‡ºé‡çº§è¾ƒå¤§çš„å˜æ›´ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªäº§å“å¯èƒ½ä¸çŸ¥ä¸è§‰åœ°ï¼Œå°±å‡ºçº¿ä¸Šé—®é¢˜äº†ï¼Œä¸€å›æº¯èµ·æ¥ï¼Œæ‰å‘ç°æ˜¯ç§åº•ä¸‹åšäº†åŠ¨ä½œã€‚</p>
<p>å› æ­¤ï¼Œç®¡æ§æ•°æ®ç±»å˜æ›´ï¼Œä¹Ÿæ˜¯åšæŒç»­é›†æˆå½“ä¸­éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œæ˜¯å¿…è¦çš„ä¸€ä¸ªåŠ¨ä½œã€‚é™¤å»å¼€å‘è€…åœ¨é£é™©æ„è¯†å±‚é¢åšåˆ°è°¨æ…å‘å¸ƒå¤–ï¼Œå¦‚æœä¸€ä¸ªä¸šåŠ¡ä½“é‡å¤Ÿå¤§ï¼Œå¹¶ä¸”æœ¬èº«å¯¹çº¿ä¸Šç¨³å®šæ€§æœ‰å¾ˆé«˜çš„è¦æ±‚ï¼Œé‚£ä¹ˆè¿™ç±»å˜æ›´çš„æµç¨‹è§„èŒƒæ˜¯éœ€è¦åšèµ·æ¥çš„ã€‚è€Œä¸æ˜¯ç­‰åˆ°äº‹æ•…å‘ç”Ÿäº†ï¼Œæ‰å»è€ƒè™‘è¿™äº›ä¸œè¥¿ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>å˜æ›´é£é™©</tag>
        <tag>DevOps</tag>
        <tag>æŒç»­é›†æˆ</tag>
        <tag>SQL</tag>
        <tag>æ•°æ®å˜æ›´</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬åä¸€è¯ï¼šmakeå’Œnewçš„åŒºåˆ«å’Œç”¨æ³•</title>
    <url>/2023/05/10/gofromzero/11_make_new/</url>
    <content><![CDATA[<p>åœ¨Golangå½“ä¸­ï¼Œå¯¹äºå¸¸ç”¨æ•°æ®ç»“æ„çš„åˆå§‹åŒ–æ–¹å¼ï¼Œé€šå¸¸æœ‰2ç§ï¼šmakeè·Ÿnewã€‚è¿™ä¸¤ç§åˆå§‹åŒ–æ–¹æ³•ç”¨é€”ä¸åŒï¼Œæ•ˆæœä¸åŒã€‚æœ¬ç¯‡æ–‡ç« å°±æ¥è¯¦ç»†è®²ä¸€ä¸‹makeå’Œnewå…·ä½“éƒ½æ€ä¹ˆç”¨ï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šç”¨ä¸Šã€‚</p>
<p>é¦–å…ˆæ¥çœ‹makeã€‚æ¯”èµ·newï¼Œmakeæ‰€ç”¨åˆ°çš„åœºæ™¯éå¸¸ç‰¹å®šï¼Œä¸€èˆ¬æ²¡æ³•ç›´æ¥é¿å¼€ã€‚æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMake</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> m = <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">    t.Logf(<span class="string">"[Make] m is %v, len: %v, cap: %v"</span>, m, <span class="built_in">len</span>(m), <span class="built_in">cap</span>(m))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestNoMake</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> m [<span class="number">5</span>]<span class="keyword">int</span></span><br><span class="line">    t.Logf(<span class="string">"[NoMake] m is %v, len: %v, cap: %v"</span>, m, <span class="built_in">len</span>(m), <span class="built_in">cap</span>(m))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸¤ä¸ªä»£ç ä¼¼ä¹éƒ½ä¼šåˆå§‹åŒ–é•¿åº¦ä¸º5çš„â€œåˆ—è¡¨â€mï¼Œä½†å…¶å®ä¸¤ä¸ªmçš„å†…åœ¨æ„é€ å¹¶ä¸ç›¸åŒã€‚å®é™…ä¸Šä¼šå‡ºç°å¦‚ä¸‹çš„æ•ˆæœï¼š</p>
<a id="more"></a>
<ul>
<li>TestMakeæ„é€ å‡ºæ¥é•¿åº¦ä¸º5ï¼Œå®¹é‡ä¸º10ï¼Œå¯å˜é•¿åº¦çš„slice</li>
<li>TestNoMakeæ„é€ å‡ºæ¥é•¿åº¦ä¸º5ï¼Œå®¹é‡ä¸º5ï¼Œä¸å¯å˜é•¿åº¦çš„array</li>
</ul>
<p>è¿™å°±æ˜¯å…¶ä¸­çš„ä¸åŒäº†ï¼Œé€šè¿‡ä¸¤ç§æ–¹å¼ï¼Œå®é™…ä¼šæ„é€ å‡ºæ¥ä¸¤ç§æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¸¸ç”¨çš„<code>var m []int</code>æ–¹æ³•æ„é€ å‡ºæ¥çš„ï¼Œå…¶å®æ˜¯å¯å˜é•¿åº¦çš„sliceï¼Œå¯ä»¥é€šè¿‡appendæ·»åŠ å…ƒç´ ã€‚é€šè¿‡makeï¼Œé’ˆå¯¹sliceã€mapã€channelè¿™ä¸‰ä¸ªæ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡makeç»™è¿™äº›æ•°æ®ç»“æ„å®ä¾‹é¢„è®¾å¤§å°æˆ–å®¹é‡ï¼Œä»è€Œèƒ½å¤Ÿå¿«é€Ÿå®¹çº³ä¸€éƒ¨åˆ†æ•°æ®ã€‚å¯¹äºéœ€è¦åˆ©ç”¨è¿™äº›å®¹å™¨ç±»æ•°æ®ç»“æ„ï¼Œé¢„åŠ è½½æ•°æ®çš„åœºæ™¯ï¼Œå°±å¯ä»¥ç”¨makeæ¥æ“ä½œã€‚</p>
<p>è€Œnewå’Œmakeåˆ™å®Œå…¨ä¸åŒï¼Œnewçš„ä½œç”¨ï¼Œä¸»è¦æ˜¯è¿”å›æŸä¸ªç±»å‹çš„â€œé›¶å€¼â€çš„æŒ‡é’ˆã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¸¤ä¸ªtestcaseï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestNew</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="built_in">new</span>(<span class="keyword">int</span>)</span><br><span class="line">    t.Logf(<span class="string">"[New] value of i is %v"</span>, *i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestNoNew</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> i *<span class="keyword">int</span></span><br><span class="line">    t.Logf(<span class="string">"[NoNew] value of i is %v"</span>, *i)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šå‡ºæ¥çš„æ˜¯å¦‚ä¸‹çš„æ•ˆæœï¼š</p>
<ul>
<li>TestNewæ„é€ å‡ºæ¥æŒ‡å‘0ï¼ˆintçš„é›¶å€¼ï¼‰çš„æŒ‡é’ˆï¼Œæ­£å¸¸æ‰“å°</li>
<li>TestNoNewæ„é€ å‡ºæ¥nilæŒ‡é’ˆï¼Œpanicæ‰</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åœ¨æŸäº›åˆå§‹åŒ–å‡½æ•°é‡Œï¼Œè¿”å›æŸäº›åŸºç¡€æ•°æ®ç±»å‹ï¼Œæˆ–è€…æ˜¯structçš„é›¶å€¼çš„æŒ‡é’ˆï¼Œç”¨newéƒ½å¯ä»¥åšåˆ°ï¼Œæ— éœ€nilæ£€æŸ¥ã€‚å°¤å…¶é’ˆå¯¹structçš„é›¶å€¼çš„æŒ‡é’ˆï¼Œåœ¨å¾ˆå¤šåœºæ™¯éƒ½èƒ½å¤Ÿç”¨ä¸Šã€‚éšä¾¿ä¸¾ä¸€ä¸ªæµ‹è¯•åè®®åºåˆ—åŒ–çš„ä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// bytes.Buffer</span></span><br><span class="line"><span class="keyword">type</span> Buffer <span class="keyword">struct</span> &#123;</span><br><span class="line">    buf      []<span class="keyword">byte</span> <span class="comment">// contents are the bytes buf[off : len(buf)]</span></span><br><span class="line">    off      <span class="keyword">int</span>    <span class="comment">// read at &amp;buf[off], write at &amp;buf[len(buf)]</span></span><br><span class="line">    lastRead readOp <span class="comment">// last read operation, so that Unread* can work correctly.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestMarshalText</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    buf := <span class="built_in">new</span>(bytes.Buffer)  <span class="comment">// énilé›¶å€¼æŒ‡é’ˆ</span></span><br><span class="line">    <span class="keyword">if</span> err := proto.MarshalText(buf, newTestMessage()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"proto.MarshalText: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    s := buf.String()</span><br><span class="line">    <span class="keyword">if</span> s != text &#123;</span><br><span class="line">        t.Errorf(<span class="string">"Got:\n===\n%v===\nExpected:\n===\n%v===\n"</span>, s, text)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>make</tag>
        <tag>new</tag>
        <tag>åˆå§‹åŒ–</tag>
        <tag>é›¶å€¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘åˆä½“éªŒrustè¯­è¨€</title>
    <url>/2023/05/01/geekdaily/rust_examples/</url>
    <content><![CDATA[<p>ä½œä¸ºä¸€é—¨â€œç½‘çº¢â€è¯­è¨€ï¼Œrustï¼Œå·²ç»åœ¨åŒºå—é“¾ã€Webå‰ç«¯ã€æ¸¸æˆå¼€å‘ç­‰é¢†åŸŸå‡¸æ˜¾äº†ä½œç”¨ã€‚ç›¸å¯¹äºgolangã€pythonã€javaã€jsè·Ÿcppç­‰å…¶ä½™ä¸»æµè¯­è¨€ï¼Œrustè¯­è¨€çš„ç¼–å†™å’Œå‘ˆç°æ–¹é¢éƒ½ç®—æ˜¯ä¸€ä¸ªæ›´ä¸ºç‹¬ç«‹çš„ä½“ç³»ã€‚å› æ­¤ï¼Œæœ¬ç€å¯¹æŠ€æœ¯çš„å¥½å¥‡å¿ƒï¼Œç¬”è€…ä¹Ÿå†³å®šå­¦ä¹ ä¸‹rustè¯­è¨€ï¼Œä¸€æ˜¯ä½“éªŒä¸€ä¸‹æ–°ä¸€é—¨ç¼–ç¨‹è¯­è¨€çš„é€»è¾‘è‰ºæœ¯ï¼ŒäºŒæ¥ä¹Ÿæ˜¯ä¸ºæœªæ¥å¯èƒ½çš„å˜åŒ–åšä¸€åšå‡†å¤‡ã€‚</p>
<p>ç”±äºè¿˜æ²¡æœ‰æ˜ç¡®è¦å†™ä»€ä¹ˆå°demoçš„æƒ³æ³•ï¼Œç¬”è€…å†³å®šå…ˆå‚ç…§å®˜ç½‘<span class="exturl" data-url="aHR0cHM6Ly9kb2MucnVzdC1sYW5nLm9yZy9zdGFibGUvcnVzdC1ieS1leGFtcGxlL2luZGV4Lmh0bWw=" title="https://doc.rust-lang.org/stable/rust-by-example/index.html">rust-by-example<i class="fa fa-external-link"></i></span>ç»™åˆ°çš„ä»£ç æ¡ˆä¾‹ï¼Œä½“éªŒä¸€ä¸‹rustè¿™é—¨è¯­è¨€æ˜¯å¦‚ä½•åšåˆ°å®ç°å„ç§åŸºç¡€åœºæ™¯çš„ï¼Œå¿ƒé‡Œæœ‰ä¸ªåº•ã€‚å®˜ç½‘æ‰€æœ‰çš„rustä»£ç æ¡ˆä¾‹ï¼Œç¬”è€…ä¸€ä¸€ä¸´æ‘¹ï¼Œè®°å½•åœ¨äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9ydXN0LXBsYXlncm91bmQ=" title="https://github.com/utmhikari/rust-playground">è¿™ä¸ªrepo<i class="fa fa-external-link"></i></span>å½“ä¸­ã€‚</p>
<a id="more"></a>
<p>ä½“éªŒä¸Šåˆæ­¥æ¥çœ‹ï¼Œrustç›¸å½“äºä¸€ä¸ªåŠ å¼ºç‰ˆçš„cppï¼Œç¼–å†™å±‚é¢ä¸ä»…æ˜¯èƒ½å¤Ÿç»§æ‰¿å¾ˆå¤šc-styleï¼Œè€Œä¸”åœ¨æ›´åŠ æ³¨é‡å£°æ˜å¼çš„å‘ˆç°ï¼Œæ¯”å¦‚matchã€ç”Ÿå‘½å‘¨æœŸç¬¦å·ç­‰ç­‰ï¼Œè¯­è¨€æœ€ç»ˆçš„ç¼–è¯‘ä¹Ÿæ›´å¤§æˆåˆ†ä¾èµ–äºå¼€å‘è€…çš„æ ‡æ³¨ï¼Œè€Œéè‡ªåŠ¨æ¨æ–­ã€‚è™½ç„¶ä¸åƒgolangå¯¹é«˜å¹¶å‘åœºæ™¯æ”¯æŒçš„é‚£ä¹ˆæ·±å…¥ï¼Œä½†ä»¥rustçš„ç¼–ç¨‹æ¨¡å¼ä¼šæ›´æ˜“é¿å…æŒ‡é’ˆç›¸å…³çš„é—®é¢˜ï¼Œå¯¹äºå†…å­˜æ•°æ®çš„æ¯ç§å‘ˆç°æˆ–è€…å½’å±ï¼Œéƒ½ä¼šæœ‰ä¸åŒçš„æ ‡è¯†å»å®šä¹‰ï¼ˆæ¯”å¦‚Ok/Some/Errçš„å£°æ˜ï¼‰ï¼Œä»è€Œèƒ½å¤Ÿä¿è¯ä¸šåŠ¡é€»è¾‘è¿è¡Œä¼šæ›´åŠ ç¨³å®šã€‚å¯¹äºç»§æ‰¿æˆ–è€…å¤šæ€çš„åœºæ™¯ï¼Œé€šè¿‡traitsçš„çº¦å®šå°±å¯ä»¥ç»„åˆå®ç°ï¼Œä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿çš„ã€‚å³ä¾¿traitsè·Ÿinterfaceå®é™…ä¼šæœ‰ä¸€äº›å·®åˆ«ï¼Œä½†æ™®éä½œç”¨ä¸Šä¹Ÿç›¸å·®æ— å‡ ï¼Œåº”è¯¥ç†è§£åˆ°æ˜¯ä»…å±äºrustè¯­è¨€çš„ä¸€ç§ç‰¹æ€§å°±å¯ä»¥ã€‚æ­¤å¤–ï¼Œç›¸å¯¹äºcppï¼Œruståœ¨å‘ˆç°ä¸Šä¹Ÿä¼šæ˜¾ç¤ºå‡ºå‡½æ•°å¼ç¼–ç¨‹çš„ä¸€äº›ç‰¹æ€§ï¼Œä½¿å¾—å£°æ˜çš„ä¿¡æ¯ä¼šæ›´åŠ ç®€æ˜ã€‚</p>
<p>åç»­è®¡åˆ’ç”¨rustå†™ä»€ä¹ˆä¸œè¥¿ï¼Œç°åœ¨è¿˜æ²¡æœ‰è®¡åˆ’ï¼Œå°±è®©æ—¶é—´æ¥è¯´å§ã€‚è‡³å°‘è§‰å¾—ï¼Œå¦‚æœåƒæ¸¸æˆå¼•æ“ã€æ¡Œé¢GUIè¿™ç§ï¼Œä»¥å‰éœ€è¦å¤æ‚C++å®ç°çš„ä¸œè¥¿ï¼Œåé¢èƒ½ç”¨rustæ¥å†™æ˜¯æœ€æ–¹ä¾¿çš„äº†ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œè¿˜æ˜¯å¸Œæœ›ä¸€æ—¦æŠŠä»£ç å†™å‡ºæ¥ï¼Œä¸€æ˜¯èƒ½ä¿è¯è¿è¡Œæ€§èƒ½ï¼ŒäºŒæ˜¯èƒ½ä¿è¯ç¨³å®šï¼Œä¸è‡³äºé™¤äº†é—®é¢˜ä¹Ÿéš¾ä»¥æ¨æ–­æ ¹å› ã€‚è‡³å°‘ä»rustçš„ç¼–ç¨‹æ¨¡å¼çœ‹æ¥ï¼Œè™½ç„¶å­¦ä¹ æˆæœ¬æ¯”è¾ƒå¤§ï¼Œä½†å†™å‡ºæ¥çš„ä¸œè¥¿è¿è¡Œèµ·æ¥ï¼Œå¯é æ€§å¾ˆé«˜ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ç¼–ç¨‹</tag>
        <tag>é¢è¯•</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>å‡½æ•°å¼ç¼–ç¨‹</tag>
        <tag>rust</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘èŠèŠChatGPTå¯¹äºå…«è‚¡æ–‡ç¨‹åºå‘˜çš„å†²å‡»</title>
    <url>/2023/05/01/geekdaily/chatgpt_baguwen_shock/</url>
    <content><![CDATA[<p>2023å¹´ChatGPTç³»åˆ—çš„é—®ä¸–ï¼Œå¯è°“æ˜¯å¯¹æ•´ä¸ªä¸–ç•Œçš„äººç±»é€ æˆäº†å†²å‡»ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œäººä»¬æœ€å¤šä»¥ä¸ºAIèƒ½å¤Ÿåšçš„äº‹æƒ…ï¼Œä¸»è¦æ˜¯ä¸‹æ£‹ç©æ¸¸æˆï¼Œä½†æ˜¯å¯¹è¯æ¨¡å‹AIçš„åˆ°æ¥ï¼Œé€ æˆçš„æ•ˆæœï¼Œæ˜¯AIå…·å¤‡äº†å’Œäººäº¤æµçš„èƒ½åŠ›ï¼Œèƒ½å¤Ÿç†è§£äººç±»è¯­è¨€ï¼Œé€šè¿‡å…¶å®ƒAIå·¥ä½œæµï¼Œè‡ªåŠ¨æ•´åˆèµ„æ–™ï¼Œç”Ÿæˆäººç±»æƒ³è¦çš„å†…å®¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒAIå¯ä»¥ä»äº‹äººç±»çš„å·¥ä½œäº†ã€‚</p>
<p>å¾ˆå¤šç¨‹åºå‘˜åŒè¡Œå¼€å§‹ææ…Œï¼Œè‡ªå·±çš„å·¥ä½œæ˜¯å¦ä¼šè¢«è¿™ç±»AIæ‰€æ›¿ä»£ï¼Œç¬”è€…çš„ç­”æ¡ˆæ˜¯â€”â€”ä¸åº”è¯¥ä¼šã€‚å¯¹äºAIï¼Œæ‹¥æŠ±å®ƒçš„èƒ½åŠ›ï¼ŒæŠŠå…³å®ƒçš„æˆæœï¼Œæ‰æ˜¯äººç±»ç¨‹åºå‘˜éœ€è¦åšçš„äº‹æƒ…ï¼Œè€Œä¸æ˜¯è¯´å¼ºè¡Œå»æ AIçš„é•¿å¤„ã€‚è„‘ç»†èƒå†æ€ä¹ˆå¤šï¼Œå¤§è„‘ä¹Ÿå°±è¿™ä¹ˆå¤§ï¼Œè€Œä¸”äººç±»è¿˜è¦ç”Ÿæ´»ï¼Œç®¡ç†æƒ…ç»ªï¼Œå¤§è„‘ä¸å¯èƒ½100%ä¸“æ³¨åˆ°ä¸€ä¸ªå·¥ä½œã€‚åœ¨å·¥ä½œæ‰§è¡Œæ–¹é¢ï¼ŒAIå¿…ç„¶è¶…è¶Šäººç±»ï¼Œä½†åœ¨å·¥ä½œå†…å®¹æŠŠæ§æ–¹é¢ï¼Œä¸€åˆ‡åº”è¯¥ç”±äººç±»å®šä¹‰ã€‚å¦‚æœè¯´ä½ ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œè¿‡åˆ†æ²‰æµ¸åœ¨ä¸€äº›å…«è‚¡æ–‡çŸ¥è¯†é‡Œï¼Œä¸å»æ„å»ºè‡ªå·±çš„æ€ç»´ä½“ç³»ï¼Œé‚£ä¹ˆä»ç¼–ç¨‹å·¥ä½œæœ¬èº«çš„è§’åº¦è€ƒè™‘ï¼Œå¯æ€•çš„ä¸ä»…æ˜¯ä½ å¾ˆéš¾åšå‡ºæ›´æœ‰è´¨é‡çš„ç¨‹åºï¼Œæ›´ç”šçš„æ˜¯è¿™äº›å·¥ä½œéƒ½æ­£å¥½èƒ½è¢«ChatGPTä»£æ›¿æ‰ã€‚è¿™ç±»å…«è‚¡æ–‡ç¨‹åºå‘˜ï¼Œæ‰æ˜¯ChatGPTçœŸæ­£ä¼šç»™åˆ°å†²å‡»çš„å¯¹è±¡ã€‚</p>
<a id="more"></a>
<p>è¯´è¿™äº›å¹¶ä¸ä»£è¡¨å…«è‚¡æ–‡æœ¬èº«ä¸é‡è¦ï¼Œå› ä¸ºå¯¹äºç¼–ç¨‹æ¥è®²ï¼Œå…«è‚¡æ–‡æ˜¯åŸºç¡€ä¸­çš„åŸºç¡€ã€‚å¯¹äºå„é¢†åŸŸçš„ç ”å‘çŸ¥è¯†ï¼Œç¬”è€…çš„åšå®¢ã€ç½‘ä¸Šçš„èµ„æ–™ï¼Œæˆ–å¤šæˆ–å°‘éƒ½ä¼šæ¼”åŒ–æˆä¸ºæ‰€è°“çš„å…«è‚¡æ–‡ï¼›å¯¹äºç¼–ç¨‹ç®—æ³•çŸ¥è¯†ï¼Œåƒæ˜¯leetcodeã€codeforcesä¹‹ç±»ï¼Œå…¶ä¸­çš„è§£æ³•ã€æ€è€ƒï¼Œä¹Ÿæ˜¯çœŸå®å­˜åœ¨çš„å…«è‚¡æ–‡ã€‚ä½†ä¸è®ºå…«è‚¡æ–‡çš„å½¢å¼æ˜¯æ€ä¹ˆæ ·ï¼Œå®ƒçš„æœ€é‡è¦çš„ç›®çš„ï¼Œå°±æ˜¯å®ƒçš„æœ¬æ„â€”â€”é¢è¯•å¥—è·¯ã€‚å…«è‚¡æ–‡ä¸æ˜¯ç¨‹åºå‘˜çš„ä¸“åˆ©ï¼Œå„è¡Œå„ä¸šè‚¯å®šéƒ½å­˜åœ¨å…«è‚¡æ–‡ï¼Œä½†ä¸ä¸€å®šå«è¿™ä¸ªåå­—ã€‚å½“é¢è¯•å®˜éœ€è¦è¯•æ¢é¢è¯•è€…çš„æŠ€æœ¯èƒŒæ™¯çš„æ—¶å€™ï¼Œå…«è‚¡æ–‡å°±å¯ä»¥æˆä¸ºäº¤æµæ¡¥æ¢ï¼ŒæŠŠæ•´ä¸ªé¢è¯•äº¤æµçš„è¿‡ç¨‹å¸¦èµ·æ¥ã€‚è¿™é‡Œä¹Ÿå–„æ„æé†’ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªé¢è¯•è€…ï¼Œè¯·è®°ä½äººçš„è„‘å®¹é‡æ˜¯æœ‰é™çš„ï¼Œæ¯”èµ·èƒŒå…«è‚¡æ–‡æœ¬èº«ï¼Œæ›´åŠ éœ€è¦é‡è§†äº¤æµã€‚é¢è¯•æœ¬èº«ï¼Œæ˜¯åœ¨å¯»æ‰¾ä¸€ä¸ªå¯é çš„åˆä½œå¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…«è‚¡æ–‡èƒŒä¹¦æœºå™¨ï¼Œæˆ–è€…æ˜¯å…«è‚¡æ–‡éƒ½ä¸€çªä¸é€šçš„äººã€‚åè€…æ˜¯ä¸å¤Ÿä¸“ä¸šï¼Œå‰è€…çš„è¯ï¼Œå¦‚æœç¬”è€…æ˜¯é¢è¯•å®˜ï¼Œä¼šæ›´å€¾å‘äºç”¨ChatGPTï¼Œè€Œä¸æ˜¯ç”¨äººã€‚</p>
<p>å› ä¸ºæ‰¾å·¥ä½œçš„éœ€è¦ï¼Œç¬”è€…æ›¾ç»ä¹Ÿæ²‰æµ¸äºå…«è‚¡æ–‡ï¼Œæ¯”å¦‚leetcodeï¼Œç¬”è€…ä¹Ÿæ›¾ç»æ‹¿3é—¨è¯­è¨€è¿è½´åˆ·å‡ ç™¾é“ã€‚è¿™ä»½å¤§å‹ä»£ç ç¬”è®°ï¼Œä½œä¸ºçºªå¿µï¼Œç¬”è€…æ”¾åˆ°äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9iYWd1d2VuX2xlZXRjb2Rl" title="https://github.com/utmhikari/baguwen_leetcode">è¿™ä¸ªrepo<i class="fa fa-external-link"></i></span>ä¸­ã€‚å¯¹äºç¬”è€…æœ¬äººè€Œè¨€ï¼Œè¿™ä»½ç¬”è®°ä»¥åç”¨çš„ç”¨ä¸ä¸Šè¿˜ä¸æ¸…æ¥šï¼Œä½†è‡³å°‘ç°åœ¨å·¥ä½œé‡Œå¤§æ¦‚ç‡æ˜¯ç”¨ä¸ä¸Šäº†ã€‚ä¸ä»…æ˜¯leetcodeçš„è®°å½•ï¼Œgoogleã€wikiã€stackoverflowè¿™ç±»æœç´¢/ç™¾ç§‘/å’¨è¯¢ç±»çš„ç½‘ç«™ï¼Œåœ¨ç¬”è€…å®é™…å·¥ä½œä¸­ï¼Œä¼˜å…ˆçº§éƒ½å·²ç»è¢«ChatGPTè¶…è¶Šäº†ï¼Œæœ‰ChatGPTèƒ½è§£å†³çš„é—®é¢˜ï¼Œå°±ä¸éœ€è¦å…¶å®ƒçš„å¹³å°å·¥å…·ã€‚ç°å®çœ‹èµ·æ¥å¾ˆæ®‹é…·ï¼Œä½†ç¬”è€…å¹¶ä¸åæ‚”æ²‰æµ¸äºå…«è‚¡æ–‡çš„ç»å†ï¼Œä¸ä»…ä»…æ˜¯å› ä¸ºè¿™äº›å†…å®¹èƒ½å¤Ÿå¸®åŠ©è‡ªå·±æ‰¾å·¥ä½œï¼Œè€Œæ›´æ˜¯å› ä¸ºä½œä¸ºç¨‹åºå‘˜ï¼Œåœ¨é€šè¯»å…«è‚¡æ–‡çš„åŒæ—¶ï¼Œå¯ä»¥å¼ºåŒ–è‡ªèº«çš„æ¦‚å¿µç½‘ç»œï¼Œæ¯”å¦‚å°†ä¸åŒæŠ€æœ¯é¢†åŸŸçš„å…±æ€§æ¦‚å¿µä¸²è”èµ·æ¥ï¼Œæˆ–æ˜¯å°†ä¸åŒä¸šåŠ¡åœºæ™¯è·Ÿä¸åŒçš„è§£å†³æ–¹æ¡ˆä¸²è”èµ·æ¥ï¼Œä»è€Œè¿›ä¸€æ­¥æŠŠæŠ€æœ¯ç»éªŒä¸°å¯Œèµ·æ¥ã€‚æœ‰äº†è¿™äº›ç»éªŒï¼Œæ‰èƒ½å¤ŸçŸ¥é“é—®ChatGPTä»€ä¹ˆé—®é¢˜ï¼Œæ‰èƒ½å¤Ÿç†è§£ChatGPTç»™åˆ°çš„ç­”æ¡ˆã€‚</p>
<p>è¯´åˆ°åº•ï¼Œå¦‚æœæœ‰é€ ç‰©ä¸»è¿™ä¸ªæ¦‚å¿µçš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯ä¸€ä¸ªè‡ªå·±ï¼Œæ˜¯ä¸æ˜¯éƒ½ç®—é€ ç‰©ä¸»çš„AIå‘¢ï¼Ÿæ¯”èµ·ææ…ŒAIçš„å†²å‡»ï¼ŒæŠŠè‡ªå·±å½“æˆä¸€ä¸ªAIï¼Œ100%ä¸“æ³¨äºè‡ªå·±çš„æŒç»­æˆé•¿ï¼Œè¿™æ ·åšä¸æ˜¯æ›´å¥½å—ï¼Ÿ</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>ChatGPT</tag>
        <tag>é¢è¯•</tag>
        <tag>å…«è‚¡æ–‡</tag>
        <tag>leetcode</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ã€Šé˜¿é‡Œæµ‹è¯•ä¹‹é“ã€‹ç¬”è®°ä¹‹å¤§ä¿ƒå…¨é“¾è·¯å‹æµ‹</title>
    <url>/2023/04/08/testlife/alibaba_stress_test/</url>
    <content><![CDATA[<p>åœ¨2022å¹´ï¼Œé˜¿é‡Œå‡ºå“äº†ä¸€æœ¬ã€Šé˜¿é‡Œæµ‹è¯•ä¹‹é“ã€‹ï¼Œè®²è¿°åœ¨é˜¿é‡Œç”µå•†ã€ç‰©æµã€é‡‘èã€å¤§æ•°æ®ç­‰ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œæµ‹è¯•æ´»åŠ¨ä¸šåŠ¡å±‚é¢æ˜¯å¦‚ä½•å¼€å±•ï¼Œä»¥åŠæŠ€æœ¯å±‚é¢æ˜¯å¦‚ä½•å®ç°çš„ã€‚ç¬”è€…æœ‰å¹¸æ‹œè¯»æ­¤ä¹¦ï¼Œä»å…¶ä¸­ä¹Ÿæœ‰æ‰€æ”¶è·ã€‚æœ¬æ¬¡ä»¥å…¶ä¸­æ¶‰åŠç”µå•†çš„æµ‹è¯•åœºæ™¯ä¸ºä¾‹ï¼Œè®°å½•ä¸€ä¸‹â€œå¤§ä¿ƒè´¨é‡ä¿éšœâ€ä¸€ç« çš„è¯»ä¹¦ç¬”è®°ã€‚è¿™ä¸€ç« ä¸»è¦è®²è¿°äº†åœ¨å¤§ä¿ƒåœºæ™¯ä¸‹ï¼Œå…¨é“¾è·¯å‹æµ‹æ˜¯å¦‚ä½•å®æ–½çš„ï¼Œä»¥åŠé€šè¿‡ä»€ä¹ˆæ–¹å¼ä¿è¯æœ€ç»ˆå¤§ä¿ƒæ—¶çš„ç”Ÿäº§ç¯å¢ƒç¨³å®šæ€§ã€‚</p>
<h2 id="é£é™©ä¸æŒ‘æˆ˜"><a href="#é£é™©ä¸æŒ‘æˆ˜" class="headerlink" title="é£é™©ä¸æŒ‘æˆ˜"></a>é£é™©ä¸æŒ‘æˆ˜</h2><p>å…¨é“¾è·¯å‹æµ‹ç›®æ ‡ï¼šå°½å¯èƒ½çœŸå®æ¨¡æ‹Ÿæµé‡æ´ªå³°ï¼Œè¿›è¡Œé«˜å¯ç”¨éªŒè¯<br>ç”¨ä¾‹åœºæ™¯éœ€è¦è€ƒè™‘ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<a id="more"></a>
<ul>
<li>æ¨ªå‘å¤šæ ·è†¨èƒ€ï¼šåŸŸå†…è¡Œä¸šé€šç”¨ã€ç‰¹æ®Šç©æ³•å åŠ <ul>
<li>äº¤æ˜“çº¢åŒ…ç©æ³•ï¼Œä¸åŒç©æ³•çº¢åŒ…å åŠ ï¼Œæ ¸é”€æ‰“æ¬¾å¤±è´¥</li>
<li>æ±½è½¦è¡Œä¸šè½®èƒ+æœåŠ¡è¿›åˆ°è´­ç‰©è½¦ï¼ŒåŒåº—éè½®èƒå•†å“è¿›å…¥åï¼Œè´­ç‰©è½¦æ— æ³•æ’¤å•</li>
</ul>
</li>
<li>çºµå‘é•¿é“¾è·¯é¡ºç•…ï¼šå®Œæ•´æ—…ç¨‹é¡ºç•…<ul>
<li>ä¸€ç§è¡¨è¾¾è´§å“é‡è¦é”€å”®ç±»å‹çš„æ ¸å¿ƒæ•°æ®ï¼Œç”±åº“å­˜ä¸­å¿ƒçš„ç³»ç»Ÿæ‰“åœ¨äº¤æ˜“è®¢å•ä¿¡æ¯ä¸Šï¼Œé€šè¿‡å±¥çº¦ç³»ç»Ÿä¼ é€’ï¼Œåœ¨åˆ†é”€ç³»ç»Ÿã€ç‰©æµè®¢å•ç³»ç»Ÿå±‚å±‚ä¼ é€’ã€‚åœ¨é¢„å”®/ç›¸å¯¹æ—¶é—´é”€å”®æƒ…å†µä¸‹æœ‰é—®é¢˜ï¼Œè¿™ä¸ªåœºæ™¯ä¸‹æ•°æ®éœ€è¦å˜æ›´ï¼Œä½†åº“å­˜æ˜¯ä¸ç®¡é¢„å”®å°¾æ¬¾çš„ï¼Œä¸ä¼šæ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯¼è‡´æ•°æ®ä¼ é€’é”™è¯¯ã€‚<ul>
<li>åæœæ˜¯æ¶ˆè´¹è€…é¢„çº¦åˆ°äº†æ—©äºè´§å“åˆ°ä»“çš„æ—¶é—´ï¼Œå•†å®¶æ— æ³•å±¥çº¦</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å…¨é“¾è·¯å‹æµ‹"><a href="#å…¨é“¾è·¯å‹æµ‹" class="headerlink" title="å…¨é“¾è·¯å‹æµ‹"></a>å…¨é“¾è·¯å‹æµ‹</h2><h3 id="å½±å­ä½“ç³»"><a href="#å½±å­ä½“ç³»" class="headerlink" title="å½±å­ä½“ç³»"></a>å½±å­ä½“ç³»</h3><ul>
<li>æµé‡éš”ç¦»ï¼šå‹æµ‹æµé‡æœ‰ç‰¹æ®Šæ ‡è¯†ï¼Œæ‰“åœ¨æµé‡å…¥å£urlä¸Š</li>
<li>å…¨é“¾è·¯è´¯é€šï¼šå‹æµ‹æ ‡è¯†åœ¨WebæœåŠ¡å™¨çš„LogFilteræ˜ å°„åˆ°ä¸­é—´ä»¶çš„contextï¼Œä»è€Œé€ä¼ åˆ°æ•´æ¡é“¾è·¯</li>
<li>èµ„æºå…±ç”¨ï¼šå½±å­ä½“ç³»èµ„æºå…±ç”¨çº¿ä¸Šèµ„æºï¼Œå½±å­è¡¨ã€æ­£å¼è¡¨åœ¨ä¸€å¥—æ•°æ®åº“ä¸­ï¼Œç¼“å­˜ä¸­é€šè¿‡ä¸åŒkeyåŒºåˆ†å‹æµ‹å’Œç°ä¸Šæ•°æ®</li>
</ul>
<h3 id="å‹æµ‹æ¨¡å‹"><a href="#å‹æµ‹æ¨¡å‹" class="headerlink" title="å‹æµ‹æ¨¡å‹"></a>å‹æµ‹æ¨¡å‹</h3><ul>
<li>å…¥å£é›†åˆï¼šè¦†ç›–å•†å“è¯¦æƒ…ã€è´­ç‰©è½¦æµè§ˆã€ç¡®è®¤è®¢å•ã€æäº¤è®¢å•ã€è®¢å•åˆ—è¡¨ã€è®¢å•è¯¦æƒ…ã€äºŒæ¬¡ä»˜æ¬¾ã€ä»˜æ¬¾æˆåŠŸç­‰å…¥å£</li>
<li>åŒ…å«å„ä¸ªåç«¯æ¨¡å‹ï¼ˆä¸æ˜¯å‰ç«¯æµé‡å…¥å£çš„æ¨¡å‹ï¼‰</li>
<li>é¢„æµ‹å‡ºå„ä¸ªåœºæ™¯QPSå’Œå„ä¸ªåç«¯å…ƒç´ æ¯”ä¾‹</li>
<li>å’Œå¤§ä¿ƒç©æ³•æ·±åº¦ç»“åˆï¼Œç”¨å¤§ä¿ƒç©æ³•å¯¹å‹æµ‹æ¨¡å‹ä¿®æ­£</li>
<li>æ„é€ å‹æµ‹æ¨¡å‹<ul>
<li>åœ¨ç”Ÿäº§ç¯å¢ƒäº§å‡ºå’ŒåŒ11åŒç­‰é‡çº§æ•°æ®ï¼šåŒ…å«ä¹°å®¶ã€å–å®¶ã€å•†å“</li>
<li>æ ¹æ®æ¨¡å‹å„ä¸ªå…ƒç´ ï¼Œå®Œæˆæ„é€ ä¼˜æƒ ã€é¢†å–çº¢åŒ…ã€æ·»åŠ è´­ç‰©è½¦æ“ä½œ</li>
<li>æ ¹æ®å„æµé‡å…¥å£è¯·æ±‚è§„åˆ™ï¼Œæ„é€ å¯è¡Œçš„å‹æµ‹æµé‡</li>
</ul>
</li>
</ul>
<h3 id="æ‰§è¡Œç­–ç•¥"><a href="#æ‰§è¡Œç­–ç•¥" class="headerlink" title="æ‰§è¡Œç­–ç•¥"></a>æ‰§è¡Œç­–ç•¥</h3><ul>
<li>åƒä¸‡çº§æ–½å‹èƒ½åŠ›<ul>
<li>ä¸€ä¸ªæµé‡å¹³å°ï¼ŒåŒ…å«ä¸€ä¸ªæ§åˆ¶èŠ‚ç‚¹å’Œä¸Šåƒä¸ªworkerèŠ‚ç‚¹ï¼Œæ¯ä¸ªworkerèŠ‚ç‚¹éƒ¨ç½²å‹æµ‹å¼•æ“</li>
<li>å‹æµ‹å¼•æ“éƒ¨ç½²åœ¨cdnä¸Šï¼Œä»å¤–ç½‘å‘å†…ç½‘æ–½å‹ï¼Œæ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º</li>
</ul>
</li>
<li>æ‰§è¡Œæ–¹æ³•<ul>
<li>è„‰å†²å‹æµ‹ï¼šæŒ‰ç…§è®¾å®šæ¨¡å‹è„‰å†²ï¼Œæ¨¡æ‹Ÿ0ç‚¹æµé‡</li>
<li>æ‘¸é«˜ï¼šå…³é—­é™æµï¼Œç›´æ¥åŠ å‹ï¼Œç›´åˆ°æ‰›ä¸ä½</li>
<li>é™æµéªŒè¯ï¼šæ‘¸é«˜ç¨³å®šæƒ…å†µä¸‹ï¼Œå¼€é™æµï¼Œçœ‹èƒ½å¦ç”Ÿæ•ˆ</li>
<li>ç ´åæ€§æµ‹è¯•ï¼šä¿æŒç³»ç»Ÿå¤§ä¿ƒæ€ï¼Œå‹åŠ›ä¿æŒåœ¨å³°å€¼ï¼Œæ‰§è¡Œå„ä¸ªç´§æ€¥é¢„æ¡ˆï¼Œçœ‹æ•ˆæœæ˜¯å¦æ»¡è¶³é¢„æœŸ</li>
</ul>
</li>
</ul>
<p>å¸¸æ€åŒ–æ™ºèƒ½å‹æµ‹ï¼šéå¤§ä¿ƒæ€ä¸‹ï¼Œé€šè¿‡æ™ºèƒ½å‹æµ‹æœºå™¨äººï¼Œå¯¹ç³»ç»Ÿè¿›è¡Œå›ºå®šé¢‘ç‡å‹æµ‹ï¼ŒåŠæ—¶å‘ç°ç³»ç»Ÿç“¶é¢ˆï¼Œå®šä½åŸå› </p>
<h2 id="å…¨é“¾è·¯åŠŸèƒ½"><a href="#å…¨é“¾è·¯åŠŸèƒ½" class="headerlink" title="å…¨é“¾è·¯åŠŸèƒ½"></a>å…¨é“¾è·¯åŠŸèƒ½</h2><p>åŠŸèƒ½æµ‹è¯•æ–¹æ³•ï¼šæå‰å°†çº¿ä¸Šä¸šåŠ¡æ•°æ®åŒæ­¥è‡³å½±å­è¡¨ä¸­ï¼Œå°†æœºå™¨æ—¶é—´ä¿®æ”¹åˆ°å¤§ä¿ƒæ—¶é—´ç‚¹ï¼Œæ¨¡æ‹ŸçœŸå®è¡Œä¸ºï¼Œç„¶åæ‰§è¡Œä¸šåŠ¡é“¾è·¯ï¼ŒéªŒè¯æ•°æ®å¯ç”¨æ€§å‡†ç¡®æ€§</p>
<h3 id="ç»Ÿä¸€ç¯å¢ƒéš”ç¦»"><a href="#ç»Ÿä¸€ç¯å¢ƒéš”ç¦»" class="headerlink" title="ç»Ÿä¸€ç¯å¢ƒéš”ç¦»"></a>ç»Ÿä¸€ç¯å¢ƒéš”ç¦»</h3><ul>
<li>æµé‡éš”ç¦»ï¼šhttpå‰ç«¯å…¥å£ã€rpcè°ƒç”¨ã€æ¶ˆæ¯å…¥å£ã€å®šæ—¶ä»»åŠ¡</li>
<li>æ—¶é—´æ§åˆ¶<ul>
<li>ä¿®æ”¹JVMå‚æ•°ï¼Œåªå½±å“å½“å‰Javaåº”ç”¨ï¼Œé˜¿é‡ŒJVMæœ‰æ§åˆ¶æ—¶é—´åç§»å‚æ•°</li>
<li>ç›´æ¥ç”¨dateå‘½ä»¤æ”¹è™šæ‹Ÿæœºæ—¶é—´ä¼šå½±å“æœºå™¨ä¸Šçš„å…¶ä»–åº”ç”¨</li>
<li>é¢„æ¡ˆå¼€å…³åªåœ¨éš”ç¦»ç¯å¢ƒç”Ÿæ•ˆï¼Œæµ‹è¯•æ—¶ä¸å½±å“çº¿ä¸Šå‘å¸ƒç¯å¢ƒæƒ…å†µ</li>
</ul>
</li>
</ul>
<h3 id="å…¨é“¾è·¯å½±å­æ•°æ®"><a href="#å…¨é“¾è·¯å½±å­æ•°æ®" class="headerlink" title="å…¨é“¾è·¯å½±å­æ•°æ®"></a>å…¨é“¾è·¯å½±å­æ•°æ®</h3><ul>
<li>æ•°æ®ç”Ÿæˆï¼šçº¿ä¸Šæ•°æ®è„±æ•è½¬æ¢+æ•°æ®åŒºé—´æ˜ å°„ï¼Œç”Ÿæˆæ•°æ®å¹¶å†™å…¥å½±å­è¡¨</li>
<li>ç‰¹ç‚¹ï¼šçœŸå®ã€æµ·é‡ã€å‡†å¤‡æˆæœ¬ä½</li>
</ul>
<h3 id="ç”¨ä¾‹ç²¾ç®€"><a href="#ç”¨ä¾‹ç²¾ç®€" class="headerlink" title="ç”¨ä¾‹ç²¾ç®€"></a>ç”¨ä¾‹ç²¾ç®€</h3><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”¨ä¸€ä¸ªRBC agentéƒ¨ç½²åœ¨äº¤æ˜“é“¾è·¯æ ¸å¿ƒåº”ç”¨ä¸Šï¼Œç”¨RBCæœåŠ¡ç«¯æ”¶é›†agentçš„æ•°æ®</li>
<li>å°†æ¯ä¸ªåº”ç”¨ä¸­ç”¨ä¾‹è¯·æ±‚ç»è¿‡çš„ä»£ç ä¿¡æ¯é‡‡é›†ä¸‹æ¥</li>
<li>æœåŠ¡ç«¯æ¥å—ä»£ç è¦†ç›–ä¿¡æ¯åï¼Œå°†ç”¨ä¾‹è¯·æ±‚è½¬åŒ–ä¸ºé“¾è·¯çº§ä»£ç è¦†ç›–è·¯å¾„</li>
<li>å°†è¦†ç›–ä»£ç è·¯å¾„è½¬æ¢ä¸ºå”¯ä¸€çš„å†…å®¹ç­¾åï¼Œè¿›è¡Œèšåˆ</li>
<li>èšåˆåï¼Œè¿›è¡Œæ•°æ®å›ºåŒ–</li>
</ul>
<p>æ³¨ï¼šç›¸å½“äºé€šè¿‡è°ƒç”¨é“¾è·¯æ¥ç¡®å®šç”¨ä¾‹ç±»å‹ï¼Œç”±çº¿ä¸Šæ•°æ®äº§ç”Ÿç”¨ä¾‹</p>
<h3 id="RBCæœåŠ¡"><a href="#RBCæœåŠ¡" class="headerlink" title="RBCæœåŠ¡"></a>RBCæœåŠ¡</h3><ul>
<li>ä»£ç è¦†ç›–è®¡ç®—ä»»åŠ¡å…¨éƒ¨éƒ½åœ¨RBCæœåŠ¡å®Œæˆï¼Œè¿›è¡Œç¦»çº¿è®¡ç®—ï¼Œä¸åœ¨agentè®¡ç®—</li>
<li>ç”¨metaqä»£æ›¿tlogè¿›è¡Œæ•°æ®é€šä¿¡ï¼Œmetaqåªä¸Šä¼ å­˜å‚¨åœ°å€ï¼Œå­˜å‚¨æ¢é’ˆæ•°æ®åœ¨æœåŠ¡ç«¯ï¼Œå‹ç¼©å­˜å‚¨ï¼Œå‡å°‘metaqå’ŒOSSå¼€é”€</li>
<li>æœåŠ¡å™¨ä»metaqæ¥åˆ°æ¶ˆæ¯ï¼Œä»OSSæ‹‰å–åŸå§‹æ•°æ®ï¼Œè®¡ç®—é“¾è·¯è¦†ç›–ä¿¡æ¯ï¼Œå¹¶æ”¹é€ jacocoè¡Œè¦†ç›–ç‡ç®—æ³•æå‡æ•ˆç‡</li>
<li>é€šè¿‡é˜¿é‡Œé¹°çœ¼ç›‘æ§å°†ç”¨ä¾‹åœ¨äº¤æ˜“é“¾æ¥å„ä¸ªåº”ç”¨ä¸²è”èµ·æ¥ï¼Œæå‡è¦†ç›–ç‡å·¥å…·åˆ°é“¾è·¯çº§</li>
<li>ç”¨hbaseæ›¿ä»£mysqlå­˜å‚¨è¦†ç›–ç‡ä¿¡æ¯</li>
</ul>
<p>æ³¨ï¼šç¬”è€…ä»¥å‰åšè¿‡skynetæœåŠ¡luaè¦†ç›–ç‡æµ‹è¯•ï¼Œæœ‰äº›æªæ–½ç±»ä¼¼ï¼ˆæ¯”å¦‚ä»£ç è¦†ç›–åœ¨ä¸­å¿ƒæœè®¡ç®—ï¼‰ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ã€OSSç­‰ï¼Œå¯ä»¥åšæ›´çµæ´»çš„æ‰©å±•ï¼ˆè¦†ç›–æ•°æ®æ”¶é›†åˆ†æä¸éœ€è¦å³æ—¶æ€§ï¼‰ï¼Œä¸­å¿ƒæœå¼„æˆé›†ç¾¤ä¹Ÿå¯ä»¥ï¼Œè¦†ç›–æ•°æ®åˆ†æè®¡ç®—å¯ä»¥å†ç”¨éRBCä¸­å¿ƒæœçš„å…¶ä»–èŠ‚ç‚¹æ¥åšï¼ˆä¼˜åŒ–ç‚¹ï¼‰</p>
<h2 id="å…¨æ°‘é¢„æ¼”"><a href="#å…¨æ°‘é¢„æ¼”" class="headerlink" title="å…¨æ°‘é¢„æ¼”"></a>å…¨æ°‘é¢„æ¼”</h2><p>é£é™©ï¼š</p>
<ul>
<li>æµ‹è¯•é“¾è·¯ååŒæˆæœ¬é«˜ï¼šäº¤æ˜“é“¾è·¯ä¸Šä¸‹æ¸¸å…³è”ç´§å¯†å¤æ‚ï¼Œä¼˜æƒ åº”ç”¨è°ƒæ•´å¯èƒ½æ¶‰åŠä¸Šæ¸¸å¯¼è´­ã€æŠ•æ”¾ï¼Œä¸‹æ¸¸äº¤æ˜“ã€æ”¯ä»˜ï¼Œä¹ŸåŒ…æ‹¬å”®åçš„æœåŠ¡ã€å±¥çº¦ã€ä¾›åº”é“¾ç­‰æ–¹é¢</li>
<li>è¿­ä»£é‡å¤§ï¼šè®¾è®¡å‡ åä¸ªäº‹ä¸šéƒ¨ï¼Œä¸‡çº§å‘å¸ƒï¼Œå•é“¾è·¯æ— æ³•æ»¡è¶³å…¨å±€è´¨é‡ä¿éšœéœ€æ±‚</li>
<li>æå‰ä¿éšœï¼šå¤§ä¿ƒæ ¸å¿ƒä¸šåŠ¡ç©æ³•æ¥ä¹‹å‰ï¼Œä¸ä¼šåœ¨çº¿ä¸Šç”Ÿæ•ˆ</li>
</ul>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>æå‰å…¨é“¾è·¯éªŒè¯ä¸šåŠ¡è´­ç‰©åŠŸèƒ½æ­£ç¡®æ€§å’Œå®Œæ•´æ€§ï¼šé‡ç‚¹å…³æ³¨ç”¨æˆ·åœ¨è´­ç‰©é“¾è·¯ä¸Šé‡åˆ°çš„è¥é”€ã€èµ„é‡‘ã€ç‰©æµã€æœåŠ¡ã€æ°›å›´å¿ƒæ™ºã€ä»·æ ¼è¡¨è¾¾ç­‰äº¤æ˜“/å¯¼è´­é“¾è·¯ä¸ŠåŠŸèƒ½</li>
<li>å¤§ä¿ƒäº§å“éªŒæ”¶ï¼šäº§å“è®¾è®¡&amp;å®ç°çš„åŒ¹é…åº¦ã€è§†è§‰äº¤äº’</li>
<li>æ¢ç´¢æµ‹è¯•</li>
</ul>
<p>é¢„æ¼”å®æ–½ï¼š</p>
<ul>
<li>äººå‘˜æ„æˆï¼šæµ‹è¯•+ç ”å‘æ‰€æœ‰äººå‘˜</li>
<li>ä¸šåŠ¡èŒƒå›´ï¼šäº¤æ˜“+å¯¼è´­é“¾è·¯<ul>
<li>äº¤æ˜“ï¼šå•†å“è¯¦æƒ…åˆ°é€†å‘äº¤æ˜“çš„é“¾è·¯ä¸Šï¼Œä»·æ ¼ã€åº“å­˜ã€ç”¨æˆ·é™è´­ã€èµ„é‡‘ã€èµ„äº§ã€ç‰©æµã€æœåŠ¡ç­‰æ ¸å¿ƒäº¤æ˜“ä¿¡æ¯çš„æŠ«éœ²å’Œè®¡ç®—</li>
<li>å¯¼è´­ï¼šåŸºç¡€å¯¼è´­ã€å¯¼è´­äº§å“ã€æ¨èé“¾è·¯ä¸Šçš„è¥é”€è¡¨è¾¾å’Œä»·æ ¼é€å‡º</li>
</ul>
</li>
<li>ç”¨ä¾‹ï¼šæ ¸å¿ƒä¸šåŠ¡åœºæ™¯ã€ç”¨æˆ·è¡Œä¸ºè·¯å¾„</li>
<li>ç¯å¢ƒï¼šç½‘ç»œä¸ŠåŒºåˆ†å†…ç½‘ç¯å¢ƒã€å¤–ç½‘éš”ç¦»ç¯å¢ƒã€wifiã€4Gï¼›éƒ¨ç½²åŒºåˆ†å¤šåœ°å¤šå•å…ƒã€äº‘ä¸éäº‘ç¯å¢ƒ</li>
</ul>
<p>æ‰§è¡Œç­–ç•¥ï¼š1è½®ä¸“é¡¹+2è½®å…¨é¢+2è½®éªŒæ”¶<br>é—®é¢˜è·Ÿè¿›ï¼šé“¾è·¯ä¸Šæ ¸å¿ƒæµ‹è¯•/ç ”å‘æ”¯æŒbugç­›é€‰å½’å¹¶ï¼Œæ¯è½®é¢„æ¼”å‘ç°é—®é¢˜é€šæ™’<br>CIï¼šå…¨æ°‘é¢„æ¼”ä¸­çš„ç”¨ä¾‹æ²‰æ·€æˆæ¥å£ï¼ŒUIå±‚é¢ç”¨ä¾‹é«˜é¢‘æ‰§è¡Œ<br>å¹³å°åŒ–ï¼šæå‡å…¨æ°‘é¢„æ¼”æ•ˆç‡</p>
<h2 id="é¢„æ¡ˆå¼€å…³"><a href="#é¢„æ¡ˆå¼€å…³" class="headerlink" title="é¢„æ¡ˆå¼€å…³"></a>é¢„æ¡ˆå¼€å…³</h2><p>åˆ†ä¸ºä¸¤ç§ï¼š</p>
<ul>
<li>æå‰é¢„æ¡ˆï¼šä¹Ÿæ˜¯å®šæ—¶é¢„æ¡ˆï¼Œæå‰é¢„ä¼°å¤§ä¿ƒæœŸé—´ç³»ç»Ÿä¸šåŠ¡çŠ¶å†µï¼Œé¿å…å¤§ä¿ƒçš„ä¸šåŠ¡å³°å€¼å½±å“è¿›è¡Œçš„ç¼“å­˜é¢„çƒ­ã€æœºå™¨é‡å¯ã€æœ‰é™é™çº§ã€ç£ç›˜æ¸…ç†æˆ–è€…ä¸šåŠ¡ä¸‹çº¿ï¼Œå¯¹ä¸šåŠ¡æ²¡æœ‰æ˜æ˜¾å½±å“</li>
<li>åº”æ€¥é¢„æ¡ˆï¼šé’ˆå¯¹å¯èƒ½å­˜åœ¨çš„å¼‚å¸¸ï¼ˆæµé‡è¶…æ ‡ã€æœåŠ¡ä¸å¯ç”¨ï¼‰ï¼Œå¯¹ä¸šåŠ¡æœ‰æŸï¼Œéœ€è¦æŠ€æœ¯å±‚é¢å…œåº•</li>
</ul>
<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><ul>
<li>å¤§ä¿ƒé¢„æ¡ˆ<ul>
<li>äº‹å‰ï¼šæå‰é¢„æ¡ˆï¼Œè®¾ç½®å›ºå®šæ‰§è¡Œæ¢å¤æ—¶é—´ï¼ˆçƒ­ç‚¹å•†å“é¢„çƒ­ï¼›æå‰å¯¹å¤–å…¬å‘Š/å®šæ—¶ä¸Šçº¿ç­‰ä¸šåŠ¡æ“ä½œï¼›é™çº§æ—¥å¿—ç­‰éæ ¸å¿ƒåŠŸèƒ½ï¼›é™çº§æ— æ³•æ‰¿å—å¤§æµé‡çš„ä¸‹æ¸¸æœåŠ¡è°ƒç”¨ï¼‰</li>
<li>äº‹ä¸­ï¼šåº”æ€¥é¢„æ¡ˆï¼Œæ ¹æ®ç³»ç»Ÿä¸šåŠ¡æŒ‡æ ‡å†³ç­–ï¼ˆåŠŸèƒ½ã€æœåŠ¡é™çº§/ä¸‹çº¿ï¼‰</li>
<li>äº‹åï¼šå›è¡¥ï¼Œæˆ–è€…å°†åŠŸèƒ½å¤§ä¿ƒæ€åˆ‡æ¢ä¸ºæ—¥å¸¸æ€ï¼ˆæ•°æ®è¿½å›ï¼‰</li>
</ul>
</li>
<li>æ—¥å¸¸é¢„æ¡ˆï¼šçº¿ä¸Šæ•…éšœå¿«é€Ÿå›å¤ï¼Œå»ºç«‹é£é™©å…³è”æå‰é¢„æ¡ˆçš„å…³ç³»</li>
</ul>
<h3 id="è¯„ä¼°æ–¹å¼"><a href="#è¯„ä¼°æ–¹å¼" class="headerlink" title="è¯„ä¼°æ–¹å¼"></a>è¯„ä¼°æ–¹å¼</h3><ul>
<li>åº”ç”¨å¼ºå¼±ä¾èµ–å…³ç³»æ˜ç¡®ï¼Œå¼ºä¾èµ–çš„å¤–éƒ¨æœåŠ¡éƒ½å¯ä»¥çº³ä¸ºé¢„æ¡ˆå¯¹è±¡</li>
<li>é¢„ä¼°æµé‡ã€å‹æµ‹éªŒè¯ï¼Œç¡®å®šå¤–éƒ¨æœåŠ¡æ˜¯å¦è¦æå‰é™çº§</li>
<li>é¢„æ¡ˆå¼€å¯å¤§æ¦‚ç‡æœ‰æŸï¼Œéœ€è¦åšå¥½ç”¨æˆ·å¼•å¯¼</li>
</ul>
<h3 id="é¢„æ¡ˆæµç¨‹"><a href="#é¢„æ¡ˆæµç¨‹" class="headerlink" title="é¢„æ¡ˆæµç¨‹"></a>é¢„æ¡ˆæµç¨‹</h3><ul>
<li>æ´»åŠ¨å‰ï¼šé¢„æ¡ˆæ¢³ç†ã€å½•å…¥ã€æ­£ç¡®æ€§æ£€æŸ¥ã€æ¼”ç»ƒã€æ—¶é—´æ£€æŸ¥ã€é€šçŸ¥é…ç½®</li>
<li>æ´»åŠ¨ä¸­ï¼šæ‰§è¡Œæ£€æŸ¥/ç»“æœéªŒè¯ã€ç´§æ€¥é¢„æ¡ˆæ‰§è¡Œä¸è¡¥å¿</li>
<li>æ´»åŠ¨åï¼šæ¢å¤æ£€æŸ¥/ç»“æœéªŒè¯ã€ç´§æ€¥é¢„æ¡ˆæ¢å¤æ£€æŸ¥</li>
</ul>
<h3 id="å¹³å°åŒ–"><a href="#å¹³å°åŒ–" class="headerlink" title="å¹³å°åŒ–"></a>å¹³å°åŒ–</h3><p>ç§©åºåŒ–è¿›è¡Œæ‰€æœ‰é¢„æ¡ˆæ“ä½œï¼Œé™ä½å¤šå¹³å°ã€å¤šè§’è‰²æ“ä½œå¸¦æ¥çš„é£é™©ï¼Œæå‡é¢„æ¡ˆé“¾è·¯æ²Ÿé€šæ•ˆç‡</p>
<h3 id="ç›®æ ‡"><a href="#ç›®æ ‡" class="headerlink" title="ç›®æ ‡"></a>ç›®æ ‡</h3><p>é«˜å¯é ã€é«˜å®‰å…¨ã€ä½æˆæœ¬</p>
<h2 id="å…¨é“¾è·¯é¢„çƒ­"><a href="#å…¨é“¾è·¯é¢„çƒ­" class="headerlink" title="å…¨é“¾è·¯é¢„çƒ­"></a>å…¨é“¾è·¯é¢„çƒ­</h2><p>æ··éƒ¨æŠ€æœ¯ï¼ˆç±»ä¼¼æ½®æ±è½¦é“ï¼ŒåŒä¸€ä¸ªèŠ‚ç‚¹çš„èµ„æºåœ¨å¤šä¸ªé›†ç¾¤å†…ç”¨åˆ°ï¼‰é™ä½æœºå™¨æˆæœ¬ï¼Œä½†æ˜¯å¿«ä¸Šçš„åº”ç”¨å¯¼è‡´æ··éƒ¨æœºæˆ¿æ²¡æœ‰è¶³å¤Ÿæ—¶é—´é€šè¿‡çº¿ä¸Šç”¨æˆ·è®¿é—®å……åˆ†é¢„çƒ­ï¼Œå¯¼è‡´åœ¨å³°å€¼æ—¶åˆ»æ¯”éæ··éƒ¨æœºæˆ¿æ›´å®¹æ˜“äº§ç”Ÿç¬é—´æµé‡æ”¯æŒä¸è¶³é—®é¢˜</p>
<ul>
<li>ç³»ç»Ÿé¢„çƒ­ï¼šç”¨è¾ƒå°çš„å‹æµ‹æµé‡å¯¹æ–°å‘å¸ƒç³»ç»Ÿè¿è¡Œ20minå·¦å³</li>
<li>æ•°æ®é¢„çƒ­ï¼šå°†æ ¸å¿ƒç³»ç»Ÿçƒ­ç‚¹æ•°æ®æå‰æ”¾å…¥ç¼“å­˜ä¸­ï¼Œé˜²æ­¢ç³»ç»Ÿå‘ç”Ÿç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œä¸»åŠ¨é˜²å¾¡</li>
<li>åœºæ™¯ç¼–æ’è°ƒåº¦ï¼šå…ˆé¢„çƒ­åº•å±‚çƒ­ç‚¹æ•°æ®ï¼Œå†é¢„çƒ­ä¸Šå±‚æ•°æ®ï¼›è€ƒè™‘ä¸€äº›ç‰¹å®šæ—¶é—´åæ‰èƒ½æ‰§è¡Œé¢„çƒ­çš„åº”ç”¨</li>
</ul>
<p>é€‚ç”¨çš„ä¸šåŠ¡åœºæ™¯ï¼š</p>
<ul>
<li>tairé¢„çƒ­</li>
<li>æœ¬åœ°ç¼“å­˜é¢„çƒ­</li>
<li>dbçš„buffer poolé¢„çƒ­</li>
<li>ç¼“å­˜æ–‡ä»¶åˆ†å‘é¢„çƒ­ï¼ˆæœ¬åœ°åŠ è½½ï¼‰</li>
<li>ç¼“å­˜å¤±æ•ˆ</li>
</ul>
<h2 id="å¿«é€Ÿæ‰©-ç¼©å®¹"><a href="#å¿«é€Ÿæ‰©-ç¼©å®¹" class="headerlink" title="å¿«é€Ÿæ‰©/ç¼©å®¹"></a>å¿«é€Ÿæ‰©/ç¼©å®¹</h2><p>åˆ†ä¸ºæ°´å¹³ä¼¸ç¼©ï¼ˆå¢åŠ ã€å‡å°‘å®ä¾‹æ•°ï¼Œæ—¶é—´é•¿ï¼‰ã€å‚ç›´ä¼¸ç¼©ï¼ˆæ”¹å˜ç¡¬ä»¶è§„æ ¼ï¼Œç§’çº§ï¼Œé™äºå®¿ä¸»æœºèµ„æºï¼‰<br>ä¼˜åŒ–æ–¹æ³•ï¼š</p>
<ul>
<li>æ°´å¹³ä¼¸ç¼©<ul>
<li>æ‰©å®¹æ­¥éª¤ç²¾ç®€<ul>
<li>ç´§æ€¥æ‰©å®¹ä¸éœ€è¦å®¡æ‰¹</li>
<li>æ‰©å®¹é”å¯ä»¥ä¸ç”¨ï¼Œå› ä¸ºä¸éœ€è¦è€ƒè™‘åº”ç”¨å‘å¸ƒç‰ˆæœ¬ä¸ä¸€è‡´é—®é¢˜</li>
<li>è´¦å·ã€é€šé“ï¼Œå¯ä»¥å¼‚æ­¥æ·»åŠ </li>
<li>ä¸»æœºç”¨é€”ä¸éœ€è¦ä¿®æ”¹ï¼Œä¸éœ€è¦åŠ ä¸»æœºç™½åå•ç­‰ä¸šåŠ¡</li>
<li>agentä¸éœ€è¦æ£€æŸ¥ï¼ŒæˆåŠŸç‡å¯ä»¥ä¿è¯</li>
<li>vipæ“ä½œå¯ç²¾ç®€ï¼Œæ¯”è¾ƒéº»çƒ¦</li>
</ul>
</li>
<li>æ–°æŠ€æœ¯æ¶æ„ï¼šDADI<ul>
<li>æ—¶é—´ç“¶é¢ˆï¼šæ™®é€šdockerå®¹å™¨å¯åŠ¨æ…¢ï¼Œéœ€è¦åœ¨å¯åŠ¨ä¹‹å‰æŠŠæ¯å±‚é•œåƒéƒ½ä¸‹åˆ°æœ¬åœ°ï¼Œå†è§£å‹åˆ°dockeræŒ‡å®šç›®å½•ä¸­</li>
<li>ä¼˜åŒ–ï¼šzrooté¢„çƒ­docker-registryæ•°æ®ï¼Œä¸‹å‘åˆ°èŠ‚ç‚¹çš„zagent<ul>
<li>åªéœ€è¦ä¸‹è½½å®¹å™¨å¯åŠ¨å¿…è¦æ•°æ®ï¼Œæ¥åŠ é€Ÿdockerå¯åŠ¨è¿‡ç¨‹</li>
<li>å¯åŠ¨å®¹å™¨åªä¸‹è½½layer_metaå…ƒæ•°æ®ï¼Œå®¹å™¨å¯åŠ¨éœ€è¦ä»€ä¹ˆæ•°æ®ï¼Œå°±ä»zrootè¯»å–</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>å‚ç›´ä¼¸ç¼©<ul>
<li>ç”¨cgroupå®ç°èµ„æºåˆ†é…</li>
<li>éœ€è¦æœ‰èµ„æºé¢„ç•™</li>
</ul>
</li>
</ul>
<h2 id="é£æ§è¯†åˆ«å¼•æ“å‹æµ‹"><a href="#é£æ§è¯†åˆ«å¼•æ“å‹æµ‹" class="headerlink" title="é£æ§è¯†åˆ«å¼•æ“å‹æµ‹"></a>é£æ§è¯†åˆ«å¼•æ“å‹æµ‹</h2><p>åŒ…æ‹¬é»‘äº§ã€ç›´æ’­æ–‡æœ¬ã€å•†å“éƒ½æœ‰é£æ§éœ€æ±‚<br>éœ€è¦è§£å†³çš„é—®é¢˜ï¼š</p>
<ul>
<li>é£æ§å‹æµ‹æ¨¡å‹å’Œäº¤æ˜“å‹æµ‹æ¨¡å‹æœ‰å†²çªï¼Œæ•°æ®æ„é€ ä¸å…¼å®¹</li>
<li>é£æ§å¯¹æ•°æ®å¼ºä¾èµ–ï¼Œäº¤æ˜“å‹æµ‹æ¨¡å‹å’Œé˜²æ§æ•°æ®ä¸åŒæ„ï¼Œä¸¤ä»½æ•°æ®å­˜å‚¨æˆæœ¬å¤§ï¼Œä¸èƒ½å®ç°éš”ç¦»</li>
<li>é£æ§é˜²æ§è§„åˆ™å˜åŒ–å¤šï¼Œå½±å“æ€§èƒ½</li>
</ul>
<p>é£æ§è§„åˆ™æ˜¯ç”±è¡¨è¾¾å¼+é€»è¾‘è¿ç®—ç»„æˆï¼Œåˆ†å±‚ï¼Œæœ‰çŸ­è·¯æ‰§è¡Œç‰¹æ€§ï¼Œè§„åˆ™ä¹‹é—´æ— å…³è”ï¼Œå¯ä»¥é…ç½®æµè½¬ç­–ç•¥ï¼ˆå‘½ä¸­ç»§ç»­/ä»»ä½•æƒ…å†µç»§ç»­ï¼‰ï¼Œå› æ­¤å½±å“æ€§èƒ½çš„å› ç´ åŒ…æ‹¬ï¼š</p>
<ul>
<li>å•ä¸ªè¡¨è¾¾å¼æ€§èƒ½æ¶ˆè€—ï¼šåŸºæœ¬æ˜¯å®šå€¼</li>
<li>è¡¨è¾¾å¼çš„æ‰§è¡Œç»“æœï¼šå½±å“è§„åˆ™æ‰§è¡Œè¡¨è¾¾å¼æ¡æ•°ï¼Œå½±å“æµå…¥ä¸‹ä¸€æ¡è§„åˆ™è¯·æ±‚æ•°</li>
</ul>
<p>å¦‚ä½•é€šè¿‡æ§åˆ¶è¡¨è¾¾å¼ç»“æœï¼Œè®©æµé‡è§„åˆ™ç¬¦åˆé¢„æœŸï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>å°†è¡¨è¾¾å¼ç»“æœtrue/falseæ¯”ä¾‹ä½œä¸ºé¢„æœŸç»“æœ</li>
<li>æ‰§è¡Œè¿‡ç¨‹ä¸­æ”¹å†™è¡¨è¾¾å¼æ‰§è¡Œç»“æœæˆ–è€…é€šè¿‡æ•°æ®æ„é€ ï¼Œå°†è¡¨è¾¾å¼ç»“æœç¬¦åˆé¢„æœŸ</li>
</ul>
<p>ç¬¬ä¸€ç‚¹å¯ä»¥ä¿å­˜å›æµçš„é£æ§æ•°æ®ï¼Œå¯¹è¡¨è¾¾å¼æ‰§è¡Œç»“æœçš„æ¯”ä¾‹è¿›è¡Œç‰¹å¾æŒ–æ˜æå–<br>ç¬¬äºŒç‚¹æ•°æ®æ„é€ ï¼Œéœ€è¦æ”¹å†™è¡¨è¾¾å¼ï¼Œæ»¡è¶³æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>åªå¯¹å‹æµ‹æµé‡å¹²é¢„ï¼ŒçœŸå®æµé‡ä¸å¤„ç†</li>
<li>å¹²é¢„ç”Ÿæ•ˆä¸å‘å¸ƒï¼Œå¯¹åº”ç”¨æ— æ„Ÿ</li>
</ul>
<p>åªå¹²é¢„å‹æµ‹æµé‡çš„å®ç°ï¼Œåªè¦åœ¨runtimeå¯¹å‹æµ‹æ ‡å‡†è¿›è¡Œè¯†åˆ«ï¼Œå› ä¸ºå®ç°åº”ç”¨æ— æ„Ÿå¹²é¢„æ¯”è¾ƒéº»çƒ¦ï¼Œæœ€ç»ˆé‡‡ç”¨javaagentæŒ‚è½½ï¼Œå¯¹æ¥å£æ–¹æ³•ä»¥å­—èŠ‚ç å¢å¼ºçš„æ–¹å¼å¹²é¢„ï¼ˆjvm-sandboxä¹Ÿå¯ï¼‰</p>
<p>æ³¨ï¼šå¹²é¢„ï¼Œå®é™…ä¸Šå°±æ˜¯çƒ­æ›´é€»è¾‘å®ç°ï¼Œå‚è€ƒæ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTkvMDkvMDUvamF2YS1ieXRlY29kZS1lbmhhbmNlbWVudC5odG1s" title="https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html">https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html<i class="fa fa-external-link"></i></span></p>
<p>æœ€ç»ˆï¼Œå¯ä»¥åŸºäºå†å²æ•°æ®å­¦ä¹ å¤§ä¿ƒæœŸé—´è¡¨è¾¾å¼æ‰§è¡Œç‰¹å¾ï¼ŒæŠ½è±¡æˆtupleï¼šï¼ˆè§„åˆ™IDï¼Œè¡¨è¾¾å¼IDï¼Œç»“æœä¸ºtrueæ¯”ä¾‹ï¼‰ï¼Œä½¿ç”¨jvm-sandboxç¼–å†™moduleå¯ä»¥å®ç°è¡¨è¾¾å¼æ”¹å†™ï¼Œä»è€Œå½±å“æµå…¥æ¯æ¡è§„åˆ™çš„è¯·æ±‚ï¼Œå®ç°å‹åŠ›æ¨¡å‹å’Œå¤§ä¿ƒæœŸé—´ä¿æŒä¸€è‡´ã€‚æ–¹æ¡ˆä¸Šï¼ŒåŸºäºè¡¨è¾¾å¼ç‰¹å¾ï¼ˆä¸‰å…ƒç»„ï¼‰å’Œè§„åˆ™ç‰¹å¾ï¼ˆäºŒå…ƒç»„ï¼‰æ ¹æ®ä¸åŒåœºæ™¯å†™å…¥é…ç½®ä¸­é—´ä»¶ï¼Œå‹æµ‹äººå‘˜åœ¨æ§åˆ¶å°æ“ä½œAgentæŒ‚è½½ï¼Œåœ¨å‹æµ‹æµé‡æµå…¥æ—¶ï¼Œå¯ä»¥æ ¹æ®é…ç½®çš„ç‰¹å¾å¯¹è¡¨è¾¾å¼ã€æ‰§è¡Œç»“æœè¿›è¡Œå¹²é¢„ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>ç¨³å®šæ€§</tag>
        <tag>å‹åŠ›æµ‹è¯•</tag>
        <tag>è´¨é‡ä¿éšœ</tag>
        <tag>æµ‹è¯•</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬åè¯ï¼šå¿«é€Ÿç†è§£å¹¶ä¸Šæ‰‹contextçš„åŸºç¡€ç”¨æ³•</title>
    <url>/2023/04/01/gofromzero/10_context/</url>
    <content><![CDATA[<p>åœ¨<code>Golang</code>çš„å„ç§ç”¨æ³•å½“ä¸­ï¼Œ<code>context</code>å¯è°“æ˜¯æœ€èƒ½å¤Ÿä½“ç°<code>Golang</code>è¯­è¨€ç‰¹æ€§çš„æ¨¡å—ä¹‹ä¸€ã€‚<code>context</code>çš„æœ¬æ„ä¸º<code>æƒ…å¢ƒã€ä¸Šä¸‹æ–‡</code>ï¼Œè€Œåœ¨<code>Golang</code>ç¨‹åºå½“ä¸­ï¼Œåˆ™å¯ä»¥è¢«ç”¨äºæè¿°ä¸€æ¬¡<code>è°ƒç”¨</code>ã€<code>ä¼šè¯</code>æˆ–è€…<code>ä»»åŠ¡</code>çš„çŠ¶æ€ä¿¡æ¯ã€‚å…³äº<code>context</code>ç½‘ä¸Šæœ‰å¾ˆå¤šè¯­æ³•ä»¥åŠæºç åˆ†æçš„æ–‡æ¡£ï¼Œä½†æ˜¯é‡Œé¢å¾ˆå¤šå´ä¸èƒ½ä»å®æˆ˜åœºæ™¯ä½“ç°<code>context</code>çš„ä½œç”¨ï¼Œå¯¼è‡´è¿™ä¸ªæ¦‚å¿µéš¾ä»¥ç†è§£ã€‚å› æ­¤è¿™ä¸€å›ï¼Œç»ç”±è¸©å‘<code>context</code>åï¼Œç¬”è€…å°†ç»“åˆè‡ªå·±çš„ç†è§£ï¼Œç»™å¤§å®¶è®²è¿°<code>context</code>åœ¨<code>Golang</code>æ€ä¹ˆç”¨æ¥æœ€ä¸ºæ–¹ä¾¿ï¼Œæ€ä¹ˆç†è§£æœ€ä¸ºå®ç”¨ã€‚</p>
<p>é¦–å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯<code>context</code>ã€‚æˆ‘ä»¬å…ˆèµ°æºç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">    Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line">    Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">    Err() error</span><br><span class="line">    Value(key any) any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æºç å®šä¹‰ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ<code>context</code>æ¨¡å—ç»™å¼€å‘è€…å®šä¹‰äº†ä¸€ä¸ªæ¥å£çº¦å®š<code>Context</code>ã€‚åœ¨å…ˆå‰<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjMvMDIvMTgvZ29mcm9temVyby8wOF9jYWNoZV9pbnRlcmZhY2Uv" title="https://utmhikari.top/2023/02/18/gofromzero/08_cache_interface/">å…³äºæ¥å£çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­æœ‰æåˆ°ï¼Œæ¥å£æœ¬èº«å®šä¹‰çš„æ˜¯ä¸€ä¸ªå®ä½“å¯ä»¥åšçš„è¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆæ­¥ç†è§£<code>context</code>çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡<code>Context</code>çš„å®šä¹‰ï¼ŒçŸ¥é“ä¸€ä¸ª<code>Context</code>å¯ä»¥å¹²ä»€ä¹ˆã€‚</p>
<p>å‡è®¾ä¸€ä¸ª<code>Context</code>å®ä¾‹<code>ctx</code>ï¼Œå…³è”åˆ°äº†ä¸€æ¬¡<code>ä¼šè¯</code>ï¼Œä½œä¸ºå½“æ¬¡<code>ä¼šè¯</code>çš„<code>æƒ…å¢ƒ</code>ã€‚æ ¹æ®ä»£ç å®šä¹‰ï¼Œ<code>Context</code>å¯ä»¥åšä»¥ä¸‹å‡ ç§è¡Œä¸ºï¼š</p>
<a id="more"></a>
<ul>
<li><code>Deadline</code> -&gt; é€å‡ºä¸¤ä¸ªä¿¡æ¯ï¼šæœ¬æ¬¡<code>ä¼šè¯</code>çš„DDLæ˜¯å¦æœ‰è®¾ç½®ï¼ˆ<code>ok</code>ï¼‰ï¼Œè®¾ç½®åˆ°äº†ä»€ä¹ˆæ—¶å€™ï¼ˆ<code>deadline</code>ï¼‰</li>
<li><code>Done</code> -&gt; é€šè¿‡è°ƒç”¨<code>&lt;- ctx.Done()</code>ï¼Œå¯ä»¥é˜»å¡ç­‰å¾…æœ¬æ¬¡<code>ä¼šè¯</code>çš„<code>æƒ…å¢ƒ</code>ç»“æŸ</li>
<li><code>Err</code> -&gt; å½“<code>æƒ…å¢ƒ</code>ç»“æŸæ—¶ï¼Œå¯ä»¥çŸ¥é“æœ¬æ¬¡<code>ä¼šè¯</code>ç»“æŸæ‰<code>æƒ…å¢ƒ</code>çš„åŸå› <ul>
<li>è¿™ä¸ªåŸå› æ˜¯ç¨‹åºæ€§è´¨çš„ï¼Œæ¯”å¦‚<code>è¶…æ—¶</code>æˆ–è€…<code>ç¨‹åºä¸»åŠ¨è°ƒç”¨cancel</code>ï¼Œä¸å…·å¤‡ä¸šåŠ¡æ€§è´¨</li>
<li>è¦ç»™åˆ°å…·å¤‡ä¸šåŠ¡æ€§è´¨çš„<code>æƒ…å¢ƒ</code>ç»“æŸåŸå› ï¼Œéœ€è¦ç”¨åˆ°<code>context.Cause</code>ï¼Œå…·ä½“ç”¨æ³•è§ä¸‹æ–‡</li>
</ul>
</li>
<li><code>Value</code> -&gt; é€å‡ºå½“å‰<code>æƒ…å¢ƒ</code>è®¾å®šçš„æŸä¸€ä¸ª<code>å­—æ®µ</code>çš„å€¼</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Context</code>å®ä¾‹å…·å¤‡å…±äº«å€¼ä¿¡æ¯ï¼ˆ<code>Value</code>ã€<code>Deadline</code>ï¼‰ä»¥åŠå…±äº«çŠ¶æ€ä¿¡æ¯ï¼ˆ<code>Done</code>ã€<code>Err</code>ï¼‰çš„ä½œç”¨ï¼Œå®šä¹‰ä¸Šéå¸¸è½»é‡å®ç”¨ã€‚åœ¨å®æˆ˜åœºæ™¯é‡Œï¼Œ<code>context</code>ä¹Ÿæœ‰ä¸¤ä¸ªæœ€ä¸ºå…¸å‹çš„åº”ç”¨åœºæ™¯ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>å•æ¬¡ä¼šè¯é‡Œï¼Œåœ¨ç›¸äº’é…åˆçš„<code>goroutine</code>ä¹‹é—´ï¼Œå…±äº«å½“æ¬¡ä¼šè¯çš„å€¼ã€çŠ¶æ€ç­‰æƒ…å¢ƒä¿¡æ¯</li>
<li>é•¿é“¾è·¯è°ƒç”¨é‡Œï¼Œé€ä¼ è°ƒç”¨ä¿¡æ¯ï¼Œè¦†ç›–åˆ°æ•´ä¸ªè°ƒç”¨é“¾è·¯ï¼Œä½¿å¾—æ¯å•ä¸ªè°ƒç”¨é“¾è·¯ä¿¡æ¯éƒ½å¯å›æº¯</li>
</ul>
<p>è¿™ä¸¤ç§åº”ç”¨åœºæ™¯ï¼Œé€šè¿‡<code>context</code>æ¨¡å—çš„é¢„ç½®åŠŸèƒ½ï¼ŒåŠ ä»¥ç»„åˆï¼Œå°±å¯ä»¥å……åˆ†å®ç°ã€‚</p>
<p>åœ¨<code>Golang</code>çš„è®¾è®¡é‡Œï¼Œæ¯ä¸€ä¸ª<code>context.Context</code>å®ä¾‹ç”Ÿæˆï¼Œéƒ½å¿…é¡»å…³è”åˆ°ä¸€ä¸ªçˆ¶çº§çš„<code>Context</code>å®ä¾‹ï¼Œè¿™æ ·çš„è®¾è®¡ä¸‹ï¼Œæ¯”å¦‚çˆ¶çº§çš„æƒ…å¢ƒç»“æŸäº†ï¼Œé‚£ä¹ˆå­çº§çš„æƒ…å¢ƒä¹Ÿä¼šé€’å½’ç»“æŸï¼Œä»è€Œèƒ½å¤Ÿæ»¡è¶³æƒ…å¢ƒä¹‹é—´çš„å…³è”å…³ç³»ã€‚<code>Golang</code>ä¸ºå¼€å‘è€…æä¾›äº†ä¸¤ä¸ªæœ€æ ¹éƒ¨çš„<code>Context</code>å®ä¾‹ï¼š<code>context.Background()</code>å’Œ<code>context.TODO()</code>ï¼Œå‡æ˜¯å•çº¯å®ç°äº†<code>Context</code>æ¥å£å®šä¹‰ï¼Œè¿”å›é›¶å€¼ã€‚åœ¨çŠ¶æ€å±‚é¢ï¼Œè¿™ä¸¤ä¸ª<code>Context</code>ä¸å¯ç»“æŸï¼Œå› ä¸ºæ²¡æœ‰ç­‰å¾…ç»“æŸçš„<code>chan</code>åœ¨<code>Done</code>æ¥å£é‡Œå®ç°ã€‚</p>
<p>ä¸šåŠ¡å¦‚æœè¦è‡ªå·±å®šä¹‰<code>Context</code>å®ä¾‹ï¼Œå°±å¿…é¡»ç»§æ‰¿è¿™ä¸¤ä¸ª<code>Context</code>å®ä¾‹ï¼Œæˆ–è€…ä»–ä»¬çš„å­<code>Context</code>å®ä¾‹ã€‚è¿™ä¸¤ä¸ªæ ¹éƒ¨<code>Context</code>çš„ä¸šåŠ¡å«ä¹‰æ˜¯ï¼š</p>
<ul>
<li><code>context.Background()</code>ï¼šä¸šåŠ¡å±‚é¢éœ€è¦èµ·ä¸€ä¸ªæœ€æ ¹éƒ¨çš„<code>Context</code>å®ä¾‹ï¼Œç»§æ‰¿è¿™ä¸ª</li>
<li><code>context.TODO()</code>ï¼šä¸šåŠ¡è¿˜ä¸æ¸…æ¥šç»§æ‰¿ä»€ä¹ˆ<code>Context</code>æ—¶ï¼Œç»§æ‰¿è¿™ä¸ª</li>
</ul>
<p>ä¸Šä¸€æ®µä»£ç æ¡ˆä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCtxBase</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    ctxBg := context.Background()</span><br><span class="line">    ctxTodo := context.TODO()</span><br><span class="line">    t.Logf(<span class="string">"context.Background: %s, %d"</span>, ctxBg, ctxBg)</span><br><span class="line">    t.Logf(<span class="string">"context.TODO: %s, %d"</span>, ctxBg, ctxTodo)</span><br><span class="line">    <span class="keyword">select</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> &lt;-ctxTodo.Done():</span><br><span class="line">        t.Logf(<span class="string">"context.TODO is done"</span>)</span><br><span class="line">    <span class="keyword">case</span> &lt;-time.After(<span class="number">1</span> * time.Second):</span><br><span class="line">        t.Logf(<span class="string">"timeout"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äº<code>context.Background()</code>å’Œ<code>context.TODO()</code>ä¸å¯å–æ¶ˆï¼Œæ˜¾ç„¶åœ°ï¼Œè¿™æ®µä»£ç ä¼š1ç§’ä¹‹åæ‰“å°<code>timeout</code>ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ¥çœ‹ä¸€ä¸‹ï¼Œ<code>context</code>æ€ä¹ˆåœ¨ä¸åŒ<code>goroutine</code>ä¹‹é—´å…±äº«ä¼šè¯æƒ…å¢ƒä¿¡æ¯ã€‚<code>Golang</code>é»˜è®¤å®šä¹‰äº†<code>context.WithCancel</code>ã€<code>context.WithCancelCause</code>ã€<code>context.WithDeadline</code>ä»¥åŠ<code>context.WithValue</code>ç­‰å‡ ä¸ª<code>Context</code>å®ä¾‹æ„é€ å™¨ï¼Œæ„é€ å‡ºæ¥çš„å†…å®¹é‡Œï¼Œé™¤äº†æ–°åˆ›å»ºçš„<code>Context</code>å®ä¾‹ä¹‹å¤–ï¼Œä¹Ÿä¼šç»™ä¸€äº›å›è°ƒå‡½æ•°ï¼Œç”¨æ¥ä¿®æ”¹æ–°<code>Context</code>å®ä¾‹çš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>é¦–å…ˆæ¥çœ‹<code>context.WithCancel</code>å’Œ<code>context.WithCancelCause</code>ï¼Œä¸¤è€…ä½œç”¨ç›¸ä¼¼ï¼š</p>
<ul>
<li><code>context.WithCancel(parent Context) (ctx Context, cancel CancelFunc)</code><ul>
<li>è¾“å…¥ï¼šçˆ¶<code>Context</code></li>
<li>è¾“å‡ºï¼šæ–°<code>Context</code>ã€ç”¨äºç»“æŸæ‰æ–°<code>Context</code>çš„å›è°ƒï¼Œç­¾åä¸º<code>func()</code></li>
</ul>
</li>
<li><code>context.WithCancelCause(parent Context) (ctx Context, cancel CancelFunc)</code><ul>
<li>è¾“å…¥ï¼šçˆ¶<code>Context</code></li>
<li>è¾“å‡ºï¼šæ–°<code>Context</code>ã€ç”¨äºç»“æŸæ‰æ–°<code>Context</code>çš„å›è°ƒï¼Œç­¾åä¸º<code>func(cause error)</code></li>
</ul>
</li>
</ul>
<p><code>context.WithCancelCause</code>ç›¸å¯¹äº<code>context.WithCancel</code>ï¼Œå”¯ä¸€çš„ä¸åŒç‚¹æ˜¯å¯ä»¥è¾“å…¥ä¸€ä¸ª<code>cause</code>ä¿¡æ¯ï¼Œæ¥å£°æ˜æ˜¯å› ä¸ºä»€ä¹ˆä¸šåŠ¡æ€§è´¨çš„åŸå› ä»è€Œå–æ¶ˆæ•´ä¸ª<code>Context</code>ï¼Œè€Œç¨‹åºå†™æ³•ä¸Šå¤§è‡´ç›¸ä¼¼ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬é’ˆå¯¹ä¸€æ¬¡ä¼šè¯ï¼Œå»ºç«‹èµ·è¿™æ ·çš„<code>goroutine</code>åä½œæ¨¡å¼ï¼š</p>
<ul>
<li>ä¸»<code>goroutine</code>å†³å®šæŸä¸ªä¼šè¯è¦ä¸è¦ç»§ç»­åšä¸‹å»</li>
<li>å­<code>goroutine</code>å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä½†æœŸé—´è¿˜è¦å…³æ³¨ä¸»<code>goroutine</code>çš„å†³ç­–ï¼Œæ¥å†³å®šç»§ä¸ç»§ç»­åš</li>
</ul>
<p>é‚£ä¹ˆä»ç¨‹åºè§’åº¦ï¼Œå°±å¯ä»¥å†™è¿™ä¹ˆä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCtxWithCancel</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    cancelCause := errors.New(<span class="string">"debug"</span>)</span><br><span class="line">    ctxCancel, cancel := context.WithCancelCause(context.Background())</span><br><span class="line">    t.Logf(<span class="string">"context.WithCancel: %v, %p -&gt; cause: %v"</span>, ctxCancel, cancel, cancelCause)</span><br><span class="line"></span><br><span class="line">    sleepTimeout := <span class="number">1</span> * time.Second  <span class="comment">// ä¸»goroutineè§‰å¾—è¿™ä¸ªå·¥ä½œè¯¥å®Œæˆçš„ç”¨æ—¶</span></span><br><span class="line">    waiterTimeout := <span class="number">2</span> * time.Second  <span class="comment">// å­goroutineè§‰å¾—è¿™ä¸ªå·¥ä½œè¯¥å®Œæˆçš„ç”¨æ—¶</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­goroutine</span></span><br><span class="line">    join := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, timeout time.Duration, retChan <span class="keyword">chan</span> <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> ret <span class="keyword">string</span></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():  <span class="comment">// ä¸»goroutineéƒ½ä¸å¹²äº†ï¼Œé‚£å°±æ‘†çƒ‚å§ï¼Œè¿”å›done</span></span><br><span class="line">            t.Logf(<span class="string">"ctx done! -&gt; err: %v, cause: %v"</span>, ctx.Err(), context.Cause(ctx))</span><br><span class="line">            ret = <span class="string">"done"</span></span><br><span class="line">        <span class="keyword">case</span> &lt;-time.After(waiterTimeout):  <span class="comment">// è¿”å›timeout</span></span><br><span class="line">            t.Logf(<span class="string">"waiter timeout"</span>)</span><br><span class="line">            ret = <span class="string">"timeout"</span></span><br><span class="line">        &#125;</span><br><span class="line">        retChan &lt;- ret</span><br><span class="line">    &#125;(ctxCancel, waiterTimeout, join)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»goroutineå†ç­‰å¾…sleepTimeoutå°±ä¸å¹²äº†</span></span><br><span class="line">    time.Sleep(sleepTimeout)</span><br><span class="line">    cancel(cancelCause)</span><br><span class="line">    t.Logf(<span class="string">"cancel done!"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// join waiter</span></span><br><span class="line">    ret := &lt;-join</span><br><span class="line">    t.Logf(<span class="string">"waiter ret: %s"</span>, ret)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ç§åœºæ™¯ä¸‹ï¼Œå¦‚æœ<code>sleepTimeout</code>å°äº<code>waiterTimeout</code>ï¼Œç”±äºä¸»<code>goroutine</code>å…ˆè°ƒç”¨<code>cancel</code>ï¼Œé‚£ä¹ˆå­<code>goroutine</code>çš„<code>select</code>é‡Œå°±ä¼šå…ˆç›‘å¬åˆ°<code>ctx.Done</code>ï¼Œä»è€Œç›´æ¥è¿”å›ä¸€ä¸ª<code>done</code>å­—ç¬¦ä¸²ç»“æŸæ‰ã€‚åä¹‹å¦‚æœ<code>sleepTimeout</code>å¤§äº<code>waiterTimeout</code>ï¼Œå­<code>goroutine</code>ä¼šç­‰åˆ°<code>waiterTimeout</code>ä¹‹åï¼Œå†è¿”å›ä¸€ä¸ª<code>timeout</code>å­—ç¬¦ä¸²ã€‚ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œ<code>ctxCancel</code>å®ä¾‹åœ¨ä¸»<code>goroutine</code>å’Œå­<code>goroutine</code>ä¹‹é—´æ˜¯æœ‰æ•ˆå…±äº«çš„ï¼Œä¸»<code>goroutine</code>é€šè¿‡<code>cancel</code>æ–¹æ³•æ“ä½œ<code>ctxCancel</code>å®ä¾‹çš„ç»“æœï¼Œå­<code>goroutine</code>æ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹<code>context.WithDeadline</code>ï¼Œå’Œ<code>context.WithCancel</code>ä¸€æ ·ï¼Œä¹Ÿæ˜¯è¿”å›æ–°çš„<code>Context</code>å®ä¾‹å’Œä¸»åŠ¨ç»“æŸæƒ…å¢ƒçš„<code>cancel</code>å‡½æ•°ã€‚ä½†æœ‰æ‰€ä¸åŒçš„æ˜¯ï¼Œä¸šåŠ¡éœ€è¦è¾“å…¥ä¸€ä¸ªè‡ªåŠ¨ç»“æŸæ‰æƒ…å¢ƒçš„<code>deadline</code>æ—¶åˆ»ï¼Œè¿™æ ·åˆ°äº†<code>deadline</code>çš„æ—¶å€™ï¼Œæ–°çš„<code>Context</code>å®ä¾‹ä¼šè‡ªåŠ¨åœ°<code>cancel</code>æ‰æ•´ä¸ªæƒ…å¢ƒã€‚æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥çœ‹ä¸‹<code>context.WithDeadline</code>æ€ä¹ˆé€šè¿‡æºç å®ç°çš„ï¼Œæœ¬æ–‡ä¸åšæºç è§£æï¼Œåªçœ‹ç”¨æ³•ã€‚</p>
<p>å‡è®¾å’Œåˆšæ‰ä¸€æ ·ï¼Œå¯¹äºä¸€æ¬¡ä¸šåŠ¡ä¼šè¯çš„åä½œå…³ç³»ï¼Œä¸»<code>goroutine</code>å†³å®šåšä¸åšï¼Œå­<code>goroutine</code>åšç‰›é©¬ï¼Œé‚£ä¹ˆå¦‚æœç”¨åˆ°<code>context.WithDeadline</code>çš„è¯ï¼Œå¯ä»¥è¿™æ ·æè¿°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCtxWithDeadline</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    timeout := <span class="number">3</span> * time.Second</span><br><span class="line"></span><br><span class="line">    deadline := time.Now().Add(timeout)</span><br><span class="line">    ctxDeadline, cancel := context.WithDeadline(context.Background(), deadline)</span><br><span class="line">    t.Logf(<span class="string">"context.WithDeadline: %v, %p"</span>, ctxDeadline, cancel)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// deadline/cancel detector</span></span><br><span class="line">    join := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(ctx context.Context, retChan <span class="keyword">chan</span> <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">var</span> ret <span class="keyword">string</span></span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">            ddl, ok := ctx.Deadline()</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                t.Logf(<span class="string">"ctx deadline not set"</span>)</span><br><span class="line">                ret = <span class="string">"nothing"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> time.Now().After(ddl) &#123;</span><br><span class="line">                t.Logf(<span class="string">"ctx reached deadline: %v -&gt; err: %v"</span>, ddl, ctx.Err())</span><br><span class="line">                ret = <span class="string">"deadline"</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                t.Logf(<span class="string">"ctx early canceled! -&gt; err: %v"</span>, ctx.Err())</span><br><span class="line">                ret = <span class="string">"cancel"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        retChan &lt;- ret</span><br><span class="line">    &#125;(ctxDeadline, join)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// manually cancel after cancelTimeout</span></span><br><span class="line">    cancelTimeout := <span class="number">1</span> * time.Second</span><br><span class="line">    time.Sleep(cancelTimeout)</span><br><span class="line">    cancel()</span><br><span class="line">    t.Logf(<span class="string">"cancel done!"</span>)</span><br><span class="line"></span><br><span class="line">    ret := &lt;-join</span><br><span class="line">    t.Logf(<span class="string">"ret: %s"</span>, ret)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“å­<code>goroutine</code>æœ‰ç›‘å¬åˆ°æ•´ä¸ªæƒ…å¢ƒç»“æŸæ—¶ï¼Œå°±æœ‰å‡ ç§å¯èƒ½æ€§ï¼š</p>
<ul>
<li>æƒ…å¢ƒæ²¡æœ‰è®¾ç½®<code>deadline</code>ï¼Œå› ä¸ºå…¶å®ƒåŸå› è¢«ç»“æŸæ‰</li>
<li>æƒ…å¢ƒè®¾ç½®äº†<code>deadline</code>ï¼Œå¹¶ä¸”åˆ°äº†<code>deadline</code>æ—¶é—´</li>
<li>æƒ…å¢ƒè®¾ç½®äº†<code>deadline</code>ï¼Œä½†è¿˜æ²¡åˆ°<code>deadline</code>æ—¶é—´å°±è¢«å…¶å®ƒåŸå› å–æ¶ˆæ‰äº†</li>
</ul>
<p>é‚£ä¹ˆä¸šåŠ¡å±‚é¢ï¼Œå°±å¯ä»¥æ ¹æ®è¿™å‡ ç§å¯èƒ½æ€§ï¼Œæ¥åˆ†é…ä¸åŒçš„ä¸šåŠ¡é€»è¾‘äº†ã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹<code>context.WithValue</code>çš„ä½œç”¨ã€‚<code>context.WithValue</code>ï¼Œæœ¬è´¨æ˜¯ä¸ºç»§æ‰¿çš„<code>Context</code>å®ä¾‹ï¼Œæ–°å¢ä¸€å¯¹<code>key</code>å’Œ<code>value</code>çš„æ˜ å°„ã€‚ç”¨æ³•éå¸¸ç®€å•ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCtxWithValue</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    key1, value1 := <span class="string">"hello"</span>, <span class="string">"world"</span></span><br><span class="line">    ctxValue1 := context.WithValue(context.Background(), key1, value1)</span><br><span class="line">    key2, value2 := <span class="string">"foo"</span>, <span class="string">"bar"</span></span><br><span class="line">    ctxValue2 := context.WithValue(ctxValue1, key2, value2)</span><br><span class="line"></span><br><span class="line">    t.Logf(<span class="string">"ctxValue1: %s"</span>, ctxValue1)</span><br><span class="line">    t.Logf(<span class="string">"ctxValue1.%s = %v"</span>, key1, ctxValue1.Value(key1))  <span class="comment">// world</span></span><br><span class="line">    t.Logf(<span class="string">"ctxValue1.%s = %v"</span>, key2, ctxValue1.Value(key2))  <span class="comment">// nil</span></span><br><span class="line">    t.Logf(<span class="string">"ctxValue2: %s"</span>, ctxValue2)</span><br><span class="line">    t.Logf(<span class="string">"ctxValue2.%s = %v"</span>, key1, ctxValue2.Value(key1))  <span class="comment">// world</span></span><br><span class="line">    t.Logf(<span class="string">"ctxValue2.%s = %v"</span>, key2, ctxValue2.Value(key2))  <span class="comment">// bar</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨é•¿é“¾è·¯è°ƒç”¨çš„åœºæ™¯ä¸‹ï¼ŒRPC/æ—¥å¿—æ¡†æ¶å±‚é¢ï¼Œå¯ä»¥çº¦å®šä¸€ç»„æºå¸¦è°ƒç”¨ä¿¡æ¯çš„<code>keys</code>ã€‚ä»¥æ­¤ä¸ºåŸºå‡†ï¼ŒRPCæ¡†æ¶åœ¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€æ¬¡è°ƒç”¨çš„<code>Context</code>ï¼Œé€šè¿‡<code>context.WithValue</code>ä¸ºè¿™äº›<code>keys</code>èµ‹å€¼ï¼Œç„¶åå†æŠŠåŒ…å«è°ƒç”¨ä¿¡æ¯çš„<code>Context</code>å®ä¾‹ç»™åˆ°ä¸šåŠ¡<code>handler</code>ã€‚ä¸šåŠ¡<code>handler</code>éœ€è¦åˆ©ç”¨åˆ°è¿™ä¸ª<code>Context</code>å®ä¾‹ï¼Œä¸ä»…è°ƒç”¨ä¸‹æ¸¸çš„æ—¶å€™éœ€è¦å¸¦ä¸Šï¼Œè€Œä¸”åœ¨æ—¥å¿—æ‰“å°é€»è¾‘ä¸­ï¼Œä¹Ÿéœ€è¦è¾“å…¥<code>Context</code>å®ä¾‹ï¼Œä»è€Œä½¿å¾—è°ƒç”¨ä¿¡æ¯å¯ä»¥åœ¨æ—¥å¿—ä¸­è¢«æ‰“å°å‡ºã€‚è¿™æ ·ä¸€æ¥ï¼Œè°ƒç”¨ä¿¡æ¯å°±å¯ä»¥è¦†ç›–åˆ°æ•´æ¡é“¾è·¯ã€‚å½“æˆ‘ä»¬éœ€è¦æ’æŸ¥è°ƒç”¨é€»è¾‘é—®é¢˜çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠè°ƒç”¨ä¿¡æ¯é‡ŒæŸä¸ª<code>key</code>çš„å€¼ä½œä¸ºæ—¥å¿—å…³é”®å­—ï¼Œä»è€ŒæŸ¥åˆ°æ•´æ¡é“¾è·¯çš„æ—¥å¿—äº†ã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>context</tag>
        <tag>WithCancel</tag>
        <tag>WithDeadline</tag>
        <tag>WithValue</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘ä¸€å¤©æå®šï¼Œçˆ¬è™«çˆ¬å–w3schoolsçš„sqlè¯­å¥æ¡ˆä¾‹é›†</title>
    <url>/2023/03/11/pythonnotes/w3schools_sqls_crawler/</url>
    <content><![CDATA[<p>åœ¨å¾ˆä¹…ä»¥å‰çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvRWFzeS1QeXRob24v" title="https://utmhikari.top/categories/Easy-Python/">Easy Python<i class="fa fa-external-link"></i></span>ç³»åˆ—ä¸­ï¼Œä»‹ç»äº†é€šè¿‡çˆ¬è™«æ‰‹æ®µ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMTkvMDMvMzEvZWFzeXB5dGhvbi9paWkv" title="https://utmhikari.top/2019/03/31/easypython/iii/">çˆ¬å–è±†ç“£ç”µå½±ä¿¡æ¯<i class="fa fa-external-link"></i></span>çš„ä¸€ç§æŠ€æœ¯å¥—è·¯ã€‚ä»Šå¤©æ•…æŠ€é‡æ–½ï¼Œä¸ºäº†è¿åˆå…ˆå‰åš<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjMvMDMvMDQvZ29mcm9temVyby8wOV9zcWxfcGFyc2VyLw==" title="https://utmhikari.top/2023/03/04/gofromzero/09_sql_parser/">SQLè¯­å¥åˆ†æ<i class="fa fa-external-link"></i></span>çš„éœ€è¦ï¼Œå†³å®šçˆ¬å–<span class="exturl" data-url="aHR0cHM6Ly93d3cudzNzY2hvb2xzLmNvbS9zcWwv" title="https://www.w3schools.com/sql/">w3schoolsç½‘ç«™<i class="fa fa-external-link"></i></span>ä¸Šé¢æ‰€æœ‰SQLæ¡ˆä¾‹ï¼Œç”¨ä½œæµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>æœ¬æ–‡å°±æ¥è¯¦ç»†è®²è¿°ï¼Œçˆ¬å–w3schoolsç½‘ç«™çš„å®ç°æ–¹å¼ï¼Œä»¥åŠé‡Œé¢éœ€è¦æ³¨æ„çš„ä¸€äº›ç‚¹ã€‚ä»£ç ç»Ÿä¸€æ”¾åœ¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS93M3NjaG9vbHNfc3Fsc19jcmF3bGVy" title="https://github.com/utmhikari/w3schools_sqls_crawler">è¿™é‡Œ<i class="fa fa-external-link"></i></span>ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆéœ€è¦å®šä½åŒ…å«SQLè¯­å¥çš„é¡µé¢å’Œå…ƒç´ ã€‚åœ¨w3schoolsç½‘ç«™å½“ä¸­ï¼Œä¾§è¾¹æ éƒ¨åˆ†ï¼ˆ<code>id=&#39;leftmenuinnerinner&#39;</code>ï¼‰åˆ—ä¸¾äº†æ‰€æœ‰é¡µé¢çš„é“¾æ¥ï¼Œé€šè¿‡ç½‘é¡µçš„<code>&lt;a target=&#39;_top&gt;</code>æ ‡ç­¾å°±èƒ½ç­›é€‰åˆ°ï¼Œé€šè¿‡<code>href</code>å±æ€§çš„æŒ‡å‘å°±èƒ½å¤ŸçŸ¥é“å¯¹åº”ç½‘é¡µçš„URLã€‚ä¹‹åï¼Œå¯¹äºæ¯ä¸ªç½‘é¡µé‡Œçš„SQLè¯­å¥ï¼Œæ‰€æœ‰è¯­å¥éƒ½å°è£…åœ¨<code>class=w3-code notranslate sqlHigh</code>æ ·å¼çš„æ ‡ç­¾å½“ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªéœ€è¦æ‹¿åˆ°æ‰€æœ‰ç½‘é¡µï¼Œéå†æ‰“å¼€æ‰€æœ‰é¡µé¢ï¼Œå†æŠŠæ‰€æœ‰SQLæ ‡ç­¾é‡Œçš„è¯­å¥æ–‡æœ¬æŠ½å‡ºæ¥ï¼Œå¤„ç†ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚</p>
<p>é€šè¿‡requestçš„GETæ–¹å¼ï¼Œèƒ½å¤Ÿç›´æ¥è·å–åˆ°URLå¯¹åº”çš„ç½‘é¡µå†…å®¹ï¼Œå†ç”¨BeautifulSoupè§£æï¼Œå°±èƒ½å¤Ÿæ‹¿åˆ°HTMLæ ‘ï¼Œç„¶åå°±å¯ä»¥æŒ‰ç…§è¿™äº›æ¡ä»¶æ¥å¯»æ‰¾å¯¹åº”å…ƒç´ ä»¥åŠé‡Œé¢çš„å†…å®¹äº†ã€‚</p>
<p>æ¯”å¦‚ï¼Œè·å–æ‰€æœ‰ç½‘é¡µçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_all_pages</span><span class="params">()</span> -&gt; List[Tuple[str, str]]:</span></span><br><span class="line">    <span class="comment"># get root page</span></span><br><span class="line">    page_url = ROOT_URL</span><br><span class="line">    print(<span class="string">'get all pages from %s'</span> % page_url)</span><br><span class="line">    resp = requests.get(page_url, headers=_headers())</span><br><span class="line">    soup = BeautifulSoup(resp.text, <span class="string">'html.parser'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># find leftmenuinnerinner</span></span><br><span class="line">    left_menu = soup.find(id=<span class="string">'leftmenuinnerinner'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># find all pages at &lt;a target="_top"&gt;</span></span><br><span class="line">    links = left_menu.find_all(name=<span class="string">'a'</span>, target=<span class="string">'_top'</span>)</span><br><span class="line">    pages = []</span><br><span class="line">    <span class="keyword">for</span> link <span class="keyword">in</span> links:</span><br><span class="line">        pages.append((link.text, link[<span class="string">'href'</span>]))</span><br><span class="line">    print(<span class="string">'all pages are: %s'</span> % json.dumps(pages, indent=<span class="number">2</span>, ensure_ascii=<span class="literal">False</span>))</span><br><span class="line">    print(<span class="string">'overall %d pages!'</span> % len(pages))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pages</span><br></pre></td></tr></table></figure>
<p>çˆ¬å–ä¸€ä¸ªç½‘é¡µçš„SQLæ¡ˆä¾‹é›†çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_crawl_sqls</span><span class="params">(name, page, referer_page=<span class="string">''</span>)</span>:</span></span><br><span class="line">    sql_set = set()</span><br><span class="line">    url = _page_url(page)</span><br><span class="line">    print(<span class="string">'[%s] crawling page url %s...'</span> % (name, url))</span><br><span class="line">    resp = requests.get(url, headers=_headers(referer_page=referer_page))</span><br><span class="line">    soup = BeautifulSoup(resp.text, <span class="string">'html.parser'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># get all examples in class="w3-code notranslate sqlHigh"</span></span><br><span class="line">    sql_blocks = soup.find_all(class_=<span class="string">'w3-code notranslate sqlHigh'</span>)</span><br><span class="line">    print(<span class="string">'[%s] overall %d sql blocks'</span> % (name, len(sql_blocks)))</span><br><span class="line">    <span class="keyword">for</span> sql_block <span class="keyword">in</span> sql_blocks:</span><br><span class="line">        <span class="comment"># some children blocks may not contain space, which leads to</span></span><br><span class="line">        <span class="comment"># extracting non-separated SQLs like -&gt; SELECT * FROM CustomersLIMIT 3;</span></span><br><span class="line">        <span class="comment"># so we should use get_text API</span></span><br><span class="line">        <span class="comment"># instead of using sql_block.text straightly</span></span><br><span class="line">        sql_text_no_endl = sql_block.get_text(<span class="string">' '</span>, strip=<span class="literal">True</span>).replace(<span class="string">'\n'</span>, <span class="string">' '</span>).strip()</span><br><span class="line">        sql_text = re.sub(<span class="string">r'\s+'</span>, <span class="string">' '</span>, sql_text_no_endl)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> sql_text.endswith(<span class="string">';'</span>):  <span class="comment"># add semicolon</span></span><br><span class="line">            sql_text = sql_text + <span class="string">';'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> sql_text <span class="keyword">not</span> <span class="keyword">in</span> sql_set:</span><br><span class="line">            print(<span class="string">'[%s] crawled new sql -&gt; %s'</span> % (name, sql_text))</span><br><span class="line">            sql_set.add(sql_text)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">'[%s] detected duplicated sql -&gt; %s'</span> % (name, sql_text))</span><br><span class="line"></span><br><span class="line">    sqls = list(sql_set)</span><br><span class="line">    print(<span class="string">'[%s] crawl finished! added %d sqls!'</span> % (name, len(sqls)))</span><br><span class="line">    <span class="keyword">return</span> sqls</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸¤å—ä»£ç å°±åŸºæœ¬ä¸Šå½¢æˆäº†çˆ¬è™«çš„ä¸»é€»è¾‘ï¼Œä½†æ˜¯ä»…æœ‰è¿™äº›è¿˜æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚å¾ˆå¤šç½‘ç«™ä¸ºäº†åçˆ¬è™«ï¼Œä¼šæœ‰ä¸€äº›é™æµæ“ä½œï¼Œæ¯”å¦‚åœ¨w3schoolsæ¯ç§’çˆ¬ä¸€ä¸ªç½‘é¡µçš„è¯ï¼Œçˆ¬åˆ°ä¸­é—´ä¼šrequestä¸åˆ°ç½‘é¡µçš„å†…å®¹ï¼Œè¿™å°±æœ‰å¯èƒ½è§¦å‘é™æµæœºåˆ¶äº†ã€‚é¢å¯¹è¿™ç§åœºæ™¯ï¼Œæœ‰å‡ ä¸ªæ–¹æ³•å¯ä»¥è§„é¿ï¼š</p>
<ul>
<li>æ—¶é—´é—´éš”ï¼šè°ƒæ•´é•¿ä¸€ç‚¹ï¼Œæ¯”å¦‚10sä¸€æ¬¡</li>
<li>User-Agentï¼šéšæœºè®¾ç½®ä¸ºä¸åŒæµè§ˆå™¨çš„UAï¼Œä½¿å¾—é™æµè®¤ä¸ºæ˜¯ä¸åŒçš„è®¿é—®</li>
<li>Refererï¼šè®¾ç½®ä¸ºç½‘ç«™ä¸»ç«™ï¼Œè¡¨ç¤ºæ˜¯ä»ä¸»ç«™è®¿é—®è¿‡æ¥å½“å‰ç½‘é¡µçš„</li>
<li>è‡ªåŠ¨å­˜å‚¨è¿›åº¦ï¼šæ¯çˆ¬ä¸€ä¸ªç½‘ç«™å°±æŠŠå½“å‰è¿›åº¦å­˜ä¸‹æ¥ï¼Œè¿™æ ·å¤±è´¥äº†ä¸‹ä¸€æ¬¡çˆ¬ï¼Œå°±å¯ä»¥ä¸éœ€è¦ä»ä¸€å¼€å§‹çˆ¬èµ·</li>
</ul>
<p>å¦‚æœè¿˜æœ‰æ›´é«˜çº§ç‚¹ï¼Œå¯ä»¥ç”¨ä»£ç†æœåŠ¡å™¨æ¥çˆ¬ï¼Œè¿™æ ·ä¹Ÿèƒ½è§„é¿é™æµæœºåˆ¶ã€‚é€šè¿‡ä»¥ä¸Šçš„æ–¹å¼ï¼Œå°±èƒ½æŠŠw3schoolsä¸Šé¢å‡ ç™¾æ¡SQLéƒ½ç»™çˆ¬å–åˆ°äº†ã€‚ä¸€å¤©æå®šï¼ŒEZPZï¼</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
        <tag>BeautifulSoup</tag>
        <tag>HTML</tag>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬ä¹è¯ï¼šç”¨goè¯­è¨€è§£æå¹¶åˆ†æsqlè¯­å¥çš„æ–¹æ³•</title>
    <url>/2023/03/04/gofromzero/09_sql_parser/</url>
    <content><![CDATA[<p>åœ¨<code>Golang</code>çš„å®æˆ˜ä¸­ï¼Œæ€»ä¼šé‡åˆ°ä¸€äº›åœºæ™¯ï¼Œæ¯”å¦‚æŠ“åŒ…åˆ†æ<code>sql</code>æŒ‡çº¹ï¼Œæˆ–è€…æ˜¯è¾“å…¥<code>sql</code>æ—¶æ£€æŸ¥<code>sql</code>çš„é£é™©ï¼Œè¿™ç±»æ“ä½œéƒ½éœ€è¦è§£æ<code>sql</code>çš„å·¥å…·æ‰èƒ½å¤Ÿç”Ÿæ•ˆã€‚ä»Šå¤©ï¼Œå°±æ¥ä»‹ç»ä¸€äº›<code>Golang</code>å½“ä¸­è§£æ<code>sql</code>çš„å·¥å…·åŒ…å’Œä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>æœ¬æ–‡ä»‹ç»çš„å·¥å…·æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2JsYXN0cmFpbi92aXRlc3Mtc3FscGFyc2Vy" title="https://github.com/blastrain/vitess-sqlparser">vitess-sqlparser<i class="fa fa-external-link"></i></span>ï¼Œä¸»è¦ç»“åˆäº†ä¸¤ä¸ª<code>sql</code>è§£æå·¥å…·ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3h3YjE5ODkvc3FscGFyc2Vy" title="https://github.com/xwb1989/sqlparser">xwb1989/sqlparser<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BpbmdjYXAvdGlkYi90cmVlL21hc3Rlci9wYXJzZXI=" title="https://github.com/pingcap/tidb/tree/master/parser">tidbparser<i class="fa fa-external-link"></i></span></li>
</ul>
<p>å…¶ä¸­ï¼Œ<code>xwb1989/sqlparser</code>é¡¹ç›®æ”¯æŒçš„åŠŸèƒ½æœ‰é™ï¼Œå°¤å…¶å¯¹äº<code>DDL</code>æ²¡æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œè€Œ<code>tidbparser</code>åˆ™åŠŸèƒ½æ¯”è¾ƒå…¨é¢ã€‚ä¸‹é¢ä»¥<code>tidbparser</code>ä¸ºä¾‹ï¼Œè®²è¿°ä¸€ä¸‹è§£æä»¥åŠåˆ†æ<code>sql</code>é‡Œ<code>DDL</code>è¯­å¥çš„ä¸€ç§æ–¹å¼ã€‚</p>
<p>ä»£ç ç›¸å…³å†™æ³•å¯ä»¥æŸ¥çœ‹<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zNDc3MDc2NQ==" title="https://zhuanlan.zhihu.com/p/34770765">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆè‡ªå®šä¹‰ä¸€ä¸ªè¦éªŒè¯çš„<code>DDL</code>è¯­å¥ï¼š</p>
<a id="more"></a>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Persons <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> DateOfBirth, <span class="keyword">DROP</span> <span class="keyword">COLUMN</span> <span class="keyword">ID</span>;</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾æ˜¯ä¸€ä¸ªåˆ é™¤åˆ—çš„è¯­å¥ï¼Œè¿™ç±»è¯­å¥åœ¨çº¿ä¸Šæ‰§è¡Œä¹Ÿæ˜¯ä¼šæœ‰é£é™©çš„ã€‚å¦‚æœç”¨<code>xwb1989/sqlparser</code>å·¥å…·ï¼Œæ˜¯æ— æ³•è§£æè¯†åˆ«çš„ï¼Œè€Œç”¨<code>tidbparser</code>ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sqlcheck</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">    <span class="string">"github.com/blastrain/vitess-sqlparser/tidbparser/ast"</span></span><br><span class="line">    <span class="string">"github.com/blastrain/vitess-sqlparser/tidbparser/parser"</span></span><br><span class="line">    <span class="string">"testing"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®SQLè§£ææ ‘èŠ‚ç‚¹çš„Visitor</span></span><br><span class="line"><span class="keyword">type</span> DropColumnVisitor <span class="keyword">struct</span> &#123;</span><br><span class="line">    TableName <span class="keyword">string</span></span><br><span class="line">    Columns   []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *DropColumnVisitor)</span> <span class="title">IsValid</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> v.TableName != <span class="string">""</span> &amp;&amp; <span class="built_in">len</span>(v.Columns) &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *DropColumnVisitor)</span> <span class="title">Enter</span><span class="params">(in ast.Node)</span> <span class="params">(out ast.Node, skipChildren <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"%T\n"</span>, in)</span><br><span class="line">    <span class="comment">// è¯†åˆ«äº†ALTERå°±ç›´æ¥è®¿é—®å­èŠ‚ç‚¹ï¼Œçœ‹æ˜¯ä¸æ˜¯DropColumn</span></span><br><span class="line">    <span class="keyword">switch</span> in.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> *ast.AlterTableStmt:</span><br><span class="line">        <span class="keyword">if</span> v.TableName != <span class="string">""</span> &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        node := in.(*ast.AlterTableStmt)</span><br><span class="line">        v.TableName = node.Table.Name.String()</span><br><span class="line">        <span class="keyword">for</span> _, spec := <span class="keyword">range</span> node.Specs &#123;</span><br><span class="line">            <span class="comment">// çœ‹è§£æçš„Tpæšä¸¾æ˜¯ä¸æ˜¯ast.AlterTableDropColumnå¯¹åº”çš„æšä¸¾</span></span><br><span class="line">            <span class="keyword">if</span> spec.Tp == ast.AlterTableDropColumn &#123;</span><br><span class="line">                v.Columns = <span class="built_in">append</span>(v.Columns, spec.OldColumnName.OrigColName())</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸éœ€è¦è®¿é—®å­èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">return</span> in, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(v *DropColumnVisitor)</span> <span class="title">Leave</span><span class="params">(in ast.Node)</span> <span class="params">(out ast.Node, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> in, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestParseDropColumn</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    sql := <span class="string">"ALTER TABLE Persons DROP COLUMN DateOfBirth, DROP COLUMN ID;"</span></span><br><span class="line">    sqlParser := parser.New()</span><br><span class="line">    stmtNodes, err := sqlParser.Parse(sql, <span class="string">""</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"Parse error: %v"</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    t.Logf(<span class="string">"stmt: %s"</span>, JsonDump(stmtNodes))</span><br><span class="line"></span><br><span class="line">    v := &amp;DropColumnVisitor&#123;</span><br><span class="line">        TableName: <span class="string">""</span>,</span><br><span class="line">        Columns:   []<span class="keyword">string</span>&#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¯ä¸ªæ ¹èŠ‚ç‚¹å¼€å§‹èµ·è®¿é—®</span></span><br><span class="line">    <span class="keyword">for</span> _, stmtNode := <span class="keyword">range</span> stmtNodes &#123;</span><br><span class="line">        stmtNode.Accept(v)</span><br><span class="line">    &#125;</span><br><span class="line">    t.Logf(<span class="string">"visitor: %s"</span>, JsonDump(v))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> !v.IsValid() &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"invalid drop column ddl"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    t.Logf(<span class="string">"drop columns %v at table %s"</span>, v.Columns, v.TableName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“è§£æäº†<code>sql</code>ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå®ç°äº†<code>Enter</code>å’Œ<code>Leave</code>æ–¹æ³•çš„<code>Visitor</code>æ¥å£<code>interface</code>ï¼Œæ‰èƒ½å¤Ÿå¼€å§‹è¯†åˆ«<code>sql</code>è§£ææ ‘å…·ä½“çš„å†…å®¹ã€‚è¿™é‡Œçµæ´»ç”¨åˆ°äº†æ¥å£<code>interface</code>çš„è®¾è®¡æ–¹å¼ï¼Œåœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjMvMDIvMTgvZ29mcm9temVyby8wOF9jYWNoZV9pbnRlcmZhY2Uv" title="https://utmhikari.top/2023/02/18/gofromzero/08_cache_interface/">cache-interface<i class="fa fa-external-link"></i></span>ä¸€ç¯‡æ–‡ç« ä¸­ä¹Ÿæœ‰ä»‹ç»åˆ°ã€‚å¦‚æœè§£æçš„èŠ‚ç‚¹æ˜¯<code>*ast.AlterTableStmt</code>ç±»å‹ï¼Œé‚£ä¹ˆé¦–å…ˆå®ƒå°±æ˜¯ä¸ª<code>ALTER</code>è¯­å¥ï¼Œå†å¾€ä¸‹éœ€è¦æŸ¥<code>Specs</code>å±æ€§é‡Œæ˜¯ä¸æ˜¯æœ‰<code>DROP COLUMN</code>å¯¹åº”çš„ç±»å‹æšä¸¾ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œé‚£å°±æ˜¯ä¸€ä¸ªåˆ é™¤åˆ—çš„è¯­å¥äº†ã€‚</p>
<p>æˆ‘ä»¬æ‰“å°æ•´ä¸ªè§£ææ ‘ï¼Œå°±èƒ½å¤Ÿæ¸…æ™°çš„çœ‹åˆ°ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">=== RUN   TestParseDropColumn</span><br><span class="line">    vitess_sqlparser_test.go:50: stmt: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;Table&quot;: &#123;</span><br><span class="line">              &quot;Schema&quot;: &#123;</span><br><span class="line">                &quot;O&quot;: &quot;&quot;,</span><br><span class="line">                &quot;L&quot;: &quot;&quot;</span><br><span class="line">              &#125;,</span><br><span class="line">              &quot;Name&quot;: &#123;</span><br><span class="line">                &quot;O&quot;: &quot;Persons&quot;,</span><br><span class="line">                &quot;L&quot;: &quot;persons&quot;</span><br><span class="line">              &#125;,</span><br><span class="line">              &quot;DBInfo&quot;: null,</span><br><span class="line">              &quot;TableInfo&quot;: null,</span><br><span class="line">              &quot;IndexHints&quot;: null</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Specs&quot;: [</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;Tp&quot;: 4,</span><br><span class="line">                &quot;Name&quot;: &quot;&quot;,</span><br><span class="line">                &quot;Constraint&quot;: null,</span><br><span class="line">                &quot;Options&quot;: null,</span><br><span class="line">                &quot;NewTable&quot;: null,</span><br><span class="line">                &quot;NewColumns&quot;: null,</span><br><span class="line">                &quot;OldColumnName&quot;: &#123;</span><br><span class="line">                  &quot;Schema&quot;: &#123;</span><br><span class="line">                    &quot;O&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;L&quot;: &quot;&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;Table&quot;: &#123;</span><br><span class="line">                    &quot;O&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;L&quot;: &quot;&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;Name&quot;: &#123;</span><br><span class="line">                    &quot;O&quot;: &quot;DateOfBirth&quot;,</span><br><span class="line">                    &quot;L&quot;: &quot;dateofbirth&quot;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;Position&quot;: null,</span><br><span class="line">                &quot;LockType&quot;: 0</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                &quot;Tp&quot;: 4,</span><br><span class="line">                &quot;Name&quot;: &quot;&quot;,</span><br><span class="line">                &quot;Constraint&quot;: null,</span><br><span class="line">                &quot;Options&quot;: null,</span><br><span class="line">                &quot;NewTable&quot;: null,</span><br><span class="line">                &quot;NewColumns&quot;: null,</span><br><span class="line">                &quot;OldColumnName&quot;: &#123;</span><br><span class="line">                  &quot;Schema&quot;: &#123;</span><br><span class="line">                    &quot;O&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;L&quot;: &quot;&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;Table&quot;: &#123;</span><br><span class="line">                    &quot;O&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;L&quot;: &quot;&quot;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &quot;Name&quot;: &#123;</span><br><span class="line">                    &quot;O&quot;: &quot;ID&quot;,</span><br><span class="line">                    &quot;L&quot;: &quot;id&quot;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;Position&quot;: null,</span><br><span class="line">                &quot;LockType&quot;: 0</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line">    vitess_sqlparser_test.go:59: visitor: &#123;</span><br><span class="line">          &quot;TableName&quot;: &quot;Persons&quot;,</span><br><span class="line">          &quot;Columns&quot;: [</span><br><span class="line">            &quot;DateOfBirth&quot;,</span><br><span class="line">            &quot;ID&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">    vitess_sqlparser_test.go:64: drop columns [DateOfBirth ID] at table Persons</span><br><span class="line">--- PASS: TestParseDropColumn (0.00s)</span><br><span class="line">PASS</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è§£æä¹‹åï¼Œå°±èƒ½å¤Ÿæå–å‡ºæ¥<code>ALTER</code>çš„è¡¨<code>Persons</code>ä»¥åŠ<code>DROP</code>çš„åˆ—<code>DateOfBirth</code>è·Ÿ<code>ID</code>ï¼Œä¹Ÿå°±ç¡®å®šäº†è¿™æ˜¯ä¸€ä¸ªåˆ é™¤åˆ—çš„æ“ä½œã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>sql</code>è§£æå™¨æœ¬èº«æ˜¯éå¸¸å¼ºå¤§çµæ´»çš„ã€‚é€šè¿‡æˆ‘ä»¬è‡ªå®šä¹‰ä¸€äº›é€»è¾‘è§„åˆ™ï¼Œèƒ½å¾ˆæ–¹ä¾¿çš„æ£€æŸ¥<code>sql</code>çš„åˆæ³•æ€§è·Ÿé£é™©æ€§ã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>SQL</tag>
        <tag>vitess-sqlparser</tag>
        <tag>tidbparser</tag>
        <tag>DDL</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬å…«è¯ï¼šé€šè¿‡cacheç¼“å­˜æ¨¡å—ç¤ºèŒƒinterfaceè¯¥æ€ä¹ˆç”¨</title>
    <url>/2023/02/18/gofromzero/08_cache_interface/</url>
    <content><![CDATA[<p>å’Œè®¸å¤šé¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œ<code>Golang</code>ä¹Ÿå­˜åœ¨<code>interface</code>æ¥å£è¿™æ ·çš„æ¦‚å¿µã€‚<code>interface</code>ç›¸å½“äºæ˜¯ä¸€ä¸ªä¸­é—´å±‚ï¼Œä¸‹æ¸¸åªéœ€è¦å…³å¿ƒ<code>interface</code>å®ç°äº†ä»€ä¹ˆè¡Œä¸ºï¼Œåˆ©ç”¨è¿™äº›è¡Œä¸ºåšäº›ä¸šåŠ¡çº§åˆ«äº‹æƒ…ï¼Œè€Œä¸Šæ¸¸åˆ™è´Ÿè´£å®ç°<code>interface</code>ï¼ŒæŠŠè¿™äº›è¡Œä¸ºå…·è±¡åŒ–ã€‚æœ¬æ–‡å°±æ¥é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¼“å­˜<code>cache</code>æ¨¡å—çš„å®ç°ï¼Œæ¥ç¤ºèŒƒä¸€ä¸‹<code>Golang</code>çš„<code>interface</code>è¯¥æ€ä¹ˆç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œä»ä¸šåŠ¡<code>service</code>è§’åº¦è€Œè¨€ï¼Œä¸€ä¸ªcacheæ¨¡å—å¯èƒ½éœ€è¦ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p>
<ul>
<li>è·å–ç¼“å­˜ä¸­çš„æŸä¸ªå€¼</li>
<li>ç¼“å­˜æ•°æ®ï¼ŒåŠ ç¼“å­˜æ—¶æ•ˆ</li>
<li>åˆ é™¤ç¼“å­˜å†…å®¹</li>
</ul>
<p>é‚£ä¹ˆè¿™äº›ä¸ªæ–¹æ³•ï¼Œå°±å¯ä»¥ç”¨ä¸€ç±»å«<code>Cache</code>çš„<code>interface</code>æ¥è¡¨ç¤ºï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Cache <span class="keyword">interface</span> &#123;</span><br><span class="line">    Get(key <span class="keyword">string</span>) (<span class="keyword">interface</span>&#123;&#125;, <span class="keyword">bool</span>)</span><br><span class="line">    Set(key <span class="keyword">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">    SetExpire(key <span class="keyword">string</span>, value <span class="keyword">interface</span>&#123;&#125;, expire time.Duration)</span><br><span class="line">    Delete(key <span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>Get</code>æ–¹æ³•è¿”å›ä¸€ä¸ª<code>interface{}</code>çš„<code>value</code>ï¼Œä»¥åŠæ˜¯å¦å­˜åœ¨çš„<code>bool</code>æ ‡è¯†ï¼›<code>Set</code>è·Ÿ<code>SetExpire</code>è¡¨ç¤ºæ— æ—¶é™è·Ÿæœ‰æ—¶é™çš„ç¼“å­˜è¡Œä¸ºï¼›<code>Delete</code>è¡¨ç¤ºåˆ é™¤ç¼“å­˜å†…å®¹ã€‚æ•´å—<code>Cache</code>çš„æ¥å£å®šä¹‰ä¹Ÿéå¸¸æ˜æ˜¾ã€‚</p>
<p>è¿™æ ·å†™æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿå¦‚æœä½ æ˜¯ä¸‹æ¸¸ä¸šåŠ¡æœåŠ¡çš„è¯ï¼Œä½ åªéœ€è¦è¿™æ ·å†™å°±å¯ä»¥äº†ã€‚è¿™é‡Œç»™ä¸€ä¸ªåŒ<code>package</code>ä¸‹çš„æµ‹è¯•ç”¨ä¾‹ä»£ç ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestCache</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    k, v := <span class="string">"hello"</span>, <span class="string">"world"</span></span><br><span class="line">    <span class="comment">// Current()çš„å®ç°ï¼Œåœ¨ä¸‹æ–‡æ…¢æ…¢è§£é‡Š</span></span><br><span class="line">    <span class="keyword">var</span> curCache Cache = Current()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set &amp; get &amp; delete</span></span><br><span class="line">    curCache.Set(k, v)</span><br><span class="line">    cached, ok := curCache.Get(k)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"cannot cache %s:%s"</span>, k, v)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        t.Logf(<span class="string">"got cached %s:%v (type: %s)"</span>, k, cached, reflect.TypeOf(cached).Name())</span><br><span class="line">    &#125;</span><br><span class="line">    curCache.Delete(k)</span><br><span class="line">    _, ok = curCache.Get(k)</span><br><span class="line">    <span class="keyword">if</span> ok &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"cannot delete %s:%s"</span>, k, v)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        t.Logf(<span class="string">"delete cached %s:%s"</span>, k, v)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set expire</span></span><br><span class="line">    curCache.SetExpire(k, v, <span class="number">1</span>*time.Second)</span><br><span class="line">    cached, ok = curCache.Get(k)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"cannot cache %s:%s"</span>, k, v)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        t.Logf(<span class="string">"got cached %s:%v (type: %s)"</span>, k, cached, reflect.TypeOf(cached).Name())</span><br><span class="line">    &#125;</span><br><span class="line">    time.Sleep(<span class="number">3</span> * time.Second)</span><br><span class="line">    _, ok = curCache.Get(k)</span><br><span class="line">    <span class="keyword">if</span> ok &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"cannot expire %s:%s"</span>, k, v)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        t.Logf(<span class="string">"expired %s:%s"</span>, k, v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬æŒ‡å®šçš„ç¼“å­˜å¯¹è±¡<code>curCache</code>æ ‡è¯†ä¸ºä¸€ä¸ª<code>Cache</code>ï¼Œæ˜¯ä¸ªæ¥å£å®šä¹‰ï¼Œè¿™æ ·æ ‡è¯†èµ·æ¥çš„è¯ï¼Œä¸‹é¢çš„ä»£ç å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨<code>Get</code>ã€<code>Set</code>ä¹‹ç±»çš„æ–¹æ³•äº†ã€‚è€Œæ›´é‡è¦çš„æ˜¯ï¼Œä¸‹é¢çš„ä»£ç ï¼Œä¸ä¼šå› ä¸º<code>Cache</code>çš„å…·ä½“å®ç°å˜åŒ–è€Œæœ‰æ‰€å˜åŒ–ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ æœ‰10ä¸ªå¼€æºçš„ç¼“å­˜åº“ï¼Œæƒ³å®šæ—¶åˆ‡æ¢<code>Current() Cache</code>èƒŒåçš„ç¼“å­˜å¯¹è±¡å®ç°ï¼Œå°±ç®—ä½ å†æ€ä¹ˆæ¢ï¼Œåªè¦ç”¨åˆ°ç¼“å­˜çš„ä»£ç æ ‡æ³¨ç¼“å­˜å¯¹è±¡ä¸º<code>Cache</code>è¿™ä¸ª<code>interface</code>ï¼Œå¹¶ä¸”<code>interface</code>çš„å®šä¹‰æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆä½¿ç”¨ç¼“å­˜çš„ä»£ç å°±ä¸éœ€è¦åŠ¨ã€‚è¿™æ ·ï¼Œå°±å½»åº•å®ç°äº†ç¼“å­˜æä¾›æ–¹å’Œä½¿ç”¨æ–¹çš„è§£è€¦ï¼Œå¼€å‘æ•ˆç‡ä¹Ÿä¼šå™Œå™Œå™Œçš„ä¸Šå»ã€‚</p>
<p>æ—¢ç„¶æåˆ°äº†æä¾›æ–¹<code>Provider</code>çš„æ¦‚å¿µï¼Œé‚£åœ¨ç¼“å­˜çš„å®ç°ä¸Šï¼Œå°±å¯ä»¥èµ°ä¾èµ–æ³¨å…¥æ§åˆ¶åè½¬çš„æ¨¡å¼ã€‚å‡è®¾æŸä¸ªWebæœåŠ¡æœ‰ä¸ªæœ¬åœ°ç¼“å­˜æ¨¡å—ï¼Œåœ¨å®ç°ä¸Šï¼Œå°±å¯ä»¥è€ƒè™‘æä¾›å¤šä¸ª<code>Cache</code>æ¥å£çš„å®ç°ï¼ŒåŒæ—¶åœ¨é…ç½®é‡ŒæŒ‡å®šé»˜è®¤çš„ä¸€ç§ã€‚è¿™é‡Œï¼Œå°±ä»¥<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3BhdHJpY2ttbi9nby1jYWNoZQ==" title="https://github.com/patrickmn/go-cache">go-cache<i class="fa fa-external-link"></i></span>ä¸ºä¾‹ï¼Œåšä¸€ä¸ªå®ç°æ¡ˆä¾‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/patrickmn/go-cache"</span></span><br><span class="line">    <span class="string">"time"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    GoCacheDefaultExpiration = <span class="number">10</span> * time.Minute</span><br><span class="line">    GoCacheCleanupInterval   = <span class="number">15</span> * time.Minute</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> GoCache <span class="keyword">struct</span> &#123;</span><br><span class="line">    c *cache.Cache</span><br><span class="line"></span><br><span class="line">    defaultExpiration time.Duration</span><br><span class="line">    cleanupInterval   time.Duration</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GoCache)</span> <span class="title">Get</span><span class="params">(key <span class="keyword">string</span>)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> g.c.Get(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GoCache)</span> <span class="title">Set</span><span class="params">(key <span class="keyword">string</span>, value <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    g.c.Set(key, value, GoCacheDefaultExpiration)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GoCache)</span> <span class="title">SetExpire</span><span class="params">(key <span class="keyword">string</span>, value <span class="keyword">interface</span>&#123;&#125;, expire time.Duration)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> expire &lt; <span class="number">0</span> &#123;</span><br><span class="line">        expire = g.defaultExpiration</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> expire &gt; g.cleanupInterval &#123;</span><br><span class="line">        expire = g.cleanupInterval</span><br><span class="line">    &#125;</span><br><span class="line">    g.c.Set(key, value, expire)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g *GoCache)</span> <span class="title">Delete</span><span class="params">(key <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    g.c.Delete(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGoCache</span><span class="params">()</span> *<span class="title">GoCache</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;GoCache&#123;</span><br><span class="line">        c: cache.New(GoCacheDefaultExpiration, GoCacheCleanupInterval),</span><br><span class="line"></span><br><span class="line">        defaultExpiration: GoCacheDefaultExpiration,</span><br><span class="line">        cleanupInterval:   GoCacheCleanupInterval,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>GoCache</code>çš„<code>struct</code>ï¼Œå®ç°äº†<code>Cache</code>æ¥å£å®šä¹‰çš„æ‰€æœ‰è¡Œä¸ºï¼Œé‚£ä¹ˆ<code>GoCache</code>çš„å®ä¾‹ï¼Œåœ¨<code>Golang</code>é‡Œï¼Œå°±èƒ½å¤Ÿè¢«æ ‡è¯†ä¸ºä¸€ä¸ª<code>Cache</code>æ¥å£å®ä¾‹ã€‚<code>NewGoCache</code>æ–¹æ³•ï¼Œä¸ä»…æ˜¯æä¾›äº†ä¸€ä¸ª<code>GoCache</code>çš„å®ä¾‹ï¼Œè€Œåœ¨ä¸šåŠ¡å±‚é¢ï¼Œæ›´æ˜¯æä¾›äº†ä¸€ä¸ª<code>Cache</code>å®ä¾‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•ç”¨ä¸€ä¸ª<code>map</code>æ¥ç®¡ç†æ‰€æœ‰çš„<code>Cache</code>çš„æ„é€ å™¨ï¼Œä»è€Œæ ‡è¯†ä¸åŒçš„ç¼“å­˜å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">provideGoCache</span><span class="params">()</span> <span class="title">Cache</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> NewGoCache()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> cacheProviders = <span class="keyword">map</span>[<span class="keyword">string</span>]Cache&#123;</span><br><span class="line">    <span class="string">"go-cache"</span>: provideGoCache(),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> (</span><br><span class="line">    DefaultCacheProvider = <span class="string">"go-cache"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Get</span><span class="params">(provider <span class="keyword">string</span>)</span> <span class="title">Cache</span></span> &#123;</span><br><span class="line">    c, ok := cacheProviders[provider]</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Default</span><span class="params">()</span> <span class="title">Cache</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Get(DefaultCacheProvider)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸Šæ–‡æåˆ°çš„æ ·ä¾‹ä»£ç ï¼Œå°±ç”¨äº†è¿™ä¸ªæ–¹æ³•æ‹¿åˆ°go-cacheå®ç°çš„Cacheæ¥å£å®ä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Current</span><span class="params">()</span> <span class="title">Cache</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Default()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ˜¾è€Œæ˜“è§ï¼Œé€šè¿‡è¿™æ ·çš„ä¸€ä¸ªä»£ç ç»„ç»‡ï¼Œä¸è®ºæ˜¯<code>go-cache</code>ï¼ŒæŠ‘æˆ–æ˜¯å…¶å®ƒçš„<code>Cache</code>å®ç°ï¼Œéƒ½å¯ä»¥é›†ä¸­ç®¡ç†å¹¶çµæ´»å–ç”¨ã€‚è¿™ï¼Œä¾¿æ˜¯<code>interface</code>åœ¨<code>Golang</code>ç¼–ç¨‹ä¸­ç»™æˆ‘ä»¬å¸¦æ¥çš„ä¾¿åˆ©äº†ã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>ä¾èµ–æ³¨å…¥</tag>
        <tag>interface</tag>
        <tag>cache</tag>
        <tag>go-cache</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘VMWareè®¾ç½®ä¸»æœºè¿æ¥åˆ°çš„Ubuntuè™šæ‹Ÿæœºçš„ç½‘ç»œç«¯å£</title>
    <url>/2023/02/05/diymemo/vmware_ubuntu_network/</url>
    <content><![CDATA[<p>å¾ˆå¤šåŒå­¦åœ¨è‡ªå·±æœºå™¨ä¸Šç©å¼€å‘çš„æ—¶å€™ï¼Œéƒ½ä¼šç”¨åˆ°<code>VMWare</code>ã€<code>VirtualBox</code>ä¹‹ç±»çš„è™šæ‹ŸOSå®¹å™¨è£…ä¸€ä¸ªå¸¦<code>GUI</code>çš„<code>Linux OS</code>ï¼Œç„¶ååœ¨é‡Œé¢å¦å¤–å®‰è£…å¼€å‘å·¥å…·åšå¼€å‘ã€‚è¿™é‡Œé¢é‡åˆ°çš„æœ€ç»å…¸é—®é¢˜ï¼Œå°±æ˜¯æ¯”å¦‚æˆ‘åœ¨è™šæ‹Ÿæœºé‡Œé¢èµ·äº†ä¸ª<code>MySQL</code>ã€<code>Redis</code>ä¹‹ç±»çš„æœåŠ¡ï¼Œå¦‚æœDBçš„å®¢æˆ·ç«¯/GUIå·¥å…·æ˜¯æ”¾åœ¨ä¸»æœºé‡Œé¢ï¼Œä¸åœ¨è™šæ‹Ÿæœºé‡Œï¼Œé‚£æ€ä¹ˆè¿è¿›å»ï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œæœ¬æ–‡æä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æœ¬æ–‡é‡‡å–çš„è™šæ‹Ÿæœºç¯å¢ƒå¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸»æœºï¼šWin11</li>
<li>è™šæ‹Ÿæœºå®¹å™¨ï¼šVMWare Workstation 16</li>
<li>è™šæ‹Ÿæœºï¼šUbuntu 22.04</li>
</ul>
<p>é¦–å…ˆéœ€è¦äº†è§£åˆ°ï¼Œ<code>VMWare</code>åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨<code>NAT</code>æ¨¡å¼æ–°å¼€ä¸€ä¸ªç½‘æ®µæ¥ç®¡ç†è™šæ‹Ÿæœºçš„ç½‘ç»œé…ç½®ï¼Œè€Œè™šæ‹Ÿæœºå†…éƒ¨ï¼Œå‡è®¾ä½¿ç”¨<code>IPV4</code>ï¼Œä¼šé»˜è®¤é‡‡å–<code>DHCP</code>æœºåˆ¶ï¼Œè‡ªåŠ¨è®¾ç½®ä¸€ä¸ª<code>IP</code>è·Ÿç›¸åº”çš„ç½‘ç»œé…ç½®ã€‚ç›¸å…³èµ„æ–™å¯ä»¥çœ‹è¿™å‡ ç¯‡æ–‡æ¡£ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80NzcxNDc4MDE=" title="https://zhuanlan.zhihu.com/p/477147801">ç½‘ç»œä¸­çš„NATæ¨¡å¼<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOEElQTglRTYlODAlODElRTQlQjglQkIlRTYlOUMlQkElRTklODUlOEQlRTclQkQlQUUlRTUlOEQlOEYlRTglQUUlQUUvMTA3Nzg2NjM=" title="https://baike.baidu.com/item/%E5%8A%A8%E6%80%81%E4%B8%BB%E6%9C%BA%E9%85%8D%E7%BD%AE%E5%8D%8F%E8%AE%AE/10778663">DHCPç™¾åº¦ç™¾ç§‘<i class="fa fa-external-link"></i></span></li>
</ul>
<p>è€Œä¸ºäº†è®©æˆ‘ä»¬ä¸»æœºèƒ½è¿åˆ°è™šæ‹Ÿæœºå†…éƒ¨ï¼Œå®é™…ä¸Šæ˜¯æ»¡è¶³ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€å³å¯ï¼š</p>
<a id="more"></a>
<ul>
<li>ä¸»æœºçŸ¥é“è™šæ‹Ÿæœºçš„IPï¼Œèƒ½å¤Ÿç›´è¿è™šæ‹ŸæœºIP</li>
<li>ä¸»æœºç«¯å£å’ŒæŸä¸ªIPçš„è™šæ‹Ÿæœºç«¯å£å­˜åœ¨è½¬å‘æ˜ å°„å…³ç³»</li>
</ul>
<p>åœ¨æœ¬æ–‡çš„åœºæ™¯ä¸‹ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ç¬¬äºŒç§ã€‚å…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆï¼Œåœ¨<code>VMWare</code>çš„<code>ç¼–è¾‘</code>èœå•æ‰“å¼€<code>è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</code>ï¼Œé€‰ä¸­ç”¨äºç®¡ç†ä½ è™šæ‹Ÿæœºç½‘ç»œçš„ä¸€ç»„è™šæ‹Ÿç½‘ç»œï¼ˆæ¯”å¦‚æ˜¯<code>NATæ¨¡å¼</code>ï¼Œåå­—æ˜¯<code>VMnet8</code>è¿™ç§ï¼‰ã€‚å¦‚æœä½ ä¸ç¡®å®šä½ çš„è™šæ‹Ÿæœºæ˜¯ä¸æ˜¯<code>NATæ¨¡å¼</code>ï¼Œå¯ä»¥åœ¨è™šæ‹Ÿæœºè‡ªå·±çš„è®¾ç½®é‡ŒæŸ¥çœ‹<code>ç¡¬ä»¶ -&gt; ç½‘ç»œé€‚é…å™¨</code>é¡¹ç›®ï¼Œçœ‹æ˜¯ä¸æ˜¯<code>NATæ¨¡å¼</code>ã€‚</p>
<p>é€‰ä¸­<code>NATæ¨¡å¼</code>è™šæ‹Ÿç½‘ç»œé…ç½®ä¹‹åï¼Œç‚¹å‡»<code>NATè®¾ç½®</code>æŒ‰é’®ï¼Œå³å¯è¿›å…¥åˆ°ç«¯å£è½¬å‘æ˜ å°„è®¾ç½®ã€‚</p>
<p><img src="/uploads/diymemo/vmware_ubuntu_network/vmnet_nat_config.png" alt="NATç«¯å£è®¾ç½®"></p>
<p>åœ¨å…¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>NAT</code>ç½‘ç»œçš„<code>å­ç½‘IP</code>ã€<code>å­ç½‘æ©ç </code>è·Ÿ<code>ç½‘å…³IP</code>ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¼šåœ¨åç»­çš„è™šæ‹Ÿæœºå†…éƒ¨è®¾ç½®é‡Œç”¨ä¸Šï¼Œè€Œå†ä¸‹é¢çš„<code>ç«¯å£è½¬å‘</code>éƒ¨åˆ†ï¼Œå°±æ˜¯éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é…ç½®çš„å†…å®¹ã€‚å…¶ä¸­åŒ…æ‹¬å‡ é¡¹ï¼š</p>
<ul>
<li>è™šæ‹ŸæœºIPåœ°å€ï¼šè™šæ‹Ÿæœºçš„IP+ç«¯å£</li>
<li>ç±»å‹ï¼šTCP/UDPï¼Œæ ‡è¯†ä»€ä¹ˆç±»å‹çš„æ•°æ®åŒ…ä¼šè¢«è½¬å‘</li>
<li>ä¸»æœºç«¯å£ï¼šé€‰å®šä¸€ä¸ªä¸»æœºç«¯å£ï¼Œè¿™æ ·å‘åˆ°ä¸»æœºç«¯å£çš„æŒ‡å®š<code>ç±»å‹</code>çš„æ•°æ®åŒ…ä¼šè¢«è½¬å‘åˆ°å¯¹åº”<code>è™šæ‹ŸæœºIPåœ°å€</code></li>
</ul>
<p>æ¯”å¦‚è™šæ‹Ÿæœºé‡Œé¢<code>MySQL</code>å¼€åœ¨<code>3306</code>ç«¯å£ï¼Œé‚£ä¹ˆ<code>è™šæ‹ŸæœºIPåœ°å€</code>ä¸€é¡¹å°±å¡«<code>è™šæ‹ŸæœºIP:3306</code>ï¼Œç±»å‹å¡«<code>TCP</code>ï¼Œä¸»æœºç«¯å£å¡«ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„å³å¯ã€‚</p>
<p>é‚£ä¹ˆè¿™é‡Œå°±é—ç•™å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šè™šæ‹ŸæœºIPæ€ä¹ˆå¡«ï¼Ÿè¿™é‡Œçš„è¯ï¼Œä»¥<code>Ubuntu</code>ä¸ºä¾‹ï¼Œç”±äºé»˜è®¤æ˜¯ç”¨<code>DHCP</code>æœºåˆ¶åˆ†é…IPï¼Œå› æ­¤IPå¯èƒ½ä¸æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åšçš„æ˜¯ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å»è®¾ç½®å›ºå®šä¸€ä¸ªIPï¼Œç„¶åæŠŠè¿™ä¸ªIPå›å¡«åˆ°<code>è™šæ‹ŸæœºIPåœ°å€</code>ä¸€é¡¹å½“ä¸­ã€‚</p>
<p>åœ¨æ­¤ä¹‹å‰ï¼Œé¦–å…ˆå›åˆ°<code>VMWare</code>çš„<code>è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</code>å½“ä¸­ï¼Œé€‰ä¸­åˆšæ‰<code>NAT</code>çš„ä¸€ç»„è™šæ‹Ÿç½‘ç»œï¼Œç‚¹å‡»<code>DHCP</code>è®¾ç½®æŒ‰é’®ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç½‘ç»œçš„é…ç½®è·Ÿ<code>DHCP</code>çš„åˆ†é…åœ°å€ï¼š</p>
<p><img src="/uploads/diymemo/vmware_ubuntu_network/vmnet_dhcp_config.png" alt="DHCPè®¾ç½®"></p>
<p>è¿™é‡Œæˆ‘ä»¬åªéœ€è¦è®°ä½çš„ä¿¡æ¯æ˜¯<code>èµ·å§‹IPåœ°å€</code>è·Ÿ<code>ç»“æŸIPåœ°å€</code>ã€‚æˆ‘ä»¬åé¢è®¾ç½®è™šæ‹Ÿæœºå›ºå®šçš„IPåœ°å€æ—¶ï¼Œéœ€è¦åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å†…ã€‚</p>
<p>ç„¶åè¿›å…¥è™šæ‹Ÿæœºï¼Œä»¥ç¬”è€…ç”¨çš„<code>Ubuntu 22.04</code>ä¸ºä¾‹ï¼Œå³ä¸Šè§’<code>å¼€å…³æŒ‰é’®</code>ç‚¹å‡»ä¸‹æ‹‰<code>Settings</code>ä¸€æ ï¼Œé€‰æ‹©<code>Network</code>é¡µç­¾ï¼Œç„¶åé€‰ä¸­å½“å‰è¿æ¥åˆ°çš„ç½‘ç»œç‚¹<code>è®¾ç½®å›¾æ ‡</code>è¿›å…¥è®¾ç½®ç•Œé¢ã€‚</p>
<p><img src="/uploads/diymemo/vmware_ubuntu_network/ubuntu_network_panel.png" alt="Ubuntuç½‘ç»œè®¾ç½®é¢æ¿"></p>
<p>ç”±äºå…ˆå‰è®¾ç½®çš„ç½‘ç»œIPéƒ½æ˜¯<code>IPV4</code>çš„ï¼Œå› æ­¤åœ¨ç½‘ç»œé€‰é¡¹å½“ä¸­ï¼Œé€‰ä¸­<code>IPV4</code>é¡µç­¾ï¼Œå³å¯å¼€å§‹ç¼–è¾‘ã€‚ç¼–è¾‘çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/diymemo/vmware_ubuntu_network/ubuntu_ipv4_config.png" alt="Ubuntuçš„IPV4è®¾ç½®"></p>
<p>è¿™é‡Œéœ€è¦ç¼–è¾‘å‡ ä¸ªç‚¹ï¼š</p>
<ul>
<li><code>IPV4 Method</code>ï¼šé€‰æ‹©<code>Manual</code>ï¼Œè¡¨ç¤ºæ‰‹åŠ¨é…ç½®</li>
<li><code>Addresses</code>ï¼šåœ°å€ï¼Œè¿™é‡Œæ–°å»ºä¸€è¡Œ<ul>
<li><code>Address</code>ï¼šç½‘æ®µåˆ†é…çš„IPåœ°å€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¦è®¾ç½®çš„<code>è™šæ‹Ÿæœºå›ºå®šIP</code>ï¼Œå‚è€ƒä¸Šé¢<code>DHCPè®¾ç½®</code>é‡Œçš„ç½‘æ®µèŒƒå›´è‡ªé€‰ä¸€ä¸ª</li>
<li><code>Netmask</code>ï¼šå­ç½‘æ©ç ï¼Œåœ¨ä¸Šé¢<code>NATè®¾ç½®</code>å½“ä¸­æœ‰ç›¸å…³ä¿¡æ¯</li>
<li><code>Gateway</code>ï¼šç½‘å…³IPï¼Œåœ¨ä¸Šé¢<code>NATè®¾ç½®</code>å½“ä¸­æœ‰ç›¸å…³ä¿¡æ¯</li>
</ul>
</li>
<li><code>DNS</code>ï¼šDNSçš„IPï¼Œè¿™ä¸ªåœºæ™¯å¡«å†™è·Ÿ<code>Gateway</code>ä¸€æ ·çš„å³å¯</li>
</ul>
<p>å¼„å¥½ä¹‹å<code>Apply</code>ï¼Œç„¶åé‡å¯è™šæ‹Ÿæœºï¼Œå°±å¯ä»¥è¯•è¯•çœ‹è¡Œä¸è¡Œäº†ã€‚æ³¨æ„ï¼Œä¸»æœºä¸€è¾¹ï¼Œéœ€è¦å‘è¯·æ±‚åˆ°å…ˆå‰<code>ç«¯å£è½¬å‘</code>è®¾ç½®é‡Œçš„<code>ä¸»æœºç«¯å£</code>ï¼Œæ‰èƒ½å¤Ÿç”Ÿæ•ˆï¼</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>è™šæ‹Ÿæœº</tag>
        <tag>VMWare</tag>
        <tag>NAT</tag>
        <tag>Ubuntu</tag>
        <tag>DHCP</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘å‡†å…¥å‡†å‡ºè´¨é‡çº¢çº¿çš„æŠ€æœ¯è®¾è®¡</title>
    <url>/2023/01/26/testlife/quality_redline_design/</url>
    <content><![CDATA[<p>åœ¨åº”ç”¨æ—¥å¸¸å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä¸è®ºæ˜¯åœ¨æµ‹è¯•ã€å¼€å‘è”è°ƒï¼Œè¿˜æ˜¯å®é™…æ„å»ºå‘å¸ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä¸€å®šçš„æŒ‡æ ‡å»è¡¡é‡æŠ€æœ¯äº§ç‰©çš„è´¨é‡ï¼Œä»è€Œåˆ¤æ–­æŠ€æœ¯äº§ç‰©æ˜¯å¦ç¬¦åˆè´¨é‡æ ‡å‡†ï¼Œæ˜¯å¦èƒ½å¤Ÿç»§ç»­å‘å¸ƒæŠ•äº§ï¼Œå¦‚æœä¸ç¬¦åˆæŠ•äº§æ ‡å‡†åˆ™æ‹¦æˆªå‘å¸ƒã€‚ä»å‘å¸ƒè¿‡ç¨‹çš„è§’åº¦ï¼Œç”±äºä¸€èˆ¬å‘å¸ƒè¿‡ç¨‹ä¼šæ”¶å£åˆ°ç‰¹å®šçš„CIæµæ°´çº¿ä¸Šï¼Œå› æ­¤åœ¨åšè¿™ç±»èƒ½åŠ›çš„æ—¶å€™ï¼Œé€šå¸¸æ˜¯é‡‡ç”¨å¼€å‘ä¸€ä¸ªç‰¹æ®Šçš„è´¨é‡çº¢çº¿åŸå­çš„æ–¹æ¡ˆï¼Œé›†æˆåˆ°CIæµæ°´çº¿å½“ä¸­ï¼Œå®ç°å‘å¸ƒå‡†å…¥å‡†å‡ºçš„åŸå­èƒ½åŠ›ã€‚</p>
<p>å‡†å…¥å‡†å‡ºè´¨é‡çº¢çº¿èƒ½åŠ›çš„å¼€å‘è€…ï¼Œé€šå¸¸æ˜¯DevOpsä¸­å°ï¼Œä¸­å°æä¾›åŸå­èƒ½åŠ›ä»¥åŠé…ç½®åŒ–çš„èƒ½åŠ›ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡å»é…ç½®ç›¸åº”çš„æŒ‡æ ‡äº§å‡ºä¸æ‹¦æˆªè§„åˆ™ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å¥—ç”¨ç‰¹å®šçš„æ¨¡æ¿æ¥å¿«é€Ÿå®ç°å‡†å…¥å‡†å‡ºçš„æ•ˆæœã€‚æœ¬æ–‡å°±æ¥è®¨è®ºï¼Œè¿™ç±»èƒ½åŠ›è¦å¼€å‘å‡ºæ¥ï¼Œåœ¨æŠ€æœ¯å®ç°ä¸Šï¼Œéœ€è¦åšæ€æ ·çš„è€ƒè™‘è·Ÿè®¾è®¡ã€‚</p>
<p>é¦–å…ˆï¼Œé’ˆå¯¹çœŸå®ä¸šåŠ¡ï¼Œè¦ç”¨åˆ°å‡†å…¥å‡†å‡ºè´¨é‡çº¢çº¿çš„è¯ï¼Œå¯èƒ½ä¼šè€ƒè™‘ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>æ—¥å¸¸å¼€å‘ææµ‹ï¼Œåœ¨ä»£ç æäº¤MRæ—¶ï¼Œé€šè¿‡MRçš„hookè§¦å‘å¯¹æœ€æ–°ä»£ç çš„è§„èŒƒæ£€æŸ¥<ul>
<li>ä»£ç æ£€æŸ¥éœ€è¦å…³å¿ƒä¸€ç³»åˆ—æŒ‡æ ‡ï¼ŒåŒ…æ‹¬ï¼šä»£ç ç¼ºé™·ã€ä»£ç å®‰å…¨ã€ç¼–ç è§„èŒƒã€é‡å¤ä»£ç ã€å¤æ‚åº¦</li>
<li>ä¸ç¬¦åˆæŒ‡æ ‡çš„æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºè¢«è´¨é‡çº¢çº¿æ‹¦æˆªï¼ŒMRè¢«é˜»æ­¢</li>
</ul>
</li>
<li>ç‰ˆæœ¬è½¬æµ‹æ—¶ï¼Œä¿è¯ä»£ç è´¨é‡ä¸å•å…ƒæµ‹è¯•ä»£ç è¦†ç›–ç‡ç¬¦åˆè¦æ±‚<ul>
<li>ä¸ç¬¦åˆæŒ‡æ ‡çš„æƒ…å†µä¸‹ï¼Œç»ˆæ­¢å½’æ¡£æ„ä»¶</li>
</ul>
</li>
<li>ç”¨æˆ·é‡‡ç”¨è„šæœ¬ç­‰æ–¹å¼ï¼Œè‡ªå®šä¹‰å‘å¸ƒçº¢çº¿æŒ‡æ ‡ä¸ç”Ÿæˆè¿‡ç¨‹ï¼Œä¸ç¬¦åˆæŒ‡æ ‡çš„ï¼Œé˜»æ­¢å‘å¸ƒæµç¨‹</li>
</ul>
<p>å› æ­¤ï¼Œä»æŠ€æœ¯å®ç°è§’åº¦ä¸Šï¼Œè¿™é‡Œå¯ä»¥æ‹†è§£æˆå‡ ä¸ªç»´åº¦ï¼š</p>
<a id="more"></a>
<ul>
<li>çº¢çº¿æŒ‡æ ‡<ul>
<li>æŒ‡æ ‡è®¾ç½®ï¼šæ•°å€¼ç±»å‹ã€æ¯”è¾ƒç¬¦å·ä»¥åŠé˜ˆå€¼</li>
<li>é€‚ç”¨èŠ‚ç‚¹ï¼šå¦‚bashè„šæœ¬ä»»åŠ¡åŸå­èŠ‚ç‚¹</li>
<li>æŒ‡æ ‡å¤§ç±»ï¼šå†…ç½®æŒ‡æ ‡ã€è‡ªå®šä¹‰æŒ‡æ ‡</li>
<li>æŒ‡æ ‡ä¸šåŠ¡ç±»å‹ï¼šä»£ç æ£€æŸ¥ã€æµ‹è¯•ã€å®‰å…¨ç­‰</li>
<li>å¼€æ”¾èŒƒå›´ï¼šé¡¹ç›®å†…é€‚ç”¨è¿˜æ˜¯å…¨å±€é€‚ç”¨</li>
<li>æŒ‡æ ‡ç”Ÿæˆæ–¹å¼çº¦å®š</li>
</ul>
</li>
<li>çº¢çº¿è§„åˆ™<ul>
<li>å¼•ç”¨äº†ä»€ä¹ˆçº¢çº¿æŒ‡æ ‡</li>
<li>åŒ…å«å“ªäº›å‡†å…¥å‡†å‡ºè§„åˆ™</li>
<li>æ‹¦æˆªå®¡æ‰¹æœºåˆ¶<ul>
<li>è‡ªåŠ¨/äººå·¥å®¡æ‰¹ï¼Œè¶…æ—¶å¤„ç†</li>
<li>è§¦å‘æ‹¦æˆªåï¼Œç»ˆæ­¢CIæµæ°´çº¿ï¼Œå‘¨çŸ¥ç›¸å…³äººå‘˜</li>
</ul>
</li>
</ul>
</li>
<li>æ‰§è¡Œè®°å½•<ul>
<li>æ‹¦æˆªæŠ¥å‘Šï¼šä¸šåŠ¡ã€ç»“æœæ˜ç»†ã€å¤„ç†äººã€å¤„ç†ç»“æœã€å¤„ç†åŸå› </li>
<li>æ•°æ®åˆ†æï¼šå„ä¸šåŠ¡çš„æ‹¦æˆª/é€ƒé€¸ç‡ä»¥åŠåŸå› åˆ†æ</li>
</ul>
</li>
</ul>
<p>ä»ä¸šåŠ¡ä¾§çš„è§’åº¦ï¼Œæœ€å…³å¿ƒçš„å†…å®¹æ˜¯ã€æ‹¦æˆªæŠ¥å‘Šã€‘ã€‚ä½œä¸ºæœ€ç»ˆè¾“å‡ºäº§ç‰©ï¼Œæ‹¦æˆªæŠ¥å‘Šéœ€è¦æœ‰è¯¦å°½çš„ä¿¡æ¯å¸®åŠ©ä¸šåŠ¡å†³å®šå‘å¸ƒå†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚åœ¨æ‹¦æˆªæŠ¥å‘Šçš„å®ç°å½“ä¸­ï¼Œæœ‰å‡ ç‚¹ç»†èŠ‚éœ€è¦ä½“ç°ï¼š</p>
<ul>
<li>å³æ—¶é€šçŸ¥ï¼šæ‹¦æˆªçš„é€šçŸ¥ï¼Œå¯ä»¥æ˜¯é‚®ä»¶æˆ–è€…IMç¾¤ï¼Œä½†ä¸€å®šè¦å‘¨çŸ¥åˆ°å¯¹åº”çš„äºº<ul>
<li>å¦‚æœå­˜åœ¨å‘Šè­¦ï¼Œéœ€è¦æœ‰ä¸åŒçº§åˆ«çš„å‘Šè­¦æœºåˆ¶</li>
</ul>
</li>
<li>æ‹¦æˆªåŸå› ï¼šåœ¨å“ªä¸ªæ­¥éª¤æ‹¦æˆªï¼Œå› ä¸ºä»€ä¹ˆè¢«æ‹¦æˆª</li>
<li>æ‹¦æˆªæ˜ç»†ï¼šæ‹¦æˆªçš„æŒ‡æ ‡ä¸­ï¼Œå…·ä½“æœ‰å“ªäº›åœ°æ–¹æŠ¥é”™ï¼Œç›¸å…³çš„å†…å®¹è·Ÿæ•°å€¼æŒ‡æ ‡æ˜¯ä»€ä¹ˆ</li>
<li>é—®é¢˜åˆ†æï¼šä¸è®ºæŒ‡æ ‡æ˜¯å¦é€šè¿‡ï¼Œå¯¹äºå…¨éƒ¨æ‰«å‡ºæ¥çš„é—®é¢˜ï¼ŒæŒ‰ç…§ä¼˜å…ˆçº§åˆ’åˆ†<ul>
<li>è®©å¼€å‘è€…çŸ¥é“å“ªäº›é—®é¢˜éœ€è¦ä¼˜å…ˆä¿®å¤ï¼Œé˜²æ­¢éƒ¨åˆ†æŒ‡æ ‡é€šè¿‡ä½†å…¶ä¸­ä»é—ç•™ä¸¥é‡é—®é¢˜çš„æƒ…å†µ</li>
</ul>
</li>
<li>ä¿®å¤æŒ‡å¼•ï¼šéœ€è¦é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼Œæ‰èƒ½ä¿®å¤æ‹¦æˆªçš„é—®é¢˜<ul>
<li>è¿™ä¸€ç‚¹æ¯”è¾ƒé‡è¦ï¼Œèƒ½å¤Ÿç›´æ¥å¼ºåŒ–æ‹¦æˆªæŒ‡æ ‡çš„æ•ˆåŠ›</li>
</ul>
</li>
</ul>
<p>å¥½æ¯”è¯´ï¼Œé’ˆå¯¹ä»£ç æ£€æŸ¥åœºæ™¯ï¼Œä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œå¯èƒ½å¯¹åº”ä¸åŒçš„ä»£ç æ£€æŸ¥å·¥å…·ï¼Œæ¯”å¦‚Clangã€Coverityã€ESLintè¿™äº›ï¼Œä½†å³ä¾¿å¦‚æ­¤ï¼Œä»£ç æ£€æŸ¥çš„ç»“æœéƒ½æ˜¯ç»Ÿä¸€çš„ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œéœ€è¦äº†è§£åˆ°ï¼Œå“ªé‡Œçš„ä»£ç å‡ºäº†é—®é¢˜ï¼Œè¿™äº›é—®é¢˜å¦‚ä½•ä¿®å¤æ’æŸ¥ï¼Œä»¥åŠç›¸å¯¹äºä»¥å‰çš„æŠ¥å‘Šï¼Œå‡å°‘æˆ–è€…æ–°å¢äº†ä»€ä¹ˆé—®é¢˜ã€‚å¤§å¤šæ•°çº¿ä¸Šé—®é¢˜éƒ½ç”±å˜æ›´äº§ç”Ÿï¼Œå› æ­¤è¯¦ç»†äº†è§£æ£€æŸ¥é—®é¢˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä¸å†å²é—®é¢˜çš„å¯¹æ¯”ï¼Œéƒ½æ˜¯åœ¨æ‹¦æˆªæŠ¥å‘Šä¸­ï¼Œå¾ˆéœ€è¦çªå‡ºçš„å†…å®¹ã€‚</p>
<p>æœ€åï¼Œå‡†å…¥å‡†å‡ºè´¨é‡çº¢çº¿çš„åŸå­èƒ½åŠ›ï¼Œé’ˆå¯¹çº¢çº¿æŒ‡æ ‡ã€çº¢çº¿è§„åˆ™ã€æ‹¦æˆªå‘Šè­¦æ–¹é¢ï¼Œéƒ½å¯ä»¥æŠ½è±¡å›ºåŒ–å‡ºé€šç”¨çš„æ ·æ¿é—´ï¼Œè®©ä¸šåŠ¡å¾—ä»¥å¿«é€Ÿæ¥å…¥è·Ÿé…ç½®ã€‚è¿™æ ·èƒ½å¤Ÿæ˜¾è‘—å‡å°‘è½åœ°æˆæœ¬ï¼Œæå‡è½åœ°æ•ˆç‡ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>å‡†å…¥å‡†å‡º</tag>
        <tag>CI</tag>
        <tag>åŸå­èƒ½åŠ›</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬ä¸ƒè¯ï¼šåå°„æ¨¡å—reflectä½¿ç”¨æ–¹å¼æ¢ç´¢</title>
    <url>/2023/01/01/gofromzero/07_reflect_module/</url>
    <content><![CDATA[<p><code>Golang</code>çš„åå°„åŠŸèƒ½ï¼Œåœ¨å¾ˆå¤šåœºæ™¯éƒ½ä¼šç”¨åˆ°ï¼Œæœ€åŸºç¡€çš„è«è¿‡äº<code>rpc</code>ã€<code>orm</code>è·Ÿ<code>json</code>çš„ç¼–è§£ç ï¼Œæ›´å¤æ‚çš„å¯èƒ½ä¼šåˆ°åšå¦å¤–ä¸€é—¨è¯­è¨€çš„è™šæ‹Ÿæœºã€‚é€šè¿‡åå°„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¼–ç¨‹è¯­è¨€çš„<code>runtime</code>è¿è¡Œæ—¶æœŸé—´å»è®¿é—®å†…éƒ¨äº§ç”Ÿå¯¹è±¡çš„ä¿¡æ¯ã€‚äº†è§£åå°„æ¨¡å—çš„å®ç°ï¼Œå¯¹æˆ‘ä»¬äº†è§£<code>Golang</code>å¯¹è±¡æœºåˆ¶æœ¬èº«ï¼Œä¹Ÿæ˜¯è«å¤§çš„å¸®åŠ©ã€‚</p>
<p>ä»Šå¤©ï¼Œæ°é€¢é˜³åº·+æ–°å¹´ï¼Œå°±å†³å®šæ¥æ¢ç©¶ä¸€ä¸‹<code>Golang</code>çš„åå°„æ¨¡å—â€”â€”<code>reflect</code>ã€‚</p>
<p>ä»æœ€åŸºç¡€çš„å¼€å§‹ï¼Œ<code>reflect</code>æ¨¡å—ï¼Œä»¥è·å–æ•´æ•°å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç”¨ï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflect_Integer</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    i := <span class="number">1</span></span><br><span class="line">    v := reflect.ValueOf(i)</span><br><span class="line">    vKind := v.Kind()</span><br><span class="line">    vType := v.Type()</span><br><span class="line">    t.Logf(<span class="string">"i kind: %+v\n"</span>, vKind)</span><br><span class="line">    t.Logf(<span class="string">"i type: %+v\n"</span>, vType)</span><br><span class="line"></span><br><span class="line">    itf := v.Interface()</span><br><span class="line">    j, ok := itf.(<span class="keyword">int</span>)</span><br><span class="line">    t.Logf(<span class="string">"j val: %+v\n"</span>, j)</span><br><span class="line">    <span class="keyword">if</span> !ok || j != i &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"i != j"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>reflect.ValueOf</code>çš„å…¥å‚æ˜¯<code>interface{}</code>ç±»å‹ï¼Œæ–°ç‰ˆæœ¬ä¹Ÿå«åš<code>any</code>ï¼Œå¾—åˆ°çš„è¿”å›å€¼æ˜¯<code>reflect.Value</code>ç±»å‹çš„å¯¹è±¡ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯å¯¹åŸå¯¹è±¡çš„ä¸€ä¸ªæè¿°æ€§è´¨çš„å¯¹è±¡ï¼ˆå…ƒå¯¹è±¡ï¼Œ233ï¼‰ã€‚<code>reflect.Value</code>åŒ…å«å‡ ä¸ªæˆå‘˜ï¼š</p>
<ul>
<li><code>typ</code>ï¼šåŸå¯¹è±¡ç±»å‹çš„å…ƒä¿¡æ¯</li>
<li><code>ptr</code>ï¼šæŒ‡å‘åŸå¯¹è±¡å€¼çš„åŸç”ŸæŒ‡é’ˆ</li>
<li><code>flag</code>ï¼šåŸå¯¹è±¡ç±»å‹çš„æ­£æ•´æ•°æ ‡è¯†</li>
</ul>
<p>å½“è°ƒç”¨<code>Kind</code>è·Ÿ<code>Type</code>æ¥å£ï¼Œå››èˆäº”å…¥å°±æ˜¯è·å–äº†<code>reflect.Value</code>å¯¹è±¡çš„<code>flag</code>è·Ÿ<code>typ</code>æˆå‘˜å®ä¾‹äº†ã€‚</p>
<p>è¦æŠŠ<code>reflect.Value</code>è½¬æ¢å›åŸå¯¹è±¡ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡<code>Interface</code>æ–¹æ³•è½¬åŒ–æˆ<code>interface{}</code>ç±»å‹çš„å¯¹è±¡ï¼Œå†é€šè¿‡<code>.(int)</code>å¼ºè½¬é€»è¾‘å»è½¬åŒ–æˆåŸå¯¹è±¡ã€‚ä½†è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼Œå¦‚æœçœŸéœ€è¦ç”¨åˆ°<code>reflect</code>åå°„åŠŸèƒ½ä¸”æ¶‰åŠåˆ°ä¸€äº›çœ‹ä¼¼è¦â€œå¼ºè½¬â€çš„åœºæ™¯ï¼Œå¯èƒ½æ˜¯æ²¡æœ‰å¿…è¦çœŸçš„åœ¨ä»£ç ä¸­å¼ºè½¬å›ç‰¹å®šç±»å‹å¯¹è±¡çš„ã€‚å¥½æ¯”<code>rpc</code>çš„è°ƒç”¨ï¼Œå®è´¨æ˜¯åœ¨å£°æ˜æ¥å£æ–¹æ³•çš„åŸºç¡€ä¸Šï¼ŒæŠŠæ¥å£æ–¹æ³•å˜æˆ<code>reflect.Value</code>å¯¹è±¡ï¼Œå†ç”¨<code>Func.Call</code>æ–¹æ³•åšå‡½æ•°è°ƒç”¨ã€‚è¿™é‡Œï¼Œä¹Ÿç»™ä¸ª<code>example</code>ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬å®šä¹‰<code>User</code>ç»“æ„ä½“ï¼Œå†…éƒ¨åµŒå¥—<code>UserInfo</code>ç»“æ„ä½“ï¼Œå‡æœ‰<code>json</code>æ ‡æ³¨ï¼Œç„¶åå®šä¹‰äº†<code>ToString</code>è·Ÿ<code>Response</code>ä¸¤ä¸ªæ–¹æ³•ï¼Œå¤§æ¦‚é•¿è¿™æ ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> UserInfo <span class="keyword">struct</span> &#123;</span><br><span class="line">    Desc <span class="keyword">string</span> <span class="string">`json:"desc"`</span></span><br><span class="line">    City <span class="keyword">string</span> <span class="string">`json:"city" desc:"the city of user"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID   <span class="keyword">int</span>       <span class="string">`json:"id"`</span></span><br><span class="line">    Name <span class="keyword">string</span>    <span class="string">`json:"name"`</span></span><br><span class="line">    Info *UserInfo <span class="string">`json:"info"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">ToString</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"[%d]%s"</span>, u.ID, u.Name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">Response</span><span class="params">(from <span class="keyword">string</span>, msg <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">"User %s received msg %s from &lt;%s&gt;"</span>, u.ToString(), msg, from)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆæ¯”å¦‚<code>Response</code>æ–¹æ³•ï¼Œå®é™…ä¸Šä¹Ÿèƒ½å¤Ÿè¿™æ ·è°ƒç”¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflect_Method</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    u := &amp;User&#123;<span class="number">1</span>, <span class="string">"jack"</span>, <span class="literal">nil</span>&#125;</span><br><span class="line">    uPtr := reflect.ValueOf(u)</span><br><span class="line">    <span class="comment">// MethodByNameï¼šè·å–ç‰¹å®šåå­—çš„Method</span></span><br><span class="line">    meth, ok := uPtr.Type().MethodByName(<span class="string">"Response"</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"no method named Response"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    t.Logf(<span class="string">"meth Response: %+v\n"</span>, meth)</span><br><span class="line"></span><br><span class="line">    methType := meth.Type</span><br><span class="line">    <span class="comment">// å…¥å‚3ä¸ªï¼šUserå®ä¾‹ã€fromã€msg</span></span><br><span class="line">    <span class="keyword">if</span> methType.NumIn() != <span class="number">3</span> &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"invalid NumIn %d, expected %d"</span>, methType.NumIn(), <span class="number">3</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿”å›å€¼1ä¸ªï¼šresponse string</span></span><br><span class="line">    <span class="keyword">if</span> methType.NumOut() != <span class="number">1</span> &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"invalid NumOut %d, expected %d"</span>, methType.NumOut(), <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é€šè¿‡Func.Callå¾—åˆ°è¿”å›å€¼list</span></span><br><span class="line">    from, msg := reflect.ValueOf(<span class="string">"client"</span>), reflect.ValueOf(<span class="string">"ping"</span>)</span><br><span class="line">    rets := meth.Func.Call([]reflect.Value&#123;uPtr, from, msg&#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(rets) != <span class="number">1</span> &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"invalid num rets %d, expected %d"</span>, <span class="built_in">len</span>(rets), <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¿”å›1ä¸ªstringå¯¹è±¡</span></span><br><span class="line">    respVal := rets[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">if</span> respVal.Type() != reflect.TypeOf(<span class="string">""</span>) &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"invalid ret type %v, expected %s"</span>, respVal.Type(), <span class="string">"STRING"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    resp, ok := respVal.Interface().(<span class="keyword">string</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"ret value cannot be converted to string"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    t.Logf(<span class="string">"resp: %s\n"</span>, resp)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>MethodByName</code>æ–¹æ³•ï¼Œå¯ä»¥å®šä½åˆ°ä¸€ä¸ªå¯¹è±¡ä¸‹çš„æŸä¸ªåå­—çš„æ–¹æ³•å®ä¾‹ï¼Œé€šè¿‡å¯¹æ–¹æ³•å®ä¾‹è°ƒç”¨<code>Func.Call</code>ï¼Œå°±èƒ½å®é™…å®ç°å¯¹æ–¹æ³•çš„è°ƒç”¨ï¼Œå¾—åˆ°è¿”å›å€¼åˆ—è¡¨ã€‚</p>
<p>æ¶‰åŠåˆ°æŒ‡é’ˆå¯¹è±¡çš„åå°„å€¼ï¼Œå¯ä»¥é€šè¿‡<code>reflect.Indirect(åå°„å€¼)</code>æˆ–è€…<code>åå°„å€¼.Elem()</code>çš„æ–¹å¼ï¼Œè·å–åˆ°æŒ‡é’ˆæŒ‡å‘å®ä¾‹çš„åå°„å€¼ã€‚<code>example</code>ä»£ç å¦‚ä¸‹ï¼Œå› ä¸ºä¸Šé¢æˆ‘ä»¬å®šä¹‰<code>ToString</code>å’Œ<code>Response</code>æ–¹æ³•ç»‘å®šçš„æ˜¯æŒ‡é’ˆå¯¹è±¡ï¼Œåœ¨è¿™æ ·çš„æ¡ä»¶ä¸‹ï¼ŒæŒ‡é’ˆæŒ‡å‘å®ä¾‹çš„åå°„å€¼å°±æ‹¿ä¸åˆ°<code>ToString</code>æ–¹æ³•äº†ï¼Œæ‰“å°ä¾¿çŸ¥ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflect_Pointer</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    u := &amp;User&#123;<span class="number">1</span>, <span class="string">"jack"</span>, <span class="literal">nil</span>&#125;</span><br><span class="line">    vPtr := reflect.ValueOf(u)</span><br><span class="line">    vPtrKind := vPtr.Kind()</span><br><span class="line">    vPtrType := vPtr.Type()</span><br><span class="line">    t.Logf(<span class="string">"ptr kind: %+v\n"</span>, vPtrKind)</span><br><span class="line">    t.Logf(<span class="string">"ptr type: %+v\n"</span>, vPtrType)</span><br><span class="line">    meth, ok := vPtrType.MethodByName(<span class="string">"ToString"</span>)</span><br><span class="line">    t.Logf(<span class="string">"ptr meth ToString: %+v (%+v)\n"</span>, meth, ok)</span><br><span class="line"></span><br><span class="line">    vVal := reflect.Indirect(vPtr)</span><br><span class="line">    <span class="comment">// vVal := vPtr.Elem()</span></span><br><span class="line">    vValKind := vVal.Kind()</span><br><span class="line">    vValType := vVal.Type()</span><br><span class="line">    t.Logf(<span class="string">"val kind: %+v\n"</span>, vValKind)</span><br><span class="line">    t.Logf(<span class="string">"val type: %+v\n"</span>, vValType)</span><br><span class="line">    meth, ok = vValType.MethodByName(<span class="string">"ToString"</span>)</span><br><span class="line">    t.Logf(<span class="string">"val meth ToString: %+v (%+v)\n"</span>, meth, ok)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å†è¿›ä¸€æ­¥æ¥çœ‹ï¼Œå¯¹äº<code>slice</code>ã€<code>map</code>è¿™ç±»å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>reflect.Value</code>å†…ç½®çš„ä¸€äº›æ–¹æ³•ï¼Œè®¿é—®åˆ°å†…éƒ¨çš„å¯¹è±¡ã€‚å‡è®¾æˆ‘ä»¬è¦å®ç°<code>slice</code>è·Ÿ<code>map</code>çš„å¤åˆ¶æ“ä½œï¼Œç”¨çº¯åå°„çš„æ–¹å¼ä¹Ÿå¯ä»¥å®ç°ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflect_CopySliceAndMap</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    mp := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>&#123;</span><br><span class="line">        <span class="string">"jack"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">"tom"</span>:  <span class="number">2</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    sl := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>&#125;</span><br><span class="line">    vals := []reflect.Value&#123;reflect.ValueOf(mp), reflect.ValueOf(sl)&#125;</span><br><span class="line">    <span class="keyword">var</span> copyVals []reflect.Value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, val := <span class="keyword">range</span> vals &#123;</span><br><span class="line">        <span class="keyword">var</span> copyVal reflect.Value</span><br><span class="line">        <span class="keyword">switch</span> val.Kind() &#123;</span><br><span class="line">        <span class="keyword">case</span> reflect.Map:</span><br><span class="line">            <span class="comment">// MakeMapï¼šåˆ›å»ºmapå®ä¾‹</span></span><br><span class="line">            copyVal = reflect.MakeMap(val.Type())</span><br><span class="line">            <span class="comment">// MapRangeï¼šè·å–mapå¯¹è±¡çš„Iterator</span></span><br><span class="line">            iter := val.MapRange()</span><br><span class="line">            <span class="keyword">for</span> iter.Next() &#123;</span><br><span class="line">                copyVal.SetMapIndex(iter.Key(), iter.Value())</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> reflect.Slice:</span><br><span class="line">            <span class="comment">// AppendSliceï¼šåœ¨ä¸€ä¸ªsliceçš„åŸºç¡€ä¸Šextendå¦ä¸€ä¸ªslice</span></span><br><span class="line">            copyVal = reflect.AppendSlice(</span><br><span class="line">                reflect.MakeSlice(val.Type(), <span class="number">0</span>, val.Len()),</span><br><span class="line">                val)</span><br><span class="line">        &#125;</span><br><span class="line">        copyVals = <span class="built_in">append</span>(copyVals, copyVal)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡DeepEqualæ–¹æ³•ï¼Œå¯ä»¥åšå€¼çš„ç›¸ç­‰æ€§æ¯”è¾ƒ</span></span><br><span class="line">    <span class="keyword">for</span> _, val := <span class="keyword">range</span> copyVals &#123;</span><br><span class="line">        <span class="keyword">switch</span> val.Kind() &#123;</span><br><span class="line">        <span class="keyword">case</span> reflect.Map:</span><br><span class="line">            <span class="keyword">if</span> val.Len() != <span class="built_in">len</span>(mp) &#123;</span><br><span class="line">                t.Fatalf(<span class="string">"invalid map length %d, expected %d"</span>, val.Len(), <span class="built_in">len</span>(mp))</span><br><span class="line">            &#125;</span><br><span class="line">            copyVal, ok := val.Interface().(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">int</span>)</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                t.Fatalf(<span class="string">"map convert failed"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            t.Logf(<span class="string">"copied map: %+v"</span>, copyVal)</span><br><span class="line">            <span class="keyword">for</span> k, v := <span class="keyword">range</span> mp &#123;</span><br><span class="line">                copyV, ok := copyVal[k]</span><br><span class="line">                <span class="keyword">if</span> !ok || !reflect.DeepEqual(v, copyV) &#123;</span><br><span class="line">                    t.Fatalf(<span class="string">"copy value of key %s failed, expected %d, actual %d"</span>, k, v, copyV)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">case</span> reflect.Slice:</span><br><span class="line">            <span class="keyword">if</span> val.Len() != <span class="built_in">len</span>(sl) &#123;</span><br><span class="line">                t.Fatalf(<span class="string">"invalid slice length %d, expected %d"</span>, val.Len(), <span class="built_in">len</span>(sl))</span><br><span class="line">            &#125;</span><br><span class="line">            copyVal, ok := val.Interface().([]<span class="keyword">int</span>)</span><br><span class="line">            <span class="keyword">if</span> !ok &#123;</span><br><span class="line">                t.Fatalf(<span class="string">"slice convert failed"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            t.Logf(<span class="string">"copied slice: %+v"</span>, copyVal)</span><br><span class="line">            <span class="keyword">if</span> !reflect.DeepEqual(copyVal, sl) &#123;</span><br><span class="line">                t.Fatalf(<span class="string">"slice not equal"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œä¹Ÿçœ‹ä¸€ä¸‹<code>reflect</code>ä½œç”¨åˆ°<code>struct</code>å®šä¹‰çš„ä¸€äº›ä½¿ç”¨æ–¹æ³•ï¼Œè¿™é‡Œå°±éœ€è¦çœ‹<code>reflect.Value.Type()</code>è¿”å›çš„<code>Type</code>å®ä¾‹æœ‰ä»€ä¹ˆåŠŸèƒ½äº†ã€‚å¯¹äº<code>Type</code>å®ä¾‹æ¥è®²ï¼Œæˆ‘ä»¬å¯ä»¥éå†æ‰€æœ‰ç»“æ„ä½“å­—æ®µå®šä¹‰ï¼Œç”šè‡³æ˜¯è®¿é—®æ ‡æ³¨ä¿¡æ¯ï¼Œæ¯”å¦‚<code>json</code>ã€<code>orm</code>çš„ç¼–è§£ç ï¼Œå°±æåº¦ä¾èµ–è¿™äº›å­—æ®µçš„æ ‡æ³¨ä¿¡æ¯ã€‚è¿™é‡Œçš„å®ç°ï¼Œä¹Ÿç»™ä¸ª<code>example</code>ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReflect_Struct</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    st := reflect.ValueOf(&amp;User&#123;</span><br><span class="line">        ID:   <span class="number">9</span>,</span><br><span class="line">        Name: <span class="string">"Ronaldo"</span>,</span><br><span class="line">        Info: &amp;UserInfo&#123;</span><br><span class="line">            Desc: <span class="string">"SC"</span>,</span><br><span class="line">            City: <span class="string">"Madrid"</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;).Elem().Type()</span><br><span class="line">    <span class="comment">// å¤šå°‘ä¸ªå­—æ®µ</span></span><br><span class="line">    numField := st.NumField()</span><br><span class="line">    t.Logf(<span class="string">"num fields: %d"</span>, numField)</span><br><span class="line">    <span class="comment">// ä¸€ä¸ªä¸ªå­—æ®µéå†ï¼Œè¾“å‡ºå­—æ®µåå­—ã€æ•°æ®ç±»å‹ã€jsonæ ‡æ³¨</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; numField; i++ &#123;</span><br><span class="line">        field := st.Field(i)</span><br><span class="line">        t.Logf(<span class="string">"field %d -&gt; name: %s, type: %v, json: %s"</span>,</span><br><span class="line">            i+<span class="number">1</span>,</span><br><span class="line">            field.Name,</span><br><span class="line">            field.Type,</span><br><span class="line">            field.Tag.Get(<span class="string">"json"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åµŒå¥—çš„å­—æ®µï¼Œç”¨FieldByIndexå¯ä»¥å®šä½åˆ°</span></span><br><span class="line">    cityField := st.FieldByIndex([]<span class="keyword">int</span>&#123;<span class="number">2</span>, <span class="number">1</span>&#125;)</span><br><span class="line">    <span class="comment">// æŒ‰ç…§ä¸Šé¢UserInfo.Cityçš„å®šä¹‰ï¼Œæ‹¿å–descæ ‡æ³¨ä¿¡æ¯</span></span><br><span class="line">    cityFieldDesc, ok := cityField.Tag.Lookup(<span class="string">"desc"</span>)</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        t.Fatalf(<span class="string">"cannot find city field desc"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    t.Logf(<span class="string">"CityField -&gt; name: %s, type: %v, desc: %s"</span>,</span><br><span class="line">        cityField.Name,</span><br><span class="line">        cityField.Type,</span><br><span class="line">        cityFieldDesc)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿æ‹¿åˆ°ç»“æ„ä½“çš„å®šä¹‰ä¿¡æ¯ï¼Œæ›´åŠ æ·±å±‚åµŒå¥—çš„å®šä¹‰ä¿¡æ¯ä¹Ÿéƒ½èƒ½æ‹¿åˆ°ã€‚å¯ä»¥è¯´ï¼Œå¤ªçµæ´»äº†ï¼</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>åå°„</tag>
        <tag>reflect</tag>
        <tag>interface</tag>
        <tag>json</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»£ç è‰ºå»Šã€‘daggreï¼šæ•°æ®èšåˆä¸è”è¡¨æ£€æŸ¥å·¥å…·</title>
    <url>/2022/12/10/codegallery/daggre/</url>
    <content><![CDATA[<p>åœ¨ä»¥å‰å†™è¿‡çš„ä¸€ç¯‡å…³äºæ¸¸æˆç­–åˆ’é…ç½®æ£€æŸ¥å·¥å…·è®¾è®¡çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDMvMDYvdGVzdGxpZmUvdGFibGVfY2hlY2sv" title="https://utmhikari.top/2021/03/06/testlife/table_check/">æ–‡ç« <i class="fa fa-external-link"></i></span>é‡Œï¼Œç¬”è€…è®²è¿°äº†ä¸€ç§è¡¨æ ¼æ£€æŸ¥å·¥å…·çš„åˆ†å±‚è®¾è®¡æ–¹æ³•ï¼Œç®€è€Œè¨€ä¹‹ä¹Ÿå°±æ˜¯ä¸¤éƒ¨åˆ†ï¼š</p>
<ul>
<li>é…ç½®æ•°æ®æºæœåŠ¡ï¼šç®¡ç†æœ¬åœ°ç­–åˆ’é…ç½®<code>repo</code>ï¼Œé€šè¿‡è‡ªå®šä¹‰è„šæœ¬è§£æ<code>repo</code>ä¸­æ–‡ä»¶ï¼Œæä¾›å®é™…çš„é…ç½®æ•°æ®</li>
<li>é…ç½®æ•°æ®å¤„ç†æœåŠ¡ï¼šå¤„ç†å®é™…çš„é…ç½®æµ‹è¯•ä¸šåŠ¡ï¼Œæ¯”å¦‚è¡¨æ ¼æ£€æŸ¥ã€<code>excel-diff</code>ç­‰ç­‰</li>
</ul>
<p>å…¶ä¸­ï¼Œé…ç½®æ•°æ®æºæœåŠ¡ï¼Œåœ¨è®¸ä¹…ä»¥å‰å†™è¿‡ä¸€ä¸ªæ ·ä¾‹çš„ç‰ˆæœ¬<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9yZXBvbWFzdGVy" title="https://github.com/utmhikari/repomaster">repomaster<i class="fa fa-external-link"></i></span>ï¼Œ<br>å®é™…ä¹Ÿå°±æ˜¯ä¸€ä¸ªç®¡ç†<code>git-repo</code>çš„å°æœåŠ¡ï¼Œåœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDEvMDEvY29kZWdhbGxlcnkvcmVwb21hc3Rlci8=" title="https://utmhikari.top/2021/01/01/codegallery/repomaster/">è¿™ç¯‡åšå®¢<i class="fa fa-external-link"></i></span>é‡Œæœ‰è¯¦ç»†é˜è¿°å®ç°å†…å®¹ã€‚</p>
<p>è€Œä»Šå¤©çš„ä¸»é¢˜åˆ™æ˜¯é…ç½®æ•°æ®å¤„ç†æœåŠ¡æ–¹é¢çš„å†…å®¹ï¼Œç¬”è€…é‡‡çº³é€šè¿‡é…ç½®åŒ–æ–¹å¼å£°æ˜æ•°æ®å¤„ç†è¿‡ç¨‹çš„è®¾è®¡ï¼Œç¼–å†™äº†ä¸€ä¸ªæ•°æ®èšåˆå·¥å…·ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9kYWdncmU=" title="https://github.com/utmhikari/daggre">daggre<i class="fa fa-external-link"></i></span>ï¼Œå…¨ç§°ä¸º<code>DAta-AGGREgator</code>ï¼Œä¸“é—¨ç”¨äºå¤„ç†æ•°æ®çš„è”è¡¨è§†å›¾ã€è¿‡æ»¤æ£€æŸ¥ç›¸å…³çš„éœ€æ±‚ã€‚</p>
<p>ä»¥æ¸¸æˆä¸šåŠ¡æµ‹è¯•ä¸ºä¾‹ï¼Œ<code>daggre</code>çš„ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸¤ä¸ªä¾‹å­ï¼š</p>
<a id="more"></a>
<p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œæ˜¯é’ˆå¯¹ä¸€äº›æ¸¸æˆå†…ç½®çš„å•†åº—é…ç½®ï¼Œåœ¨åŠŸèƒ½ææµ‹çš„è¿‡ç¨‹ä¸­ï¼Œæ¸¸æˆæµ‹è¯•åŒå­¦éœ€è¦éªŒè¯å•†åº—å®é™…çš„é…ç½®å’Œç­–åˆ’çš„è¿è¥é…ç½®æ–¹æ¡ˆæ˜¯å¦ç›¸ç¬¦ã€‚å¯¹äºå•†åº—çš„é…ç½®ï¼Œå¯èƒ½ä¼šæ¶‰åŠåˆ°å¾ˆå¤šè¡¨æ ¼çš„è¿æ¥ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>é›†å¸‚é…ç½®ï¼šæ‰€æœ‰ç±»å‹çš„é›†å¸‚ï¼Œä»¥åŠå…³è”çš„å•†åº—åˆ—è¡¨</li>
<li>å•†åº—é…ç½®ï¼šæ‰€æœ‰ç±»å‹çš„å•†åº—ï¼Œä»¥åŠå…³è”çš„å•†å“åˆ—è¡¨</li>
<li>å•†å“é…ç½®ï¼šæ‰€æœ‰å•†å“çš„é…ç½®ï¼ŒåŒ…æ‹¬å…³è”çš„ç‰©å“ã€ä¸Šæ¶æ—¶é—´ã€æŠ˜æ‰£ã€ä¸€æ†çš„æ•°é‡ã€æ˜¯å¦ç»‘å®šç­‰é…ç½®</li>
<li>ç‰©å“é…ç½®ï¼šæ‰€æœ‰ç‰©å“çš„åˆ—è¡¨</li>
</ul>
<p>å¦‚æœæ²¡æœ‰ä¸€ä¸ªå®Œæ•´çš„è§†å›¾å»æŠŠè¿™äº›é…ç½®è”æ¥åœ¨ä¸€èµ·ï¼Œä»…ä»…æ˜¯ä¸€ä¸ªä¸ªè¡¨æ ¼åˆ‡æ¢ç€æ¥æ£€æŸ¥çš„è¯ï¼Œæ˜¯éå¸¸éº»çƒ¦çš„ã€‚é€šè¿‡<code>lookup</code>æ­¥éª¤ï¼Œå¯ä»¥å°†ä¸¤ä¸ªè¡¨æ ¼çš„æ•°æ®é€šè¿‡ä¸€ä¸ªç‰¹å®šçš„å­—æ®µæ˜ å°„è¿›è¡Œè”æ¥ï¼Œä»è€Œä½¿å¾—ä¸åŒè¡¨æ ¼çš„æ•°æ®è®°å½•å¯ä»¥ä¸²è”åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±èƒ½å¤Ÿå½¢æˆä¸€ä¸ªé›†å¸‚-&gt;å•†åº—-&gt;å•†å“-&gt;ç‰©å“çš„å®Œæ•´è§†å›¾ï¼Œä»è€Œæµ‹è¯•äººå‘˜èƒ½å¤Ÿæ›´åŠ æ¸…æ™°çœ‹åˆ°æ¯ä¸€ä¸ªå•†å“å…·ä½“é…ç½®çš„ç»†èŠ‚ã€‚</p>
<p>ç¬¬äºŒä¸ªä¾‹å­ï¼Œæ˜¯é…ç½®è§„åˆ™çš„æ£€æŸ¥ï¼Œé’ˆå¯¹ä¸åŒçš„æ¸¸æˆä¸šåŠ¡æ¨¡å—ï¼Œéœ€è¦åˆ¶å®šç‰¹å®šçš„æ£€æŸ¥è§„åˆ™ï¼Œæ¥éªŒè¯æˆ–æ˜¯ç›‘æ§ç­–åˆ’é…ç½®å†…å®¹æ˜¯å¦ä¸å¤Ÿåˆç†ï¼Œå¥½æ¯”è¯´é’ˆå¯¹å¸¦æ•æ„Ÿè¯æ–‡æ¡ˆï¼Œæˆ–è€…æ˜¯ç‰©å“å¼¹å‡ºæŒ‰é’®è·³è½¬UIçš„å…³è”é…ç½®ç­‰ç­‰ã€‚é€šè¿‡<code>filter</code>æ­¥éª¤ï¼Œå¯ä»¥å®ç°å­—æ®µå€¼çš„ç­›é€‰é€»è¾‘ï¼Œä»è€Œèƒ½å¤Ÿæ»¡è¶³è¿™ç±»éœ€æ±‚ã€‚åœ¨<code>daggre</code>ä¸­ï¼Œä¸è®ºæ˜¯<code>lookup</code>è¿˜æ˜¯<code>filter</code>ä¹‹ç±»çš„æ­¥éª¤ï¼Œéƒ½å·²ç»åšäº†ç®€å•çš„å®ç°ï¼ŒåŸºæœ¬ä¸Šæ˜¯å‘ˆç°äº†<code>mongodb</code>èšåˆé‡Œé¢çš„æ•ˆæœã€‚</p>
<p>åœ¨æ•°æ®å¤„ç†çš„å®é™…è®¾è®¡ä¸Šï¼Œ<code>daggre</code>å®šä¹‰äº†å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>æ•°æ®é›†<code>data</code>ï¼šç›¸å½“äºä¸€ç³»åˆ—<code>table/collection</code>çš„é›†åˆï¼Œæ¯ä¸ªè¡¨æ ¼æœ‰ç‹¬ç«‹çš„åå­—</li>
<li>èšåˆè§„åˆ™<code>aggregation</code>ï¼šå£°æ˜æ•´ä¸ªæ•°æ®å¤„ç†çš„è§„åˆ™ï¼ŒåŒ…æ‹¬æ‰€æœ‰æ•°æ®å¤„ç†æµæ°´çº¿ï¼Œä»¥åŠå”¯ä¸€çš„ä¸€ä¸ªä¸»æµæ°´çº¿</li>
<li>æµæ°´çº¿<code>pipeline</code>ï¼šå£°æ˜åˆå§‹æ•°æ®ç”±å“ªäº›è¡¨æ ¼åˆå¹¶è€Œæ¥ï¼Œä»¥åŠå…·ä½“ç»è¿‡å“ªäº›å¤„ç†æ­¥éª¤</li>
</ul>
<p>èšåˆè§„åˆ™æœ€ç»ˆè¾“å‡ºçš„æ˜¯ä¸»æµæ°´çº¿çš„æ•°æ®ï¼Œè€Œæ”¯æµæ°´çº¿å¯ä»¥é€šè¿‡<code>lookup</code>æ­¥éª¤åˆå¹¶åˆ°ä¸»æµæ°´çº¿çš„è¡¨æ ¼æ•°æ®å½“ä¸­ã€‚é€šè¿‡å£°æ˜<code>data</code>å’Œ<code>aggregation</code>ï¼Œç»è¿‡ä¸€ç³»åˆ—æµæ°´çº¿æ­¥éª¤ï¼Œå°±èƒ½ç”Ÿæˆæ‰€æœ‰æµæ°´çº¿çš„æ‰§è¡Œç»Ÿè®¡<code>stats</code>ï¼Œä»¥åŠæœ€ç»ˆå¤„ç†åçš„<code>output</code>è¡¨æ ¼æ•°æ®ã€‚</p>
<p>æµæ°´çº¿æ­¥éª¤ï¼Œé™¤äº†é»˜è®¤çš„<code>filter</code>ã€<code>lookup</code>ã€<code>unwind</code>ç­‰å¸¸ç”¨çš„è¿™äº›ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥æŒ‰ç…§æµæ°´çº¿æ­¥éª¤çš„æ¥å£å®ç°çº¦å®šï¼Œè‡ªå®šä¹‰è‡ªå·±éœ€è¦çš„æµæ°´çº¿æ­¥éª¤å®ç°ã€‚å…·ä½“è¯¦æƒ…ï¼Œå¯ä»¥å‚è€ƒ<code>daggre</code>çš„<code>README</code>ä»¥åŠæºä»£ç ã€‚</p>
]]></content>
      <categories>
        <category>ä»£ç è‰ºå»Š</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>è¡¨æ ¼æ£€æŸ¥</tag>
        <tag>æ•°æ®èšåˆ</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>daggre</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬å…­è¯ï¼šåŸºäºwireçš„kratoså¾®æœåŠ¡æ¡†æ¶ç¤ºä¾‹é¡¹ç›®</title>
    <url>/2022/12/03/gofromzero/06_wire_kratos/</url>
    <content><![CDATA[<p>ã€Šä»é›¶å•æ’Golangã€‹ç³»åˆ—ï¼Œåˆé‡æ–°å¼€å¼ äº†ã€‚åç»­ä¼šä¸å®šæœŸæ›´æ–°è‡ªå·±å­¦ä¹ <code>Golang</code>çš„ç¬”è®°è·Ÿå¿ƒå¾—ã€‚</p>
<p>è¿™æ¬¡çš„è¯ï¼Œå°±ä»‹ç»ä¸€æ¬¾åä¸ºå¥çˆ·<code>kratos</code>çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œä»¥åŠè®²è¿°ä¸€ä¸‹åŸºç¡€çš„ä½¿ç”¨æœºç†ã€‚</p>
<p><code>kratos</code>æ˜¯Bç«™å¼€æºçš„å¾®æœåŠ¡æ¡†æ¶ï¼Œä¸ä»…æä¾›äº†<code>grpc</code>ã€<code>http</code>åè®®æ”¯æŒï¼Œè€Œä¸”æœ‰è¾ƒä¸ºå®Œå–„çš„å±‚çº§æ¶æ„ã€å¾®æœåŠ¡ä¸­é—´ä»¶ä»¥åŠç¬¬ä¸‰æ–¹ç»„ä»¶çš„ç¼–å†™çº¦å®šï¼Œå¯ä»¥è¯´æ˜¯éå¸¸æ–¹ä¾¿ä¸Šæ‰‹è·Ÿæ‰©å±•ã€‚</p>
<p>è¦ä¸Šæ‰‹<code>kratos</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸¤ä¸ªåœ°æ–¹å…¥æ‰‹ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvLWtyYXRvcy9rcmF0b3M=" title="https://github.com/go-kratos/kratos">kratos-github<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9nby1rcmF0b3MuZGV2Lw==" title="https://go-kratos.dev/">kratoså®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span></li>
</ul>
<p>é€šè¿‡<code>kratos</code>çš„<span class="exturl" data-url="aHR0cHM6Ly9nby1rcmF0b3MuZGV2L2VuL2RvY3MvZ2V0dGluZy1zdGFydGVkL3N0YXJ0" title="https://go-kratos.dev/en/docs/getting-started/start">quickstartæ–‡æ¡£<i class="fa fa-external-link"></i></span>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º<code>kratostest</code>çš„é¡¹ç›®ã€‚é¡¹ç›®çš„ç›®å½•ç»“æ„éµå¾ª<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvLWtyYXRvcy9rcmF0b3MtbGF5b3V0" title="https://github.com/go-kratos/kratos-layout">kratos-layout<i class="fa fa-external-link"></i></span>ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<ul>
<li><code>api</code>ï¼šæ¥å£å®šä¹‰ï¼Œä¸»è¦æ˜¯protoæ–‡ä»¶<ul>
<li>éœ€è¦ç”Ÿæˆ<code>go</code>æ–‡ä»¶ç»™åˆ°<code>internal</code>æˆ–è€…<code>service</code>æ¨¡å—åšè¯·æ±‚å¤„ç†å®ç°çš„ç¼–å†™</li>
</ul>
</li>
<li><code>cmd</code>ï¼š<code>main.go</code>ä¸<code>wire.go</code></li>
<li><code>configs</code>ï¼šé…ç½®<code>yaml</code></li>
<li><code>internal</code>ï¼š<ul>
<li><code>biz</code>ï¼šä¸šåŠ¡é€»è¾‘<ul>
<li>è‹¥ç›¸è¾ƒäº<code>controller</code>æˆ–<code>handler</code>ï¼Œåˆ™ç±»ä¼¼äº<code>service</code>çš„æ¦‚å¿µ</li>
<li>æ­¤<code>service</code>ä¸æ˜¯æŒ‡<code>kratos</code>çš„<code>service</code></li>
</ul>
</li>
<li><code>conf</code>ï¼šé…ç½®</li>
<li><code>data</code>ï¼šæ•°æ®è®¿é—®</li>
<li><code>server</code>ï¼šå¯¹å¤–æœåŠ¡</li>
<li><code>service</code>ï¼šç±»ä¼¼äº<code>controller</code>ã€<code>handler</code></li>
</ul>
</li>
<li><code>third_party</code>ï¼šç¬¬ä¸‰æ–¹å†…å®¹</li>
</ul>
<p><code>kratostest</code>é¡¹ç›®åœ¨å¯åŠ¨ä¹‹å‰ï¼Œé™¤äº†éœ€è¦<code>go-protobuf</code>ç¯å¢ƒæŠŠ<code>proto</code>æ–‡ä»¶ç¼–è¯‘æˆ<code>go</code>æ–‡ä»¶ä¹‹å¤–ï¼Œé»˜è®¤è¿˜éœ€è¦é€šè¿‡<code>wire</code>æ¨¡å—è‡ªåŠ¨åˆå§‹åŒ–å¯¹è±¡å®ä¾‹ã€‚<code>wire</code>æ˜¯ä¸€ç§åœ¨<code>golang</code>é‡Œå®ç°ä¾èµ–æ³¨å…¥çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ–‡æ¡£ï¼Œäº†è§£<code>wire</code>çš„ä½œç”¨ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvb2dsZS93aXJl" title="https://github.com/google/wire">wire-github<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9nby5kZXYvYmxvZy93aXJl" title="https://go.dev/blog/wire"><code>wire</code>ä»‹ç»åšå®¢<i class="fa fa-external-link"></i></span></li>
</ul>
<p>ä»ä½¿ç”¨è§’åº¦ä¸Šæ¥è¯´ï¼Œå®é™…ä¸Šç»è¿‡äº†å¦‚ä¸‹çš„æ­¥éª¤ï¼š</p>
<ul>
<li>è§£æå„ä¸ªProvideræ¥å£å‡ºå…¥å‚çš„å®ç°</li>
<li>æ ¹æ®ä¸åŒProviderå‡ºå…¥å‚çš„ä¾èµ–å…³ç³»ï¼Œç”Ÿæˆå®é™…çš„åˆå§‹åŒ–ä»£ç ï¼Œå¡«å……å…¥å‚ï¼Œå®ç°æ³¨å…¥çš„æ•ˆæœ</li>
</ul>
<p>ä»¥<code>http-server</code>çš„åŸºç¡€<code>greeter</code>æ¥å£ä¸ºä¾‹ï¼Œå­˜åœ¨ç€è¿™æ ·çš„è°ƒç”¨å±‚æ¬¡ï¼š</p>
<ul>
<li><code>NewHTTPServer</code>ï¼šåœ¨<code>internal/server/http.go</code>ï¼Œç”Ÿæˆ<code>HTTPServer</code>å®ä¾‹<ul>
<li>å…¥å‚æœ‰<code>conf.Server</code>å®ä¾‹ï¼Œæ˜¯æœåŠ¡å™¨å¯åŠ¨çš„é…ç½®ï¼Œå¯ä»¥é€šè¿‡<code>internal/conf/conf.proto</code>ç”Ÿæˆ<ul>
<li><code>configs/config.yaml</code>å®é™…é…ç½®è¿™äº›å†…å®¹</li>
</ul>
</li>
<li>å…¥å‚<code>*service.GreeterService</code>ï¼Œè¯¥å®ä¾‹éœ€è¦å®ç°<code>GreeterHTTPServer</code>çš„æ¥å£å®šä¹‰</li>
<li><code>GreeterHTTPServer</code>çš„æ¥å£å®šä¹‰å®é™…æ˜¯ç”±<code>greeter.proto</code>å®šä¹‰ä¹‹åè‡ªåŠ¨ç”Ÿæˆçš„</li>
</ul>
</li>
<li><code>NewGreeterService</code>ï¼šåœ¨<code>internal/service/greeter.go</code>ï¼Œç”Ÿæˆ<code>GreeterService</code>å®ä¾‹<ul>
<li>åœ¨è¿™é‡Œéœ€è¦å®ç°<code>GreeterHTTPServer</code>çš„æ¥å£å®šä¹‰</li>
<li>éœ€è¦å®šä¹‰<code>biz</code>å±‚æˆå‘˜<code>*biz.GreeterUsecase</code>ï¼Œåœ¨æ¥å£å®ç°ä¼šè°ƒç”¨è¿™ä¸ªæˆå‘˜æ–¹æ³•æ‰§è¡Œå®é™…ä¸šåŠ¡</li>
</ul>
</li>
<li><code>NewGreeterUsecase</code>ï¼šåœ¨<code>internal/biz/greeter.go</code>ï¼Œç”Ÿæˆ<code>GreeterUsecase</code>å®ä¾‹<ul>
<li>éœ€è¦å®šä¹‰<code>GreeterRepo</code>ç±»å‹æˆå‘˜ï¼Œç”¨æ¥åšæ•°æ®çš„CRUD</li>
</ul>
</li>
<li><code>NewGreeterRepo</code>ï¼šåœ¨<code>internal/data/greeter.go</code>ï¼Œç”Ÿæˆ<code>GreeterRepo</code>å®ä¾‹<ul>
<li>éœ€è¦å®šä¹‰<code>*Data</code>ç±»å‹æˆå‘˜ï¼Œç”¨æ¥åšå®é™…å¯¹æ¥æ•°æ®åº“çš„è®¿é—®æ“ä½œ</li>
</ul>
</li>
<li><code>NewData</code>ï¼šåœ¨<code>internal/data/data.go</code>ï¼Œç”Ÿæˆ<code>*Data</code>å®ä¾‹<ul>
<li>å…¥å‚æœ‰<code>conf.Data</code>å®ä¾‹ï¼Œæ˜¯æ•°æ®åº“çš„é…ç½®ï¼Œå¯ä»¥é€šè¿‡<code>internal/conf/conf.proto</code>ç”Ÿæˆ</li>
<li>è¿™äº›æ–¹æ³•å¯ä»¥æ‰“åŒ…æˆ<code>wire</code>çš„<code>ProviderSet</code>ï¼Œç„¶åä¸€å¹¶<code>Build</code>èµ·æ¥</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cmd/kratostest/main.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newApp</span><span class="params">(logger log.Logger, gs *grpc.Server, hs *http.Server)</span> *<span class="title">kratos</span>.<span class="title">App</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> kratos.New(</span><br><span class="line">        kratos.ID(id),</span><br><span class="line">        kratos.Name(Name),</span><br><span class="line">        kratos.Version(Version),</span><br><span class="line">        kratos.Metadata(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;&#125;),</span><br><span class="line">        kratos.Logger(logger),</span><br><span class="line">        kratos.Server(</span><br><span class="line">            gs,</span><br><span class="line">            hs,</span><br><span class="line">        ),</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// cmd/kratostest/wire.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wireApp</span><span class="params">(*conf.Server, *conf.Data, log.Logger)</span> <span class="params">(*kratos.App, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(wire.Build(server.ProviderSet, data.ProviderSet, biz.ProviderSet, service.ProviderSet, newApp))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>cmd/kratostest</code>æ‰§è¡Œäº†<code>wire</code>ä¹‹åï¼Œå°±ä¼šæŠŠè¿™äº›ä¾èµ–æ³¨å…¥ï¼Œä»£ç é‡æ–°ç»„è£…èµ·æ¥ï¼Œæœ€åç”Ÿæˆ<code>wire_gen.go</code>æ–‡ä»¶ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">wireApp</span><span class="params">(confServer *conf.Server, confData *conf.Data, logger log.Logger)</span> <span class="params">(*kratos.App, <span class="keyword">func</span>()</span>, <span class="title">error</span>)</span> &#123;</span><br><span class="line">    dataData, cleanup, err := data.NewData(confData, logger)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    greeterRepo := data.NewGreeterRepo(dataData, logger)</span><br><span class="line">    greeterUsecase := biz.NewGreeterUsecase(greeterRepo, logger)</span><br><span class="line">    greeterService := service.NewGreeterService(greeterUsecase)</span><br><span class="line">    grpcServer := server.NewGRPCServer(confServer, greeterService, logger)</span><br><span class="line">    httpServer := server.NewHTTPServer(confServer, greeterService, logger)</span><br><span class="line">    app := newApp(logger, grpcServer, httpServer)</span><br><span class="line">    <span class="keyword">return</span> app, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        cleanup()</span><br><span class="line">    &#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>wire_gen.go</code>çš„<code>wireApp</code>ï¼Œæœ€ç»ˆä¼šåœ¨<code>main.go</code>é‡Œå®é™…æ‰§è¡Œï¼Œä»è€ŒçœŸæ­£å¯åŠ¨æ•´ä¸ª<code>kratostest</code>æœåŠ¡å’Œå„å±‚çš„å¯¹è±¡å®ä¾‹ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// å¿½ç•¥ä¸Šé¢</span></span><br><span class="line">    app, cleanup, err := wireApp(bc.Server, bc.Data, logger)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> cleanup()</span><br><span class="line">    <span class="comment">// start and wait for stop signal</span></span><br><span class="line">    <span class="keyword">if</span> err := app.Run(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæ•´ä¸ª<code>kratos</code>æœåŠ¡çš„åŸºç¡€é€»è¾‘ç»“æ„å°±é¡ºèµ·æ¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>wire</tag>
        <tag>å¾®æœåŠ¡</tag>
        <tag>kratos</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘æ¸¸æˆæµ‹è¯•å¼€å‘å¹²è´§â€”â€”Pythonè¿›é˜¶ä¸æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ”»ç•¥</title>
    <url>/2022/11/24/geekdaily/python_and_game_autotest_notes/</url>
    <content><![CDATA[<p>åœ¨äº’è”ç½‘ä¸Šï¼Œå…³äºæ¸¸æˆæµ‹è¯•ï¼ˆå¼€å‘ï¼‰é¢†åŸŸçš„æŠ€æœ¯åˆ†äº«ï¼Œå®é™…æ˜¯éå¸¸ç¨€å°‘ã€‚å°¤å…¶é’ˆå¯¹æ¸¸æˆåŠŸèƒ½æµ‹è¯•é¢†åŸŸï¼Œå¾ˆå¤šæ–‡ç« çš„æ€æƒ³ç»´åº¦ä»ç„¶åœç•™åœ¨å¾ˆä¹…ä»¥å‰ï¼Œå…³æ³¨çš„æ›´å¤šæ˜¯æµ‹è¯•ç”¨ä¾‹è®¾è®¡ä»¥åŠè´¨é‡ç®¡ç†è¿™äº›æ›´åŠ åå‘ä¸šåŠ¡æ–¹é¢çš„å†…å®¹ã€‚å¾ˆå¤šåŒå­¦è®¤ä¸ºæ¸¸æˆä¸šåŠ¡æµ‹è¯•ç¼ºä¹æŠ€æœ¯å«é‡ï¼Œå…¶å®æœ¬è´¨ä¸Šæ˜¯å› ä¸ºï¼Œå¾ˆå°‘åŒå­¦æ„¿æ„æŠ•å…¥ç²¾åŠ›å»ç ”ç©¶è¿™ä¸ªé¢†åŸŸçš„æŠ€æœ¯ï¼Œä»¥åŠç ”ç©¶è¿™äº›æŠ€æœ¯å¦‚ä½•æ›´å¥½åœ°å¥‘åˆåˆ°å®é™…çš„ä¸šåŠ¡å½“ä¸­ã€‚</p>
<p>ä¸ºæ­¤ï¼Œé’ˆå¯¹æ¸¸æˆæµ‹è¯•ï¼ˆå¼€å‘ï¼‰çš„å·¥ä½œç‰¹æ€§ï¼Œç¬”è€…æ ¹æ®è‡ªå·±ä»¥å‰çš„åšå®¢æ•´åˆäº†ä¸¤ä¸ªæ–‡é›†ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<a id="more"></a>
<ul>
<li>Pythonè¿›é˜¶ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5jc2RuLm5ldC9kb3dubG9hZC91MDEzODQyNTAxLzg2NzM1Nzk0" title="https://download.csdn.net/download/u013842501/86735794">ã€ŠHiKariä¸ºäº†æ‹¿æPythonæ•´ç†çš„æŠ€æœ¯ç¬”è®°ã€‹<i class="fa fa-external-link"></i></span></li>
<li>æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ”»ç•¥ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC5jc2RuLm5ldC9kb3dubG9hZC91MDEzODQyNTAxLzg3MTQ5NzI5" title="https://download.csdn.net/download/u013842501/87149729">ã€ŠHiKariçš„æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ç¬”è®°ã€‹<i class="fa fa-external-link"></i></span></li>
</ul>
<p>ã€ŠHiKariä¸ºäº†æ‹¿æPythonæ•´ç†çš„æŠ€æœ¯ç¬”è®°ã€‹ç³»åˆ—ï¼Œæ—¨åœ¨é€šè¿‡æºç åˆ†æçš„æ–¹å¼ï¼Œè®©å¤§å®¶èƒ½å¤Ÿå¯¹Pythonè¯­è¨€æœ‰æ›´åŠ æ·±å…¥é€å½»çš„ç†è§£ï¼Œä»è€Œæ›´åŠ æŒæ§è¿™é—¨è¯­è¨€ã€‚Pythonå¯ä»¥è¯´æ˜¯æ¸¸æˆæµ‹è¯•é¢†åŸŸæœ€å¸¸ç”¨çš„ç¼–ç¨‹è¯­è¨€äº†ï¼Œä¸è®ºä½ æ˜¯æ¸¸æˆæµ‹è¯•ï¼ˆå¼€å‘ï¼‰äººå‘˜ï¼Œè¿˜æ˜¯æ­£ç»Ÿçš„Pythonå¼€å‘è€…ï¼Œå¦‚æœæƒ³è¦è¿›é˜¶ä½ çš„Pythonæ°´å¹³çš„è¯ï¼Œè¿™ä¸ªç³»åˆ—ä½ å€¼å¾—æ‹¥æœ‰ã€‚</p>
<p>ã€ŠHiKariçš„æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ç¬”è®°ã€‹ç³»åˆ—ï¼Œæ—¨åœ¨ä»æŠ€æœ¯è®¾è®¡ã€ä¸šåŠ¡ä»·å€¼ä»¥åŠå®æˆ˜ç»éªŒç­‰å¤šç§è§’åº¦ï¼Œè®²è¿°ç¬”è€…å¯¹äºæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•è¿™ä¸ªæ¦‚å¿µçš„ç†è§£å’Œæ€è€ƒã€‚å¦‚æœä½ æ°å¥½æ˜¯æ¸¸æˆæµ‹è¯•é¢†åŸŸçš„å·¥ä½œè€…ï¼Œå°¤å…¶æ˜¯æ­£å¥½åœ¨åšæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé‚£ä¹ˆè¿™ä¸ªç³»åˆ—ä½ ä¸€å®šä¸èƒ½é”™è¿‡ã€‚</p>
<p>å¦‚æœè¯´äººç”Ÿå¦‚æ¸¸æˆï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ–‡é›†å°±æ˜¯é’ˆå¯¹æ¸¸æˆæµ‹è¯•ï¼ˆå¼€å‘ï¼‰å·¥ä½œè€…çš„èŒä¸šæ”»ç•¥ã€‚ENJOYï¼</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>åŠŸèƒ½æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘UE4å¤§ä¸–ç•Œæ¸¸æˆå¯»è·¯æ•ˆæœè‡ªåŠ¨åŒ–æµ‹è¯•</title>
    <url>/2022/11/20/testlife/navi_autotest/</url>
    <content><![CDATA[<p>åœ¨ä¸€äº›æ— ç¼å¤§ä¸–ç•Œçš„æ¸¸æˆå½“ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸èƒ½å¤Ÿä½“éªŒåˆ°æ¸¸æˆçš„è‡ªåŠ¨å¯»è·¯åŠŸèƒ½ï¼Œé€šè¿‡è‡ªåŠ¨å¯»è·¯ï¼Œç©å®¶å¯ä»¥ä¸ç”¨ä»»ä½•æ“ä½œå°±åˆ°è¾¾ä»»åŠ¡æˆ–è€…ç©æ³•çš„ç›®çš„åœ°ï¼Œä»è€Œè®©æ¸¸æˆè¿‡ç¨‹æ›´åŠ è½»æ¾ã€‚åœ¨æµ‹è¯•å¯»è·¯åŠŸèƒ½æ—¶ï¼Œä¸ä»…éœ€è¦æ£€æŸ¥å¯»è·¯æ˜¯å¦æˆåŠŸåˆ°è¾¾ï¼Œè€Œä¸”ä¹Ÿéœ€è¦å…³æ³¨å¯»è·¯è·¯å¾„å‘ˆç°çš„æ•ˆæœï¼Œä»è€Œç¡®å®šç©å®¶æ˜¯å¦èµ°åœ¨ç­–åˆ’é¢„æƒ³çš„è·¯å¾„ä¸Šã€‚</p>
<p>ç”±äºå¯»è·¯èµ·ç‚¹ã€ç»ˆç‚¹é€‰æ‹©çš„éšæœºæ€§ï¼Œäººå·¥æ‰§è¡Œå¯»è·¯æµ‹è¯•æ—¶ï¼Œå¾€å¾€éœ€è¦æ ¹æ®è‡ªå®šä¹‰çš„è§„åˆ™éå†å¤šä¸ªç‰¹å®šçš„èµ·ç‚¹ç»ˆç‚¹ï¼Œè¿™æ ·æ“ä½œèµ·æ¥ä¸ä»…éå¸¸è€—è´¹äººåŠ›ï¼Œè€Œä¸”é’ˆå¯¹å†åå°å­˜å‚¨<code>navmesh</code>æ•°æ®ã€åšåŠ¨æ€çƒ˜ç„™ä»¥åŠè®¡ç®—å¯»è·¯è·¯å¾„çš„åœºæ™¯ï¼Œåœ¨éªŒæ”¶å¯»è·¯æ•ˆæœæ—¶ï¼Œæµ‹è¯•äººå‘˜è¿˜éœ€è¦å¤šæ¬¡æ‰‹åŠ¨ä»åå°æ‹‰å–ä¸€å®šèŒƒå›´çš„<code>navmesh</code>æ•°æ®å¹¶ç»˜åˆ¶åœ¨å®¢æˆ·ç«¯çš„è·¯é¢ä¸Šï¼Œæ‰èƒ½çŸ¥é“ç©å®¶æ˜¯èµ°åœ¨ä»€ä¹ˆæ ·çš„è·¯é¢ã€‚ä¸ºäº†è§£å†³å¯»è·¯æ•ˆæœæµ‹è¯•çš„æ•ˆç‡é—®é¢˜ï¼Œå¼•å…¥è‡ªåŠ¨åŒ–æŠ€æœ¯æ˜¾å¾—éå¸¸æœ‰å¿…è¦ã€‚</p>
<p>å› æ­¤ï¼Œç¬”è€…å°†ç»“åˆè‡ªå·±å®é™…çš„å·¥ä½œç»éªŒï¼Œåˆ†äº«ä¸€ç§åœ¨<code>UE4</code>å¤§ä¸–ç•Œæ¸¸æˆä¸­ï¼Œå¯»è·¯æ•ˆæœè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ–¹æ¡ˆã€‚</p>
<a id="more"></a>
<p><code>UE4</code>é»˜è®¤é‡‡ç”¨<code>Recast&amp;Detour</code>çš„æ–¹å¼å®ç°å¯»è·¯ã€‚é€šä¿—æ¥è®²ï¼Œ<code>Recast</code>æ˜¯ä¸€ç§åœ¨3Dä¸–ç•Œç”Ÿæˆ2Då¯»è·¯ç½‘æ ¼é¢<code>navmesh</code>çš„æ–¹æ¡ˆï¼Œä½¿å¾—å¯»è·¯çš„é—®é¢˜è½¬åŒ–ä¸ºåœ¨ä¸€ä¸ªç½‘æ ¼é¢ä¸Šçš„ä¸€ä¸ªæ ¼å­åˆ°å¦ä¸€ä¸ªæ ¼å­çš„è·¯å¾„è®¡ç®—é—®é¢˜ï¼Œè€Œ<code>Detour</code>åˆ™æ˜¯æ ¹æ®å¯»è·¯ç½‘æ ¼è®¡ç®—å¯»è·¯è·¯å¾„çš„æ–¹æ³•ã€‚</p>
<p>æœ‰å…´è¶£çš„è¯»è€…ï¼Œå¯ä»¥æŸ¥é˜…ç›¸å…³èµ„æ–™ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlY2FzdG5hdmlnYXRpb24vcmVjYXN0bmF2aWdhdGlvbg==" title="https://github.com/recastnavigation/recastnavigation">recastnavigation-github<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDgvMDcvZ2FtZWRldi9yZWNhc3RkZW1vLw==" title="https://utmhikari.top/2021/08/07/gamedev/recastdemo/">åˆè¯†RecastDemo<i class="fa fa-external-link"></i></span></li>
</ul>
<p>3Dä¸–ç•Œä¸­åŒ…å«ä¸åŒçš„åœ°å½¢ï¼Œæ¯”å¦‚å±±åœ°ã€æ°´ä½“ã€å…¬è·¯ç­‰ï¼Œå¦‚æœå¿½ç•¥è¿™äº›åœ°å½¢ä¿¡æ¯ï¼Œé‚£ä¹ˆè®¡ç®—å‡ºæ¥çš„å¯»è·¯è·¯å¾„ï¼Œæ•ˆæœå°±å¯èƒ½è¶‹äºä¸€æ¡ç›´çº¿ã€‚å¦‚æœç©å®¶çœŸæŒ‰ç…§è¿™æ ·çš„è·¯å¾„è¡Œèµ°çš„è¯ï¼Œå¾ˆå¯èƒ½ä¼šå‡ºç°èµ°åˆ°æ°´é‡Œæˆ–è€…éšœç¢ç‰©çš„æƒ…å†µï¼Œå¯¼è‡´å®é™…ä¼šæ²¡æœ‰èµ°åˆ°ä¸€ä¸ªæœ€ç¬¦åˆç°å®çš„è·¯å¾„æ–¹æ¡ˆã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨<code>UE4</code>ç¼–è¾‘å™¨ä¸­ï¼Œä¹Ÿæ”¯æŒé€šè¿‡ä¸åŒç±»å‹çš„<code>NavModifierVolume</code>æ ‡è®°ç½‘æ ¼è·¯é¢ï¼Œä»è€Œä½¿å¾—æ¯ä¸ªè·¯é¢åœ¨å®é™…å¯»è·¯è®¡ç®—ä¸­ï¼Œå…·å¤‡ä¸åŒçš„ç»è¿‡æˆæœ¬<code>cost</code>ã€‚</p>
<p>æœ‰å…´è¶£çš„è¯»è€…ï¼Œå¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£çš„èµ„æ–™ï¼Œè¯¦ç»†äº†è§£ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNS4xL2VuLVVTL25hdmlnYXRpb24tc3lzdGVtLWluLXVucmVhbC1lbmdpbmUv" title="https://docs.unrealengine.com/5.1/en-US/navigation-system-in-unreal-engine/">Navigation System<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNS4xL2VuLVVTL25hdmlnYXRpb24tY29tcG9uZW50cy1pbi11bnJlYWwtZW5naW5lLw==" title="https://docs.unrealengine.com/5.1/en-US/navigation-components-in-unreal-engine/">Navigation Components<i class="fa fa-external-link"></i></span></li>
</ul>
<p>å……åˆ†äº†è§£äº†è¿™äº›å†…å®¹ï¼Œå†ç»“åˆä¸‹è‡ªå·±é¡¹ç›®å®é™…çš„æƒ…å†µï¼Œå°±èƒ½ç€æ‰‹å®ç°å¯»è·¯æ•ˆæœè‡ªåŠ¨åŒ–æµ‹è¯•äº†ã€‚å‡è®¾æ¸¸æˆæ˜¯é‡‡ç”¨åå°å¯»è·¯çš„æ–¹æ¡ˆï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•çš„æµç¨‹å¯ä»¥è¿™æ ·åšï¼š</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é¢„å…ˆå‡†å¤‡<code>NavModifierVolume</code>é…ç½®æ•°æ®ï¼Œé€šè¿‡è¿™äº›æ•°æ®ï¼Œæ‰èƒ½åˆ¤æ–­ç©å®¶è¡Œèµ°åœ¨æ€æ ·çš„è·¯é¢ä¸Šã€‚åŒæ—¶ï¼Œä¹Ÿè¦å‡†å¤‡ä¸€ç³»åˆ—æµ‹è¯•ç”¨ä¾‹ï¼ŒåŒ…å«å¯»è·¯çš„èµ·ç‚¹ç»ˆç‚¹ã€æœŸæœ›æ—¶é—´å’Œè·¯é¢å æ¯”ç­‰ç­‰ï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–çš„æµç¨‹éœ€è¦éå†è¿™äº›å†…å®¹ã€‚</p>
<p>ç„¶åï¼Œéœ€è¦ä¸€å¥—è‡ªåŠ¨åŒ–é©±åŠ¨å¯»è·¯çš„æµç¨‹ï¼Œå¹¶ä¸”éœ€è¦åœ¨å¯»è·¯è¿‡ç¨‹ä¸­ï¼Œä»¥ç‰¹å®šçš„é¢‘ç‡æ”¶é›†ç©å®¶æ‰€ç»è¿‡çš„è·¯å¾„ç‚¹ã€‚è¿™æ ·ï¼Œæ¯ä¸€æ¬¡å¯»è·¯æˆ‘ä»¬éƒ½èƒ½å¤Ÿå¾—åˆ°ç©å®¶çš„è·¯å¾„ç‚¹é›†ï¼Œä»è€Œèƒ½å¤Ÿåæ˜ ç©å®¶çš„å¯»è·¯æ•ˆæœã€‚</p>
<p>å¯¹äºæ¯ä¸ªè·¯å¾„ç‚¹ï¼Œéœ€è¦æ±‚å¾—è¿™äº›ç‚¹å¯¹åº”çš„æ˜¯æ€æ ·çš„è·¯é¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°é¢„å…ˆå‡†å¤‡çš„<code>NavModifierVolume</code>é…ç½®æ•°æ®äº†ã€‚è¿™ä¸ªè®¡ç®—è¿‡ç¨‹å®è´¨ä¸Šæ˜¯æ±‚åœ¨3Dç©ºé—´å†…ï¼Œä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸€ä¸ªé•¿æ–¹ä½“å†…ã€‚ç”±äºæ¯ä¸ª<code>NavModifierVolume</code>å¯¼å‡ºçš„<code>transform</code>æ•°æ®ä¸­ï¼ŒåŒ…å«ä½ç½®ã€æ—‹è½¬ä»¥åŠé•¿å®½é«˜æ•°æ®ï¼Œå› æ­¤å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDkvMDEvZ2FtZWRldi91ZTRfcG9pbnRfaW5fY3Vib2lkLw==" title="https://utmhikari.top/2021/09/01/gamedev/ue4_point_in_cuboid/">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ï¼Œè¿›è¡Œè®¡ç®—åˆ¤æ–­ã€‚</p>
<p>æœ€ç»ˆï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°è¿™æ ·ä¸€äº›æ•°æ®ï¼š</p>
<ul>
<li>ç»“æœæ±‡æ€»ï¼šæ¯ä¸ªèµ·ç‚¹ç»ˆç‚¹çš„å¯»è·¯æµ‹è¯•ç»“æœä»¥åŠæ‰€æœ‰è·¯å¾„ç‚¹è·Ÿè·¯å¾„ç‚¹æ‰€å¯¹åº”çš„è·¯é¢</li>
<li>æ˜¯å¦é€šè¿‡æŒ‡æ ‡ï¼šå¯»è·¯æ˜¯å¦æˆåŠŸã€å¯»è·¯æ—¶é•¿æ˜¯å¦ç¬¦åˆé¢„æœŸã€å¯»è·¯è·¯å¾„å æ¯”æ˜¯å¦ç¬¦åˆé¢„æœŸ</li>
</ul>
<p>é€šè¿‡è¡¨æ ¼æˆ–è€…3Dæ•£ç‚¹å›¾å¯¹ç»“æœè¿›è¡Œå¯è§†åŒ–å¤„ç†ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä»½æ›´åŠ æ¸…æ™°çš„å¯»è·¯æµ‹è¯•æŠ¥å‘Šã€‚é€šè¿‡æŠ¥å‘Šï¼Œæˆ‘ä»¬å¯èƒ½å¯ä»¥æ’æŸ¥å‡ºè¿™æ ·çš„é—®é¢˜ï¼š</p>
<ul>
<li>å¯»è·¯è·¯é¢é…ç½®ç¼ºå¤±æˆ–ä¸å¯¹ï¼Œæˆ–å› ä¸ºå¯»è·¯è·¯é¢é…ç½®å˜åŒ–å¯¼è‡´å¯»è·¯æ•ˆæœç›¸è¾ƒä»¥å‰æœ‰è¾ƒå¤§å·®åˆ«</li>
<li>å› å‰¯æœ¬åˆ‡æ¢ç­‰åŸå› é‡æ–°ç”Ÿæˆé˜»æŒ¡ç‰©ä»¶ï¼Œæˆ–è€…<code>navmesh</code>ç”Ÿæˆæ•ˆæœä¸å®é™…ç‰©ä»¶æ‘†æ”¾æœ‰å‡ºå…¥ï¼Œå¯¼è‡´å¯»è·¯å®é™…é˜»å¡</li>
</ul>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>UE4</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>å¯»è·¯</tag>
        <tag>recast</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Game Of AutoTestã€‘5ã€æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„ä»·å€¼</title>
    <url>/2022/11/02/gameofautotest/v/</url>
    <content><![CDATA[<p>ã€ŠGame Of AutoTestã€‹çš„æœ€åä¸€ç¯‡æ–‡ç« ï¼ŒèŠä¸€ä¸‹æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„ä»·å€¼ã€‚</p>
<p>ä¸€åƒä¸ªäººå¿ƒä¸­æœ‰ä¸€åƒä¸ªå“ˆå§†é›·ç‰¹ã€‚ä»…ä»¥ç¬”è€…çš„è§’åº¦ï¼Œæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„ä»·å€¼ï¼Œå¯ä»¥ä½“ç°åœ¨è¿™å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>æ•ˆç‡æå‡</li>
<li>ç¼ºé™·å‘ç°</li>
<li>è´¨é‡ç›‘æ§</li>
<li>æŠ€æœ¯æ”¯æŒ</li>
</ul>
<p>åšå¥½è‡ªåŠ¨åŒ–æµ‹è¯•çš„ä»·å€¼åˆ†æï¼Œä¸ä»…èƒ½å¤Ÿè‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯è½åœ°åšè¶³ç†è®ºåŸºç¡€ï¼Œè€Œä¸”ä¹Ÿèƒ½åœ¨ä»»æ„æ—¶å€™æŒ‡å¼•è‡ªåŠ¨åŒ–æŠ€æœ¯è½åœ°è€…åšå¥½å½“ä¸‹çš„å†³ç­–ï¼Œä»è€Œé€æ¸æŠŠè‡ªåŠ¨åŒ–æµ‹è¯•åšå‡ºæ›´å¤§çš„è§„æ¨¡è·Ÿæˆæœã€‚</p>
<a id="more"></a>
<h2 id="æ•ˆç‡æå‡"><a href="#æ•ˆç‡æå‡" class="headerlink" title="æ•ˆç‡æå‡"></a>æ•ˆç‡æå‡</h2><p>è‡ªåŠ¨åŒ–æµ‹è¯•ä½œä¸ºä»£æ›¿äººåŠ›çš„ä¸€ç§æµ‹è¯•æ‰‹æ®µï¼Œæœ€ä¸ºåŸºç¡€æ ¸å¿ƒçš„ä»·å€¼å°±æ˜¯å‡å°‘äººåŠ›åŠ³åŠ¨ï¼Œå®ç°æµ‹è¯•æ•ˆèƒ½çš„æå‡ã€‚åœ¨è‡ªåŠ¨åŒ–æŠ€æœ¯åŸºç¡€ç¨³å®šæ€§æ’å®šçš„å‰æä¸‹ï¼Œè‡ªåŠ¨åŒ–ç”¨ä¾‹äº§å‡ºçš„è¶Šå¤šï¼Œè¿è¡Œ/èŠ‚çœçš„æ—¶é—´è¶Šå¤šï¼Œé‚£ä¹ˆå¸¦æ¥çš„æµ‹è¯•æ•ˆç‡æå‡ä¹Ÿä¼šè¶Šå¤šã€‚</p>
<p>è€ƒè™‘åˆ°æ¸¸æˆé¡¹ç›®è¾ƒçŸ­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¦æˆåŠŸè½åœ°è‡ªåŠ¨åŒ–æµ‹è¯•å¹¶åšæˆæˆç†Ÿçš„æ—¥å¸¸ä¸šåŠ¡ï¼Œå¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œå°¤å…¶æ˜¯å½“æ²¡æœ‰æŠ€æœ¯åŸºå»ºçš„æ”¯æŒä¸‹ï¼Œä»é›¶åˆ°ä¸€å»åšè‡ªåŠ¨åŒ–æŠ€æœ¯ï¼Œä¼šå¾ˆå®¹æ˜“é™·å…¥å”¯æŠ€æœ¯çš„è¯¯åŒºã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé¦–å…ˆè¦è€ƒè™‘çš„å°±æ˜¯ä¸€äº›æ“ä½œå¤æ‚åº¦å¹¶ä¸é«˜ï¼Œä½†æµ‹è¯•å†…å®¹å¤šçš„æµ‹è¯•åœºæ™¯ï¼Œè¿™ç±»æµ‹è¯•åœºæ™¯å°±æ¯”è¾ƒé€‚åˆä½œä¸ºè‡ªåŠ¨åŒ–åˆæœŸè½åœ°çš„åˆ‡å…¥ç‚¹ã€‚å¥½æ¯”è¯´ä¸€æ¬¾å¤§ä¸–ç•Œçš„æ¸¸æˆï¼Œå¯¹äºå¤§ä¸–ç•Œå¸ƒæ€ªç›¸å…³çš„éå†æµ‹è¯•ï¼Œå°±æ˜¯ä¸€ç§é€‚åˆè‡ªåŠ¨åŒ–çš„åœºæ™¯ã€‚ä¸ä»…å¯ä»¥æ˜¾è‘—å‡å°‘äººåŠ›æˆæœ¬ï¼Œè€Œä¸”å…¶ä¸­çš„æµ‹è¯•æ•°æ®ç”Ÿæˆã€ç©å®¶æ“ä½œå®ç°ç›¸å…³çš„å†…å®¹ï¼Œä¹Ÿæœ‰å¤ç”¨åˆ°å…¶ä»–æµ‹è¯•åœºæ™¯çš„æ½œåŠ›ã€‚</p>
<p>å½“æ›´å¤šæ“ä½œç®€å•è€Œæµ‹è¯•é‡å¤§çš„åœºæ™¯è¢«è‡ªåŠ¨åŒ–åï¼Œå¾—åˆ°çš„åˆæ­¥æˆæœå°±æ˜¯ï¼Œæ•´ä½“äººåŠ›æˆæœ¬æœ‰æ˜¾è‘—çš„é™ä½å¹…åº¦ã€‚è¿™æ ·ï¼Œæµ‹è¯•äººå‘˜ä¹Ÿæ›´æ„¿æ„ç›¸ä¿¡è·Ÿæ¥çº³è‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯ï¼Œä¼šè®¤ä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯èƒ½åˆ‡å®åœ°è§£å†³æ—¥å¸¸å·¥ä½œä¸­çš„æ•ˆç‡éš¾ç‚¹ã€‚ä»¥è¿™ç§ä¿¡ä»»ä¸ºåŸºç¡€ï¼Œä½œä¸ºè‡ªåŠ¨åŒ–æŠ€æœ¯çš„è½åœ°è€…ï¼Œåç»­ä¹Ÿèƒ½å¤Ÿè…¾å‡ºæ›´å¤šæ€è€ƒç©ºé—´ï¼Œå»æ¢ç´¢è‡ªåŠ¨åŒ–æµ‹è¯•åœ¨å®é™…ä¸šåŠ¡ä¸­æ›´å¤šçš„å¯èƒ½æ€§ã€‚</p>
<h2 id="ç¼ºé™·å‘ç°"><a href="#ç¼ºé™·å‘ç°" class="headerlink" title="ç¼ºé™·å‘ç°"></a>ç¼ºé™·å‘ç°</h2><p>å¾ˆå¤šæµ‹è¯•åŒè¡Œåœ¨æ¥è§¦æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ—¶å€™ï¼Œéƒ½ä¼šæå‡ºä¸€ä¸ªé—®é¢˜ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•èƒ½å‘ç°ä»€ä¹ˆæ¸¸æˆç¼ºé™·ï¼Ÿè¿™ä¸ªé—®é¢˜å…¶å®æœ¬èº«å°±ä¸å¤Ÿä¸¥è°¨ã€‚å½“æˆ‘ä»¬è°ˆæ¸¸æˆæ€§èƒ½æµ‹è¯•ã€å‹åŠ›æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬å®é™…æ˜¯éœ€è¦æµ‹è¯•å‡ºä¸€äº›åæ˜ äº§å“è´¨é‡çš„æŒ‡æ ‡ï¼›è€Œå½“æˆ‘ä»¬è°ˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ—¶å€™ï¼Œå®é™…æ˜¯åœ¨è®¨è®ºä¸€ç§æµ‹è¯•çš„æ–¹å¼ã€‚æ‰€ä»¥è¯´ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•èƒ½å‘ç°ä»€ä¹ˆç¼ºé™·ï¼Œè¿™ä¸ªé—®é¢˜ï¼Œæé—®çš„æ–¹å¼ä¸å¯¹ã€‚å¯¹äºæµ‹è¯•å·¥ä½œè€Œè¨€ï¼Œè‡ªåŠ¨åŒ–æ˜¯ä¸€ç§æ‰‹æ®µï¼›è€Œå¯¹äºè´¨é‡ä¿éšœè€Œè¨€ï¼Œæµ‹è¯•æœ¬èº«å°±æ˜¯ä¸€ç§æ‰‹æ®µã€‚å½“è®¨è®ºåˆ°è´¨é‡ä¿éšœçš„é—®é¢˜ï¼Œå¦‚ä½•è®¾è®¡æµ‹è¯•ç­–ç•¥æ‰æ˜¯å…³é”®ï¼Œè€Œä¸æ˜¯å®ç°æµ‹è¯•çš„æ–¹å¼ã€‚å› æ­¤ï¼Œç¼ºé™·å‘ç°ï¼Œå…¶æ ¸å¿ƒè¿˜æ˜¯æµ‹è¯•ç­–ç•¥å†³å®šçš„ï¼Œè€Œä¸æ˜¯è‡ªåŠ¨åŒ–æœ¬èº«ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™å¹¶ä¸ä»£è¡¨è‡ªåŠ¨åŒ–æµ‹è¯•ä¸èƒ½å†³å®šç¼ºé™·å‘ç°ï¼Œè¿™æ˜¯å› ä¸ºï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•åº”ç”¨åˆ°çš„åœºæ™¯ä¹Ÿæ˜¯æœ‰é™åº¦çš„ï¼Œå› æ­¤è¿™ç§æ‰‹æ®µä¹Ÿåªèƒ½å‘ç°é€‚ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•çš„ä¸šåŠ¡åœºæ™¯ä¸­ç”Ÿæˆçš„ç¼ºé™·ã€‚</p>
<p>å¯¹äºä¸€èˆ¬çš„ä¸šåŠ¡ç³»ç»Ÿï¼Œè‡ªåŠ¨åŒ–é€‚åˆåšä¸šåŠ¡åŸºç¡€åŠŸèƒ½çš„å†’çƒŸæµ‹è¯•ï¼Œå› æ­¤å…¶å‘ç°çš„ç¼ºé™·ï¼Œä¹Ÿå°†å±€é™åœ¨å†’çƒŸæµ‹è¯•æ‰€è¦†ç›–çš„èŒƒå›´å†…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä¾¿å‘ç°çš„ç¼ºé™·æ•°é‡ä¸ä¼šå¾ˆå¤šï¼Œä½†å‘ç°çš„ç¼ºé™·ä¸¥é‡ç¨‹åº¦ä¸€èˆ¬éƒ½æ¯”è¾ƒé‡ï¼Œç”šè‡³é˜»å¡æ•´ä¸ªåŠŸèƒ½ã€‚åœ¨ç¬”è€…åšè‡ªåŠ¨å†’çƒŸæµ‹è¯•çš„ç»éªŒä¸­ï¼Œå‘ç°çš„ç¼ºé™·é‡Œé¢ï¼Œå¤§çº¦ä¸‰åˆ†ä¹‹äºŒæ˜¯æ˜¾è‘—å½±å“ç©å®¶ä½“éªŒçš„ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å°±é€‚åˆåšæˆæ—¥å¸¸è´¨é‡ç›‘æ§çš„å½¢å¼ï¼Œè¯¦ç»†ä¼šåœ¨è´¨é‡ç›‘æ§éƒ¨åˆ†é˜è¿°ã€‚</p>
<p>å¯¹äºå¤æ‚åº¦è¾ƒé«˜ï¼Œæ— æ³•å……åˆ†éå†æ‰€æœ‰æƒ…å†µçš„ç³»ç»Ÿï¼Œè‡ªåŠ¨åŒ–é€‚åˆåšéšæœºçš„æ¢ç´¢æµ‹è¯•ã€‚æ¯”å¦‚é’ˆå¯¹å„ç§UIåœºæ™¯çš„<code>MonkeyTest</code>ï¼Œæˆ–è€…æ˜¯é’ˆå¯¹æŸäº›æ¸¸æˆæœºåˆ¶æ’åˆ—ç»„åˆçš„éšæœºæ£€æŸ¥/å…¨é‡éå†ï¼Œéƒ½æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•å¯ä»¥å‘æŒ¥çš„åœ°æ–¹ã€‚è¿™ç§åœºæ™¯ä¸‹ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•æ—¢å¯ä»¥å‘ç°äººå·¥éš¾ä»¥æ¢ç´¢åˆ°çš„åŠŸèƒ½ç¼ºé™·ï¼Œä¹Ÿå¯ä»¥å‘ç°è®¸å¤šå¶ç°ç”šè‡³å¿…ç°çš„å´©æºƒæ“ä½œã€‚</p>
<p>å¦‚æœåº”ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæ¯”è¾ƒæ³¨é‡ç¼ºé™·å‘ç°çš„è¯ï¼Œå»ºè®®åœ¨æµ‹è¯•åœºæ™¯é€‰å‹ä¸Šï¼Œå°±æœ‰é™é€‰æ‹©ç¼ºé™·é‡è¾ƒå¤§ã€ç–‘éš¾æ‚ç—‡è¾ƒå¤šçš„æ¸¸æˆç³»ç»Ÿå°è¯•åº”ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè¿™æ ·æ‰èƒ½ä½¿å¾—ç¼ºé™·å‘ç°æ–¹é¢å¯ä»¥è¾¾åˆ°æ›´å¤§çš„æ•ˆæœã€‚è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ›´å¤šçš„æ˜¯å·¥å…·æ€§ä½œç”¨ï¼Œè€Œéä¸šåŠ¡æ€§ä½œç”¨ã€‚</p>
<h2 id="è´¨é‡ç›‘æ§"><a href="#è´¨é‡ç›‘æ§" class="headerlink" title="è´¨é‡ç›‘æ§"></a>è´¨é‡ç›‘æ§</h2><p>è‡ªåŠ¨åŒ–æµ‹è¯•ä½œä¸ºä¸€ç§ä»£æ›¿äººåŠ›å®ç°ç¼ºé™·å‘ç°çš„æ–¹æ¡ˆï¼Œæœ¬èº«å°±æœ‰åšæˆæ—¥å¸¸è´¨é‡ç›‘æ§çš„èƒ½åŠ›ã€‚æµ‹è¯•äººå‘˜å¯ä»¥ä¸å—å·¥æ—¶é™åˆ¶ï¼Œéšæ—¶éšåœ°å‘èµ·è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¹¶å³æ—¶äº§å‡ºæ¸¸æˆæŠ¥å‘Šï¼Œåšåˆ°å®æ—¶çš„æµ‹è¯•é—­ç¯ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œä¸ä»…æ˜¯å¯¹æµ‹è¯•å·¥ä½œæœ¬èº«ï¼Œå¯¹äºè´¨é‡ä¿éšœè€Œè¨€ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ä¹Ÿå¯ä»¥å‘æŒ¥ä½œç”¨ã€‚</p>
<p>é’ˆå¯¹ä¸åŒçš„åœºæ™¯ï¼Œè´¨é‡ç›‘æ§çš„æ—¶æœºå’Œå‘¨æœŸä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚å¥½æ¯”è¯´ï¼Œé’ˆå¯¹æ¯æ—¥ä¸»å¹²ç‰ˆæœ¬çš„æœåŠ¡å™¨ã€å®¢æˆ·ç«¯å‘å¸ƒï¼Œéœ€è¦æœ‰å®æ—¶çš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä»¥éªŒè¯æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åŸºæœ¬åŠŸèƒ½å¯ç”¨ï¼›é’ˆå¯¹é‡ç‚¹ä½†è´¨é‡é—®é¢˜è¾ƒå¤šçš„ç©æ³•ï¼Œéœ€è¦æœ‰å‘¨çº§ç”šè‡³æ—¥çº§çš„å†’çƒŸæµ‹è¯•ä»¥ä¿è¯åŸºæœ¬åŠŸèƒ½å¯ç”¨ã€‚æ­¤å¤–ï¼Œé’ˆå¯¹ä¸€äº›æ¢ç´¢æ€§çš„æµ‹è¯•å†…å®¹ï¼Œä¹Ÿå¯ä»¥æ”¾åˆ°æ—¥å¸¸çš„è´¨é‡ç›‘æ§ç¯èŠ‚ï¼Œå¯ä»¥å’Œäººå·¥æµ‹è¯•å½¢æˆä¼˜åŠ¿äº’è¡¥ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿‡é‡çš„è´¨é‡ç›‘æ§å¹¶ä¸ä¸€å®šèƒ½å¤Ÿå¯¹ä¸šåŠ¡æœ¬èº«å¸¦æ¥æ›´å¤šçš„æ­£å‘æ•ˆç›Šã€‚è´¨é‡ç›‘æ§æ˜¯å€¡å¯¼å®æ—¶åé¦ˆçš„ï¼Œä½†æ˜¯å°¤å…¶åœ¨æ¸¸æˆé‡Œï¼Œé’ˆå¯¹è¾ƒé•¿é“¾è·¯çš„ä¸šåŠ¡åŠŸèƒ½è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¦‚æœæœ‰æµ‹è¯•å¤±è´¥çš„æƒ…å†µï¼ŒæŠ¥é”™ç»“æœå¹¶ä¸ä¸€å®šèƒ½å¤Ÿç›´æ¥åæ˜ é—®é¢˜çš„æ ¹å› ï¼Œç”šè‡³è¿˜å¯èƒ½å­˜åœ¨å› è‡ªåŠ¨åŒ–ç¨³å®šæ€§ä¸è¶³å¯¼è‡´ç”¨ä¾‹æ‰§è¡Œæ— æ•ˆã€‚å› æ­¤ï¼Œè®¸å¤šè‡ªåŠ¨åŒ–æµ‹è¯•è¿‡ç¨‹éœ€è¦äººå·¥ä»‹å…¥æ’æŸ¥é—®é¢˜æ ¹å› å’Œå¤ç°æ‰‹æ³•ï¼Œæ‰èƒ½å®Œæˆç¼ºé™·åé¦ˆçš„é—­ç¯ã€‚äººå·¥æ’æŸ¥æœ¬èº«å°±ä¼šå¸¦æ¥å·¥ä½œæˆæœ¬ï¼Œå¦‚æœè´¨é‡ç›‘æ§çš„è¦†ç›–é¢éå¸¸å¤§ï¼Œä½†äººåŠ›æ— æ³•æ”¯æŒé—®é¢˜æ’æŸ¥å·¥ä½œçš„è¯ï¼Œå°±ä¼šé€ æˆå¾ˆå¤šè‡ªåŠ¨åŒ–æµ‹è¯•å†…å®¹æ˜¯å†—ä½™çš„ï¼Œæ²¡æœ‰å½¢æˆæœ€ç»ˆçš„ä¸šåŠ¡é—­ç¯ã€‚å› æ­¤ï¼Œåœ¨è‡ªåŠ¨åŒ–è½åœ°åˆ°æ—¥å¸¸è´¨é‡ç›‘æ§æ—¶ï¼Œéœ€è¦æ—¶åˆ»æŠŠæ¡è‡ªåŠ¨åŒ–çš„é‡ä»¥åŠäººå·¥æ•´åˆå·¥ä½œçš„å¹³è¡¡ï¼Œé¦–å…ˆä¿è¯è‡ªåŠ¨åŒ–æµ‹è¯•åœ¨æ•´ä¸ªä¸šåŠ¡é—­ç¯çš„çš„æœ‰æ•ˆæ€§ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šæ‰å†é€æ­¥æå‡ç›‘æ§çš„é‡ã€‚</p>
<p>å¦‚æœç›‘æ§çš„å†…å®¹æ˜¯é’ˆå¯¹æ¸¸æˆé…ç½®ã€èµ„äº§æ£€æŸ¥ä¹‹ç±»çš„å†…å®¹çš„è¯ï¼Œé‚£ä¹ˆç”±äºè¿™äº›æµ‹è¯•çš„é“¾è·¯è¾ƒçŸ­ï¼Œæµ‹è¯•ç»“æœèƒ½å¤Ÿç›´æ¥åæ˜ è´¨é‡æƒ…å†µï¼Œæ•´ä¸ªæµç¨‹èƒ½ç›´æ¥é—­ç¯ï¼Œå› æ­¤æ˜¯å¤šå¤šç›Šå–„çš„ã€‚</p>
<h2 id="æŠ€æœ¯æ”¯æŒ"><a href="#æŠ€æœ¯æ”¯æŒ" class="headerlink" title="æŠ€æœ¯æ”¯æŒ"></a>æŠ€æœ¯æ”¯æŒ</h2><p>é™¤äº†ä¸šåŠ¡è½åœ°æ€§è´¨çš„å†…å®¹ä¹‹å¤–ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•æœ¬èº«ä½œä¸ºä¸€ç§æµ‹è¯•æŠ€æœ¯ï¼Œæœ¬èº«å°±å…·æœ‰æŠ€æœ¯ä»·å€¼ã€‚è¿™éƒ¨åˆ†å°¤å…¶ä½“ç°åœ¨ï¼Œæ¸¸æˆè‡ªåŠ¨åŒ–æŠ€æœ¯å¯ä»¥ç›´æ¥å’Œæ¸¸æˆå®¢æˆ·ç«¯/æœåŠ¡å™¨ç­‰ç¨‹åºè¿è¡Œæ—¶äº¤äº’ï¼Œä»è€Œèƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°é€šè¿‡ç¨‹åºæ‰‹æ®µè®¿é—®æ¸¸æˆè¿è¡Œçš„æ•°æ®ã€‚å¥½æ¯”è¯´ï¼Œå‹æµ‹åœºæ™¯æ„é€ ã€ç‰¹å®šç©æ³•æµ‹è¯•è´¦å·æ„é€ ã€æ¸¸æˆæ—¥å¿—è§£æã€æ¸¸æˆæ•°æ®æ”¶é›†ä»¥åŠç©å®¶æ“ä½œå½•åˆ¶å›æ”¾ï¼Œè¿™äº›äººå·¥éš¾ä»¥æ“ä½œçš„å†…å®¹ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æŠ€æœ¯éƒ½å¯ä»¥è¿…é€Ÿè§£å†³ã€‚</p>
<p>è‡ªåŠ¨åŒ–æŠ€æœ¯ä¸èƒ½ä»£æ›¿äººå»åˆ¤æ–­æŸäº›äº‹ç‰©çš„åˆç†æ€§ï¼Œä½†å¯ä»¥ç®€åŒ–å¹¶ä»£æ›¿äººçš„æ“ä½œï¼Œåœ¨æ›´åŠ ç»†è‡´çš„ç²’åº¦ä¸Šå»æ§åˆ¶æ•´ä¸ªæ¸¸æˆç¨‹åºã€‚å……åˆ†åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è®©è‡ªåŠ¨åŒ–æŠ€æœ¯åœ¨æ›´å¤šçš„ç©æ³•æµ‹è¯•ä¸Šå‘æŒ¥å¯èƒ½æ€§ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¸¸æˆè‡ªåŠ¨åŒ–æŠ€æœ¯ï¼Œæ— è®ºæ˜¯å¯¹æµ‹è¯•æŠ€æœ¯çš„ä¸°å¯Œï¼Œè¿˜æ˜¯å¯¹äºæµ‹è¯•æ•ˆèƒ½çš„æå‡ï¼Œæˆ–è€…æ˜¯å¯¹æ•´ä¸ªè´¨é‡ä¿éšœä¸šåŠ¡çš„å·©å›ºæ–¹é¢ï¼Œéƒ½æœ‰å……åˆ†çš„å‘æŒ¥ä½™åœ°ã€‚æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•èƒ½å¤Ÿäº§ç”Ÿä¸šåŠ¡ä»·å€¼ï¼ŒåšæŒè¿™æ ·çš„ä¿¡å¿µï¼Œæ˜¯æˆåŠŸè½åœ°è‡ªåŠ¨åŒ–æŠ€æœ¯çš„ç¬¬ä¸€æ­¥ï¼›ä»æŠ€æœ¯é€‰å‹ï¼Œåˆ°æ¡†æ¶è®¾è®¡ï¼Œå†åˆ°ç¨³å®šæ€§ä¿éšœï¼Œåšå¥½æŠ€æœ¯æ–¹é¢çš„åŸºå»ºï¼Œæ˜¯è½åœ°è‡ªåŠ¨åŒ–æŠ€æœ¯çš„ç¬¬äºŒæ­¥ï¼›æ•´ä¸ªæµ‹è¯•å›¢é˜Ÿé€šåŠ›åä½œï¼Œå……åˆ†å‘æŒ¥è‡ªåŠ¨åŒ–æŠ€æœ¯çš„ä¼˜åŠ¿ï¼Œç”±ç‚¹åˆ°é¢ä¸°å¯Œè‡ªåŠ¨åŒ–ç©æ³•æµ‹è¯•ç­–ç•¥ï¼Œå›ºåŒ–æ—¥å¸¸è´¨é‡ç›‘æ§å’Œæµ‹è¯•æ‰§è¡Œä¸šåŠ¡ï¼Œè¿™æ˜¯è½åœ°è‡ªåŠ¨åŒ–æŠ€æœ¯çš„æœ€åä¸€æ­¥ã€‚å¦‚æœä½ æ˜¯ä¸€ä¸ªè´Ÿè´£æ¸¸æˆè‡ªåŠ¨åŒ–ä¸“é¡¹æµ‹è¯•çš„åŒå­¦ï¼Œè¯·åšä¿¡æ¸¸æˆè‡ªåŠ¨åŒ–æŠ€æœ¯å¸¦æ¥çš„ä»·å€¼ã€‚æ— è®ºé‡åˆ°ä»€ä¹ˆå›°éš¾ï¼Œåšå¥½æŠ€æœ¯åŸºå»ºï¼Œåšå¥½ä¸šåŠ¡æ²Ÿé€šï¼Œå°±ç®—æœ‰å†å¤æ‚çš„é—®é¢˜ï¼Œæœ€ç»ˆéƒ½å¯ä»¥è¿åˆƒè€Œè§£ã€‚</p>
]]></content>
      <categories>
        <category>Game Of AutoTest</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>è´¨é‡ä¿éšœ</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘Ubuntu22.04å»æ‰ä¾§è¾¹èœå•æ Floppy Diskå›¾æ ‡çš„æ–¹æ³•</title>
    <url>/2022/10/15/diymemo/ubuntu22_floppy_disk/</url>
    <content><![CDATA[<p>è¿‘æœŸè£…<code>Ubuntu22.04</code>è™šæ‹Ÿæœºï¼Œå‘ç°ä¾§è¾¹èœå•æ å¤šäº†ä¸ª<code>Floppy Disk</code>å›¾æ ‡ã€‚è½¯é©±è¿™ä¸œè¥¿æ¯•ç«Ÿæ˜¯ä¸Šä¸–çºªçš„äº†ï¼Œ2022å¹´ä¹Ÿæ²¡ä»€ä¹ˆç”¨ï¼Œä½†å°±æ˜¯æ‰¾ä¸åˆ°å…¥å£å»æ‰è¿™ä¸ªå†—ä½™çš„å›¾æ ‡ã€‚</p>
<p>ä»Šå¤©å¶ç„¶ä¹‹é—´å‘ç°å»æ‰å›¾æ ‡çš„æ–¹å¼ï¼Œä¾›å¤§å®¶å‚è€ƒï¼š</p>
<ul>
<li>å³ä¸Šè§’ç‚¹<code>ç”µæº/å£°éŸ³/ç½‘ç»œæŒ‰é’®</code>ï¼Œé€‰æ‹©<code>Settingsè®¾ç½®</code></li>
<li>é€‰æ‹©<code>Appearance</code>ï¼Œå°±æ˜¯èƒ½è°ƒ<code>Light/Dark</code>é£æ ¼çš„é¡µç­¾</li>
<li>ä¸‹æ‹‰ï¼Œåœ¨<code>Dock</code>æ ç›®ä¸‹ï¼Œç‚¹å‡»<code>Configure dock behavior</code></li>
<li>é‡Œé¢çš„<code>Show Volumes and Devices</code>ä¸‹ï¼Œæœ‰ä¸€ä¸ª<code>Include Unmounted Volumes</code>é¡¹ã€‚åæ­£è½¯é©±ä¸€èˆ¬ä¹Ÿä¸ä¼šæŒ‚è½½ï¼Œæ‰€ä»¥å–æ¶ˆç‚¹é€‰è¿™ä¸ªé¡¹ï¼Œ<code>Floppy Disk</code>å›¾æ ‡å°±æ²¡äº†ã€‚</li>
</ul>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>Ubuntu</tag>
        <tag>Floppy Disk</tag>
        <tag>linux</tag>
        <tag>æ“ä½œç³»ç»Ÿ</tag>
        <tag>ç³»ç»Ÿè®¾ç½®</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘ebook-boilerplateâ€”â€”æ‰¹é‡è½¬markdownä¸ºPDFå’Œç”µå­ä¹¦</title>
    <url>/2022/10/05/githubdiscovery/ebook_boilerplate/</url>
    <content><![CDATA[<p>æ­£å€¼åä¸€å‡æœŸï¼Œè¿‘æœŸå‡†å¤‡æŠŠè‡ªå·±çš„<code>python</code>ç¬”è®°ç²¾ç¼–æ•´ç†ï¼Œåšä¸€ä¸ª<code>pdf</code>ç”µå­ä¹¦ã€‚åœ¨è°ƒç ”å¦‚ä½•æŠŠå¤šä¸ª<code>markdown</code>æ–‡æ¡£è½¬åŒ–ä¸ºå•ä¸ª<code>pdf</code>çš„æ—¶å€™ï¼Œè¯•äº†å¾ˆå¤šç§æ–¹æ³•ã€‚æœ€åæ‰¾åˆ°äº†æœ€ä½³æ–¹æ¡ˆï¼Œä¹Ÿå°±æ˜¯æœ¬æ–‡çš„ä¸»è§’ï¼Œç”±<code>phodal</code>å‰è¾ˆæ•´ç†çš„ç”µå­ä¹¦ç”Ÿæˆé¡¹ç›®<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Bob2RhbC9lYm9vay1ib2lsZXJwbGF0ZQ==" title="https://github.com/phodal/ebook-boilerplate">ebook-boilerplate<i class="fa fa-external-link"></i></span>ã€‚è¿™ä¸ªé¡¹ç›®ä¸ä»…æ”¯æŒæ‰¹é‡è½¬<code>markdown</code>ä¸º<code>pdf</code>ï¼Œè€Œä¸”è¿˜æ”¯æŒè½¬æˆ<code>ebook</code>ç­‰å¤šç§æ ¼å¼ã€‚</p>
<p>ä½¿ç”¨è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œä¹Ÿè¸©äº†ä¸€äº›å‘ï¼Œéœ€è¦åšä¸€äº›é¢å¤–çš„é…ç½®ã€‚ä»¥ç¬”è€…çš„åœºæ™¯ä¸ºä¾‹ï¼Œç”µå­ä¹¦ç”Ÿæˆç¯å¢ƒæ˜¯<code>Ubuntu22</code>ï¼Œéœ€è¦è½¬åŒ–ä¸€å †ä¸­æ–‡çš„<code>markdown</code>ã€‚<code>clone</code>äº†è¿™ä¸ªé¡¹ç›®ä¹‹åï¼Œé™¤äº†<code>ebook-boilerplate</code>æœ¬èº«<code>README.md</code>é‡Œæè¿°çš„å†…å®¹ä¹‹å¤–ï¼Œå®é™…è¿˜éœ€è¦ç•™æ„ä»¥ä¸‹ç¯èŠ‚ï¼š</p>
<a id="more"></a>
<p>ç¬¬ä¸€å—æ˜¯<code>pandoc</code>è·Ÿ<code>texlive</code>çš„ç¯å¢ƒï¼Œæœ€å¥½æ˜¯å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬ï¼Œ<code>apt</code>é‡Œé¢çš„ç‰ˆæœ¬å·²ç»è¿‡æ—¶äº†ã€‚å°¤å…¶æ˜¯<code>texlive</code>ï¼Œ<code>apt</code>æ‹¿åˆ°çš„ç‰ˆæœ¬å¾ˆå¤šå®åº“éƒ½æ²¡æœ‰ï¼Œå¾—è¦ç”¨å®˜ç½‘æœ€æ–°çš„<code>install</code>è„šæœ¬æ‰ä¼šè‡ªåŠ¨æŠŠå„ç§<code>package</code>éƒ½è£…ä¸Šã€‚</p>
<p>ç„¶åæ˜¯ç”Ÿæˆ<code>pdf</code>çš„æ“ä½œé‡Œï¼Œéœ€è¦æŒ‡å®šä¸€ç§æ”¯æŒä¸­æ–‡çš„<code>tex-engine</code>ï¼Œç¬”è€…æ˜¯é€‰æ‹©äº†<code>xelatex</code>ã€‚éœ€è¦åœ¨<code>makefile</code>çš„<code>pandoc</code>ç”Ÿæˆ<code>pdf</code>é‚£å—åšä¿®æ”¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pdf: markdown</span><br><span class="line">	pandoc -s $(filename).md -o $(filename).pdf \</span><br><span class="line">		--title-prefix $(title) \</span><br><span class="line">		--listings -H listings-setup.tex \</span><br><span class="line">		--template=template/template.tex \</span><br><span class="line">		--pdf-engine=xelatex \  # åŠ è¿™ä¸€è¡Œï¼Œå£°æ˜pdf-engine</span><br><span class="line">		--toc</span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œ<code>markdown</code>ç”Ÿæˆ<code>pdf</code>çš„æ­¥éª¤ï¼Œå®é™…æ˜¯æŠŠæ‰€æœ‰<code>markdown</code>å†…å®¹æŒ‰æ–‡ä»¶åé¡ºåºï¼ˆå¯ä»¥ç”¨æ•°å­—æ ‡è¯†ç»„ç»‡ä¸€ä¸‹ï¼‰æ‹¼æ¥åœ¨ä¸€èµ·ï¼Œç„¶åç”¨<code>toc</code>æŒ‰ç…§<code>markdown</code>çš„æ ‡é¢˜æ–‡æœ¬ï¼ˆ<code>h1</code>ã€<code>h2</code>ä¹‹ç±»ï¼‰ç”Ÿæˆç›®å½•ï¼Œæœ€åå†ç”Ÿæˆ<code>pdf</code>ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æˆ‘ä»¬æ¯ä¸€ç« éƒ½è¦åˆ†é¡µï¼Œè€Œåœ¨<code>markdown</code>é‡Œæ ‡è¯†åˆ†é¡µçš„<code>html</code>æ ‡ç­¾<code>&lt;div STYLE=&quot;page-break-after: always;&quot;&gt;&lt;/div&gt;</code>åœ¨<code>tex-engine</code>ä¸‹é¢ï¼Œæ˜¯æ²¡æ³•å‡ºåˆ†é¡µçš„æ•ˆæœçš„ã€‚è¿™ç§æƒ…å†µä¸‹çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼šæŠŠè¿™ä¸ªæ ‡ç­¾æ¢æˆ<code>\newpage</code>ï¼Œè¿™æ ·<code>tex-engine</code>å°±èƒ½è¯†åˆ«äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çš„<code>md</code>æ–‡ä»¶çš„å†…å®¹åº”è¯¥æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 1.1 xxx.md</span><br><span class="line"></span><br><span class="line"># ä¸Šé¢å¿½ç•¥ä½ çš„markdownæ­£æ–‡</span><br><span class="line"></span><br><span class="line">\newpage</span><br></pre></td></tr></table></figure>
<p>å†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹<code>listings-setup.tex</code>ä»¥åŠ<code>template/template.tex</code>é‡Œçš„å†…å®¹ï¼Œå»ä¿®æ”¹ä»£ç é«˜äº®è·Ÿæ­£æ–‡çš„æ’ç‰ˆå‚æ•°ã€‚ä»¥ç¬”è€…çš„è§‚æ„Ÿä¸ºä¾‹ï¼Œè¿™é‡Œé¢çš„å†…å®¹ç¼–è¾‘äº†ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>ä»£ç é«˜äº®ï¼Œå³<code>listings-setup</code>ï¼Œ<code>basicstyle</code>è®¾ç½®å­—å·ä¸º<code>\small</code></li>
<li><code>template.tex</code>é‡Œï¼Œå–æ¶ˆå¯¹äºä¸­æ–‡åˆŠç‰©ä¹ æƒ¯çš„è®¾ç½®ï¼Œæ­£æ–‡å­—å·ä¸º<code>9pt</code>ï¼Œè¡Œè·è°ƒæ•´ä¸º<code>1.1</code>ã€‚</li>
<li><code>xelatex</code>ä¸‹ï¼Œä¸­æ–‡å­—ä½“ä¸º<code>Noto Sans CJK SC</code>ï¼Œé»˜è®¤å­—ä½“ä¸º<code>Helvetica</code>ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å–œæ¬¢è¡¬çº¿<code>Serif</code>å­—ä½“ï¼Œä¹Ÿéƒ½å¾—è°ƒæ•´æˆè¡¬çº¿çš„å½¢å¼ã€‚</li>
</ul>
<p>æœ€åå°±æ˜¯å„ç§è°ƒè¯•å‹˜è¯¯ï¼Œç”Ÿæˆæœ€åçš„æ–‡æ¡£äº†ã€‚</p>
<p>å½“ç„¶ï¼Œä¸€å¼€å§‹æ‰€è¯´çš„ï¼Œç¬”è€…ç²¾å¿ƒæ•´ç†çš„<code>python</code>ç¬”è®°ï¼Œç°åœ¨ä¹Ÿå·²å‡ºç‚‰ã€‚å„ä½è¯»è€…å¯ä»¥é˜…è¯»<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3JlYWQvY3YxODkzMzg2Mg==" title="https://www.bilibili.com/read/cv18933862">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ä»¥è·å–èµ„æºã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>pdf</tag>
        <tag>ebook-boilerplate</tag>
        <tag>tex</tag>
        <tag>pandoc</tag>
        <tag>markdown</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Game Of AutoTestã€‘4ã€æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¨³å®šæ€§ä¿éšœ</title>
    <url>/2022/10/03/gameofautotest/iv/</url>
    <content><![CDATA[<p>åœ¨æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯è½åœ°è¿‡ç¨‹å½“ä¸­ï¼Œå¦‚ä½•ä¿è¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¨³å®šæ€§ï¼Œæ˜¯ä¸€ä¸ªéœ€è¦é‡ç‚¹ä¼˜å…ˆè§£å†³çš„å›°éš¾é—®é¢˜ã€‚</p>
<p>ä»¥æ‰‹æœºæ¸¸æˆå®¢æˆ·ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•ä¸ºä¾‹ï¼Œå’Œä¸€èˆ¬æœåŠ¡æ¶æ„çš„è‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•æˆ–é›†æˆæµ‹è¯•ä¸åŒï¼Œè‡ªåŠ¨åŒ–é©±åŠ¨çš„è¿‡ç¨‹ï¼Œå…¶æœ¬è´¨æ›´åŠ ç±»ä¼¼äºç½‘ç»œçˆ¬è™«ï¼Œæ¯æ¬¡æµ‹è¯•æ‰§è¡Œéƒ½æ˜¯ä¸€ä¸ªæ—¶é—´è¾ƒé•¿çš„è¿‡ç¨‹ï¼Œè€Œæµç¨‹ä¸€é•¿ï¼Œä¸ç¨³å®šå› ç´ åˆ™éšä¹‹è€Œæ¥ã€‚æ¸¸æˆè‡ªåŠ¨åŒ–çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œå¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>å‰ç½®ç¯å¢ƒå‡†å¤‡ï¼ˆsetupï¼‰ï¼šè®¾ç½®ç”¨ä¾‹è¿è¡Œç¯å¢ƒã€è®¾å¤‡çŠ¶æ€ä¸ç©å®¶çŠ¶æ€ï¼Œä¿è¯ç”¨ä¾‹è¿è¡Œçš„æ¡ä»¶</li>
<li>ç”¨ä¾‹è„šæœ¬æ‰§è¡Œï¼ˆrunï¼‰ï¼šæ‰§è¡Œè‡ªåŠ¨åŒ–ç”¨ä¾‹è„šæœ¬</li>
<li>åç½®æ¢å¤æ“ä½œï¼ˆteardownï¼‰ï¼šæ¢å¤æµ‹è¯•ç¯å¢ƒã€è®¾å¤‡çŠ¶æ€ä¸ç©å®¶çŠ¶æ€</li>
<li>æµ‹è¯•æŠ¥å‘Šè¾“å‡ºï¼ˆreportï¼‰ï¼šæ•´åˆè·‘æµ‹æœŸé—´æ¸¸æˆçš„è¿è¡Œæ•°æ®ä¸ç”¨ä¾‹è„šæœ¬æ”¶é›†/å¯¼å‡ºçš„æ•°æ®ï¼Œç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</li>
</ul>
<p>è¦åˆ†æå¦‚ä½•ä¿éšœæ•´ä¸ªè‡ªåŠ¨åŒ–è¿‡ç¨‹çš„ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™å‡ ä¸ªæ­¥éª¤è¿›è¡Œç»†èŠ‚åˆ‡åˆ†ï¼Œå¯¹æ¯ä¸€ä¸ªç¯èŠ‚å½±å“ç¨³å®šæ€§çš„å› ç´ é€ä¸ªç†é¡ºï¼Œä»è€Œæœ€ç»ˆï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€æ•´å¥—è‡ªåŠ¨åŒ–ç¨³å®šæ€§ä¿éšœçš„è§£å†³æ–¹æ¡ˆã€‚åœ¨è¿™å››ä¸ªæ­¥éª¤å½“ä¸­ï¼Œå‰ç½®ç¯å¢ƒå‡†å¤‡å’Œç”¨ä¾‹è„šæœ¬æ‰§è¡Œè¿™ä¸¤æ­¥ï¼Œå¯¹è‡ªåŠ¨åŒ–æµç¨‹ç¨³å®šæ€§çš„å½±å“é¢æœ€å¤§ï¼Œè€Œæœ€åé¢ä¸¤æ­¥çš„å½±å“ç¨‹åº¦ï¼Œåˆ™ç›¸å¯¹è¾ƒä½ã€‚</p>
<a id="more"></a>
<h2 id="å‰ç½®ç¯å¢ƒå‡†å¤‡"><a href="#å‰ç½®ç¯å¢ƒå‡†å¤‡" class="headerlink" title="å‰ç½®ç¯å¢ƒå‡†å¤‡"></a>å‰ç½®ç¯å¢ƒå‡†å¤‡</h2><p>å‰ç½®ç¯å¢ƒå‡†å¤‡æ­¥éª¤ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒæ‰§è¡Œè¾ƒä¸ºæ–¹ä¾¿ï¼Œäººå·¥æ‰‹åŠ¨å»è®¾ç½®è®¾å¤‡ç¯å¢ƒè·Ÿç©å®¶çŠ¶æ€å°±å¯ä»¥ã€‚ä½†æ˜¯åœ¨å¹³å°åŒ–è¿è¡Œåœºæ™¯ä¸‹ï¼Œéœ€è¦è€ƒè™‘å…¨è‡ªåŠ¨çš„ä»»åŠ¡è°ƒåº¦ã€è‡ªåŠ¨è£…åŒ…ã€è´¦å·ç¯å¢ƒå‡†å¤‡ç­‰æµç¨‹ã€‚å…¶ä¸­æ¯ä¸€ä¸ªå› ç´ ï¼Œéƒ½ä¼šå½±å“æ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹çš„ç¨³å®šæ€§ã€‚</p>
<p>ä»æ‰‹æœºè‡ªåŠ¨åŒ–æµ‹è¯•å¹³å°çš„è®¾è®¡æ¥çœ‹ï¼Œé™¤äº†ä¸€ä¸ªäº‘çœŸæœºå¹³å°æ‰€å¿…éœ€çš„è®¾å¤‡ç®¡ç†ã€é¡¹ç›®ç®¡ç†ã€ç”¨ä¾‹ç®¡ç†ç­‰å¿…é¡»çš„åŠŸèƒ½ä¹‹å¤–ï¼Œæœ€éœ€è¦æ¨æ•²çš„è¿˜æ˜¯ä»»åŠ¡è°ƒåº¦è¿™ä¸€éƒ¨åˆ†ã€‚ä»»åŠ¡è°ƒåº¦æ¨¡å—éœ€è¦ç®¡ç†å¹¶å®æ—¶ç›‘æ§æ‰€æœ‰è¿è¡Œä¸­çš„è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œå•ä¸ªè‡ªåŠ¨åŒ–ä»»åŠ¡çš„è¿è¡Œä»¥åŠå¯¹åº”çš„ç³»ç»Ÿè®¾è®¡ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<ul>
<li>ä»»åŠ¡åˆ›å»ºï¼šæŒ‡å®šè‡ªåŠ¨åŒ–ç”¨ä¾‹é›†ã€æµ‹è¯•è®¾å¤‡ï¼Œåˆ›å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–ä»»åŠ¡<ul>
<li>ä»»åŠ¡ç®¡ç†æ¨¡å—å­˜å‚¨è‡ªåŠ¨åŒ–ä»»åŠ¡å®šä¹‰åˆ°æ•°æ®åº“</li>
</ul>
</li>
<li>è¿è¡Œä»»åŠ¡å®ä¾‹ï¼šç”¨æˆ·ä¸ºä»»åŠ¡æŒ‡å®šé€‰æ‹©å®¢æˆ·ç«¯ç‰ˆæœ¬ï¼Œè§¦å‘å•ä¸ªä»»åŠ¡å®ä¾‹çš„æ‰§è¡Œ<ul>
<li>ä»»åŠ¡è°ƒåº¦æ¨¡å—æ ¹æ®ä»»åŠ¡é‡Œæµ‹è¯•è®¾å¤‡çš„å£°æ˜ï¼Œç¡®å®šåˆé€‚çš„æµ‹è¯•è®¾å¤‡æ‰§è¡Œè‡ªåŠ¨åŒ–ä»»åŠ¡</li>
<li>ä»»åŠ¡è°ƒåº¦æ¨¡å—åˆ›å»ºä¸€ä¸ªä»»åŠ¡å®ä¾‹è®°å½•ä»¥åŠå¤šä¸ªå…³è”çš„ç”¨ä¾‹æ‰§è¡Œå®ä¾‹è®°å½•ï¼Œå­˜å‚¨åˆ°æ•°æ®åº“</li>
<li>ä»»åŠ¡è°ƒåº¦æ¨¡å—å°†ä»»åŠ¡ä¸‹å‘ç»™æµ‹è¯•è®¾å¤‡å¯¹åº”çš„<code>PC-Agent</code></li>
<li>åœ¨ç¼“å­˜ä¸­å¤‡ä»½ä¸€ä»½ä»»åŠ¡å’Œç”¨ä¾‹è¿è¡Œçš„çŠ¶æ€ä¿¡æ¯ï¼Œç”¨äºåœ¨æ–°çš„çŠ¶æ€ä¸ŠæŠ¥æ—¶ï¼Œå¿«é€Ÿè·å–å¹¶å¯¹æ¯”çŠ¶æ€ä¿¡æ¯ï¼Œç¡®è®¤ä»»åŠ¡å’Œç”¨ä¾‹æ‰§è¡Œè®°å½•æ˜¯å¦æ›´æ–°</li>
</ul>
</li>
<li>ç”¨ä¾‹æ‰§è¡Œï¼š<code>Agent</code>æ¥æ”¶ä»»åŠ¡åï¼Œåˆ›å»ºè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹æ‰€å¿…éœ€çš„è¿è¡Œç¯å¢ƒï¼Œå¹¶æŒ‰ç…§ç”¨ä¾‹é›†å®šä¹‰æ‰§è¡Œç”¨ä¾‹<ul>
<li>æŒ‡å®šçš„è®¾å¤‡æ‰§è¡Œç”¨ä¾‹æœ‰æ’é˜Ÿæœºåˆ¶ï¼Œåªæœ‰å‰é¢çš„ç”¨ä¾‹æ‰§è¡Œå®Œï¼Œæ‰èƒ½æ‰§è¡Œæ–°çš„ç”¨ä¾‹</li>
<li>æ‰§è¡Œç”¨ä¾‹å‰ï¼Œ<code>Agent</code>éœ€è¦å’Œ<code>CI</code>å¹³å°æ‰“é€šï¼Œå®ç°è‡ªåŠ¨ä¸‹åŒ…ã€è£…åŒ…çš„æµç¨‹</li>
<li>å®é™…æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå‰ï¼Œéœ€è¦å®ç°æ¸¸æˆçš„è´¦å·ç™»å½•å’Œè¿›æ¸¸è¿‡ç¨‹ï¼Œè¿™ä¸€è¿‡ç¨‹ä¹Ÿéœ€è¦æŠ½è±¡æˆä¸€ä¸ªå‰ç½®ç”¨ä¾‹</li>
<li>å‡†å¤‡å¥½ä¸€åˆ‡åï¼Œæ‰æ‰§è¡Œå®é™…çš„æµ‹è¯•ç”¨ä¾‹</li>
</ul>
</li>
<li>è®¾å¤‡æ‰§è¡ŒçŠ¶æ€æ›´æ–°<ul>
<li><code>PC-Agent</code>åœ¨ä¸‹åŒ…è£…åŒ…ã€å‰ç½®ç”¨ä¾‹ã€å®é™…æµ‹è¯•ç”¨ä¾‹æ‰§è¡ŒæœŸé—´ï¼Œä»¥å›ºå®šé¢‘ç‡ä¸ŠæŠ¥å½“å‰ç”¨ä¾‹ï¼ˆåŒ…å«å¯¹åº”ä»»åŠ¡å®ä¾‹IDï¼‰çš„æ‰§è¡ŒçŠ¶æ€ã€‚ä»»åŠ¡è°ƒåº¦æ¨¡å—åœ¨ç”¨ä¾‹/ä»»åŠ¡çŠ¶æ€å˜åŒ–æƒ…å†µä¸‹ï¼Œæ›´æ–°æ•°æ®åº“ä¿¡æ¯</li>
<li>å½“ä¸€ä¸ªç”¨ä¾‹æ‰§è¡Œå®Œæ¯•ï¼Œä»»åŠ¡è°ƒåº¦æ¨¡å—æ ‡è®°è¯¥ç”¨ä¾‹æ‰§è¡Œå®ä¾‹å·²å®Œæˆï¼Œå¹¶æ›´æ–°å¯¹åº”ä»»åŠ¡å®ä¾‹çš„ç»Ÿè®¡ä¿¡æ¯</li>
<li>å½“æ‰€æœ‰æœºå™¨æ‰€æœ‰ç”¨ä¾‹æ‰§è¡Œå®Œæ¯•ï¼ˆæˆ–è€…å¼‚å¸¸ä¸­æ–­ï¼‰ï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–ä»»åŠ¡å®ä¾‹ç»“æŸï¼Œä»»åŠ¡ç®¡ç†æ¨¡å—æ ‡è®°å¯¹åº”ä»»åŠ¡å®ä¾‹å·²å®Œæˆ</li>
</ul>
</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä»è‡ªåŠ¨åŒ–å¹³å°<code>infra</code>æ–¹ä»¥åŠè‡ªåŠ¨åŒ–ç”¨ä¾‹å¼€å‘æ–¹ä¸¤ä¸ªè§’åº¦ï¼Œå»åˆ†æä¿éšœè‡ªåŠ¨åŒ–ç¨³å®šæ€§éœ€è¦è€ƒé‡çš„ä¸€äº›ç‚¹ã€‚<br>ä»å¹³å°<code>infra</code>æ–¹çš„è§’åº¦è€ƒè™‘ï¼Œè¦ç»´æŒè‡ªåŠ¨åŒ–æµç¨‹çš„ç¨³å®šæ€§ï¼Œé™¤å»æŠ€æœ¯è®¾æ–½æœ¬èº«ç¨‹åºç¨³å®šæ€§å¤–ï¼Œåœ¨ç³»ç»Ÿè®¾è®¡ä¸Šï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li>ä»»åŠ¡è°ƒåº¦æ¨¡å—å¯¹äºä»»ä¸€ç”¨ä¾‹çš„æ‰€æœ‰æ‰§è¡Œæ­¥éª¤ï¼Œéœ€è¦å»ºç«‹è¶…æ—¶å¤±è´¥æœºåˆ¶ï¼Œé˜²æ­¢çŠ¶æ€é˜»å¡<ul>
<li><code>CI</code>ä¸‹åŒ…æ¥å£å¤±æ•ˆã€ç”¨ä¾‹æ‰§è¡Œæ—¶é—´è¿‡é•¿ã€<code>Agent</code>å®•æœºã€æ‰§è¡Œæœºå™¨æ— æ•…è¿ç§»ï¼Œéƒ½ä¼šå¼•èµ·ç”¨ä¾‹å¡çŠ¶æ€</li>
<li>ä»»åŠ¡è°ƒåº¦æ¨¡å—éœ€è¦åœ¨ç‰¹å®šçŠ¶æ€æŒç»­æ—¶é—´è¿‡é•¿ï¼Œæˆ–æ˜¯ä¸<code>Agent</code>æ–­è¿çš„æƒ…å†µä¸‹ï¼Œä¸»åŠ¨æ ‡è¯†ç”¨ä¾‹è¿è¡Œå¼‚å¸¸</li>
</ul>
</li>
<li>å¯¹äºé•¿æ—¶é—´æ’é˜Ÿæ— æ³•æ‰§è¡Œçš„ç”¨ä¾‹ï¼Œä»»åŠ¡è°ƒåº¦æ¨¡å—å¯è€ƒè™‘å¢åŠ é‡è°ƒåº¦æœºåˆ¶ï¼ŒæŠŠç”¨ä¾‹é‡æ–°å®‰æ’åˆ°å…¶ä»–ç©ºé—²çš„æœºå™¨è¿è¡Œ<ul>
<li>ä»ä¸šåŠ¡è§’åº¦æ¥è®²ï¼Œé•¿æ—¶é—´æ’é˜Ÿä¹Ÿæ˜¯è‡ªåŠ¨åŒ–ä¸ç¨³å®šçš„ä¸€ç§æƒ…å†µï¼Œå› ä¸ºä¼šå¯¼è‡´ç”¨ä¾‹æ— æ³•åœ¨æœŸæœ›çš„æ—¶é—´æœŸé™ä¸­å®Œæˆæ‰§è¡Œï¼Œä»è€Œè¾¾ä¸åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ•ˆæœ</li>
</ul>
</li>
</ul>
<p>ä»ä¸šåŠ¡è‡ªåŠ¨åŒ–å¼€å‘çš„è§’åº¦è€ƒè™‘ï¼Œåœ¨ç”¨ä¾‹æ‰§è¡Œç¯å¢ƒæ„é€ æ–¹é¢ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li>å•ç‹¬ç»´æŠ¤ä¸€ä¸ªæ¸¸æˆçš„æ›´æ–°ã€ç™»å½•ç”¨ä¾‹ï¼Œä¿è¯è¿™ä¸ªç”¨ä¾‹çš„ç¨³å®šæ€§<ul>
<li>ç™»å½•è¿›æ¸¸ç”¨ä¾‹æ˜¯å®é™…æµ‹è¯•ç”¨ä¾‹çš„åŸºç¡€ï¼Œå¦‚æœç™»é™†è¿›æ¸¸å¤±è´¥ä¼šç›´æ¥å¯¼è‡´æµ‹è¯•ç”¨ä¾‹æ— æ³•æ‰§è¡Œ</li>
<li>ç”¨å°½å¯èƒ½ä¿å®ˆçš„é€»è¾‘è§¦è¾¾æ¯ä¸ªåˆ†æ”¯ï¼Œæ¯”å¦‚å¯¹äºæ‹‰èµ·ç¬¬ä¸‰æ–¹<code>app</code>ç™»å½•çš„è¿‡ç¨‹ï¼Œæ¯ä¸€æ­¥éƒ½è€ƒè™‘å»ºç«‹å¤šæ¬¡é‡è¯•çš„æœºåˆ¶ã€‚æ—¶é—´ä¸æ˜¯é—®é¢˜ï¼ŒæˆåŠŸç‡æ‰æ˜¯é—®é¢˜ã€‚</li>
</ul>
</li>
<li>æµ‹è¯•è´¦å·éœ€è¦å®æ—¶ç»´æŠ¤ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦è€ƒé‡ç»´æŠ¤çš„æˆæœ¬<ul>
<li>å¦‚æœæµ‹è¯•è´¦å·é‡å¤§ï¼Œä½†å› ä¸ºæ¸¸æˆæ–°ç‰¹æ€§å‘å¸ƒå¯¼è‡´å„ç§å¼¹çª—çš„å‡ºç°ï¼Œå¯ä»¥ç»Ÿä¸€åœ¨æµ‹è¯•ç”¨ä¾‹çš„<code>setup</code>æ­¥éª¤ä¸­æŠ½è±¡å‡ºæ¥ï¼Œä»è€Œè§£å†³åŒç±»é—®é¢˜</li>
<li>å¦‚æœæ¸¸æˆæœ‰è´¦å·æ•°æ®å¤åˆ¶è¿™ä¸€æœºåˆ¶çš„æ”¯æŒï¼Œå¯ä»¥ä¼˜å…ˆç”¨æ¥ä¿è¯ç©å®¶èƒ½å¤Ÿå¿«é€Ÿè¾¾åˆ°ç”¨ä¾‹æ‰§è¡Œçš„å‰ç½®çŠ¶æ€</li>
</ul>
</li>
</ul>
<h2 id="ç”¨ä¾‹è„šæœ¬æ‰§è¡Œ"><a href="#ç”¨ä¾‹è„šæœ¬æ‰§è¡Œ" class="headerlink" title="ç”¨ä¾‹è„šæœ¬æ‰§è¡Œ"></a>ç”¨ä¾‹è„šæœ¬æ‰§è¡Œ</h2><p>ç”¨ä¾‹è„šæœ¬æ‰§è¡ŒæœŸé—´çš„ç¨³å®šæ€§ï¼Œæ˜¯è‡ªåŠ¨åŒ–ä¸šåŠ¡é€»è¾‘ä¿è¯çš„ã€‚é™¤å»ä»£ç è´¨é‡å¤–ï¼Œåˆé€‚çš„è‡ªåŠ¨åŒ–æµç¨‹å’Œä»£ç è®¾è®¡ï¼Œæ˜¯ä¿è¯è‡ªåŠ¨åŒ–ç¨³å®šæ€§çš„æ ¹æœ¬ã€‚<br>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDkvMDQvZ2FtZW9mYXV0b3Rlc3QvaWlpLw==" title="https://utmhikari.top/2022/09/04/gameofautotest/iii/">æ¡†æ¶è®¾è®¡<i class="fa fa-external-link"></i></span>ä¸€æ–‡å½“ä¸­ï¼Œç¬”è€…å¼ºè°ƒäº†è¡Œä¸ºé©±åŠ¨å¯¹äºè‡ªåŠ¨åŒ–å¼€å‘çš„é‡è¦æ€§ï¼Œé€šè¿‡å¯¹è¡Œä¸ºå±‚é¢çš„æŠ½è±¡ï¼Œç”¨ä¾‹å¼€å‘è€…ä¸å¿…å…³å¿ƒè¡Œä¸ºçš„å…·ä½“å®ç°ï¼Œåªéœ€ç»„è£…ç©å®¶è¡Œä¸ºï¼Œå³å¯å®ç°è‡ªåŠ¨åŒ–æµç¨‹ã€‚å› æ­¤ï¼Œè¡Œä¸ºåº“ï¼Œä½œä¸ºè‡ªåŠ¨åŒ–é€»è¾‘çš„åŸºç¡€ï¼Œæ˜¯å½±å“è‡ªåŠ¨åŒ–ç¨³å®šæ€§çš„å…³é”®ã€‚</p>
<p>è‡ªåŠ¨åŒ–è¡Œä¸ºå¯ä»¥é€šè¿‡è„šæœ¬é©±åŠ¨å’ŒUIé©±åŠ¨å®ç°ã€‚è‡³äºå¦‚ä½•æå‡è¡Œä¸ºå®ç°çš„ç¨³å®šæ€§ï¼Œè¿™é‡Œå°±ç»™å‡ºå‡ ä¸ªtipså¯ä»¥å‚è€ƒï¼š</p>
<ul>
<li>è„šæœ¬è‡ªåŠ¨åŒ–<ul>
<li>åœ¨å®¢æˆ·ç«¯æ¸¸æˆä»£ç ä¸­æŠ½è±¡ä¸€å±‚è‡ªåŠ¨åŒ–ä¸“å±æ¨¡å—ï¼Œç”¨äºæ•´åˆåŸºç¡€å¸¸ç”¨çš„æ¸¸æˆæ¥å£<ul>
<li>å®¢æˆ·ç«¯å¼€å‘çš„ç›®æ ‡æ˜¯ä»¿çœŸï¼Œè€ŒéåŸå­ä¸²è¡Œåœ°æ‰§è¡Œç©å®¶è¡Œä¸ºï¼Œå› æ­¤å®¢æˆ·ç«¯è®¸å¤šåŸç”Ÿæ¥å£çš„å®ç°æ˜¯è¢«åŠ¨å“åº”å¼çš„ï¼Œä¸ä¸€å®šç›´æ¥æ»¡è¶³è‡ªåŠ¨åŒ–ä¸»åŠ¨æ‰§è¡Œçš„éœ€æ±‚</li>
<li>æ¸¸æˆæ¥å£è°ƒç”¨å°½é‡æŒ‘ä¸šåŠ¡åº•å±‚æ¨¡å—çš„ï¼Œä¸€èˆ¬æ¥å£åä¸ä¼šæœ‰å¤ªå¤šå˜åŒ–ï¼Œå‡å°‘è‡ªåŠ¨åŒ–ä¸“å±æ¨¡å—çš„ç»´æŠ¤é‡</li>
<li>æŠ½è±¡è‡ªåŠ¨åŒ–ä¸“å±æ¨¡å—ï¼ŒåŒæ—¶å¯ä»¥è®©è‡ªåŠ¨åŒ–é€»è¾‘æ›´åŠ å¯æ§ï¼Œé˜²æ­¢å¼€å‘é¢‘ç¹ä¿®æ”¹æ¸¸æˆæ¥å£å®ç°å¯¼è‡´çš„ä¸ç¨³å®šæ€§</li>
</ul>
</li>
<li>åœ¨æ¡†æ¶ä»£ç ä¸­ï¼ŒåŸºäºæ¸¸æˆè‡ªåŠ¨åŒ–æ¨¡å—å†æŠ½è±¡ä¸€ä¸ªæ¥å£å±‚ï¼Œåœ¨æ¥å£å®ç°é‡Œç»„è£…ä»£ç å’Œå‚æ•°<ul>
<li>éœ€è¦å®ç°ä¸€ä¸ªé€šç”¨æ–¹æ³•ï¼Œå°†æ¡†æ¶è¿è¡Œæ—¶çš„æ•°æ®å¯¹è±¡è½¬åŒ–æˆæ¸¸æˆè„šæœ¬ä»£ç çš„è¡¨è¾¾å½¢å¼</li>
<li>æ•ˆæœä¸Šï¼Œç”¨ä¾‹å¼€å‘è€…æ— éœ€å…³å¿ƒä»£ç ç»„è£…é€»è¾‘ï¼Œè¿›ä¸€æ­¥å‡å°‘è„šæœ¬é©±åŠ¨é€»è¾‘å¼€å‘éš¾åº¦ï¼Œæå‡ä»£ç æ˜“è¯»æ€§</li>
</ul>
</li>
</ul>
</li>
<li>UIè‡ªåŠ¨åŒ–<ul>
<li>å¦‚æœæ§ä»¶åç§°æˆ–è€…æ§ä»¶æ–‡æœ¬è¾ƒä¸ºç‹¬ç‰¹å”¯ä¸€ï¼Œä¼˜å…ˆç”¨æ§ä»¶åç§°æˆ–æ–‡æœ¬ä½œä¸ºUIçš„ç­›é€‰æ¡ä»¶<ul>
<li>å¦‚æœæ˜¯åŠ¨æ€ç”Ÿæˆçš„æ§ä»¶ï¼Œä»¥<code>UE4</code>ä¸ºä¾‹ï¼Œæ§ä»¶åä¼šæœ‰IDåç¼€ï¼Œå› æ­¤ä¸èƒ½é‡‡å–å…¨æ–‡åŒ¹é…ï¼Œå¯ä»¥ç”¨å…³é”®å­—åŒ¹é…</li>
</ul>
</li>
<li>å¦‚æœæ˜¯å®¹å™¨å†…ï¼ˆå¦‚åˆ—è¡¨ï¼‰çš„ä¸€æ‰¹æ§ä»¶ï¼Œæ§ä»¶å/æ–‡æœ¬éƒ½ç›¸åŒï¼Œéœ€è¦ç­›é€‰å…¶ä¸­ä¸€ä¸ªçš„è¯ï¼Œå¯ä»¥é€šè¿‡å­æ§ä»¶çš„ç‹¬ç‰¹æ€§æ¥ç­›é€‰<ul>
<li>æ¸¸æˆè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œæ§ä»¶ä¹‹é—´çš„å±‚çº§å…³ç³»ä¸€èˆ¬ä¸ä¼šæœ‰å¤ªå¤§çš„å˜åŒ–ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å­æ§ä»¶ç­›é€‰æ¥åæ¨çˆ¶æ§ä»¶ï¼Œå¹¶ä¸”è¿™ç§é€»è¾‘ç»´æŠ¤èµ·æ¥ä¹Ÿæ¯”è¾ƒæ–¹ä¾¿</li>
</ul>
</li>
<li>å¯¹äºåŒ…å«å›¾åƒçš„æ§ä»¶ï¼Œä¼˜å…ˆç”¨å›¾åƒèµ„æºè·¯å¾„çš„å…³é”®å­—è¿›è¡ŒåŒ¹é…ï¼Œå†æ¬¡ä¹‹ç”¨å›¾åƒè¯†åˆ«<ul>
<li>èµ„æºè·¯å¾„çš„å…³é”®å­—ç‰¹å¾é€šå¸¸è¾ƒæ˜æ˜¾ï¼Œå®é™…ä½¿ç”¨æ—¶ä¹Ÿé€šå¸¸èƒ½ç­›é€‰å‡ºå±å¹•ä¸­å”¯ä¸€çš„é‚£ä¸€ä¸ª</li>
<li>å›¾åƒè¯†åˆ«æ–¹æ¡ˆï¼Œä¸€æ¥ä¼šè¢«å›¾åƒè¯†åˆ«æŠ€æœ¯æœ¬èº«çš„ä¸ç¨³å®šæ€§å½±å“ï¼›äºŒæ¥æ¸¸æˆè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œç›¸å¯¹äºæ§ä»¶/èµ„æºåçš„å…³é”®å­—å˜åŒ–ï¼ŒUIæ ·å¼å˜åŒ–ä¼šæ¥çš„å¤šï¼Œä½†å›¾åƒè¯†åˆ«æ–¹æ¡ˆæ˜¯ä¸èƒ½æ¥å—UIæ ·å¼å˜åŒ–çš„ã€‚å› æ­¤ï¼Œå¦‚æœéœ€è¦å¤§è§„æ¨¡ä½¿ç”¨UIè‡ªåŠ¨åŒ–æƒ…å†µä¸‹ï¼Œå›¾åƒè¯†åˆ«æ–¹æ¡ˆéœ€è¦è°¨æ…é€‰æ‹©ã€‚</li>
</ul>
</li>
<li>é€šè¿‡æ§ä»¶æ ‘å‰åæ˜¯å¦å˜åŒ–ï¼Œåˆ¤æ–­UIæ“ä½œæ˜¯å¦ç”Ÿæ•ˆï¼Œå¹¶æŠ½è±¡é‡è¯•æœºåˆ¶ï¼Œæå‡UIè‡ªåŠ¨åŒ–çš„å®¹é”™æ€§</li>
<li>ä¸ç›´æ¥ç”¨æ§ä»¶IDã€æ§ä»¶åæ ‡ç­›é€‰æ§ä»¶ï¼Œå› ä¸ºæ— æ³•ç›´æ¥å…¼å®¹åˆ°å…¶ä»–æœºå™¨</li>
</ul>
</li>
</ul>
<p>è¿™äº›tipsï¼Œå³ä¾¿æ˜¯åœ¨è‡ªåŠ¨åŒ–ä¸šåŠ¡é€»è¾‘é‡Œï¼Œéœ€è¦å®ç°ä¸€äº›æ¸¸æˆè¡Œä¸ºçš„åœºæ™¯ä¸‹ï¼Œä¹Ÿéƒ½æ˜¯é€šç”¨çš„ã€‚</p>
<p>åœ¨è¡Œä¸ºåº“ä¸€å±‚ä¹‹ä¸Šï¼Œè‡ªåŠ¨åŒ–ä¸šåŠ¡é€»è¾‘çš„ç¨³å®šæ€§ï¼Œå…¶å®å¤šå–å†³äºæµ‹è¯•ä¸šåŠ¡æœ¬èº«çš„å¤æ‚åº¦ï¼Œä»¥åŠç”¨ä¾‹å¼€å‘è€…çš„ä¸šåŠ¡ç†è§£è·Ÿç¼–ç æ°´å¹³ã€‚åœ¨è¿™é‡Œï¼Œå°±éœ€è¦è€ƒè™‘è‡ªåŠ¨åŒ–ä¸šåŠ¡é€‰å‹å’Œæµç¨‹è®¾è®¡äº†ã€‚ä¸ºäº†è§„é¿å¯èƒ½çš„ä¸ç¨³å®šæ€§ï¼Œå‘æŒ¥è‡ªåŠ¨åŒ–æŠ€æœ¯çš„ä»·å€¼ï¼Œè¿™é‡Œä¹Ÿæœ‰å‡ ä¸ªtipså¯ä»¥å‚è€ƒï¼š</p>
<ul>
<li>é€‰æ‹©æ“ä½œä¸å¤æ‚ï¼Œä½†éå†é‡å¤§çš„åœºæ™¯ï¼Œå®ç°è‡ªåŠ¨åŒ–éå†</li>
<li>é€‰æ‹©äººå·¥æµ‹è¯•æ“ä½œå¤æ‚ï¼Œä½†å¯ä»¥é€šè¿‡ç›´æ¥å’Œæ¸¸æˆç¨‹åºè¿è¡Œæ—¶äº¤äº’å»æ”¶é›†æ•°æ®/æ‰§è¡Œæµ‹è¯•çš„åœºæ™¯ï¼Œå®ç°è‡ªåŠ¨åŒ–éå†</li>
<li>åœ¨åŒæ—¶æœ‰å¤šä¸ªæµ‹è¯•ç‚¹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæµ‹è¯•ç‚¹æ‰§è¡Œè¿‡åï¼Œéœ€è¦æœ‰æ‰§è¡Œå¤±è´¥çš„å…œåº•é€»è¾‘ï¼Œæ¢å¤ç©å®¶çŠ¶æ€ï¼Œä»è€Œèƒ½ç»§ç»­æµ‹è¯•<ul>
<li>å¦‚æœå…œåº•æ–¹å¼ä¸æ˜ç¡®ï¼Œå¯è€ƒè™‘è®¾è®¡æˆèƒ½å¤Ÿä¸²è¡Œæ‰§è¡Œ+<code>fast-fail</code>ç«‹å³ç»ˆæ­¢çš„å½¢å¼</li>
<li>é€šè¿‡é…ç½®é©±åŠ¨æ¥åŠ¨æ€å†³å®šå“ªäº›æµ‹è¯•ç‚¹éœ€è¦æ‰§è¡Œ</li>
</ul>
</li>
<li>ä¸šåŠ¡åŠŸèƒ½è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªç”¨ä¾‹å°½é‡åªä¸“æ³¨äºä¸€ç±»æµ‹è¯•ç‚¹ï¼Œä¸è¦åœ¨è‡ªåŠ¨åŒ–æµç¨‹æœŸé—´éªŒè¯å¾ˆå¤šåˆ†æ”¯æµ‹è¯•ç‚¹<ul>
<li>ä¼šå¼•èµ·ç”¨ä¾‹ä»£ç é‡è¿‡å¤§ï¼Œé€»è¾‘å¤æ‚ï¼Œéš¾ä»¥ç»´æŠ¤</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•æ— æ³•ä»£æ›¿åŠŸèƒ½æµ‹è¯•å…¨éƒ¨å†…å®¹ï¼ŒçœŸæ­£ä»£æ›¿çš„æ˜¯æµ‹è¯•äººåŠ›ï¼Œéœ€è¦å¼ºè°ƒä¸‹è¿™ä¸ªæ€è·¯</li>
</ul>
</li>
</ul>
<h2 id="åç½®æ¢å¤æ“ä½œ"><a href="#åç½®æ¢å¤æ“ä½œ" class="headerlink" title="åç½®æ¢å¤æ“ä½œ"></a>åç½®æ¢å¤æ“ä½œ</h2><p>è‡ªåŠ¨åŒ–ç”¨ä¾‹çš„åç½®æ¢å¤æ“ä½œï¼Œå¯¹è‡ªåŠ¨åŒ–æ•´ä¸ªæµç¨‹çš„ç¨³å®šæ€§å½±å“ä¸æ˜¯ç‰¹åˆ«å¤§ã€‚è¿™éƒ¨åˆ†ï¼Œåªæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>å¯¹äºæœ‰å‰åç»§å…³ç³»çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæ¯ä¸ªç”¨ä¾‹çš„åç½®æ¢å¤æ“ä½œï¼Œéœ€è¦å’Œå…ˆå‰æ‰€è¿°ä¸€æ ·ï¼Œå®è´¨æ˜¯ä¸€ä¸ªå¤±è´¥å…œåº•é€»è¾‘ï¼Œä¿è¯ç©å®¶çŠ¶æ€æ¢å¤æ­£å¸¸ï¼Œæˆ–è€…è¾¾åˆ°èƒ½ç›´æ¥æ£€æµ‹åˆ°<code>fast-fail</code>çš„å½¢å¼</li>
<li>å¯¹äºå•ä¸ªæœºå™¨è¿è¡Œå¤šä¸ªç”¨ä¾‹çš„æƒ…å†µï¼Œä¿è¯æœºå™¨èƒ½å¤Ÿç¨³å®šæ¢å¤åˆ°æœªè£…æ¸¸æˆä¹‹å‰çš„çŠ¶æ€å³å¯</li>
</ul>
<h2 id="æµ‹è¯•æŠ¥å‘Šè¾“å‡º"><a href="#æµ‹è¯•æŠ¥å‘Šè¾“å‡º" class="headerlink" title="æµ‹è¯•æŠ¥å‘Šè¾“å‡º"></a>æµ‹è¯•æŠ¥å‘Šè¾“å‡º</h2><p>æµ‹è¯•æŠ¥å‘Šæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„é‡è¦éƒ¨åˆ†ï¼Œåªæœ‰æµ‹è¯•æŠ¥å‘Šæ‰èƒ½å¤Ÿè¯æ˜è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯æœ‰æ•ˆçš„ã€‚å› æ­¤ï¼Œèƒ½ä¿éšœæµ‹è¯•æŠ¥å‘Šçš„æœ‰æ•ˆæ€§ï¼Œä¹Ÿå°±å¯ä»¥ä¿éšœè‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šç¯èŠ‚çš„æ‰§è¡Œç¨³å®šæ€§ã€‚</p>
<p>å¯¹äºæµ‹è¯•æŠ¥å‘Šçš„æ•´åˆè¾“å‡ºè¿‡ç¨‹ï¼Œæœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>ä¸€ä»½æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–æŠ¥å‘Šï¼Œåº”å½“èšç„¦äºè‡ªåŠ¨åŒ–çš„æµ‹è¯•ç›®æ ‡ï¼Œæœ€ä¼˜å…ˆæ˜¯ç”¨ç¨‹åºåˆ†æçš„æ–¹å¼ç›´æ¥ç»™å‡ºç»“è®ºï¼Œå†æ¬¡åˆ™ç»™å‡ºä¸€ç³»åˆ—æœ‰ç”¨çš„æ•°æ®/æˆªå›¾/å½•å±åˆ°äººå·¥äºŒæ¬¡æ’æŸ¥<ul>
<li>é’ˆå¯¹ä¸šåŠ¡åŠŸèƒ½çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæµ‹è¯•çš„å¯¹è±¡ä¸æ˜¯ç¨‹åºæœ¬èº«ï¼Œè€Œæ˜¯åŸºäºäººç±»çš„ä¸šåŠ¡è®¾è®¡å’Œæµ‹è¯•ç»éªŒã€‚è¿™ç§æƒ…å†µä¸‹å¼ºæ±‚ç”¨ç¨‹åºåˆ†æé”™è¯¯æ ¹å› ä¸ç°å®ï¼Œä»å®ç”¨è§’åº¦æ¥è®²ï¼Œåº”è¯¥è¦ç»Ÿä¸€åšæˆæ•°æ®å‘ˆç°+äººå·¥æ’æŸ¥çš„<code>åŠè‡ªåŠ¨åŒ–</code>å½¢å¼ã€‚</li>
<li>éœ€è¦åšåˆ°çš„æ•ˆæœæ˜¯ï¼Œå¦‚æœè‡ªåŠ¨åŒ–æŠ¥å‘Šä¼šè¢«æ ‡æ³¨ä¸ºæˆåŠŸï¼Œé‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸€å®šè¢«ä¿¡ä»»çš„ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å‘ç°é—®é¢˜ã€‚åªæœ‰æ ‡æ³¨å¤±è´¥çš„ç”¨ä¾‹ï¼Œæ‰éœ€è¦åšäººå·¥ä»‹å…¥ã€‚</li>
</ul>
</li>
<li>è‡ªåŠ¨åŒ–è¿‡ç¨‹è€—æ—¶è¾ƒé•¿ï¼Œä¸å¯é¿å…ä¼šå› ä¸ºå´©æºƒã€è®¾å¤‡æ–­çº¿ç­‰åŸå› ï¼Œå‡ºç°ç”¨ä¾‹æ‰§è¡Œä¸­é€”æ–­æ‰çš„æƒ…å†µã€‚å› æ­¤è‡ªåŠ¨åŒ–ä¸šåŠ¡é€»è¾‘éœ€è¦æœ‰æ ¹æ®å·²æœ‰æŠ¥å‘Šå­˜æ¡£ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­å¿½ç•¥å·²æµ‹è¯•å†…å®¹çš„æœºåˆ¶ï¼Œä»è€Œé¿å…å†—ä½™æµ‹è¯•çš„æƒ…å†µã€‚<ul>
<li>è¿™ç§æœºåˆ¶ä¸‹ï¼Œå¯ä»¥æ»¡è¶³æµ‹è¯•ç”¨ä¾‹éšæ—¶åœæ­¢é‡å¯çš„éœ€æ±‚ï¼Œä¸åŒæµ‹è¯•ç”¨ä¾‹çš„æŠ¥å‘Šå¯ä»¥éšæ—¶åˆå¹¶ï¼Œæˆä¸ºæ±‡æ€»çš„æŠ¥å‘Šå†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<p>è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šä¸€èˆ¬éœ€è¦æŒä¹…åŒ–ä¿å­˜ï¼Œå¯¹äºä¸€äº›è€—æ—¶è¾ƒé•¿ã€è¾“å‡ºæˆªå›¾/å½•å±é‡è¾ƒå¤§çš„ç”¨ä¾‹ï¼Œç”¨<strong>å¯¹è±¡å­˜å‚¨</strong>æ˜¯æœ€é€‚åˆåšæŠ¥å‘ŠæŒä¹…åŒ–çš„ã€‚</p>
<p>åœ¨ä¸šåŠ¡åŠŸèƒ½è‡ªåŠ¨åŒ–æµ‹è¯•é¢†åŸŸï¼Œå¯¹äºå¤§è§„æ¨¡å†’çƒŸç›‘æ§çš„åœºæ™¯ï¼Œéœ€è¦è€ƒè™‘åˆ°æµ‹è¯•æŠ¥å‘Šåˆ†æçš„äººåŠ›æˆæœ¬ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒæŠ¥å‘Šåˆ†ææˆæœ¬å’Œè‡ªåŠ¨åŒ–æ‰§è¡Œçš„æ—¶é—´æ˜¯æˆæ­£æ¯”çš„ï¼Œå› æ­¤ï¼Œå¦‚æœè‡ªåŠ¨åŒ–æµ‹è¯•é€šå…¥çš„äººåŠ›ä¸å¤šï¼Œéœ€è¦é…Œæƒ…æ§åˆ¶è‡ªåŠ¨åŒ–æµ‹è¯•çš„è§„æ¨¡ï¼Œé˜²æ­¢æ— æ„ä¹‰çš„äººåŠ›æˆæœ¬æ¶ˆè€—ï¼Œå¯¼è‡´æ²¡æœ‰æ›´å¤šçš„æ—¶é—´å»ç»´æŠ¤å·²æœ‰ç”¨ä¾‹çš„ç¨³å®šæ€§ï¼Œæˆ–è€…å¼€å‘æ–°åœºæ™¯çš„ç”¨ä¾‹ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç¨³å®šæ€§ï¼Œä½œä¸ºä¸€ä¸ªé‡ç‚¹é—®é¢˜ï¼Œå…¶è§£å†³æ–¹æ¡ˆï¼Œå¹¶éä¸€è¨€ä»¥è”½ä¹‹çš„å›ºå®šå¥—è·¯ï¼Œè€Œæ›´å¤šæ˜¯æŠ€æœ¯ç»†èŠ‚çš„ç´¯ç§¯ï¼Œä»¥åŠæµ‹è¯•å·¥ä½œè€…å®äº‹æ±‚æ˜¯çš„åˆ†æã€‚æœ¬æ–‡ä¸»è¦ä»ç¬”è€…å·¥ä½œç»éªŒå‡ºå‘ï¼Œè®²è¿°ä¸€ç§ä¿éšœæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ç¨³å®šæ€§çš„æ–¹æ³•ï¼Œå¸Œæœ›å„ä½è¯»è€…/åŒè¡Œèƒ½å¤Ÿé€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œå¯¹äº<code>è‡ªåŠ¨åŒ–æµ‹è¯•ç¨³å®šæ€§</code>è¿™ä¸€å‘½é¢˜ï¼Œæ‹¥æœ‰æ›´æ–°çš„ç†è§£ã€‚</p>
]]></content>
      <categories>
        <category>Game Of AutoTest</category>
      </categories>
      <tags>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>ç¨³å®šæ€§</tag>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘PyQt5çš„QListViewå…¼å®¹å·¦é”®åŒå‡»äº‹ä»¶å’Œå³é”®ä¸Šä¸‹æ–‡èœå•çš„æ–¹æ³•</title>
    <url>/2022/10/02/pythonnotes/pyqt_listview_fileviewer/</url>
    <content><![CDATA[<p>è¿‘æœŸç¬”è€…å› å·¥ä½œåŸå› ï¼Œéœ€è¦åšä¸€ä¸ªå®‰å“æ‰‹æœºçš„æ–‡ä»¶æµè§ˆåŠŸèƒ½ï¼Œé›†æˆåœ¨ç¬”è€…ä»¥å‰ç”¨<code>PyQt5</code>åšçš„ä¸€ä¸ªçš„å·¥å…·å½“ä¸­ã€‚æ–‡ä»¶æµè§ˆåŠŸèƒ½å¤§æ¦‚åšæˆè¿™æ ·ï¼š</p>
<ul>
<li>ä¸€ä¸ªåˆ—è¡¨ç•Œé¢ï¼Œåˆ—å‡ºæŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åï¼ˆä¸åŒºåˆ†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼‰</li>
<li>åŒå‡»æŸä¸ªæ–‡ä»¶åï¼Œå°è¯•è¿›å…¥è¿™ä¸ªæ–‡ä»¶åä»£è¡¨çš„æ–‡ä»¶å¤¹ï¼ˆæ–‡ä»¶çš„æƒ…å†µä¼šå¤±è´¥ï¼‰</li>
<li>å³é”®æŸä¸ªæ–‡ä»¶åï¼Œå¼¹å‡ºä¸Šä¸‹æ–‡èœå•ï¼Œå¯ä»¥è¿›å…¥è¿™ä¸ªæ–‡ä»¶åå¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œä¹Ÿå¯ä»¥å¤åˆ¶è·¯å¾„åˆ°å…¶ä»–çš„è¾“å…¥æ¡†</li>
</ul>
<p>å…¶ä¸­ï¼Œæ–‡ä»¶åˆ—è¡¨é€‰å‹ç”¨äº†<code>QListView</code>ç»„ä»¶ï¼Œä½†åœ¨å®ç°å…¼å®¹åŒå‡»è¿›å…¥æ–‡ä»¶å¤¹+å³é”®èœå•åŠŸèƒ½æ—¶ï¼Œç¨å¾®è¸©äº†ä¸‹å‘ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¬”è€…åœ¨ç½‘ä¸ŠæŸ¥é˜…äº†è®¸å¤šèµ„æ–™ï¼Œæœ€åæ‰¾åˆ°ä¸€ç§è§£å†³æ–¹æ³•ï¼Œå†³å®šè®°å½•äºæœ¬æ–‡å½“ä¸­ã€‚</p>
<p>é¦–å…ˆéœ€è¦äº†è§£ï¼Œ<code>Qt</code>å¯¹äº<code>QListView</code>è¿™ç±»æ•°æ®å®¹å™¨ç»„ä»¶ï¼Œæ˜¯éµå¾ª<code>MVC</code>çš„è®¾è®¡æ¨¡å¼çš„ã€‚<code>QListView</code>æ•°æ®çš„åˆå§‹åŒ–ï¼Œæ–¹æ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">data = [<span class="string">'1'</span>, <span class="string">'2'</span>, <span class="string">'3'</span>]</span><br><span class="line">model = QStringListModel()</span><br><span class="line">model.setStringList(data)</span><br><span class="line">listview = QListView()</span><br><span class="line">listview.setModel(model)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯<code>data -&gt; model -&gt; view</code>è¿™æ ·çš„å…³ç³»å‘ˆç°ã€‚</p>
<p>è¦è®©<code>listview</code>åŒæ—¶æ”¯æŒåŒå‡»å’Œå³é”®äº‹ä»¶ï¼Œå¸¸è§çš„æƒ³æ³•æ˜¯ç”¨<code>doubleClicked</code>ã€<code>clicked</code>ä¹‹ç±»çš„<code>signal</code>å»<code>connect</code>å¯¹åº”çš„äº‹ä»¶å§”æ‰˜ã€‚ä½†è¿™é‡Œæœ‰ä¸€ä¸ªè¯¯åŒºï¼š<code>clicked</code>æœ‰<code>connect</code>äº‹ä»¶å§”æ‰˜è¿™ç§æƒ…å†µä¸‹ï¼Œä¸è®ºåœ¨<code>listview</code>é‡Œå•å‡»é¼ æ ‡å·¦é”®æˆ–è€…å•å‡»å³é”®ï¼Œéƒ½èƒ½è§¦å‘é¼ æ ‡å•å‡»äº‹ä»¶ï¼Œè€Œå¦‚æœåŒæ—¶<code>connect</code>äº†<code>doubleClicked</code>çš„å§”æ‰˜ï¼Œ<code>doubleClicked</code>çš„å§”æ‰˜ä¼šæ— æ³•æ‰§è¡Œã€‚è¿™æ ·çš„è¯ï¼Œå°±æ— æ³•åŒæ—¶æ»¡è¶³å·¦é”®åŒå‡»å’Œå³é”®ä¸Šä¸‹æ–‡èœå•åŠŸèƒ½ã€‚</p>
<p>çœ‹ä¼¼è¿™ä¸ªé—®é¢˜æ— æ³•è§£å†³ï¼Œå®é™…ä¸Š<code>Qt</code>è¿˜æ˜¯ç»™å¼€å‘è€…ç•™ä¸‹äº†ä¸€ä¸ªåé—¨â€”â€”<code>QWidget</code>æœ¬èº«æœ‰ä¸€ä¸ª<code>setContextMenuPolicy</code>æ¥å£å»è®¾ç½®ä¸Šä¸‹æ–‡èœå•ç­–ç•¥ï¼Œè€Œè¿™ä¸ªä¸Šä¸‹æ–‡èœå•å°±æ˜¯å³é”®è§¦å‘çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»‘å®š<code>doubleClicked</code>äº‹ä»¶å§”æ‰˜ï¼ŒåŒæ—¶<code>setContextMenuPolicy</code>ä¸ºè‡ªå®šä¹‰èœå•æ¨¡å¼<code>CustomContextMenu</code>ï¼Œå¹¶ç»‘å®š<code>customContextMenuRequested</code>è¿™ä¸ª<code>signal</code>åˆ°ä¸€ä¸ªè‡ªåŠ¨å¼¹å‡ºä¸Šä¸‹æ–‡èœå•çš„æ–¹æ³•ï¼Œå°±å¯ä»¥äº‹ä»¶å·¦é”®åŒå‡»äº‹ä»¶å’Œå³é”®ä¸Šä¸‹æ–‡èœå•çš„å…¼å®¹äº†ã€‚</p>
<p>ä»£ç æ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_double_clicked</span><span class="params">(idx)</span>:</span></span><br><span class="line">    <span class="comment"># idxä¸ºQModelIndexç±»å‹ï¼Œé€šè¿‡rowæ–¹æ³•è·å–æ•°æ®ç´¢å¼•å€¼</span></span><br><span class="line">    print(<span class="string">f'triggered double-click -&gt; <span class="subst">&#123;data[idx.row()]&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_trigger_menu_action</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># é€šè¿‡selectedIndexesæ–¹æ³•å¯ä»¥è·å¾—ç‚¹ä¸­çš„æ‰€æœ‰é¡¹</span></span><br><span class="line">    selected_indexes = listview.selectedIndexes()</span><br><span class="line">    <span class="keyword">if</span> len(selected_indexes) &gt; <span class="number">0</span>:</span><br><span class="line">        data_idx = selected_indexes[<span class="number">0</span>].row()</span><br><span class="line">        print(<span class="string">f'triggered context menu -&gt; <span class="subst">&#123;data[data_idx]&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_custom_context_menu_requested</span><span class="params">(pos)</span>:</span></span><br><span class="line">    ctx_menu = QtGui.QMenu()</span><br><span class="line">    menu_action = popMenu.addAction(<span class="string">'æ‰“å°ä¿¡æ¯'</span>)</span><br><span class="line">    menu_action.triggered.connect(on_trigger_menu_action)</span><br><span class="line">    ctx_menu.exec_(QtGui.QCursor.pos())  <span class="comment"># ç”±å½“å‰é¼ æ ‡ä½ç½®å¼¹å‡ºèœå•</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">listview.doubleClicked.connect(on_double_clicked)</span><br><span class="line">listview.setContextMenuPolicy(Qt.CustomContextMenu)</span><br><span class="line">listview.customContextMenuRequested.connect(on_custom_context_menu_requested)</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>doubleClicked</code>çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡ä¼ å‚çš„<code>QModelIndex</code>å®ä¾‹ç›´æ¥è·å–æ•°æ®çš„ç´¢å¼•å€¼ï¼Œä»è€Œæ‹¿åˆ°æ•°æ®ï¼›åœ¨<code>customContextMenuRequested</code>çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€šè¿‡<code>listview</code>çš„<code>selectedIndexes</code>è·å–æ‰€æœ‰é€‰ä¸­é¡¹çš„<code>QModelIndex</code>ï¼Œè¿›è€Œä¹Ÿæ˜¯é€šè¿‡<code>row</code>æ¥å£ï¼Œå°±å¯ä»¥çŸ¥é“å“ªä¸ªä¸‹æ ‡çš„æ•°æ®è¢«é€‰ä¸­äº†ã€‚</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>PyQt5</tag>
        <tag>QListView</tag>
        <tag>Qt</tag>
        <tag>ä¸Šä¸‹æ–‡èœå•</tag>
        <tag>MVC</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘GAutomatorå®‰å“UE4ç‰ˆæœ¬çš„å®ç°æœºç†ä¸ä¼˜åŒ–å®æˆ˜</title>
    <url>/2022/09/12/testlife/gautomator_ue4_android/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjAvMDUvMDUvdGVzdGxpZmUvdHJ5X2dhdXRvbWF0b3Iv" title="https://utmhikari.top/2020/05/05/testlife/try_gautomator/">2å¹´ä»¥å‰çš„ä¸€ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­ï¼Œè®²è¿°äº†æ¸¸æˆUIè‡ªåŠ¨åŒ–æ–¹æ¡ˆ<code>GAutomator</code>çš„åŸºç¡€æœºç†ã€ä½¿ç”¨æ–¹å¼å’Œä¸€äº›å·¥å…·æ‰©å±•çš„æƒ³æ³•ã€‚ä»Šå¤©ï¼Œè¶ç€<code>Game Of AutoTest</code>ç³»åˆ—çš„è¿è½½ï¼Œç»“åˆ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDgvMTMvZ2FtZW9mYXV0b3Rlc3QvaWkv" title="https://utmhikari.top/2022/08/13/gameofautotest/ii/">æ¸¸æˆè‡ªåŠ¨åŒ–æŠ€æœ¯é€‰å‹<i class="fa fa-external-link"></i></span>ä¸€æ–‡ï¼Œç¬”è€…å°†æ·±å…¥å‰–æ<code>GAutomator</code>ä½œä¸º<code>UE4</code>å®‰å“æ¸¸æˆUIè‡ªåŠ¨åŒ–æ–¹æ¡ˆçš„å®ç°æœºç†ï¼Œä»¥åŠè‡ªå·±åœ¨å®é™…å·¥ä½œä¸­å¯¹<code>GAutomator</code>çš„ä¼˜åŒ–å®è·µã€‚</p>
<h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><p><code>GAutomator</code>æ˜¯è¿™æ ·çš„è°ƒç”¨é“¾è·¯ï¼š</p>
<a id="more"></a>
<ul>
<li>PCå’Œæ‰‹æœºçš„è¿é€š <ul>
<li><code>GAutomator</code>æ’ä»¶è¢«å¯ç”¨ç¼–è¯‘ï¼Œå¯åŠ¨æ—¶åœ¨æ‰‹æœºå†…å¯åŠ¨ä¸€ä¸ª<code>tcp-server</code></li>
<li>PCç«¯<code>GAClient</code>é€šè¿‡<code>adb forward</code>è½¬å‘ç«¯å£ï¼Œç„¶åè¿åˆ°æ‰‹æœºå†…çš„<code>tcp-server</code></li>
</ul>
</li>
<li>è·å–æ§ä»¶ <ul>
<li>é€šè¿‡ç»™<code>GAutomator-Server</code>å‘é€<code>DUMP_TREE</code>å‘½ä»¤ï¼Œè·å–æ§ä»¶æ ‘çš„<code>XML</code>å­—ç¬¦ä¸²</li>
<li>PCç«¯<code>GAClient</code>æ¥æ”¶åˆ°çš„æ§ä»¶æ ‘æ•°æ®ï¼Œå¯ä»¥è¢«æˆ‘ä»¬è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å–åˆ°ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ç­›é€‰æ¡ä»¶æ‰¾åˆ°å¯¹åº”æ§ä»¶çš„<code>Element</code></li>
</ul>
</li>
<li>ç‚¹å‡»æ§ä»¶ <ul>
<li>PCç«¯<code>GAClient</code>é€šè¿‡ç­›é€‰æ§ä»¶å¾—åˆ°çš„ï¼Œæˆ–æ˜¯è‡ªå®šä¹‰çš„<code>Element</code>ï¼Œç»™åˆ°<code>click</code>æ¥å£</li>
<li><code>click</code>æ¥å£å‘é€<code>GET_ELEMENTS_BOUND</code>å‘½ä»¤ï¼Œæ ¹æ®<code>Element</code>ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°å¯¹åº”æ§ä»¶åœ¨è§†å£ä¸­çš„åæ ‡</li>
<li>è·å–åæ ‡åï¼Œç”¨<code>adb input tap</code>ç‚¹å‡»å±å¹•</li>
</ul>
</li>
</ul>
<h2 id="UE-SDK"><a href="#UE-SDK" class="headerlink" title="UE-SDK"></a>UE-SDK</h2><p><code>GAutomator</code>çš„<code>UE-SDK</code>å®è´¨æ˜¯ä¸€ä¸ª<code>UE4</code>æ’ä»¶ï¼ŒæŒ‰éœ€å¯ç”¨ã€‚</p>
<h3 id="æ’ä»¶å¯åŠ¨"><a href="#æ’ä»¶å¯åŠ¨" class="headerlink" title="æ’ä»¶å¯åŠ¨"></a>æ’ä»¶å¯åŠ¨</h3><p>æ’ä»¶å¯åŠ¨æ—¶ï¼Œä¼šå¯åŠ¨ä¸€ä¸ª<code>TCP-Server</code>ç›‘å¬è®¾å¤‡çš„æŸä¸ªç«¯å£ï¼Œæ¥å–å‘½ä»¤è¯·æ±‚ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ’ä»¶å¯åŠ¨</span></span><br><span class="line"><span class="keyword">void</span> FGAutomatorModule::StartupModule()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined PLATFORM_IOS || defined __ANDROID__</span></span><br><span class="line">	CommandDispatcherPtr = <span class="keyword">new</span> WeTestU3DAutomation::FCommandDispatcher();</span><br><span class="line">	CommandDispatcherPtr-&gt;Initialize();</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommandDispatcheråˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">bool</span> FCommandDispatcher::Initialize()</span><br><span class="line">&#123;</span><br><span class="line">    SocketListenerThreadInstance = FRunnableThread::Create(<span class="keyword">this</span>, TEXT(<span class="string">"GAutomatorListenerThread"</span>));</span><br><span class="line">    <span class="keyword">return</span> SocketListenerThreadInstance != <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœåŠ¡ä¸»å¾ªç¯</span></span><br><span class="line">uint32 FConnectionHandler::Run()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">bool</span> result = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        result = HandleOneCommand();</span><br><span class="line">    &#125; <span class="keyword">while</span> (result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// handleå‘½ä»¤</span></span><br><span class="line"><span class="keyword">bool</span> FConnectionHandler::HandleOneCommand() </span><br><span class="line">&#123;</span><br><span class="line">     <span class="comment">// è·å–å¤´éƒ¨é•¿åº¦ä¿¡æ¯</span></span><br><span class="line">    int32 length = RecvIntLength(); </span><br><span class="line">    <span class="keyword">if</span> (length &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å‘½ä»¤è¯·æ±‚body</span></span><br><span class="line">    TArray&lt;uint8&gt; BodyBinrary;</span><br><span class="line">    <span class="keyword">bool</span> RecvContentResult = RecvContent(length, BodyBinrary);</span><br><span class="line">    <span class="keyword">if</span> (!RecvContentResult) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    FString ContentStr = StringFromBinaryArray(BodyBinrary);</span><br><span class="line">    UE_LOG(GALog, Log, TEXT(<span class="string">"Recv command:%s"</span>), *ContentStr);</span><br><span class="line">    TSharedPtr&lt;FJsonValue&gt; JsonParsed;</span><br><span class="line">    TSharedRef&lt; TJsonReader&lt;TCHAR&gt; &gt; JsonReader = TJsonReaderFactory&lt;TCHAR&gt;::Create(ContentStr);</span><br><span class="line">    <span class="keyword">bool</span> BFlag = FJsonSerializer::Deserialize(JsonReader, JsonParsed);</span><br><span class="line">    <span class="keyword">if</span> (!BFlag) &#123;</span><br><span class="line">        UE_LOG(GALog, Error, TEXT(<span class="string">"Deserialize request to json failed.\n %s"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// handle-commandå¹¶è¿”å›</span></span><br><span class="line">    FString Response;</span><br><span class="line">    <span class="keyword">bool</span> res= HandleCommandInGameThread(JsonParsed, Response);</span><br><span class="line">    length= <span class="keyword">this</span>-&gt;SendData(Response);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®ä¸åŒçš„å‘½ä»¤ç ï¼Œå†…éƒ¨ä¼š<code>dispatch</code>åˆ°ä¸åŒ<code>handler</code>å»è¿è¡Œå¾—åˆ°å¯¹åº”å‘½ä»¤çš„ç»“æœã€‚</p>
<h3 id="æ§ä»¶ä¿¡æ¯è·å–"><a href="#æ§ä»¶ä¿¡æ¯è·å–" class="headerlink" title="æ§ä»¶ä¿¡æ¯è·å–"></a>æ§ä»¶ä¿¡æ¯è·å–</h3><p><code>GAutomator</code>æœ€é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯æ§ä»¶æ ‘å¯¼å‡ºï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è·å–æ§ä»¶æ ‘xmlå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="function">FString <span class="title">GetCurrentWidgetTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TSharedPtr&lt;FXmlFile&gt; xml = CreateFXmlFile();</span><br><span class="line">    FString XmlStr;</span><br><span class="line">    FXmlNode* RootNode = xml-&gt;GetRootNode();</span><br><span class="line">    <span class="comment">// éå†æ¯å±‚å¯è§çš„æ ¹UUserWidgetå®ä¾‹</span></span><br><span class="line">    <span class="keyword">for</span> (TObjectIterator&lt;UUserWidget&gt; Itr; Itr; ++Itr)</span><br><span class="line">    &#123;</span><br><span class="line">        UUserWidget* UserWidget = *Itr;</span><br><span class="line">        <span class="keyword">if</span> (UserWidget == <span class="literal">nullptr</span> || !UserWidget-&gt;GetIsVisible() || UserWidget-&gt;WidgetTree == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            UE_LOG(GALog, Log, TEXT(<span class="string">"UUserWidget Iterator get a null(unvisible) UUserWidget"</span>));</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿­ä»£å‘ä¸‹éå†</span></span><br><span class="line">        ForWidgetAndChildren(UserWidget-&gt;WidgetTree-&gt;RootWidget, RootNode);</span><br><span class="line">    &#125;</span><br><span class="line">    WriteNodeHierarchy(*RootNode, FString(), XmlStr);</span><br><span class="line">    <span class="keyword">return</span> MoveTemp(XmlStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">ForWidgetAndChildren</span><span class="params">(UWidget* Widget, FXmlNode* Parent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿‡æ»¤æ— æ•ˆwidget</span></span><br><span class="line">    <span class="keyword">if</span> (Widget == <span class="literal">nullptr</span> || Parent == <span class="literal">nullptr</span> || !Widget-&gt;IsVisible()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æå–UWidgetå®ä¾‹ä¿¡æ¯</span></span><br><span class="line">    FXmlNode* WidgetXmlNode = TransformUmg2XmlElement(Widget, Parent);</span><br><span class="line">    <span class="comment">// éå†Named-Slotï¼Œå‚è€ƒï¼šhttps://docs.unrealengine.com/5.0/en-US/using-named-slots-in-umg-for-unreal-engine/</span></span><br><span class="line">    <span class="keyword">if</span> (INamedSlotInterface* NamedSlotHost = Cast&lt;INamedSlotInterface&gt;(Widget))</span><br><span class="line">    &#123;</span><br><span class="line">        TArray&lt;FName&gt; SlotNames;</span><br><span class="line">        NamedSlotHost-&gt;GetSlotNames(SlotNames);</span><br><span class="line">        <span class="keyword">for</span> (FName SlotName : SlotNames)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (UWidget* SlotContent = NamedSlotHost-&gt;GetContentForSlot(SlotName))</span><br><span class="line">            &#123;</span><br><span class="line">                ForWidgetAndChildren(SlotContent, WidgetXmlNode);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// éå†Panel-Widget</span></span><br><span class="line">    <span class="keyword">if</span> (UPanelWidget* PanelParent = Cast&lt;UPanelWidget&gt;(Widget))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (int32 ChildIndex = <span class="number">0</span>; ChildIndex &lt; PanelParent-&gt;GetChildrenCount(); ChildIndex++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (UWidget* ChildWidget = PanelParent-&gt;GetChildAt(ChildIndex))</span><br><span class="line">            &#123;</span><br><span class="line">                ForWidgetAndChildren(ChildWidget, WidgetXmlNode);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœºç†ä¸Šï¼Œä¼šä»æ‰€æœ‰çš„<code>Root Widget</code>å¼€å§‹å‘ä¸‹éå†ï¼Œæ‹¿åˆ°æ¯ä¸ª<code>Widget</code>çš„æ•°æ®<br>è€Œè·å–æ§ä»¶åæ ‡æ–¹é¢ï¼Œä¼šæ¶‰åŠå¯»æ‰¾æ§ä»¶çš„é€»è¾‘ã€‚åœ¨<code>UE4</code>æ’ä»¶å†…éƒ¨ï¼Œ<code>GAutomator</code>é»˜è®¤æ”¯æŒé€šè¿‡æ§ä»¶åçš„æ–¹å¼æŸ¥æ‰¾ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">const</span> UWidget* <span class="title">FindUWidgetObject</span><span class="params">(<span class="keyword">const</span> FString&amp; name)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (TObjectIterator&lt;UUserWidget&gt; Itr; Itr; ++Itr)</span><br><span class="line">    &#123;</span><br><span class="line">        UUserWidget* UserWidget = *Itr;</span><br><span class="line">        <span class="keyword">if</span> (UserWidget == <span class="literal">nullptr</span> || !UserWidget-&gt;GetIsVisible() || UserWidget-&gt;WidgetTree == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            UE_LOG(GALog, Log, TEXT(<span class="string">"UUserWidget Iterator get a null(unvisible) UUserWidget"</span>));</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é€šè¿‡æ§ä»¶åå¯»æ‰¾æ§ä»¶</span></span><br><span class="line">        UWidget* Widget = UserWidget-&gt;GetWidgetFromName(FName(*name));</span><br><span class="line">        <span class="keyword">if</span> (Widget != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> Widget;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœºç†ä¸Šï¼Œä¼šéå†æ‰€æœ‰æ ¹æ§ä»¶ï¼Œè°ƒç”¨<code>GetWidgetFromName</code>æ–¹æ³•ï¼Œæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª<code>Widget</code>å³è¿”å›ã€‚è€Œä¹‹åè·å–å±å¹•è§†å£åæ ‡ï¼Œåˆ™ä¼šä»<code>CachedGeometry</code>è·å–åˆ°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">bool</span> FUWidgetHelper::GetElementBound(<span class="keyword">const</span> FString&amp; name, FBoundInfo&amp; BoundInfo)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> UWidget* WidgetPtr = FindUWidgetObject(name);</span><br><span class="line">    <span class="comment">// ç”±GetCachedGeometryè·å–æ¸²æŸ“å‡ ä½•ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">const</span> FGeometry geometry = WidgetPtr-&gt;GetCachedGeometry();</span><br><span class="line">    FVector2D Position = geometry.GetAbsolutePosition();</span><br><span class="line">    FVector2D Size = geometry.GetAbsoluteSize();</span><br><span class="line">    BoundInfo.x = Position.X / WidthScale;</span><br><span class="line">    BoundInfo.y = Position.Y / HeightScale;</span><br><span class="line">    BoundInfo.width = Size.X / WidthScale;</span><br><span class="line">    BoundInfo.height = Size.Y / HeightScale;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä¼˜åŒ–æ‰‹æ®µ"><a href="#ä¼˜åŒ–æ‰‹æ®µ" class="headerlink" title="ä¼˜åŒ–æ‰‹æ®µ"></a>ä¼˜åŒ–æ‰‹æ®µ</h3><p><code>GAutomator</code>çš„<code>UE-SDK</code>åœ¨å®ç°ä¸Šï¼Œç°åœ¨è¿˜å­˜åœ¨è®¸å¤šä¸è¶³ï¼Œåœ¨ç¬”è€…çš„å®é™…åº”ç”¨ä¸­å‘ç°ï¼Œå¾ˆå¤šåœ°æ–¹æ²¡æœ‰è€ƒè™‘åˆ°ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>ä¸æ”¯æŒ<code>ListView</code>å­ç©ºé—´çš„ä¿¡æ¯æ‹‰å–</li>
<li>ä¸æ”¯æŒå¯Œæ–‡æœ¬æ§ä»¶</li>
<li>ä¸æ”¯æŒå›¾ç‰‡æ§ä»¶</li>
<li>ä¸æ”¯æŒè¾“å…¥æ§ä»¶è¾“å…¥å†…å®¹</li>
<li>ä¸èƒ½é€šè¿‡<code>UniqueID</code>æŸ¥è¯¢æ§ä»¶<ul>
<li>å¦‚æœå‡ºç°æ§ä»¶åé‡å¤ï¼Œæˆ–è€…åŠ¨æ€ç”Ÿæˆæ§ä»¶çš„æƒ…å†µï¼Œä¼šéš¾ä»¥å®šä½åˆ°ï¼Œç”šè‡³æ¯æ¬¡éƒ½åªèƒ½æŸ¥åˆ°ç¬¬ä¸€ä¸ª</li>
</ul>
</li>
<li>ä¸èƒ½ä¸€æ¬¡æ€§è¿”å›æ§ä»¶åŸºç¡€+åæ ‡ä¿¡æ¯<ul>
<li>è‹¥ä¸šåŠ¡ä¾§ä¸€å¼€å§‹æŸ¥è¯¢æ§ä»¶æ ‘ï¼Œä¸ä¼šä¸€æ¬¡æ€§è¿”å›æ§ä»¶åæ ‡ï¼Œæ‰§è¡Œæ§ä»¶æ“ä½œè¿˜éœ€è¦é¢å¤–å†æŸ¥è¯¢ä¸€æ¬¡</li>
</ul>
</li>
<li>PCæ¸¸æˆæ— æ³•å®ç°ç‚¹å‡»æŒ‰ä¸‹ç­‰æ“ä½œ</li>
</ul>
<p>å› æ­¤åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œç¬”è€…åšäº†å¦‚ä¸‹çš„ä¼˜åŒ–ï¼Œå¯ä¾›å‚è€ƒï¼š</p>
<ul>
<li>æ”¯æŒ<code>ListView</code>å­æ§ä»¶çš„ä¿¡æ¯æå–é€»è¾‘</li>
<li>æ”¯æŒå¯Œæ–‡æœ¬æ§ä»¶ä¿¡æ¯æå–ï¼ˆè¿™ä¸ªçœ‹å…·ä½“é¡¹ç›®å¯Œæ–‡æœ¬æ§ä»¶å®ç°è€Œå®šï¼‰</li>
<li>æ”¯æŒä»¥èµ„æºè·¯å¾„ä¸ºå›¾ç‰‡æ§ä»¶çš„æ–‡æœ¬ä¿¡æ¯ï¼Œåˆ©äºç­›é€‰ç‰¹å®šå›¾ç‰‡</li>
<li>æ”¯æŒå¯¹<code>EditableText</code>ç­‰æ§ä»¶è¾“å…¥å†…å®¹</li>
<li>æ”¯æŒé€šè¿‡<code>UniqueID</code>æŸ¥è¯¢æ§ä»¶</li>
<li>æ”¯æŒæ‹‰å–æ§ä»¶æ ‘æ—¶ï¼Œä¸€æ¬¡æ€§è¿”å›æ§ä»¶åŸºç¡€ä¿¡æ¯+è§†å£åæ ‡ä¿¡æ¯</li>
<li>æ”¯æŒ<code>Broadcast</code>æ§ä»¶å§”æ‰˜æ¥å®ç°ç‚¹å‡»æŒ‰ä¸‹ç­‰æ“ä½œï¼Œä»è€Œæ”¯æŒPCç«¯æ¸¸æˆçš„æ§ä»¶æ“ä½œ</li>
</ul>
<h2 id="GA-Client"><a href="#GA-Client" class="headerlink" title="GA-Client"></a>GA-Client</h2><p><code>GAutomator</code>çš„PCç«¯<code>Client</code>ä¸»è¦çš„å†…å®¹é›†ä¸­åœ¨<code>GAutomatorAndroid</code>ä»¥åŠ<code>GAutomatorIos</code>ä¸‹ï¼Œæœ¬æ–‡ä»¥<code>GAutomatorAndroid</code>çš„éƒ¨åˆ†ä¸ºä¾‹ï¼Œè®²è¿°<code>GA-Client</code>çš„æ ¸å¿ƒå®ç°ã€‚</p>
<p><code>GAutomatorAndroid</code>é¡¹ç›®æœ¬èº«æ‚ç³…äº†å¾ˆå¤š<code>wetest</code>ç›¸å…³çš„å†…å®¹ï¼Œä»¥åŠå¾ˆå¤šæ— æ¯”ç²—ç³™çš„ä»£ç ï¼Œè¿™éƒ¨åˆ†å†…å®¹å…¶å®å’Œ<code>GA-Client</code>æ ¸å¿ƒé€»è¾‘æ²¡æœ‰å¤ªå¤§çš„è”ç³»ã€‚å¦‚æœè‡ªå·±å†™ä¸€ä¸ª<code>GA-Client</code>çš„è¯ï¼Œå¯èƒ½åªéœ€è¦äº”åˆ†ä¹‹ä¸€çš„ä»£ç é‡å°±å¯ä»¥äº†ã€‚</p>
<h3 id="æ ¸å¿ƒé€»è¾‘"><a href="#æ ¸å¿ƒé€»è¾‘" class="headerlink" title="æ ¸å¿ƒé€»è¾‘"></a>æ ¸å¿ƒé€»è¾‘</h3><p><code>GA-Client</code>çš„æ ¸å¿ƒéƒ¨åˆ†åœ¨äº<code>GameEngine</code>ï¼Œæ‰€æœ‰ä¸æ¸¸æˆå†…<code>SDK</code>äº¤äº’çš„é€»è¾‘ï¼Œéƒ½é›†ä¸­åœ¨è¿™é‡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># engine.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameEngine</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, address, port,uiauto_interface)</span>:</span></span><br><span class="line">        self.address = address</span><br><span class="line">        self.port = port</span><br><span class="line">        self.sdk_version = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–SocketClientå®ä¾‹ï¼Œç”¨ä»¥å’Œæ¸¸æˆSDKé€šä¿¡</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">3</span>):</span><br><span class="line">            <span class="keyword">try</span> :</span><br><span class="line">                self.socket = SocketClient(self.address, self.port)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                logger.error(e)</span><br><span class="line">                time.sleep(<span class="number">20</span>)</span><br><span class="line">                ret = forward(self.port, unity_sdk_port)  <span class="comment"># with retry...</span></span><br><span class="line">        <span class="comment"># åˆå§‹åŒ–UIAutomatorå®ä¾‹</span></span><br><span class="line">        self.ui_device = uiauto_interface</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>GameEngine</code>å®ä¾‹åˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè¿æ¥æ¸¸æˆå†…<code>SDK</code>çš„<code>socket</code>å®ä¾‹ï¼Œä»¥åŠä¸€ä¸ª<code>uiautomator</code>å®ä¾‹<code>ui_device</code>ã€‚å½“æ¸¸æˆéœ€è¦å’Œ<code>native-ui</code>äº¤äº’çš„æ—¶å€™ï¼ˆæ¯”å¦‚QQç™»å½•ï¼‰ï¼Œå°±éœ€è¦<code>uiautomator</code>çš„æ”¯æŒï¼ˆç„¶è€Œåœ¨<code>GameEngine</code>çš„åŸºç¡€æ–¹æ³•é‡Œï¼Œ<code>ui_device</code>å®ä¾‹æ²¡æœ‰å‘æŒ¥ä½œç”¨ï¼‰ã€‚</p>
<p>å½“æˆ‘ä»¬å‘æ¸¸æˆSDKå‘é€å‘½ä»¤çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨åˆ°<code>socket</code>çš„<code>send_command</code>æ–¹æ³•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># engine.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameEngine</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_get_dump_tree</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""è·å–æ§ä»¶æ ‘"""</span></span><br><span class="line">        ret = self.socket.send_command(Commands.DUMP_TREE)</span><br><span class="line">    	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line"><span class="comment"># socket_client.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SocketClient</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send_command</span><span class="params">(self, cmd, params=None, timeout=<span class="number">20</span>)</span>:</span></span><br><span class="line">        <span class="string">"""å‘é€å‘½ä»¤ï¼Œå¸¦é‡è¯•æœºåˆ¶"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> params:</span><br><span class="line">            params = <span class="string">""</span></span><br><span class="line">        command = &#123;&#125;</span><br><span class="line">        command[<span class="string">"cmd"</span>] = cmd</span><br><span class="line">        command[<span class="string">"value"</span>] = params</span><br><span class="line">        <span class="keyword">for</span> retry <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">2</span>):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.socket.settimeout(timeout)</span><br><span class="line">                self._send_data(command)</span><br><span class="line">                ret = self._recv_data()</span><br><span class="line">                <span class="keyword">return</span> ret</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="comment"># è¿™é‡Œå¿½ç•¥å¼‚å¸¸å¤„ç†/é‡è¿é€»è¾‘</span></span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">'Socket Error'</span>)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">_send_data</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="string">"""å‘é€æ•°æ®"""</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            serialized = json.dumps(data)</span><br><span class="line">        <span class="keyword">except</span> (TypeError, ValueError) <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> WeTestInvaildArg(<span class="string">'You can only send JSON-serializable data'</span>)</span><br><span class="line">        length = len(serialized)</span><br><span class="line">        buff = struct.pack(<span class="string">"i"</span>, length)</span><br><span class="line">        self.socket.send(buff)</span><br><span class="line">        <span class="keyword">if</span> six.PY3:</span><br><span class="line">            self.socket.sendall(bytes(serialized, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.socket.sendall(serialized)</span><br></pre></td></tr></table></figure>
<p>ä»ä»£ç å†…å®¹æ˜“çŸ¥ï¼Œå‘é€å‘½ä»¤çš„æ–¹å¼æ˜¯ï¼š</p>
<ul>
<li>ç”¨<code>json.dumps</code>åºåˆ—åŒ–å‘½ä»¤<code>cmd</code>å’Œå‚æ•°<code>params</code></li>
<li>åœ¨åºåˆ—åŒ–æ•°æ®å‰<code>pack</code>ä¸€ä¸ª<code>int</code>é•¿åº¦ä¿¡æ¯ï¼ŒæŠŠå®ƒå’Œæ•°æ®è¿èµ·æ¥å‘é€ç»™æ¸¸æˆå†…<code>SDK</code></li>
<li>æ¸¸æˆå†…<code>SDK</code>å…ˆ<code>recv</code>é•¿åº¦ä¿¡æ¯ï¼Œå†æ ¹æ®é•¿åº¦ä¿¡æ¯<code>recv</code>å¯¹åº”é•¿åº¦çš„æ•°æ®ï¼Œç”¨<code>json.loads</code>ååºåˆ—åŒ–ï¼Œå°±å¾—åˆ°åŸå§‹å‘½ä»¤å’Œå‚æ•°</li>
</ul>
<p>å½“æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯è·Ÿæ¸¸æˆå†…<code>SDK</code>æ¥æ”¶æ•°æ®ç›¸åŒçš„æ–¹å¼ã€‚å…·ä½“çš„å®ç°åœ¨<code>recv_package</code>é‡Œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># socket_client.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SocketClient</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv_package</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># æ‹‰å–é•¿åº¦ä¿¡æ¯</span></span><br><span class="line">        length_buffer = self.socket.recv(<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span> length_buffer:</span><br><span class="line">            total = struct.unpack_from(<span class="string">"i"</span>, length_buffer)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> WeTestSDKError(<span class="string">'recv length is None?'</span>)</span><br><span class="line">        <span class="comment"># æ‹‰å–æ•°æ®ï¼Œå¼€totalé•¿åº¦çš„memoryviewä½œä¸ºbuffer</span></span><br><span class="line">        view = memoryview(bytearray(total))</span><br><span class="line">        next_offset = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> total - next_offset &gt; <span class="number">0</span>:</span><br><span class="line">            recv_size = self.socket.recv_into(view[next_offset:], total - next_offset)</span><br><span class="line">            next_offset += recv_size</span><br><span class="line">        <span class="comment"># ååºåˆ—åŒ–æ•°æ®</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> six.PY3:</span><br><span class="line">                deserialized = json.loads(str(view.tobytes(), encoding=<span class="string">'utf-8'</span>))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                deserialized = json.loads(view.tobytes())</span><br><span class="line">            <span class="keyword">return</span> deserialized</span><br><span class="line">        <span class="keyword">except</span> (TypeError, ValueError) <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> WeTestInvaildArg(<span class="string">'Data received was not in JSON format'</span>)</span><br></pre></td></tr></table></figure>
<p>ç±»ä¼¼<code>dump_tree</code>è¿™ç§å‘½ä»¤ï¼Œè¿”å›çš„æ˜¯<code>xml-string</code>ï¼Œç›¸å½“äºæ˜¯æ²¡æœ‰äºŒæ¬¡å°è£…è¿‡çš„æ§ä»¶æ ‘ã€‚è€Œç±»ä¼¼<code>click</code>è¿™ç§æ“ä½œå‘½ä»¤ï¼Œå®é™…ç”¨åˆ°çš„å°±æ˜¯<code>adb shell input</code>è¿™ä¸€ç³»åˆ—çš„å‘½ä»¤äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># engine.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameEngine</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">click</span><span class="params">(self, locator)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> locator <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(locator, Element):  <span class="comment"># è€ƒè™‘å…¥å‚Elementçš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                bound = self.get_element_bound(locator)</span><br><span class="line">                <span class="keyword">if</span> bound:</span><br><span class="line">                    <span class="keyword">return</span> self.click_position(bound.x + bound.width / <span class="number">2</span>, bound.y + bound.height / <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">except</span> WeTestRuntimeError <span class="keyword">as</span> e:</span><br><span class="line">                logger.error(<span class="string">"Get element(&#123;0&#125;) bound faild &#123;1&#125;"</span>.format(locator, e.message))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># å¿½ç•¥åªç»™ElementBoundä»¥åŠå…¶ä»–æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">click_position</span><span class="params">(self, x, y)</span>:</span></span><br><span class="line">        x = int(x)</span><br><span class="line">        y = int(y)</span><br><span class="line">        cmd = <span class="string">"shell input tap "</span> + str(x) + <span class="string">" "</span> + str(y)</span><br><span class="line">        excute_adb_process(cmd)  <span class="comment"># adb shell input tap</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># adb_process.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">excute_adb_process</span><span class="params">(cmd, serial=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> serial:</span><br><span class="line">        command = <span class="string">"adb -s &#123;0&#125; &#123;1&#125;"</span>.format(serial, cmd)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        command = <span class="string">"adb &#123;0&#125;"</span>.format(cmd)</span><br><span class="line">	<span class="comment"># popenä¸€ä¸ªadbå‘½ä»¤è¿›ç¨‹ï¼Œæ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    ret = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">3</span>):</span><br><span class="line">        p = subprocess.Popen(command, shell=<span class="literal">True</span>, stderr=subprocess.STDOUT, stdout=subprocess.PIPE)</span><br><span class="line">        lines = p.stdout.readlines()</span><br><span class="line">        ret = <span class="string">""</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            ret += str(line) + <span class="string">"\n"</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"no devices/emulators found"</span> <span class="keyword">in</span> ret <span class="keyword">or</span> <span class="string">"device offline"</span> <span class="keyword">in</span> ret:</span><br><span class="line">            logger.error(<span class="string">"rety in excute_adb_process"</span>)</span><br><span class="line">            time.sleep(<span class="number">20</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> ret</span><br><span class="line">    <span class="keyword">return</span> ret</span><br></pre></td></tr></table></figure>
<h3 id="ä¼˜åŒ–æ‰‹æ®µ-1"><a href="#ä¼˜åŒ–æ‰‹æ®µ-1" class="headerlink" title="ä¼˜åŒ–æ‰‹æ®µ"></a>ä¼˜åŒ–æ‰‹æ®µ</h3><p>ä»<code>GA-Client</code>æ ¸å¿ƒé€»è¾‘çš„å®ç°å¯ä»¥çœ‹åˆ°ï¼Œæœ‰å¾ˆå¤šåœ°æ–¹æ˜¯å€¼å¾—ç²¾ç®€çš„ã€‚ä»¥ç¬”è€…çš„ç»éªŒä¸ºä¾‹ï¼Œæ˜¯æŒ‰ç…§è‡ªå·±è‡ªåŠ¨åŒ–æ¡†æ¶çº¦å®šï¼Œé‡å†™äº†ä¸€ç‰ˆ<code>GA-Client</code>ã€‚å…·ä½“æ˜¯åšäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š</p>
<ul>
<li>å•ç‹¬åˆ†ç¦»å‡ºè®¾å¤‡æ¥å£æ¨¡å—ï¼Œç”¨ä»¥ç»Ÿä¸€ç®¡ç†è®¾å¤‡ä¿¡æ¯å’Œæ“ä½œ<ul>
<li>è®¾å¤‡åºåˆ—å·ã€<code>adb</code>å‘½ä»¤ã€<code>shell</code>å‘½ä»¤ï¼Œéƒ½åœ¨è¿™ä¸ªæ¨¡å—æ‰§è¡Œ</li>
</ul>
</li>
<li><code>GA-Client</code>å’Œ<code>uiautomator</code>åˆ†ç¦»ï¼Œåšæˆæ’ä»¶çš„å½¢å¼<ul>
<li><code>GAutomator</code>å’Œ<code>uiautomator</code>çš„æ“ä½œï¼Œæ¯”å¦‚ç‚¹å‡»æŒ‰ä¸‹è¿™äº›ï¼Œå°±å¯ä»¥ç”±è®¾å¤‡æ¥å£æ¨¡å—æ‰§è¡Œ</li>
</ul>
</li>
<li>æ§ä»¶æ ‘çš„<code>XML</code>å­—ç¬¦ä¸²åšäºŒæ¬¡å°è£…ï¼Œå¯¹æ¯ä¸ªæ§ä»¶æŠ½è±¡æˆ<code>Widget</code>ç±»<ul>
<li>å•ç‹¬åšä¸€ä¸ª<code>GA</code>æ“ä½œæ¥å£æ¨¡å—ï¼Œä¼ å…¥<code>Widget</code>ç±»å®ä¾‹å°±å¯ä»¥å¯¹æ§ä»¶åšæ“ä½œ</li>
<li><code>Widget</code>ç±»åšä¸€äº›æ›´å¤æ‚çš„æ§ä»¶ç­›é€‰åŠŸèƒ½ï¼Œè¿™å—å°±ä¸éœ€è¦æ¸¸æˆå†…<code>SDK</code>æ¥æ·±å…¥åšäº†</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>UE4</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>GAutomator</tag>
        <tag>UIè‡ªåŠ¨åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Game Of AutoTestã€‘3ã€æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ¡†æ¶è®¾è®¡</title>
    <url>/2022/09/04/gameofautotest/iii/</url>
    <content><![CDATA[<p>è‡ªåŠ¨åŒ–åœ¨æŠ€æœ¯å±‚é¢ä¸Šï¼Œé™¤äº†åŸºç¡€çš„æŠ€æœ¯é€‰å‹ä¹‹å¤–ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦è½å®åˆ°å…·ä½“çš„å·¥å…·æ¡†æ¶ï¼Œæ‰èƒ½å¤ŸåŠ©åŠ›æˆ‘ä»¬è‡ªåŠ¨åŒ–è„šæœ¬å¼€å‘çš„è¿‡ç¨‹ã€‚å› æ­¤ï¼Œæœ¬æ–‡å°†è®²è¿°ä¸€ä¸‹å¦‚ä½•å¯¹æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶è¿›è¡Œè®¾è®¡ã€‚</p>
<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDgvMTMvZ2FtZW9mYXV0b3Rlc3QvaWkv" title="https://utmhikari.top/2022/08/13/gameofautotest/ii/">ä¸Šä¸€ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>è®²åˆ°ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ–¹å¼å¯ä»¥æœ‰å®¢æˆ·ç«¯ã€æœåŠ¡å™¨ã€ç¼–è¾‘å™¨ä¸‰ç§æ–¹å¼ï¼Œé™¤äº†ç¼–è¾‘å™¨éœ€è¦å¼ºä¾èµ–å¼•æ“å±‚é¢çš„ç‰¹æ€§ä¹‹å¤–ï¼Œå…¶ä»–ä¸¤ç§è‡ªåŠ¨åŒ–æ–¹å¼åœ¨å·¥å…·æˆ–è€…æ¡†æ¶çš„æŠ€æœ¯å®ç°ä¸Šæœ‰è¿™ä¹ˆå‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ¡†æ¶æ¨¡å—è®¾è®¡å…·æœ‰å…±é€šæ€§ï¼Œåªæ˜¯æœ€ç»ˆæ‰§è¡Œè‡ªåŠ¨åŒ–ç”¨ä¾‹/è„šæœ¬çš„æ–¹å¼ä¸åŒ</li>
<li>è®¸å¤šæ¡†æ¶æ¨¡å—å¯ä»¥ä¸ä¾èµ–æ¸¸æˆæœ¬èº«çš„ç‰¹æ€§å»å®ç°ï¼Œå¯ä»¥å®ç°å¾ˆå¤šä¼ä¸šä¸šåŠ¡åŠŸèƒ½çš„é›†æˆ</li>
<li>ç”±äºå’Œäº§å“æ²¡æœ‰å¤ªå¤šçš„è€¦åˆï¼Œå¯ä»¥åšæˆæ˜“äºåœ¨ä¸åŒé¡¹ç›®æµ‹è¯•ä¹‹é—´è¿ç§»é€šç”¨çš„å½¢å¼</li>
</ul>
<p>è€ƒè™‘åˆ°å½“å‰æˆ‘å›½æœ‰è®¸å¤šæ¸¸æˆä¼ä¸šçš„å·¥ä½œä¹ æƒ¯æ˜¯ï¼Œæµ‹è¯•ç”±ä¸­å°dispatchåˆ°å„ä¸ªé¡¹ç›®ï¼Œä¸ç›´æ¥å‚ä¸ç ”å‘è¿‡ç¨‹ï¼ˆCode Reviewï¼Ÿä¸å­˜åœ¨çš„ï¼‰ï¼Œé¡¹ç›®äº§å“ä»¥ææµ‹çš„æ–¹å¼äº¤ä»˜æµ‹è¯•ï¼Œæµ‹è¯•ä¾§å¯ä»¥è¿ç”¨è‡ªå·±çš„æµ‹è¯•æ‰‹æ³•å’Œå·¥å…·å»å®Œæˆä»»åŠ¡ã€‚ä»è¿™æ ·çš„è§’åº¦çœ‹ï¼Œæ‹¥æœ‰ä¸€ä¸ªåŠŸèƒ½æ€§å¼ºä¸”é€šç”¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œä¸ä»…æ˜¯å¯¹äºé¡¹ç›®æ‰€éœ€è¦è‡ªåŠ¨åŒ–æµ‹è¯•çš„åœºæ™¯ï¼Œæ›´æ˜¯å¯¹äºæµ‹è¯•ç»„æ•´ä½“çš„æŠ€æœ¯åŸºå»ºæå‡è€Œè¨€ï¼Œéƒ½æ˜¾å¾—éå¸¸é‡è¦ã€‚</p>
<p>ä»¥ç¬”è€…å·¥ä½œç»éªŒä¸ºå‚è€ƒï¼Œè¦åšåˆ°æ¸¸æˆè‡ªåŠ¨åŒ–æ¡†æ¶å¾—ä»¥é€šç”¨ï¼Œè®¾è®¡ä¸Šéœ€è¦éµå¾ªå¦‚ä¸‹å‡†åˆ™ï¼š</p>
<a id="more"></a>
<ul>
<li>æŠ€æœ¯é›†æˆ<ul>
<li>åœ¨è‡ªåŠ¨åŒ–é€»è¾‘å®ç°æ–¹é¢ï¼Œå°½å¯èƒ½é›†æˆæ›´å¤šçš„è‡ªåŠ¨åŒ–åº•å±‚æŠ€æœ¯æ–¹æ¡ˆ</li>
<li>åœ¨è‡ªåŠ¨åŒ–ä¸šåŠ¡è½åœ°æ–¹é¢ï¼Œå°½å¯èƒ½é›†æˆæ›´å¤šæŠ¥å‘Šå·¥å…·ä»¥åŠé€šç”¨ä¸šåŠ¡SDK<ul>
<li>æŠ¥å‘Šå·¥å…·åŒ…æ‹¬ï¼šå½•å±ã€æˆªå›¾ã€æ—¥å¿—åˆ†æã€é€šç”¨æŠ¥å‘Šè¾“å‡ºã€IM/é‚®ä»¶æ¨é€ç­‰</li>
<li>é€šç”¨ä¸šåŠ¡SDKï¼šè¿™ä¸ªæ¯”è¾ƒçµæ´»ï¼Œæ ¹æ®å„ä¸ªä¼ä¸šå†…å…·ä½“ä¸šåŠ¡è€Œå®š</li>
</ul>
</li>
</ul>
</li>
<li>ç”¨ä¾‹éš”ç¦»<ul>
<li>ä¸šåŠ¡ç”¨ä¾‹å’Œæ¡†æ¶åº•å±‚ç›¸äº’éš”ç¦»ï¼Œé€šè¿‡æ¥å£çº¦å®šæˆ–æ˜¯ä¾èµ–æ³¨å…¥çš„æ–¹å¼è¡”æ¥èµ·æ¥</li>
<li>ä¸åŒç”¨ä¾‹ä¹‹é—´ï¼Œåœ¨é€»è¾‘æ„ä¹‰ä¸Šï¼Œä¸åº”å‡ºç°ç›¸äº’çš„æ¨¡å—å¼•ç”¨ï¼Œæœ‰å…±æ€§çš„éœ€æ±‚éœ€è¦æŠ½è±¡åˆ°æ¡†æ¶å½“ä¸­</li>
<li>ä¸åŒç”¨ä¾‹ä¹‹é—´ï¼Œåœ¨ç‰©ç†æ„ä¹‰ä¸Šï¼Œç”±æ¡†æ¶ç»Ÿä¸€ç®¡ç†å„ä¸ªç”¨ä¾‹çš„å†…å®¹ï¼ˆè„šæœ¬ã€é…ç½®ï¼‰å’Œè¿è¡Œæ—¶çŠ¶æ€ï¼Œæµ‹è¯•äººå‘˜é€šè¿‡å¯åŠ¨æ¡†æ¶å»é—´æ¥é©±åŠ¨ç”¨ä¾‹çš„è¿è¡Œ</li>
</ul>
</li>
<li>è¡Œä¸ºé©±åŠ¨<ul>
<li>åœ¨ç©å®¶è¡Œä¸ºå±‚é¢ä¸Šï¼Œå¯¹äºæ¯ç±»ç©æ³•ä»¥åŠç³»ç»ŸåŠŸèƒ½ï¼ŒæŠ½è±¡å‡ºåŸºç¡€æ¥å£é›†</li>
<li>åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•å±‚é¢ä¸Šï¼Œå¯¹äºæ¯ç±»å›ºåŒ–çš„è‡ªåŠ¨æµ‹è¯•æµç¨‹ï¼ŒæŠ½è±¡å‡ºå›ºåŒ–çš„è¡Œä¸ºç­–ç•¥</li>
</ul>
</li>
</ul>
<h2 id="æŠ€æœ¯é›†æˆ"><a href="#æŠ€æœ¯é›†æˆ" class="headerlink" title="æŠ€æœ¯é›†æˆ"></a>æŠ€æœ¯é›†æˆ</h2><p>æŠ€æœ¯é›†æˆï¼Œä»ä¸€ä¸ªæ¡†æ¶çš„è§’åº¦è€Œè¨€ï¼Œèƒ½é›†æˆæ›´å¤šçš„åŠŸèƒ½è‚¯å®šæ˜¯æ›´å¥½çš„ã€‚åœ¨æŠ€æœ¯é›†æˆæ–¹é¢éœ€è¦åˆ†æˆä¸¤å—è€ƒè™‘ï¼Œä¸€å—æ˜¯è‡ªåŠ¨åŒ–çš„å®ç°ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå…ˆå‰æåˆ°çš„å„ç§è‡ªåŠ¨åŒ–æŠ€æœ¯æ–¹æ¡ˆéƒ½æ•´åˆè¿›æ¥ï¼Œå¤§å¤šæ•°ä¸šç•Œå¼€æºçš„æ¡†æ¶ä¹Ÿéƒ½æ˜¯è¿™æ ·åšçš„ã€‚</p>
<p>å¦ä¸€å—æ˜¯å…·ä½“åˆ°ä¸šåŠ¡æ–¹é¢ï¼Œå°±æ˜¯åœ¨æŠ€æœ¯å®ç°çš„åŸºç¡€ä¸Šï¼Œæ€æ ·æå‡è‡ªåŠ¨åŒ–çš„å¼€å‘æ•ˆç‡ï¼Œæ€æ ·è®©è‡ªåŠ¨åŒ–è·Ÿå®é™…æµ‹è¯•ä¸šåŠ¡è¡”æ¥çš„æ›´å¥½ã€‚è¿™ä¸€partç›¸æ¯”äºè‡ªåŠ¨åŒ–åº•å±‚æŠ€æœ¯å®ç°æ˜¯æ›´åŠ é‡è¦çš„ï¼Œå› ä¸ºä¼šå½±å“åˆ°è‡ªåŠ¨åŒ–æ¡†æ¶è½åœ°åˆ°ä¸šåŠ¡çš„æ•ˆæœã€‚</p>
<p>é’ˆå¯¹åè€…ï¼Œå¼€æºæ¡†æ¶å’Œå·¥å…·å¾ˆéš¾ä½ è¿™äº›ï¼Œè€Œå°±ç®—ä¼ä¸šå†…éƒ¨åšçš„è®¸å¤šæŠ€æœ¯æ–¹æ¡ˆï¼Œä»¥ç¬”è€…çš„ç»å†æ¥çœ‹ï¼ŒåŸºæœ¬éƒ½ç¼ºä¹è¿™æ–¹é¢çš„æ€è€ƒæ²‰æ·€ã€‚å› æ­¤ï¼Œå¦‚æœæ˜¯ä»0åˆ°1å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•çš„æƒ…å†µï¼Œå»ºè®®æ˜¯ä»å…·ä½“ä¸šåŠ¡å‡ºå‘ï¼Œæ‰¾ä¸€ä¸ªé€‚ç”¨äºåº”ç”¨è‡ªåŠ¨åŒ–æŠ€æœ¯çš„ç©æ³•æµ‹è¯•åœºæ™¯ï¼Œå®äº‹æ±‚æ˜¯å»ç¢ç£¨ä¸€ä¸‹ã€‚</p>
<h2 id="ç”¨ä¾‹éš”ç¦»"><a href="#ç”¨ä¾‹éš”ç¦»" class="headerlink" title="ç”¨ä¾‹éš”ç¦»"></a>ç”¨ä¾‹éš”ç¦»</h2><p>ç”¨ä¾‹éš”ç¦»ï¼ŒåŒ…å«ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€å—æ˜¯ç”¨ä¾‹é€»è¾‘å’Œæ¡†æ¶é€»è¾‘çš„éš”ç¦»ï¼Œä¸€å—æ˜¯ä¸åŒç”¨ä¾‹ä¹‹é—´çš„éš”ç¦»ã€‚</p>
<p>é’ˆå¯¹å‰è€…ï¼Œç”¨ä¾‹å’Œæ¡†æ¶çš„éš”ç¦»ï¼Œéœ€è¦å¼ºè°ƒæ¡†æ¶æœ¬èº«å­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºç”¨ä¾‹æä¾›è¿è¡Œç¯å¢ƒè¿˜æœ‰ä¾¿æ·çš„åŠŸèƒ½æ¥å£ï¼Œä¸åº”å½“ä¾èµ–äºç”¨ä¾‹æœ¬èº«ï¼Œæˆ–è€…è¯´ï¼Œå°±ç®—æ˜¯éæ¸¸æˆé¢†åŸŸçš„è‡ªåŠ¨åŒ–æµ‹è¯•ç”šè‡³å…¶ä»–éœ€æ±‚ï¼Œç”¨è¿™ä¸ªæ¡†æ¶ç¨å¾®æ”¹è£…ä¸€ä¸‹å°±å¯ä»¥å®Œæˆï¼Œè¿™æ˜¯æ¡†æ¶ä½œä¸ºåº•å±‚åŸºç¡€éœ€è¦è¾¾åˆ°çš„æ•ˆæœã€‚</p>
<p>é’ˆå¯¹ä¸åŒç”¨ä¾‹ä¹‹é—´çš„éš”ç¦»ï¼Œä¸¥æ ¼æ„ä¹‰ä¸Šéœ€è¦è¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼Œç”¨ä¾‹æœ¬èº«çš„ç‰ˆæœ¬è¿­ä»£æ˜¯ç‹¬ç«‹çš„ï¼Œä¸åŒçš„ç”¨ä¾‹å¼€å‘è€…å¯ä»¥åœ¨ç›¸åŒç‰ˆæœ¬æ¡†æ¶çš„åŸºç¡€ä¸Šå¼€å‘ä¸åŒçš„å†…å®¹ï¼Œæœ€ç»ˆè¿™äº›å†…å®¹éƒ½æ— å†²çªåœ°åˆå…¥åˆ°åŒä¸€ä¸ªå¼€å‘åˆ†æ”¯ã€‚å¦‚æœæœ‰å¯ä»¥æŠ½è±¡å‡ºæ¥çš„å†…å®¹ï¼Œå¯ä»¥ç”±æ¡†æ¶å¼€å‘è€…ç»Ÿä¸€æ•´ç†å¹¶å…¥ï¼Œä¹Ÿå¯ä»¥ç”±ç”¨ä¾‹å¼€å‘è€…è¯·æ±‚åˆå…¥ï¼ˆè¿™ç§æƒ…å†µæœ‰å†²çªçš„å¯èƒ½æ€§ï¼‰ï¼Œæ€»ä¹‹éƒ½æ˜¯ä¸ºäº†è®©æ¡†æ¶é›†æˆçš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œã€‚</p>
<p>åœ¨è¿™æ ·çš„è®¾è®¡åŸºç¡€ä¸Šï¼Œç”¨ä¾‹çš„æ‰§è¡Œæ˜¯éœ€è¦æ¡†æ¶æœºåˆ¶é©±åŠ¨çš„ï¼Œä»¥ç¬”è€…çš„ç»éªŒä¸ºä¾‹ï¼Œåœ¨<code>python</code>æ¡†æ¶çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥å‚è€ƒä¸‹è¿°æ–¹å¼å®ç°ã€‚é¦–å…ˆï¼Œæ¡†æ¶å¯ä»¥å‘ˆç°è¿™æ ·çš„ç›®å½•ç»“æ„ï¼š</p>
<ul>
<li><code>cfg</code>ï¼šæ¡†æ¶é…ç½®</li>
<li><code>engine</code>ï¼šæ¡†æ¶æ ¸å¿ƒé€»è¾‘</li>
<li><code>testcases</code>ï¼šç”¨ä¾‹é›†æ ¹ç›®å½•<ul>
<li><code>testcase_1</code>ï¼šç”¨ä¾‹1çš„å·¥ä½œç›®å½•<ul>
<li><code>main.py</code>ï¼šç”¨ä¾‹1çš„å…¥å£</li>
</ul>
</li>
</ul>
</li>
<li><code>main.py</code>ï¼šæ¡†æ¶å…¥å£</li>
</ul>
<p>ä¹‹åï¼Œåœ¨<code>main.py</code>ä¸­ï¼Œç”¨ä¾‹å¼€å‘è€…éœ€è¦å®ç°ä¸€ä¸ª<code>run</code>å‡½æ•°ï¼Œä½œä¸ºçœŸå®çš„ç”¨ä¾‹è·‘æµ‹é€»è¾‘ã€‚<code>run</code>å‡½æ•°çš„å…¥å‚å¯ä»¥æ˜¯æ¡†æ¶çš„ä¸€äº›ç‰¹æ€§å®ä¾‹ï¼Œæ¯”å¦‚è„šæœ¬/UIè‡ªåŠ¨åŒ–çš„<code>Handle</code>ã€‚ä»ç”¨ä¾‹å¼€å‘è€…è§’åº¦è€Œè¨€ï¼Œä¸éœ€è¦å…³å¿ƒè¿™äº›<code>Handle</code>çš„æ¥æºï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ï¼›ä»æ¡†æ¶å¼€å‘è€…è§’åº¦è€Œè¨€ï¼Œæ¡†æ¶éœ€è¦æ ¹æ®ç”¨ä¾‹çš„è¿è¡Œé…ç½®åˆ›å»ºè¿™äº›ç‰¹æ€§å®ä¾‹ï¼Œç„¶å<code>inject</code>ç»™ç”¨ä¾‹çš„<code>run</code>æ¥å£ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># testcases/testcase_1/main.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(r: RunnerHandle, d: DeviceHandle, s: ScriptHandle, u: UIHandle)</span> -&gt; Result:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    main entry of testcase logic</span></span><br><span class="line"><span class="string">    handles will be automatically injected by the autotest framework</span></span><br><span class="line"><span class="string">    :param r: handle of current runner, use this instance to log or get env-vars of testcase runtime</span></span><br><span class="line"><span class="string">     :param d: handle of device</span></span><br><span class="line"><span class="string">    :param s: handle of script-based autotest</span></span><br><span class="line"><span class="string">    :param u: handle of ui-based autotest</span></span><br><span class="line"><span class="string">    :return: testcase result</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="comment"># ç”¨ä¾‹ï¼šå…³é—­å•†åŸç•Œé¢</span></span><br><span class="line">    r.logger.info(<span class="string">'start testcase_1!'</span>)</span><br><span class="line">    s.send(<span class="string">'print("helloworld")'</span>)</span><br><span class="line">    d.screenshot(<span class="string">'before_close'</span>)</span><br><span class="line">    <span class="keyword">if</span> u.find_and_click(name=<span class="string">'BtnClose_Mall'</span>):</span><br><span class="line">        r.logger.info(<span class="string">'found and clicked close-btn of mall panel'</span>)</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        d.screenshot(<span class="string">'after_close'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r.logger.error(<span class="string">'failed to find close-btn of mall panel'</span>)</span><br><span class="line">    <span class="keyword">if</span> s.call(<span class="string">'UIModule.IsInMainPanel()'</span>).boolval():</span><br><span class="line">        <span class="keyword">return</span> Result.ok(message=<span class="string">'successfully closed mall panel'</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> Result.err(message=<span class="string">'failed to close mall panel'</span>)</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæ¡†æ¶å†…éƒ¨éœ€è¦æœ‰ä¸€ä¸ªé€šè¿‡<code>ç”¨ä¾‹å</code>é…ç½®ï¼Œä»è€ŒåŠ¨æ€<code>import</code>åˆ°<code>testcases/ç”¨ä¾‹å</code>ä¸‹çš„<code>main</code>æ¨¡å—ï¼Œå¹¶è°ƒç”¨<code>run</code>æ¥å£çš„è¿è¡Œæœºåˆ¶ã€‚ä»ç”¨ä¾‹å¼€å‘è€…çš„è§’åº¦ï¼Œæ¡†æ¶é…ç½®åœ¨<code>cfg</code>ç›®å½•ä¸‹æŒ‡å®šï¼ˆå‘½ä»¤è¡Œä¹Ÿå¯ä»¥ï¼‰ï¼Œä¹‹åè¿è¡Œæ¡†æ¶å…¥å£è„šæœ¬<code>main.py</code>ï¼Œè¾¾åˆ°è¿è¡Œç”¨ä¾‹é€»è¾‘çš„æ•ˆæœã€‚</p>
<h2 id="è¡Œä¸ºé©±åŠ¨"><a href="#è¡Œä¸ºé©±åŠ¨" class="headerlink" title="è¡Œä¸ºé©±åŠ¨"></a>è¡Œä¸ºé©±åŠ¨</h2><p>ï¼ˆæ¸¸æˆï¼‰è‡ªåŠ¨åŒ–ç”¨ä¾‹æœ¬è´¨æ˜¯ä¸€ç³»åˆ—ç”¨æˆ·ï¼ˆç©å®¶ï¼‰è¡Œä¸ºçš„ç»„è£…ï¼Œå› æ­¤åœ¨é¢å‘æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ¡†æ¶è®¾è®¡ä¸Šï¼Œéœ€è¦å……åˆ†å¯¹æ¸¸æˆè¡Œä¸ºè¿›è¡ŒæŠ½è±¡ï¼Œä½¿å¾—ä¸åŒçš„æ¸¸æˆè¡Œä¸ºèƒ½å¤Ÿå¤ç”¨åˆ°å„ä¸ªç”¨ä¾‹å½“ä¸­ï¼Œå‡å°‘ç”¨ä¾‹ä»£ç é‡ä»¥åŠç¼–å†™éš¾åº¦ã€‚</p>
<p>è‡ªåŠ¨åŒ–çš„è¡Œä¸ºåˆ†ä¸ºä¸¤ç§ç²’åº¦ï¼Œä¸€ç§æ˜¯æµ‹è¯•ç©å®¶å•ä¸ªæ“ä½œçš„ç²’åº¦ï¼Œå¥½æ¯”è¯´ï¼Œæ‰“å¼€æŸä¸ªç©æ³•çš„ç•Œé¢ã€è¿›å…¥æŸç©æ³•ä½é¢ã€è®¾ç½®æŸç§ç”»è´¨ï¼Œç”šè‡³æ˜¯è¯´æŸ¥è¯¢ä»»åŠ¡è¿›åº¦æ•°æ®ã€æ‰§è¡Œæ¢å¤çŠ¶æ€GMå‘½ä»¤è¿™ç§ï¼Œéƒ½å±äºæµ‹è¯•ç©å®¶çš„å•ä¸ªæ“ä½œã€‚è¿™äº›è¡Œä¸ºå¯ä»¥éšæ—¶éšåœ°è¢«ä¸åŒçš„ç”¨ä¾‹å¤ç”¨ï¼Œæ‹¼è£…æˆæ•´ä¸ªè‡ªåŠ¨åŒ–æµç¨‹</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æœ‰<code>ç™»å½•æ¸¸æˆ</code>ä»¥åŠ<code>ç©PVP</code>çš„æµ‹è¯•åœºæ™¯ï¼Œè¿™ä¸¤ä¸ªåœºæ™¯ä¼šé‡åˆ°<code>ç­‰å¾…åŠ è½½</code>çš„è¿‡ç¨‹ï¼Œå› æ­¤åœ¨è‡ªåŠ¨åŒ–é€»è¾‘å®ç°ä¸Šï¼Œå°±å¯ä»¥æŠ½è±¡å‡º<code>ç­‰å¾…åŠ è½½</code>çš„æ“ä½œï¼Œæ”¾åˆ°å•ç‹¬çš„åœ°æ–¹ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># scene.pyï¼Œåœºæ™¯æ¨¡å—ï¼ˆå…¬å…±ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_loading</span><span class="params">()</span> -&gt; bool:</span></span><br><span class="line">    script_handle = ScriptHandle.current()</span><br><span class="line">    resp = script_handle.call(<span class="string">'SceneModule.IsLoading()'</span>)</span><br><span class="line">    <span class="keyword">return</span> resp.boolval()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wait_for_loading</span><span class="params">(timeout=<span class="number">20</span>, interval=<span class="number">3</span>)</span> -&gt; bool:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_loading():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> range(timeout):</span><br><span class="line">        time.sleep(interval)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> is_loading():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•æ¸¸æˆ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_game</span><span class="params">()</span> -&gt; bool:</span></span><br><span class="line">    login_server(player_id=<span class="number">123</span>, server_id=<span class="number">456</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> scene.wait_for_loading():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_in_game():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç©PVP</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play_pvp</span><span class="params">()</span> -&gt; bool:</span></span><br><span class="line">    start_pvp_match(scene_id=<span class="number">999</span>)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> scene.wait_for_loading():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_in_pvp():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§ç²’åº¦çš„è¡Œä¸ºæ˜¯å›ºåŒ–çš„è‡ªåŠ¨åŒ–æµç¨‹ï¼Œè¿™ä¸ªæµç¨‹å¯ä»¥æŒ‡ç©æ³•æµç¨‹ï¼Œæ¯”å¦‚æŸä¸ªå‰¯æœ¬çš„è¡Œä¸ºæ ‘é€»è¾‘ï¼Œä¹Ÿå¯ä»¥æŒ‡æµ‹è¯•æµç¨‹ï¼Œæ¯”å¦‚<code>buff</code>æ•ˆæœæµ‹è¯•ï¼Œåªè¦ç»™è¿™ä¸ªæµç¨‹æŒ‡å®šä¸€äº›<code>buffID</code>ï¼Œå°±å¯ä»¥è‡ªåŠ¨æ‰§è¡Œ<code>addBuff</code>ã€<code>checkPlayerState</code>ä¹‹ç±»çš„æµ‹è¯•é€»è¾‘ã€‚è¿™ä¸€ç±»çš„è¡Œä¸ºæ˜¯ä»¥ç¬¬ä¸€ç±»çš„è¡Œä¸ºä¸ºåŸºç¡€æ­å»ºè€Œæˆçš„ï¼Œä»ç”¨ä¾‹å¼€å‘è€…è§’åº¦æ¥çœ‹ï¼Œåªéœ€è¦è‡ªå®šä¹‰æµç¨‹å±æ€§ï¼ˆç±»ä¼¼è¡Œä¸ºæ ‘çš„é»‘æ¿ï¼‰ä»¥åŠé‡è½½ä¸€äº›æµç¨‹ä¸­é’©å­å‡½æ•°çš„å®ç°ï¼Œå°±å¯ä»¥æŠŠè‡ªå·±éœ€è¦çš„è‡ªåŠ¨åŒ–é€»è¾‘æ­å»ºèµ·æ¥ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬éœ€è¦å®ç°<code>è·‘å‰¯æœ¬</code>çš„æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠ½è±¡å•ç‹¬çš„å‰¯æœ¬æµç¨‹å‡ºæ¥ï¼Œå°½å¯èƒ½å¤ç”¨åˆ°æ¸¸æˆé‡Œæ‰€æœ‰ç‹¬ç«‹çš„å‰¯æœ¬å½“ä¸­ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDUvMjAvdGVzdGxpZmUvZHVuZ2Vvbl9hdXRvdGVzdC8=" title="https://utmhikari.top/2021/05/20/testlife/dungeon_autotest/">å‰¯æœ¬è‡ªåŠ¨åŒ–æµ‹è¯•<i class="fa fa-external-link"></i></span>ä¸€æ–‡æ‰€ç¤ºçš„æ–¹å¼å»æ„å»ºä¸€ä¸ªåŸºç¡€çš„å‰¯æœ¬æµç¨‹ç±»ï¼Œç„¶åå†æ ¹æ®æˆ‘ä»¬æ¸¸æˆçš„å…·ä½“æƒ…å†µå»å®ç°ä¸€ç‰ˆå‰¯æœ¬è·‘æµ‹ç±»ï¼Œæœ€åå°±å¯ä»¥é€šè¿‡è¿™ä¸ªè·‘æµ‹ç±»æ¥é€‚é…æ‰€æœ‰ç‹¬ç«‹çš„å‰¯æœ¬ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DungeonBehavior</span>:</span></span><br><span class="line">    <span class="string">"""åŸºç¡€å‰¯æœ¬æµç¨‹ï¼Œå‚è€ƒã€å‰¯æœ¬è‡ªåŠ¨åŒ–æµ‹è¯•ã€‘æ–‡ç« çš„å®ç°"""</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyGameDungeonBehavior</span><span class="params">(DungeonBehavior)</span>:</span></span><br><span class="line">    <span class="string">"""å½“å‰æ¸¸æˆçš„å‰¯æœ¬æµç¨‹å®ç°"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, dungeon_id: int, **kwargs)</span>:</span></span><br><span class="line">        DungeonBehavior.__init__(self, **kwargs)</span><br><span class="line">        self._dungeon_id = dungeon_id</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_state</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""implement update_state step upon MyGame here"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">on_state_changed</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""implement on_state_changed step upon here"""</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChaosSanctuaryDungeonBehavior</span><span class="params">(MyGameDungeonBehavior)</span>:</span></span><br><span class="line">    <span class="string">"""å‡è®¾æœ‰ä¸ªå«åšã€æ··æ²Œé¿éš¾æ‰€ã€‘çš„å‰¯æœ¬"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, **kwargs)</span>:</span></span><br><span class="line">        MyGameDungeonBehavior.__init__(self, <span class="number">123</span>, **kwargs)</span><br><span class="line">        self.does_diablo_exist = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update_state</span><span class="params">(self)</span>:</span></span><br><span class="line">        MyGameDungeonBehavior.update_state(self)</span><br><span class="line">        self.does_diablo_exist = entity.has_entity(entity_id=<span class="number">99999</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_state</span><span class="params">(self)</span>:</span></span><br><span class="line">        default_state = MyGameDungeonBehavior.get_state(self)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f'<span class="subst">&#123;default_state&#125;</span>_<span class="subst">&#123;self.does_diablo_exist&#125;</span>'</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæœ‰æ¡ä»¶çš„è¯ï¼Œå¯ä»¥ç¼–å†™è¡Œä¸ºæ ‘æ¡†æ¶+å¯è§†åŒ–å·¥å…·ï¼Œç”šè‡³æ˜¯èƒ½å¤Ÿå®ç°BDDçš„åŸè¯­æ”¯æŒï¼Œè¿™æ ·éƒ½èƒ½è¿›ä¸€æ­¥ææ•ˆè‡ªåŠ¨åŒ–çš„å¼€å‘ã€‚</p>
<p>é€šè¿‡å¯¹ä¸åŒç²’åº¦çš„æ¸¸æˆè¡Œä¸ºè¿›è¡ŒæŠ½è±¡ï¼Œä¸è®ºæ˜¯ç”¨ä¾‹ç¼–å†™è¿˜æ˜¯é€»è¾‘ç»´æŠ¤ä¸Šï¼Œå®¹æ˜“å±‚åº¦éƒ½å¯ä»¥ä¸Šä¸€ä¸ªå°é˜¶ã€‚<strong>è¿™ä¸€partçš„ç»„ç»‡ï¼Œæ˜¯è‡ªåŠ¨åŒ–æ¡†æ¶è®¾è®¡å½“ä¸­æœ€ä¸ºé‡è¦çš„ä¸€ç¯ã€‚</strong></p>
<h2 id="æ¨¡å—åˆ†å±‚"><a href="#æ¨¡å—åˆ†å±‚" class="headerlink" title="æ¨¡å—åˆ†å±‚"></a>æ¨¡å—åˆ†å±‚</h2><p>åŸºäºä¸Šè¿°çš„è®¾è®¡æ€è·¯ï¼Œè‡ªåŠ¨åŒ–æ¡†æ¶å¯ä»¥ä¾æ®è¿™æ ·çš„æ¨¡å—åˆ†å±‚è¿›è¡Œè®¾è®¡ï¼š</p>
<ul>
<li>æ¡†æ¶åº•å±‚<ul>
<li>åŸºç¡€é€»è¾‘ï¼šåŒ…æ‹¬è¿è¡Œæ—¶é…ç½®ç®¡ç†ã€ç¯å¢ƒç®¡ç†ã€ä¾èµ–æ³¨å…¥ç­‰æœºåˆ¶</li>
<li>æŠ€æœ¯æ–¹æ¡ˆç»„ä»¶/æ’ä»¶åŒ–ï¼šåŒ…æ‹¬è®¾å¤‡æ“ä½œæ¨¡å—ã€è‡ªåŠ¨åŒ–åº•å±‚æŠ€æœ¯ã€æŠ¥å‘Šå·¥å…·ä»¥åŠä¸šåŠ¡SDKç­‰å†…å®¹</li>
<li>ç”¨ä¾‹è¿è¡Œï¼šåŒ…æ‹¬é…ç½®ä¸è„šæœ¬åŠ è½½ã€ç”¨ä¾‹è¿è¡Œç›‘æ§ã€æµ‹è¯•ç»“æœè¾“å‡ºç­‰å†…å®¹</li>
</ul>
</li>
<li>æ¸¸æˆä¸šåŠ¡å±‚<ul>
<li>ç©å®¶è¡Œä¸ºã€è‡ªåŠ¨åŒ–æµ‹è¯•è¡Œä¸ºçš„å°è£…</li>
<li>è„šæœ¬/UIç­‰è‡ªåŠ¨åŒ–åº•å±‚å®ç°çš„å°è£…<ul>
<li>æ ¹æ®æ¯ä¸ªæ¸¸æˆå…·ä½“æƒ…å†µå¼€å‘ç›¸å…³å†…å®¹</li>
<li>è„šæœ¬è‡ªåŠ¨åŒ–ï¼Œå»ºè®®åœ¨æ¸¸æˆä»£ç åŸºç¡€ä¸Šï¼Œç¼–å†™ä¸€å±‚å•ç‹¬çš„è‡ªåŠ¨åŒ–æ¨¡å—ï¼Œä½¿å¾—æ‹¼è£…æ¸¸æˆè„šæœ¬ä»£ç æ›´åŠ æ–¹ä¾¿</li>
</ul>
</li>
<li>ä»…é€‚ç”¨äºæœ¬æ¸¸æˆçš„å·¥å…·/ä¸šåŠ¡SDKå†…å®¹</li>
</ul>
</li>
<li>ç”¨ä¾‹å±‚<ul>
<li>ç”¨ä¾‹è¿è¡Œé…ç½®</li>
<li>å‡†å¤‡æ•°æ®ï¼šä¸»è¦æ˜¯æ¸¸æˆçš„é…ç½®æ•°æ®ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åœ¨è„šæœ¬ä»£ç ä¸­åŠ¨æ€è·å–çš„æ–¹å¼</li>
<li>ç”¨ä¾‹è„šæœ¬ä»£ç </li>
</ul>
</li>
</ul>
<h2 id="å·¥å…·æ‰©å±•"><a href="#å·¥å…·æ‰©å±•" class="headerlink" title="å·¥å…·æ‰©å±•"></a>å·¥å…·æ‰©å±•</h2><p>å¦‚æœæŠŠè‡ªåŠ¨åŒ–æ¡†æ¶è¿™ä¸ªæ¦‚å¿µå‘å¤–å»¶ä¼¸çš„è¯ï¼Œé‚£ä¹ˆé™¤äº†åŸºç¡€æ¡†æ¶æœ¬èº«ä¹‹å¤–ï¼Œè¿˜éœ€è¦å‘¨è¾¹å·¥å…·çš„æ”¯æŒï¼Œæ‰èƒ½æœ€å¤§åŒ–æå‡è‡ªåŠ¨åŒ–æµ‹è¯•çš„ä½“éªŒã€‚<br>è¿™äº›å·¥å…·ä¸ä¸€å®šéœ€è¦é›†æˆåˆ°æ¡†æ¶é‡Œï¼Œå¯ä»¥åŒ…æ‹¬ï¼š</p>
<ul>
<li>è°ƒè¯•å·¥å…·ï¼šèƒ½å¤Ÿå®ç°é’ˆå¯¹å•ä¸ªè„šæœ¬/UIè‡ªåŠ¨åŒ–é€»è¾‘ç»™äºˆå³æ—¶ç»“æœåé¦ˆï¼Œç”¨äºæ—¥å¸¸å¼€å‘è°ƒè¯•ç”¨</li>
<li>ä»£ç ç”Ÿæˆå·¥å…·ï¼šå¦‚è¡Œä¸ºæ ‘/è„šæœ¬å¯è§†åŒ–ç¼–ç¨‹ã€UIå½•åˆ¶å›æ”¾ç­‰ï¼Œç”¨äºå¿«é€Ÿç”Ÿæˆæ¨¡æ¿ä»£ç æˆ–æ˜¯è‡ªåŠ¨åŒ–é€»è¾‘</li>
<li>å‡†å¤‡æ•°æ®ç”Ÿæˆå·¥å…·ï¼šç”¨äºå¿«é€Ÿç”ŸæˆæŸç§ç©æ³•è‡ªåŠ¨åŒ–æµ‹è¯•æ‰€éœ€çš„é…ç½®/ç”¨ä¾‹æ•°æ®</li>
<li>ç»“æœå¯è§†åŒ–å·¥å…·ï¼šç”¨äºå¯è§†åŒ–å±•ç°è‡ªåŠ¨åŒ–æµ‹è¯•çš„ç»“æœ</li>
<li>IDEï¼šIDEå¯ä»¥æ˜¾è‘—ç®€åŒ–ç ”å‘è¿‡ç¨‹ï¼Œä½†IDEç ”å‘å·¥ä½œé‡å¤§ï¼Œéœ€è¦è€ƒè™‘æŠ•å…¥äº§å‡ºæ¯”</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä½œä¸ºæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶æ¥è®²ï¼Œæ—¢ç„¶æ˜¯åº•å±‚æ¡†æ¶ï¼Œé‚£ä¹ˆæ‰“é“è¿˜éœ€è‡ªèº«ç¡¬ã€‚é™¤äº†ä¸Šé¢è¯´çš„ä¸€äº›è®¾è®¡ç†å¿µè·Ÿå·¥å…·é€‰å‹ï¼Œä¸€äº›åŸºç¡€çš„æ–¹é¢ï¼Œå·¥ç¨‹åŒ–ã€äº§å“åŒ–çš„æŠ€æœ¯åŸåˆ™ï¼Œæ¯”å¦‚ä¿è¯ç¨³å®šæ€§ã€æ˜“æ‰©å±•æ€§ã€æ˜“ä¸Šæ‰‹æ€§ï¼Œé«˜å†…èšä½è€¦åˆï¼Œä¸°å¯Œçš„æ–‡æ¡£åŒ…è£…ï¼ŒSLAæ„è¯†ï¼Œè¿™äº›éƒ½æ˜¯é€šç”¨æ¡†æ¶è®¾è®¡è½åœ°å¿…é¡»å…·å¤‡çš„ä¸œè¥¿ã€‚è‡ªåŠ¨åŒ–æ¡†æ¶ä¹‹äºè‡ªåŠ¨åŒ–ç”¨ä¾‹ï¼ŒçŠ¹å¦‚æ¸¸æˆå¼•æ“ä¹‹äºæ¸¸æˆä¸šåŠ¡é€»è¾‘ã€‚å¦‚æœæ¡†æ¶å¼€å‘è€…ä¸å»æ·±å…¥è°ƒç ”ä¸šåŠ¡è¿‡ç¨‹ï¼Œè€Œæ˜¯çº¯ç²¹å †ç Œè‡ªåŠ¨åŒ–åº•å±‚æŠ€æœ¯ï¼Œé‚£è¿™ç±»æ¡†æ¶çš„ç»“æœï¼Œåªèƒ½æ˜¯ç‚’ä½œåˆ°å¤§è§„æ¨¡<strong>è¯•ç”¨</strong>ï¼Œè€Œæ°¸è¿œä¸å¯èƒ½åœ¨å•ä¸ªæ¸¸æˆé¡¹ç›®å†…å®ç°å¤§è§„æ¨¡<strong>åº”ç”¨</strong>ã€‚é—æ†¾çš„æ˜¯ï¼Œåœ¨ä¸šç•Œè¿™ç§åŠæˆå“ä¾ç„¶å¤§è¡Œå…¶é“ã€‚</p>
<p>æœ€åè¿˜æ˜¯å¾—è®²ç‚¹ä¸œè¥¿ã€‚ä»æ¸¸æˆæµ‹è¯•è¡Œä¸šçš„è§’åº¦æ¥çœ‹ï¼Œå›½å†…è®¸å¤šä¼ä¸šéƒ½æ‰§è¡Œä¸­å°æµ‹å¼€+é¡¹ç›®ä¸šåŠ¡æµ‹è¯•+ä¸­å°/é¡¹ç›®ä¸“é¡¹æµ‹è¯•çš„æ¨¡å¼ï¼Œä½†ç”±äºé¡¹ç›®æµ‹è¯•é€šå¸¸æœ‰è¾ƒé«˜tickçš„å·¥ä½œæ¨¡å¼ï¼Œä¸­å°çš„å·¥ä½œæ¨¡å¼é€šå¸¸åˆæ˜¯åŒæ—¶æœåŠ¡å¤šä¸ªé¡¹ç›®ç»„ï¼Œå°±ä¼šé€ æˆå¯¹äºè®¸å¤šä¸“é¡¹æµ‹è¯•éœ€æ±‚ï¼Œä¸­å°çš„æ”¯æŒæ•ˆç‡æ˜¾å¾—å¾ˆä½ï¼ŒåŒæ—¶å„é¡¹ç›®æµ‹è¯•å› ä¸ºä¸èƒ½åŠæ—¶å¾—åˆ°æ”¯æŒï¼Œå·¥ä½œäº§å‡ºæ•ˆèƒ½ä¹Ÿä¼šæœ‰æ‰€ä¸‹é™ã€‚ä»¥ç ”å‘é€šç”¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ä¸ºä¾‹ï¼Œå»ºè®®é‡‡å–çš„æ¨¡å¼æ˜¯ï¼Œä¸­å°æµ‹è¯•ä¸»æ§åŸºç¡€æ¨¡å—å¼€å‘ä¸ä¸šåŠ¡ç‰¹æ€§åˆå…¥ï¼Œé¡¹ç›®æµ‹è¯•ç›´æ¥å‚ä¸ä¸šåŠ¡ç‰¹æ€§ç ”å‘ï¼Œå¹¶èƒ½éšæ—¶ç”³è¯·åˆå…¥ä¸€äº›è‡ªå·±é¡¹ç›®é‡åˆ°ä¸”å¯ä»¥é€šç”¨ç»™å…¶ä»–é¡¹ç›®çš„å†…å®¹ã€‚è¿™æ ·çš„å¼€å‘æ¨¡å¼ä¸‹ï¼Œä¸ä»…å¯ä»¥è§£å†³ä¸­å°æµ‹è¯•æœåŠ¡æ•ˆç‡çš„é—®é¢˜ï¼Œä¹Ÿèƒ½å……åˆ†å‘æŒ¥é¡¹ç›®æµ‹è¯•çš„ä¸šåŠ¡ç†è§£åŠ›å’ŒæŠ€æœ¯ç”Ÿäº§åŠ›ï¼ŒåŒæ—¶ä¹Ÿèƒ½åœ¨ä¸æ¶‰åŠä¿å¯†é—®é¢˜çš„æ¡ä»¶ä¸‹æœ€å¤§é™åº¦é›†æˆå„ç±»æŠ€æœ¯æ¨¡å—ã€‚è€Œæ›´é‡è¦çš„ï¼Œæ˜¯å¯ä»¥åŠ å¼ºä¸åŒæµ‹è¯•å›¢é˜Ÿä¹‹é—´çš„äº¤æµï¼Œå‡å°‘ä¿¡æ¯çš„ä¸å¯¹ç§°æ€§ï¼Œè¿™ç‚¹ä»éƒ¨é—¨æˆ˜æ–—åŠ›å»ºè®¾è§’åº¦æ¥è®²ï¼Œç€å®å¤§æœ‰è£¨ç›Šã€‚</p>
]]></content>
      <categories>
        <category>Game Of AutoTest</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æ¡†æ¶</tag>
        <tag>BDD</tag>
        <tag>ä¾èµ–æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘pythonçš„webå¼€å‘â€”â€”WSGIã€ASGIã€uvicornä¸FastAPI</title>
    <url>/2022/08/14/pythonnotes/asgi_uvicorn_fastapi/</url>
    <content><![CDATA[<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼ŒèŠä¸€ä¸‹<code>python</code>åœ¨<code>web</code>å¼€å‘ä¸Šçš„ä¸€äº›åŸºç¡€å®ç°ï¼Œé˜è¿°ä¸‹è‡ªå·±ç†è§£ä¸­çš„<code>WSGI</code>ã€<code>ASGI</code>ï¼Œä»¥åŠæ‹¿<code>uvicorn</code>+<code>FastAPI</code>çš„ç»„åˆä¸¾ä¸ª<code>ASGI</code>åº”ç”¨çš„ä¾‹å­ã€‚</p>
<h2 id="WSGI"><a href="#WSGI" class="headerlink" title="WSGI"></a>WSGI</h2><p><code>python</code>çš„<code>web</code>æœåŠ¡çš„è¯ç”Ÿï¼Œå…¶å®è¿½æº¯åˆ°ä¸€ç§æœºåˆ¶ï¼Œå«åš<code>WSGI</code>ï¼Œå…¨ç§°<code>Web Server Gateway Interface</code>ã€‚<code>WSGI</code>çš„ææ¡ˆæ¥æºäº<span class="exturl" data-url="aHR0cHM6Ly9wZXBzLnB5dGhvbi5vcmcvcGVwLTAzMzMv" title="https://peps.python.org/pep-0333/">PEP-333<i class="fa fa-external-link"></i></span>ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç§<code>python-web-server</code>å’Œ<code>python-web-app</code>çš„æ¥å£é€šä¿¡æ ‡å‡†ã€‚åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œ<code>python</code>çš„<code>web</code>æœåŠ¡å‘ˆç°ä»¥ä¸‹çš„å·¥ä½œæ¨¡å¼ï¼š</p>
<ul>
<li><code>python-web-app</code>ï¼Œä¹Ÿå°±æ˜¯<code>web</code>åº”ç”¨å±‚ï¼Œå®ç°<code>WSGI</code>æ¥å£ï¼Œç”¨ä½œ<code>web</code>è¯·æ±‚çš„<code>handler</code></li>
<li>ç”¨æˆ·å‘<code>python-web-server</code>å‘é€<code>web</code>è¯·æ±‚</li>
<li><code>python-web-server</code>ï¼Œåˆç§°ä½œ<code>WSGI Server</code>ï¼Œè§£æè¯·æ±‚æ•°æ®ï¼Œæ•´ç†å½“å‰<code>session</code>çš„ç¯å¢ƒä¿¡æ¯</li>
<li><code>python-web-server</code>åŠ è½½<code>python-web-app</code>ï¼Œè°ƒç”¨<code>python-web-app</code>å®ä¾‹çš„<code>WSGI</code>æ¥å£ï¼Œå¤„ç†è¯·æ±‚</li>
<li><code>python-web-app</code>å¤„ç†å®Œè¯·æ±‚ï¼Œè¿”å›ç»“æœç»™åˆ°<code>python-web-server</code></li>
<li><code>python-web-server</code>å†™å›è¿”å›ç»“æœï¼Œç»™å›ç”¨æˆ·</li>
</ul>
<p>ä»£ç ä¸Šæ˜¯è¿™æ ·çš„è¡¨ç°ï¼Œä»¥å®˜æ–¹ææ¡ˆçš„ä¾‹å­ä¸ºä¾‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os, sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># python-web-app</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">simple_app</span><span class="params">(environ, start_response)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    python-web-app implementation</span></span><br><span class="line"><span class="string">    :param environ: ç”±python-web-serveræä¾›ï¼Œè¡¨ç¤ºå½“å‰è¯·æ±‚çš„ç¯å¢ƒä¿¡æ¯</span></span><br><span class="line"><span class="string">    :param start_response: ç”±python-web-serveræä¾›çš„å›è°ƒï¼Œç”¨ä»¥åˆå§‹åŒ–è¿”å›ç»“æœçš„çŠ¶æ€</span></span><br><span class="line"><span class="string">    :return: è¿”å›ç»“æœçš„æ•°æ®å†…å®¹</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    status = <span class="string">'200 OK'</span></span><br><span class="line">    response_headers = [(<span class="string">'Content-type'</span>, <span class="string">'text/plain'</span>)]</span><br><span class="line">    start_response(status, response_headers)</span><br><span class="line">    <span class="keyword">return</span> [<span class="string">'Hello world!\n'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># python-web-server</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_with_cgi</span><span class="params">(application)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    WSGI layer implementation</span></span><br><span class="line"><span class="string">    :param application: å®ç°WSGIçš„app</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    environ = dict(os.environ.items())</span><br><span class="line">    headers_set = []</span><br><span class="line">    headers_sent = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(data)</span>:</span></span><br><span class="line">        <span class="string">"""å†™å›æ•°æ®çš„é€»è¾‘"""</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> headers_set:</span><br><span class="line">             <span class="keyword">raise</span> AssertionError(<span class="string">"write() before start_response()"</span>)</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> headers_sent:</span><br><span class="line">             <span class="comment"># Before the first output, send the stored headers</span></span><br><span class="line">             status, response_headers = headers_sent[:] = headers_set</span><br><span class="line">             sys.stdout.write(<span class="string">'Status: %s\r\n'</span> % status)</span><br><span class="line">             <span class="keyword">for</span> header <span class="keyword">in</span> response_headers:</span><br><span class="line">                 sys.stdout.write(<span class="string">'%s: %s\r\n'</span> % header)</span><br><span class="line">             sys.stdout.write(<span class="string">'\r\n'</span>)</span><br><span class="line">        sys.stdout.write(data)</span><br><span class="line">        sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start_response</span><span class="params">(status, response_headers, exc_info=None)</span>:</span></span><br><span class="line">        <span class="string">"""åˆå§‹åŒ–responseçš„é€»è¾‘"""</span></span><br><span class="line">        <span class="keyword">if</span> exc_info:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> headers_sent:</span><br><span class="line">                    <span class="keyword">raise</span> exc_info[<span class="number">0</span>], exc_info[<span class="number">1</span>], exc_info[<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                exc_info = <span class="literal">None</span>     <span class="comment"># avoid dangling circular ref</span></span><br><span class="line">        <span class="keyword">elif</span> headers_set:</span><br><span class="line">            <span class="keyword">raise</span> AssertionError(<span class="string">"Headers already set!"</span>)</span><br><span class="line">        headers_set[:] = [status, response_headers]</span><br><span class="line">        <span class="keyword">return</span> write</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è°ƒç”¨åº”ç”¨å±‚çš„WSGIæ¥å£ï¼Œè·å–è¿”å›æ•°æ®</span></span><br><span class="line">    result = application(environ, start_response)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> result:  <span class="comment"># å†™å›è¿”å›æ•°æ®</span></span><br><span class="line">            <span class="keyword">if</span> data:    <span class="comment"># don't send headers until body appears</span></span><br><span class="line">                write(data)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> headers_sent:</span><br><span class="line">            write(<span class="string">''</span>)   <span class="comment"># send headers now if body was empty</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> hasattr(result, <span class="string">'close'</span>):</span><br><span class="line">            result.close()</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>WSGI</code>ï¼Œå°±å¯ä»¥å®ç°<code>python-web-app</code>å’Œ<code>python-web-server</code>çš„åˆ†ç¦»ï¼Œè¿™æ ·æ— è®ºä»€ä¹ˆ<code>python-web-app</code>ï¼Œåªè¦å®ç°äº†<code>WSGI</code>æ¥å£æ ‡å‡†ï¼Œå°±èƒ½å¤Ÿæ— ç¼ç§»æ¤åˆ°å…¶å®ƒæ”¯æŒ<code>WSGI</code>çš„<code>python-web-server</code>ä¸Šã€‚</p>
<h2 id="ASGI"><a href="#ASGI" class="headerlink" title="ASGI"></a>ASGI</h2><p>è‡ª<code>python3</code>æ¨å‡ºå¼‚æ­¥IOå®ç°<code>asyncio</code>ä¹‹åï¼Œ<code>ASGI</code>ä¹Ÿåº”è¿è€Œç”Ÿã€‚<code>ASGI</code>çš„ç›®æ ‡å’Œ<code>WSGI</code>ç›¸åŒï¼Œä½†ä¹Ÿæœ‰ä¸€äº›æ”¹è¿›ç‚¹ï¼Œä¸€æ–¹é¢æ˜¯æ”¯æŒ<code>asyncio</code>çš„æœºåˆ¶ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿèƒ½å¤Ÿè§£å†³<code>WSGI</code>éš¾ä»¥æ”¯æŒ<code>WebSocket</code>ä¹‹ç±»é•¿è¿æ¥æ¨¡å¼çš„é—®é¢˜ã€‚è¦æ·±å…¥äº†è§£<code>ASGI</code>ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9hc2dpLnJlYWR0aGVkb2NzLmlvL2VuL2xhdGVzdC9pbmRleC5odG1s" title="https://asgi.readthedocs.io/en/latest/index.html">è¿™ç¯‡æ–‡æ¡£<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>åœ¨<code>ASGI</code>æ ‡å‡†ä¸‹ï¼Œ<code>python-web-app</code>éœ€è¦è¿™æ ·çš„æ¥å£å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">application</span><span class="params">(scope, receive, send)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    python-web-appåº”ç”¨å±‚å®ç°</span></span><br><span class="line"><span class="string">    :param scope: ç”±python-web-serveræä¾›ï¼Œè¡¨ç¤ºå½“å‰è¿æ¥çš„ç¯å¢ƒä¿¡æ¯</span></span><br><span class="line"><span class="string">    :param receive: é€šè¿‡è¿™ä¸ªåç¨‹ï¼Œå¯ä»¥æ”¶åˆ°ç”±python-web-serverå‘æ¥çš„äº‹ä»¶</span></span><br><span class="line"><span class="string">    :param send: é€šè¿‡è¿™ä¸ªåç¨‹ï¼Œå¯ä»¥å†™å›äº‹ä»¶ç»™python-web-serverï¼Œæ¯”å¦‚è®©python-web-serverå¤„ç†response</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    event = <span class="keyword">await</span> receive()</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">await</span> send(&#123;<span class="string">"type"</span>: <span class="string">"websocket.send"</span>, <span class="string">"text"</span>: <span class="string">"Hello world!"</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¸è®ºæ˜¯<code>receive</code>åˆ°çš„è¿˜æ˜¯<code>send</code>å‡ºå»çš„<code>event</code>ï¼Œéƒ½ä¼šåŒ…å«ä¸€ä¸ª<code>type</code>å­—æ®µè¡¨ç¤ºè¿™ä¸ª<code>event</code>çš„ç±»å‹ï¼Œä¸€èˆ¬<code>type</code>ä¼šæœ‰ï¼š</p>
<ul>
<li><code>http.xxx</code>ï¼š<code>http</code>è¿æ¥ã€è¯·æ±‚ã€è¿”å›ç›¸å…³</li>
<li><code>websocket.xxx</code>ï¼š<code>websocket</code>è¿æ¥ã€è¯·æ±‚ã€è¿”å›ç›¸å…³</li>
<li><code>xxx.send/receive</code>ï¼šæ”¶å‘æ¶ˆæ¯ç›¸å…³</li>
<li><code>lifespan.xxx</code>ï¼š<code>web</code>æœåŠ¡ç”Ÿå‘½å‘¨æœŸç›¸å…³</li>
</ul>
<h2 id="ASGIæ¡ˆä¾‹ä¹‹uvicorn-FastAPI"><a href="#ASGIæ¡ˆä¾‹ä¹‹uvicorn-FastAPI" class="headerlink" title="ASGIæ¡ˆä¾‹ä¹‹uvicorn+FastAPI"></a>ASGIæ¡ˆä¾‹ä¹‹uvicorn+FastAPI</h2><p>ä¸ºäº†æ›´åŠ ç›´è§‚æ„Ÿå—<code>ASGI</code>çš„åº”ç”¨ï¼Œæœ¬æ–‡ä¹Ÿé¡ºå¸¦ä»¥<code>uvicorn</code>åŠ <code>FastAPI</code>çš„ç»„åˆï¼Œé€šè¿‡æºç å®ç°æ¥çœ‹<code>ASGI</code>æ˜¯å¦‚ä½•ä¸²è”èµ·<code>python-web-server</code>å’Œ<code>python-web-app</code>çš„ã€‚</p>
<p>åœ¨ç¬”è€…å°è£…çš„ç®€æ˜“<code>http-web-app</code>æ¡†æ¶<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9zdGFydC1mYXN0YXBp" title="https://github.com/utmhikari/start-fastapi">start-fastapi<i class="fa fa-external-link"></i></span>ä¸­ï¼Œå°±æ”¯æŒäº†é€šè¿‡<code>uvicorn</code>å¯åŠ¨<code>FastAPI</code>åº”ç”¨ã€‚å…¶ä¸­ï¼Œ<code>main.py</code>çš„<code>uvicorn</code>å®ä¾‹ä¼šåŠ è½½<code>app</code>æ¨¡å—ä¸‹çš„<code>APP</code>è¿™ä¸€<code>FastAPI</code>å®ä¾‹ï¼Œå¯åŠ¨<code>web-app</code>åº”ç”¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ============ start-fastapi project ============</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    uvicorn.run(<span class="string">'app:APP'</span>, **cfg)</span><br><span class="line"></span><br><span class="line"><span class="comment"># app/__init__.py</span></span><br><span class="line">APP = FastAPI(**FASTAPI_CFG)</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆä»<code>uvicorn.run</code>å¼€å§‹çœ‹èµ·ï¼Œå…¶ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># uvicorn/main.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(app: typing.Union[ASGIApplication, str], **kwargs: typing.Any)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    config = Config(app, **kwargs)  <span class="comment"># uvicorn Configå®ä¾‹</span></span><br><span class="line">    server = Server(config=config)  <span class="comment"># uvicorn Serverå®ä¾‹ï¼ŒåŒ…è£…Configå®ä¾‹</span></span><br><span class="line">    <span class="keyword">if</span> (config.reload <span class="keyword">or</span> config.workers &gt; <span class="number">1</span>) <span class="keyword">and</span> <span class="keyword">not</span> isinstance(app, str):</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> config.should_reload:  <span class="comment"># ç”¨watchdogç›‘æµ‹æ–‡ä»¶æ”¹åŠ¨ï¼Œå®æ—¶é‡å¯ï¼Œå¼€å‘ç¯å¢ƒç”¨</span></span><br><span class="line">        sock = config.bind_socket()</span><br><span class="line">        ChangeReload(config, target=server.run, sockets=[sock]).run()</span><br><span class="line">    <span class="keyword">elif</span> config.workers &gt; <span class="number">1</span>:  <span class="comment"># spawnå¤šä¸ªworkerï¼Œå®ç°å¤šè¿›ç¨‹çš„webæœåŠ¡</span></span><br><span class="line">        sock = config.bind_socket()</span><br><span class="line">        Multiprocess(config, target=server.run, sockets=[sock]).run()</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># é»˜è®¤standaloneçš„webæœåŠ¡</span></span><br><span class="line">        server.run()</span><br></pre></td></tr></table></figure>
<p>é»˜è®¤ä¼šèµ°<code>Server</code>å®ä¾‹çš„<code>run</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹å…¶ä¸­çš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># uvicorn/server.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self, sockets=None)</span>:</span></span><br><span class="line">        self.config.setup_event_loop()  <span class="comment"># æ ¹æ®uvicorné…ç½®ï¼ŒåŠ¨æ€åŠ è½½EventLoopçš„ç¯å¢ƒ</span></span><br><span class="line">        loop = asyncio.get_event_loop()  <span class="comment"># EventLoopèµ°asyncioçš„æœºåˆ¶</span></span><br><span class="line">        loop.run_until_complete(self.serve(sockets=sockets))  <span class="comment"># å¯åŠ¨webæœåŠ¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">serve</span><span class="params">(self, sockets=None)</span>:</span></span><br><span class="line">        config = self.config</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> config.loaded:  <span class="comment"># åŠ è½½ä¸€æ¬¡é…ç½®ï¼Œå³Configå®ä¾‹</span></span><br><span class="line">            config.load()</span><br><span class="line">        self.lifespan = config.lifespan_class(config)</span><br><span class="line">        self.install_signal_handlers()  <span class="comment"># åˆå§‹åŒ–os-signalå¤„ç†é€»è¾‘</span></span><br><span class="line">        <span class="keyword">await</span> self.startup(sockets=sockets)  <span class="comment"># åˆå§‹åŒ–æœåŠ¡</span></span><br><span class="line">        <span class="keyword">if</span> self.should_exit:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">await</span> self.main_loop()  <span class="comment"># å¼€å§‹ä¸»å¾ªç¯</span></span><br><span class="line">        <span class="keyword">await</span> self.shutdown(sockets=sockets)  <span class="comment"># ç»ˆæ­¢æœåŠ¡</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦æ­¥éª¤ï¼š</p>
<ul>
<li><code>config.load</code>ï¼šåŠ è½½é…ç½®</li>
<li><code>startup</code>ï¼šå¯åŠ¨æœåŠ¡å™¨</li>
</ul>
<p>é¦–å…ˆçœ‹é…ç½®åŠ è½½ï¼Œé‡Œé¢ä¼šå°†<code>app</code>å®ä¾‹è¿›è¡Œåˆå§‹åŒ–ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># uvicorn/config.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> self.loaded</span><br><span class="line">        <span class="comment"># ä¸Šé¢ç•¥ï¼Œä¼šåŠ è½½http_protocol_class/ws_protocol_class/lifespan_class</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># FastAPIèµ°è¿™ä¸ªé“¾è·¯ï¼ŒåŠ è½½åˆ°å…ˆå‰è¯´çš„app.APPå®ä¾‹</span></span><br><span class="line">            self.loaded_app = import_from_string(self.app)  </span><br><span class="line">        <span class="keyword">except</span> ImportFromStringError <span class="keyword">as</span> exc:</span><br><span class="line">            logger.error(<span class="string">"Error loading ASGI app. %s"</span> % exc)</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self.interface == <span class="string">"auto"</span>:  <span class="comment"># FastAPIèµ°çš„æ˜¯asgi3</span></span><br><span class="line">            <span class="keyword">if</span> inspect.isclass(self.loaded_app):</span><br><span class="line">                use_asgi_3 = hasattr(self.loaded_app, <span class="string">"__await__"</span>)</span><br><span class="line">            <span class="keyword">elif</span> inspect.isfunction(self.loaded_app):</span><br><span class="line">                use_asgi_3 = asyncio.iscoroutinefunction(self.loaded_app)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                call = getattr(self.loaded_app, <span class="string">"__call__"</span>, <span class="literal">None</span>)</span><br><span class="line">                use_asgi_3 = asyncio.iscoroutinefunction(call)</span><br><span class="line">            self.interface = <span class="string">"asgi3"</span> <span class="keyword">if</span> use_asgi_3 <span class="keyword">else</span> <span class="string">"asgi2"</span></span><br><span class="line"></span><br><span class="line">        self.loaded = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fastapi/applications.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastAPI</span><span class="params">(Starlette)</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, scope: Scope, receive: Receive, send: Send)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.root_path:</span><br><span class="line">            scope[<span class="string">"root_path"</span>] = self.root_path</span><br><span class="line">        <span class="keyword">if</span> AsyncExitStack:</span><br><span class="line">            <span class="keyword">async</span> <span class="keyword">with</span> AsyncExitStack() <span class="keyword">as</span> stack:</span><br><span class="line">                scope[<span class="string">"fastapi_astack"</span>] = stack</span><br><span class="line">                <span class="keyword">await</span> super().__call__(scope, receive, send)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">await</span> super().__call__(scope, receive, send)  <span class="comment"># pragma: no cover</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>FastAPI</code>çš„<code>app</code>å®ç°é‡Œï¼Œå®šä¹‰äº†<code>ASGI</code>ï¼Œå¹¶ä¸”ä¹Ÿåœ¨<code>uvicorn</code>çš„<code>config.load</code>é‡Œè¢«è¯†åˆ«åˆ°äº†ã€‚<code>FastAPI</code>ç»§æ‰¿äº†<code>Starlette</code>ï¼Œè€Œ<code>Starlette</code>æœ¬èº«å³æ˜¯æ”¯æŒ<code>ASGI</code>çš„<code>web</code>æ¡†æ¶ï¼Œä¸º<code>python-web-app</code>æä¾›äº†è·¯ç”±ã€ä¸­é—´ä»¶ç›¸å…³çš„åº”ç”¨çº§åº•å±‚æ”¯æŒã€‚<code>FastAPI</code>å®é™…æ˜¯å¯¹<code>Starlette</code>çš„åŒ…è£…ï¼Œç›¸å…³<code>handler</code>ã€<code>middleware</code>çš„æ³¨å†Œä¹Ÿæ˜¯ç»™åˆ°<code>Starlette</code>æ¡†æ¶é‡Œé¢çš„ã€‚é’ˆå¯¹<code>web-server</code>å‘æ¥çš„è¯·æ±‚ï¼Œ<code>FastAPI</code>åœ¨è®¾ç½®ä¸€äº›ç¯å¢ƒä¿¡æ¯åï¼Œæœ€ç»ˆä¹Ÿæ˜¯äº¤ç”±<code>Starlette</code>åº•å±‚å¤„ç†ã€‚</p>
<p>ä¹‹åå›åˆ°<code>uvicorn</code>ï¼Œçœ‹ä¸€ä¸‹<code>startup</code>çš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># uvicorn/server.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">startup</span><span class="params">(self, sockets: list = None)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">await</span> self.lifespan.startup()</span><br><span class="line">        <span class="keyword">if</span> self.lifespan.should_exit:</span><br><span class="line">            self.should_exit = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        config = self.config</span><br><span class="line"></span><br><span class="line">        <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            reader: asyncio.StreamReader, writer: asyncio.StreamWriter</span></span></span><br><span class="line"><span class="function"><span class="params">        )</span> -&gt; <span class="keyword">None</span>:</span>  <span class="comment"># http-handler</span></span><br><span class="line">            <span class="keyword">await</span> handle_http(</span><br><span class="line">                reader, writer, server_state=self.server_state, config=config</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">        <span class="comment"># è¿™é‡Œçœç•¥å…¶ä»–åˆ†æ”¯</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            server = <span class="keyword">await</span> asyncio.start_server(</span><br><span class="line">                handler,</span><br><span class="line">                host=config.host,</span><br><span class="line">                port=config.port,</span><br><span class="line">                ssl=config.ssl,</span><br><span class="line">                backlog=config.backlog,</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> exc:</span><br><span class="line">            logger.error(exc)</span><br><span class="line">            <span class="keyword">await</span> self.lifespan.shutdown()</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># ä¸‹ç•¥</span></span><br></pre></td></tr></table></figure>
<p><code>startup</code>åˆ†ä¸¤æ­¥ï¼š</p>
<ul>
<li>åˆå§‹åŒ–<code>lifespan</code></li>
<li>å®šä¹‰<code>http-handler</code>ï¼Œé€šè¿‡<code>asyncio.start_server</code>å¯åŠ¨<code>http-server</code></li>
</ul>
<p>åœ¨åˆå§‹åŒ–<code>lifespan</code>è¿‡ç¨‹ä¸­ï¼Œ<code>uvicorn</code>ä¼šå‘é€<code>lifespan.startup</code>äº‹ä»¶ï¼Œè¿™ä¸ªäº‹ä»¶å°±ä¼šè¢«<code>FastAPI-app</code>çš„<code>ASGI</code>æ•è·åˆ°ï¼Œæœ€ç»ˆå±‚å±‚å¾€ä¸‹ï¼Œä¼šèµ°åˆ°<code>Starlette</code>çš„<code>Router</code>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># starlette/routing.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, scope: Scope, receive: Receive, send: Send)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> scope[<span class="string">"type"</span>] <span class="keyword">in</span> (<span class="string">"http"</span>, <span class="string">"websocket"</span>, <span class="string">"lifespan"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"router"</span> <span class="keyword">not</span> <span class="keyword">in</span> scope:</span><br><span class="line">            scope[<span class="string">"router"</span>] = self</span><br><span class="line">        <span class="keyword">if</span> scope[<span class="string">"type"</span>] == <span class="string">"lifespan"</span>:</span><br><span class="line">            <span class="keyword">await</span> self.lifespan(scope, receive, send)  <span class="comment"># èµ°åˆ°è¿™é‡Œ</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># ä¸‹ç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">lifespan</span><span class="params">(self, scope: Scope, receive: Receive, send: Send)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        first = <span class="literal">True</span></span><br><span class="line">        app = scope.get(<span class="string">"app"</span>)</span><br><span class="line">        <span class="keyword">await</span> receive()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> inspect.isasyncgenfunction(self.lifespan_context):</span><br><span class="line">                <span class="keyword">async</span> <span class="keyword">for</span> item <span class="keyword">in</span> self.lifespan_context(app):  <span class="comment"># è°ƒç”¨lifespan-event</span></span><br><span class="line">                    first = <span class="literal">False</span></span><br><span class="line">                    <span class="keyword">await</span> send(&#123;<span class="string">"type"</span>: <span class="string">"lifespan.startup.complete"</span>&#125;)</span><br><span class="line">                    <span class="keyword">await</span> receive()</span><br><span class="line">            <span class="comment"># ä¸‹ç•¥</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>å½“<code>Startlette</code>çš„<code>Router</code>æ£€æµ‹åˆ°<code>lifespan</code>äº‹ä»¶æ—¶ï¼Œå°±ä¼šèµ°åˆ°<code>lifespan</code>é€»è¾‘ï¼Œå…¶ä¸­ä¼šçœ‹<code>lifespan</code>çš„å½“å‰é˜¶æ®µæ˜¯å¦æœ‰å¯¹åº”çš„<code>hook</code>å‡½æ•°ï¼Œæœ‰çš„è¯å°±æ‰§è¡Œã€‚å½“å‰é˜¶æ®µæ˜¯<code>lifespan.startup</code>ï¼Œå› æ­¤å¦‚æœæˆ‘ä»¬åœ¨<code>FastAPI</code>ä¸­å®šä¹‰äº†è¿™ä¸ªåç¨‹ï¼Œå°±å¯ä»¥åœ¨<code>startup</code>é˜¶æ®µæ‰§è¡Œåˆ°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># register startup event</span></span><br><span class="line"><span class="meta">@APP.on_event('startup')</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">start_app</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><code>lifespan.startup</code>ä¹‹åï¼Œå°±å®šä¹‰<code>http-handler</code>å¹¶ç»‘åˆ°<code>listen-server</code>ä¸Šã€‚<code>http-handler</code>ä¼šè§£æè¯·æ±‚æ•°æ®ï¼Œç„¶åè°ƒç”¨<code>app</code>çš„<code>ASGI</code>æ¥å£å¤„ç†è¯·æ±‚ï¼Œå¤§è‡´æ˜¯è¿™æ ·çš„é“¾è·¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">H11Protocol</span><span class="params">(asyncio.Protocol)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle_events</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> event_type <span class="keyword">is</span> h11.Request:</span><br><span class="line">                task = self.loop.create_task(self.cycle.run_asgi(app))</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RequestResponseCycle</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">run_asgi</span><span class="params">(self, app)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = <span class="keyword">await</span> app(self.scope, self.receive, self.send)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>å¥½æ¯”æˆ‘ä»¬<code>GET</code>å¥åº·æ£€æŸ¥æ¥å£<code>/api/v1/core/health</code>ï¼Œé‚£ä¹ˆæœ€ç»ˆè¢«<code>FastAPI-app</code>æ•è·åˆ°çš„è¯·æ±‚æ•°æ®é‡Œï¼Œ<code>scope</code>é•¿è¿™æ ·ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">scope = &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"http"</span>,</span><br><span class="line">    <span class="string">"method"</span>: <span class="string">"GET"</span>,</span><br><span class="line">    <span class="string">"root_path"</span>: <span class="string">""</span></span><br><span class="line">    <span class="string">"path"</span>: <span class="string">"/api/v1/core/health"</span>,</span><br><span class="line">    <span class="string">"query_string"</span>: <span class="string">b""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œå±‚å±‚å¾€ä¸‹ï¼Œå°±ä¼šåˆèµ°åˆ°<code>Starlette</code>çš„è·¯ç”±é€»è¾‘ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># starlette/routing.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Router</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, scope: Scope, receive: Receive, send: Send)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="comment"># ä¸Šç•¥</span></span><br><span class="line">        <span class="comment"># æœ‰å…¨éƒ¨åŒ¹é…çš„è·¯ç”±å°±ç›´æ¥å¤„ç†</span></span><br><span class="line">        <span class="keyword">for</span> route <span class="keyword">in</span> self.routes:</span><br><span class="line">            match, child_scope = route.matches(scope)</span><br><span class="line">            <span class="keyword">if</span> match == Match.FULL:</span><br><span class="line">                scope.update(child_scope)</span><br><span class="line">                <span class="keyword">await</span> route.handle(scope, receive, send)  <span class="comment"># è·¯ç”±å®ä¾‹æ¥handle</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">elif</span> match == Match.PARTIAL <span class="keyword">and</span> partial <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                partial = route</span><br><span class="line">                partial_scope = child_scope</span><br><span class="line">        <span class="comment"># åŒ¹é…éƒ¨åˆ†åŒ¹é…çš„è·¯ç”±</span></span><br><span class="line">        <span class="keyword">if</span> partial <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            scope.update(partial_scope)</span><br><span class="line">            <span class="keyword">await</span> partial.handle(scope, receive, send)  </span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># é‡å®šå‘</span></span><br><span class="line">        <span class="keyword">if</span> scope[<span class="string">"type"</span>] == <span class="string">"http"</span> <span class="keyword">and</span> self.redirect_slashes <span class="keyword">and</span> scope[<span class="string">"path"</span>] != <span class="string">"/"</span>:</span><br><span class="line">            redirect_scope = dict(scope)</span><br><span class="line">            <span class="keyword">if</span> scope[<span class="string">"path"</span>].endswith(<span class="string">"/"</span>):</span><br><span class="line">                redirect_scope[<span class="string">"path"</span>] = redirect_scope[<span class="string">"path"</span>].rstrip(<span class="string">"/"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                redirect_scope[<span class="string">"path"</span>] = redirect_scope[<span class="string">"path"</span>] + <span class="string">"/"</span></span><br><span class="line">            <span class="keyword">for</span> route <span class="keyword">in</span> self.routes:</span><br><span class="line">                match, child_scope = route.matches(redirect_scope)</span><br><span class="line">                <span class="keyword">if</span> match != Match.NONE:</span><br><span class="line">                    redirect_url = URL(scope=redirect_scope)</span><br><span class="line">                    response = RedirectResponse(url=str(redirect_url))</span><br><span class="line">                    <span class="keyword">await</span> response(scope, receive, send)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># é»˜è®¤é€»è¾‘</span></span><br><span class="line">        <span class="keyword">await</span> self.default(scope, receive, send)</span><br></pre></td></tr></table></figure>
<p>ç”±äºæˆ‘ä»¬åœ¨<code>start-fastapi</code>é¡¹ç›®ä¸­ï¼Œé€šè¿‡<code>APIRouter</code>å®šä¹‰äº†è¿™ä¸ªè·¯ç”±çš„<code>handler</code>ï¼Œæ³¨å†Œåˆ°äº†<code>Starlette</code>ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ============ start-fastapi ============</span></span><br><span class="line"><span class="comment"># core/handler/base.py</span></span><br><span class="line">ROUTER = APIRouter()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ROUTER.get('/api/v1/core/health')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">health_check</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> Resp.ok(message=<span class="string">'ok'</span>)</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆ<code>/api/v1/core/health</code>å°±ä¼šè¢«å®Œæ•´åŒ¹é…ï¼Œèµ°åˆ°å¯¹åº”è·¯ç”±å®ä¾‹çš„<code>handle</code>æ­¥éª¤ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># starlette/routing.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Route</span><span class="params">(BaseRoute)</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self, scope: Scope, receive: Receive, send: Send)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.methods <span class="keyword">and</span> scope[<span class="string">"method"</span>] <span class="keyword">not</span> <span class="keyword">in</span> self.methods:  <span class="comment"># æ²¡æœ‰å¯¹åº”çš„method</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"app"</span> <span class="keyword">in</span> scope:</span><br><span class="line">                <span class="keyword">raise</span> HTTPException(status_code=<span class="number">405</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                response = PlainTextResponse(<span class="string">"Method Not Allowed"</span>, status_code=<span class="number">405</span>)</span><br><span class="line">            <span class="keyword">await</span> response(scope, receive, send)</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># æœ‰methodï¼Œç›´æ¥å¤„ç†</span></span><br><span class="line">            <span class="keyword">await</span> self.app(scope, receive, send)</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request_response</span><span class="params">(func: typing.Callable)</span> -&gt; ASGIApp:</span></span><br><span class="line">    is_coroutine = iscoroutinefunction_or_partial(func)</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">app</span><span class="params">(scope: Scope, receive: Receive, send: Send)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        request = Request(scope, receive=receive, send=send)</span><br><span class="line">        <span class="keyword">if</span> is_coroutine:</span><br><span class="line">            response = <span class="keyword">await</span> func(request)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            response = <span class="keyword">await</span> run_in_threadpool(func, request)</span><br><span class="line">        <span class="keyword">await</span> response(scope, receive, send)</span><br><span class="line">    <span class="keyword">return</span> app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># fastapi/routing.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_request_handler</span><span class="params">()</span> -&gt; Callable[[Request], Coroutine[Any, Any, Response]]:</span></span><br><span class="line">    raw_response = <span class="keyword">await</span> run_endpoint_function(</span><br><span class="line">        dependant=dependant, values=values, is_coroutine=is_coroutine</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">run_endpoint_function</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    *, dependant: Dependant, values: Dict[str, Any], is_coroutine: bool</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> -&gt; Any:</span></span><br><span class="line">    <span class="keyword">assert</span> dependant.call <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, <span class="string">"dependant.call must be a function"</span></span><br><span class="line">    <span class="keyword">if</span> is_coroutine:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> dependant.call(**values)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> run_in_threadpool(dependant.call, **values)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">run_in_threadpool</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    func: typing.Callable[..., T], *args: typing.Any, **kwargs: typing.Any</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> -&gt; T:</span></span><br><span class="line">    loop = asyncio.get_event_loop()</span><br><span class="line">    <span class="keyword">if</span> contextvars <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># pragma: no cover</span></span><br><span class="line">        <span class="comment"># Ensure we run in the same context</span></span><br><span class="line">        child = functools.partial(func, *args, **kwargs)</span><br><span class="line">        context = contextvars.copy_context()</span><br><span class="line">        func = context.run</span><br><span class="line">        args = (child,)</span><br><span class="line">    <span class="keyword">elif</span> kwargs:  <span class="comment"># pragma: no cover</span></span><br><span class="line">        func = functools.partial(func, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> loop.run_in_executor(<span class="literal">None</span>, func, *args)</span><br></pre></td></tr></table></figure>
<p>ç”±äºæˆ‘ä»¬å¯¹å¥åº·æ£€æŸ¥è·¯ç”±å®šä¹‰äº†<code>GET</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªè·¯ç”±å°±æ”¯æŒå¤„ç†ã€‚æœ€ç»ˆæ¥åˆ°äº†<code>FastAPI</code>çš„<code>run_endpoint_function</code>æ–¹æ³•ï¼Œè°ƒç”¨æˆ‘ä»¬å®šä¹‰çš„<code>Controller</code>ã€‚ç”±äºæˆ‘ä»¬æ˜¯ç›´æ¥<code>def health_check()</code>ï¼Œå› æ­¤ä¼šèµ°åˆ°<code>loop.run_in_executor</code>çº¿ç¨‹æ± æ–¹æ³•ï¼Œå»æ‰§è¡Œ<code>Controller</code>ï¼Œç„¶åè¿”å›ç»“æœã€‚å¦åˆ™å¦‚æœæ˜¯<code>async def</code>å®šä¹‰çš„<code>Controller</code>çš„è¯ï¼Œå°±ç›´æ¥<code>await</code>ã€‚</p>
<p>æ‰€ä»¥æ•´ä¸ªè¯·æ±‚è¿”å›çš„é“¾è·¯å°±å®Œæˆäº†ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿä¼šçœ‹åˆ°ï¼Œé’ˆå¯¹éœ€è¦è€—æ—¶è€—<code>CPU</code>çš„è¯·æ±‚ï¼Œå°½é‡ä¸è¦ç”¨<code>async def</code>å®šä¹‰<code>FastAPI</code>çš„<code>Controller</code>ï¼Œå¦åˆ™ä¼šæœ‰é˜»å¡æ•´ä¸ª<code>asyncio</code>äº‹ä»¶å¾ªç¯çš„é£é™©ï¼Œè€Œç”¨çº¿ç¨‹æ± å¤„ç†å°±å¯ä»¥è§„é¿è¿™ç§æƒ…å†µã€‚</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>fastapi</tag>
        <tag>WSGI</tag>
        <tag>ASGI</tag>
        <tag>uvicorn</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Game Of AutoTestã€‘2ã€æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æŠ€æœ¯é€‰å‹</title>
    <url>/2022/08/13/gameofautotest/ii/</url>
    <content><![CDATA[<p>è¦åšæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé¦–å…ˆéœ€è¦äº†è§£æ¸¸æˆè‡ªåŠ¨åŒ–æŠ€æœ¯ã€‚å› æ­¤ï¼Œæœ¬æ–‡è¯¦ç»†è®²è§£ä¸‹æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•é¢†åŸŸå¯èƒ½ç”¨åˆ°çš„ä¸€äº›æŠ€æœ¯ä»¥åŠå¯¹åº”çš„åœºæ™¯ï¼Œä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•è½åœ°çš„æŠ€æœ¯é€‰å‹æä¾›å‚è€ƒã€‚</p>
<p>æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æµ‹è¯•å¯¹è±¡æ˜¯æ¸¸æˆæœ¬èº«ã€‚å¯¹äºæ¸¸æˆè¿™ä¸ªæ¦‚å¿µï¼Œå¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ï¼šæˆ‘ä»¬å®é™…ç©åˆ°çš„æ¸¸æˆæœ¬ä½“ï¼Œæ¯”å¦‚è¯´PCç¨‹åºï¼Œæ‰‹æœºAppï¼ŒWeb-Appã€‚</li>
<li>æœåŠ¡å™¨ï¼šåœ¨å¤šäººç½‘ç»œæ¸¸æˆä¸­ï¼Œç”¨ä»¥æ¨¡æ‹Ÿæ¸¸æˆä¸–ç•Œçš„æœ¬ä½“ã€‚</li>
<li>ç¼–è¾‘å™¨ï¼šåŒ…å«æœªçƒ˜ç„™åˆ°OSå¹³å°çš„æ¸¸æˆç¨‹åºä»¥åŠèµ„æºã€‚</li>
</ul>
<p>æˆ‘ä»¬åœ¨æŠ€æœ¯å±‚é¢ä¸Šæ‰€è¦åšåˆ°çš„ï¼Œå°±æ˜¯é€šè¿‡æŸäº›æ–¹å¼è®¿é—®è¿™äº›ç¨‹åºè¿è¡Œç¯å¢ƒäº§ç”Ÿçš„å†…å®¹ï¼Œæ”¹å˜æ¸¸æˆå‘ˆç°ä»¥åŠç©å®¶è¡Œä¸ºï¼Œæ“ä½œç©å®¶æˆ–æ¸¸æˆç¨‹åºæœ¬èº«ï¼Œè¾¾åˆ°æˆ‘ä»¬çš„æµ‹è¯•ç›®çš„ã€‚åœ¨ç¬”è€…çš„å·¥ä½œç»éªŒå½“ä¸­ï¼Œä¸»è¦åšçš„æ˜¯<code>UE</code>å®‰å“å®¢æˆ·ç«¯çš„è‡ªåŠ¨åŒ–ï¼Œåº”ç”¨åœºæ™¯ä¸»è¦åœ¨ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•æ–¹é¢ï¼Œå› æ­¤æœ¬æ–‡ä¼šå¯¹å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–åšç¨å¾®è¯¦å°½çš„è§£æã€‚å…¶ä»–è‡ªåŠ¨åŒ–çš„æ–¹æ¡ˆå’Œå™è¿°ï¼Œå¦‚æœå…¶ä¸­æè¿°æœ‰æ‰€çº°æ¼ï¼Œæ³è¯·æŒ‡æ­£ã€‚</p>
<h2 id="å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–"><a href="#å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–" class="headerlink" title="å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–"></a>å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–</h2><p>é’ˆå¯¹æ¸¸æˆå®¢æˆ·ç«¯çš„è‡ªåŠ¨åŒ–ï¼Œåœ¨æ¸¸æˆæµ‹è¯•é‡Œæ˜¯æœ€ä¸ºå¹¿æ³›åº”ç”¨çš„ï¼Œä¸ä»…æ˜¯å› ä¸ºå®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªæ¸¸æˆå¿…é¡»æœ‰çš„æˆåˆ†ï¼Œè€Œæ›´åŠ å› ä¸ºæˆ‘ä»¬åœ¨æ‰‹å·¥æµ‹è¯•æ¸¸æˆçš„æ—¶å€™ï¼Œå®é™…æ˜¯æ‹¿ç€å®¢æˆ·ç«¯æ¥æµ‹çš„ã€‚å› æ­¤ï¼Œå®¢æˆ·ç«¯è‡ªåŠ¨åŒ–ä¼šæœ€è´´åˆæ¸¸æˆåŠŸèƒ½æµ‹è¯•çš„éœ€æ±‚ã€‚</p>
<p>è¦å®ç°å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–ï¼Œæœ‰ä»¥ä¸‹çš„æ–¹æ³•ï¼š</p>
<a id="more"></a>
<ul>
<li>è„šæœ¬è‡ªåŠ¨åŒ–ï¼šé€šè¿‡æ¸¸æˆè„šæœ¬ä»£ç é©±åŠ¨æ¸¸æˆè¿è¡Œã€‚<ul>
<li>é€‚ç”¨äºä¸šåŠ¡é€»è¾‘ä¸»è¦é‡‡ç”¨å¯çƒ­æ›´çš„è„šæœ¬è¯­è¨€ï¼ˆå¦‚<code>lua</code>ã€<code>js</code>ï¼‰ç¼–å†™çš„æ¸¸æˆã€‚</li>
<li>æ¸¸æˆå¯¹å¤–æš´éœ²ä¸€ä¸ªæ¥å£ï¼Œå¯¹è¿™ä¸ªæ¥å£å‘é€è„šæœ¬ä»£ç ï¼Œæ¸¸æˆå†…éƒ¨å³å¯è‡ªåŠ¨æ‰§è¡Œè¿™æ®µè„šæœ¬ä»£ç ã€‚</li>
</ul>
</li>
<li>UIè‡ªåŠ¨åŒ–ï¼šé€šè¿‡UIæ“ä½œé©±åŠ¨æ¸¸æˆè¿è¡Œï¼Œåˆ†ä¸ºUIæŸ¥è¯¢ã€UIæ“ä½œä¸¤éƒ¨åˆ†ã€‚<ul>
<li>UIæŸ¥è¯¢å¯ä»¥é€šè¿‡å›¾åƒè¯†åˆ«/OCRè¯†åˆ«æ¨æ–­æ§ä»¶æ‰€åœ¨åæ ‡ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»æ¸¸æˆè¿è¡Œç¯å¢ƒä¸­å¯¼å‡ºUIæ§ä»¶æ ‘ï¼Œè·å–æ¯ä¸ªæ§ä»¶çš„å±æ€§å’Œåœ¨è§†å£é‡Œçš„åæ ‡æ•°æ®ã€‚<ul>
<li>ç”±æ§ä»¶æ ‘å®šä½æ§ä»¶çš„æ–¹æ¡ˆï¼Œç›¸è¾ƒäºå›¾åƒè¯†åˆ«çš„æ–¹æ¡ˆï¼Œç¨³å®šæ€§ä¼šæ›´é«˜ï¼Œä½†ä¹Ÿéœ€è¦ä¸€å®šçš„å®šä½ç­–ç•¥ã€‚é€šå¸¸æ¥è®²ï¼Œæ§ä»¶ä¹‹é—´çš„å±‚çº§å…³ç³»ä¸ä¼šæœ‰å¤ªå¤šçš„å˜åŒ–ï¼Œè€Œæ§ä»¶çš„åç§°ä¼šå¾®è°ƒï¼Œå› æ­¤å¯ä»¥é€šè¿‡å…³é”®å­—+å±‚çº§å…³ç³»çš„æ¡ä»¶å»ç²¾å‡†ç­›é€‰æ§ä»¶ã€‚</li>
<li>å›¾åƒè¯†åˆ«æ–¹æ¡ˆä¸ç¨³å®šåœ¨äºå‡ ç‚¹ï¼šå›¾åƒè¯†åˆ«æŠ€æœ¯æœ¬èº«çš„ä¸ç¡®å®šæ€§ï¼Œä»¥åŠUIé£æ ¼è¿­ä»£å¯¼è‡´å›¾åƒè¯†åˆ«çš„åŸºçº¿æ•°æ®å¤±æ•ˆã€‚</li>
</ul>
</li>
<li>UIæ“ä½œå¯ä»¥é€šè¿‡<code>adb</code>ä¹‹ç±»çš„æ–¹å¼ç›´æ¥æ¨¡æ‹Ÿå±å¹•æ“ä½œï¼›ä¹Ÿå¯ä»¥åœ¨æ¸¸æˆä¸­è¿è¡Œä¸€ä¸ªUIè‡ªåŠ¨åŒ–æ¨¡å—ï¼Œæµ‹è¯•äººå‘˜å¯ä»¥å‘è¿™ä¸ªæ¨¡å—è¯·æ±‚å¯¹æŸä¸ªUIå‘èµ·ç‚¹å‡»/æŒ‰ä¸‹/é‡Šæ”¾çš„æ“ä½œï¼Œè€Œåè¿™ä¸ªæ¨¡å—å†…éƒ¨æ‰§è¡ŒUIå®ä¾‹<code>OnClick/OnPress/OnRelease</code>çš„å§”æ‰˜ã€‚</li>
</ul>
</li>
<li>æŒ‡ä»¤è‡ªåŠ¨åŒ–ï¼šåœ¨æ¸¸æˆé€»è¾‘ä¸­é¢„ç½®ä¸€äº›ç©å®¶æ“ä½œæ¥å£ä»¥åŠå‚æ•°ï¼Œé€šè¿‡è°ƒç”¨æŒ‡ä»¤å®ç°ç©å®¶æ“æ§ã€‚<ul>
<li>æ¸¸æˆå†…éƒ¨æš´éœ²ç»™å¤–éƒ¨æŒ‡ä»¤è°ƒç”¨æ¥å£ï¼Œå¤–éƒ¨å‘é€æŒ‡ä»¤å’Œå‚æ•°ï¼Œç„¶åæ¸¸æˆå†…éƒ¨åš<code>dispatch</code>ï¼Œå»æ‰§è¡Œå¯¹åº”å°è£…å¥½çš„æŒ‡ä»¤ã€‚</li>
<li>å¯¹äºæ‰‹å·¥æµ‹è¯•éœ€æ±‚è€Œè¨€æ˜¯æ ‡é…ï¼Œå¯¹äºè‡ªåŠ¨åŒ–æµ‹è¯•éœ€æ±‚è€Œè¨€ï¼Œåªéœ€è¦é¢å¤–æ”¯æŒå¤–éƒ¨ç¨‹åºè°ƒç”¨è¿™äº›å†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<p>å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–çš„å¼€æºå®ç°ä¹Ÿæœ‰ä¸å°‘ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒå¹¿æ³›åº”ç”¨ï¼š<code>Airtest</code>å’Œ<code>GAutomator</code>ã€‚</p>
<ul>
<li><code>Airtest</code>ï¼šä¸€ä¸ªå®Œæ•´çš„æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹æ¡ˆï¼Œå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9haXJ0ZXN0LmRvYy5pby5uZXRlYXNlLmNvbS8=" title="https://airtest.doc.io.netease.com/">è¿™ä¸ªæ–‡æ¡£<i class="fa fa-external-link"></i></span><ul>
<li>ä¸»è¦å®ç°çš„æ˜¯é¢å‘ä¸åŒå¹³å°åº”ç”¨çš„UIè‡ªåŠ¨åŒ–ï¼Œå¹¶ä¸”è‡ªå¸¦IDEã€‚</li>
<li>åº•å±‚æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FpcnRlc3RQcm9qZWN0L1BvY28tU0RL" title="https://github.com/AirtestProject/Poco-SDK">PocoSDK<i class="fa fa-external-link"></i></span>ï¼Œæ”¯æŒ<code>Android/iOS</code>çš„<code>Native</code>æ§ä»¶ï¼Œä¹Ÿæ”¯æŒ<code>Unity/UE/Cocos</code>åº”ç”¨ã€‚</li>
</ul>
</li>
<li><code>GAutomator</code>ï¼šé’ˆå¯¹<code>Unity</code>ã€<code>UE</code>çš„UIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œæºç åœ¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvR0F1dG9tYXRvcg==" title="https://github.com/Tencent/GAutomator">è¿™é‡Œ<i class="fa fa-external-link"></i></span><ul>
<li>ç›¸å¯¹<code>Airtest</code>æ¯”è¾ƒè½»é‡çº§ï¼Œé€‚åˆé›†æˆ+äºŒæ¬¡å¼€å‘</li>
</ul>
</li>
</ul>
<p>ä¸€èˆ¬æ¥è®²ï¼Œå¼€æºçš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆåŸºæœ¬ä¸Šæ˜¯UIè‡ªåŠ¨åŒ–ç›¸å…³ï¼Œè€Œè„šæœ¬è‡ªåŠ¨åŒ–å’ŒæŒ‡ä»¤è‡ªåŠ¨åŒ–ï¼Œåˆ™éœ€è¦ä¾æ®ä¸åŒæ¸¸æˆé¡¹ç›®çš„å®ç°å»è‡ªå®šä¹‰ç›¸å…³é€»è¾‘ã€‚</p>
<p>å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–é€‚ç”¨äºä»¥ä¸‹çš„åœºæ™¯ï¼š</p>
<ul>
<li>åŠŸèƒ½æµ‹è¯•ï¼šä»£æ›¿äººå·¥æµ‹è¯•å·¥ä½œã€‚<ul>
<li>ç©æ³•å†’çƒŸæµ‹è¯•ï¼šé€‚ç”¨äºå„ä¸ªç©æ³•çš„åŸºç¡€åŠŸèƒ½å†’çƒŸã€‚<ul>
<li>å¯ä»¥åº”ç”¨äºå¼ºUIçš„ç©æ³•ï¼Œæ¯”å¦‚å•†ä¸šåŒ–ã€æ´»åŠ¨ã€ç¤¾äº¤ã€è£…å¤‡ä¸€ç±»ã€‚</li>
<li>å¯ä»¥åº”ç”¨äºæµç¨‹ç±»çš„ç©æ³•ï¼Œæ¯”å¦‚å‰¯æœ¬ã€ä»»åŠ¡ä¸€ç±»ã€‚</li>
</ul>
</li>
<li>åŠŸèƒ½éå†æµ‹è¯•ï¼šé€‚ç”¨äºæ“ä½œä¸å¤æ‚ä½†é‡å¤é‡è¾ƒå¤§ï¼Œç¹çè€—æ—¶çš„åŠŸèƒ½æµ‹è¯•ä»»åŠ¡ã€‚<ul>
<li>ä¾æ®ä¸åŒç©æ³•çš„æµ‹è¯•ç‚¹ç‰¹æ€§è€Œå®šï¼Œæ¯ä¸ªç©æ³•å¯èƒ½éƒ½æœ‰æµ‹è¯•ç‚¹æ˜¯éå†æ€§è´¨çš„ã€‚</li>
<li>å¯ä»¥åº”ç”¨äºåœ°å›¾/å¤§ä¸–ç•Œç›¸å…³çš„è·‘æµ‹ï¼Œæ¯”å¦‚å¯¹åœºæ™¯ç‰©ä»¶ã€å¯»è·¯ã€ç©ºæ°”å¢™ã€åˆ‡çº¿çš„æ•ˆæœæ£€æŸ¥ã€‚</li>
<li>å¯ä»¥åº”ç”¨äºç©å®¶çŠ¶æ€æœºã€<code>Buff</code>æˆ–æ˜¯æŠ€èƒ½æ•ˆæœçš„éå†æµ‹è¯•ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>ä¸“é¡¹æµ‹è¯•ï¼šè‡ªåŠ¨æ‰§è¡Œæ•´ä¸ªä¸“é¡¹æµ‹è¯•æµç¨‹ï¼Œæˆ–æ˜¯ä½œä¸ºæµç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›å¯¹æµ‹è¯•æœ‰ç”¨çš„ä¿¡æ¯ã€‚<ul>
<li>å®¢æˆ·ç«¯æ€§èƒ½æµ‹è¯•ï¼šè·‘æµ‹æ¸¸æˆå®¢æˆ·ç«¯ï¼Œå¹¶åœ¨å…¶ä¸­æ”¶é›†æ¸¸æˆä»¥åŠè®¾å¤‡çš„æ€§èƒ½æ•°æ®ï¼Œç”¨äºåšæ€§èƒ½åˆ†æã€‚</li>
<li>å®¢æˆ·ç«¯é€‚é…æµ‹è¯•ï¼šè·‘æµ‹ä¸åŒæœºå‹çš„å®¢æˆ·ç«¯ï¼Œè¦†ç›–ä¸€äº›ç®€å•çš„åœºæ™¯è·Ÿæ“ä½œï¼Œçœ‹æ€§èƒ½æˆ–è€…è¡¨ç°ä¸Šæ˜¯å¦ä¸€è‡´ã€‚</li>
<li>UIä¸“é¡¹æµ‹è¯•ï¼šè¿™é‡ŒæŒ‡UIçŠ¶æ€äº’æ–¥ã€UIå±‚çº§å…³ç³»è¿™ä¸€ç±»éå¼ºä¸šåŠ¡ç›¸å…³çš„ä¸“é¡¹æµ‹è¯•ç‚¹ã€‚</li>
<li>ç©æ³•ä¸šåŠ¡ä¸“é¡¹ï¼šè·‘æµ‹æ¸¸æˆå®¢æˆ·ç«¯ï¼Œæ”¶é›†ç‰¹å®šæ¸¸æˆç©æ³•æ•°æ®ï¼Œç”¨äºç©å®¶çŠ¶æ€æ£€æŸ¥ã€ç©æ³•æ•ˆæœè¯„ä¼°ã€æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ç­‰æµ‹è¯•ç‚¹ã€‚éœ€è¦æŒ‰å„ä¸ªç©æ³•çš„ç‰¹æ€§å»è‡ªå®šä¹‰è‡ªåŠ¨è·‘æµ‹é€»è¾‘ã€‚</li>
<li>ç©æ³•ç¯å¢ƒæ„é€ ï¼šè°ƒç”¨å¤šå°å®¢æˆ·ç«¯æœºå™¨ï¼Œè‡ªåŠ¨æ¸¸ç©ä¸€ä¸ªç©æ³•ï¼Œæ¨¡æ‹Ÿå¤šäººåœºæ™¯ã€‚<ul>
<li>ç”¨çœŸå®å®¢æˆ·ç«¯æ„é€ åœºæ™¯ï¼Œé€šå¸¸ä¼šæ¶ˆè€—è®¸å¤šçº¿ä¸Šæœºå™¨èµ„æºã€‚å› æ­¤åœ¨èµ„æºç´§ç¼ºæˆ–æ˜¯çº¿ä¸Šè¿è¡Œç¯å¢ƒä¸ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œä¸å»ºè®®é‡‡å–æ­¤æ–¹æ¡ˆã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ä¸è®ºæ˜¯åŠŸèƒ½è¿˜æ˜¯ä¸“é¡¹æµ‹è¯•åœºæ™¯ï¼Œåœ¨è‡ªåŠ¨åŒ–è¡Œä¸ºçš„å®ç°ä¸Šï¼Œè„šæœ¬ã€UIã€æŒ‡ä»¤ä¸‰ç§è‡ªåŠ¨åŒ–æ–¹å¼éƒ½å¯ä»¥ç›¸äº’ç»“åˆã€‚è¿™æ˜¯å› ä¸ºï¼Œä»æ¸¸æˆæµ‹è¯•ç”¨ä¾‹è¿‡ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸€ä¸ªæ­¥éª¤å…¶å®éƒ½æ˜¯ä¸€ä¸ªç©å®¶æ“ä½œï¼Œè€Œç©å®¶æ“ä½œçš„å®ç°ï¼Œå¯ä»¥æ˜¯å‘ä¸€æ®µè„šæœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯ç‚¹æŸä¸ªUIï¼Œæ›´å¯ä»¥æ˜¯æ‰§è¡Œä¸€ä¸ªæŒ‡ä»¤ã€‚</p>
<p>ç›¸å¯¹äºå…¶å®ƒè‡ªåŠ¨åŒ–æ–¹å¼ï¼Œè„šæœ¬è‡ªåŠ¨åŒ–çš„å®ç°æ–¹æ¡ˆæ˜¯æœ€ä¼˜å…ˆçš„ï¼Œè¿™æ˜¯å› ä¸ºèƒ½å¤Ÿæ”¯æŒçƒ­æ‰§è¡Œå®¢æˆ·ç«¯è„šæœ¬çš„è¯ï¼Œç†è®ºä¸Šå¯ä»¥æ“çºµæ•´ä¸ªå®¢æˆ·ç«¯çš„è¿è¡Œï¼Œä»è€Œèƒ½å¤Ÿæ»¡è¶³æ›´å¤šè‡ªåŠ¨åŒ–è¡Œä¸ºçš„éœ€æ±‚ã€‚å› æ­¤å¦‚æœæœ‰æ¡ä»¶ï¼Œæ¯”å¦‚è¯´æµ‹è¯•ä¾§æœ‰é¡¹ç›®çš„æºä»£ç æƒé™ï¼Œé‚£ä¹ˆè‡ªåŠ¨åŒ–è¡Œä¸ºçš„å®ç°ï¼Œå°±ä¼˜å…ˆé‡‡ç”¨è„šæœ¬ç¼–å†™çš„æ–¹æ¡ˆï¼Œè€Œå¯¹äºä¸€äº›éœ€è¦å¤æ‚è„šæœ¬å®ç°çš„è¡Œä¸ºï¼Œæ‰ç”¨UIæ“ä½œä»£æ›¿ã€‚å¦‚æœæ²¡æœ‰æºç æ¡ä»¶ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åœ¨å®¢æˆ·ç«¯æºç é‡ŒæŠ½å‡ºä¸€ä¸ªå•ç‹¬çš„<code>project</code>ï¼ŒåŒ…è£…é¡¹ç›®ä»£ç <code>API</code>ç±»å‹ä¿¡æ¯ä»¥åŠä¸€ç³»åˆ—è‡ªåŠ¨åŒ–æŒ‡ä»¤ï¼Œåšæˆä¸€ä¸ªæµ‹è¯•ä¾§ä¹Ÿå¯ä»¥å•ç‹¬ç»´æŠ¤çš„è‡ªåŠ¨åŒ–åº•å±‚æ¨¡å—ã€‚</p>
<h2 id="æœåŠ¡å™¨è‡ªåŠ¨åŒ–"><a href="#æœåŠ¡å™¨è‡ªåŠ¨åŒ–" class="headerlink" title="æœåŠ¡å™¨è‡ªåŠ¨åŒ–"></a>æœåŠ¡å™¨è‡ªåŠ¨åŒ–</h2><p>é’ˆå¯¹æœåŠ¡å™¨çš„è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯éå¸¸å…³é”®çš„ä¸€éƒ¨åˆ†ã€‚æ¯”å¦‚æˆ‘ä»¬ç»å¸¸æåˆ°çš„æœåŠ¡å™¨å‹æµ‹ï¼Œå…¶å®æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è‡ªåŠ¨åŒ–é©±åŠ¨çš„é€»è¾‘ã€‚ä»æ•´ä¸ªæ¸¸æˆäº§å“çš„è´¨é‡ä¿è¯è€Œè¨€ï¼ŒæœåŠ¡å™¨è‡ªåŠ¨åŒ–åŒæ ·æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚</p>
<p>è¦å®ç°æœåŠ¡å™¨è‡ªåŠ¨åŒ–ï¼Œä¸€èˆ¬æ˜¯ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>åè®®äº¤äº’ï¼šé€šè¿‡<code>C/S</code>åè®®äº¤äº’çš„æ–¹å¼é©±åŠ¨æ¸¸æˆé€»è¾‘è¿›è¡Œ<ul>
<li>ä¸€èˆ¬æ˜¯é€šè¿‡ä¸€ä¸ªæœºå™¨äººå®¢æˆ·ç«¯è¿åˆ°æœåŠ¡å™¨ï¼Œä½œä¸ºä¸€ä¸ªç©å®¶çš„èº«ä»½å‘é€ç™»å½•åè®®ç™»å…¥æ¸¸æˆï¼Œç„¶åå†å‘é€å…¶ä»–<code>C/S</code>åè®®ï¼Œä»è€Œé©±åŠ¨ç©å®¶åšæŸäº›è¡Œä¸ºï¼Œæˆ–è€…æ˜¯è¾¾åˆ°æŸäº›çŠ¶æ€ã€‚</li>
</ul>
</li>
<li>å†…éƒ¨æŒ‡ä»¤è°ƒç”¨ï¼šæœåŠ¡å™¨é¢„ç¼–å†™ä¸€äº›æµ‹è¯•æ¥å£ï¼Œé€šè¿‡è°ƒç”¨è¿™äº›æ¥å£é©±åŠ¨æœåŠ¡å™¨é€»è¾‘ã€‚<ul>
<li>å¯ä»¥æ˜¯é€šè¿‡æœºå™¨äººå®¢æˆ·ç«¯è¿åˆ°æœåŠ¡å™¨ï¼Œå‘é€ç™»å½•åè®®ç™»å…¥æ¸¸æˆï¼Œä½†ä¹‹åä¸ç›´æ¥é€šè¿‡<code>C/S</code>åè®®ï¼Œè€Œæ˜¯é€šè¿‡æŸäº›å¤–éƒ¨è°ƒç”¨ï¼Œæˆ–è€…æ˜¯è¿™ä¸ªæœºå™¨äººå‘é€æŸä¸ªç‰¹å®šçš„æŒ‡ä»¤ï¼Œé©±åŠ¨æœåŠ¡å™¨é€»è¾‘ï¼Œä»è€Œè®©æœºå™¨äººå‚ä¸åˆ°æŸäº›æµ‹è¯•æ´»åŠ¨å½“ä¸­ã€‚</li>
</ul>
</li>
</ul>
<p>å…·ä½“çš„æŠ€æœ¯å®ç°ï¼Œå®é™…å¾—ä¾æ®æœåŠ¡å™¨æœ¬èº«çš„æŠ€æœ¯æ ˆä»¥åŠåè®®äº¤äº’çš„æŠ€æœ¯æ ˆè€Œå®šï¼Œå¹¶æ²¡æœ‰ä¸€å¥—ç¡®å®šçš„æ–¹æ¡ˆã€‚</p>
<p>æœåŠ¡å™¨è‡ªåŠ¨åŒ–é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>æœåŠ¡å™¨ä»£ç å•å…ƒæµ‹è¯•<ul>
<li>ç”¨ä»¥åœ¨ç¨‹åºå±‚é¢æµ‹è¯•æœåŠ¡å™¨çš„åŸºç¡€ä»£ç é€»è¾‘ï¼Œé€šå¸¸ä¼šé…åˆ<code>CI</code>æµæ°´çº¿ä½¿ç”¨ã€‚</li>
<li>ä¹Ÿå¯ä»¥é…åˆä»£ç è¦†ç›–ç‡æµ‹è¯•å·¥å…·ä¸€èµ·ä½¿ç”¨ï¼Œç”¨ä»¥è§‚æµ‹æµ‹è¯•ç”¨ä¾‹/ä»£ç å®ç°çš„å®Œæ•´æ€§ã€‚</li>
<li>å®ç°ä¸Šï¼Œå¯ä»¥è°ƒç”¨æŸä¸ªæ¥å£æŒ‡ä»¤ï¼Œä¸€æ¬¡æ€§æ‰¹é‡æˆ–æœ‰åºåœ°æ‰§è¡ŒæœåŠ¡å™¨ä¸šåŠ¡æ¨¡å—çš„å•å…ƒæµ‹è¯•ä»£ç ã€‚</li>
</ul>
</li>
<li>å‹åŠ›æµ‹è¯•<ul>
<li>é©±åŠ¨å¤šä¸ªæœºå™¨äººç™»å½•æœåŠ¡å™¨ï¼Œæ¨¡æ‹Ÿç©å®¶æ“ä½œã€‚</li>
<li>éœ€é…åˆæœåŠ¡å™¨æ€§èƒ½ç›‘æ§å·¥å…·ï¼Œè§‚æµ‹æœåŠ¡é“¾è·¯æ€§èƒ½è¡¨å¾ï¼Œåˆ†ææ€§èƒ½ç“¶é¢ˆã€‚</li>
</ul>
</li>
<li>åŠŸèƒ½æµ‹è¯•ç¯å¢ƒæ„é€ <ul>
<li>å®ç°åŸç†å’Œå‹åŠ›æµ‹è¯•ç±»ä¼¼ï¼Œé€šå¸¸ä¼šæ¶‰åŠå¤šä¸ªæœºå™¨äººç©å®¶åœ¨æ¸¸æˆä¸­æ¼«æ¸¸ã€‚</li>
<li>ç›¸æ¯”äºç”¨å¤šä¸ªçœŸå®å®¢æˆ·ç«¯è®¾å¤‡æ„é€ å¤šäººç©æ³•ç¯å¢ƒçš„æ–¹æ³•ï¼Œé€šè¿‡æœºå™¨äººæ„é€ æ›´åŠ æ–¹ä¾¿ï¼Œä¸æµªè´¹è®¾å¤‡èµ„æºã€‚</li>
<li>å¯ä»¥åº”ç”¨äºåŒ¹é…ã€ç™»å½•ã€ä¸–ç•Œ<code>Boss</code>ç­‰æ¶‰åŠæµ·é‡ç©å®¶å‚ä¸çš„ç©æ³•æ¨¡å—ã€‚</li>
</ul>
</li>
<li>æœåŠ¡å™¨åè®®å®‰å…¨æµ‹è¯•<ul>
<li>åŒæ ·å¯ä»¥é€šè¿‡æœºå™¨äººçš„æ–¹å¼é©±åŠ¨ï¼Œä½†æµ‹è¯•ç­–ç•¥éœ€å‚è€ƒåè®®æµ‹è¯•éœ€æ±‚ã€‚</li>
<li>é€šå¸¸çš„æµ‹è¯•ç›®æ ‡æ˜¯ï¼Œç»•è¿‡å®¢æˆ·ç«¯åšæ¸¸æˆæœºåˆ¶é™å®šä¹‹å¤–çš„è¯·æ±‚ï¼Œé¢„æœŸæ— æ³•é€šè¿‡æœåŠ¡å™¨ä¸šåŠ¡é€»è¾‘çš„æ ¡éªŒã€‚</li>
</ul>
</li>
</ul>
<h2 id="ç¼–è¾‘å™¨è‡ªåŠ¨åŒ–"><a href="#ç¼–è¾‘å™¨è‡ªåŠ¨åŒ–" class="headerlink" title="ç¼–è¾‘å™¨è‡ªåŠ¨åŒ–"></a>ç¼–è¾‘å™¨è‡ªåŠ¨åŒ–</h2><p>ç¼–è¾‘å™¨ä»£è¡¨ç€æ¸¸æˆçš„å¼€å‘ç¯å¢ƒï¼Œå…¶ä¸­çš„èµ„æºä¼šç›´æ¥å½±å“åˆ°æ¸¸æˆçš„æ„å»ºç»“æœï¼Œå› æ­¤é’ˆå¯¹ç¼–è¾‘å™¨åŠèµ„äº§çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä¹Ÿæ˜¯é‡è¦çš„ä¸€éƒ¨åˆ†ã€‚ä»¥<code>UE</code>ä¸ºä¾‹ï¼Œå…¶ä¸­å†…ç½®äº†è®¸å¤šè‡ªåŠ¨åŒ–æµ‹è¯•çš„æœºåˆ¶ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNS4wL3poLUNOL3NjcmlwdGluZy10aGUtdW5yZWFsLWVkaXRvci11c2luZy1weXRob24v" title="https://docs.unrealengine.com/5.0/zh-CN/scripting-the-unreal-editor-using-python/">Python Scriping<i class="fa fa-external-link"></i></span><ul>
<li>é€šè¿‡<code>python</code>è„šæœ¬é©±åŠ¨ç¼–è¾‘å™¨å’Œè¿è¡Œçš„æ‰‹æ®µï¼Œå¯ä»¥ä½œä¸ºç¼–è¾‘å™¨å¼€å‘ç¯å¢ƒçš„ææ•ˆå·¥å…·ï¼Œä¹Ÿå¯ä»¥å¯¹ç¼–è¾‘å™¨èµ„äº§åšæµ‹è¯•æ£€æŸ¥</li>
</ul>
</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9UZXN0aW5nQW5kT3B0aW1pemF0aW9uL0F1dG9tYXRpb24v" title="https://docs.unrealengine.com/4.27/zh-CN/TestingAndOptimization/Automation/">Automation System<i class="fa fa-external-link"></i></span><ul>
<li>æ”¯æŒå¯¹ç¼–è¾‘å™¨èµ„äº§/å¼•æ“åŠŸèƒ½çš„æµ‹è¯•ï¼Œæˆ–æ˜¯åœ¨å…³å¡é‡Œè¿è¡Œæ¸¸æˆåŠŸèƒ½æµ‹è¯•ç”¨ä¾‹</li>
<li>ä¹Ÿå¯ä»¥æ”¯æŒåœ¨å¤šä¸ªå¹³å°åŒæ—¶è¿è¡Œ<code>UE</code>æ¸¸æˆä¼šè¯ï¼Œæ‰§è¡Œç®€å•çš„æµ‹è¯•å†…å®¹ï¼Œæ˜¯ç”¨<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9UZXN0aW5nQW5kT3B0aW1pemF0aW9uL0F1dG9tYXRpb24vR2F1bnRsZXQv" title="https://docs.unrealengine.com/4.27/zh-CN/TestingAndOptimization/Automation/Gauntlet/">Gauntlet<i class="fa fa-external-link"></i></span>æ¡†æ¶å®ç°çš„ã€‚</li>
</ul>
</li>
</ul>
<p>ç¼–è¾‘å™¨è‡ªåŠ¨åŒ–é€‚ç”¨äºä»¥ä¸‹çš„åœºæ™¯ï¼š</p>
<ul>
<li>ç¼–è¾‘å™¨ä¸å¼€å‘è€…å·¥å…·çš„åŠŸèƒ½æµ‹è¯•</li>
<li>å¼•æ“æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•</li>
<li>æ¸¸æˆèµ„äº§é™æ€æµ‹è¯•<ul>
<li>æµ‹è¯•å¯¹è±¡å¯ä»¥æ˜¯ç¾æœ¯ã€UIç”šè‡³æ˜¯ç‰¹å®šç©æ³•çš„èµ„äº§ï¼Œä¸»è¦æµ‹è¯•çš„åœºæ™¯æ˜¯å¯¹èµ„äº§é…ç½®çš„åˆè§„æ€§å’Œå¯ç”¨æ€§æ£€æŸ¥ã€‚</li>
<li>è®¸å¤šæ¸¸æˆå®¢æˆ·ç«¯æœ¬ä½“å’Œç­–åˆ’<code>excel</code>é…ç½®å¯èƒ½æ˜¯åˆ†ç¦»çš„ï¼Œç”±äºåœ¨æœ¬æ–‡èŒƒç•´ä¸­ï¼Œ<code>excel</code>é…ç½®ä¸ç›´æ¥å½±å“æ¸¸æˆæ„å»ºç»“æœï¼Œå› æ­¤å…³äº<code>excel</code>é…ç½®çš„åˆè§„æ€§æ£€æŸ¥æš‚ä¸çº³å…¥æœ¬æ–‡å™è¿°èŒƒå›´ã€‚</li>
</ul>
</li>
<li>å…³å¡é…ç½®æ£€æŸ¥<ul>
<li>æ‰“å¼€ç‰¹å®šå…³å¡/å­å…³å¡ï¼Œé™æ€æ£€æŸ¥å…³å¡å†…åœºæ™¯ç‰©ä»¶é…ç½®çš„åˆè§„æ€§ã€‚</li>
<li>å¯åŠ¨<code>PIE</code>ï¼Œåœ¨æ¸¸ç©æœŸé—´è¿›è¡ŒåŠŸèƒ½æµ‹è¯•ã€‚<ul>
<li>å¦‚æœåé‡äºç³»ç»Ÿç©æ³•çº§çš„åŠŸèƒ½æµ‹è¯•ï¼Œå¹¶ä¸”å®¢æˆ·ç«¯æ„å»ºé¢‘ç¹äº¤ä»˜ï¼Œå®é™…ç”¨å®¢æˆ·ç«¯è‡ªåŠ¨åŒ–æ–¹æ¡ˆä¼šæ›´è´´åˆäº§å“æµ‹è¯•çš„éœ€æ±‚ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="è‡ªåŠ¨åŒ–å‘¨è¾¹æŠ€æœ¯"><a href="#è‡ªåŠ¨åŒ–å‘¨è¾¹æŠ€æœ¯" class="headerlink" title="è‡ªåŠ¨åŒ–å‘¨è¾¹æŠ€æœ¯"></a>è‡ªåŠ¨åŒ–å‘¨è¾¹æŠ€æœ¯</h2><p>å®¢æˆ·ç«¯/æœåŠ¡å™¨/ç¼–è¾‘å™¨è‡ªåŠ¨åŒ–æŠ€æœ¯ï¼Œæ˜¯æ¸¸æˆè‡ªåŠ¨åŒ–å®ç°çš„æœ€åº•å±‚é€»è¾‘ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œè¿˜å¯ä»¥åŠ ç ä¸€äº›å‘¨è¾¹æŠ€æœ¯åŒ…è£…ï¼Œä»è€Œä¼˜åŒ–è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ•ˆæœã€‚</p>
<h3 id="å½•åˆ¶å›æ”¾"><a href="#å½•åˆ¶å›æ”¾" class="headerlink" title="å½•åˆ¶å›æ”¾"></a>å½•åˆ¶å›æ”¾</h3><p>é€šå¸¸åœ¨å¾®æœåŠ¡æµ‹è¯•ä¸­ï¼Œä¼šé€šè¿‡å½•åˆ¶çš„æ–¹å¼è®°å½•çœŸå®è®¿é—®çš„æµé‡ï¼Œä½œä¸ºæµ‹è¯•ç”¨ä¾‹ï¼Œç„¶ååœ¨æµ‹è¯•ç¯å¢ƒéšæ—¶å›æ”¾ï¼Œä»è€Œèµ·åˆ°è§‚æµ‹çœŸå®æµé‡åæ˜ çš„ä½œç”¨ã€‚</p>
<p>åœ¨æ¸¸æˆè‡ªåŠ¨åŒ–ä¸­ï¼Œä¹Ÿå­˜åœ¨å½•åˆ¶å›æ”¾çš„æ“ä½œï¼ŒæœåŠ¡å™¨è·Ÿå®¢æˆ·ç«¯éƒ½èƒ½åšã€‚ä»¥å®¢æˆ·ç«¯ä¸ºä¾‹ï¼Œå½•åˆ¶å›æ”¾ä¸»è¦æ˜¯åœ¨UIæµ‹è¯•ä¸­åº”ç”¨ï¼ŒæŠ€æœ¯å®ç°ä¸Šå¤§è‡´æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>å›¾åƒè¯†åˆ«<ul>
<li>å½•åˆ¶ï¼šæ ¹æ®å±å¹•æ“ä½œåæ ‡ï¼Œè®°å½•æ“ä½œæ—¶é—´ï¼Œä»¥åŠåæ ‡é™„è¿‘çš„ç‰¹å¾å›¾ã€‚</li>
<li>å›æ”¾ï¼šæ ¹æ®ç‰¹å¾å›¾ï¼Œè¯†åˆ«ç‰¹å¾å›¾åœ¨å±å¹•ä¸­çš„ä½ç½®ï¼Œå†æ ¹æ®æ“ä½œæ—¶é—´ï¼Œæœ‰åºåœ°æ¨¡æ‹Ÿå±å¹•æ“ä½œã€‚</li>
</ul>
</li>
<li>è¾“å…¥äº‹ä»¶<ul>
<li>å½•åˆ¶ï¼šå¼•æ“åº•å±‚è®°å½•ç©å®¶æ“ä½œçš„è¾“å…¥äº‹ä»¶ï¼Œä»¥åŠæ“ä½œæ—¶é—´ã€‚</li>
<li>å›æ”¾ï¼šæ ¹æ®è¾“å…¥äº‹ä»¶ï¼Œæ¨æ–­æ“ä½œæ§ä»¶ä¸æ“ä½œæ–¹å¼ï¼Œå†æ ¹æ®æ“ä½œæ—¶é—´ï¼Œæœ‰åºåœ°è°ƒç”¨æ§ä»¶å¯¹åº”çš„æ“ä½œã€‚</li>
</ul>
</li>
</ul>
<p>å®¢æˆ·ç«¯UIæµ‹è¯•çš„å½•åˆ¶å›æ”¾æŠ€æœ¯ï¼Œå¯ä»¥ç”¨åˆ°çš„åœºæ™¯æœ‰ï¼š</p>
<ul>
<li>UIåŠŸèƒ½æµ‹è¯•ï¼šæµ‹è¯•æ¸¸æˆUIçš„å¯ç”¨æ€§ï¼Œç›‘æ§ä¸åŒç‰ˆæœ¬UIå‘ˆç°çš„å˜åŒ–ã€‚</li>
<li>UIè€—æ—¶æµ‹è¯•ï¼šæµ‹è¯•ç‰¹å®šç©å®¶UIæ“ä½œä¸‹ï¼Œç•Œé¢åŠ è½½çš„æ€§èƒ½æŸè€—ã€‚</li>
<li>å½•åˆ¶çš„äº§ç‰©ï¼Œå¯ç”¨äºå¿«é€Ÿç”ŸæˆUIè‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹ä»£ç ã€‚</li>
</ul>
<h3 id="è¡Œä¸ºæ ‘"><a href="#è¡Œä¸ºæ ‘" class="headerlink" title="è¡Œä¸ºæ ‘"></a>è¡Œä¸ºæ ‘</h3><p>è¡Œä¸ºæ ‘æ˜¯AIçš„ä¸€ç§å®ç°ï¼Œä¸»è¦é€šè¿‡è¡Œä¸ºæŠ½è±¡+æµç¨‹æ§åˆ¶çš„æ–¹å¼ï¼Œå®ç°AIæœºå™¨äººçš„è‡ªåŠ¨å†³ç­–ã€‚</p>
<p>åœ¨è‡ªåŠ¨åŒ–æµ‹è¯•é¢†åŸŸï¼Œé€šå¸¸ä¼šæåˆ°AIè‡ªåŠ¨åŒ–ï¼Œè€Œè¡Œä¸ºæ ‘å°±æ˜¯AIè‡ªåŠ¨åŒ–çš„ä¸€ç§å…¸å‹æ¡ˆä¾‹ã€‚ä½†è¿™é‡Œéœ€è¦å¼ºè°ƒçš„æ˜¯ï¼ŒAIé©±åŠ¨å¹¶ä¸æ˜¯æœ€åº•å±‚çš„è‡ªåŠ¨åŒ–æŠ€æœ¯ï¼Œä»¥è¿è¡Œåœ¨æ¸¸æˆå®¢æˆ·ç«¯çš„è¡Œä¸ºæ ‘ä¸ºä¾‹ï¼Œæ¯ä¸ªè¡Œä¸ºæœ¬èº«çš„å®ç°ï¼Œè¿˜æ˜¯å¾—èµ°UIè‡ªåŠ¨åŒ–ã€è„šæœ¬è‡ªåŠ¨åŒ–çš„å¥—è·¯ã€‚AIé©±åŠ¨çš„ï¼Œåªæ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸æ˜¯æ¸¸æˆæœ¬èº«ã€‚</p>
<p>è¡Œä¸ºæ ‘å†³ç­–çš„é€»è¾‘æ˜¯äººä¸ºåˆ¶å®šçš„ï¼Œå› æ­¤å¼•å…¥è¡Œä¸ºæ ‘ï¼Œä¼šå¾ˆé€‚åˆä¸€äº›æ“ä½œå¤æ‚ï¼Œè€—æ—¶é•¿ï¼Œä½†æ¯”è¾ƒæœ‰è§„å¾‹çš„æµ‹è¯•åœºæ™¯ï¼Œè®©è¿™äº›åœºæ™¯å®ç°è‡ªåŠ¨åŒ–çš„æˆæœ¬å¤§å¤§é™ä½ã€‚æ¯”å¦‚è¯´ï¼š</p>
<ul>
<li>PVEå‰¯æœ¬ã€ä»»åŠ¡ï¼šè¿™ç±»å‹çš„ç©æ³•é€šå¸¸åˆ†ä¸ºå¾ˆå¤šç¯ï¼Œæ¯ä¸€ç¯éœ€è¦æ ¹æ®å‰¯æœ¬é˜¶æ®µæŒ‡å¼•ä¿¡æ¯ã€ä»»åŠ¡ç±»å‹ä¿¡æ¯ç­‰é‡‡å–è¡Œä¸ºå†³ç­–ï¼Œå› æ­¤æ¯”è¾ƒé€‚åˆç”¨è¡Œä¸ºæ ‘è¡¨å¾ã€‚</li>
<li>PVPã€ç«æŠ€ç©æ³•ï¼šè¿™ç±»å‹çš„ç©æ³•é€šå¸¸æœ‰ç‰¹å®šçš„æ¸¸ç©è§„åˆ™/ç›®æ ‡ï¼Œå› æ­¤ä¹Ÿé€‚åˆè¡Œä¸ºæ ‘å»åšå†³ç­–ã€‚</li>
</ul>
<p>é’ˆå¯¹è‡ªåŠ¨åŒ–æµ‹è¯•æœ¬èº«è€Œè¨€ï¼Œè¡Œä¸ºæ ‘ä¹Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç¡®å®šåŸºç¡€çš„è‡ªåŠ¨åŒ–é€»è¾‘ç»“æ„ï¼Œç”ŸæˆåŸºç¡€ä»£ç ï¼Œæé«˜è‡ªåŠ¨åŒ–ç ”å‘æ•ˆç‡ã€‚ä½†ä¹Ÿéœ€è¦æ³¨æ„ï¼Œè¡Œä¸ºæ ‘ä¸èƒ½ä½œä¸ºä»£ç ç¼–ç¨‹çš„å®Œæ•´ä»£æ›¿æ–¹æ¡ˆï¼Œå¦åˆ™ä¸€æ—¦è¡Œä¸ºå¤æ‚åº¦è¾ƒé«˜ï¼Œè¡Œä¸ºæ ‘æœ¬èº«å°±éš¾ä»¥ç»´æŠ¤ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDQvMDMvdGVzdGxpZmUvYnRyZWVfYXV0b3Rlc3RfdGFsay8=" title="https://utmhikari.top/2022/04/03/testlife/btree_autotest_talk/">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ã€‚</p>
<p>è¡Œä¸ºæ ‘æ–¹æ¡ˆï¼Œå»ºè®®æ˜¯é…å¥—å¯è§†åŒ–ç¼–ç¨‹å·¥å…·ææ•ˆå¼€å‘å’Œè°ƒè¯•å·¥ä½œï¼Œå¦åˆ™ç ”å‘æ•ˆç‡å¹¶ä¸ä¸€å®šä¼˜äºçº¯ç²¹çš„ä»£ç ç¼–å†™ã€‚</p>
<h3 id="æœºå™¨å­¦ä¹ "><a href="#æœºå™¨å­¦ä¹ " class="headerlink" title="æœºå™¨å­¦ä¹ "></a>æœºå™¨å­¦ä¹ </h3><p>æœºå™¨å­¦ä¹ æ˜¯ä¸€ç§æ›´ä¸ºå¤æ‚çš„AIå®ç°æ¡ˆä¾‹ï¼Œæœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<ul>
<li>æœ‰ä¸€å®šçš„ç›®æ ‡ï¼Œå®è´¨æ˜¯é€šè¿‡ä¸æ–­çš„è¿ç®—ï¼Œæ¥è¾¾åˆ°ç‰¹å®šçš„ç›®æ ‡ï¼Œé€šè¿‡è‡ªå­¦ä¹ çš„æ–¹å¼å½¢æˆæ›´å¤šçš„ç»éªŒã€‚</li>
<li>å†³ç­–çš„è¿‡ç¨‹æ˜¯é»‘ç›’çš„ï¼Œç»éªŒè®ºï¼Œæ— æ³•è¿½æº¯å…¶ä¸­çš„æ€ç»´é“¾è·¯ã€‚</li>
<li>å­¦ä¹ æ–¹å¼ä¸Šæœ‰ç›‘ç£ï¼ˆäººå·¥æ•°æ®ä»‹å…¥ï¼‰æˆ–æ˜¯æ— ç›‘ç£å‡å¯ï¼Œä½†æ— è®ºå¦‚ä½•éƒ½éœ€è¦å¤„ç†å¤§é‡çš„æ•°æ®ä½œä¸ºå†³ç­–ä¾æ®ã€‚</li>
</ul>
<p>å› æ­¤æœºå™¨å­¦ä¹ çš„æ–¹æ¡ˆï¼Œå¯ä»¥è€ƒè™‘åœ¨å‡ ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•çš„åœºæ™¯åº”ç”¨ï¼š</p>
<ul>
<li>è¡Œä¸ºå¤æ‚åº¦è¾ƒé«˜ï¼Œä¸å®¹æ˜“è¢«è¡Œä¸ºæ ‘è¡¨å¾çš„çš„PVPã€ç«æŠ€ç©æ³•ã€‚<ul>
<li>è®­ç»ƒç«æŠ€AIï¼Œæ”¶é›†æ•°æ®ï¼Œç”¨ä»¥è¯„ä»·ç©æ³•æ•°å€¼é…ç½®çš„åˆç†æ€§ï¼Œæˆ–æ˜¯åšæ¼«æ¸¸æ¢ç´¢æµ‹è¯•ï¼Œå°è¯•å‘ç°é—®é¢˜ã€‚</li>
</ul>
</li>
<li>éœ€è¦è¯†åˆ«å®¢æˆ·ç«¯æ˜¾ç°å¼‚å¸¸å›¾åƒçš„åœºæ™¯ã€‚<ul>
<li>ç»“åˆå®¢æˆ·ç«¯è‡ªåŠ¨åŒ–æ–¹æ¡ˆæ‰§è¡Œï¼Œå¯ç”¨äºç›‘æµ‹æè„¸/æ—¶è£…ç­‰ä¸°å¯Œç¾æœ¯åœºæ™¯çš„æ˜¾ç¤ºå¼‚å¸¸ï¼Œä¹Ÿå¯ä»¥ç”¨äºåœºæ™¯ç©¿æ¨¡ã€é€‚é…é—ªå±ç­‰åœºæ™¯çš„ç›‘æ§ã€‚</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Game Of AutoTest</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>UE4</tag>
        <tag>è¡Œä¸ºæ ‘</tag>
        <tag>GAutomator</tag>
        <tag>å‹åŠ›æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Game Of AutoTestã€‘1ã€å†åº¦å¯ç¨‹ï¼Œé‡è¯†æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•</title>
    <url>/2022/08/02/gameofautotest/i/</url>
    <content><![CDATA[<p>2022å¹´çš„8æœˆï¼Œç»“æŸäº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„çŠ¹è±«ï¼Œç¬”è€…å†³å®šå¼€å¯æ–°çš„æ–‡ç« ç³»åˆ—ï¼šã€ŠGame Of AutoTestã€‹ï¼Œå‘å¤–ç•Œå…¬å¼€è‡ªå·±è¿‘ä¸¤å¹´æ¥åœ¨æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹é¢æ‰€æ²‰æ·€çš„å·¥ä½œç»éªŒï¼Œä»¥åŠè®¸å¤šå…³äºè‡ªåŠ¨åŒ–æµ‹è¯•æœ¬èº«çš„æ€è€ƒè·Ÿæƒ³æ³•ã€‚åœ¨å…ˆå‰çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvJUU2JUI1JThCJUU4JUFGJTk1JUU0JUJBJUJBJUU3JTk0JTlGLw==" title="https://utmhikari.top/categories/%E6%B5%8B%E8%AF%95%E4%BA%BA%E7%94%9F/">æµ‹è¯•äººç”Ÿ<i class="fa fa-external-link"></i></span>æ ç›®ä¸­ï¼Œæ›¾ç»åˆ†äº«è¿‡è®¸å¤šå…³äºæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æŠ€æœ¯ï¼Œä½†å¹¶æ²¡æœ‰ä¸€ä¸ªæ¯”è¾ƒç³»ç»ŸåŒ–çš„è¾“å‡ºã€‚å› æ­¤å€Ÿè¿™ä¸ªæœºä¼šï¼Œç¬”è€…ä¹Ÿå†³å®šå¥½å¥½åˆ†äº«ä¸€ä¸‹ï¼Œä»ä¸€ä¸ªæ›´åŠ çº¯ç²¹çš„æŠ€æœ¯äººçš„è§’åº¦ï¼Œå¯¹äºæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•è¿™ä¸€ç»†åˆ†é¢†åŸŸçš„ç†è§£ã€‚</p>
<p>è‡ªåŠ¨åŒ–æµ‹è¯•æœ¬èº«å·²ç»ä¸æ˜¯ä¸€ä¸ªæ–°é²œçš„åè¯ï¼Œä¸è®ºæ˜¯æ¸¸æˆè¿˜æ˜¯ä¼ ç»Ÿäº’è”ç½‘è¡Œä¸šï¼Œæˆ‘ä»¬éƒ½èƒ½å¤Ÿè§åˆ°è‡ªåŠ¨åŒ–æµ‹è¯•è½åœ°çš„èº«å½±ã€‚ä½†æ˜¯ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•åŸºç¡€æŠ€æœ¯åˆ°åº•éœ€è¦å¾€æ€æ ·çš„æ–¹å‘æ­å»ºï¼Œä¸šåŠ¡åº”ç”¨éœ€è¦è¦†ç›–å“ªäº›åœºæ™¯ï¼Œè¿™äº›è¯é¢˜å…¶å®å¾ˆå°‘è¢«è®¨è®ºï¼Œå¹¶ä¸”å®é™…æ²‰æ·€ä¸‹æ¥çš„çŸ¥è¯†åˆ†äº«å’Œä¸šåŠ¡äº§å‡ºï¼Œä¹Ÿä¸å°½ç„¶ç‰¹åˆ«å¼•äººæ³¨ç›®ã€‚å°¤å…¶åœ¨æ¸¸æˆæµ‹è¯•é¢†åŸŸï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å¦‚ä½•è¢«åº”ç”¨åˆ°å®é™…æµ‹è¯•å·¥ä½œå½“ä¸­ï¼Œç›¸å…³çš„æ²‰æ·€æ˜¯å°‘ä¹‹åˆå°‘ï¼Œå¯ä»¥ç®—æ˜¯ä¸€ç‰‡å¾…å¼€å¦çš„è’åœ°ã€‚</p>
<p>æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•â€”â€”è¿™ä¸ªåè¯æœ¬èº«éƒ½æ²¡æœ‰ä¸€ä¸ªç¡®åˆ‡çš„å®šä¹‰ã€‚æœ‰äº›äººè®¤ä¸ºï¼Œåªæœ‰åƒè‡ªåŠ¨é©±åŠ¨å®¢æˆ·ç«¯ç©æ¸¸æˆï¼Œæµ‹è¯•åœºæ™¯ç‰©ä»¶æ˜¯å¦æ­£å¸¸äº¤äº’ï¼Œè¿™ç§èƒ½å¤Ÿå®é™…æµ‹åˆ°å’Œæµ‹è¯•ç”¨ä¾‹ç›¸å…³çš„å†…å®¹ï¼Œæ‰ç®—æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ï¼›ä¹Ÿæœ‰äº›äººè®¤ä¸ºï¼Œåƒä¸€äº›çº¯ç²¹æ”¶é›†æ€§èƒ½æ•°æ®çš„åœºæ™¯ï¼Œæ¯”å¦‚é©±åŠ¨ç©å®¶åœ¨åœ°å›¾é‡Œè·‘å›¾ï¼Œæ”¶é›†å‰åå°æ•°æ®ï¼Œä¹Ÿç®—æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚è¿™è¯´æ˜äº†ï¼Œåªè¦æ˜¯ç”¨äº†ç¨‹åºåŒ–çš„æ‰‹æ®µï¼Œå»å®Œæˆæ¸¸æˆæµ‹è¯•çš„æ•´ä¸ªæˆ–ä¸€éƒ¨åˆ†çš„æµç¨‹ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½è¢«å®šä¹‰ä¸ºä¸€ç§æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ–¹æ¡ˆã€‚ä½†é—æ†¾çš„æ˜¯ï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼Œå¾ˆå¤šæµ‹è¯•å·¥ä½œè€…ä¸ºäº†è®©è‡ªå·±çš„å·¥ä½œæœ‰æŠ€æœ¯å«é‡ï¼Œéƒ½ä¼šå°è¯•æ²¾è‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯çš„å…‰ï¼Œä¸ºäº†æŠ€æœ¯è€ŒæŠ€æœ¯ï¼Œç”¨ä¸€äº›ç°æˆçš„è‡ªåŠ¨åŒ–å·¥å…·å»åšäº†ä¸ªdemoè§„æ¨¡çš„ä¸œè¥¿ï¼Œç„¶åå¾ˆé˜¿é‡Œå‘³åœ°åŒ…è£…æˆå¯Œæœ‰æŠ€æœ¯å«é‡çš„æµ‹è¯•å·¥ä½œï¼Œä½†å®é™…ä¸Šç›¸å¯¹äºåŸæ¥åå€’å¢åŠ äº†å­¦ä¹ ã€ç»´æŠ¤ã€æ‰§è¡Œæˆæœ¬ï¼Œæ˜¯æ¯«æ— ä»·å€¼çš„è´Ÿä¼˜åŒ–ã€‚å…¶ä¸­åŸå› ï¼Œå½’æ ¹åˆ°åº•ï¼Œè¿˜æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•è¿™ä¸ªå·¥ä½œè¢«å¾ˆå¤šäººå°çœ‹äº†ã€‚å¦‚æœä½ æ˜¯ä¸ªæµ‹è¯•å·¥ä½œè€…ï¼Œä½†ä¸šåŠ¡ç»éªŒã€æŠ€æœ¯èƒ½åŠ›ä»¥åŠè‰¯å¸ˆæŒ‡å¯¼ä¸‰è€…éƒ½å¾ˆç¼ºä¹ï¼Œå¹¶ä¸”ä¸šåŠ¡ç¯å¢ƒä¸Šæ²¡å•¥è½åœ°åœºæ™¯ï¼Œç»„ç»‡æ°›å›´ä¹Ÿæ²¡å•¥æ”¯æŒçš„è¯ï¼Œè¦åšå¥½è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œé‚£æ˜¯éå¸¸å›°éš¾çš„ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬æœ‰å¿…è¦å»é‡æ–°è®¤è¯†æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•è¿™ä¸ªæ¦‚å¿µã€‚æœ‰å‡ ä¸ªå‡†åˆ™ï¼š</p>
<a id="more"></a>
<ul>
<li>è‡ªåŠ¨åŒ–â€”â€”æ˜¯æŠ€æœ¯å±‚é¢ä¸å¯æˆ–ç¼ºçš„å…³é”®ç‚¹ï¼Œä¸”ç›¸å¯¹äºäººå·¥èƒ½æ˜¾è‘—æå‡å·¥ä½œæ•ˆç‡ã€‚</li>
<li>æµ‹è¯•â€”â€”æ˜¯æœ€ç»ˆçš„ç›®æ ‡ï¼Œæ•´ä¸ªæµ‹è¯•æµç¨‹é‡Œè‡ªåŠ¨åŒ–è¿‡ç¨‹å¯èƒ½åªæ˜¯å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œä½†è¿™ä¸ªæµç¨‹ä¸è®ºå¦‚ä½•æœ€ç»ˆéƒ½éœ€è¦é—­ç¯ï¼Œè¾“å‡ºæµ‹è¯•ç»“è®ºã€‚</li>
<li>æ¸¸æˆâ€”â€”æ˜¯æˆ‘ä»¬åšè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¯¹è±¡ã€‚åœ¨è¿™ä¸€èŒƒç•´ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¸¸æˆæµ‹è¯•çš„è‡ªåŠ¨åŒ–å’Œæ—¥å¸¸å·¥ä½œææ•ˆçš„è‡ªåŠ¨åŒ–åŒºåˆ†å¼€ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œè¦åšåˆ°æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè½åˆ°å®å¤„ï¼Œä½ éœ€è¦ï¼š</p>
<ul>
<li>ç†Ÿæ‚‰æ¸¸æˆè‡ªåŠ¨åŒ–çš„å„ç§æŠ€æœ¯æ–¹æ¡ˆã€‚</li>
<li>ç†Ÿæ‚‰ä½ çš„æµ‹è¯•å†…å®¹ï¼Œå¹¶ä¸”ä»æ•´ä¸ªæµ‹è¯•è¿‡ç¨‹çš„è§’åº¦æŒ–æ˜å¯ä»¥é€šè¿‡è‡ªåŠ¨åŒ–æŠ€æœ¯æå‡æ•ˆç‡çš„ä¼˜åŒ–ç‚¹ã€‚</li>
<li>è¯„ä¼°ä½ åœ¨æŠ€æœ¯å®ç°ä¸Šçš„å·¥ä½œæˆæœ¬ï¼Œç»“åˆå…ˆå‰æŒ–æ˜å‡ºæ¥ä¼˜åŒ–ç‚¹å®é™…çš„ä¼˜åŒ–ç¨‹åº¦ï¼Œæ¥å†³å®šæ˜¯å¦çœŸæ­£æœ‰å¿…è¦å»åšè‡ªåŠ¨åŒ–æŠ€æœ¯å¼€å‘ã€‚æŠ€æœ¯å®ç°çš„æˆæœ¬ï¼Œå¯ä»¥å‚è€ƒå‡ ä¸ªç»´åº¦ï¼šè‡ªåŠ¨åŒ–æŠ€æœ¯çš„å­¦ä¹ ã€è‡ªåŠ¨åŒ–ç ”å‘ç¯å¢ƒ/åŸºç¡€æ¡†æ¶çš„æ­å»ºã€è‡ªåŠ¨åŒ–ç”¨ä¾‹çš„å¼€å‘/å‘å¸ƒã€è‡ªåŠ¨åŒ–ç”¨ä¾‹çš„ç»´æŠ¤/è¿­ä»£ã€‚</li>
<li>åšå¥½é—®é¢˜åˆ†æä¸åé¦ˆæœºåˆ¶ã€‚æ¯”å¦‚ï¼Œä½ çš„è‡ªåŠ¨åŒ–ç”¨ä¾‹æŠ¥é”™äº†ï¼Œé¦–å…ˆè¦ç•Œå®šæ˜¯è‡ªåŠ¨åŒ–ç”¨ä¾‹çš„é—®é¢˜ï¼Œè¿˜æ˜¯æ¸¸æˆæœ¬èº«çš„bugï¼›ä»¥åŠï¼Œå‘ç°äº†bugä¹‹åï¼Œåº”è¯¥æ€æ ·åšåé¦ˆï¼Œæ€æ ·å’Œå·²æœ‰çš„ä¸šåŠ¡è”ç³»èµ·æ¥ï¼Œå®ç°æµç¨‹é—­ç¯ã€‚è¿™æ ·è®©è‡ªåŠ¨åŒ–æŠ€æœ¯çš„ä»·å€¼å¾—åˆ°ä½“ç°ã€‚</li>
<li>æ—¶åˆ»æ€»ç»“ï¼Œä¸æ–­è¿­ä»£ã€ä¼˜åŒ–ä½ çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆã€‚ä¸è®ºæ˜¯ä»æ—¶é—´æ•ˆç‡æå‡è§’åº¦ï¼Œè¿˜æ˜¯æµ‹è¯•è¦†ç›–é¢/é—®é¢˜å‘ç°è§’åº¦ï¼Œéƒ½å¯ä»¥å°è¯•æ‰©å……ä½ çš„è‡ªåŠ¨åŒ–è¦†ç›–åœºæ™¯ã€‚è¿™æ ·ï¼Œæ‰èƒ½å¤ŸæŠŠè‡ªåŠ¨åŒ–æµ‹è¯•åšæ·±åšå¤§ã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œå¼€å§‹å¯ç¨‹â€¦â€¦</p>
]]></content>
      <categories>
        <category>Game Of AutoTest</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>ä¸“é¡¹æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘pythonå¤šçº¿ç¨‹ä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥å¹¶è¡Œï¼Ÿä»€ä¹ˆæƒ…å†µä¸‹ä¸èƒ½ï¼Ÿ</title>
    <url>/2022/07/03/pythonnotes/multithread_parallel/</url>
    <content><![CDATA[<p>åœ¨<code>python</code>é¢è¯•é‡Œï¼Œå¤šçº¿ç¨‹æ˜¯é¿ä¸å¼€çš„è¯é¢˜ï¼Œå…¶ä¸­ä¸€ä¸ªç»å…¸é—®é¢˜å°±æ˜¯ï¼Œå¤šçº¿ç¨‹<code>threading.Thread</code>æ˜¯ä¸æ˜¯å¹¶è¡Œè¿è¡Œã€‚è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œè¯´æ˜¯ä¹Ÿä¸å¯¹ï¼Œè¯´ä¸æ˜¯ä¹Ÿä¸å¯¹ï¼Œå¾—åˆ†æƒ…å†µè®¨è®ºã€‚æœ¬æ–‡å°±å¸¦é¢†å¤§å®¶ï¼Œåˆ†æå¹¶å›ç­”è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬ç”¨ä¸€æ®µä»£ç æ¥åšå®éªŒï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Lock</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_lock = Lock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> _lock:</span><br><span class="line">        print(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_io_task</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># å•ä¸ªtaskæ‰§è¡Œçº¦3s</span></span><br><span class="line">    subprocess.run([<span class="string">'ping'</span>, <span class="string">'127.0.0.1'</span>], capture_output=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_code_task</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># å•ä¸ªtaskæ‰§è¡Œçº¦0.8s</span></span><br><span class="line">    tms = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> tms &lt; <span class="number">50000000</span>:</span><br><span class="line">        tms += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">testfunc</span><span class="params">(num)</span>:</span></span><br><span class="line">    st = datetime.datetime.now()</span><br><span class="line">    <span class="comment"># _io_task()</span></span><br><span class="line">    _code_task()</span><br><span class="line">    et = datetime.datetime.now()</span><br><span class="line">    dt = et - st</span><br><span class="line">    log(<span class="string">f'<span class="subst">&#123;num&#125;</span> -&gt; <span class="subst">&#123;dt.total_seconds() * <span class="number">1000</span>&#125;</span>ms'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    num_threads = <span class="number">5</span></span><br><span class="line">    threads = []</span><br><span class="line">    st = datetime.datetime.now()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_threads):</span><br><span class="line">        t = Thread(target=testfunc, args=(i,))</span><br><span class="line">        threads.append(t)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.start()</span><br><span class="line">    time.sleep(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br><span class="line">    et = datetime.datetime.now()</span><br><span class="line">    dt = et - st</span><br><span class="line">    log(<span class="string">f'overall <span class="subst">&#123;dt.total_seconds() * <span class="number">1000</span>&#125;</span>ms'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ„æ€å¾ˆå®¹æ˜“æ‡‚ï¼Œèµ·äº†5ä¸ª<code>testfunc</code>ä¸º<code>target</code>çš„çº¿ç¨‹ï¼Œç„¶åä¸»çº¿ç¨‹ç­‰å¾…è¿™äº›çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œç»“æŸ<code>join</code>ï¼Œæœ€åç»Ÿè®¡æ¯ä¸ªçº¿ç¨‹çš„å¼€å§‹ç»“æŸæ—¶é—´é—´éš”å’Œå¼€å§‹ç»“æŸæ—¶é—´é—´éš”ã€‚</p>
<p>æ‰§è¡Œäº†ä¹‹åæˆ‘ä»¬ä¼šå‘ç°å¦‚æœ<code>test_func</code>é‡Œè®¾ç½®çš„æ˜¯<code>code_task</code>çš„è¯ï¼Œé‚£ä¹ˆæ€»æ—¶é—´ç›¸å½“äºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œæ—¶é—´çš„<code>num_threads</code>å€ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡è®¾ç½®<code>num_threads</code>ä¸º1ä»¥åŠæ›´é«˜çš„æ•°å­—æ¥å®éªŒåˆ°ï¼Œè€Œæ›´ä¸ºè¹Šè··çš„æ˜¯ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´é—´éš”å’Œæ€»çš„æ‰§è¡Œæ—¶é—´é—´éš”å‡ ä¹ç›¸å·®æ— å‡ ã€‚å¯ä»¥çœ‹ä¸‹é¢çš„è¾“å‡ºä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># num_threads = 1</span><br><span class="line">0 -&gt; 873.087ms</span><br><span class="line">overall 874.0830000000001ms</span><br><span class="line"></span><br><span class="line"># num_threads = 5</span><br><span class="line">0 -&gt; 4278.944ms</span><br><span class="line">1 -&gt; 4412.494ms</span><br><span class="line">2 -&gt; 4488.241ms</span><br><span class="line">4 -&gt; 4243.062ms</span><br><span class="line">3 -&gt; 4882.43ms</span><br><span class="line">overall 5156.513ms</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œå¦‚æœ<code>test_func</code>é‡Œè®¾ç½®çš„æ˜¯<code>io_task</code>çš„è¯ï¼Œ<code>num_threads</code>å°±ç®—è®¾ç½®ä¸‰äº”ä¸ªï¼Œç”¨çš„æ—¶é—´åŸºæœ¬éƒ½ä¸€æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># num_threads = 3</span><br><span class="line">0 -&gt; 3061.7909999999997ms</span><br><span class="line">2 -&gt; 3061.7909999999997ms</span><br><span class="line">1 -&gt; 3061.7909999999997ms</span><br><span class="line">overall 3062.788ms</span><br><span class="line"></span><br><span class="line"># num_threads = 5</span><br><span class="line">2 -&gt; 3036.288ms</span><br><span class="line">4 -&gt; 3035.291ms</span><br><span class="line">1 -&gt; 3036.288ms</span><br><span class="line">0 -&gt; 3549.756ms</span><br><span class="line">3 -&gt; 3549.756ms</span><br><span class="line">overall 3549.756ms</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ä¸¤ç§æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ˜¯èŠ‚çœæ—¶é—´å¹¶è¡Œçš„ï¼Œä¸€ä¸ªæ˜¯æ²¡èŠ‚çœæ—¶é—´ä¸å¹¶è¡Œçš„ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å¾ˆå¤šåŒå­¦ä¼šæåˆ°<code>GIL</code>è¿™ä¸ªæ¦‚å¿µï¼Œæ²¡é”™ï¼Œ<code>GIL</code>å°±æ˜¯å…³é”®ã€‚<code>GIL</code>æ˜¯å…¨å±€è§£é‡Šå™¨é”ï¼Œå®ƒçš„æ„ä¹‰å°±åœ¨äºï¼Œå•ä¸ª<code>python</code>è¿è¡Œæ—¶ç¯å¢ƒé‡Œï¼ŒåŒä¸€æ—¶åˆ»ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹èƒ½å¤Ÿè§£é‡Šæ‰§è¡Œ<code>python</code>ä»£ç ã€‚<code>python</code>å¤šçº¿ç¨‹ï¼Œå®è´¨æ˜¯èµ·äº†å¤šä¸ªæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œç«äº‰<code>GIL</code>é”è§£é‡Šæ‰§è¡Œ<code>python</code>ä»£ç ï¼Œåœ¨å¤šçº¿ç¨‹æ‰§è¡Œ<code>code_task</code>çš„æƒ…å†µä¸‹ï¼Œä¸åŒçº¿ç¨‹éœ€è¦è·å–<code>GIL</code>ï¼Œæ‰èƒ½æ‰§è¡Œ<code>while</code>ã€<code>+=</code>ä¹‹ç±»çš„è¯­å¥ï¼Œæ‰€ä»¥è¿™äº›çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œçš„è¯ï¼Œæ€»çš„æ—¶é—´æ˜¯ç´¯åŠ çš„ã€‚è€Œåœ¨<code>io_task</code>çš„æƒ…å†µä¸‹ï¼Œç­‰å¾…<code>ping</code>å‘½ä»¤è¿”å›çš„æœŸé—´æ˜¯é˜»å¡åœ¨æ“ä½œç³»ç»Ÿçš„<code>io</code>æ¥å£ï¼Œå¹¶ä¸éœ€è¦è§£é‡Šæ‰§è¡Œ<code>python</code>ä»£ç ï¼Œå› æ­¤å•ä¸ªä»»åŠ¡çº¿ç¨‹ä¸éœ€è¦æ¯æ—¶æ¯åˆ»éƒ½æ‹¥æœ‰<code>GIL</code>ï¼Œå„ä¸ªçº¿ç¨‹é—´ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç«äº‰å…³ç³»äº†ï¼Œæ‰€ä»¥æœ€åå‘ˆç°äº†å¹¶è¡Œçš„çŠ¶æ€ã€‚è¿™å°±æ˜¯ä¸Šè¿°é—®é¢˜çš„ç­”æ¡ˆäº†ã€‚</p>
<p>å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜è¿˜æœ‰å¼•ç”³çš„ç©ºé—´â€”â€”ä¸ºä»€ä¹ˆ<code>code_task</code>çš„åœºæ™¯ä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œçš„æ—¶é—´é—´éš”å’Œæ€»çš„æ‰§è¡Œæ—¶é—´é—´éš”å‡ ä¹ç›¸å·®æ— å‡ ï¼Œè€Œä¸æ˜¯çº¿ç¨‹ä¸€ä¸ªæ¥ä¸€ä¸ªä¸²è¡Œæ‰§è¡Œå®Œæ¯•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨<code>python</code>è¿è¡Œæ—¶ç¯å¢ƒé‡Œ<code>GIL</code>çš„ç«äº‰æ˜¯æ—¶åˆ†å¤ç”¨çš„ï¼Œæ¯ä¸ªæ—¶é—´é—´éš”<code>sys.getswitchinterval()</code>éƒ½ä¼šè§¦å‘ä¸€æ¬¡<code>GIL</code>çš„é‡Šæ”¾å’Œç«äº‰ï¼Œè¿™æ ·å‘ˆç°çš„ç»“æœå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œä¸€ç‚¹å­—èŠ‚ç ï¼Œä¹‹åå¦ä¸€ä¸ªçº¿ç¨‹æŠ¢åˆ°æœºä¼šä¹Ÿæ‰§è¡Œä¸€ç‚¹å­—èŠ‚ç ï¼Œå¾ªç¯å¾€å¤ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹æ‰§è¡Œç»“æŸã€‚æ‰€ä»¥è¿™ç§æœºåˆ¶ä¸‹ï¼Œå¤šçº¿ç¨‹ä¹‹é—´æ˜¯å¹¶å‘çš„ï¼Œæœ€ç»ˆç»“æŸçš„æ—¶åˆ»ï¼Œä¸ä¼šç›¸å·®å¤ªå¤šæ—¶é—´ã€‚</p>
<p><code>python</code>å¤šçº¿ç¨‹çš„æœºåˆ¶ï¼Œå¦‚æœè¦æ·±å…¥äº†è§£ï¼Œå¯ä»¥å‚è€ƒç¬”è€…ä»¥å‰åœ¨<code>Medium Python</code>ç³»åˆ—å†™çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMTAvMzAvbWVkaXVtcHl0aG9uL2lpaS8=" title="https://utmhikari.top/2021/10/30/mediumpython/iii/">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ï¼Œé‡Œé¢å·²ç»æ¸…æ¥šè®²è¿°äº†<code>python</code>çº¿ç¨‹å¯åŠ¨çš„é€»è¾‘ä»¥åŠ<code>GIL</code>ç«äº‰çš„é€»è¾‘ã€‚</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>GIL</tag>
        <tag>å¹¶è¡Œ</tag>
        <tag>å¹¶å‘</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘æŒæ¡å­è¿›ç¨‹subprocessæ¨¡å—çš„ä½¿ç”¨æ–¹æ³•</title>
    <url>/2022/07/02/pythonnotes/subprocess_popen/</url>
    <content><![CDATA[<p>åœ¨<code>python</code>å¼€å‘æœŸé—´ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¼šéœ€è¦æ‰§è¡Œä¸€æ®µ<code>cmd</code>ç»ˆç«¯å‘½ä»¤ï¼Œæˆ–è€…æ˜¯æ‰§è¡Œå…¶ä»–ç¨‹åºè¿”å›<code>stdout</code>æˆ–è€…æ–‡ä»¶è¾“å‡ºç»“æœã€‚è¿™ç§æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°<code>subprocess</code>æ¨¡å—ã€‚è™½ç„¶æˆ‘ä»¬ç”¨<code>os.system</code>ä¹Ÿå¯ä»¥è¾¾åˆ°æ‰§è¡Œå‘½ä»¤çš„éœ€æ±‚ï¼Œä½†ç”¨<code>os.system</code>åªæ˜¯å¹²å‘ä¸€æ®µå‘½ä»¤ï¼Œå¯¹äºæ‰§è¡Œå‘½ä»¤çš„ç¨‹åºï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•è·Ÿè¸ªå®ƒçš„å†…éƒ¨çŠ¶æ€ä»¥åŠæ‰§è¡Œç»“æœï¼Œå› æ­¤ä»ç¨³å®šæ€§çš„è§’åº¦æ¥è®²ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚å› æ­¤ï¼Œæœ¬ç¯‡æ–‡ç« è®²è§£ä¸‹<code>subprocess</code>å­è¿›ç¨‹æ¨¡å—çš„çš„åŸºç¡€åº”ç”¨ï¼Œè®©æ²¡ç”¨è¿‡è¿™ä¸ªæ¨¡å—æˆ–æ˜¯ç»å¸¸è¸©å‘çš„åŒå­¦éƒ½é¿é¿å‘ã€‚</p>
<p><code>subprocess</code>æ¨¡å—çš„å®˜æ–¹æ–‡æ¡£åœ¨<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L3N1YnByb2Nlc3MuaHRtbA==" title="https://docs.python.org/3/library/subprocess.html">è¿™é‡Œ<i class="fa fa-external-link"></i></span>ï¼Œæœ€æ ¸å¿ƒçš„å•ä½æ˜¯<code>subprocess.Popen</code>ç±»ï¼Œå®ƒæè¿°äº†ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„è¿›ç¨‹ã€‚<code>subprocess</code>æœ€åŸºç¡€çš„ç”¨æ³•æ˜¯<code>subprocess.run</code>ï¼Œæˆ‘ä»¬å…¥å‚ä¸€æ®µ<code>cmd</code>ç»ˆç«¯å‘½ä»¤ï¼Œ<code>run</code>æ–¹æ³•å†…éƒ¨å°±ä¼šå¯åŠ¨ä¸€ä¸ª<code>Popen</code>å¯¹è±¡æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œç­‰å¾…å‘½ä»¤æ‰§è¡Œç»“æŸåï¼Œè¿”å›è¿™ä¸ªå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç <code>retcode</code>ï¼Œæ ‡å‡†è¾“å‡ºæµå†…å®¹<code>stdout</code>ä»¥åŠæ ‡å‡†é”™è¯¯æµå†…å®¹<code>stderr</code>ã€‚æˆ‘ä»¬å¯ä»¥ä»æºç ä¸­è¯¦ç»†æ‹ä¸€ä¸‹<code>subprocess.run</code>çš„æµç¨‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(*popenargs,</span></span></span><br><span class="line"><span class="function"><span class="params">        input=None, capture_output=False, timeout=None, check=False, **kwargs)</span>:</span></span><br><span class="line">    <span class="comment"># å¿½ç•¥ä¸Šé¢å‚æ•°å¤„ç†éƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">with</span> Popen(*popenargs, **kwargs) <span class="keyword">as</span> process:  <span class="comment"># æ–°èµ·ä¸€ä¸ªPopençš„context</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># é€šè¿‡communicateæ–¹æ³•æ‹‰å–æœ€ç»ˆstdoutã€stderrçš„æ‰€æœ‰æ•°æ®</span></span><br><span class="line">            stdout, stderr = process.communicate(input, timeout=timeout)  </span><br><span class="line">        <span class="keyword">except</span> TimeoutExpired <span class="keyword">as</span> exc:</span><br><span class="line">            <span class="comment"># è¶…æ—¶å¤„ç†ï¼Œå‘osç”³è¯·æ€è¿›ç¨‹ï¼Œç­‰å¾…è¿›ç¨‹ç»“æŸ</span></span><br><span class="line">            process.kill()</span><br><span class="line">            <span class="keyword">if</span> _mswindows:</span><br><span class="line">                exc.stdout, exc.stderr = process.communicate()  <span class="comment"># communicateä¹Ÿå¯ç”¨æ¥æ¨¡æ‹Ÿé”®ç›˜è¾“å…¥</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                process.wait()</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">except</span>:  <span class="comment"># Including KeyboardInterrupt, communicate handled that.</span></span><br><span class="line">            <span class="comment"># å‘osç”³è¯·æ€è¿›ç¨‹</span></span><br><span class="line">            process.kill()</span><br><span class="line">            <span class="comment"># We don't call process.wait() as .__exit__ does that for us.</span></span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        retcode = process.poll()  <span class="comment"># è·å–exitcode</span></span><br><span class="line">        <span class="keyword">if</span> check <span class="keyword">and</span> retcode:</span><br><span class="line">            <span class="keyword">raise</span> CalledProcessError(retcode, process.args,</span><br><span class="line">                                     output=stdout, stderr=stderr)</span><br><span class="line">    <span class="keyword">return</span> CompletedProcess(process.args, retcode, stdout, stderr)</span><br></pre></td></tr></table></figure>
<p><code>subprocess.run</code>æ˜¯ä¸€ä¸ªé˜»å¡æ–¹æ³•ï¼Œæ‰§è¡Œäº†è¿™ä¸ªæ¥å£åï¼Œéœ€è¦ç­‰å¾…<code>run</code>å…¥å‚çš„å‘½ä»¤æ‰§è¡Œå®Œæ‰èƒ½è¿”å›ã€‚è€Œæœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å•ç‹¬èµ·ä¸€ä¸ªï¼ˆè¿›ç¨‹æ‰§è¡Œï¼‰<code>cmd</code>å‘½ä»¤ï¼Œç„¶åå‘¨æœŸæ€§æ¯å‡ ç§’é’Ÿå»æ£€æŸ¥å‘½ä»¤æ‰§è¡Œçš„çŠ¶æ€ï¼Œæ£€æŸ¥å®Œä¹‹åæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ä¸»è¿›ç¨‹å¹²åˆ«çš„äº‹æƒ…ï¼Œä¹Ÿå°±æ˜¯æä¸€ä¸ªç‹¬ç«‹å‡ºæ¥çš„è¿›ç¨‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>subprocess.run</code>å°±æ— æ³•æ»¡è¶³ï¼Œå¿…é¡»ç›´æ¥å¼€<code>subprocess.Popen</code>ã€‚</p>
<p>ä¸€ä¸ªåŸºæœ¬çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> platform</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_decode_bytes</span><span class="params">(_bytes)</span>:</span></span><br><span class="line">    encoding = <span class="string">'gbk'</span></span><br><span class="line">    <span class="keyword">return</span> _bytes.decode(encoding)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_decode_stream</span><span class="params">(stream)</span>:</span></span><br><span class="line">    <span class="string">"""windowsä¸‹è§£ç stdout/stderrçš„æ•°æ®"""</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> stream:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> _decode_bytes(stream.read())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># set params</span></span><br><span class="line">args = [<span class="string">'ping'</span>, <span class="string">'127.0.0.1'</span>]  <span class="comment"># windowsè¿™é‡Œä¸ç”¨timeoutï¼Œå› ä¸ºä¸æ”¯æŒstdinçš„é‡å®šå‘ï¼Œç”¨pingå¤§æ¦‚3~4sçš„æ—¶é—´æ€»å…±</span></span><br><span class="line">working_directory = <span class="string">'.'</span>  <span class="comment"># æ”¯æŒè®¾ç½®å‘½ä»¤çš„å·¥ä½œç›®å½•</span></span><br><span class="line">wait_timeout = <span class="number">1</span>  <span class="comment"># å‘½ä»¤æ¯å‘¨æœŸç­‰å¾…æ—¶é—´</span></span><br><span class="line">cnt, maxcnt = <span class="number">0</span>, <span class="number">4</span>  <span class="comment"># ç­‰å¾…æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># run process</span></span><br><span class="line">print(<span class="string">f'platform system: <span class="subst">&#123;platform.system()&#125;</span>'</span>)</span><br><span class="line">p = subprocess.Popen(args,</span><br><span class="line">                     cwd=working_directory,</span><br><span class="line">                     <span class="comment"># è®¾ç½®subprocess.PIPEï¼Œè¿™æ ·æ‰§è¡Œå®Œåå¯ä»¥ä»p.stdout/p.stderrè·å–è¾“å‡ºæ•°æ®</span></span><br><span class="line">                     stdout=subprocess.PIPE,</span><br><span class="line">                     stderr=subprocess.PIPE)</span><br><span class="line">print(<span class="string">f'process args: <span class="subst">&#123;args&#125;</span>'</span>)</span><br><span class="line">print(<span class="string">f'process pid: <span class="subst">&#123;p.pid&#125;</span>'</span>)</span><br><span class="line"><span class="keyword">while</span> cnt &lt; maxcnt:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p.wait(timeout=wait_timeout)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">f'attempt <span class="subst">&#123;cnt&#125;</span> -&gt; wait err: <span class="subst">&#123;e&#125;</span>'</span>)</span><br><span class="line">        cnt += <span class="number">1</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">if</span> p.returncode <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:  <span class="comment"># çœ‹æ˜¯å¦æœ‰é€€å‡ºç ï¼Œæ¥åˆ¤æ–­è¿›ç¨‹æ˜¯å¦æ‰§è¡Œç»“æŸ</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># check retcode</span></span><br><span class="line"><span class="keyword">if</span> p.returncode <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    print(<span class="string">'[ERROR] retcode is None, maybe timeout, try kill process...'</span>)</span><br><span class="line">    <span class="keyword">if</span> platform.system() == <span class="string">'Windows'</span>:  <span class="comment"># windowsä¸‹ï¼Œå¼ºæ€è¿›ç¨‹ç”¨taskkillï¼Œå› ä¸ºæ²¡æœ‰SIGKILL</span></span><br><span class="line">        kill_proc_ret = subprocess.run([<span class="string">'taskkill'</span>, <span class="string">'/f'</span>, <span class="string">'/pid'</span>, str(p.pid)], capture_output=<span class="literal">True</span>)</span><br><span class="line">        print(<span class="string">f'[KILLPROC] <span class="subst">&#123;_decode_bytes(kill_proc_ret.stdout)&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># å…¶ä»–æƒ…å†µä¸‹å¯ä»¥å‘é€SIGKILL</span></span><br><span class="line">        os.kill(p.pid, signal.SIGKILL)</span><br><span class="line"><span class="keyword">else</span>:  <span class="comment"># æ‰“å°è¿”å›æ•°æ®</span></span><br><span class="line">    retcode, stdout, stderr = p.returncode, _decode_stream(p.stdout), _decode_stream(p.stderr)</span><br><span class="line">    print(<span class="string">f'[OK] retcode: <span class="subst">&#123;retcode&#125;</span>\n\tstdout: <span class="subst">&#123;stdout&#125;</span>\n\tstderr: <span class="subst">&#123;stderr&#125;</span>'</span>)</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µç¨‹åºæ¨¡æ‹Ÿäº†å‘¨æœŸæ€§ç­‰å¾…å­è¿›ç¨‹æ‰§è¡Œå®Œæˆçš„åœºæ™¯ï¼Œæ‰§è¡Œå®Œæˆåæ‹‰å–<code>stdout</code>å’Œ<code>stderr</code>æ‰“å°ï¼Œæ‰§è¡Œè¶…æ—¶å°±å¼ºæ€è¿›ç¨‹ã€‚åŸºæœ¬ä¸Šå…³é”®çš„åœ°æ–¹éƒ½æœ‰æ³¨é‡Šï¼Œå¦‚æœæœ‰å…¶ä»–ç±»ä¼¼çš„åœºæ™¯ï¼Œå¯ä»¥ç›´æ¥ç…§æ¬ä»£ç ã€‚</p>
<p>æœ€åæˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°ï¼Œ<code>subprocess</code>æœ¬è´¨ä¹Ÿæ˜¯å¤šè¿›ç¨‹ï¼Œä½†å’Œ<code>multiprocessing</code>æœ‰æ‰€ä¸åŒï¼Œ<code>multiprocessing</code>æ˜¯å¤šä¸ª<code>python</code>è¿›ç¨‹ï¼Œç€é‡äºç®¡ç†å¤šä¸ª<code>python</code>è¿›ç¨‹çš„è¿è¡Œæ—¶ç¯å¢ƒä»¥åŠä¹‹é—´çš„é€šä¿¡ï¼›è€Œ<code>subprocess</code>åˆ™æ˜¯ä¾§é‡äºå»è·Ÿè¸ª<code>python</code>ç¨‹åºå¯åŠ¨çš„ä»»æ„ç±»å‹è¿›ç¨‹çš„çŠ¶æ€ã€‚ä¸¤è€…ä¹Ÿæœ‰å…±åŒç‚¹ï¼Œå°±æ˜¯ä¸»è¿›ç¨‹éƒ½ä¼šæŒæœ‰å­è¿›ç¨‹çš„<code>handle</code>ï¼Œåªè¦æ²¡è°ƒç”¨ç±»ä¼¼<code>subprocess.run</code>è¿™ç§é˜»å¡è·å–å­è¿›ç¨‹çŠ¶æ€/ç»“æœçš„æ¥å£ï¼Œåœ¨èµ·äº†æ–°è¿›ç¨‹åï¼Œä¸»è¿›ç¨‹å†…éƒ½èƒ½å¤Ÿéšæ—¶éšåœ°å»è·å–å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ã€‚</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>subprocess</tag>
        <tag>Popen</tag>
        <tag>å­è¿›ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘vue3ä¸­å®ç°Arrayæ•°ç»„æ›´æ–°çš„æ–¹æ³•</title>
    <url>/2022/06/17/geekdaily/vue3_array_update/</url>
    <content><![CDATA[<p>è¿‘æœŸç”±äºå·¥ä½œåŸå› ï¼Œå¼€å§‹äº†è§£<code>vue3</code>çš„å†…å®¹ã€‚<code>vue3</code>ç›¸å¯¹äº<code>vue2</code>é‡‡ç”¨äº†ç»„åˆå¼çš„æè¿°ï¼ŒåŸæ¥çš„å†™æ³•æ˜¯ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'HelloWorld'</span>,</span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            a: <span class="number">1</span>,</span><br><span class="line">            b: <span class="number">2</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">        <span class="keyword">this</span>.a = <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        onConfirm() &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œåˆ°äº†<code>vue3</code>ï¼Œæå€¡çš„å†™æ³•å˜æˆäº†ï¼š</p>
<a id="more"></a>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive, toRefs &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'HelloWorld'</span>,</span><br><span class="line">    setup() &#123;</span><br><span class="line">        <span class="keyword">const</span> a = ref(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">            b: <span class="number">2</span></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">        onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            a.value = <span class="number">3</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">const</span> onConfirm = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            a,</span><br><span class="line">            onConfirm,</span><br><span class="line">            ...toRefs(state)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦æŠŠ<code>methods</code>ã€<code>data</code>ã€<code>computed</code>è¿˜æœ‰å„ç±»é’©å­åŒºåˆ†å¼€ï¼Œ<code>script</code>çš„å†…å®¹éƒ½èƒ½é€šè¿‡ä¸€ä¸ª<code>setup</code>å‡½æ•°æ¥ç»„ç»‡ï¼Œè¿™æ ·ä»£ç ä¼šæœ‰æ›´å¼ºçš„å¯è¯»æ€§ï¼Œå®é™…å¼€å‘æ—¶å€™ä¹Ÿä¸ä¼šä¸Šä¸‹æ¥å›åˆ‡ã€‚</p>
<p>åˆæ¬¡æ¥è§¦è¿™ç§å†™æ³•çš„æ—¶å€™å°±é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¥½æ¯”è¯´æœ‰ä¸ª<code>table</code>ç»‘å®šäº†å±æ€§<code>dataList</code>ï¼Œæ˜¯ä¸ª<code>Array</code>ï¼Œé‚£ä¹ˆ<code>dataList</code>åœ¨<code>setup</code>é‡Œå¤„ç†é€»è¾‘åº”è¯¥æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>è¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ–¹æ³•æ˜¯ç”¨<code>ref</code>ä¿®é¥°ï¼Œè¿™æ ·è¿™ä¸ª<code>dataList</code>å®ä¾‹å¦‚æœè°ƒç”¨<code>push</code>ä¹‹ç±»çš„æ–¹æ³•ï¼Œå…¶å˜åŒ–ä¸ä¼šè¢«ä¾¦æµ‹åˆ°ï¼Œä½†å¯ä»¥ç”¨æ–°çš„ä¸€ä¸ªæ•°ç»„å…¨é‡æ›¿æ¢åŸæ¥çš„<code>dataList</code>ï¼›å¦ä¸€ç§æ–¹æ³•æ˜¯ç”¨<code>reactive</code>ä¿®é¥°ï¼Œè¿™æ ·ä¸€äº›ç±»æ–¹æ³•è°ƒç”¨æ—¶å€™èƒ½<code>hook</code>åˆ°ï¼Œä½¿å¾—å¯¹åº”çš„é¡µé¢å†…å®¹äº§ç”Ÿå˜åŒ–ï¼Œä½†å¦‚æœå…¨é‡æ›¿æ¢ï¼Œæ˜¯æ²¡æ³•æ„ŸçŸ¥åˆ°çš„ã€‚</p>
<p>ç»¼åˆä»¥ä¸Šä¸¤ç‚¹ï¼Œå®é™…åœºæ™¯ä¸‹ï¼Œè¿˜æ˜¯æ¨èç¬¬ä¸‰ç§æ–¹æ³•ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'HelloWorld'</span>,</span><br><span class="line">    setup() &#123;</span><br><span class="line">        <span class="keyword">const</span> abcState = reactive(&#123;</span><br><span class="line">            abcDataList: []</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">const</span> defState = reactive(&#123;</span><br><span class="line">            defDataList: []</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            abcState,</span><br><span class="line">            defState</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…ˆå®šä¹‰å„ç±»<code>state</code>ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯åˆ’åˆ†åŠŸèƒ½æ¨¡å—æ‰€<code>model</code>çš„æ•°æ®ï¼Œå†æŠŠå®é™…çš„æ•°æ®å±æ€§æ”¾åˆ°<code>state</code>é‡Œï¼Œæœ€åç»„åˆåœ¨ä¸€èµ·ã€‚è¿™æ ·åˆ—è¡¨ç±»å‹çš„æ•°æ®åªèƒ½å…¨é‡æ›¿æ¢ï¼Œä½†æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯é€šè¿‡ä¸åŒ<code>state</code>çš„ç»„åˆï¼Œä»£ç é€»è¾‘æ›´åŠ æ¸…æ™°äº†ï¼Œæœ‰ç‚¹åƒä»¥å‰<code>store</code>çš„è®¾è®¡ï¼ŒåŒæ—¶ä¹Ÿèƒ½è§„é¿åˆ—è¡¨ç±»å‹æ•°æ®æ›´æ–°ååŒæ­¥æ¸²æŸ“åˆ°é¡µé¢çš„é—®é¢˜ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯<code>vue3</code>ä¸­å®ç°<code>Array</code>æ•°ç»„æ›´æ–°çš„è§£å†³æ–¹å¼ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>nodejs</tag>
        <tag>vue3</tag>
        <tag>array</tag>
        <tag>state</tag>
        <tag>reactive</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘é€šè¿‡motrixå¯åŠ¨é€»è¾‘åˆæ¢electronçš„é¡¹ç›®ç»“æ„</title>
    <url>/2022/06/05/geekdaily/electron_motrix_launcher/</url>
    <content><![CDATA[<p>è¿‘æœŸå‡†å¤‡å¼€å§‹åš<code>electron</code>ç›¸å…³çš„å¼€å‘å·¥ä½œï¼Œå› æ­¤å€Ÿç€è¿™ä¸ªæœºä¼šå°±å†å»äº†è§£ä¸‹<code>electron</code>ã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMTkvMTAvMjAvZ2Vla2RhaWx5L2VsZWN0cm9uX3JlYWN0Lw==" title="https://utmhikari.top/2019/10/20/geekdaily/electron_react/">å¾ˆä¹…ä»¥å‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ä¸­æœ‰ç¨å¾®ç©è¿‡<code>electron+react+antd</code>çš„è„šæ‰‹æ¶ï¼Œä½†ä¹Ÿåªé™äºå¿«é€Ÿå¼€å‘<code>electron</code>åº”ç”¨ï¼Œå¹¶æ²¡æœ‰å»å‰–ææ•´ä¸ªé¡¹ç›®ç»“æ„ã€‚å› æ­¤è¿™æ¬¡ï¼Œè¿˜æ˜¯å¾—æ·±å…¥ä¸€ä¸‹ã€‚</p>
<p>å…ˆå‰ä¸€æ®µæ—¶é—´ç‰¹åˆ«å–œæ¬¢ç”¨å¼€æºçš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FnYWx3b29kL01vdHJpeA==" title="https://github.com/agalwood/Motrix">Motrix<i class="fa fa-external-link"></i></span>ä¸‹è½½å™¨ï¼Œå°±æ˜¯åŸºäº<code>electron+vue+aria2</code>å»å®ç°çš„ï¼Œæ‰€ä»¥ç´¢æ€§å°±æŠŠæºç ç»™<code>clone</code>äº†ä¸‹æ¥ã€‚æœ¬æ–‡å°±ä»æœ€åŸºç¡€çš„å¼€å§‹ï¼Œä»¥<code>Motrix</code>çš„å¯åŠ¨é€»è¾‘ä¸ºå…¥å£ï¼Œæ¥ç ”ç©¶ä¸‹ä¸€ä¸ª<code>electron</code>åº”ç”¨æ˜¯å¦‚ä½•æ‰“å¼€çš„ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€ä¸‹<code>Motrix</code>çš„ç›®å½•ç»“æ„ï¼Œæºç åŸºæœ¬åœ¨<code>src</code>ä¸‹ï¼Œå‘ˆç°è¿™æ ·çš„å±‚çº§å…³ç³»ï¼š</p>
<a id="more"></a>
<ul>
<li><code>main</code>ï¼šä¸»è¿›ç¨‹ï¼Œåº”ç”¨å†…éƒ¨é€»è¾‘<ul>
<li><code>configs</code>ï¼šå†…éƒ¨ç¯å¢ƒé…ç½®</li>
<li><code>core</code>ï¼šè½¯ä»¶æ ¸å¿ƒç®¡ç†é€»è¾‘</li>
<li><code>menus</code>ï¼šä¸åŒ<code>os</code>ä¸‹çš„èœå•é…ç½®</li>
<li><code>pages</code>ï¼šåŸºç¡€é¡µé¢</li>
<li><code>ui</code>ï¼šå„<code>ui</code>ç›¸å…³çš„<code>Manager</code>é€»è¾‘</li>
<li><code>utils</code>ï¼šå·¥å…·æ–¹æ³•åº“</li>
<li><code>Application.js</code>ï¼šåº”ç”¨å…¥å£</li>
<li><code>Launcher.js</code>ï¼šå¯åŠ¨å™¨å…¥å£</li>
<li><code>index.js/index.dev.js</code>ï¼šç¨‹åºå…¥å£<ul>
<li><code>index.dev.js</code>ç›¸å¯¹äº<code>index.js</code>åªæ˜¯å¦å¤–å®‰è£…äº†<code>devtools</code></li>
</ul>
</li>
</ul>
</li>
<li><code>renderer</code>ï¼šæ¸²æŸ“è¿›ç¨‹ï¼Œ<code>vue</code>é¡µé¢é€»è¾‘ï¼Œç›®å½•ç»“æ„ä¹Ÿæ˜¯<code>vue</code>é»˜è®¤çš„ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZHJhZ29uaXIvcC84NzExNzYxLmh0bWw=" title="https://www.cnblogs.com/dragonir/p/8711761.html">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span><ul>
<li><code>api</code>ï¼šå¤–éƒ¨æ¥å£</li>
<li><code>assets</code>ï¼šèµ„æºæ–‡ä»¶</li>
<li><code>components</code>ï¼šç»„ä»¶é¡µé¢</li>
<li><code>pages</code>ï¼šåº”ç”¨é¡µé¢å…¥å£ï¼Œ<code>App.vue+main.js</code></li>
<li><code>router</code>ï¼šè·¯ç”±</li>
<li><code>store</code>ï¼šåº”ç”¨å†…éƒ¨æ•°æ®</li>
<li><code>utils</code>ï¼šå·¥å…·æ–¹æ³•åº“</li>
<li><code>workers</code>ï¼šåªæœ‰ä¸€ä¸ª<code>tray.worker.js</code>ç”¨æ¥ç»˜åˆ¶æ‰˜ç›˜<code>icon</code></li>
</ul>
</li>
<li><code>shared</code>ï¼šå…¬ç”¨é€»è¾‘/å·¥å…·<ul>
<li><code>aria2</code>ï¼šä¸‹è½½å·¥å…·<code>jslib</code></li>
<li><code>locales</code>ï¼šæœ¬åœ°åŒ–</li>
<li><code>utils</code>ï¼šå…¬ç”¨<code>js</code>å·¥å…·æ–¹æ³•åº“</li>
</ul>
</li>
</ul>
<p>ä»<code>MVC</code>çš„è§’åº¦ï¼Œ<code>main</code>ä¸»è¿›ç¨‹çš„é€»è¾‘ç›¸å½“äºæ˜¯<code>model</code>ï¼Œ<code>renderer</code>æ¸²æŸ“è¿›ç¨‹çš„é€»è¾‘ç›¸å½“äºæ˜¯<code>view</code>ï¼Œè€Œè‡³äº<code>controller</code>ï¼Œå¯ä»¥é€šè¿‡<code>electron</code>æ”¯æŒä¸‹çš„ä¸¤ä¸ªè¿›ç¨‹çš„<code>ipc</code>äº‹ä»¶å¤„ç†æœºåˆ¶æ¥å‘ˆç°ã€‚è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹å¯åŠ¨é€»è¾‘å°±èƒ½æ˜ç™½ã€‚</p>
<p>è¿è¡Œ<code>yarn run dev</code>ï¼Œä¼šå¯åŠ¨<code>.election-vue/dev-runner.js</code>ï¼Œå…¶ä¸­ä¼šå…ˆåˆå§‹åŒ–<code>renderer</code>å’Œ<code>main</code>ï¼Œç„¶åå†å¯åŠ¨<code>electron</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// .election-vue/dev-runner.js</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  greeting()</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Promise</span>.all([startRenderer(), startMain()])</span><br><span class="line">    .then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      startElectron()</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>startRenderer</code>å’Œ<code>startMain</code>ä¸­ä¼šè¯»å–<code>js</code>é…ç½®çš„ç¨‹åºå…¥å£ï¼Œç¼–è¯‘åè¿è¡Œã€‚ä¸¤ä¸ªè¿›ç¨‹çš„å…¥å£<code>entry</code>åˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>æ¸²æŸ“è¿›ç¨‹ï¼š<code>src/pages/index/main.js</code></li>
<li>ä¸»è¿›ç¨‹ï¼š<code>src/main/index.dev.js</code></li>
</ul>
<p>é¦–å…ˆçœ‹æ¸²æŸ“è¿›ç¨‹ï¼Œè¿è¡Œçš„å…¥å£åœ¨è¿™é‡Œï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">store.dispatch(<span class="string">'preference/fetchPreference'</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.info(<span class="string">'[Motrix] load preference:'</span>, config)</span><br><span class="line">    init(config)</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    alert(err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆä¼šé€šè¿‡<code>preference/fetchPreference</code>è¿™ä¸ª<code>action</code>æ¥è·å¾—åº”ç”¨é…ç½®ï¼Œç„¶åè°ƒç”¨<code>init</code>å‡½æ•°å¯åŠ¨ç•Œé¢ã€‚å…ˆçœ‹è·å–é…ç½®çš„é€»è¾‘ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/renderer/store/modules/preferences.js</span></span><br><span class="line"><span class="keyword">const</span> actions = &#123;</span><br><span class="line">  fetchPreference (&#123; dispatch &#125;) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      api.fetchPreference()</span><br><span class="line">        .then(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">          dispatch(<span class="string">'updatePreference'</span>, config)</span><br><span class="line">          resolve(config)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/renderer/api/Api.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Api</span> </span>&#123;</span><br><span class="line">  fetchPreference () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.config = <span class="keyword">this</span>.loadConfig()</span><br><span class="line">      resolve(<span class="keyword">this</span>.config)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">async</span> loadConfig () &#123;</span><br><span class="line">    <span class="keyword">let</span> result = is.renderer()  <span class="comment">// electron-isï¼ŒåŒ…å«electronç›¸å…³çš„IsXXXå·¥å…·å‡½æ•°</span></span><br><span class="line">      ? <span class="keyword">await</span> <span class="keyword">this</span>.loadConfigFromNativeStore()</span><br><span class="line">      : <span class="keyword">this</span>.loadConfigFromLocalStorage()</span><br><span class="line"></span><br><span class="line">    result = changeKeysToCamelCase(result)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  loadConfigFromLocalStorage () &#123;</span><br><span class="line">    <span class="keyword">const</span> result = &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> loadConfigFromNativeStore () &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> ipcRenderer.invoke(<span class="string">'get-app-config'</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æœ€ç»ˆè·å–é…ç½®çš„é€»è¾‘è½åˆ°<code>ipcRenderer.invoke(&#39;get-app-config&#39;)</code>ã€‚<code>ipcRenderer</code>ç›¸å½“äºæ˜¯æ¸²æŸ“è¿›ç¨‹é‡Œè¿›ç¨‹é—´ï¼ˆä¸<code>Main</code>ä¸»è¿›ç¨‹ï¼‰é€šä¿¡çš„<code>handle</code>ï¼Œè¿™é‡Œç›¸å½“äºæ˜¯å‘ä¸»è¿›ç¨‹<code>invoke</code>äº†ä¸€ä¸ª<code>get-app-config</code>äº‹ä»¶ã€‚åœ¨ä¸»è¿›ç¨‹ç«¯çš„<code>ipcMain</code>å¯ä»¥æ³¨å†Œè¿™ä¸ªäº‹ä»¶çš„ç›‘å¬ï¼Œç„¶åè¿”å›å¯¹åº”çš„æ•°æ®ã€‚<br><code>ipcRenderer</code>å’Œ<code>ipcMain</code>çš„é€šä¿¡ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ä¸¤ä¸ªæ–‡æ¡£ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cudzNjc2Nob29sLmNuL2VsZWN0cm9ubWFudWFsL2VsZWN0cm9ubWFudWFsLWlwYy1yZW5kZXJlci5odG1s" title="https://www.w3cschool.cn/electronmanual/electronmanual-ipc-renderer.html">ipcRendereræ¨¡å—<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cudzNjc2Nob29sLmNuL2VsZWN0cm9ubWFudWFsL2VsZWN0cm9ubWFudWFsLWlwYy1tYWluLmh0bWw=" title="https://www.w3cschool.cn/electronmanual/electronmanual-ipc-main.html">ipcMainæ¨¡å—<i class="fa fa-external-link"></i></span></li>
</ul>
<p>åˆ°è¿™é‡Œå°±æš‚åœï¼Œçœ‹ä¸‹ä¸»è¿›ç¨‹çš„å¯åŠ¨ï¼Œä¸»è¿›ç¨‹<code>index.js</code>ä¼šå¯ç”¨ä¸€ä¸ª<code>Launcher</code>æ¥å¼€å§‹ä¸»è¿›ç¨‹é€»è¾‘</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/main/index.js</span></span><br><span class="line">global.launcher = <span class="keyword">new</span> Launcher()</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/main/Launcher.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Launcher</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.url = EMPTY_STRING</span><br><span class="line">    <span class="keyword">this</span>.file = EMPTY_STRING</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åªæœ‰ä¸€ä¸ªå®ä¾‹å¯ä»¥è¿è¡Œï¼Œé€šè¿‡app.requestSingleInstanceLock()è·å–</span></span><br><span class="line">    <span class="keyword">this</span>.makeSingleInstance(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.init()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  init () &#123;</span><br><span class="line">    <span class="keyword">this</span>.exceptionHandler = <span class="keyword">new</span> ExceptionHandler()</span><br><span class="line">    <span class="keyword">this</span>.openedAtLogin = is.macOS()</span><br><span class="line">      ? app.getLoginItemSettings().wasOpenedAtLogin</span><br><span class="line">      : <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> (process.argv.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// åœºæ™¯ï¼šç½‘é¡µç›´æ¥ä¸‹è½½æ–‡ä»¶æˆ–è€…url</span></span><br><span class="line">      <span class="keyword">this</span>.handleAppLaunchArgv(process.argv)</span><br><span class="line">    &#125;</span><br><span class="line">    logger.info(<span class="string">'[Motrix] openedAtLogin:'</span>, <span class="keyword">this</span>.openedAtLogin)</span><br><span class="line">    <span class="keyword">this</span>.handleAppEvents()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  handleAppEvents () &#123;</span><br><span class="line">    <span class="keyword">this</span>.handleOpenUrl()</span><br><span class="line">    <span class="keyword">this</span>.handleOpenFile()</span><br><span class="line">    <span class="keyword">this</span>.handelAppReady()</span><br><span class="line">    <span class="keyword">this</span>.handleAppWillQuit()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¿›ç¨‹å¯åŠ¨é€»è¾‘æœ€ç»ˆè½åˆ°è¿™<code>handleAppEvents</code>é‡Œé¢å››ä¸ª<code>handler</code>ï¼Œåˆ†åˆ«æ˜¯å¦‚ä¸‹ä½œç”¨ï¼š</p>
<ul>
<li><code>handleAppReady</code>ï¼šç›‘å¬<code>ready</code>äº‹ä»¶ï¼Œåˆå§‹åŒ–<code>Application</code>å®ä¾‹ï¼ˆ<code>global.application</code>ï¼‰å¹¶ä¸ºå…¶æ³¨å†Œç›‘å¬äº‹ä»¶ï¼›ç›‘å¬<code>activate</code>äº‹ä»¶ï¼Œæ‰“å¼€<code>index</code>é¡µé¢</li>
<li><code>handleOpenUrl</code>ï¼šç›‘å¬<code>open-url</code>äº‹ä»¶ï¼Œå‘é€<code>url</code>ç»™<code>Application</code></li>
<li><code>handleOpenFile</code>ï¼šç›‘å¬<code>open-file</code>äº‹ä»¶ï¼Œå‘é€<code>file</code>ç»™<code>Application</code></li>
<li><code>handleAppWillQuit</code>ï¼šç›‘å¬<code>will-quit</code>äº‹ä»¶ï¼Œåœæ­¢<code>Application</code></li>
</ul>
<p><code>election-app</code>çš„ä¸€ç³»åˆ—äº‹ä»¶ï¼Œå¯ä»¥åœ¨<span class="exturl" data-url="aHR0cHM6Ly93d3cuZWxlY3Ryb25qcy5vcmcvemgvZG9jcy9sYXRlc3QvYXBpL2FwcA==" title="https://www.electronjs.org/zh/docs/latest/api/app">è¿™ä¸ªç½‘ç«™<i class="fa fa-external-link"></i></span>æŸ¥é˜…å…·ä½“ä½œç”¨<br>æ¥ä¸‹æ¥çœ‹ä¸‹<code>Application</code>å®ä¾‹çš„åˆå§‹åŒ–ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/main/Application.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    <span class="keyword">this</span>.isReady = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">this</span>.init()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  init () &#123;</span><br><span class="line">    <span class="comment">// é…ç½®ç®¡ç†</span></span><br><span class="line">    <span class="keyword">this</span>.configManager = <span class="keyword">this</span>.initConfigManager()</span><br><span class="line">    <span class="comment">// æœ¬åœ°åŒ–</span></span><br><span class="line">    <span class="keyword">this</span>.locale = <span class="keyword">this</span>.configManager.getLocale()</span><br><span class="line">    <span class="keyword">this</span>.localeManager = setupLocaleManager(<span class="keyword">this</span>.locale)</span><br><span class="line">    <span class="keyword">this</span>.i18n = <span class="keyword">this</span>.localeManager.getI18n()</span><br><span class="line">    <span class="comment">// èœå•</span></span><br><span class="line">    <span class="keyword">this</span>.setupApplicationMenu()</span><br><span class="line">    <span class="comment">// ? Window</span></span><br><span class="line">    <span class="keyword">this</span>.initWindowManager()</span><br><span class="line">    <span class="comment">// ? UPnP</span></span><br><span class="line">    <span class="keyword">this</span>.initUPnPManager()</span><br><span class="line">    <span class="comment">// å†…éƒ¨engineä¸client</span></span><br><span class="line">    <span class="keyword">this</span>.startEngine()</span><br><span class="line">    <span class="keyword">this</span>.initEngineClient()</span><br><span class="line">    <span class="comment">// ç•Œé¢Managers</span></span><br><span class="line">    <span class="keyword">this</span>.initTouchBarManager()</span><br><span class="line">    <span class="keyword">this</span>.initThemeManager()</span><br><span class="line">    <span class="keyword">this</span>.initTrayManager()</span><br><span class="line">    <span class="keyword">this</span>.initDockManager()</span><br><span class="line">    <span class="keyword">this</span>.autoLaunchManager = <span class="keyword">new</span> AutoLaunchManager()</span><br><span class="line">    <span class="keyword">this</span>.energyManager = <span class="keyword">new</span> EnergyManager()</span><br><span class="line">    <span class="comment">// æ›´æ–°Manager</span></span><br><span class="line">    <span class="keyword">this</span>.initUpdaterManager()</span><br><span class="line">    <span class="comment">// å†…éƒ¨åè®®Manager</span></span><br><span class="line">    <span class="keyword">this</span>.initProtocolManager()</span><br><span class="line">    <span class="comment">// æ³¨å†Œåº”ç”¨æ“ä½œäº‹ä»¶çš„handlers</span></span><br><span class="line">    <span class="keyword">this</span>.handleCommands()</span><br><span class="line">    <span class="comment">// ä¸‹è½½è¿›åº¦äº‹ä»¶çš„event</span></span><br><span class="line">    <span class="keyword">this</span>.handleEvents()</span><br><span class="line">    <span class="comment">// on/handle event channels</span></span><br><span class="line">    <span class="keyword">this</span>.handleIpcMessages()</span><br><span class="line">    <span class="keyword">this</span>.handleIpcInvokes()</span><br><span class="line">    <span class="keyword">this</span>.emit(<span class="string">'application:initialized'</span>)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä»–çš„å…ˆä¸è¯´ï¼Œåœ¨<code>handleIpcInvokes</code>é‡Œé¢æ³¨å†Œäº†<code>get-app-config</code>çš„<code>handler</code>ï¼Œé€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// src/main/Application.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">EventEmitter</span> </span>&#123;  </span><br><span class="line">  handleIpcInvokes () &#123;</span><br><span class="line">    ipcMain.handle(<span class="string">'get-app-config'</span>, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> systemConfig = <span class="keyword">this</span>.configManager.getSystemConfig()</span><br><span class="line">      <span class="keyword">const</span> userConfig = <span class="keyword">this</span>.configManager.getUserConfig()</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> result = &#123;</span><br><span class="line">        ...systemConfig,</span><br><span class="line">        ...userConfig</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/main/core/ConfigManager.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigManager</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">this</span>.systemConfig = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.userConfig = &#123;&#125;</span><br><span class="line">    <span class="keyword">this</span>.init()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  init () &#123;</span><br><span class="line">    <span class="keyword">this</span>.initSystemConfig()</span><br><span class="line">    <span class="keyword">this</span>.initUserConfig()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  initSystemConfig () &#123;</span><br><span class="line">    <span class="keyword">this</span>.systemConfig = <span class="keyword">new</span> Store(&#123;</span><br><span class="line">      name: <span class="string">'system'</span>,</span><br><span class="line">      defaults: &#123;</span><br><span class="line">        <span class="string">'all-proxy'</span>: EMPTY_STRING</span><br><span class="line">        <span class="comment">// è¿™é‡Œçœç•¥å…¶ä»–çš„äº†</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.fixSystemConfig()</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  initUserConfig () &#123;</span><br><span class="line">    <span class="keyword">this</span>.userConfig = <span class="keyword">new</span> Store(&#123;</span><br><span class="line">      name: <span class="string">'user'</span>,</span><br><span class="line">      defaults: &#123;</span><br><span class="line">        <span class="string">'all-proxy-backup'</span>: EMPTY_STRING,</span><br><span class="line">        <span class="comment">// è¿™é‡Œçœç•¥å…¶ä»–çš„äº†</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">this</span>.fixUserConfig()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç”¨äº†<code>electron-store</code>æŒä¹…åŒ–ç”¨æˆ·é…ç½®ï¼Œè¯¦æƒ…å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NpbmRyZXNvcmh1cy9lbGVjdHJvbi1zdG9yZQ==" title="https://github.com/sindresorhus/electron-store">è¿™ä¸ªé“¾æ¥<i class="fa fa-external-link"></i></span><br>æœ€ç»ˆç»™åˆ°æ¸²æŸ“è¿›ç¨‹çš„<code>config</code>ï¼Œå°±æ˜¯<code>systemConfig</code>å’Œ<code>userConfig</code>åˆå¹¶çš„ç»“æœï¼Œå› æ­¤å¯ä»¥å†è½¬åˆ°æ¸²æŸ“è¿›ç¨‹æŸ¥çœ‹<code>init(config)</code>çš„é€»è¾‘ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (is.renderer()) &#123;</span><br><span class="line">    Vue.use(<span class="built_in">require</span>(<span class="string">'vue-electron'</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  Vue.http = Vue.prototype.$http = axios</span><br><span class="line">  Vue.config.productionTip = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> &#123; locale &#125; = config</span><br><span class="line">  <span class="keyword">const</span> localeManager = getLocaleManager()</span><br><span class="line">  localeManager.changeLanguageByLocale(locale)</span><br><span class="line">  Vue.use(VueI18Next)</span><br><span class="line">  <span class="keyword">const</span> i18n = <span class="keyword">new</span> VueI18Next(localeManager.getI18n())</span><br><span class="line">  Vue.use(Element, &#123;</span><br><span class="line">    size: <span class="string">'mini'</span>,</span><br><span class="line">    i18n: <span class="function">(<span class="params">key, value</span>) =&gt;</span> i18n.t(key, value)</span><br><span class="line">  &#125;)</span><br><span class="line">  Vue.use(Msg, Message, &#123;</span><br><span class="line">    showClose: <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">  Vue.component(<span class="string">'mo-icon'</span>, Icon)</span><br><span class="line">  <span class="keyword">const</span> loading = Loading.service(&#123;</span><br><span class="line">    fullscreen: <span class="literal">true</span>,</span><br><span class="line">    background: <span class="string">'rgba(0, 0, 0, 0.1)'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  sync(store, router)</span><br><span class="line">  <span class="comment">/* eslint-disable no-new */</span></span><br><span class="line">  global.app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    components: &#123; App &#125;,</span><br><span class="line">    router,</span><br><span class="line">    store,</span><br><span class="line">    i18n,</span><br><span class="line">    template: <span class="string">'&lt;App/&gt;'</span></span><br><span class="line">  &#125;).$mount(<span class="string">'#app'</span>)</span><br><span class="line">  global.app.commands = commands</span><br><span class="line">  <span class="built_in">require</span>(<span class="string">'./commands'</span>)</span><br><span class="line">  global.app.trayWorker = initTrayWorker()</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    loading.close()</span><br><span class="line">  &#125;, <span class="number">400</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µä»£ç ä¸»è¦è®¾ç½®<code>Vue</code>çš„å†…éƒ¨å±æ€§å¹¶èµ·äº†<code>Vue</code>å®ä¾‹èµ‹äºˆ<code>global.app</code>ã€‚åœ¨å…¶ä¸­ï¼ŒåŠ è½½äº†<code>App.vue</code>ä¸­<code>id=app</code>çš„é¡µé¢å†…å®¹ï¼ŒåŒ…æ‹¬è¿™äº›ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mo-title-bar</span></span></span><br><span class="line"><span class="tag">      <span class="attr">v-if</span>=<span class="string">"isRenderer"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:showActions</span>=<span class="string">"showWindowActions"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mo-engine-client</span></span></span><br><span class="line"><span class="tag">      <span class="attr">:secret</span>=<span class="string">"rpcSecret"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mo-ipc</span> <span class="attr">v-if</span>=<span class="string">"isRenderer"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mo-dynamic-tray</span> <span class="attr">v-if</span>=<span class="string">"enableTraySpeedometer"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>&lt;router-view /&gt;</code>æ˜¯å®è´¨å±•ç¤ºäº†è·¯ç”±ä¸º<code>/</code>çš„é¡µé¢ï¼Œå¯¹åº”åˆ°<code>routers</code>é‡Œé¢å°±æ˜¯<code>@/components/Main</code>ä»¥åŠå…¶ä¸‹çº§çš„<code>task</code>çš„è·¯ç”±ç»„ä»¶ã€‚å…¶ä»–å‡ ä¸ªåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li><code>mo-title-bar</code>ï¼šé¡¶å±‚çš„æœ€å°åŒ–ã€æœ€å¤§åŒ–ã€é€€å‡ºæŒ‰é’®</li>
<li><code>mo-engine-client</code>ï¼šä¸æ¸²æŸ“ç•Œé¢çš„ç»„ä»¶ï¼Œå®è´¨åªæœ‰<code>js</code>é€»è¾‘ï¼Œç”¨äºç®¡ç†ä¸‹è½½è¿›åº¦</li>
<li><code>mo-ipc</code>ï¼šä¸æ¸²æŸ“ç•Œé¢çš„ç»„ä»¶ï¼Œå®è´¨åªæœ‰<code>js</code>é€»è¾‘ï¼Œç”¨äº<code>ipc</code></li>
<li><code>mo-dynamic-tray</code>ï¼šä¸‹è½½é€Ÿåº¦æ˜¾ç¤ºç»„ä»¶</li>
</ul>
<p>åˆ°äº†è¿™é‡Œï¼Œæ•´ä¸ª<code>app</code>å°±å¯åŠ¨å®Œæˆäº†ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>vue</tag>
        <tag>nodejs</tag>
        <tag>electron</tag>
        <tag>ipc</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬äº”ç« -å­—ç¬¦ä¸²ã€‘2ã€reï¼Œæ­£åˆ™è¡¨è¾¾å¼æºç è¯¦è§£</title>
    <url>/2022/05/14/hardpython/5_str_2/</url>
    <content><![CDATA[<p>æ­£åˆ™è¡¨è¾¾å¼æ˜¯æ–‡æœ¬å¤„ç†ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œé€šè¿‡åŒ¹é…ç‰¹å®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œèƒ½å¤Ÿå¾ˆæ–¹ä¾¿åœ°ç¼–å†™æå–ç‰¹å®šæ–‡æœ¬çš„ä»£ç ã€‚åœ¨<code>python</code>ä¸­ï¼ŒåŒæ ·ä¹Ÿå·²ç»æ‹¥æœ‰äº†æ­£åˆ™è¡¨è¾¾å¼åº“<code>re</code>ï¼Œä¸ºå„ä½å¼€å‘è€…æä¾›äº†æ­£åˆ™è¡¨è¾¾å¼çš„æ”¯æŒã€‚</p>
<p>åœ¨<code>python</code>å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå·²ç»å¯¹æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—æ¥å£ã€è¯æ³•å’Œç”¨æ³•åšäº†è¯¦ç»†çš„ä»‹ç»ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9saWJyYXJ5L3JlLmh0bWw=" title="https://docs.python.org/zh-cn/3/library/re.html"><code>re</code>â€”â€”æ­£åˆ™è¡¨è¾¾å¼æ“ä½œ<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9ob3d0by9yZWdleC5odG1sI3JlZ2V4LWhvd3Rv" title="https://docs.python.org/zh-cn/3/howto/regex.html#regex-howto">æ­£åˆ™è¡¨è¾¾å¼HOWTO<i class="fa fa-external-link"></i></span></li>
</ul>
<p>æ­£åˆ™è¡¨è¾¾å¼å¸¸è§çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_pattern</span><span class="params">()</span>:</span></span><br><span class="line">    pat = re.compile(<span class="string">'[0-9]&#123;2,3&#125;'</span>)</span><br><span class="line">    print(pat.match(<span class="string">'a'</span>))</span><br><span class="line">    print(pat.match(<span class="string">'1'</span>))</span><br><span class="line">    print(pat.match(<span class="string">'111'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_matches</span><span class="params">()</span>:</span></span><br><span class="line">    s = <span class="string">'123abc456def789xyz007ddc'</span></span><br><span class="line">    pat = re.compile(<span class="string">'([0-9]+)([a-z]+([0-9]+))'</span>)</span><br><span class="line">    <span class="keyword">for</span> match <span class="keyword">in</span> pat.finditer(s):</span><br><span class="line">        print(match.groups())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_pattern()</span><br><span class="line">    test_matches()</span><br></pre></td></tr></table></figure>
<p><code>test_pattern</code>ä¸­ï¼Œ<code>compile</code>äº†ä¸€ä¸ªåªåŒ¹é…2~3ä¸ªæ•°å­—å­—ç¬¦çš„æ­£åˆ™å¯¹è±¡ï¼Œ<code>test_matches</code>ä¸­ï¼Œåˆ™åŒ¹é…äº†æ•°å­—+å°å†™å­—æ¯+æ•°å­—çš„æ­£åˆ™å¯¹è±¡ï¼Œå¹¶ä¸”ç”¨æ‹¬å·åˆ†äº†ä¸‰ä¸ªç»„ã€‚ä¸¤ä¸ªå‡½æ•°æ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">None</span><br><span class="line">None</span><br><span class="line">&lt;re.Match object; span=(0, 3), match=&apos;111&apos;&gt;</span><br><span class="line">(&apos;123&apos;, &apos;abc456&apos;, &apos;456&apos;)</span><br><span class="line">(&apos;789&apos;, &apos;xyz007&apos;, &apos;007&apos;)</span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ·±å…¥å…¶ä¸­ï¼Œçœ‹ä¸‹æºç æ€ä¹ˆå®ç°çš„ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆæˆ‘ä»¬å°±è¿™ä¸¤ä¸ªè¯­å¥æ¥çœ‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pat = re.compile(<span class="string">'[0-9]&#123;2,3&#125;'</span>)</span><br><span class="line">pat.match(<span class="string">'111'</span>)</span><br></pre></td></tr></table></figure>
<p><code>re.compile</code>å¯¹ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è§£æåï¼Œä¼šç”Ÿæˆæ­£åˆ™æ¨¡å¼<code>Pattern</code>å¯¹è±¡ï¼Œ<code>Pattern</code>å¯¹è±¡å¯ä»¥ç”¨äºåŒ¹é…ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>re.compile</code>çš„é€»è¾‘åˆ‡å…¥ï¼Œå…ˆæ¢ç©¶<code>Pattern</code>å¯¹è±¡çš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># re.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compile</span><span class="params">(pattern, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> _compile(pattern, flags)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_compile</span><span class="params">(pattern, flags)</span>:</span></span><br><span class="line">    <span class="comment"># å°è¯•å…ˆä»LRUè·å–</span></span><br><span class="line">    p = sre_compile.compile(pattern, flags)</span><br><span class="line">    <span class="comment"># æ›´æ–°LRU</span></span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sre_compile.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compile</span><span class="params">(p, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> isstring(p):</span><br><span class="line">        pattern = p</span><br><span class="line">        p = sre_parse.parse(p, flags)  <span class="comment"># è§£æå­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        pattern = <span class="literal">None</span></span><br><span class="line">    code = _code(p, flags)</span><br><span class="line">    <span class="keyword">if</span> flags &amp; SRE_FLAG_DEBUG:</span><br><span class="line">        print()</span><br><span class="line">        dis(code)</span><br><span class="line">    <span class="comment"># map in either direction</span></span><br><span class="line">    groupindex = p.state.groupdict</span><br><span class="line">    indexgroup = [<span class="literal">None</span>] * p.state.groups</span><br><span class="line">    <span class="keyword">for</span> k, i <span class="keyword">in</span> groupindex.items():</span><br><span class="line">        indexgroup[i] = k</span><br><span class="line">    <span class="keyword">return</span> _sre.compile(</span><br><span class="line">        pattern, flags | p.state.flags, code,</span><br><span class="line">        p.state.groups<span class="number">-1</span>,</span><br><span class="line">        groupindex, tuple(indexgroup)</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>æ­£åˆ™<code>Pattern</code>çš„ç”Ÿæˆï¼Œæœ€ç»ˆèµ°åˆ°äº†<code>sre_compile.py</code>ä¸­çš„<code>compile</code>å‡½æ•°ï¼Œä¸»è¦æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>é€šè¿‡<code>sre_parse.parse</code>è§£ææ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²</li>
<li>é€šè¿‡<code>_code</code>æ–¹æ³•ç”Ÿæˆè§£æç»“æœçš„å­—èŠ‚ç ï¼Œç„¶åé€šè¿‡<code>_sre.compile</code>ç”Ÿæˆæœ€ç»ˆçš„<code>Pattern</code>å¯¹è±¡</li>
</ul>
<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹<code>parse</code>è§£æé€»è¾‘ï¼Œå…¶ä»£ç å®ç°å¦‚ä¸‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sre_parse.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse</span><span class="params">(str, flags=<span class="number">0</span>, state=None)</span>:</span></span><br><span class="line">    source = Tokenizer(str)</span><br><span class="line">    <span class="keyword">if</span> state <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        state = State()</span><br><span class="line">    state.flags = flags</span><br><span class="line">    state.str = str</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        p = _parse_sub(source, state, flags &amp; SRE_FLAG_VERBOSE, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">except</span> Verbose:</span><br><span class="line">        state = State()</span><br><span class="line">        state.flags = flags | SRE_FLAG_VERBOSE</span><br><span class="line">        state.str = str</span><br><span class="line">        source.seek(<span class="number">0</span>)</span><br><span class="line">        p = _parse_sub(source, state, <span class="literal">True</span>, <span class="number">0</span>)</span><br><span class="line">    p.state.flags = fix_flags(str, p.state.flags)</span><br><span class="line">    <span class="keyword">if</span> source.next <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">assert</span> source.next == <span class="string">")"</span></span><br><span class="line">        <span class="keyword">raise</span> source.error(<span class="string">"unbalanced parenthesis"</span>)</span><br><span class="line">    <span class="keyword">if</span> flags &amp; SRE_FLAG_DEBUG:</span><br><span class="line">        p.dump()</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_parse_sub</span><span class="params">(source, state, verbose, nested)</span>:</span></span><br><span class="line">    items = []</span><br><span class="line">    itemsappend = items.append</span><br><span class="line">    sourcematch = source.match</span><br><span class="line">    start = source.tell()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        itemsappend(_parse(source, state, verbose, nested + <span class="number">1</span>,</span><br><span class="line">                           <span class="keyword">not</span> nested <span class="keyword">and</span> <span class="keyword">not</span> items))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> sourcematch(<span class="string">"|"</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> len(items) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> items[<span class="number">0</span>]</span><br><span class="line">    subpattern = SubPattern(state)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        prefix = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> item:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> prefix <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                prefix = item[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">elif</span> item[<span class="number">0</span>] != prefix:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">                <span class="keyword">del</span> item[<span class="number">0</span>]</span><br><span class="line">            subpattern.append(prefix)</span><br><span class="line">            <span class="keyword">continue</span> <span class="comment"># check next one</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    set = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">if</span> len(item) != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        op, av = item[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">if</span> op <span class="keyword">is</span> LITERAL:</span><br><span class="line">            set.append((op, av))</span><br><span class="line">        <span class="keyword">elif</span> op <span class="keyword">is</span> IN <span class="keyword">and</span> av[<span class="number">0</span>][<span class="number">0</span>] <span class="keyword">is</span> <span class="keyword">not</span> NEGATE:</span><br><span class="line">            set.extend(av)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        subpattern.append((IN, _uniq(set)))</span><br><span class="line">        <span class="keyword">return</span> subpattern</span><br><span class="line">    subpattern.append((BRANCH, (<span class="literal">None</span>, items)))</span><br><span class="line">    <span class="keyword">return</span> subpattern</span><br></pre></td></tr></table></figure>
<p>å¤§è‡´æ‹ä¸€ä¸‹æµç¨‹ï¼š</p>
<ul>
<li>åˆå§‹åŒ–<code>Tokenizer</code>ï¼šæä¾›äº†è®¿é—®ã€æ£€ç´¢å­—ç¬¦ä¸²å½“å‰ä»¥åŠåç»­çš„è¯æ³•å•å…ƒ<code>token</code>çš„ä¸€ç³»åˆ—æ–¹æ³•ï¼Œä¾›<code>parser</code>è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨</li>
<li>åˆå§‹åŒ–<code>State</code>ï¼šç”¨äºè®°å½•è§£æè¿‡ç¨‹ä¸­çš„çŠ¶æ€ï¼Œæ£€æµ‹ä¸€äº›è§£æçš„å¼‚å¸¸æƒ…å†µï¼Œä¸»è¦æ˜¯è®°å½•è·Ÿç»„<code>group</code>æœ‰å…³çš„ä¿¡æ¯<ul>
<li><code>group</code>åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ï¼Œç›¸å½“äºå°æ‹¬å·ä¹‹é—´çš„å†…å®¹</li>
</ul>
</li>
<li>è°ƒç”¨<code>_parse_sub</code>ï¼Œä¼ å…¥<code>Tokenizer</code>è·Ÿ<code>State</code>å®ä¾‹ï¼Œè§£ææ­£åˆ™è¡¨è¾¾å¼</li>
</ul>
<p>åœ¨<code>_parse_sub</code>é‡Œï¼Œåˆ™æ˜¯è¿™æ ·çš„æµç¨‹ï¼š</p>
<ul>
<li>ä¸æ–­è°ƒç”¨<code>_parse</code>è§£æå‡ºä»¥<code>|</code>ç¬¦å·åˆ†éš”çš„ä¸€ä¸ªä¸ª<code>SubPattern</code>å®ä¾‹<ul>
<li><code>SubPattern</code>å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå•ä½<code>Pattern</code>ï¼Œä¸åŒ<code>SubPattern</code>ä¹‹é—´ç›¸äº’åµŒå¥—ï¼Œå½¢æˆæ ‘çš„ç»“æ„</li>
</ul>
</li>
<li>å¦‚æœåªå‡ºä¸€ä¸ª<code>SubPattern</code>å®ä¾‹ï¼Œç›´æ¥è¿”å›ï¼Œå¦åˆ™è¿›è¡Œåç»­é€»è¾‘</li>
<li>å¦‚æœæ¯ä¸ª<code>SubPattern</code>å®ä¾‹éƒ½å…±äº«ç›¸åŒåŒ¹é…å‰ç¼€ï¼Œå°±æŠŠç›¸åŒå‰ç¼€æå–å‡ºæ¥</li>
<li>å¦‚æœæ¯ä¸ª<code>SubPattern</code>å®ä¾‹éƒ½èƒ½ä»¥å­—ç¬¦é›†è¡¨ç¤ºï¼Œå°±æ•´åˆæˆä¸€ä¸ªå­—ç¬¦é›†</li>
<li>å°†å¤šä¸ª<code>SubPattern</code>å®ä¾‹ç»„åˆä¸ºä¸€ä¸ª<code>BRANCH</code>åˆ†æ”¯åŒ¹é…<code>SubPattern</code>ï¼Œå¹¶è¿”å›</li>
</ul>
<p><code>_parse</code>å‡½æ•°æ˜¯è§£ææ­£åˆ™çš„ä¸»ä½“é€»è¾‘ï¼Œå…·ä½“ä»£ç å¯ä»¥åœ¨<code>sre_parse.py</code>ä¸­æŸ¥é˜…ã€‚ä»¥åˆšæ‰ç»™å®šçš„<code>&#39;[0-9]{2,3}&#39;</code>ä¸ºä¾‹å­ï¼Œä¼šè¿›è¡Œå¦‚ä¸‹çš„æ­¥éª¤ï¼š</p>
<ul>
<li>åŒ¹é…åˆ°<code>[</code>ç¬¦å·ï¼Œè¿›å…¥<code>[</code>çš„åˆ†æ”¯<ul>
<li>é¦–å…ˆåˆ¤æ–­æ˜¯å¦æœ‰<code>^</code>ç¬¦å·ï¼ˆ<code>negate</code>ï¼‰ï¼Œå³è¡¨ç¤º<code>â€œéxxxå­—ç¬¦â€</code>çš„å«ä¹‰ï¼Œå®é™…æ˜¯æ²¡æœ‰</li>
<li>è¿›å…¥å­—ç¬¦é›†å–å€¼å¾ªç¯ï¼Œé¦–å…ˆå–åˆ°å­—ç¬¦<code>0</code></li>
<li>å–å®Œäº†ä¹‹ååˆ¤æ–­æ˜¯å¦æœ‰èŒƒå›´åŒ¹é…æ¨¡å¼<code>-</code>ï¼Œå‘ç°æœ‰ï¼Œè¿›å…¥<code>-</code>çš„åˆ†æ”¯</li>
<li>åœ¨<code>-</code>çš„åˆ†æ”¯é‡Œï¼Œå–åˆ°å­—ç¬¦<code>9</code></li>
<li>ä¹‹åå–åˆ°<code>]</code>ï¼Œé€€å‡ºå­—ç¬¦é›†å–å€¼å¾ªç¯</li>
<li>åå¤„ç†ï¼šå¯¹å­—ç¬¦é›†å–å€¼å–äº¤é›†ï¼Œå¦‚æœæœ‰<code>negate</code>å°±å–é</li>
<li>é€€å‡º<code>]</code>çš„åˆ†æ”¯ï¼Œå½“å‰<code>SubPattern</code>å®ä¾‹åŒ…å«äº†æ¨¡å¼ï¼š<code>(IN, [(RANGE, (48, 57))])</code></li>
</ul>
</li>
<li>åœ¨<code>REPEAT_CHARS</code>åŒ¹é…åˆ°<code>{</code>ç¬¦å·ï¼Œè¿›å…¥<code>{</code>çš„åˆ†æ”¯<ul>
<li><code>REPEAT_CHARS</code>è¡¨ç¤ºé‡å¤å­—ç¬¦ï¼Œå³<code>*+?{</code></li>
<li>ä¸æ–­æå–å­—ç¬¦ï¼Œè§£æ<code>x,y</code>æ ·å¼çš„å­—ç¬¦ä¸²ï¼Œç¡®å®šé‡å¤æ¬¡æ•°èŒƒå›´</li>
<li>è§£æåˆ°<code>}</code>ï¼Œé€€å‡º <code>{</code> çš„åˆ†æ”¯</li>
<li><code>wrap</code>å‰é¢çš„<code>SubPattern</code>ï¼Œå¾—åˆ°æ–°çš„<code>SubPattern</code>æ¨¡å¼ï¼š<code>(MAX_REPEAT, (2, 3, [(IN, [(RANGE, (48, 57))])]))</code></li>
</ul>
</li>
<li>å–ä¸åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦ï¼Œé€€å‡ºå¾ªç¯</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°æ•´ä¸ª<code>_parse</code>é€»è¾‘æ˜¯ä¸€ä¸ªçŠ¶æ€æœºçš„å½¢å¼ï¼ŒåŒ¹é…åˆ°ä¸åŒçš„è¯æ³•å•å…ƒ<code>token</code>ï¼Œåœ¨ä¸åŒåˆ†æ”¯çš„è¯æ³•åˆ†æçŠ¶æ€ä¸‹ï¼Œç›¸åŒçš„<code>token</code>ä¼šå‘ˆç°ä¸åŒçš„æ¶µä¹‰ã€‚å› æ­¤æ•´å—ä»£ç å‘ˆç°èµ·æ¥ï¼Œå°±æˆäº†<code>if-else</code>çš„å¤§æ‚çƒ©</p>
<p>å¦‚æœæ˜¯åŒ…å«å¤šä¸ª<code>group</code>çš„æƒ…å†µï¼Œå°±è¿˜è¦èµ°æ›´å¤šçš„çš„åˆ†æ”¯é€»è¾‘ã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥çœ‹ï¼š<code>&#39;(?&lt;=ab)([^\\si-w]+([125]+?))&#39;</code>ï¼Œå®ƒçš„é€»è¾‘æ˜¯è¿™æ ·èµ°çš„ï¼š</p>
<ul>
<li>åŒ¹é…åˆ°<code>(</code>ç¬¦å·ï¼Œè¿›å…¥<code>(</code>çš„åˆ†æ”¯<ul>
<li>å‘ç°ç¬¬ä¸€ä¸ªç¬¦å·æ˜¯<code>?</code>ï¼Œè¡¨æ˜è¿™ä¸€æ®µæ˜¯éè·å–åŒ¹é…<ul>
<li>éè·å–åŒ¹é…è¡¨ç¤ºï¼Œæ•´ä¸ªæ¨¡å¼æœ€ç»ˆèƒ½åŒ¹é…åˆ°çš„å„ä¸ªå­—ç¬¦ä¸²ç»„é‡Œï¼Œä¸ä¼šåŒ…æ‹¬éè·å–åŒ¹é…çš„æ‹¬å·çš„éƒ¨åˆ†</li>
<li>åˆ¤æ–­ä¸‹ä¸€ä¸ªç¬¦å·æ˜¯ä¸æ˜¯<code>&lt;</code>ï¼Œå¦‚æœæ˜¯åˆ™ä¸ºåå‘é¢„æŸ¥åŒ¹é…</li>
<li>è§£æéè·å–åŒ¹é…çš„<code>SubPattern</code>å®ä¾‹</li>
<li>åˆ¤æ–­å¯¹æ¯”ç¬¦å·æ˜¯<code>=</code>è¿˜æ˜¯ <code>!</code> ï¼Œå†³å®šè¿™ç»„<code>SubPattern</code>è¦ä¹ˆæ˜¯<code>ASSERT</code>ï¼Œè¦ä¹ˆæ˜¯<code>ASSERT_NOT</code></li>
<li>å¾—åˆ°<code>SubPattern</code>å®ä¾‹<code>(ASSERT, (-1, [(LITERAL, 97), (LITERAL, 98)]))</code>ï¼Œç»§ç»­ä¸‹ä¸€è½®å¾ªç¯</li>
</ul>
</li>
</ul>
</li>
<li>åˆåŒ¹é…åˆ°<code>(</code>ç¬¦å·ï¼Œå†æ¬¡è¿›å…¥<code>(</code>çš„åˆ†æ”¯<ul>
<li>ç¬¬ä¸€ä¸ªç¬¦å·ä¸æ˜¯<code>?</code>ï¼Œè¿›å…¥åç»­é€»è¾‘ï¼Œè°ƒç”¨<code>state.opengroup</code>ï¼Œè‡ªå¢<code>groups</code>è®¡æ•°</li>
<li>è§£æåé¢çš„<code>pattern</code>ï¼Œå…ˆå¾—åˆ°<code>[^\\si-w]+</code>å¯¹åº”çš„ä¸€æ®µï¼š<code>(MAX_REPEAT, (1, MAXREPEAT, [(IN, [(NEGATE, None), (CATEGORY, CATEGORY_SPACE), (RANGE, (105, 119))])]))</code></li>
<li>å†æ¬¡åŒ¹é…åˆ°<code>(</code>ç¬¦å·ï¼Œåˆè¿›å…¥ä¸€æ¬¡<code>(</code>çš„åˆ†æ”¯<ul>
<li>å¾—åˆ°<code>[125]+?</code>å¯¹åº”çš„ä¸€æ®µ<code>SubPattern</code>ï¼š<code>(MIN_REPEAT, (1, MAXREPEAT, [(IN, [(LITERAL, 49), (LITERAL, 50), (LITERAL, 53)])]))</code><br>å¯ä»¥æ³¨æ„åˆ°éè´ªå©ªåŒ¹é…å®é™…ç”¨<code>MIN_REPEAT</code>è¯­ä¹‰è¡¨ç¤º</li>
<li>åŒ¹é…åˆ°<code>)</code>ç¬¦å·ï¼Œé€€å‡º</li>
<li>è°ƒç”¨<code>state.closegroup</code>ï¼Œåœ¨<code>state</code>ä¸­è®°å½•<code>[125]+?</code>å¯¹åº”çš„åŒ¹é…å®½åº¦åˆ°ç»„<code>2ï¼š(1, 4294967295)</code></li>
<li>æ·»åŠ ä¸€ä¸ª<code>SUBPATTERN</code>ç±»å‹çš„<code>SubPattern</code>å®ä¾‹ï¼Œé‡Œé¢å°è£…<code>group</code>è®¡æ•°å·ã€è§£æåˆ°çš„çœŸå®<code>SubPattern</code>å®ä¾‹ä»¥åŠå…¶å®ƒä¿¡æ¯</li>
<li>åŒ¹é… <code>)</code>ï¼Œé€€å‡º<code>(</code>çš„åˆ†æ”¯</li>
</ul>
</li>
<li>åŒ¹é…åˆ°<code>)</code>ï¼Œé€€å‡º<code>(</code>çš„åˆ†æ”¯</li>
<li>è°ƒç”¨<code>state.closegroup</code>ï¼Œåœ¨<code>state</code>ä¸­è®°å½•<code>[^\\si-w]+([125]+?)</code>å¯¹åº”çš„åŒ¹é…å®½åº¦åˆ°ç»„<code>1ï¼š(2, MAXREPEAT)</code></li>
</ul>
</li>
<li>çˆ¶<code>subpattern</code>éå†åä¸‹æ‰€æœ‰<code>SubPattern</code>å®ä¾‹ï¼Œå¦‚æœå‘ç°ç”±<code>SUBPATTERN</code>ç±»å‹ä¸”çœŸå®<code>SubPattern</code>å®ä¾‹ä¸ºéæ•è·ç»„ï¼ˆ<code>non-capturing</code>ï¼Œå³å½¢ä¼¼<code>(?:)</code>çš„å½¢å¼ï¼‰ï¼Œå°±æå–çœŸå®çš„<code>SubPattern</code>å®ä¾‹å‡ºæ¥æ›¿æ¢å½“å‰<code>SUBPATTERN</code>ç±»å‹çš„å®ä¾‹</li>
</ul>
<p>è¿™æ ·æ•´ä¸ª<code>parse</code>çš„éƒ¨åˆ†å°±ç»“æŸäº†ï¼Œæœ€ç»ˆæˆ‘ä»¬è·å–åˆ°ï¼š</p>
<ul>
<li><code>subpattern</code><ul>
<li>æ ¹<code>subpattern</code>ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼</li>
<li><code>SUBPATTERN</code>å®ä¾‹1ï¼š<code>[^\\si-w]+([125]+?)</code></li>
<li><code>SUBPATTERN</code>å®ä¾‹2ï¼š<code>[125]+?</code></li>
</ul>
</li>
<li><code>state</code><ul>
<li><code>groups</code>è®¡æ•°ä¸º3ï¼ˆä¸‹ä¸€ä¸ª<code>group</code>çš„<code>id</code>ï¼‰ï¼Œéœ€è¦å†-1ï¼Œå³å®é™…åªæœ‰2ä¸ª<code>group</code></li>
<li>1ã€2å·ä¸‹æ ‡å®½åº¦ï¼š<code>(2, MAXREPEAT)</code>ã€<code>(1, 4294967295)</code></li>
</ul>
</li>
<li><code>code</code>ï¼š<code>subpattern</code>è¢«ç¼–è¯‘å‡ºæ¥çš„å­—èŠ‚ç åºåˆ—ï¼Œç”¨ä»¥è¿›è¡Œå®é™…çš„åŒ¹é…æ“ä½œ</li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯<code>_sre.compile</code>çš„é€»è¾‘äº†ï¼Œè¿™é‡Œå…ˆæš‚ä¸åˆ—ä¸¾äº†ï¼Œæœ‰å…´è¶£å¯ä»¥åœ¨<code>_sre.c</code>ä¸­çœ‹åˆ°ï¼Œä¸»è¦ä½œç”¨å°±æ˜¯æŠŠæ‰€æœ‰ä¿¡æ¯é›†åˆåœ¨ä¸€èµ·å°è£…æˆä¸ºå•ç‹¬çš„ä¸€ä¸ª<code>re.Pattern</code>å®ä¾‹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _sre.c</span></span><br><span class="line"><span class="keyword">static</span> PyType_Spec pattern_spec = &#123;</span><br><span class="line">    .name = <span class="string">"re.Pattern"</span>,</span><br><span class="line">    .basicsize = <span class="keyword">sizeof</span>(PatternObject),</span><br><span class="line">    .itemsize = <span class="keyword">sizeof</span>(SRE_CODE),</span><br><span class="line">    .flags = (Py_TPFLAGS_DEFAULT | Py_TPFLAGS_IMMUTABLETYPE |</span><br><span class="line">              Py_TPFLAGS_DISALLOW_INSTANTIATION | Py_TPFLAGS_HAVE_GC),</span><br><span class="line">    .slots = pattern_slots,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å°è£…å®Œäº†ä¹‹åçš„<code>Pattern</code>å®ä¾‹ï¼Œå°±å¯ä»¥ç”¨æ¥åŒ¹é…å­—ç¬¦ä¸²äº†ã€‚æˆ‘ä»¬ä»¥<code>&#39;(?&lt;=ab)([^\\si-w]+([125]+?))&#39;</code>è¿™ä¸ª<code>Pattern</code>å®ä¾‹ä¸ºä¾‹ï¼Œæ¥åŒ¹é…å­—ç¬¦ä¸²<code>&#39;  abcde1233  gabh5455&#39;</code>ï¼Œæ‰¾åˆ°æ‰€æœ‰åŒ¹é…çš„ç»„åˆ</p>
<p>æˆ‘ä»¬å¯ä»¥ç”¨<code>finditer</code>æ–¹æ³•ï¼Œå¯»æ‰¾æ‰€æœ‰åŒ¹é…çš„<code>Match</code>å®ä¾‹ï¼Œ<code>finditer</code>æ–¹æ³•çš„å®ç°åœ¨<code>_sre_SRE_Pattern_finditer_impl</code>ä¸­ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">_sre_SRE_Pattern_finditer_impl(PatternObject *self, PyTypeObject *cls,</span><br><span class="line">                               PyObject *<span class="built_in">string</span>, Py_ssize_t pos,</span><br><span class="line">                               Py_ssize_t endpos)</span><br><span class="line">&#123;</span><br><span class="line">    _sremodulestate *module_state = get_sre_module_state_by_class(cls);</span><br><span class="line">    PyObject* scanner;</span><br><span class="line">    PyObject* search;</span><br><span class="line">    PyObject* iterator;</span><br><span class="line">    scanner = pattern_scanner(module_state, self, <span class="built_in">string</span>, pos, endpos);</span><br><span class="line">    <span class="keyword">if</span> (!scanner)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    search = PyObject_GetAttrString(scanner, <span class="string">"search"</span>);</span><br><span class="line">    Py_DECREF(scanner);</span><br><span class="line">    <span class="keyword">if</span> (!search)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    iterator = PyCallIter_New(search, Py_None);</span><br><span class="line">    Py_DECREF(search);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> iterator;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>finditer</code>åˆ›å»ºäº†ä¸€ä¸ª<code>ScannerObject</code>ç”¨äºå¯¹æ•´ä¸ªå­—ç¬¦ä¸²çš„æ‰«æï¼Œä¼šä¸æ–­è°ƒç”¨<code>ScannerObject</code>çš„<code>search</code>æ–¹æ³•å–æœç´¢åŒ¹é…ä½†ä¸é‡å çš„å­ä¸²ã€‚<code>ScannerObject</code>å’Œ<code>Pattern</code>çš„<code>search</code>æ–¹æ³•åŸç†æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡<code>Pattern.search</code>æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè€Œ<code>ScannerObject</code>çš„<code>search</code>åœ¨è¿›è¡Œä¸€è½®ä¹‹åä¼šæ›´æ–°è‡ªèº«å†…éƒ¨çš„çŠ¶æ€ï¼Œè°ƒæ•´åŒ¹é…èµ·å§‹ä½ç½®ï¼Œä»¥æ–¹ä¾¿ä¸‹ä¸€è½®åŒ¹é…</p>
<p><code>ScannerObject</code>çš„<code>search</code>æ–¹æ³•æ˜¯å¦‚ä¸‹çš„å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">_sre_SRE_Scanner_search_impl(ScannerObject *self, PyTypeObject *cls)</span><br><span class="line">&#123;</span><br><span class="line">    _sremodulestate *module_state = get_sre_module_state_by_class(cls);</span><br><span class="line">    SRE_STATE* state = &amp;self-&gt;state;</span><br><span class="line">    PyObject* match;</span><br><span class="line">    Py_ssize_t status;</span><br><span class="line">    <span class="keyword">if</span> (state-&gt;start == <span class="literal">NULL</span>)</span><br><span class="line">        Py_RETURN_NONE;</span><br><span class="line">    state_reset(state);</span><br><span class="line">    state-&gt;ptr = state-&gt;start;</span><br><span class="line">    status = sre_search(state, PatternObject_GetCode(self-&gt;pattern));</span><br><span class="line">    <span class="keyword">if</span> (PyErr_Occurred())</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    match = pattern_new_match(module_state, (PatternObject*) self-&gt;pattern,</span><br><span class="line">                              state, status);</span><br><span class="line">    <span class="keyword">if</span> (status == <span class="number">0</span>)</span><br><span class="line">        state-&gt;start = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        state-&gt;must_advance = (state-&gt;ptr == state-&gt;start);</span><br><span class="line">        state-&gt;start = state-&gt;ptr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> match;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>é‡ç½®å†…éƒ¨ç»´æŠ¤çš„çŠ¶æ€</li>
<li>è°ƒç”¨<code>sre_search</code>ï¼ŒåŒ¹é…ä¸€ä¸ªç¬¦åˆæ­£åˆ™çš„å­ä¸²</li>
<li>è°ƒç”¨<code>pattern_new_match</code>ï¼Œç”Ÿæˆä¸€ä¸ª<code>Match</code>å®ä¾‹</li>
</ul>
<p><code>sre_search</code>æœ€ç»ˆä¼šè°ƒç”¨<code>SRE(match)</code>è¿›è¡ŒåŒ¹é…æ“ä½œï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦èµ·å¤´åŒ¹é…å¤±è´¥çš„è¯ï¼Œ<code>sre_search</code>è¿˜ä¼šç»§ç»­ä»¥åé¢çš„å­—ç¬¦èµ·å¤´å¼€å§‹åŒ¹é…ï¼Œç›´åˆ°åŒ¹é…åˆ°ä¸ºæ­¢</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// sre_lib.h</span></span><br><span class="line">LOCAL(Py_ssize_t)</span><br><span class="line">SRE(search)(SRE_STATE* state, SRE_CODE* pattern)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// çœç•¥ä¸Šé¢</span></span><br><span class="line">		<span class="comment">/* general case */</span></span><br><span class="line">        assert(ptr &lt;= end);</span><br><span class="line">        TRACE((<span class="string">"|%p|%p|SEARCH\n"</span>, pattern, ptr));</span><br><span class="line">        state-&gt;start = state-&gt;ptr = ptr;</span><br><span class="line">        status = SRE(match)(state, pattern, <span class="number">1</span>);  <span class="comment">// statusä¸º0è¡¨ç¤ºåŒ¹é…å¤±è´¥ï¼Œ1è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line">        state-&gt;must_advance = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (status == <span class="number">0</span> &amp;&amp; ptr &lt; end) &#123;</span><br><span class="line">            ptr++;</span><br><span class="line">            RESET_CAPTURE_GROUP();</span><br><span class="line">            TRACE((<span class="string">"|%p|%p|SEARCH\n"</span>, pattern, ptr));</span><br><span class="line">            state-&gt;start = state-&gt;ptr = ptr;</span><br><span class="line">            status = SRE(match)(state, pattern, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> status</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>SRE(match)</code>ä¼šæ ¹æ®<code>pattern</code>ç¼–è¯‘å‡ºæ¥çš„<code>code</code>å­—èŠ‚ç é‡Œé¢çš„å†…å®¹ï¼Œæ ¹æ®ä¸åŒçš„å­—èŠ‚ç ï¼Œèµ°åˆ°å¯¹åº”çš„åˆ†æ”¯é€»è¾‘å†é€å­—åŒ¹é…ï¼Œç±»ä¼¼äº<code>python</code>è™šæ‹Ÿæœºè§£æ<code>python</code>å­—èŠ‚ç çš„æ“ä½œï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">LOCAL(Py_ssize_t)</span><br><span class="line">SRE(match)(SRE_STATE* state, <span class="keyword">const</span> SRE_CODE* pattern, <span class="keyword">int</span> toplevel)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å¤§å¾ªç¯</span></span><br><span class="line">	<span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        ++sigcount;</span><br><span class="line">        <span class="keyword">switch</span> (*ctx-&gt;pattern++) &#123;  <span class="comment">// æ ¹æ®ä¸åŒçš„æ“ä½œç¬¦ï¼Œæ‰§è¡Œä¸åŒçš„åŒ¹é…åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">case</span> SRE_OP_MARK:</span><br><span class="line">            TRACE((<span class="string">"|%p|%p|MARK %d\n"</span>, ctx-&gt;pattern,</span><br><span class="line">                   ctx-&gt;ptr, ctx-&gt;pattern[<span class="number">0</span>]));</span><br><span class="line">            i = ctx-&gt;pattern[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">if</span> (i &amp; <span class="number">1</span>)</span><br><span class="line">                state-&gt;lastindex = i/<span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &gt; state-&gt;lastmark) &#123;</span><br><span class="line">                Py_ssize_t j = state-&gt;lastmark + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span> (j &lt; i)</span><br><span class="line">                    state-&gt;mark[j++] = <span class="literal">NULL</span>;</span><br><span class="line">                state-&gt;lastmark = i;</span><br><span class="line">            &#125;</span><br><span class="line">            state-&gt;mark[i] = ctx-&gt;ptr;</span><br><span class="line">            ctx-&gt;pattern++;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> SRE_OP_LITERAL:</span><br><span class="line">            TRACE((<span class="string">"|%p|%p|LITERAL %d\n"</span>, ctx-&gt;pattern,</span><br><span class="line">                   ctx-&gt;ptr, *ctx-&gt;pattern));</span><br><span class="line">            <span class="keyword">if</span> (ctx-&gt;ptr &gt;= end || (SRE_CODE) ctx-&gt;ptr[<span class="number">0</span>] != ctx-&gt;pattern[<span class="number">0</span>])</span><br><span class="line">                RETURN_FAILURE;</span><br><span class="line">            ctx-&gt;pattern++;</span><br><span class="line">            ctx-&gt;ptr++;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨å­—ç¬¦ä¸²<code>&#39;  abcde1233  gabh5455&#39;</code>ä¸­ï¼Œå½“èµ·å§‹å­—ç¬¦<code>ptr</code>æŒ‡å‘ç¬¬ä¸€ä¸ª<code>c</code>çš„æ—¶å€™ï¼Œå°†ä¼šæœ‰ä¸€æ¬¡æˆåŠŸçš„åŒ¹é…ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>é‡åˆ°<code>SRE_OP_ASSERT</code>ä»¥åŠ<code>SRE_OP_LITERAL</code>å­—èŠ‚ç ï¼Œåå‘åŒ¹é…å‰é¢çš„<code>ab</code>å­ä¸²</li>
<li>é‡åˆ°<code>SRE_OP_MARK</code>å­—èŠ‚ç ï¼Œè®°å½•ç¬¬ä¸€ä¸ª<code>group</code>çš„èµ·å§‹ä½ç½®ï¼Œ<code>MARK</code>çš„å‚æ•°ä¸º<code>0</code></li>
<li>é‡åˆ°<code>SRE_OP_REPEAT_ONE</code>å­—èŠ‚ç ï¼ŒåŒ¹é…<code>[^\\si-w]+</code>æ¨¡å¼çš„æœ€å¤§å­ä¸²ï¼Œå³ä¸º<code>cde1233</code><ul>
<li>å°è¯•åŒ¹é…åé¢çš„å†…å®¹ï¼Œåœ¨<code>SRE_OP_MARK</code>åˆ†æ”¯è®°å½•ç¬¬äºŒä¸ª<code>group</code>çš„èµ·å§‹ä½ç½®ï¼Œå‚æ•°ä¸º<code>2</code></li>
<li>é‡åˆ°<code>SRE_OP_MIN_REPEAT_ONE</code>ï¼Œéè´ªå©ªåŒ¹é…<code>[125]+?</code></li>
<li>å› ä¸º<code>cde1233</code>åé¢çš„å­—ç¬¦æ˜¯ç©ºæ ¼ï¼ŒåŒ¹é…å¤±è´¥ï¼Œé€€å‡ºä¸€è½®åŒ¹é…</li>
<li>å…ˆå‰åŒ¹é…æœ€å¤§å­—ä¸²ä¸º<code>cde1233</code>ï¼Œå› åé¢æ¨¡å¼åŒ¹é…å¤±è´¥ï¼Œå°¾éƒ¨ç´¢å¼•-1ï¼Œç»§ç»­åŒ¹é…</li>
<li>ç›´åˆ°å­ä¸²ä¸º<code>cde1</code>ï¼Œéè´ªå©ªåŒ¹é…åˆ°<code>2</code>ï¼ŒåŒ¹é…æˆåŠŸ</li>
</ul>
</li>
<li>è¿ç»­é‡åˆ°<code>SRE_OP_MARK</code>å­—èŠ‚ç ï¼Œè®°å½•ä¸¤ä¸ª<code>group</code>çš„æœ€ç»ˆä½ç½®ï¼Œ<code>MARK</code>çš„å‚æ•°åˆ†åˆ«ä¸º<code>3</code>å’Œ<code>1</code><ul>
<li>è¿™æ ·<code>MARK</code>é‡Œé¢ï¼Œ<code>0ã€1</code>å’Œ<code>2ã€3</code>é‡Œé¢çš„æŒ‡å‘å†…å®¹ï¼Œå°±åˆ†åˆ«å¯¹åº”äº†ä¸¤ä¸ª<code>group</code>çš„èµ·æ­¢ä½ç½®</li>
</ul>
</li>
<li>é‡åˆ°<code>SRE_OP_SUCCESS</code>å­—èŠ‚ç ï¼Œè¡¨ç¤ºæœ€ç»ˆåŒ¹é…æˆåŠŸ</li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡<code>pattern_new_match</code>ç”Ÿæˆ<code>Match</code>å®ä¾‹ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> PyObject*</span><br><span class="line">pattern_new_match(_sremodulestate* module_state,</span><br><span class="line">                  PatternObject* pattern,</span><br><span class="line">                  SRE_STATE* state,</span><br><span class="line">                  Py_ssize_t status)</span><br><span class="line">&#123;</span><br><span class="line">    MatchObject* match;</span><br><span class="line">    Py_ssize_t i, j;</span><br><span class="line">    <span class="keyword">char</span>* base;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">if</span> (status &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        match = PyObject_GC_NewVar(MatchObject,module_state-&gt;Match_Type,<span class="number">2</span>*(pattern-&gt;groups+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span> (!match)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        Py_INCREF(pattern);</span><br><span class="line">        match-&gt;pattern = pattern;</span><br><span class="line">        Py_INCREF(state-&gt;<span class="built_in">string</span>);</span><br><span class="line">        match-&gt;<span class="built_in">string</span> = state-&gt;<span class="built_in">string</span>;</span><br><span class="line">        match-&gt;regs = <span class="literal">NULL</span>;</span><br><span class="line">        match-&gt;groups = pattern-&gt;groups+<span class="number">1</span>;</span><br><span class="line">        base = (<span class="keyword">char</span>*) state-&gt;beginning;</span><br><span class="line">        n = state-&gt;charsize;</span><br><span class="line">        match-&gt;mark[<span class="number">0</span>] = ((<span class="keyword">char</span>*) state-&gt;start - base) / n;</span><br><span class="line">        match-&gt;mark[<span class="number">1</span>] = ((<span class="keyword">char</span>*) state-&gt;ptr - base) / n;</span><br><span class="line">        <span class="keyword">for</span> (i = j = <span class="number">0</span>; i &lt; pattern-&gt;groups; i++, j+=<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> (j+<span class="number">1</span> &lt;= state-&gt;lastmark &amp;&amp; state-&gt;mark[j] &amp;&amp; state-&gt;mark[j+<span class="number">1</span>]) &#123;</span><br><span class="line">                match-&gt;mark[j+<span class="number">2</span>] = ((<span class="keyword">char</span>*) state-&gt;mark[j] - base) / n;</span><br><span class="line">                match-&gt;mark[j+<span class="number">3</span>] = ((<span class="keyword">char</span>*) state-&gt;mark[j+<span class="number">1</span>] - base) / n;</span><br><span class="line">            &#125; <span class="keyword">else</span></span><br><span class="line">                match-&gt;mark[j+<span class="number">2</span>] = match-&gt;mark[j+<span class="number">3</span>] = <span class="number">-1</span>; <span class="comment">/* undefined */</span></span><br><span class="line">        match-&gt;pos = state-&gt;pos;</span><br><span class="line">        match-&gt;endpos = state-&gt;endpos;</span><br><span class="line">        match-&gt;lastindex = state-&gt;lastindex;</span><br><span class="line">        PyObject_GC_Track(match);</span><br><span class="line">        <span class="keyword">return</span> (PyObject*) match;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (status == <span class="number">0</span>) &#123;</span><br><span class="line">        Py_RETURN_NONE;</span><br><span class="line">    &#125;</span><br><span class="line">    pattern_error(status);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æœ€å…³é”®çš„éƒ¨åˆ†æ˜¯<code>match-&gt;mark</code>çš„å‡ æ®µä»£ç ï¼Œä¼šè®°å½•æ¯ä¸€ä¸ª<code>group</code>åœ¨å­—ç¬¦ä¸²ä¸­çš„ä½ç½®ã€‚<code>match-&gt;mark</code>çš„<code>0ã€1</code>å¯¹åº”çš„æ˜¯æ•´ä¸ªåŒ¹é…åˆ°çš„å­—ä¸²çš„èµ·æ­¢ä½ç½®ï¼Œè€Œåé¢çš„<code>2ã€3</code>è·Ÿ<code>4ã€5</code>å°±åŒ¹é…<code>state-&gt;mark</code>é‡Œé¢çš„<code>0ã€1</code>è·Ÿ<code>2ã€3</code>ä¸¤ä¸ª<code>group</code>çš„èµ·æ­¢ä½ç½®ã€‚ç”Ÿæˆå®Œ<code>MatchObject</code>ä¹‹åï¼Œ<code>Scanner</code>ä¼šæ›´æ–°èµ·å§‹æŒ‡é’ˆåˆ°åŒ¹é…å­ä¸²çš„æœ«å°¾ï¼Œä»¥ä¾¿è¿›è¡Œä¸‹ä¸€è½®çš„åŒ¹é…ã€‚</p>
<p>å½“æˆ‘ä»¬è·å–åˆ°ä¸€ä¸ª<code>MatchObject</code>çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨<code>group(i)</code>å–è·å–æ¯ä¸ªåŒ¹é…ç»„åŒ¹é…åˆ°çš„å­ä¸²ã€‚<code>group(i)</code>æœ€ç»ˆä¼šè½åˆ°<code>match_getslice_by_index</code>æ–¹æ³•ï¼Œä¼šæ ¹æ®ä¼ è¿›å»çš„<code>i</code>ï¼ŒåŒ¹é…<code>match-&gt;mark[i]</code>åˆ°<code>match-&gt;mark[i + 1]</code>çš„å­—ä¸²ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>group(0)</code>å°±æ˜¯æ•´ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä¸²<code>cde12</code>ï¼Œè€Œ<code>group(1)</code>ä»¥åŠ<code>group(2)</code>å°±å¯¹åº”ç€ä¸¤ä¸ªå°æ‹¬å·çš„åŒ¹é…ç»„ï¼Œåˆ†åˆ«æ˜¯<code>cde12</code>è·Ÿ<code>2</code>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†æ•´ä¸€ä¸ªåŒ¹é…çš„è¿‡ç¨‹ã€‚</p>
<p>æ­£åˆ™è¡¨è¾¾å¼çš„æºç å°±è§£æåˆ°è¿™é‡Œã€‚æœ¬æ–‡å¯¹<code>re</code>åº“çš„â€œæ­£åˆ™å­—ç¬¦ä¸²-&gt;åŒ¹é…æ¨¡å¼-&gt;å­—ç¬¦ä¸²åŒ¹é…â€è¿™ä¸€æµç¨‹æ¶‰åŠçš„ä»£ç åšäº†è¯¦ç»†çš„è®²è§£ï¼Œå¸Œæœ›å„ä½è¯»è€…é€šè¿‡é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œèƒ½å¤Ÿå¯¹æ­£åˆ™è¡¨è¾¾å¼æœ¬èº«çš„æ¦‚å¿µä»¥åŠpythonæ­£åˆ™è¡¨è¾¾å¼çš„å®ç°ç”±æ›´åŠ æ·±å…¥çš„ç†è§£ï¼Œä¹Ÿå¸Œæœ›ä¸€äº›å…ˆå‰å¯¹æ­£åˆ™è¡¨è¾¾å¼æœ‰æ‰€çº ç»“çš„æœ‹å‹ï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« ä¹‹åï¼Œèƒ½å¤Ÿä¸å†æ„Ÿåˆ°çº ç»“ï¼Œä»è€Œæå‡å¯¹æ­£åˆ™è¡¨è¾¾å¼çš„æŒæ§åŠ›ï¼</p>
<p>æœ€åè¯´ä¸€å¥ï¼Œç¬”è€…å†³å®šï¼ŒHard Pythonç³»åˆ—ï¼Œåˆ°æ­¤ç”»ä¸Šå¥å·ã€‚å¸Œæœ›æ¯ä¸€ä½å–œæ¬¢<code>python</code>ï¼Œå¹¶ä¸”é˜…è¯»è¿‡è¿™ä¸ªç³»åˆ—çš„æœ‹å‹ï¼Œèƒ½å¤Ÿæœ‰æ‰€æ„Ÿæ‚Ÿï¼Œæœ‰æ‰€æ”¶è·ï¼æŠ€æœ¯æ°¸ä¸æ­»ï¼Œæœ›è¯¸å›å…±å‹‰ï¼</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>re</tag>
        <tag>æ­£åˆ™è¡¨è¾¾å¼</tag>
        <tag>pattern</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬äº”ç« -å­—ç¬¦ä¸²ã€‘1ã€unicodeï¼Œpy3çš„å­—ç¬¦ä¸²å®ç°</title>
    <url>/2022/05/08/hardpython/5_str_1/</url>
    <content><![CDATA[<p><code>python</code>çš„å­—ç¬¦ä¸²å®è´¨åˆ°åº•æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œè¿™ä¸ªå¯æ˜¯å›°æ‰°ç€å¾ˆå¤šç¼–ç¨‹è€…çš„è¯é¢˜ã€‚åœ¨<code>python2</code>æˆ‘ä»¬å·²ç»è¢«ä¸­æ–‡ç¼–ç ç›¸å…³çš„é—®é¢˜æŠ˜ç£¨çš„ä¸è½»ï¼Œé‚£åˆ°äº†<code>python3</code>ä¹‹åä¸ºä»€ä¹ˆåˆè§£å†³äº†è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä»Šå¤©è¿™ç¯‡æ–‡ç« å°±å¸¦å¤§å®¶è¯¦ç»†å‰–æ<code>python3</code>çš„å­—ç¬¦ä¸²å®ç°ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€æ®µä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_str_basic</span><span class="params">()</span>:</span></span><br><span class="line">    s = <span class="string">'123456789'</span></span><br><span class="line">    print(type(s))</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ‰“å°äº†ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡çš„ç±»å‹ï¼Œå…¶ç»“æœä¸º<code>&lt;class &#39;str&#39;&gt;</code>ã€‚<code>str</code>ç±»å‹ä»å“ªé‡Œæ¥ï¼Ÿä»Cæºç ä¸­æˆ‘ä»¬å¯ä»¥æœç´¢åˆ°ï¼Œå…¶æ¥æºäº<code>unicodeobject.c</code>çš„<code>PyUnicode_Type</code></p>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// unicodeobject.c</span></span><br><span class="line">PyTypeObject PyUnicode_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"str"</span>,                        <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(PyUnicodeObject),      <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_itemsize */</span></span><br><span class="line">    <span class="comment">/* Slots */</span></span><br><span class="line">    (destructor)unicode_dealloc,  <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_vectorcall_offset */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_getattr */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_setattr */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_as_async */</span></span><br><span class="line">    unicode_repr,                 <span class="comment">/* tp_repr */</span></span><br><span class="line">    &amp;unicode_as_number,           <span class="comment">/* tp_as_number */</span></span><br><span class="line">    &amp;unicode_as_sequence,         <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    &amp;unicode_as_mapping,          <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    (hashfunc) unicode_hash,      <span class="comment">/* tp_hash*/</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_call*/</span></span><br><span class="line">    (reprfunc) unicode_str,       <span class="comment">/* tp_str */</span></span><br><span class="line">    PyObject_GenericGetAttr,      <span class="comment">/* tp_getattro */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_setattro */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_as_buffer */</span></span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_BASETYPE |</span><br><span class="line">        Py_TPFLAGS_UNICODE_SUBCLASS |</span><br><span class="line">        _Py_TPFLAGS_MATCH_SELF, <span class="comment">/* tp_flags */</span></span><br><span class="line">    unicode_doc,                  <span class="comment">/* tp_doc */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_traverse */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_clear */</span></span><br><span class="line">    PyUnicode_RichCompare,        <span class="comment">/* tp_richcompare */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_weaklistoffset */</span></span><br><span class="line">    unicode_iter,                 <span class="comment">/* tp_iter */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_iternext */</span></span><br><span class="line">    unicode_methods,              <span class="comment">/* tp_methods */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_members */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_getset */</span></span><br><span class="line">    &amp;PyBaseObject_Type,           <span class="comment">/* tp_base */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_dict */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_descr_get */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_descr_set */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_dictoffset */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_init */</span></span><br><span class="line">    <span class="number">0</span>,                            <span class="comment">/* tp_alloc */</span></span><br><span class="line">    unicode_new,                  <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_Del,                 <span class="comment">/* tp_free */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”åœ°ï¼Œå…¶å¤§å°ä¸º<code>PyUnicodeObject</code>æ‰€å çš„å¤§å°ã€‚<code>PyUnicodeObject</code>å¯è¡¨ç¤ºçš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// unicodeobject.h</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyCompactUnicodeObject _base;</span><br><span class="line">    <span class="keyword">union</span> &#123;</span><br><span class="line">        <span class="keyword">void</span> *any;</span><br><span class="line">        Py_UCS1 *latin1;</span><br><span class="line">        Py_UCS2 *ucs2;</span><br><span class="line">        Py_UCS4 *ucs4;</span><br><span class="line">    &#125; data;                     <span class="comment">/* Canonical, smallest-form Unicode buffer */</span></span><br><span class="line">&#125; PyUnicodeObject;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyASCIIObject _base;</span><br><span class="line">    Py_ssize_t utf8_length;     <span class="comment">/* Number of bytes in utf8, excluding the</span></span><br><span class="line"><span class="comment">                                 * terminating \0. */</span></span><br><span class="line">    <span class="keyword">char</span> *utf8;                 <span class="comment">/* UTF-8 representation (null-terminated) */</span></span><br><span class="line">    Py_ssize_t wstr_length;     <span class="comment">/* Number of code points in wstr, possible</span></span><br><span class="line"><span class="comment">                                 * surrogates count as two code points. */</span></span><br><span class="line">&#125; PyCompactUnicodeObject;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject_HEAD</span><br><span class="line">    Py_ssize_t length;          <span class="comment">/* Number of code points in the string */</span></span><br><span class="line">    Py_hash_t hash;             <span class="comment">/* Hash value; -1 if not set */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> interned:<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> kind:<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> compact:<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> ascii:<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> ready:<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> :<span class="number">24</span>;</span><br><span class="line">    &#125; state;</span><br><span class="line">    <span class="keyword">wchar_t</span> *wstr;              <span class="comment">/* wchar_t representation (null-terminated) */</span></span><br><span class="line">&#125; PyASCIIObject;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>PyUnicodeObject</code>ã€<code>PyCompactUnicodeObject</code>ã€<code>PyASCIIObject</code>åˆ†åˆ«å¯¹åº”ä¸‰ç§ä¸åŒçš„å­—ç¬¦ä¸²ç±»å‹ï¼Œå®ƒä»¬æœ‰ä»¥ä¸‹åŒºåˆ«ï¼š</p>
<ul>
<li><code>PyASCIIObject</code>ï¼šé€šè¿‡<code>PyUnicode_New</code>ç”Ÿæˆçš„åªåŒ…å«<code>ASCII</code>å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦æ•°æ®ä¼šç´§éšç»“æ„ä½“æ’åˆ—</li>
<li><code>PyCompactUnicodeObject</code>ï¼šé€šè¿‡<code>PyUnicode_New</code>ç”Ÿæˆçš„åŒ…å«é<code>ASCII</code>å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå­—ç¬¦æ•°æ®ä¼šç´§éšç»“æ„ä½“æ’åˆ—</li>
<li><code>PyUnicodeObject</code>ï¼šé€šè¿‡<code>PyUnicode_FromUnicode</code>åˆ›å»º</li>
</ul>
<p>å…¶ä¸­<code>PyUnicode_FromUnicode</code>æ˜¯å·²ç»è¿‡æ—¶çš„æ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬å¸¸è§çš„<code>unicode</code>å¯¹è±¡æ˜¯ä»¥<code>PyASCIIObject</code>ã€<code>PyCompactUnicodeObject</code>çš„å½¢å¼å­˜åœ¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç°åœ¨æˆ‘ä»¬æ—¥å¸¸åˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå…¶æ•°æ®ä¼šç´§éšç»“æ„ä½“æ’åˆ—ã€‚</p>
<p><code>python</code>çš„<code>unicode</code>å®ç°æ˜¯å¯¹æ ‡æ ‡å‡†<code>unicode</code>è§„èŒƒçš„ï¼Œå› æ­¤è¦æ·±å…¥äº†è§£å…¶ä¸­åŸç†ï¼Œæˆ‘ä»¬éœ€è¦é¢„å¤‡ä¸€äº›å…³äº<code>unicode</code>çš„çŸ¥è¯†ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cDovL3d3dy51bmlmb3VuZHJ5LmNvbS91bmljb2RlLXR1dG9yaWFsLmh0bWw=" title="http://www.unifoundry.com/unicode-tutorial.html">unicode tutorial<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLWhhbnMvVW5pY29kZQ==" title="https://zh.wikipedia.org/zh-hans/Unicode">unicode wiki<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vY3JhenlscXkvcC8xMDE4NDI5MS5odG1s" title="https://www.cnblogs.com/crazylqy/p/10184291.html">å½»åº•å¼„æ‡‚unicodeç¼–ç <i class="fa fa-external-link"></i></span></li>
</ul>
<p><code>unicode</code>æœ¬èº«å­˜åœ¨çš„æ„ä¹‰æ˜¯å°†ä¸–ç•Œä¸Šä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼ˆåŒ…æ‹¬<code>emoji</code>ï¼‰æ˜ å°„åˆ°ä¸€ä¸ªç‰¹å®šçš„æ•°å­—ï¼Œè¿™ä¸ªæ•°å­—è¢«ç§°ä¸º<code>code point</code>ã€‚<code>unicode</code>çš„<code>code point</code>æ˜¯åˆ†ç»„çš„ï¼Œæ¯ç»„<code>65536</code>ä¸ªï¼Œç§°ä½œä¸ºä¸€ä¸ªä¸ª<code>plane</code>ã€‚æ¯ä¸ª<code>unicode</code>å­—ç¬¦ç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œä½†å¦‚æœéœ€è¦è¿›è¡ŒäºŒè¿›åˆ¶ç¼–ç çš„è¯ï¼Œæ¯”å¦‚å­˜å‚¨æ–‡ä»¶æˆ–æ˜¯ç½‘ç»œä¼ è¾“ï¼Œæ¯ä¸ªå­—ç¬¦éƒ½ä½¿ç”¨4ä¸ªå­—èŠ‚å¾€å¾€ä¼šæœ‰å†—ä½™ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ¯”è¾ƒæ•ˆç‡çš„äºŒè¿›åˆ¶ç¼–ç æ–¹å¼ï¼Œæ¯”å¦‚ï¼š<code>utf8</code>ã€<code>utf16</code>ã€‚</p>
<p><code>utf8</code>ç¼–ç æ˜¯æœ€å¸¸è§çš„ç¼–ç ä¹‹ä¸€ï¼Œå…¶é•¿åº¦å¯å˜ï¼Œä½†é’ˆå¯¹ä¸åŒ<code>unicode</code>çš„<code>code point</code>å€¼ï¼Œä¼šç¼–ç æˆä¸åŒé•¿åº¦çš„å½¢å¼ï¼Œæ¯”å¦‚<code>ASCII</code>æ”¯æŒçš„è‹±æ–‡åœ¨<code>utf8</code>ç¼–ç é‡Œåªå 1ä¸ªå­—èŠ‚ï¼Œä½†æ±‰å­—å¯èƒ½å°±æ˜¯3ä¸ªå­—èŠ‚ã€‚åœ¨pythonä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦æŠŠå­—ç¬¦ä¸²ç¼–ç æˆ<code>utf8</code>çš„äºŒè¿›åˆ¶å½¢å¼æ—¶ï¼Œå°±éœ€è¦<code>string.encode(&#39;utf-8&#39;)</code>çš„è°ƒç”¨ï¼Œåä¹‹å‡è®¾æˆ‘ä»¬ä»ä¸€ä¸ª<code>socket</code>æ¥æ”¶åˆ°<code>utf8</code>ç¼–ç çš„æ•°æ®ï¼Œéœ€è¦è§£ç æˆå­—ç¬¦ä¸²æ—¶ï¼Œå°±éœ€è¦<code>bytestring.decode(&#39;utf-8&#39;)</code>å¯¹å­—ç¬¦ä¸²è¿›è¡Œè§£ç ã€‚</p>
<p>è¨€å½’æ­£ä¼ ï¼Œç°åœ¨æˆ‘ä»¬å›åˆ°å¯¹<code>PyASCIIObject</code>ã€<code>PyCompactUnicodeObject</code>æ•°æ®ç»“æ„çš„ç ”ç©¶å½“ä¸­ã€‚é¦–å…ˆæˆ‘ä»¬çœ‹<code>PyASCIIObject</code>ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li><code>length</code>ï¼šå­—ç¬¦ä¸²çš„é•¿åº¦ï¼ŒæŒ‰<code>code point</code>ä¸ªæ•°è®¡ç®—</li>
<li><code>hash</code>ï¼šå­—ç¬¦ä¸²çš„hashç¼–ç </li>
<li><code>state</code>ï¼šå­—ç¬¦ä¸²çŠ¶æ€ï¼Œç”¨ä¸€ä¸ªå®Œæ•´4å­—èŠ‚å­˜å‚¨<ul>
<li><code>interned</code>ï¼ˆ2ï¼‰ï¼šæ˜¯å¦è¢«çŸ­å­—ç¬¦ä¸²ç¼“å­˜ï¼Œä»¥åŠæ˜¯å¦æ°¸ä¹…ç¼“å­˜</li>
<li><code>kind</code>ï¼ˆ3ï¼‰ï¼šå­—ç¬¦ä¸²çš„ç±»å‹<ul>
<li>0ï¼š<code>wide-char</code>å®½å­—ç¬¦ç±»å‹</li>
<li>1ï¼š<code>1byte</code>ï¼Œå…¨éƒ¨å­—ç¬¦éƒ½å¯ç”¨<code>8bits</code>æ— ç¬¦å·è¡¨ç¤º</li>
<li>2ï¼š<code>2byte</code>ï¼Œå…¨éƒ¨å­—ç¬¦éƒ½å¯ç”¨<code>16bits</code>æ— ç¬¦å·è¡¨ç¤º</li>
<li>4ï¼š<code>4byte</code>ï¼Œå…¨éƒ¨å­—ç¬¦éƒ½å¯ç”¨<code>32bits</code>æ— ç¬¦å·è¡¨ç¤º</li>
</ul>
</li>
<li><code>compact</code>ï¼ˆ1ï¼‰ï¼šå­—ç¬¦ä¸²æ•°æ®æ˜¯å¦ç´§å‡‘äºç»“æ„ä½“æ’åˆ—<ul>
<li>å…ˆå‰æåˆ°<code>PyASCIIObject</code>ã€<code>PyCompactUnicodeObject</code>éƒ½æ˜¯ç´§å‡‘æ’åˆ—</li>
</ul>
</li>
<li><code>ascii</code>ï¼ˆ1ï¼‰ï¼šæ˜¯å¦åªæœ‰<code>ascii</code>å­—ç¬¦<ul>
<li>å…ˆå‰<code>kind=1</code>çš„æ—¶å€™ç”±äºæ˜¯<code>unsigned</code>ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤ºé™¤<code>ascii</code>å¤–åˆ°200å¤šçš„å­—ç¬¦</li>
</ul>
</li>
<li><code>ready</code>ï¼ˆ1ï¼‰ï¼šæ˜¯å¦æ•°æ®å·²å‡†å¤‡å®Œæˆ<ul>
<li>ç´§å‡‘æ’åˆ—æ•°æ®ï¼Œæˆ–è€…éç´§å‡‘æ’åˆ—ä½†æ•°æ®æŒ‡é’ˆå·²ç»å¡«å¥½å­—ç¬¦ä¸²æ•°æ®ï¼Œéƒ½ç®—<code>read</code>y</li>
</ul>
</li>
<li>24ä½<code>padding</code></li>
</ul>
</li>
<li><code>wstr</code>ï¼š<code>wide-char</code>çš„å­—ç¬¦ä¸²è¡¨ç¤º</li>
</ul>
<p><code>PyASCIIObject</code>ç”¨æ¥è¡¨ç¤º<code>ASCII</code>å­—ç¬¦ï¼Œè€Œå«æœ‰é<code>ASCII</code>å­—ç¬¦çš„å­—ç¬¦ä¸²åˆ™ç”¨<code>PyCompactUnicodeObject</code>è¡¨ç¤ºï¼Œå…¶åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><code>_base</code>ï¼š<code>PyASCIIObject</code>çš„å®ä¾‹</li>
<li><code>utf8_length</code>ï¼šé™¤äº†<code>\0</code>ä¹‹å¤–ï¼Œ<code>utf8</code>çš„å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ¯”ç‰¹æ•°</li>
<li><code>utf8</code>ï¼š<code>utf8</code>çš„å­—ç¬¦ä¸²è¡¨ç¤º</li>
<li><code>wstr_length</code>ï¼šwide-charå­—ç¬¦ä¸²è¡¨ç¤ºé‡Œ<code>code point</code>çš„ä¸ªæ•°</li>
</ul>
<p>è€Œå­—ç¬¦ä¸²çš„çœŸå®æ•°æ®åˆ™æ”¾åˆ°äº†<code>PyUnicodeObject</code>çš„<code>data</code>å½“ä¸­ï¼Œä»¥ä¸€ä¸ª<code>union</code>çš„å½¢å¼è¡¨ç¤ºä¸åŒé•¿åº¦è¡¨ç¤ºçš„å­—ç¬¦ä¸²</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥å±•ç¤º<code>unicode</code>å­—ç¬¦ä¸²æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ã€‚æˆ‘ä»¬çš„ä»£ç æ˜¯å­—æ¯+æ±‰å­—+æ•°å­—ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">s = <span class="string">"abcå“ˆå’¯123"</span></span><br></pre></td></tr></table></figure>
<p>å½“è¿™æ®µä»£ç è¢«æ‰“å…¥åˆ°è§£é‡Šå™¨ä¸­ï¼Œè¢«è¯æ³•åˆ†æå™¨åˆ†ææ—¶ï¼Œå°±ä¼šè°ƒç”¨å­—ç¬¦ä¸²åˆ›å»ºçš„é€»è¾‘<code>unicode_decode_utf8</code>ï¼Œå°†<code>const char</code>ç±»å‹çš„åŸç”Ÿå­—ç¬¦è½¬åŒ–ä¸º<code>PyUnicodeObject</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// unicodeobject.c</span></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">unicode_decode_utf8(<span class="keyword">const</span> <span class="keyword">char</span> *s, Py_ssize_t size,</span><br><span class="line">                    _Py_error_handler error_handler, <span class="keyword">const</span> <span class="keyword">char</span> *errors,</span><br><span class="line">                    Py_ssize_t *consumed)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (consumed)</span><br><span class="line">            *consumed = <span class="number">0</span>;</span><br><span class="line">        _Py_RETURN_UNICODE_EMPTY();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ASCII is equivalent to the first 128 ordinals in Unicode. */</span></span><br><span class="line">    <span class="keyword">if</span> (size == <span class="number">1</span> &amp;&amp; (<span class="keyword">unsigned</span> <span class="keyword">char</span>)s[<span class="number">0</span>] &lt; <span class="number">128</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (consumed) &#123;</span><br><span class="line">            *consumed = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> get_latin1_char((<span class="keyword">unsigned</span> <span class="keyword">char</span>)s[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *starts = s;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *end = s + size;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fast path: try ASCII string.</span></span><br><span class="line">    PyObject *u = PyUnicode_New(size, <span class="number">127</span>);</span><br><span class="line">    <span class="keyword">if</span> (u == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    s += ascii_decode(s, end, PyUnicode_1BYTE_DATA(u));</span><br><span class="line">    <span class="keyword">if</span> (s == end) &#123;</span><br><span class="line">        <span class="keyword">return</span> u;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use _PyUnicodeWriter after fast path is failed.</span></span><br><span class="line">    _PyUnicodeWriter writer;</span><br><span class="line">    _PyUnicodeWriter_InitWithBuffer(&amp;writer, u);</span><br><span class="line">    writer.pos = s - starts;</span><br><span class="line"></span><br><span class="line">    Py_ssize_t startinpos, endinpos;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *errmsg = <span class="string">""</span>;</span><br><span class="line">    PyObject *error_handler_obj = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *exc = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (s &lt; end) &#123;</span><br><span class="line">        Py_UCS4 ch;</span><br><span class="line">        <span class="keyword">int</span> kind = writer.kind;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (kind == PyUnicode_1BYTE_KIND) &#123;</span><br><span class="line">            <span class="keyword">if</span> (PyUnicode_IS_ASCII(writer.buffer))</span><br><span class="line">                ch = asciilib_utf8_decode(&amp;s, end, writer.data, &amp;writer.pos);</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                ch = ucs1lib_utf8_decode(&amp;s, end, writer.data, &amp;writer.pos);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (kind == PyUnicode_2BYTE_KIND) &#123;</span><br><span class="line">            ch = ucs2lib_utf8_decode(&amp;s, end, writer.data, &amp;writer.pos);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            assert(kind == PyUnicode_4BYTE_KIND);</span><br><span class="line">            ch = ucs4lib_utf8_decode(&amp;s, end, writer.data, &amp;writer.pos);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (ch) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> (s == end || consumed)</span><br><span class="line">                <span class="keyword">goto</span> End;</span><br><span class="line">            errmsg = <span class="string">"unexpected end of data"</span>;</span><br><span class="line">            startinpos = s - starts;</span><br><span class="line">            endinpos = end - starts;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            errmsg = <span class="string">"invalid start byte"</span>;</span><br><span class="line">            startinpos = s - starts;</span><br><span class="line">            endinpos = startinpos + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">if</span> (consumed &amp;&amp; (<span class="keyword">unsigned</span> <span class="keyword">char</span>)s[<span class="number">0</span>] == <span class="number">0xED</span> &amp;&amp; end - s == <span class="number">2</span></span><br><span class="line">                &amp;&amp; (<span class="keyword">unsigned</span> <span class="keyword">char</span>)s[<span class="number">1</span>] &gt;= <span class="number">0xA0</span> &amp;&amp; (<span class="keyword">unsigned</span> <span class="keyword">char</span>)s[<span class="number">1</span>] &lt;= <span class="number">0xBF</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">/* Truncated surrogate code in range D800-DFFF */</span></span><br><span class="line">                <span class="keyword">goto</span> End;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/* fall through */</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            errmsg = <span class="string">"invalid continuation byte"</span>;</span><br><span class="line">            startinpos = s - starts;</span><br><span class="line">            endinpos = startinpos + ch - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">if</span> (_PyUnicodeWriter_WriteCharInline(&amp;writer, ch) &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">goto</span> onError;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// case 1ã€3ã€4çš„é€»è¾‘ï¼Œä¼šè·å–ä¸åŒç±»å‹çš„error_handlerï¼Œè¿™é‡Œå…ˆå¿½ç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">End:</span><br><span class="line">    <span class="keyword">if</span> (consumed)</span><br><span class="line">        *consumed = s - starts;</span><br><span class="line"></span><br><span class="line">    Py_XDECREF(error_handler_obj);</span><br><span class="line">    Py_XDECREF(exc);</span><br><span class="line">    <span class="keyword">return</span> _PyUnicodeWriter_Finish(&amp;writer);</span><br><span class="line"></span><br><span class="line">onError:</span><br><span class="line">    Py_XDECREF(error_handler_obj);</span><br><span class="line">    Py_XDECREF(exc);</span><br><span class="line">    _PyUnicodeWriter_Dealloc(&amp;writer);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>unicode_decode_utf8</code>åšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>å½“<code>size</code>ä¸º1å¹¶ä¸”ç¬¬ä¸€ä¸ªå­—ç¬¦å€¼å°äº128æ—¶ï¼Œé€šè¿‡<code>get_latin1_char</code>æ–¹æ³•è·å–<code>unicode</code>å®ä¾‹</li>
<li>é‡‡ç”¨<code>PyUnicode_New</code>åˆå§‹åŒ–<code>unicode</code>å®ä¾‹å¹¶é¢„è®¾æœ€å¤§å­—ç¬¦å€¼ä¸º127ï¼Œç„¶åå…ˆå°è¯•ç”¨<code>ascii_decode</code>å°†åŸç”Ÿå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª<code>ascii</code>çš„<code>unicode</code>å®ä¾‹<ul>
<li>å¦‚æœæˆåŠŸå°±<code>return</code>äº†</li>
<li>å¦‚æœæ²¡æˆåŠŸï¼Œ<code>s</code>ä¼šåœåœ¨ç¬¬ä¸€ä¸ªé<code>ascii</code>å­—ç¬¦çš„å‰é¢<ul>
<li>åœ¨ä¸Šé¢çš„ä¾‹å­é‡Œï¼Œ<code>s</code>ä¹Ÿå°±è¡¨ç¤º<code>&quot;å“ˆå’¯123&quot;</code></li>
</ul>
</li>
</ul>
</li>
<li>ä»¥å…ˆå‰çš„<code>unicode</code>å®ä¾‹ä¸º<code>buffer</code>ï¼Œåˆå§‹åŒ–<code>PyUnicodeWriter</code>å®ä¾‹å¤„ç†é<code>ASCII</code>å­—ç¬¦ä¸²ï¼Œå¾ªç¯å¤„ç†å‰©ä½™çš„å­—ç¬¦ï¼Œå†™å…¥åˆ°<code>buffer</code><ul>
<li><code>PyUnicodeWriter</code>å®ä¾‹é»˜è®¤çš„<code>kind</code>ä¸º<code>PyUnicode_1BYTE_KIND</code>ã€‚ä¸€èˆ¬ç¬¬ä¸€ä¸ªå­—ç¬¦ä¼šèµ°åˆ°<code>asciilib_utf8_decode</code>é€»è¾‘ï¼Œè¿™ä¸ªé€»è¾‘å¦‚æœå‘ç°å­—ç¬¦è¶Šç•Œï¼Œä¼šè¿”å›å­—ç¬¦å®é™…çš„<code>code point</code>å€¼</li>
</ul>
</li>
<li>å‘ç°ç¬¬ä¸€ä¸ªå­—ç¬¦è¶Šç•Œä¸èƒ½ç”¨<code>ASCII</code>è¡¨ç¤ºï¼Œè°ƒç”¨<code>_PyUnicodeWriter_WriteCharInline</code>é€»è¾‘å†™å…¥å­—ç¬¦<ul>
<li>è°ƒç”¨<code>_PyUnicodeWriter_Prepare</code>é€»è¾‘ï¼Œå…¶ä¸­ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªå­—ç¬¦çš„å€¼å¤§å°å†³å®š<code>writer</code>å†™å…¥çš„å­—ç¬¦ç±»å‹<code>kind</code><ul>
<li>æ±‰å­—<code>&quot;å“ˆ&quot;</code>å¯¹åº”<code>code point</code>å€¼ä¸º<code>27014</code>ï¼Œå³<code>\u54c8</code>ã€‚å› æ­¤<code>writer</code>å°†<code>kind</code>è°ƒæ•´åˆ°<code>PyUnicode_2BYTE_KIND</code>ï¼Œä»¥é€‚é…æ±‰å­—<code>&quot;å“ˆ&quot;</code>çš„å†™å…¥</li>
</ul>
</li>
<li>è°ƒç”¨<code>PyUnicode_WRITE</code>ï¼Œå†™å…¥å­—ç¬¦<code>&quot;å“ˆ&quot;</code>åˆ°<code>buffer</code></li>
</ul>
</li>
<li><code>writer.kind</code>ä¸º<code>PyUnicode_2BYTE_KIND</code>ï¼Œä¸‹ä¸€ä¸ªå¾ªç¯ä¹‹åï¼Œè°ƒç”¨<code>ucs2lib_utf8_decode</code>æ–¹æ³•<ul>
<li>ç”±äºæ±‰å­—åŸºæœ¬æ˜¯<code>PyUnicode_2BYTE_KIND</code>ï¼Œé€šè¿‡<code>ucs2lib_utf8_decode</code>æ–¹æ³•ï¼Œå°±èƒ½æŠŠåé¢æ‰€æœ‰çš„å­—ç¬¦éƒ½è¿›è¡Œå¤„ç†</li>
</ul>
</li>
<li>è°ƒç”¨<code>_PyUnicodeWriter_Finish</code>ï¼Œç”Ÿæˆæœ€ç»ˆçš„<code>unicode</code>å®ä¾‹<ul>
<li>è°ƒç”¨<code>resize_compact</code>ï¼Œé‡æ–°è°ƒæ•´<code>unicode</code>å®ä¾‹æ•°æ®</li>
</ul>
</li>
</ul>
<p>é€šè¿‡ä»¥ä¸Šçš„æ“ä½œï¼Œä¸€ä¸ª<code>unicode</code>å­—ç¬¦ä¸²å®ä¾‹å°±ç”Ÿæˆäº†ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å­—ç¬¦ä¸²</tag>
        <tag>str</tag>
        <tag>unicode</tag>
        <tag>utf8</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬å››ç« -æ—¥å¿—ã€‘2ã€æ—¥å¿—æ¶ˆè´¹è€…Handlerçš„å®ç°</title>
    <url>/2022/04/16/hardpython/4_log_2/</url>
    <content><![CDATA[<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDQvMDkvaGFyZHB5dGhvbi80X2xvZ18xLw==" title="https://utmhikari.top/2022/04/09/hardpython/4_log_1/">ä¸Šç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>é‡Œè¯´å®Œäº†æ—¥å¿—å®ä¾‹<code>Logger</code>å’Œæ—¥å¿—ç®¡ç†<code>Manager</code>ï¼Œç°åœ¨è¯¥æåˆ°<code>Handler</code>äº†ã€‚<code>Handler</code>æ˜¯æ—¥å¿—ä¿¡æ¯çš„æ¶ˆè´¹è€…ï¼Œå•ä¸ª<code>Logger</code>å®ä¾‹æ³¨å†Œå¤šä¸ª<code>Handler</code>ï¼Œæ¯ç”Ÿæˆä¸€ä¸ª<code>LogRecord</code>ï¼Œå°±ä¼šè¢«åˆæ³•çš„<code>Handler</code>æ¶ˆè´¹ï¼Œåœ¨ä¸åŒåœ°æ–¹æ‰“å°å‡ºæ—¥å¿—ä¿¡æ¯ã€‚</p>
<p>è¦ç ”ç©¶<code>Handler</code>ï¼Œé¦–å…ˆéœ€è¦çœ‹ä¸‹åŸºç±»çš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span><span class="params">(Filterer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        rv = self.filter(record)</span><br><span class="line">        <span class="keyword">if</span> rv:</span><br><span class="line">            self.acquire()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.emit(record)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                self.release()</span><br><span class="line">        <span class="keyword">return</span> rv</span><br></pre></td></tr></table></figure>
<p><code>Handler</code>ä¼šé€šè¿‡è‡ªå¸¦çš„é‡å…¥é”é™åˆ¶æ—¥å¿—è®°å½•è¢«ä¸²è¡Œå¤„ç†ã€‚<code>Handler</code>ä¹Ÿæ˜¯ç»§æ‰¿<code>Filterer</code>ï¼Œé¦–å…ˆä¼šé€šè¿‡<code>filter</code>è¿‡æ»¤æ—¥å¿—æ˜¯å¦æ»¡è¶³<code>Handler</code>çš„è¦æ±‚ï¼Œå¦‚æœåˆæ³•ï¼Œç„¶åè°ƒç”¨<code>emit</code>æ–¹æ³•å¤„ç†æ—¥å¿—ã€‚</p>
<p><code>emit</code>æ–¹æ³•åœ¨åŸºç±»æ˜¯<code>NotImplemented</code>ï¼Œéœ€è¦å­ç±»åŠ ä»¥å®ç°ã€‚å› æ­¤æ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“æŠ½å‡ ä¸ªä¾‹å­æ¥çœ‹ã€‚</p>
<a id="more"></a>
<h2 id="StreamHandler"><a href="#StreamHandler" class="headerlink" title="StreamHandler"></a>StreamHandler</h2><p><code>StreamHandler</code>æ‰“å°æ—¥å¿—çš„å®ç°æ¯”è¾ƒç®€å•ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamHandler</span><span class="params">(Handler)</span>:</span></span><br><span class="line">    terminator = <span class="string">'\n'</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">emit</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            msg = self.format(record)</span><br><span class="line">            stream = self.stream</span><br><span class="line">            <span class="comment"># issue 35046: merged two stream.writes into one.</span></span><br><span class="line">            stream.write(msg + self.terminator)</span><br><span class="line">            self.flush()</span><br><span class="line">        <span class="keyword">except</span> RecursionError:  <span class="comment"># See issue 36272</span></span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            self.handleError(record)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">flush</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.acquire()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self.stream <span class="keyword">and</span> hasattr(self.stream, <span class="string">"flush"</span>):</span><br><span class="line">                self.stream.flush()</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.release()</span><br></pre></td></tr></table></figure>
<p><code>StreamHandler</code>é»˜è®¤çš„<code>stream</code>æ˜¯<code>sys.stderr</code>ã€‚åªè¦æˆ‘ä»¬åœ¨<code>basicConfig</code>ä¸­ç»™åˆ°çš„<code>stream</code>å®ä¾‹å®ç°äº†<code>write</code>è·Ÿ<code>flush</code>æ–¹æ³•ï¼Œå°±å¯ä»¥è¢«æ”¾åˆ°<code>StreamHandler</code>é‡Œå¤´å¤„ç†æ—¥å¿—ã€‚æ—¥å¿—é¦–å…ˆé€šè¿‡<code>format</code>æ–¹æ³•è¢«<code>Handler</code>å®ä¾‹çš„<code>formatter</code>æ ¼å¼åŒ–ï¼Œç„¶åå†è¢«è¾“å‡ºã€‚</p>
<p>ä»¥<code>sys.stderr</code>ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹æ ‡å‡†é”™è¯¯æµåœ¨<code>python</code>ä¸­çš„æºç å®ç°ã€‚é¦–å…ˆéœ€è¦è¿½æº¯<code>sys.stderr</code>çš„æ¥æºï¼Œæˆ‘ä»¬èŠ‚é€‰ä¸€éƒ¨åˆ†ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// pylifecycle.c</span></span><br><span class="line"><span class="keyword">static</span> PyStatus</span><br><span class="line">init_sys_streams(PyThreadState *tstate)</span><br><span class="line">&#123;</span><br><span class="line">    fd = fileno(<span class="built_in">stderr</span>);</span><br><span class="line">    <span class="built_in">std</span> = create_stdio(config, iomod, fd, <span class="number">1</span>, <span class="string">"&lt;stderr&gt;"</span>,</span><br><span class="line">                       config-&gt;stdio_encoding,</span><br><span class="line">                       <span class="string">L"backslashreplace"</span>);</span><br><span class="line">    <span class="keyword">if</span> (PySys_SetObject(<span class="string">"__stderr__"</span>, <span class="built_in">std</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        Py_DECREF(<span class="built_in">std</span>);</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_PySys_SetObjectId(&amp;PyId_stderr, <span class="built_in">std</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        Py_DECREF(<span class="built_in">std</span>);</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    Py_DECREF(<span class="built_in">std</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject*</span><br><span class="line">create_stdio(<span class="keyword">const</span> PyConfig *config, PyObject* io,</span><br><span class="line">    <span class="keyword">int</span> fd, <span class="keyword">int</span> write_mode, <span class="keyword">const</span> <span class="keyword">char</span>* name,</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">wchar_t</span>* encoding, <span class="keyword">const</span> <span class="keyword">wchar_t</span>* errors)</span><br><span class="line">&#123;</span><br><span class="line">    buf = _PyObject_CallMethodId(io, &amp;PyId_open, <span class="string">"isiOOOO"</span>,</span><br><span class="line">                                 fd, mode, buffering,</span><br><span class="line">                                 Py_None, Py_None, <span class="comment">/* encoding, errors */</span></span><br><span class="line">                                 Py_None, Py_False); <span class="comment">/* newline, closefd */</span></span><br><span class="line">    stream = _PyObject_CallMethodId(io, &amp;PyId_TextIOWrapper, <span class="string">"OOOsOO"</span>,</span><br><span class="line">                                    buf, encoding_str, errors_str,</span><br><span class="line">                                    newline, line_buffering, write_through);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>pylifecycle.c</code>ä¸­ï¼Œ<code>sys.stderr</code>è¢«è®¾ç½®ï¼Œæœ€ç»ˆè°ƒç”¨äº†<code>create_stdio</code>è®¾ç½®äº†<code>stream</code>å®ä¾‹ã€‚å…¶ä¸­ï¼Œä¼šè°ƒç”¨<code>io</code>æ¨¡å—çš„<code>open</code>ä»¥åŠ<code>TextIOWrapper</code>æ–¹æ³•ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _iomodule.c</span></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">_io_open_impl(PyObject *<span class="keyword">module</span>, PyObject *file, <span class="keyword">const</span> <span class="keyword">char</span> *mode,</span><br><span class="line">              <span class="keyword">int</span> buffering, <span class="keyword">const</span> <span class="keyword">char</span> *encoding, <span class="keyword">const</span> <span class="keyword">char</span> *errors,</span><br><span class="line">              <span class="keyword">const</span> <span class="keyword">char</span> *newline, <span class="keyword">int</span> closefd, PyObject *opener)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Create the Raw file stream */</span></span><br><span class="line">    &#123;</span><br><span class="line">        PyObject *RawIO_class = (PyObject *)&amp;PyFileIO_Type;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> MS_WINDOWS</span></span><br><span class="line">        <span class="keyword">const</span> PyConfig *config = _Py_GetConfig();</span><br><span class="line">        <span class="keyword">if</span> (!config-&gt;legacy_windows_stdio &amp;&amp; _PyIO_get_console_type(path_or_fd) != <span class="string">'\0'</span>) &#123;</span><br><span class="line">            RawIO_class = (PyObject *)&amp;PyWindowsConsoleIO_Type;</span><br><span class="line">            encoding = <span class="string">"utf-8"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">        raw = PyObject_CallFunction(RawIO_class, <span class="string">"OsOO"</span>,</span><br><span class="line">                                    path_or_fd, rawmode,</span><br><span class="line">                                    closefd ? Py_True : Py_False,</span><br><span class="line">                                    opener);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* wraps into a buffered file */</span></span><br><span class="line">    &#123;</span><br><span class="line">        PyObject *Buffered_class;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (updating)</span><br><span class="line">            Buffered_class = (PyObject *)&amp;PyBufferedRandom_Type;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (creating || writing || appending)</span><br><span class="line">            Buffered_class = (PyObject *)&amp;PyBufferedWriter_Type;  <span class="comment">// hits here</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (reading)</span><br><span class="line">            Buffered_class = (PyObject *)&amp;PyBufferedReader_Type;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            PyErr_Format(PyExc_ValueError,</span><br><span class="line">                         <span class="string">"unknown mode: '%s'"</span>, mode);</span><br><span class="line">            <span class="keyword">goto</span> error;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        buffer = PyObject_CallFunction(Buffered_class, <span class="string">"Oi"</span>, raw, buffering);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (buffer == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    result = buffer;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* if binary, returns the buffered file */</span></span><br><span class="line">    <span class="keyword">if</span> (binary) &#123;</span><br><span class="line">        Py_DECREF(modeobj);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æ€»çš„æ¥çœ‹ï¼Œåœ¨<code>windows</code>ä¸­ï¼Œ<code>stderr</code>å®ä¾‹çš„åˆ›å»ºæµç¨‹å¤§è‡´æ˜¯è¿™æ ·ï¼š</p>
<ul>
<li>åˆ›å»ºäº†ä¸€ä¸ª<code>PyWindowsConsoleIO_Type</code>çš„å®ä¾‹<ul>
<li><code>PyWindowsConsoleIO_Type</code>å®è´¨æ˜¯å°è£…äº†å’Œ<code>windows</code>å‘½ä»¤è¡Œç»ˆç«¯äº¤äº’çš„æ–¹æ³•</li>
</ul>
</li>
<li>åˆ›å»ºäº†ä¸€ä¸ª<code>PyBufferedWriter_Type</code>å®ä¾‹å»å®ç°ç¼“å†²è¾“å‡ºæµ<ul>
<li>è¯¥å®ä¾‹çš„<code>raw</code>å±æ€§å³ä¸º<code>PyWindowsConsoleIO_Type</code>çš„å®ä¾‹</li>
</ul>
</li>
<li>åˆ›å»ºäº†ä¸€ä¸ª<code>TextIOWrapper</code>å®ä¾‹å°è£…<code>PyBufferedWriter_Type</code>å®ä¾‹ï¼Œå¾—åˆ°<code>stderr</code>çš„<code>stream</code>å®ä¾‹</li>
</ul>
<p>å½“è°ƒç”¨<code>stderr.write</code>å’Œ<code>stderr.flush</code>æ—¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨<code>BufferedWriter</code>çš„<code>write</code>å’Œ<code>flush</code>ã€‚åœ¨<code>write</code>è¿‡ç¨‹ä¸­ä¼šå°†æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œè€Œåœ¨<code>write</code>è·Ÿ<code>flush</code>è¿‡ç¨‹ä¸­éƒ½ä¼šè°ƒç”¨<code>raw.write</code>æ–¹æ³•å°è¯•å°†ç¼“å†²åŒºæ•°æ®åˆ·æ‰ï¼Œå¹¶å†™å…¥<code>windows</code>å‘½ä»¤è¡Œã€‚æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥æ·±å…¥ç ”ç©¶<code>bufferedio.c</code>é‡Œé¢çš„å†…å®¹ã€‚</p>
<h2 id="FileHandler"><a href="#FileHandler" class="headerlink" title="FileHandler"></a>FileHandler</h2><p><code>FileHandler</code>ç»§æ‰¿äº†<code>StreamHandler</code>ï¼Œå¯ä»¥å°†æ—¥å¿—è®°å½•æ‰“å°åˆ°æ–‡ä»¶é‡Œé¢ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span><span class="params">(StreamHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename, mode=<span class="string">'a'</span>, encoding=None, delay=False, errors=None)</span>:</span></span><br><span class="line">        filename = os.fspath(filename)</span><br><span class="line">        self.baseFilename = os.path.abspath(filename)</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.encoding = encoding</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"b"</span> <span class="keyword">not</span> <span class="keyword">in</span> mode:</span><br><span class="line">            self.encoding = io.text_encoding(encoding)</span><br><span class="line">        self.errors = errors</span><br><span class="line">        self.delay = delay</span><br><span class="line">        self._builtin_open = open</span><br><span class="line">        <span class="keyword">if</span> delay:</span><br><span class="line">            Handler.__init__(self)</span><br><span class="line">            self.stream = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            StreamHandler.__init__(self, self._open())</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_open</span><span class="params">(self)</span>:</span></span><br><span class="line">        open_func = self._builtin_open</span><br><span class="line">        <span class="keyword">return</span> open_func(self.baseFilename, self.mode,</span><br><span class="line">                         encoding=self.encoding, errors=self.errors)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">emit</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.stream <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self.stream = self._open()</span><br><span class="line">        StreamHandler.emit(self, record)</span><br></pre></td></tr></table></figure>
<p><code>FileHandler</code>ä¸º<code>StreamHandler</code>åº•å±‚æä¾›äº†ä¸€ä¸ªå†…ç½®<code>open</code>æ–¹æ³•æ–‡ä»¶æµã€‚æˆ‘ä»¬çŸ¥é“è¿™æ ·çš„æ–‡ä»¶æµä¹Ÿä¼šæœ‰<code>write</code>ä»¥åŠ<code>flush</code>æ–¹æ³•ï¼Œæ‰€ä»¥æ˜¾è€Œæ˜“è§æ—¥å¿—ä¼šè¾“å‡ºåˆ°å¯¹åº”çš„æ–‡ä»¶å½“ä¸­ã€‚</p>
<h2 id="TimedRotatingFileHandler"><a href="#TimedRotatingFileHandler" class="headerlink" title="TimedRotatingFileHandler"></a>TimedRotatingFileHandler</h2><p><code>TimedRotatingFileHandler</code>ä¹Ÿæ˜¯å¸¸ç”¨çš„æ—¥å¿—<code>Handler</code>ä¹‹ä¸€ï¼Œå®ƒå¯ä»¥å®ç°æŒ‰è§„å®šçš„æ—¶é—´é—´éš”æ‰“å°å„ä¸ªæ—¶æ®µçš„æ—¥å¿—åˆ°ä¸åŒæ–‡ä»¶ä¸­ã€‚å…¶ç»§æ‰¿é“¾å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># pprint.pprint(TimedRotatingFileHandler.__mro__)</span><br><span class="line">(&lt;class &apos;logging.handlers.TimedRotatingFileHandler&apos;&gt;,</span><br><span class="line"> &lt;class &apos;logging.handlers.BaseRotatingHandler&apos;&gt;,</span><br><span class="line"> &lt;class &apos;logging.FileHandler&apos;&gt;,</span><br><span class="line"> &lt;class &apos;logging.StreamHandler&apos;&gt;,</span><br><span class="line"> &lt;class &apos;logging.Handler&apos;&gt;,</span><br><span class="line"> &lt;class &apos;logging.Filterer&apos;&gt;,</span><br><span class="line"> &lt;class &apos;object&apos;&gt;)</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹<code>BaseRotatingHandler</code>ï¼Œå®ƒç»§æ‰¿äº†<code>FileHandler</code>ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseRotatingHandler</span><span class="params">(logging.FileHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">emit</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self.shouldRollover(record):</span><br><span class="line">                self.doRollover()</span><br><span class="line">            logging.FileHandler.emit(self, record)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            self.handleError(record)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rotate</span><span class="params">(self, source, dest)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> callable(self.rotator):</span><br><span class="line">            <span class="keyword">if</span> os.path.exists(source):</span><br><span class="line">                os.rename(source, dest)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.rotator(source, dest)</span><br></pre></td></tr></table></figure>
<p><code>BaseRotatingHandler</code>åœ¨æ‰“å°æ—¥å¿—è®°å½•å‰ï¼Œé¦–å…ˆä¼šé€šè¿‡<code>shouldRollover</code>æ–¹æ³•æ ¹æ®æ—¥å¿—è®°å½•ä¿¡æ¯åˆ¤æ–­æ˜¯å¦è¦ç¿»ç¯‡ï¼Œå¦‚æœéœ€è¦çš„è¯å°±è°ƒç”¨<code>doRollOver</code>æ–¹æ³•ç¿»ç¯‡ï¼Œæœ€åå†è°ƒç”¨<code>FileHandler</code>çš„<code>emit</code>æ–¹æ³•ã€‚<code>shouldRollover</code>è·Ÿ<code>doRollover</code>æ–¹æ³•éƒ½éœ€è¦å­ç±»è‡ªå·±å®ç°ã€‚</p>
<p>åŒæ—¶ï¼Œ<code>BaseRotatingHandler</code>ä¹Ÿæä¾›äº†<code>rotate</code>æ–¹æ³•è°ƒç”¨<code>rotator</code>æˆ–è€…é‡‡ç”¨é»˜è®¤é‡å‘½åçš„æ–¹å¼æ‰§è¡Œç¿»ç¯‡æ“ä½œã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹<code>TimedRotatingFileHandler</code>çš„å…·ä½“å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimedRotatingFileHandler</span><span class="params">(BaseRotatingHandler)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename, when=<span class="string">'h'</span>, interval=<span class="number">1</span>, backupCount=<span class="number">0</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 encoding=None, delay=False, utc=False, atTime=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 errors=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(filename):</span><br><span class="line">            t = os.stat(filename)[ST_MTIME]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            t = int(time.time())</span><br><span class="line">        self.rolloverAt = self.computeRollover(t)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">computeRollover</span><span class="params">(self, currentTime)</span>:</span></span><br><span class="line">        result = currentTime + self.interval</span><br><span class="line">        <span class="keyword">if</span> self.when == <span class="string">'MIDNIGHT'</span> <span class="keyword">or</span> self.when.startswith(<span class="string">'W'</span>):</span><br><span class="line">            <span class="comment"># è¿™é‡Œå¿½ç•¥æ‰è®¡ç®—å‡Œæ™¨è·Ÿä¸€å‘¨å†…ç‰¹å®šæ—¥çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">shouldRollover</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        t = int(time.time())</span><br><span class="line">        <span class="keyword">if</span> t &gt;= self.rolloverAt:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">doRollover</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.stream:</span><br><span class="line">            self.stream.close()</span><br><span class="line">            self.stream = <span class="literal">None</span></span><br><span class="line">        <span class="comment"># get the time that this sequence started at and make it a TimeTuple</span></span><br><span class="line">        currentTime = int(time.time())</span><br><span class="line">        dstNow = time.localtime(currentTime)[<span class="number">-1</span>]</span><br><span class="line">        t = self.rolloverAt - self.interval</span><br><span class="line">        <span class="keyword">if</span> self.utc:</span><br><span class="line">            timeTuple = time.gmtime(t)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            timeTuple = time.localtime(t)</span><br><span class="line">            dstThen = timeTuple[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> dstNow != dstThen:</span><br><span class="line">                <span class="keyword">if</span> dstNow:</span><br><span class="line">                    addend = <span class="number">3600</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    addend = <span class="number">-3600</span></span><br><span class="line">                timeTuple = time.localtime(t + addend)</span><br><span class="line">        dfn = self.rotation_filename(self.baseFilename + <span class="string">"."</span> +</span><br><span class="line">                                     time.strftime(self.suffix, timeTuple))</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(dfn):</span><br><span class="line">            os.remove(dfn)</span><br><span class="line">        self.rotate(self.baseFilename, dfn)</span><br><span class="line">        <span class="keyword">if</span> self.backupCount &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">for</span> s <span class="keyword">in</span> self.getFilesToDelete():</span><br><span class="line">                os.remove(s)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.delay:</span><br><span class="line">            self.stream = self._open()</span><br><span class="line">        newRolloverAt = self.computeRollover(currentTime)</span><br><span class="line">        <span class="keyword">while</span> newRolloverAt &lt;= currentTime:</span><br><span class="line">            newRolloverAt = newRolloverAt + self.interval</span><br><span class="line">        <span class="comment">#If DST changes and midnight or weekly rollover, adjust for this.</span></span><br><span class="line">        <span class="keyword">if</span> (self.when == <span class="string">'MIDNIGHT'</span> <span class="keyword">or</span> self.when.startswith(<span class="string">'W'</span>)) <span class="keyword">and</span> <span class="keyword">not</span> self.utc:</span><br><span class="line">            dstAtRollover = time.localtime(newRolloverAt)[<span class="number">-1</span>]</span><br><span class="line">            <span class="keyword">if</span> dstNow != dstAtRollover:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> dstNow:  <span class="comment"># DST kicks in before next rollover, so we need to deduct an hour</span></span><br><span class="line">                    addend = <span class="number">-3600</span></span><br><span class="line">                <span class="keyword">else</span>:           <span class="comment"># DST bows out before next rollover, so we need to add an hour</span></span><br><span class="line">                    addend = <span class="number">3600</span></span><br><span class="line">                newRolloverAt += addend</span><br><span class="line">        self.rolloverAt = newRolloverAt</span><br></pre></td></tr></table></figure>
<p>åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šè§£ææ—¶é—´è®¾å®šè®¡ç®—æ—¶é—´é—´éš”<code>interval</code>ï¼Œç„¶åé€šè¿‡<code>computeRollover</code>åˆå§‹åŒ–<code>rolloverAt</code>ï¼Œä¹Ÿå°±æ˜¯ç¿»ç¯‡çš„æ—¶é—´ç‚¹ã€‚åœ¨<code>emit</code>çš„æ—¶å€™ï¼Œä¹Ÿä¼šç›´æ¥é€šè¿‡å½“å‰æ—¶é—´åˆ¤æ–­æ˜¯å¦è¶…è¿‡ç¿»ç¯‡æ—¶é—´ï¼Œè¶…è¿‡çš„è¯ï¼Œå°±ä¼šæ‰§è¡Œ<code>doRollover</code>ã€‚</p>
<p><code>doRollover</code>æ€»å…±åšäº†è¿™å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>å…³é—­å½“å‰æ–‡ä»¶æµ</li>
<li>æ ¹æ®å½“å‰æ—¶é—´ç”Ÿæˆéœ€è¦å½’æ¡£çš„æ—¥å¿—æ–‡ä»¶å</li>
<li>æ‰§è¡Œç¿»ç¯‡ï¼Œå°†å½“å‰æ—¥å¿—æ–‡ä»¶é‡å‘½åï¼Œå½’æ¡£æ ‡æ³¨ä¸ºç‰¹å®šæ—¶é—´</li>
<li>åˆ é™¤å†—ä½™çš„æ—§æ–‡ä»¶</li>
<li>å¦‚æœä¸æ˜¯lazy-loadï¼Œç›´æ¥è°ƒç”¨<code>_open</code>ç”Ÿæˆæ–°çš„æ–‡ä»¶</li>
<li>è®¡ç®—æ–°çš„ç¿»ç¯‡æ—¶é—´ç‚¹</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>baseFilename</code>å…¶å®æ˜¯ä¸ªä¸­é—´æ€çš„æ–‡ä»¶åï¼Œå®è´¨ç¿»ç¯‡æ“ä½œä¼šæ˜¯é‡å‘½åæ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºå¸¦ç‰¹å®šæ—¶é—´ä¿¡æ¯çš„æ–‡ä»¶åã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨<code>logging.handlers</code>é‡Œï¼Œé™¤äº†ä¸Šè¿°ä¸‰ç§<code>handler</code>å¤–ï¼Œè¿˜æœ‰è®¸è®¸å¤šå¤šçš„<code>handler</code>å®šä¹‰ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡ŒæŒ–æ˜ï¼</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ—¥å¿—</tag>
        <tag>Handler</tag>
        <tag>stderr</tag>
        <tag>TimedRotatingFileHandler</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬å››ç« -æ—¥å¿—ã€‘1ã€Loggerä¸Managerçš„æºç å®ç°</title>
    <url>/2022/04/09/hardpython/4_log_1/</url>
    <content><![CDATA[<p>pythonè¯­è¨€å†…ç½®äº†ä¸€ä¸ªå¼ºå¤§çš„æ—¥å¿—æ¨¡å—<code>logging</code>ï¼Œä¹Ÿæ˜¯pythonå†…éƒ¨æœ€ä¸ºå¤æ‚çš„åŠŸèƒ½æ¨¡å—ä¹‹ä¸€ï¼Œé€šè¿‡è¿™ä¸ªæ¨¡å—æˆ‘ä»¬èƒ½å¤Ÿå®ç°ä¸åŒæ ·å¼çš„æ—¥å¿—æ‰“å°ã€‚å…³äº<code>logging</code>æ¨¡å—çš„å®˜æ–¹æ–‡æ¡£ä¹Ÿéå¸¸å®Œå¤‡ï¼š</p>
<ul>
<li>loggingçš„ç”¨æ³•<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9ob3d0by9sb2dnaW5nLmh0bWwjbG9nZ2luZy1iYXNpYy10dXRvcmlhbA==" title="https://docs.python.org/zh-cn/3/howto/logging.html#logging-basic-tutorial">æ—¥å¿—å¸¸ç”¨æŒ‡å¼•<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9ob3d0by9sb2dnaW5nLWNvb2tib29rLmh0bWwjbG9nZ2luZy1jb29rYm9vaw==" title="https://docs.python.org/zh-cn/3/howto/logging-cookbook.html#logging-cookbook">æ—¥å¿—æ“ä½œæ‰‹å†Œ<i class="fa fa-external-link"></i></span></li>
</ul>
</li>
<li>logging API<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9saWJyYXJ5L2xvZ2dpbmcuaHRtbCM=" title="https://docs.python.org/zh-cn/3/library/logging.html#">loggingæ—¥å¿—è®°å½•å·¥å…·<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9saWJyYXJ5L2xvZ2dpbmcuY29uZmlnLmh0bWw=" title="https://docs.python.org/zh-cn/3/library/logging.config.html">logging config<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9saWJyYXJ5L2xvZ2dpbmcuaGFuZGxlcnMuaHRtbA==" title="https://docs.python.org/zh-cn/3/library/logging.handlers.html">logging handlers<i class="fa fa-external-link"></i></span></li>
</ul>
</li>
</ul>
<p>ä¸ºæ­¤ï¼Œæœ¬æ–‡èµ·æˆ‘ä»¬å¯¹pythonçš„<code>logging</code>æ¨¡å—è¿›è¡Œæ·±å…¥å‰–æï¼Œä»è€Œè®©å¤§å®¶èƒ½å¤Ÿæ›´å¥½åœ°æŒæ¡pythonçš„<code>logging</code>æ¨¡å—ã€‚</p>
<a id="more"></a>
<h2 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h2><p>æˆ‘ä»¬é¦–å…ˆä»ä¸€æ®µæœ€åŸºæœ¬çš„ä»£ç å…¥æ‰‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_basic_config</span><span class="params">()</span>:</span></span><br><span class="line">    logging.basicConfig(stream=sys.stdout, level=logging.INFO)</span><br><span class="line">    logging.info(<span class="string">'helloworld'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_basic_config()</span><br></pre></td></tr></table></figure>
<p>ä»è¯­ä¹‰ä¸Šçœ‹ï¼Œä»£ç çš„å«ä¹‰æ˜¯ï¼šè®¾ç½®æ—¥å¿—åŸºç¡€é…ç½®ä¸ºæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºæµï¼Œåªæ¥å—<code>INFO</code>çº§åˆ«ä»¥ä¸Šçš„æ—¥å¿—ã€‚å¾ˆæ˜æ˜¾ï¼Œæ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">INFO:root:helloworld</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹åœ¨æºä»£ç é‡Œé¢å…·ä½“åšäº†ä»€ä¹ˆã€‚é¦–å…ˆä»<code>logging.basicConfig</code>çœ‹èµ·ï¼Œè¯¥æ–¹æ³•ä¸º<code>logging</code>ç³»ç»Ÿè®¾å®šäº†åŸºç¡€é…ç½®ã€‚å…¶ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># logging/__init__.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">basicConfig</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    _acquireLock()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        force = kwargs.pop(<span class="string">'force'</span>, <span class="literal">False</span>)</span><br><span class="line">        encoding = kwargs.pop(<span class="string">'encoding'</span>, <span class="literal">None</span>)</span><br><span class="line">        errors = kwargs.pop(<span class="string">'errors'</span>, <span class="string">'backslashreplace'</span>)</span><br><span class="line">        <span class="keyword">if</span> force:</span><br><span class="line">            <span class="keyword">for</span> h <span class="keyword">in</span> root.handlers[:]:</span><br><span class="line">                root.removeHandler(h)</span><br><span class="line">                h.close()</span><br><span class="line">        <span class="keyword">if</span> len(root.handlers) == <span class="number">0</span>:</span><br><span class="line">            handlers = kwargs.pop(<span class="string">"handlers"</span>, <span class="literal">None</span>)</span><br><span class="line">            <span class="keyword">if</span> handlers <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">"stream"</span> <span class="keyword">in</span> kwargs <span class="keyword">and</span> <span class="string">"filename"</span> <span class="keyword">in</span> kwargs:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">"'stream' and 'filename' should not be "</span></span><br><span class="line">                                     <span class="string">"specified together"</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> <span class="string">"stream"</span> <span class="keyword">in</span> kwargs <span class="keyword">or</span> <span class="string">"filename"</span> <span class="keyword">in</span> kwargs:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">"'stream' or 'filename' should not be "</span></span><br><span class="line">                                     <span class="string">"specified together with 'handlers'"</span>)</span><br><span class="line">            <span class="keyword">if</span> handlers <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                filename = kwargs.pop(<span class="string">"filename"</span>, <span class="literal">None</span>)</span><br><span class="line">                mode = kwargs.pop(<span class="string">"filemode"</span>, <span class="string">'a'</span>)</span><br><span class="line">                <span class="keyword">if</span> filename:</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">'b'</span> <span class="keyword">in</span> mode:</span><br><span class="line">                        errors = <span class="literal">None</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        encoding = io.text_encoding(encoding)</span><br><span class="line">                    h = FileHandler(filename, mode,</span><br><span class="line">                                    encoding=encoding, errors=errors)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    stream = kwargs.pop(<span class="string">"stream"</span>, <span class="literal">None</span>)</span><br><span class="line">                    h = StreamHandler(stream)</span><br><span class="line">                handlers = [h]</span><br><span class="line">            dfs = kwargs.pop(<span class="string">"datefmt"</span>, <span class="literal">None</span>)</span><br><span class="line">            style = kwargs.pop(<span class="string">"style"</span>, <span class="string">'%'</span>)</span><br><span class="line">            <span class="keyword">if</span> style <span class="keyword">not</span> <span class="keyword">in</span> _STYLES:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">'Style must be one of: %s'</span> % <span class="string">','</span>.join(</span><br><span class="line">                                 _STYLES.keys()))</span><br><span class="line">            fs = kwargs.pop(<span class="string">"format"</span>, _STYLES[style][<span class="number">1</span>])</span><br><span class="line">            fmt = Formatter(fs, dfs, style)</span><br><span class="line">            <span class="keyword">for</span> h <span class="keyword">in</span> handlers:</span><br><span class="line">                <span class="keyword">if</span> h.formatter <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    h.setFormatter(fmt)</span><br><span class="line">                root.addHandler(h)</span><br><span class="line">            level = kwargs.pop(<span class="string">"level"</span>, <span class="literal">None</span>)</span><br><span class="line">            <span class="keyword">if</span> level <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                root.setLevel(level)</span><br><span class="line">            <span class="keyword">if</span> kwargs:</span><br><span class="line">                keys = <span class="string">', '</span>.join(kwargs.keys())</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">'Unrecognised argument(s): %s'</span> % keys)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        _releaseLock()</span><br></pre></td></tr></table></figure>
<p>ä¼ å…¥çš„å‚æ•°æ˜¯<code>unpacked mapping</code>å¼çš„<code>kwargs</code>ï¼Œä¼šåœ¨ä»£ç é‡Œé¢è¢«<code>pop</code>å‡ºæ¥ç„¶åæ ¹æ®å®é™…é…ç½®å€¼è¿›è¡Œé…ç½®è®¾å®šã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹å…¶ä¸­å…·ä½“ç”±æ‰§è¡Œå“ªäº›é€»è¾‘ï¼š</p>
<ul>
<li>å¦‚æœ<code>force</code>å‚æ•°è¢«å¯ç”¨ï¼Œä¼šè°ƒç”¨<code>root.removeHandler</code>æ–¹æ³•æ¸…ç©º<code>handlers</code></li>
<li><code>handlers</code>/<code>stream</code>/<code>filename</code>çš„å…±å­˜æ£€æŸ¥<ul>
<li>å¯ä»¥æ¨æµ‹åˆ°ï¼Œè¿™ä¸‰ä¸ªæ¦‚å¿µå®é™…éƒ½æŒ‡ä»£æ—¥å¿—çš„è¾“å‡ºç›®æ ‡</li>
</ul>
</li>
<li>å¦‚æœæŒ‡å®š<code>filename</code>ï¼Œå°±åˆ›å»ºä¸€ä¸ª<code>FileHandler</code>å®ä¾‹<ul>
<li>å†™å…¥æ¨¡å¼ã€ç¼–ç é”™è¯¯å¤„ç†ç­‰å‚æ•°ä¹Ÿä¼šä»<code>kwargs</code>é‡Œå–å‡ºï¼Œå®é™…å°±æ˜¯<code>open</code>é‡Œé¢çš„å‚æ•°</li>
</ul>
</li>
<li>å¦‚æœæŒ‡å®š<code>stream</code>ï¼Œå°±åˆ›å»ºä¸€ä¸ª<code>StreamHandler</code>å®ä¾‹</li>
<li>æ ¹æ®<code>datefmt</code>ã€<code>style</code>ã€<code>format</code>é…ç½®ï¼Œåˆ›å»ºä¸€ä¸ª<code>Formatter</code>å®ä¾‹ï¼Œç»™åˆ°æ‰€æœ‰çš„<code>handler</code>å®ä¾‹</li>
<li>æ ¹æ®<code>level</code>é…ç½®ï¼Œè®¾ç½®<code>root</code>çš„<code>level</code>å±æ€§</li>
</ul>
<p>æ€»çš„æ¥çœ‹ï¼Œè¿™ä¸ªæµç¨‹å‡ºç°äº†3ä¸ªæ–°æ¦‚å¿µï¼š</p>
<ul>
<li><code>root</code>ï¼Œå®é™…æ˜¯ä¸€ä¸ª<code>RootLogger(WARNING)</code>å®ä¾‹</li>
<li><code>handler</code></li>
<li><code>formatter</code>ï¼šæ˜¯<code>handler</code>çš„å±æ€§ä¹‹ä¸€ï¼Œç”¨æ¥æ ¼å¼åŒ–æ—¥å¿—ä¿¡æ¯</li>
</ul>
<p>æœ¬ç¯‡æ–‡ç« é‡Œé¢æˆ‘ä»¬é¦–å…ˆçœ‹<code>root</code>ï¼Œä¹Ÿå°±æ˜¯<code>Logger</code>ç›¸å…³çš„å†…å®¹ã€‚åé¢å†çœ‹<code>handler</code>ä¹‹ç±»çš„ä¾‹å­ã€‚</p>
<h2 id="Loggerçš„å®ç°"><a href="#Loggerçš„å®ç°" class="headerlink" title="Loggerçš„å®ç°"></a>Loggerçš„å®ç°</h2><p>è¦çœ‹<code>Logger</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä»<code>RootLogger</code>çœ‹èµ·ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">root = RootLogger(WARNING)</span><br><span class="line">Logger.root = root</span><br><span class="line">Logger.manager = Manager(Logger.root)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RootLogger</span><span class="params">(Logger)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, level)</span>:</span></span><br><span class="line">        Logger.__init__(self, <span class="string">"root"</span>, level)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> getLogger, ()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getLogger</span><span class="params">(name=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> name <span class="keyword">or</span> isinstance(name, str) <span class="keyword">and</span> name == root.name:</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    <span class="keyword">return</span> Logger.manager.getLogger(name)</span><br></pre></td></tr></table></figure>
<p><code>RootLogger</code>ç»§æ‰¿äº†<code>Logger</code>ï¼Œ<code>__init__</code>ä¸­å®é™…ä¸Šæ˜¯åˆ›å»ºäº†åä¸º<code>root</code>çš„<code>Logger</code>ã€‚æ­¤å¤–ï¼Œ<code>RootLogger</code>è¿˜å®šä¹‰äº†<code>__reduce__</code>å‡½æ•°ç”¨äºåœ¨åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶æ”¯æŒå®ä¾‹çš„è§£æã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬èƒ½å¤Ÿæ¨æµ‹åˆ°ï¼Œ<code>Logger.manager</code>å®ä¾‹ä¼šå¯¹<code>Logger</code>å®ä¾‹è¿›è¡Œç®¡ç†ã€‚å› æ­¤é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹<code>Logger</code>æœ¬èº«ï¼Œç„¶åå†çœ‹ä¸‹<code>Manager</code>é‡Œé¢ã€‚</p>
<p>æˆ‘ä»¬ä»æ‰“å°æ—¥å¿—çš„é€»è¾‘çœ‹èµ·ã€‚å‡ä½¿æˆ‘ä»¬è°ƒç”¨<code>Logger</code>å®ä¾‹çš„<code>info</code>æ–¹æ³•æ‰“å°æ—¥å¿—ï¼Œå®é™…ä¼šæ¶‰åŠåˆ°è¿™äº›ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span><span class="params">(Filterer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">info</span><span class="params">(self, msg, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.isEnabledFor(INFO):</span><br><span class="line">            self._log(INFO, msg, args, **kwargs)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isEnabledFor</span><span class="params">(self, level)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.disabled:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self._cache[level]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            _acquireLock()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> self.manager.disable &gt;= level:</span><br><span class="line">                    is_enabled = self._cache[level] = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    is_enabled = self._cache[level] = (</span><br><span class="line">                        level &gt;= self.getEffectiveLevel()</span><br><span class="line">                    )</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                _releaseLock()</span><br><span class="line">            <span class="keyword">return</span> is_enabled</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getEffectiveLevel</span><span class="params">(self)</span>:</span></span><br><span class="line">        logger = self</span><br><span class="line">        <span class="keyword">while</span> logger:</span><br><span class="line">            <span class="keyword">if</span> logger.level:</span><br><span class="line">                <span class="keyword">return</span> logger.level</span><br><span class="line">            logger = logger.parent</span><br><span class="line">        <span class="keyword">return</span> NOTSET</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>info</code>é€»è¾‘å¼€å¤´ï¼Œä¼šè°ƒç”¨<code>isEnabledFor</code>æ–¹æ³•åˆ¤æ–­å½“å‰è®¾ç½®çš„æ—¥å¿—çº§åˆ«<code>level</code>æ˜¯å¦åˆæ³•ã€‚åˆ¤æ–­çš„ä¾æ®æ˜¯å…ˆçœ‹<code>manager</code>çš„<code>disable</code>è®¾å®šï¼Œç„¶åå†çœ‹è‡ªå·±æ˜¯å¦æœ‰è®¾å®š<code>level</code>ï¼Œå¦‚æœè¿˜æ²¡æœ‰çš„è¯å°±ä¸€ç›´åœ¨çˆ¶<code>logger</code>é‡Œé¢æ‰¾ï¼Œç›´åˆ°çœ‹åˆ°è®¾å®šçš„<code>level</code>ï¼Œç„¶åè¿›è¡Œå¤§å°æ¯”è¾ƒã€‚</p>
<p>ä»è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œ<code>logger</code>å®ä¾‹ä¹‹é—´æ˜¯ä¼šå­˜åœ¨å±‚çº§å…³ç³»çš„ã€‚å…·ä½“åé¢æ…¢æ…¢è¯´ã€‚</p>
<p>ä¹‹åå°±ä¼šè°ƒç”¨<code>_log</code>æ–¹æ³•çœŸæ­£æ‰“å°æ—¥å¿—ï¼Œå…¶å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logger</span><span class="params">(Filterer)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_log</span><span class="params">(self, level, msg, args, exc_info=None, extra=None, stack_info=False,</span></span></span><br><span class="line"><span class="function"><span class="params">             stacklevel=<span class="number">1</span>)</span>:</span></span><br><span class="line">        sinfo = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> _srcfile:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                fn, lno, func, sinfo = self.findCaller(stack_info, stacklevel)</span><br><span class="line">            <span class="keyword">except</span> ValueError: <span class="comment"># pragma: no cover</span></span><br><span class="line">                fn, lno, func = <span class="string">"(unknown file)"</span>, <span class="number">0</span>, <span class="string">"(unknown function)"</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment"># pragma: no cover</span></span><br><span class="line">            fn, lno, func = <span class="string">"(unknown file)"</span>, <span class="number">0</span>, <span class="string">"(unknown function)"</span></span><br><span class="line">        <span class="keyword">if</span> exc_info:</span><br><span class="line">            <span class="keyword">if</span> isinstance(exc_info, BaseException):</span><br><span class="line">                exc_info = (type(exc_info), exc_info, exc_info.__traceback__)</span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> isinstance(exc_info, tuple):</span><br><span class="line">                exc_info = sys.exc_info()</span><br><span class="line">        record = self.makeRecord(self.name, level, fn, lno, msg, args,</span><br><span class="line">                                 exc_info, func, extra, sinfo)</span><br><span class="line">        self.handle(record)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findCaller</span><span class="params">(self, stack_info=False, stacklevel=<span class="number">1</span>)</span>:</span></span><br><span class="line">        f = currentframe()</span><br><span class="line">        <span class="keyword">if</span> f <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            f = f.f_back</span><br><span class="line">        orig_f = f</span><br><span class="line">        <span class="keyword">while</span> f <span class="keyword">and</span> stacklevel &gt; <span class="number">1</span>:</span><br><span class="line">            f = f.f_back</span><br><span class="line">            stacklevel -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> f:</span><br><span class="line">            f = orig_f</span><br><span class="line">        rv = <span class="string">"(unknown file)"</span>, <span class="number">0</span>, <span class="string">"(unknown function)"</span>, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> hasattr(f, <span class="string">"f_code"</span>):</span><br><span class="line">            co = f.f_code</span><br><span class="line">            filename = os.path.normcase(co.co_filename)</span><br><span class="line">            <span class="keyword">if</span> filename == _srcfile:</span><br><span class="line">                f = f.f_back</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            sinfo = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> stack_info:</span><br><span class="line">                sio = io.StringIO()</span><br><span class="line">                sio.write(<span class="string">'Stack (most recent call last):\n'</span>)</span><br><span class="line">                traceback.print_stack(f, file=sio)</span><br><span class="line">                sinfo = sio.getvalue()</span><br><span class="line">                <span class="keyword">if</span> sinfo[<span class="number">-1</span>] == <span class="string">'\n'</span>:</span><br><span class="line">                    sinfo = sinfo[:<span class="number">-1</span>]</span><br><span class="line">                sio.close()</span><br><span class="line">            rv = (co.co_filename, f.f_lineno, co.co_name, sinfo)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">makeRecord</span><span class="params">(self, name, level, fn, lno, msg, args, exc_info,</span></span></span><br><span class="line"><span class="function"><span class="params">                   func=None, extra=None, sinfo=None)</span>:</span></span><br><span class="line">        rv = _logRecordFactory(name, level, fn, lno, msg, args, exc_info, func,</span><br><span class="line">                             sinfo)</span><br><span class="line">        <span class="keyword">if</span> extra <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">for</span> key <span class="keyword">in</span> extra:</span><br><span class="line">                <span class="keyword">if</span> (key <span class="keyword">in</span> [<span class="string">"message"</span>, <span class="string">"asctime"</span>]) <span class="keyword">or</span> (key <span class="keyword">in</span> rv.__dict__):</span><br><span class="line">                    <span class="keyword">raise</span> KeyError(<span class="string">"Attempt to overwrite %r in LogRecord"</span> % key)</span><br><span class="line">                rv.__dict__[key] = extra[key]</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> self.disabled) <span class="keyword">and</span> self.filter(record):</span><br><span class="line">            self.callHandlers(record)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callHandlers</span><span class="params">(self, record)</span>:</span></span><br><span class="line">        c = self</span><br><span class="line">        found = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> c:</span><br><span class="line">            <span class="keyword">for</span> hdlr <span class="keyword">in</span> c.handlers:</span><br><span class="line">                found = found + <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> record.levelno &gt;= hdlr.level:</span><br><span class="line">                    hdlr.handle(record)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> c.propagate:</span><br><span class="line">                c = <span class="literal">None</span>    <span class="comment">#break out</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                c = c.parent</span><br><span class="line">        <span class="keyword">if</span> (found == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">if</span> lastResort:</span><br><span class="line">                <span class="keyword">if</span> record.levelno &gt;= lastResort.level:</span><br><span class="line">                    lastResort.handle(record)</span><br><span class="line">            <span class="keyword">elif</span> raiseExceptions <span class="keyword">and</span> <span class="keyword">not</span> self.manager.emittedNoHandlerWarning:</span><br><span class="line">                sys.stderr.write(<span class="string">"No handlers could be found for logger"</span></span><br><span class="line">                                 <span class="string">" \"%s\"\n"</span> % self.name)</span><br><span class="line">                self.manager.emittedNoHandlerWarning = <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p><code>_log</code>æ‰§è¡Œäº†ä¸‰ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>é€šè¿‡<code>findCaller</code>ï¼Œæ‰¾åˆ°æ˜¯å“ªä¸ªæ–‡ä»¶å“ªä¸€è¡Œä»£ç è°ƒç”¨äº†æ‰“å°æ—¥å¿—<ul>
<li>æ–¹æ³•æ˜¯éå†æ ˆå¸§ï¼Œæ£€æŸ¥åˆ°ç¬¬ä¸€ä¸ªé<code>logging</code>æºä»£ç çš„è°ƒç”¨ï¼Œä»è€Œåˆ¤æ–­åˆ°ä¸ºå®é™…è°ƒç”¨æ‰“å°æ—¥å¿—é€»è¾‘çš„ä¸€è¡Œ</li>
</ul>
</li>
<li>é€šè¿‡<code>makeRecord</code>ï¼Œä¸ºå½“å‰éœ€è¦æ‰“å°çš„æ—¥å¿—åˆ›å»ºäº†ä¸€ä¸ª<code>LogRecord</code>å®ä¾‹<ul>
<li><code>LogRecord</code>å®ä¾‹å­˜å‚¨äº†ä¸€è¡Œæ—¥å¿—æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¯¦ç»†å®ç°å¯ä»¥çœ‹ç±»å®šä¹‰</li>
</ul>
</li>
<li><code>handle</code>åˆ›å»ºçš„<code>LogRecord</code>å®ä¾‹<ul>
<li>é¦–å…ˆé€šè¿‡<code>filter</code>æ–¹æ³•çœ‹è¿™ä¸ªæ—¥å¿—<code>record</code>èƒ½å¦è¢«æ‰“å°<ul>
<li><code>filter</code>çš„è¯¦ç»†å®ç°å¯ä»¥çœ‹<code>Filter</code>ç±»å®šä¹‰</li>
</ul>
</li>
<li>é€šè¿‡<code>callHandlers</code>è°ƒç”¨åä¸‹æ‰€æœ‰<code>handlers</code>å¤„ç†<code>LogRecord</code>å®ä¾‹ï¼Œå°†æ—¥å¿—æ‰“å°åˆ°ä¸åŒçš„åœ°æ–¹<ul>
<li>åœ¨éå†æ‰€æœ‰<code>handler</code>æ—¶ä¹Ÿæ£€æŸ¥<code>handler</code>æ˜¯å¦èƒ½å¤Ÿæ‰“å°å¯¹åº”ç­‰çº§çš„æ—¥å¿—</li>
<li>å¦‚æœæ²¡æœ‰<code>handler</code>èƒ½æ‰“å°æ—¥å¿—ï¼Œç”¨ç‰¹æ®Šçš„<code>Logger</code>å®ä¾‹<code>lastResort</code>æ¥å…œåº•</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹<code>Logger</code>å®ä¾‹æ‰“å°æ—¥å¿—æ—¶çš„é‡ç‚¹ï¼š</p>
<ul>
<li>æ—¥å¿—è®°å½•çš„ç”Ÿäº§å’Œæ¶ˆè´¹æ˜¯åˆ†ç¦»çš„</li>
<li>ç”Ÿäº§æ—¥å¿—è®°å½•éœ€è¦åˆ¤æ–­æ˜¯å¦ç¬¦åˆ<code>Logger</code>åŠ<code>Manager</code>å®ä¾‹çš„æ—¥å¿—çº§åˆ«é…ç½®ï¼Œå¯èƒ½ä¼šè¿½æº¯åˆ°ä¸Šå±‚çš„<code>Logger</code>å®ä¾‹é…ç½®</li>
<li>æ¶ˆè´¹æ—¥å¿—è®°å½•é¦–å…ˆçœ‹æ˜¯å¦è¢«<code>Logger</code>å®ä¾‹è‡ªå·±è¿‡æ»¤æ‰ï¼Œç„¶åéå†æ‰€æœ‰æ¶ˆè´¹è€…ï¼Œå¦‚æœæ»¡è¶³æ—¥å¿—çº§åˆ«æ¡ä»¶å³å¯å¼€å§‹æ‰“å°æ“ä½œ</li>
</ul>
<h2 id="Managerçš„å®ç°"><a href="#Managerçš„å®ç°" class="headerlink" title="Managerçš„å®ç°"></a>Managerçš„å®ç°</h2><p><code>Logger</code>çš„å·®ä¸å¤šçœ‹å®Œäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>Manager</code>ï¼Œä¹Ÿå°±æ˜¯<code>Logger</code>å®ä¾‹çš„ç®¡ç†å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, rootnode)</span>:</span></span><br><span class="line">        self.root = rootnode</span><br><span class="line">        self.disable = <span class="number">0</span></span><br><span class="line">        self.emittedNoHandlerWarning = <span class="literal">False</span></span><br><span class="line">        self.loggerDict = &#123;&#125;</span><br><span class="line">        self.loggerClass = <span class="literal">None</span></span><br><span class="line">        self.logRecordFactory = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p>Manageråœ¨æ—¥å¿—ç³»ç»Ÿå†…æ˜¯ä»¥å•ä¾‹çš„å½¢å¼å­˜åœ¨çš„ï¼Œå…¶åŒ…å«å¦‚ä¸‹å±æ€§ï¼š</p>
<ul>
<li><code>root</code>ï¼šæ ¹<code>Logger</code></li>
<li><code>disable</code>ï¼šç¦ç”¨æ—¥å¿—çº§åˆ«</li>
<li><code>loggerDict</code>ï¼šå­˜å‚¨loggerå®ä¾‹åŠå¯¹åº”åç§°çš„å­—å…¸</li>
<li><code>loggerClass</code>ï¼šLoggerå®ä¾‹çš„ç±»</li>
<li><code>logRecordFactory</code>ï¼šæ—¥å¿—è®°å½•çš„åˆ›å»ºæ–¹æ³•ï¼Œå‰é¢æœ‰æ</li>
</ul>
<p><code>Manager</code>æœ€å¤§çš„ä½œç”¨æ˜¯ç®¡ç†<code>Logger</code>å®ä¾‹ã€‚é€šè¿‡<code>getLogger</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ª<code>Logger</code>å®ä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getLogger</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        rv = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(name, str):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'A logger name must be a string'</span>)</span><br><span class="line">        _acquireLock()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> name <span class="keyword">in</span> self.loggerDict:</span><br><span class="line">                rv = self.loggerDict[name]</span><br><span class="line">                <span class="keyword">if</span> isinstance(rv, PlaceHolder):</span><br><span class="line">                    ph = rv</span><br><span class="line">                    rv = (self.loggerClass <span class="keyword">or</span> _loggerClass)(name)</span><br><span class="line">                    rv.manager = self</span><br><span class="line">                    self.loggerDict[name] = rv</span><br><span class="line">                    self._fixupChildren(ph, rv)</span><br><span class="line">                    self._fixupParents(rv)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                rv = (self.loggerClass <span class="keyword">or</span> _loggerClass)(name)</span><br><span class="line">                rv.manager = self</span><br><span class="line">                self.loggerDict[name] = rv</span><br><span class="line">                self._fixupParents(rv)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            _releaseLock()</span><br><span class="line">        <span class="keyword">return</span> rv</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_fixupParents</span><span class="params">(self, alogger)</span>:</span></span><br><span class="line">        name = alogger.name</span><br><span class="line">        i = name.rfind(<span class="string">"."</span>)</span><br><span class="line">        rv = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> (i &gt; <span class="number">0</span>) <span class="keyword">and</span> <span class="keyword">not</span> rv:</span><br><span class="line">            substr = name[:i]</span><br><span class="line">            <span class="keyword">if</span> substr <span class="keyword">not</span> <span class="keyword">in</span> self.loggerDict:</span><br><span class="line">                self.loggerDict[substr] = PlaceHolder(alogger)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                obj = self.loggerDict[substr]</span><br><span class="line">                <span class="keyword">if</span> isinstance(obj, Logger):</span><br><span class="line">                    rv = obj</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">assert</span> isinstance(obj, PlaceHolder)</span><br><span class="line">                    obj.append(alogger)</span><br><span class="line">            i = name.rfind(<span class="string">"."</span>, <span class="number">0</span>, i - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> rv:</span><br><span class="line">            rv = self.root</span><br><span class="line">        alogger.parent = rv</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_fixupChildren</span><span class="params">(self, ph, alogger)</span>:</span></span><br><span class="line">        name = alogger.name</span><br><span class="line">        namelen = len(name)</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> ph.loggerMap.keys():</span><br><span class="line">            <span class="comment">#The if means ... if not c.parent.name.startswith(nm)</span></span><br><span class="line">            <span class="keyword">if</span> c.parent.name[:namelen] != name:</span><br><span class="line">                alogger.parent = c.parent</span><br><span class="line">                c.parent = alogger</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ<code>Logger</code>åå­—æ²¡æœ‰æ³¨å†Œï¼Œä¼šè§¦å‘æ‡’åŠ è½½<code>Logger</code>å®ä¾‹ã€‚åœ¨æ‡’åŠ è½½çš„è¿‡ç¨‹æœ€ç»ˆï¼Œä¼šè®¾å®šè¯¥<code>Logger</code>å®ä¾‹æ‰€å±çš„çˆ¶çº§<code>Logger</code>å®ä¾‹ã€‚ä»<code>_fixupParents</code>æ–¹æ³•å¯ä»¥æ¸…æ¥šçœ‹åˆ°ï¼Œé€šè¿‡<code>Logger</code>åå­—çš„.ç¬¦å·èƒ½å¤Ÿåˆ†éš”<code>Logger</code>å®ä¾‹æ‰€åœ¨çš„å±‚çº§ã€‚å¦‚æœä¸Šä¸€å±‚<code>Logger</code>å®ä¾‹ä¸å­˜åœ¨ï¼Œä¼šç”¨ä¸€ä¸ª<code>PlaceHolder</code>å®ä¾‹ä»£æ›¿ï¼Œå¦åˆ™ä¼šç›´æ¥èµ‹å€¼<code>rv</code>ï¼Œ<code>break</code>ï¼Œç„¶åè®¾ç½®<code>parent</code>ã€‚</p>
<p>å¦‚æœ<code>Logger</code>åå­—å·²ç»æ³¨å†Œï¼Œä¸”æ³¨å†Œçš„åªæ˜¯ä¸€ä¸ª<code>PlaceHolder</code>å®ä¾‹çš„è¯ï¼Œè¿˜è¦é¢å¤–é€šè¿‡<code>_fixupChildren</code>æ–¹æ³•ï¼Œå°†å·²å®šä¹‰çš„å­<code>Logger</code>ç»‘å®šåˆ°è‡ªå·±èº«ä¸Šã€‚</p>
<p>é€šè¿‡è¿™æ ·çš„å®ç°ï¼Œå°±å®ç°äº†<code>Logger</code>å®ä¾‹çš„ç®¡ç†ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ—¥å¿—</tag>
        <tag>logging</tag>
        <tag>Logger</tag>
        <tag>Manager</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ç”¨è¡Œä¸ºæ ‘åšæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•çš„è¯¯åŒº</title>
    <url>/2022/04/03/testlife/btree_autotest_talk/</url>
    <content><![CDATA[<p>åœ¨æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•é¢†åŸŸï¼Œè¡Œä¸ºæ ‘ç”±äºå…¶å¼ºå¤§çš„æè¿°ç©å®¶ï¼ˆAgentï¼‰è¡Œä¸ºé€»è¾‘çš„åŠŸèƒ½ï¼Œåœ¨å¾ˆå¤šåœºæ™¯çš„è‡ªåŠ¨åŒ–æµ‹è¯•éƒ½èƒ½å¾—åˆ°åº”ç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœå¯¹è¡Œä¸ºæ ‘çš„ä½œç”¨è®¤è¯†ä¸è¶³ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´æ•´ä¸€ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•é¡¹ç›®å‡ºç°éš¾ä»¥ç»´æŠ¤çš„çª˜å¢ƒã€‚å› æ­¤ï¼Œè¿™ç¯‡æ–‡ç« è°ˆä¸€è°ˆåœ¨æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•é‡Œï¼Œç”¨è¡Œä¸ºæ ‘åšæµ‹è¯•çš„ä¸€äº›è¯¯åŒºã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆç¬¬ä¸€ç‚¹æ˜¯ï¼Œå¾ˆå¤šè¡Œä¸ºæ ‘çš„æ¡†æ¶/GUIç³»ç»Ÿæä¾›äº†å¼ºå¤§çš„å¯è§†åŒ–ç¼–ç¨‹çš„èƒ½åŠ›ã€‚ä½†æ˜¯å¦‚æœçœŸè¦ç”¨è¡Œä¸ºæ ‘æ¡†æ¶å»å‡ ä¹å®Œå…¨æ›¿ä»£çº¯ä»£ç ç¼–ç¨‹ï¼Œåšå¾ˆç»†è‡´çš„çš„é€»è¾‘æ§åˆ¶ï¼Œè¿™ä¸ªæƒ³æ³•æ˜¯æœ‰è¯¯çš„ã€‚</p>
<p>è¡Œä¸ºæ ‘æœ¬èº«æœ€æ–¹ä¾¿çš„åœ°æ–¹æ˜¯èƒ½å¤Ÿé€šè¿‡å¯è§†åŒ–ç•Œé¢çš„æ–¹å¼å»ç»´æŠ¤ç©å®¶è¡Œä¸ºï¼ˆä»¥ä¸šåŠ¡é€»è¾‘çš„æ‹†åˆ†æŠ½è±¡ä¸ºåŸºå‡†ï¼‰ï¼Œè€Œä¸æ˜¯ç»´æŠ¤ç¨‹åºè¡Œä¸ºï¼ˆä»¥å‡½æ•°/å˜é‡ä¸ºåŸºå‡†ï¼‰ã€‚é’ˆå¯¹å‰è€…çš„åœºæ™¯ï¼Œå¦‚æœæ²¡æœ‰è¡Œä¸ºæ ‘ï¼Œä¸€èˆ¬çš„è§£å†³æ–¹æ³•æ˜¯å…ˆç”¨å…¶å®ƒæµç¨‹å›¾å·¥å…·ï¼ˆæˆ–è€…æ‰‹è®°ï¼‰æ‹ä¸€ä¸‹æµç¨‹ï¼Œç„¶åå†é€šè¿‡çº¯ä»£ç çš„æ–¹å¼è®¾è®¡æ¥å£æµç¨‹ï¼Œåšæµç¨‹å›¾çš„å¤åˆ»ï¼Œè€Œæœ‰äº†è¡Œä¸ºæ ‘å·¥å…·ï¼Œå°±å¯ä»¥åœ¨å®ç°æµç¨‹å›¾ç¼–è¾‘çš„åŸºç¡€ä¸Šï¼Œå®ç°è‡ªåŠ¨ç”ŸæˆåŸºç¡€ä»£ç ï¼Œè¿™æ ·ä¼šæå¤§æå‡ä¸šåŠ¡å®ç°çš„æ•ˆç‡ã€‚è€Œé’ˆå¯¹åè€…çš„åœºæ™¯ï¼Œå¯è§†åŒ–ç¼–ç¨‹ç›¸å¯¹äºçº¯ä»£ç å…¶å®å¯ç»´æŠ¤æ€§æ›´å·®ï¼Œç¼–ç¨‹æ•ˆç‡æ›´ä½â€”â€”åœ¨å¯¹åº•å±‚apiéƒ½å¾ˆç†Ÿæ‚‰çš„åŸºç¡€ä¸Šï¼Œçº¯æ‰“å­—è‚¯å®šæ¯”æ‹–æ‹½ä¸€å †æ§ä»¶è¿˜å¡«ä¸€å †formæ¥çš„å¿«ã€‚</p>
<p>å†è€…ç¬¬äºŒç‚¹æ˜¯ï¼Œè¡Œä¸ºæ ‘çš„æ»¥ç”¨é—®é¢˜ï¼Œä¸æ˜¯æ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•åœºæ™¯éƒ½å¯ä»¥ç”¨åˆ°è¡Œä¸ºæ ‘ï¼Œè€Œæ˜¯è¦é’ˆå¯¹æˆ‘ä»¬è‡ªåŠ¨åŒ–æµ‹è¯•çš„åœºæ™¯ï¼Œåšä¸¥æ ¼çš„ç³»ç»Ÿåˆ†æï¼Œå¦åˆ™å°±ä¼šé™·å…¥ä¸ºæŠ€æœ¯è€ŒæŠ€æœ¯çš„åœ°ç‹±ã€‚</p>
<p>è¿™æ¶‰åŠåˆ°è‡ªåŠ¨åŒ–æµ‹è¯•çš„æœ¬è´¨ï¼Œè‡ªåŠ¨åŒ–æ˜¯æ‰‹æ®µï¼Œæµ‹è¯•æ˜¯ç›®æ ‡ã€‚ä¸¥æ ¼ä¸Šæ¥è®²ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æ‰‹æ®µä¸ä»…å¯ä»¥å®ç°åŠŸèƒ½æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥å®ç°æ•°æ®æ”¶é›†çš„éœ€æ±‚ï¼Œç»“åˆå…¶å®ƒå·¥å…·ï¼Œå»è¾…åŠ©æˆ‘ä»¬å®Œæ•´çš„æµ‹è¯•å·¥ä½œã€‚å› æ­¤æˆ‘ä»¬åœ¨åšè‡ªåŠ¨åŒ–çš„æ—¶å€™è¿˜æ˜¯è¦é¦–å…ˆå…³æ³¨æˆ‘ä»¬çš„æµ‹è¯•ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œç„¶åæ‰æ˜¯é€‚ä¸é€‚åˆç”¨è¡Œä¸ºæ ‘çš„é—®é¢˜ã€‚å¯¹äºå¤§éƒ¨åˆ†çš„è‡ªåŠ¨åŒ–å·¥ä½œï¼Œå¼•å…¥è¡Œä¸ºæ ‘æ¡†æ¶ä¼šå¸¦æ¥æ›´å¤šæŠ€æœ¯ä¸Šçš„å¤æ‚åº¦ä»¥åŠå­¦ä¹ ä¸Šçš„éš¾åº¦ï¼Œå…¶å®æ˜¯ä¸é€‚åˆçš„ã€‚åªæœ‰ä¸€äº›éœ€è¦ç©å®¶ï¼ˆä¸æ˜¯ç¨‹åºï¼‰åšå¤§é‡è¡Œä¸ºå†³ç­–çš„æµ‹è¯•åœºæ™¯ï¼Œç”¨è¡Œä¸ºæ ‘æ‰æ¯”è¾ƒé€‚åˆï¼Œæ¯”å¦‚æ¯”å¦‚è¯´åšä»»åŠ¡ã€å‰¯æœ¬çš„è·‘æµ‹ï¼Œæˆ–æ˜¯PVPçš„AIå®ç°ã€‚</p>
<p>æœ€åä¸€ç‚¹æ˜¯ï¼Œåœ¨ä¸€ä¸ªæ¶‰åŠåˆ°è¡Œä¸ºæ ‘çš„è‡ªåŠ¨åŒ–æµ‹è¯•è®¾è®¡å½“ä¸­ï¼Œä¸åº”å½“å°†è¡Œä¸ºæ ‘çœ‹ä½œä¸ºæ•´ä¸ªæŠ€æœ¯è®¾è®¡çš„æ ¸å¿ƒã€‚</p>
<p>è¿™å¯ä»¥ç±»æ¯”å»åšä¸€ä¸ªpyqtä¸ºåŸºç¡€çš„GUIè½¯ä»¶ï¼Œè¿™ä¸ªè½¯ä»¶çš„æ ¸å¿ƒåº”è¯¥æ˜¯å…¶å†…éƒ¨çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”åœ¨è®¾è®¡ä¸Šä¹Ÿåº”å½“å¯ä»¥è„±ç¦»GUIå»è¿è¡Œï¼Œè€Œpyqt-designeråªèƒ½ä½œä¸ºå¿«é€Ÿè®¾è®¡åŸå‹ï¼Œç”ŸæˆåŸºç¡€ä»£ç çš„æ‰‹æ®µã€‚è¡Œä¸ºæ ‘ä¹Ÿæ˜¯ä¹Ÿæ˜¯è¿™æ ·çš„ä½œç”¨ï¼Œå®ƒèƒ½è¾¾åˆ°çš„ç›®æ ‡æ˜¯å¿«é€Ÿç”Ÿæˆè¡Œä¸ºå†³ç­–çš„æè¿°ä»¥åŠå„ä¸ªè¡Œä¸ºçš„å®šä¹‰ï¼Œè¡Œä¸ºçš„å®ç°å´æ˜¯éœ€è¦ç”¨æˆ·å»è¯¦ç»†ç¼–å†™çš„ï¼Œè€Œæ°å·§æ­£æ˜¯è¡Œä¸ºå®ç°çš„å†…å®¹æ‰æœ‰æ¯”è¾ƒå¤§çš„ç»´æŠ¤é‡ã€‚å› æ­¤æˆ‘ä»¬åœ¨åšæ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ—¶ï¼Œå»ºè®®æ˜¯é€šè¿‡å¯¹ç©å®¶åœ¨æ¸¸æˆé‡Œä¸åŒçš„è¡Œä¸ºè¿›è¡Œå°è£…æŠ½è±¡ï¼Œå½¢æˆâ€œè¡Œä¸ºåº“â€ï¼Œç„¶åå†å»å¥—ç”¨åˆ°ä¸åŒåœºæ™¯çš„è¡Œä¸ºæ ‘è®¾è®¡ä¸Šã€‚æŠŠâ€œè¡Œä¸ºåº“â€åšå¥½ï¼Œæ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•å¾—ä»¥å¤§é‡åº”ç”¨çš„å…³é”®ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è¡Œä¸ºæ ‘</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>æµ‹è¯•</tag>
        <tag>å¯è§†åŒ–ç¼–ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬ä¸‰ç« -GCã€‘2ã€pythonçš„GCæµç¨‹</title>
    <url>/2022/03/19/hardpython/3_gc_2/</url>
    <content><![CDATA[<p>é™¤äº†é€šè¿‡å¼•ç”¨è®¡æ•°ç›´æ¥é”€æ¯å¯¹è±¡ä¹‹å¤–ï¼Œ<code>python</code>è¿˜æ˜¯æ‹¥æœ‰å†…åœ¨<code>GC</code>æœºåˆ¶çš„ï¼Œå¹¶ä¸”ä¹Ÿæœ‰å®Œæ•´çš„ä¸€å¥—æµç¨‹ã€‚</p>
<p>å¦‚æœåªæœ‰é€šè¿‡å¼•ç”¨è®¡æ•°é”€æ¯å¯¹è±¡è¿™ç§æœºåˆ¶ï¼Œé‚£ä¹ˆéšä¾¿æ„é€ ä¸€ä¸ªå¾ªç¯å¼•ç”¨å°±ä¼šé€ æˆå†…å­˜æ³„æ¼ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_dump_gc</span><span class="params">()</span>:</span></span><br><span class="line">    gcobjs = gc.get_objects()</span><br><span class="line">    pprint.pprint(len(gcobjs))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_circle</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_test_internal</span><span class="params">()</span>:</span></span><br><span class="line">        _dump_gc()</span><br><span class="line">        a = []</span><br><span class="line">        b = []</span><br><span class="line">        a.append(b)</span><br><span class="line">        b.append(a)</span><br><span class="line">        _dump_gc()</span><br><span class="line"></span><br><span class="line">    _test_internal()</span><br><span class="line">    _dump_gc()</span><br><span class="line">    gc.collect()</span><br><span class="line">    _dump_gc()</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">13707</span><br><span class="line">13709</span><br><span class="line">13709</span><br><span class="line">13370</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜¾ç„¶ï¼Œå½“é€€å‡º<code>_test_internal</code>ä½œç”¨åŸŸæ—¶ï¼Œ<code>gc</code>å¯¹è±¡çš„æ•°é‡æ²¡æœ‰å˜åŒ–ï¼Œè¿™å°±è¯´æ˜åœ¨<code>_test_internal</code>é‡Œåˆ›å»ºçš„<code>aã€b</code>ä¸¤ä¸ªå¯¹è±¡æ²¡æœ‰è¢«ç«‹å³é‡Šæ”¾æ‰ã€‚å¦‚æœæ³¨é‡Šæ‰ä¸¤ä¸ª<code>append</code>è¡Œï¼Œå°±èƒ½çœ‹åˆ°æ‰“å°ç»“æœç¬¬ä¸‰è¡Œå˜æˆäº†<code>13707</code>ï¼Œè¯´æ˜<code>aã€b</code>åœ¨é€€å‡ºå‡½æ•°æ—¶å°±è¢«é”€æ¯äº†ã€‚</p>
<p>æ‰€ä»¥é¦–å…ˆï¼Œæˆ‘ä»¬ä»å¾ªç¯å¼•ç”¨å…¥æ‰‹ï¼Œæ¥ç ”ç©¶ä¸€ä¸‹<code>python</code>çš„<code>gc</code>æœºåˆ¶ï¼ˆå¥½å·§ä¸å·§çš„æ˜¯ï¼Œ<code>python</code>çš„<code>gc</code>ä¹Ÿæ˜¯ä¸“é—¨ä¸ºå¾ªç¯å¼•ç”¨è€Œè®¾ç½®çš„ï¼‰ã€‚è°ƒç”¨<code>gc.collect</code>è§¦å‘<code>gc</code>ä¹‹åï¼Œä¼šè·‘åˆ°<code>gc_collect_main</code>è§¦å‘å®Œæ•´çš„<code>gc</code>æµç¨‹ã€‚<code>gc_collect_main</code>æ˜¯<code>python</code>æ•´ä¸ª<code>gc</code>æµç¨‹çš„ä¸»å…¥å£ï¼Œæˆ‘ä»¬æ¥çœ‹å…¶ä¸­çš„ä»£ç ï¼š</p>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// gcmodule.c</span></span><br><span class="line"><span class="keyword">static</span> Py_ssize_t</span><br><span class="line">gc_collect_main(PyThreadState *tstate, <span class="keyword">int</span> generation,</span><br><span class="line">                Py_ssize_t *n_collected, Py_ssize_t *n_uncollectable,</span><br><span class="line">                <span class="keyword">int</span> nofail)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    Py_ssize_t m = <span class="number">0</span>; <span class="comment">/* # objects collected */</span></span><br><span class="line">    Py_ssize_t n = <span class="number">0</span>; <span class="comment">/* # unreachable objects that couldn't be collected */</span></span><br><span class="line">    PyGC_Head *young; <span class="comment">/* the generation we are examining */</span></span><br><span class="line">    PyGC_Head *old; <span class="comment">/* next older generation */</span></span><br><span class="line">    PyGC_Head unreachable; <span class="comment">/* non-problematic unreachable trash */</span></span><br><span class="line">    PyGC_Head finalizers;  <span class="comment">/* objects with, &amp; reachable from, __del__ */</span></span><br><span class="line">    PyGC_Head *gc;</span><br><span class="line">    _PyTime_t t1 = <span class="number">0</span>;   <span class="comment">/* initialize to prevent a compiler warning */</span></span><br><span class="line">    GCState *gcstate = &amp;tstate-&gt;interp-&gt;gc;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* update collection and allocation counters */</span></span><br><span class="line">    <span class="keyword">if</span> (generation+<span class="number">1</span> &lt; NUM_GENERATIONS)</span><br><span class="line">        gcstate-&gt;generations[generation+<span class="number">1</span>].count += <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= generation; i++)</span><br><span class="line">        gcstate-&gt;generations[i].count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* merge younger generations with one we are currently collecting */</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; generation; i++) &#123;</span><br><span class="line">        gc_list_merge(GEN_HEAD(gcstate, i), GEN_HEAD(gcstate, generation));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* handy references */</span></span><br><span class="line">    young = GEN_HEAD(gcstate, generation);</span><br><span class="line">    <span class="keyword">if</span> (generation &lt; NUM_GENERATIONS<span class="number">-1</span>)</span><br><span class="line">        old = GEN_HEAD(gcstate, generation+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        old = young;</span><br><span class="line"></span><br><span class="line">    deduce_unreachable(young, &amp;unreachable);</span><br><span class="line"></span><br><span class="line">    untrack_tuples(young);</span><br><span class="line">    <span class="comment">/* Move reachable objects to next generation. */</span></span><br><span class="line">    <span class="keyword">if</span> (young != old) &#123;</span><br><span class="line">        <span class="keyword">if</span> (generation == NUM_GENERATIONS - <span class="number">2</span>) &#123;</span><br><span class="line">            gcstate-&gt;long_lived_pending += gc_list_size(young);</span><br><span class="line">        &#125;</span><br><span class="line">        gc_list_merge(young, old);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* We only un-track dicts in full collections, to avoid quadratic</span></span><br><span class="line"><span class="comment">           dict build-up. See issue #14775. */</span></span><br><span class="line">        untrack_dicts(young);</span><br><span class="line">        gcstate-&gt;long_lived_pending = <span class="number">0</span>;</span><br><span class="line">        gcstate-&gt;long_lived_total = gc_list_size(young);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* All objects in unreachable are trash, but objects reachable from</span></span><br><span class="line"><span class="comment">     * legacy finalizers (e.g. tp_del) can't safely be deleted.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    gc_list_init(&amp;finalizers);</span><br><span class="line">    <span class="comment">// NEXT_MASK_UNREACHABLE is cleared here.</span></span><br><span class="line">    <span class="comment">// After move_legacy_finalizers(), unreachable is normal list.</span></span><br><span class="line">    move_legacy_finalizers(&amp;unreachable, &amp;finalizers);</span><br><span class="line">    <span class="comment">/* finalizers contains the unreachable objects with a legacy finalizer;</span></span><br><span class="line"><span class="comment">     * unreachable objects reachable *from* those are also uncollectable,</span></span><br><span class="line"><span class="comment">     * and we move those into the finalizers list too.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    move_legacy_finalizer_reachable(&amp;finalizers);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Clear weakrefs and invoke callbacks as necessary. */</span></span><br><span class="line">    m += handle_weakrefs(&amp;unreachable, old);</span><br><span class="line"></span><br><span class="line">    validate_list(old, collecting_clear_unreachable_clear);</span><br><span class="line">    validate_list(&amp;unreachable, collecting_set_unreachable_clear);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Call tp_finalize on objects which have one. */</span></span><br><span class="line">    finalize_garbage(tstate, &amp;unreachable);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Handle any objects that may have resurrected after the call</span></span><br><span class="line"><span class="comment">     * to 'finalize_garbage' and continue the collection with the</span></span><br><span class="line"><span class="comment">     * objects that are still unreachable */</span></span><br><span class="line">    PyGC_Head final_unreachable;</span><br><span class="line">    handle_resurrected_objects(&amp;unreachable, &amp;final_unreachable, old);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Call tp_clear on objects in the final_unreachable set.  This will cause</span></span><br><span class="line"><span class="comment">    * the reference cycles to be broken.  It may also cause some objects</span></span><br><span class="line"><span class="comment">    * in finalizers to be freed.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    m += gc_list_size(&amp;final_unreachable);</span><br><span class="line">    delete_garbage(tstate, gcstate, &amp;final_unreachable, old);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Append instances in the uncollectable set to a Python</span></span><br><span class="line"><span class="comment">     * reachable list of garbage.  The programmer has to deal with</span></span><br><span class="line"><span class="comment">     * this if they insist on creating this type of structure.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    handle_legacy_finalizers(tstate, gcstate, &amp;finalizers, old);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Clear free list only during the collection of the highest</span></span><br><span class="line"><span class="comment">     * generation */</span></span><br><span class="line">    <span class="keyword">if</span> (generation == NUM_GENERATIONS<span class="number">-1</span>) &#123;</span><br><span class="line">        clear_freelists(tstate-&gt;interp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_PyErr_Occurred(tstate)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nofail) &#123;</span><br><span class="line">            _PyErr_Clear(tstate);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            _PyErr_WriteUnraisableMsg(<span class="string">"in garbage collection"</span>, <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Update stats */</span></span><br><span class="line">    <span class="keyword">if</span> (n_collected) &#123;</span><br><span class="line">        *n_collected = m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n_uncollectable) &#123;</span><br><span class="line">        *n_uncollectable = n;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">gc_generation_stats</span> *<span class="title">stats</span> = &amp;<span class="title">gcstate</span>-&gt;<span class="title">generation_stats</span>[<span class="title">generation</span>];</span></span><br><span class="line">    stats-&gt;collections++;</span><br><span class="line">    stats-&gt;collected += m;</span><br><span class="line">    stats-&gt;uncollectable += n;</span><br><span class="line"></span><br><span class="line">    assert(!_PyErr_Occurred(tstate));</span><br><span class="line">    <span class="keyword">return</span> n + m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>gc_collect_main</code>æ€»å…±æ‰§è¡Œäº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥è¯´ã€‚</p>
<p>é¦–å…ˆæ›´æ–°æŒ‡å®š<code>generation</code>åçš„åˆ†é…è®¡æ•°ï¼ˆ+1ï¼‰ï¼ŒæŒ‡å®š<code>generation</code>åŠä»¥ä¸‹çš„å…¨éƒ¨å½’0ã€‚è¿™æ˜¯å› ä¸º<code>python</code>ä¹Ÿè‡ªå¸¦äº†åˆ†ä»£å›æ”¶æœºåˆ¶ï¼Œ<code>gc.collect</code>å…¥å‚æ˜¯<code>generation</code>ï¼ŒæŒ‡å®š<code>generation</code>ä»¥ä¸‹çš„å…¨éƒ¨éƒ½ä¼šè¢«<code>gc</code>æ‰ã€‚</p>
<p><code>python</code>çš„<code>gc</code>åˆ†ä»£æ€»å…±æ˜¯3ä»£ï¼Œè€Œ<code>gc.collect</code>é»˜è®¤å€¼æ˜¯2ï¼Œä¹Ÿè¡¨ç¤ºæœ€é«˜ä¸€ä»£ï¼Œé€šä¿—ç‚¹è®²å°±æ˜¯<code>Full GC</code>ã€‚æ¯ä¸€ä»£çš„å¯¹è±¡æ•°ç›®å¦‚æœè¶…è¿‡ç‰¹å®šå€¼ï¼Œå°±ä¼šè§¦å‘è‡ªåŠ¨gcã€‚</p>
<p>ç„¶ååšçš„ä¸€ä¸ªäº‹æƒ…æ˜¯ï¼Œå°†æŒ‡å®š<code>generation</code>å‰ä»£çš„å’Œå½“ä»£çš„æ‰€æœ‰<code>GC_Head</code>å…¨éƒ¨ä¸²åˆ°ä¸€ä¸ªé“¾è¡¨ä¸Šï¼Œè¿™æ ·åªéœ€è¦å¤„ç†è¿™ä¸€ä¸ªé“¾è¡¨å°±èƒ½å›æ”¶æ‰€æœ‰ä¸œè¥¿ã€‚æ¯ä¸ª<code>python</code>å¯¹è±¡éƒ½ä¼šè‡ªå¸¦<code>GC_Head</code>ï¼Œä¸²åˆ°ç‰¹å®š<code>genenration</code>çš„é“¾è¡¨ä¸­ï¼Œç”¨äºåœ¨GCæ—¶å€™è¢«è¯†åˆ«åˆ°ã€‚</p>
<p>ä¹‹ååšçš„å¾ˆå…³é”®çš„ä¸€æ­¥æ˜¯<code>deduce_unreachable</code>ï¼Œå…¶ä½œç”¨æ˜¯æ¨¡æ‹Ÿå»å¼•ç”¨çš„æµç¨‹ï¼Œæ¢æµ‹æ— æ³•ä»<code>gc</code>æ ¹å¯¹è±¡ç›´æ¥è¾¾åˆ°çš„å¯¹è±¡ï¼Œæ”¾åˆ°å•ç‹¬çš„<code>unreachable</code>åˆ—è¡¨ä¸­ã€‚å¹¶ä¸”åœ¨è¿™ä¸€æ­¥ä¼šé€šè¿‡éå†å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨å…³ç³»å¹¶-1å¼•ç”¨çš„æ–¹å¼ï¼Œä»è€Œå°†å¯¹è±¡ä¹‹é—´çš„å¾ªç¯å¼•ç”¨æš‚æ—¶å½’é›¶ã€‚<code>deduce_unreachable</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">deduce_unreachable(PyGC_Head *base, PyGC_Head *unreachable) &#123;</span><br><span class="line">    validate_list(base, collecting_clear_unreachable_clear);</span><br><span class="line">    update_refs(base);  <span class="comment">// gc_prev is used for gc_refs</span></span><br><span class="line">    subtract_refs(base);</span><br><span class="line">    gc_list_init(unreachable);</span><br><span class="line">    move_unreachable(base, unreachable);  <span class="comment">// gc_prev is pointer again</span></span><br><span class="line">    validate_list(base, collecting_clear_unreachable_clear);</span><br><span class="line">    validate_list(unreachable, collecting_set_unreachable_set);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¥½æ¯”ä¸€ä¸ªåœºæ™¯ï¼šæ€»å…±æœ‰4ä¸ª<code>list</code>å¯¹è±¡ï¼Œåˆ†åˆ«ä¸º<code>l1</code>åˆ°<code>l4</code>ï¼Œå…¶ä¸­<code>l1</code>ã€<code>l2</code>å¾ªç¯å¼•ç”¨ï¼Œ<code>l3</code>ã€<code>l4</code>å¾ªç¯å¼•ç”¨ï¼Œ<code>l1</code>å’Œ<code>l2</code>ä¸<code>l3</code>è·Ÿ<code>l4</code>ä¹‹é—´æ²¡æœ‰å…³è”ã€‚ä¹‹åè‹¥å†æœ‰ä¸€ä¸ªå˜é‡<code>a</code>å¼•ç”¨äº†<code>l1</code>ï¼Œé‚£ä¹ˆç»è¿‡<code>deduce_unreachable</code>ä¹‹åï¼Œä¼šå‘ˆç°å¦‚ä¸‹çš„ç»“æœï¼š</p>
<ul>
<li>åœ¨<code>subtract_refs</code>æ­¥éª¤ä¸­ï¼Œ<code>l1</code>çš„å¼•ç”¨æ•°ç›®å˜æˆ1ï¼Œ<code>l2</code>ã€<code>l3</code>ã€<code>l4</code>å˜æˆ0</li>
<li>åœ¨<code>move_unreachable</code>æ­¥éª¤ä¸­ï¼Œå‘ç°<code>l1</code>å¼•ç”¨æ•°ç›®ä¸º1ï¼Œå³å°†<code>l1</code>ä»¥åŠå…¶å¼•ç”¨åˆ°çš„æ‰€æœ‰å˜é‡æ ‡è®°ä¸º<code>reachable</code><ul>
<li>æœ€åå‰©ä¸‹æ¥å¼•ç”¨æ•°ä»ç„¶ä¸º0çš„<code>l3</code>ã€<code>l4</code>ï¼Œæ”¾åˆ°<code>unreachable</code>é“¾è¡¨ä¸­</li>
</ul>
</li>
</ul>
<p>ç»å†<code>deduce_unreachable</code>æ­¥éª¤å­˜æ´»ä¸‹æ¥çš„<code>reachable</code>å¯¹è±¡ï¼Œä¼šç›´æ¥è¢«ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª<code>generation</code>ã€‚æ¥ä¸‹æ¥åªéœ€è¦è€ƒè™‘å¯¹<code>unreachable</code>çš„å¯¹è±¡è¿›è¡Œé”€æ¯äº†ã€‚</p>
<p>æ¥ä¸‹æ¥çš„æ“ä½œæ˜¯å°†<code>unreachable</code>é“¾è¡¨ä¸­ï¼Œä¼šå¤„ç†ä¸€äº›<code>C</code>å±‚ç±»å‹å®šä¹‰é‡Œå«æœ‰æ—§ç‰ˆ<code>tc_del</code>æ–¹æ³•çš„ç±»å‹çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åŠå…¶ç›´æ¥æˆ–é—´æ¥å¼•ç”¨çš„å¯¹è±¡å…¨éƒ¨éƒ½ä¼šè¢«ç§»åŠ¨åˆ°å•ç‹¬çš„<code>finalizers</code>é“¾è¡¨ä¸­ï¼Œè€Œè¿™ä¸ªé“¾è¡¨ä¸­çš„å¯¹è±¡ä¼šè¢«å•ç‹¬ç»´æŠ¤ï¼Œæ— æ³•è¢«å›æ”¶ã€‚</p>
<p>åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œå¦‚æœ<code>python</code>ç±»å‹å®šä¹‰äº†<code>__del__</code>æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™äº›ç±»å‹çš„å¯¹è±¡å°±ä¼šç§»åŠ¨åˆ°<code>finalizers</code>é“¾è¡¨ä¸­ã€‚ç›´åˆ°<span class="exturl" data-url="aHR0cHM6Ly93d3cucHl0aG9uLm9yZy9kZXYvcGVwcy9wZXAtMDQ0Mi8=" title="https://www.python.org/dev/peps/pep-0442/">PEP442<i class="fa fa-external-link"></i></span>ä¹‹åï¼Œ<code>__del__</code>æ–¹æ³•å°±å¯¹åº”äº†<code>C</code>å±‚ç±»å‹å®šä¹‰çš„å¦å¤–ä¸€ä¸ª<code>tc_finaliz</code>eæ–¹æ³•äº†ï¼Œå› æ­¤åŒ…å«<code>__del__</code>æ–¹æ³•çš„ç±»å‹çš„å¯¹è±¡ï¼Œä¸ä¸€å®šä¼šç§»åŠ¨åˆ°<code>finalizers</code>é“¾è¡¨ä¸­ï¼Œè€Œæ˜¯ä¼šåœ¨åé¢çš„æ­¥éª¤ä¸­è§¦å‘<code>tc_finalize</code>é€»è¾‘ã€‚</p>
<p>å†ä¹‹åï¼Œé’ˆå¯¹å‰©ä¸‹çš„<code>unreachable</code>å¯¹è±¡ï¼Œé€šè¿‡<code>handle_weakrefs</code>æ–¹æ³•è§£é™¤å…¶å®ƒå¯¹è±¡å¯¹å…¶çš„å¼±å¼•ç”¨ã€‚ç„¶åè°ƒç”¨<code>finalize_garbage</code>é”€æ¯<code>unreachable</code>å¯¹è±¡ã€‚<code>finalize_garbage</code>çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">finalize_garbage(PyThreadState *tstate, PyGC_Head *collectable)</span><br><span class="line">&#123;</span><br><span class="line">    destructor finalize;</span><br><span class="line">    PyGC_Head seen;</span><br><span class="line">    gc_list_init(&amp;seen);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!gc_list_is_empty(collectable)) &#123;</span><br><span class="line">        PyGC_Head *gc = GC_NEXT(collectable);</span><br><span class="line">        PyObject *op = FROM_GC(gc);</span><br><span class="line">        gc_list_move(gc, &amp;seen);</span><br><span class="line">        <span class="keyword">if</span> (!_PyGCHead_FINALIZED(gc) &amp;&amp;</span><br><span class="line">                (finalize = Py_TYPE(op)-&gt;tp_finalize) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            _PyGCHead_SET_FINALIZED(gc);</span><br><span class="line">            Py_INCREF(op);</span><br><span class="line">            finalize(op);</span><br><span class="line">            assert(!_PyErr_Occurred(tstate));</span><br><span class="line">            Py_DECREF(op);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    gc_list_merge(&amp;seen, collectable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>finalize_garbage</code>å®è´¨æ˜¯è°ƒç”¨å¯¹è±¡ç±»å‹å®šä¹‰çš„<code>tp_finalize</code>æ–¹æ³•ææ„å¯¹åº”çš„å¯¹è±¡ï¼Œå¹¶å‡å°‘å…¶å¼•ç”¨ä¸º0ä»è€Œé‡Šæ”¾å¯¹è±¡å†…å­˜ã€‚ç”±äºæŸäº›å¯¹è±¡ç±»å‹å¯èƒ½æ²¡æœ‰é»˜è®¤çš„<code>tp_finalize</code>æ–¹æ³•ï¼Œå› æ­¤ç»è¿‡è¿™ä¸€æ­¥éª¤ä¹‹åï¼Œè¿˜ä¼šå­˜ç•™ä¸€äº›æœªé”€æ¯çš„å¯¹è±¡ã€‚</p>
<p>é’ˆå¯¹æœªé”€æ¯çš„å¯¹è±¡ï¼Œä¹‹åä¼šé€šè¿‡<code>handle_resurrected_objects</code>è¿›è¡Œå¤„ç†ã€‚åœ¨<code>handle_resurrected_objects</code>ä¸­ä¼šå†ä¸€æ¬¡æ‰§è¡Œ<code>deduce_unreachable</code>æ¨¡æ‹Ÿå»å¼•ç”¨æ“ä½œï¼Œå­˜æ´»ä¸‹æ¥çš„<code>unreachable</code>å¯¹è±¡å°±è¢«ç§»åˆ°ä¸‹ä¸€ä¸ª<code>generation</code>ï¼Œè€Œå‰©ä¸‹çš„å¯¹è±¡å°±ä¼šè¢«ç§»åŠ¨åˆ°<code>final_unreachable</code>é“¾è¡¨è¿›è¡Œåé¢çš„é”€æ¯æ“ä½œã€‚</p>
<p>é€šè¿‡<code>delete_garbage</code>æ–¹æ³•ä¼šå¯¹<code>final_unreachable</code>é“¾è¡¨çš„å¯¹è±¡è¿›è¡Œé”€æ¯ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">delete_garbage(PyThreadState *tstate, GCState *gcstate,</span><br><span class="line">               PyGC_Head *collectable, PyGC_Head *old)</span><br><span class="line">&#123;</span><br><span class="line">    assert(!_PyErr_Occurred(tstate));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!gc_list_is_empty(collectable)) &#123;</span><br><span class="line">        PyGC_Head *gc = GC_NEXT(collectable);</span><br><span class="line">        PyObject *op = FROM_GC(gc);</span><br><span class="line"></span><br><span class="line">        _PyObject_ASSERT_WITH_MSG(op, Py_REFCNT(op) &gt; <span class="number">0</span>,</span><br><span class="line">                                  <span class="string">"refcount is too small"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (gcstate-&gt;debug &amp; DEBUG_SAVEALL) &#123;</span><br><span class="line">            assert(gcstate-&gt;garbage != <span class="literal">NULL</span>);</span><br><span class="line">            <span class="keyword">if</span> (PyList_Append(gcstate-&gt;garbage, op) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                _PyErr_Clear(tstate);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            inquiry clear;</span><br><span class="line">            <span class="keyword">if</span> ((clear = Py_TYPE(op)-&gt;tp_clear) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">                Py_INCREF(op);</span><br><span class="line">                (<span class="keyword">void</span>) clear(op);</span><br><span class="line">                <span class="keyword">if</span> (_PyErr_Occurred(tstate)) &#123;</span><br><span class="line">                    _PyErr_WriteUnraisableMsg(<span class="string">"in tp_clear of"</span>,</span><br><span class="line">                                              (PyObject*)Py_TYPE(op));</span><br><span class="line">                &#125;</span><br><span class="line">                Py_DECREF(op);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (GC_NEXT(collectable) == gc) &#123;</span><br><span class="line">            <span class="comment">/* object is still alive, move it, it may die later */</span></span><br><span class="line">            gc_clear_collecting(gc);</span><br><span class="line">            gc_list_move(gc, old);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>delete_garbage</code>ä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡éƒ½ä¼šè°ƒç”¨å…¶ç±»å‹çš„<code>tp_clear</code>æ–¹æ³•ï¼Œå‡å°‘å¯¹è±¡å¼•ç”¨æ•°ç›®ä¸º0ï¼Œè§¦å‘å¯¹è±¡çš„é”€æ¯ã€‚</p>
<p>åœ¨<code>delete_garbage</code>ä¹‹åï¼Œç»ˆäºå°±ä¼šå¯¹å…ˆå‰å•ç‹¬æ‹å‡ºæ¥çš„<code>finalizers</code>é“¾è¡¨è¿›è¡Œå¤„ç†ã€‚<code>finalizers</code>é“¾è¡¨ä¸­æ‰€æœ‰çš„å†…å®¹éƒ½ä¼šé€šè¿‡<code>handle_legacy_finalizers</code>æ–¹æ³•è¢«ç§»åŠ¨åˆ°å½“å‰<code>gcstate</code>çš„<code>garbage</code>é“¾è¡¨ä¸­å•ç‹¬ç»´æŠ¤ï¼Œä¸ä¼šè¢«é”€æ¯ã€‚</p>
<p>ä¹‹åè¿›è¡Œä¸€äº›æ•°æ®æ¸…ç†å’Œæ•°æ®ç»Ÿè®¡é€»è¾‘ï¼Œæ•´ä¸ª<code>gc</code>æµç¨‹å°±å®Œæˆäº†ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>gc</tag>
        <tag>åˆ†ä»£å›æ”¶</tag>
        <tag>å¾ªç¯å¼•ç”¨</tag>
        <tag>åƒåœ¾å›æ”¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬ä¸‰ç« -GCã€‘1ã€å¼•ç”¨è®¡æ•°ä¸å†…å­˜é‡Šæ”¾æœºåˆ¶</title>
    <url>/2022/03/12/hardpython/3_gc_1/</url>
    <content><![CDATA[<p>å¯¹äºç¼–ç¨‹è¯­è¨€runtimeæ¥è¯´ï¼Œå»ºç«‹èµ·è‰¯å¥½è¿è½¬GCæœºåˆ¶æ˜¯éå¸¸å¿…è¦çš„ï¼Œåƒ<code>Java</code>å’Œ<code>Go</code>ï¼Œå…¶GCæœºåˆ¶éƒ½ç»å†äº†å¤æ‚çš„æ¼”åŒ–ï¼Œå½“ç„¶åŒæ—¶ä¹Ÿä¸ºç¼–ç¨‹è¯­è¨€å¸¦æ¥äº†æ›´å¥½çš„æ€§èƒ½ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ä¸¤é—¨è¯­è¨€èƒ½æˆä¸ºä¸»æµæœåŠ¡ç«¯è¯­è¨€çš„åŸå› ä¹‹ä¸€ã€‚</p>
<p>ç›¸å¯¹äº<code>Java</code>å’Œ<code>Go</code>ï¼Œ<code>python</code>çš„GCæœºåˆ¶æ˜¯ç›¸å¯¹ç®€çº¦çš„ï¼Œå…¶ä¸­æœ€åŸºç¡€çš„æœºåˆ¶ä¹‹ä¸€å°±æ˜¯å¼•ç”¨è®¡æ•°ã€‚å½“å¯¹è±¡ç”Ÿæˆæ—¶å¼•ç”¨è®¡æ•°ä¸º1ï¼›å¯¹è±¡è¢«å…¶å®ƒå¯¹è±¡å¼•ç”¨æ—¶å¼•ç”¨è®¡æ•°å¢åŠ 1ï¼›å¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨ï¼Œåˆé€€å‡ºä½œç”¨åŸŸçš„è¯ï¼Œå¼•ç”¨è®¡æ•°å½’0ï¼›å¼•ç”¨è®¡æ•°å½’0åï¼Œå¯¹è±¡è¢«é”€æ¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­å¯¹å¼•ç”¨è®¡æ•°æœºåˆ¶è¿›è¡Œç ”ç©¶ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_ref</span><span class="params">()</span>:</span></span><br><span class="line">    a = <span class="string">'123456789123456789'</span></span><br><span class="line">    <span class="keyword">del</span> a</span><br></pre></td></tr></table></figure>
<p>å…¶åç¼–è¯‘çš„ç»“æœæ˜¯ï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">8           0 LOAD_CONST               1 (&apos;123456789123456789&apos;)</span><br><span class="line">            2 STORE_FAST               0 (a)</span><br><span class="line"></span><br><span class="line">9           4 DELETE_FAST              0 (a)</span><br><span class="line">            6 LOAD_CONST               0 (None)</span><br><span class="line">            8 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>STORE_FAST</code>å’Œ<code>DELETE_FAST</code>æ“ä½œä¸­ï¼Œéƒ½ç”¨åˆ°äº†<code>SET_LOCAL</code>å®ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SETLOCAL(i, value)      do &#123; PyObject *tmp = GETLOCAL(i); \</span></span><br><span class="line">                                     GETLOCAL(i) = value; \</span><br><span class="line">                                     Py_XDECREF(tmp); &#125; <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°<code>SET_LOCAL</code>çš„æ“ä½œæ˜¯ï¼šå°†å¯¹åº”<code>LOCAL</code>ä½ç½®çš„æ—§å€¼æ‹·è´åˆ°<code>tmp</code>æŒ‡é’ˆï¼Œè®©åå°†æ–°å€¼èµ‹ç»™å¯¹åº”<code>LOCAL</code>ä½ç½®ï¼Œæœ€åå‡å°‘æ—§å€¼<code>tmp</code>æŒ‡é’ˆçš„å¼•ç”¨è®¡æ•°</p>
<p>å¯¹äº<code>DELETE_FAST</code>æ“ä½œï¼Œ<code>SETLOCAL</code>çš„<code>value</code>å‚æ•°æ˜¯<code>NULL</code>ï¼Œè¿™æ ·å¯¹åº”<code>LOCAL</code>ä½ç½®æŒ‡é’ˆè¢«èµ‹å€¼ä¸º<code>NULL</code>ï¼Œæ—§å€¼å‡å°‘å¼•ç”¨è®¡æ•°ï¼Œè¿™æ ·å°±è§¦å‘åç»­ä¸€ç³»åˆ—æ“ä½œäº†ã€‚</p>
<p>å½“è°ƒç”¨<code>Py_XDECREF</code>æ—¶ï¼Œå®é™…æ‰§è¡Œäº†å¦‚ä¸‹çš„æ“ä½œï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> _Py_XDECREF(PyObject *op)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (op != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_DECREF(op);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> Py_XDECREF(op) _Py_XDECREF(_PyObject_CAST(op))</span></span><br><span class="line"></span><br><span class="line"><span class="function">define <span class="title">Py_DECREF</span><span class="params">(op)</span> _<span class="title">Py_DECREF</span><span class="params">(__FILE__, __LINE__, _PyObject_CAST(op))</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span> _<span class="title">Py_DECREF</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">int</span> lineno, PyObject *op)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> Py_REF_DEBUG</span></span><br><span class="line">    _Py_RefTotal--;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    <span class="keyword">if</span> (--op-&gt;ob_refcnt != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> Py_REF_DEBUG</span></span><br><span class="line">        <span class="keyword">if</span> (op-&gt;ob_refcnt &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            _Py_NegativeRefcount(filename, lineno, op);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        _Py_Dealloc(op);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">_Py_Dealloc(PyObject *op)</span><br><span class="line">&#123;</span><br><span class="line">    destructor dealloc = Py_TYPE(op)-&gt;tp_dealloc;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> Py_TRACE_REFS</span></span><br><span class="line">    _Py_ForgetReference(op);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    (*dealloc)(op);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå¯¹è±¡å†…éƒ¨çš„<code>ob_refcnt</code>å¼•ç”¨è®¡æ•°å½’0ï¼Œå°±ä¼šè§¦å‘<code>_Py_Dealloc</code>é€»è¾‘ï¼Œæ¸…ç©ºç»™å¯¹è±¡åˆ†é…çš„å†…å­˜ã€‚</p>
<p>é’ˆå¯¹<code>test_ref</code>çš„ä¾‹å­ï¼Œä¼šè°ƒç”¨py3çš„å­—ç¬¦ä¸²ææ„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯<code>unicode</code>çš„<code>dealloc</code>é€»è¾‘ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">unicode_dealloc(PyObject *unicode)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (PyUnicode_CHECK_INTERNED(unicode)) &#123;</span><br><span class="line">    <span class="keyword">case</span> SSTATE_NOT_INTERNED:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> SSTATE_INTERNED_MORTAL:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> _<span class="title">Py_unicode_state</span> *<span class="title">state</span> = <span class="title">get_unicode_state</span>();</span></span><br><span class="line">        assert(Py_REFCNT(unicode) == <span class="number">0</span>);</span><br><span class="line">        Py_SET_REFCNT(unicode, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">if</span> (PyDict_DelItem(state-&gt;interned, unicode) != <span class="number">0</span>) &#123;</span><br><span class="line">            _PyErr_WriteUnraisableMsg(<span class="string">"deletion of interned string failed"</span>,</span><br><span class="line">                                      <span class="literal">NULL</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        assert(Py_REFCNT(unicode) == <span class="number">1</span>);</span><br><span class="line">        Py_SET_REFCNT(unicode, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> SSTATE_INTERNED_IMMORTAL:</span><br><span class="line">        _PyObject_ASSERT_FAILED_MSG(unicode, <span class="string">"Immortal interned string died"</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        Py_UNREACHABLE();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_PyUnicode_HAS_WSTR_MEMORY(unicode)) &#123;</span><br><span class="line">        PyObject_Free(_PyUnicode_WSTR(unicode));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_PyUnicode_HAS_UTF8_MEMORY(unicode)) &#123;</span><br><span class="line">        PyObject_Free(_PyUnicode_UTF8(unicode));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!PyUnicode_IS_COMPACT(unicode) &amp;&amp; _PyUnicode_DATA_ANY(unicode)) &#123;</span><br><span class="line">        PyObject_Free(_PyUnicode_DATA_ANY(unicode));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Py_TYPE(unicode)-&gt;tp_free(unicode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>unicode</code>çš„ææ„é€»è¾‘ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯ä¸æ˜¯<code>intern</code>çš„ï¼ˆçŸ­å­—ç¬¦ä¸²ç¼“å­˜ï¼‰ï¼Œå¦‚æœæ˜¯çš„è¯ä¼šå¯ç”¨å¦å¤–çš„ææ„é€»è¾‘ï¼Œå¦åˆ™ä¼šè·‘åˆ°ä¸‹é¢ã€‚æœ€ç»ˆè°ƒç”¨çš„æ˜¯<code>Py_TYPE(unicode)-&gt;tp_free(unicode)</code>é€»è¾‘ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span></span><br><span class="line">PyObject_Free(<span class="keyword">void</span> *ptr)</span><br><span class="line">&#123;</span><br><span class="line">    _PyObject.<span class="built_in">free</span>(_PyObject.ctx, ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// _PyObject.free(_PyObject.ctx, ptr)</span></span><br><span class="line"><span class="comment">// python_d.exe</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">_PyMem_DebugFree(<span class="keyword">void</span> *ctx, <span class="keyword">void</span> *ptr)</span><br><span class="line">&#123;</span><br><span class="line">    _PyMem_DebugCheckGIL(__func__);</span><br><span class="line">    _PyMem_DebugRawFree(ctx, ptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">_PyMem_DebugRawFree(<span class="keyword">void</span> *ctx, <span class="keyword">void</span> *p)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* PyMem_Free(NULL) has no effect */</span></span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">debug_alloc_api_t</span> *api = (<span class="keyword">debug_alloc_api_t</span> *)ctx;</span><br><span class="line">    <span class="keyword">uint8_t</span> *q = (<span class="keyword">uint8_t</span> *)p - <span class="number">2</span>*SST;  <span class="comment">/* address returned from malloc */</span></span><br><span class="line">    <span class="keyword">size_t</span> nbytes;</span><br><span class="line"></span><br><span class="line">    _PyMem_DebugCheckAddress(__func__, api-&gt;api_id, p);</span><br><span class="line">    nbytes = <span class="keyword">read_size_t</span>(q);</span><br><span class="line">    nbytes += PYMEM_DEBUG_EXTRA_BYTES;</span><br><span class="line">    <span class="built_in">memset</span>(q, PYMEM_DEADBYTE, nbytes);</span><br><span class="line">    api-&gt;alloc.<span class="built_in">free</span>(api-&gt;alloc.ctx, q);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// api-&gt;alloc.free(api-&gt;alloc.ctx, q)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">_PyObject_Free(<span class="keyword">void</span> *ctx, <span class="keyword">void</span> *p)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* PyObject_Free(NULL) has no effect */</span></span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (UNLIKELY(!pymalloc_free(ctx, p))) &#123;</span><br><span class="line">        <span class="comment">/* pymalloc didn't allocate this address */</span></span><br><span class="line">        PyMem_RawFree(p);</span><br><span class="line">        raw_allocated_blocks--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€è·¯èµ°ä¸‹æ¥ï¼Œæœ€ç»ˆä¼šè°ƒç”¨<code>_PyObject_Free</code>å»å½»åº•é‡Šæ”¾è¿™å—å†…å­˜ï¼Œ<code>_PyObject_Free</code>ä¼šå°è¯•é€šè¿‡<code>pymalloc_free</code>å’Œ<code>PyMem_RawFree</code>ä¸¤ç§æ–¹å¼å¯¹å¯¹è±¡æ‰€å å†…å­˜è¿›è¡Œé‡Šæ”¾ã€‚å…¶ä¸­å‰è€…æ˜¯é‡‡ç”¨<code>python</code>è‡ªå¸¦çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œåè€…æ˜¯é‡‡ç”¨æ“ä½œç³»ç»Ÿçš„<code>free</code>æ–¹æ³•ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç¨å¾®äº†è§£ä¸€ä¸‹<code>python</code>å†…å­˜ç®¡ç†çš„æœºåˆ¶ã€‚<code>python</code>å†…éƒ¨ç»´æŠ¤äº†ä¸åŒç»„ç›¸åŒå¤§å°å—çš„å†…å­˜æ± ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li><code>arena</code>ï¼šç®¡ç†ä¸€ç»„<code>pool</code><ul>
<li>ç»´æŠ¤å¯ç”¨<code>pool</code>æ•°é‡åŠ<code>pool</code>æ€»é‡</li>
<li>å¯ä»¥æœ‰å¤šä¸ª<code>arena</code></li>
</ul>
</li>
<li><code>pool</code>ï¼šç®¡ç†ä¸€ç»„ç›¸åŒå¤§å°çš„<code>block</code>çš„é“¾è¡¨<ul>
<li>æ­£åœ¨ä½¿ç”¨ä¸­ï¼ˆ<code>used</code>ï¼Œéç©ºï¼Œéæ»¡ï¼‰çš„<code>pool</code>é›†åˆï¼Œä¼šå•ç‹¬ç”±<code>usedpools</code>æ•°ç»„ç®¡ç†</li>
<li>ç”³è¯·å†…å­˜æ—¶ï¼Œä¼šä¼˜å…ˆä»<code>usedpools</code>å¯»æ‰¾å¯ç”¨<code>pool</code>ã€‚å¦‚æœ<code>block</code>æ•°é‡ä¸å¤Ÿï¼Œä¼šæ–°å¢<code>block</code></li>
<li>å¦‚æœæ²¡æœ‰æŒ‡å®šå¤§å°çš„<code>block</code>ï¼Œä¼šä»<code>arena</code>æ–°èµ·ä¸€ä¸ª<code>pool</code>ç„¶ååˆ†é…å¯¹åº”<code>block</code></li>
<li>é‡Šæ”¾å¯¹è±¡å†…å­˜æ—¶ï¼Œè¢«é‡Šæ”¾çš„<code>block</code>è¢«è½¬ç§»åˆ°å•ç‹¬çš„å¯ç”¨<code>block</code>é“¾è¡¨</li>
</ul>
</li>
<li><code>block</code>ï¼šä¸€ä¸ªå›ºå®šå¤§å°çš„å†…å­˜å—<ul>
<li>åœ¨<code>python</code>ä¸­ï¼Œæœ‰ä¸åŒçš„å›ºå®šå¤§å°ï¼Œä»¥8/16å­—èŠ‚å¯¹é½ï¼ˆ<code>ALIGNMENT</code>å®ï¼‰</li>
<li>é’ˆå¯¹ä¸åŒå¤§å°çš„å¯¹è±¡ï¼Œåˆ†é…ä¸åŒå¤§å°çš„<code>block</code></li>
</ul>
</li>
</ul>
<p>äº†è§£äº†è¿™äº›æ¦‚å¿µï¼Œå†çœ‹<code>python</code>å¯¹è±¡çš„å†…å­˜å›æ”¶é€»è¾‘ï¼Œå°±å¾ˆæ˜ç™½äº†ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">int</span></span><br><span class="line">pymalloc_free(<span class="keyword">void</span> *ctx, <span class="keyword">void</span> *p)</span><br><span class="line">&#123;</span><br><span class="line">    assert(p != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    poolp pool = POOL_ADDR(p);</span><br><span class="line">    <span class="keyword">if</span> (UNLIKELY(!address_in_range(p, pool))) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    assert(pool-&gt;ref.count &gt; <span class="number">0</span>);            <span class="comment">/* else it was empty */</span></span><br><span class="line">    block *lastfree = pool-&gt;freeblock;</span><br><span class="line">    *(block **)p = lastfree;</span><br><span class="line">    pool-&gt;freeblock = (block *)p;</span><br><span class="line">    pool-&gt;ref.count--;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (UNLIKELY(lastfree == <span class="literal">NULL</span>)) &#123;</span><br><span class="line">        insert_to_usedpool(pool);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (LIKELY(pool-&gt;ref.count != <span class="number">0</span>)) &#123;</span><br><span class="line">        <span class="comment">/* pool isn't empty:  leave it in usedpools */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    insert_to_freepool(pool);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>pymalloc_free</code>ä¸»è¦åšäº†ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼Œå®Œæˆå¯¹è±¡çš„å†…å­˜é‡Šæ”¾ï¼š</p>
<ul>
<li>é€šè¿‡<code>POOL_ADDR</code>å®ï¼Œæ‰¾åˆ°æŒ‡é’ˆ<code>p</code>å¯¹åº”<code>pool</code>ä½ç½®</li>
<li>å°†æŒ‡é’ˆ<code>p</code>å¯¹åº”çš„å†…å­˜å—æ”¾åˆ°<code>freeblock</code>é“¾è¡¨å¤´éƒ¨</li>
<li>å‡å°‘<code>pool</code>çš„å¼•ç”¨æ•°ã€‚å¦‚æœå½’é›¶ï¼Œå°†<code>pool</code>æ”¾åˆ°å¯¹åº”<code>arena</code>çš„<code>freepools</code>é‡Œ</li>
</ul>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>gc</tag>
        <tag>å†…å­˜æ³„æ¼</tag>
        <tag>å¼•ç”¨è®¡æ•°</tag>
        <tag>å†…å­˜æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬äºŒç« -å¼‚æ­¥IOã€‘3ã€async/awaitçš„æºç å®ç°</title>
    <url>/2022/02/26/hardpython/2_asyncio_3/</url>
    <content><![CDATA[<p>è¯´å®Œäº†<code>asyncio</code>äº‹ä»¶å¾ªç¯æ˜¯å¦‚ä½•è¿è¡Œå¼‚æ­¥ä»»åŠ¡çš„ï¼Œæ¥ä¸‹æ¥back to basicï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹<code>async</code>å’Œ<code>await</code>ä¸¤ä¸ªåŸè¯­å…·ä½“ä»£è¡¨äº†ä»€ä¹ˆå«ä¹‰ã€‚</p>
<p>é¦–å…ˆæ˜¯<code>async</code>ï¼Œ<code>async</code>é€šå¸¸ç”¨æ¥ä¿®é¥°ä¸€ä¸ªå‡½æ•°ï¼Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªåç¨‹ã€‚æ¯”å¦‚è¯´ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_coro_maker</span><span class="params">(i)</span>:</span></span><br><span class="line">    print(i + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_async</span><span class="params">()</span>:</span></span><br><span class="line">    c = _coro_maker(<span class="number">1</span>)</span><br><span class="line">    asyncio.run(c)</span><br></pre></td></tr></table></figure>
<p>å¯¹<code>_coro_maker</code>è¿›è¡Œåç¼–è¯‘ï¼Œå¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Disassembly of _coro_maker:</span><br><span class="line">              0 GEN_START                1</span><br><span class="line"></span><br><span class="line">  7           2 LOAD_GLOBAL              0 (print)</span><br><span class="line">              4 LOAD_FAST                0 (i)</span><br><span class="line">              6 LOAD_CONST               1 (1)</span><br><span class="line">              8 BINARY_ADD</span><br><span class="line">             10 CALL_FUNCTION            1</span><br><span class="line">             12 POP_TOP</span><br><span class="line">             14 LOAD_CONST               0 (None)</span><br><span class="line">             16 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°ä½“å†…åç¼–è¯‘çš„ç»“æœå’Œæ™®é€šdefå‡½æ•°æ˜¯ä¸€è‡´çš„ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯æœ€å¼€å§‹åŠ äº†<code>GEN_START</code>å­—èŠ‚ç ã€‚é¦–å…ˆçœ‹<code>GEN_START</code>çš„å®ç°ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">case TARGET(GEN_START): &#123;</span><br><span class="line">    PyObject *none = POP();</span><br><span class="line">    Py_DECREF(none);</span><br><span class="line">    <span class="keyword">if</span> (!Py_IsNone(none)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oparg &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            _PyErr_SetString(tstate, PyExc_SystemError,</span><br><span class="line">                <span class="string">"Illegal kind for GEN_START"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">char</span> *gen_kind[<span class="number">3</span>] = &#123;</span><br><span class="line">                <span class="string">"generator"</span>,</span><br><span class="line">                <span class="string">"coroutine"</span>,</span><br><span class="line">                <span class="string">"async generator"</span></span><br><span class="line">            &#125;;</span><br><span class="line">            _PyErr_Format(tstate, PyExc_TypeError,</span><br><span class="line">                <span class="string">"can't send non-None value to a "</span></span><br><span class="line">                        <span class="string">"just-started %s"</span>,</span><br><span class="line">                        gen_kind[oparg]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    DISPATCH();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>GEN_START</code>å¯¹äºç”Ÿæˆå™¨ã€åç¨‹ã€<code>async</code>ç”Ÿæˆå™¨éƒ½é€‚ç”¨ã€‚å¯¹äº<code>async def</code>å‡½æ•°å…¶çœŸå®å«ä¹‰æ˜¯è°ƒç”¨<code>send(None)</code>ä»¥è§¦å‘åç¨‹çš„å¼€å§‹ã€‚ç”±äº<code>async def</code>ç”Ÿæˆçš„åç¨‹æ²¡æœ‰<code>yield</code>å€¼ï¼Œå› æ­¤ä¼šæŠ¥<code>StopIteration</code>å¼‚å¸¸å¹¶ç»™å‡ºåç¨‹çš„è¿”å›å€¼ã€‚<br>â€‹<br>æ€»çš„æ¥è¯´ï¼Œåç¨‹æ˜¯ä¸€ç§ç‰¹æ®Šçš„<code>generator</code>ï¼Œå…·å¤‡è¢«<code>await</code>çš„æ•ˆæœã€‚<br>â€‹<br>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œè¯¥è¯´<code>await</code>äº†ã€‚æˆ‘ä»¬çœ‹ä¸€ç»„ä»£ç ç¤ºä¾‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_coro_maker</span><span class="params">(i)</span>:</span></span><br><span class="line">    print(i + <span class="number">1</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_test_await</span><span class="params">()</span>:</span></span><br><span class="line">    c = _coro_maker(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">await</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_await</span><span class="params">()</span>:</span></span><br><span class="line">    asyncio.run(_test_await())</span><br></pre></td></tr></table></figure>
<p>â€‹<br>åç¼–è¯‘<code>_test_await</code>çš„ç»“æœï¼Œå¾—åˆ°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Disassembly of _test_await:</span><br><span class="line">              0 GEN_START                1</span><br><span class="line"></span><br><span class="line"> 27           2 LOAD_GLOBAL              0 (_coro_maker)</span><br><span class="line">              4 LOAD_CONST               1 (1)</span><br><span class="line">              6 CALL_FUNCTION            1</span><br><span class="line">              8 STORE_FAST               0 (c)</span><br><span class="line"></span><br><span class="line"> 28          10 LOAD_FAST                0 (c)</span><br><span class="line">             12 GET_AWAITABLE</span><br><span class="line">             14 LOAD_CONST               0 (None)</span><br><span class="line">             16 YIELD_FROM</span><br><span class="line">             18 POP_TOP</span><br><span class="line">             20 LOAD_CONST               0 (None)</span><br><span class="line">             22 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæ¥çœ‹<code>GET_AWAITABLE</code>ï¼Œå…¶ä»£ç å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">case TARGET(GET_AWAITABLE): &#123;</span><br><span class="line">    PREDICTED(GET_AWAITABLE);</span><br><span class="line">    PyObject *iterable = TOP();</span><br><span class="line">    PyObject *iter = _PyCoro_GetAwaitableIter(iterable);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iter == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> opcode_at_minus_3 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> ((next_instr - first_instr) &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            opcode_at_minus_3 = _Py_OPCODE(next_instr[<span class="number">-3</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        format_awaitable_error(tstate, Py_TYPE(iterable),</span><br><span class="line">                               opcode_at_minus_3,</span><br><span class="line">                               _Py_OPCODE(next_instr[<span class="number">-2</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Py_DECREF(iterable);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iter != <span class="literal">NULL</span> &amp;&amp; PyCoro_CheckExact(iter)) &#123;</span><br><span class="line">        PyObject *yf = _PyGen_yf((PyGenObject*)iter);</span><br><span class="line">        <span class="keyword">if</span> (yf != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="comment">/* `iter` is a coroutine object that is being</span></span><br><span class="line"><span class="comment">               awaited, `yf` is a pointer to the current awaitable</span></span><br><span class="line"><span class="comment">               being awaited on. */</span></span><br><span class="line">            Py_DECREF(yf);</span><br><span class="line">            Py_CLEAR(iter);</span><br><span class="line">            _PyErr_SetString(tstate, PyExc_RuntimeError,</span><br><span class="line">                             <span class="string">"coroutine is being awaited already"</span>);</span><br><span class="line">            <span class="comment">/* The code below jumps to `error` if `iter` is NULL. */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SET_TOP(iter); <span class="comment">/* Even if it's NULL */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (iter == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PREDICT(LOAD_CONST);</span><br><span class="line">    DISPATCH();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>GET_AWAITABLE</code>åšäº†è¿™æ ·å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>é€šè¿‡<code>_PyCoro_GetAwaitableIter</code>è·å–ä¸€ä¸ª<code>Awaitable</code>å¯¹è±¡çš„è¿­ä»£å™¨<code>iter</code></li>
<li>æ£€æŸ¥<code>iter</code>æ˜¯å¦åˆæ³•ï¼Œæ£€æŸ¥å½“å‰<code>Awaitable</code>å¯¹è±¡æ˜¯å¦å·²ç»è¢«<code>await</code>äº†</li>
<li>å°†<code>iter</code>ç½®äºæ ˆé¡¶</li>
</ul>
<p><code>Awaitable</code>çš„<code>iter</code>åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿæˆ‘ä»¬æ¥çœ‹<code>_PyCoro_GetAwaitableIter</code>çš„å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">PyObject *</span><br><span class="line">_PyCoro_GetAwaitableIter(PyObject *o)</span><br><span class="line">&#123;</span><br><span class="line">    unaryfunc getter = <span class="literal">NULL</span>;</span><br><span class="line">    PyTypeObject *ot;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyCoro_CheckExact(o) || gen_is_coroutine(o)) &#123;</span><br><span class="line">        <span class="comment">/* 'o' is a coroutine. */</span></span><br><span class="line">        Py_INCREF(o);</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ot = Py_TYPE(o);</span><br><span class="line">    <span class="keyword">if</span> (ot-&gt;tp_as_async != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        getter = ot-&gt;tp_as_async-&gt;am_await;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (getter != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        PyObject *res = (*getter)(o);</span><br><span class="line">        <span class="keyword">if</span> (res != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (PyCoro_CheckExact(res) || gen_is_coroutine(res)) &#123;</span><br><span class="line">                <span class="comment">/* __await__ must return an *iterator*, not</span></span><br><span class="line"><span class="comment">                   a coroutine or another awaitable (see PEP 492) */</span></span><br><span class="line">                PyErr_SetString(PyExc_TypeError,</span><br><span class="line">                                <span class="string">"__await__() returned a coroutine"</span>);</span><br><span class="line">                Py_CLEAR(res);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!PyIter_Check(res)) &#123;</span><br><span class="line">                PyErr_Format(PyExc_TypeError,</span><br><span class="line">                             <span class="string">"__await__() returned non-iterator "</span></span><br><span class="line">                             <span class="string">"of type '%.100s'"</span>,</span><br><span class="line">                             Py_TYPE(res)-&gt;tp_name);</span><br><span class="line">                Py_CLEAR(res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_Format(PyExc_TypeError,</span><br><span class="line">                 <span class="string">"object %.100s can't be used in 'await' expression"</span>,</span><br><span class="line">                 ot-&gt;tp_name);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æœ‰é‡è¦çš„å‡ å¥ä»£ç ï¼š</p>
<ul>
<li><code>if (PyCoro_CheckExact(o) || gen_is_coroutine(o)) return o</code></li>
<li><code>getter = ot-&gt;tp_as_async-&gt;am_await</code></li>
<li><code>PyObject *res = (*getter)(o)</code></li>
</ul>
<p>å¯ä»¥çŸ¥æ™“ï¼Œå¦‚æœå¯¹è±¡æ˜¯åç¨‹çš„è¯ä¼šç›´æ¥è¿”å›ï¼Œä¸æ˜¯åç¨‹çš„è¯çœ‹æœ‰æ— <code>ot-&gt;tp_as_async-&gt;am_await</code>æ¥å£æ”¯æŒã€‚å¦‚æœå†è¿½ç©¶çš„è¯ï¼Œå¯¹äºä¸€èˆ¬çš„ç”Ÿæˆå™¨<code>PyGen_Type</code>ï¼Œæ˜¯æ²¡æœ‰è¿™ä¸ªæ¥å£çš„ï¼Œæ‰€ä»¥æ˜¯æ— æ³•è¢«<code>await</code>çš„ã€‚</p>
<p><code>GET_AWAITABLE</code>ä¹‹åï¼Œæ¥ä¸‹æ¥æ˜¯<code>load</code>äº†ä¸€ä¸ª<code>None</code>ï¼Œç„¶å<code>YIELD_FROM</code>ã€‚<code>YIELD_FROM</code>å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">case TARGET(YIELD_FROM): &#123;</span><br><span class="line">    PyObject *v = POP();</span><br><span class="line">    PyObject *receiver = TOP();</span><br><span class="line">    PySendResult gen_status;</span><br><span class="line">    <span class="keyword">if</span> (tstate-&gt;c_tracefunc == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        gen_status = PyIter_Send(receiver, v, &amp;retval);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// çœç•¥ä¸€äº›ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">    Py_DECREF(v);</span><br><span class="line">    <span class="keyword">if</span> (gen_status == PYGEN_ERROR) &#123;</span><br><span class="line">        assert (retval == <span class="literal">NULL</span>);</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (gen_status == PYGEN_RETURN) &#123;</span><br><span class="line">        assert (retval != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">        Py_DECREF(receiver);</span><br><span class="line">        SET_TOP(retval);</span><br><span class="line">        retval = <span class="literal">NULL</span>;</span><br><span class="line">        DISPATCH();</span><br><span class="line">    &#125;</span><br><span class="line">    assert (gen_status == PYGEN_NEXT);</span><br><span class="line">    <span class="comment">/* receiver remains on stack, retval is value to be yielded */</span></span><br><span class="line">    <span class="comment">/* and repeat... */</span></span><br><span class="line">    assert(f-&gt;f_lasti &gt; <span class="number">0</span>);</span><br><span class="line">    f-&gt;f_lasti -= <span class="number">1</span>;</span><br><span class="line">    f-&gt;f_state = FRAME_SUSPENDED;</span><br><span class="line">    f-&gt;f_stackdepth = (<span class="keyword">int</span>)(stack_pointer - f-&gt;f_valuestack);</span><br><span class="line">    <span class="keyword">goto</span> exiting;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>YIELD_FROM</code>æ“ä½œï¼Œå®é™…ä¸Šè°ƒç”¨äº†<code>PyIter_Send(coro, None, &amp;retval)</code>ã€‚æˆ‘ä»¬æ¥çœ‹<code>PyIter_Send</code>çš„å®ç°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">PySendResult</span><br><span class="line">PyIter_Send(PyObject *iter, PyObject *arg, PyObject **result)</span><br><span class="line">&#123;</span><br><span class="line">    _Py_IDENTIFIER(send);</span><br><span class="line">    assert(arg != <span class="literal">NULL</span>);</span><br><span class="line">    assert(result != <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (Py_TYPE(iter)-&gt;tp_as_async &amp;&amp; Py_TYPE(iter)-&gt;tp_as_async-&gt;am_send) &#123;</span><br><span class="line">        PySendResult res = Py_TYPE(iter)-&gt;tp_as_async-&gt;am_send(iter, arg, result);</span><br><span class="line">        assert(_Py_CheckSlotResult(iter, <span class="string">"am_send"</span>, res != PYGEN_ERROR));</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (arg == Py_None &amp;&amp; PyIter_Check(iter)) &#123;</span><br><span class="line">        *result = Py_TYPE(iter)-&gt;tp_iternext(iter);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        *result = _PyObject_CallMethodIdOneArg(iter, &amp;PyId_send, arg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (*result != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> PYGEN_NEXT;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (_PyGen_FetchStopIterationValue(result) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> PYGEN_RETURN;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> PYGEN_ERROR;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹<code>AwaitableIter</code>ï¼Œå®é™…è°ƒç”¨äº†<code>Py_TYPE(iter)-&gt;tp_as_async-&gt;am_send(iter, arg, result)</code>ï¼Œå¯¹åº”çš„å‡½æ•°æ˜¯è¿™ä¸ªï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> PySendResult</span><br><span class="line">PyGen_am_send(PyGenObject *gen, PyObject *arg, PyObject **result)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> gen_send_ex2(gen, arg, result, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™é‡Œå°±å¾ˆä»¤äººç†Ÿæ‚‰äº†ï¼Œæ²¡é”™ï¼Œ<code>gen_send_ex2(coro, None, result, 0, 0)</code>å°±æ˜¯<code>coro.send(None)</code>çš„é€»è¾‘</p>
<p>åœ¨<code>gen_send_ex2</code>ä¸­ï¼Œå‡½æ•°ä½“çš„è¿”å›å€¼ä¼šæ­£å¥½èµ‹åˆ°<code>result</code>ä¸Šã€‚å†çœ‹<code>YIELD_FROM</code>é‡Œ<code>if (gen_status == PYGEN_RETURN)</code>åˆ†æ”¯ï¼Œæœ€ç»ˆçš„è¿”å›å€¼å°±ä¼šæ”¾åˆ°æ ˆé¡¶ã€‚</p>
<p>å½“æˆ‘ä»¬è°ƒç”¨<code>xx = await Awaitable</code>æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå°±èƒ½å¤ŸæŠŠ<code>Awaitable</code>çš„è¿”å›å€¼èµ‹ç»™<code>xx</code>äº†ã€‚è¿™æ ·ï¼Œ<code>await</code>åŸè¯­å°±å®ç°äº†å®ƒçš„ä½œç”¨ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>å¼‚æ­¥</tag>
        <tag>python</tag>
        <tag>asyncio</tag>
        <tag>async</tag>
        <tag>await</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬äºŒç« -å¼‚æ­¥IOã€‘2ã€å¼‚æ­¥ä»»åŠ¡åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„æ‰§è¡Œ</title>
    <url>/2022/02/20/hardpython/2_asyncio_2/</url>
    <content><![CDATA[<p>æ¥ç»­<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDIvMTIvaGFyZHB5dGhvbi8yX2FzeW5jaW9fMS8=" title="https://utmhikari.top/2022/02/12/hardpython/2_asyncio_1/">ç¬¬ä¸€è¯<i class="fa fa-external-link"></i></span>çš„å†…å®¹ï¼Œäº‹ä»¶å¾ªç¯åœ¨åˆ›å»ºä¹‹åï¼Œåˆæ˜¯å¦‚ä½•è¿è¡Œåç¨‹ä»»åŠ¡ä»¥åŠå¼‚æ­¥IOä»»åŠ¡çš„ï¼Ÿ<br>â€‹<br>ç”±<code>asyncio.run</code>çš„ä»£ç å¯çŸ¥ï¼Œ<code>loop.run_until_complete</code>æ˜¯è¿è¡Œåç¨‹çš„æ–¹æ³•ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># base_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseEventLoop</span><span class="params">(events.AbstractEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_until_complete</span><span class="params">(self, future)</span>:</span></span><br><span class="line">        self._check_closed()</span><br><span class="line">        self._check_running()</span><br><span class="line">        new_task = <span class="keyword">not</span> futures.isfuture(future)</span><br><span class="line">        future = tasks.ensure_future(future, loop=self)</span><br><span class="line">        <span class="keyword">if</span> new_task:</span><br><span class="line">            future._log_destroy_pending = <span class="literal">False</span></span><br><span class="line">        future.add_done_callback(_run_until_complete_cb)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.run_forever()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> new_task <span class="keyword">and</span> future.done() <span class="keyword">and</span> <span class="keyword">not</span> future.cancelled():</span><br><span class="line">                future.exception()</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            future.remove_done_callback(_run_until_complete_cb)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> future.done():</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">'Event loop stopped before Future completed.'</span>)</span><br><span class="line">        <span class="keyword">return</span> future.result()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># tasks.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ensure_future</span><span class="params">(coro_or_future, *, loop=None)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> _ensure_future(coro_or_future, loop=loop)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ensure_future</span><span class="params">(coro_or_future, *, loop=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> futures.isfuture(coro_or_future):</span><br><span class="line">        <span class="keyword">if</span> loop <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> loop <span class="keyword">is</span> <span class="keyword">not</span> futures._get_loop(coro_or_future):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">'The future belongs to a different loop than '</span></span><br><span class="line">                            <span class="string">'the one specified as the loop argument'</span>)</span><br><span class="line">        <span class="keyword">return</span> coro_or_future</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> coroutines.iscoroutine(coro_or_future):</span><br><span class="line">        <span class="keyword">if</span> inspect.isawaitable(coro_or_future):</span><br><span class="line">            coro_or_future = _wrap_awaitable(coro_or_future)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'An asyncio.Future, a coroutine or an awaitable '</span></span><br><span class="line">                            <span class="string">'is required'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> loop <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        loop = events._get_event_loop(stacklevel=<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> loop.create_task(coro_or_future)</span><br></pre></td></tr></table></figure>
<p><code>run_until_complete</code>æ–¹æ³•ä¼ å…¥çš„åç¨‹ä¼šé€šè¿‡<code>tasks.ensure_future</code>æ–¹æ³•è¢«å°è£…æˆä¸€ä¸ª<code>task</code>å®ä¾‹ï¼Œä»ä¸Šè¿°çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆè½å®åˆ°äº†<code>loop.create_task</code>æ–¹æ³•ã€‚<br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># base_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseEventLoop</span><span class="params">(events.AbstractEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_task</span><span class="params">(self, coro, *, name=None)</span>:</span></span><br><span class="line">        self._check_closed()</span><br><span class="line">        <span class="keyword">if</span> self._task_factory <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            task = tasks.Task(coro, loop=self, name=name)</span><br><span class="line">            <span class="keyword">if</span> task._source_traceback:</span><br><span class="line">                <span class="keyword">del</span> task._source_traceback[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            task = self._task_factory(self, coro)</span><br><span class="line">            tasks._set_task_name(task, name)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> task</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># task.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span><span class="params">(futures._PyFuture)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, coro, *, loop=None, name=None)</span>:</span></span><br><span class="line">        super().__init__(loop=loop)</span><br><span class="line">        <span class="keyword">if</span> self._source_traceback:</span><br><span class="line">            <span class="keyword">del</span> self._source_traceback[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> coroutines.iscoroutine(coro):</span><br><span class="line">            self._log_destroy_pending = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">f"a coroutine was expected, got <span class="subst">&#123;coro!r&#125;</span>"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            self._name = <span class="string">f'Task-<span class="subst">&#123;_task_name_counter()&#125;</span>'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._name = str(name)</span><br><span class="line"></span><br><span class="line">        self._must_cancel = <span class="literal">False</span></span><br><span class="line">        self._fut_waiter = <span class="literal">None</span></span><br><span class="line">        self._coro = coro</span><br><span class="line">        self._context = contextvars.copy_context()</span><br><span class="line"></span><br><span class="line">        self._loop.call_soon(self.__step, context=self._context)</span><br><span class="line">        _register_task(self)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># base_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseEventLoop</span><span class="params">(events.AbstractEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_soon</span><span class="params">(self, callback, *args, context=None)</span>:</span></span><br><span class="line">        self._check_closed()</span><br><span class="line">        <span class="keyword">if</span> self._debug:</span><br><span class="line">            self._check_thread()</span><br><span class="line">            self._check_callback(callback, <span class="string">'call_soon'</span>)</span><br><span class="line">        handle = self._call_soon(callback, args, context)</span><br><span class="line">        <span class="keyword">if</span> handle._source_traceback:</span><br><span class="line">            <span class="keyword">del</span> handle._source_traceback[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">return</span> handle</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_call_soon</span><span class="params">(self, callback, args, context)</span>:</span></span><br><span class="line">        handle = events.Handle(callback, args, self, context)</span><br><span class="line">        <span class="keyword">if</span> handle._source_traceback:</span><br><span class="line">            <span class="keyword">del</span> handle._source_traceback[<span class="number">-1</span>]</span><br><span class="line">        self._ready.append(handle)</span><br><span class="line">        <span class="keyword">return</span> handle</span><br></pre></td></tr></table></figure>
<p><code>loop.create_task</code>æ–¹æ³•æœ€ç»ˆä¼šç”Ÿæˆä¸€ä¸ª<code>Task</code>å®ä¾‹ã€‚<code>Task</code>å®ä¾‹å°è£…äº†åç¨‹ä»¥åŠå…¶å®ƒä¸€ç³»åˆ—å˜é‡ï¼Œæœ€ç»ˆè°ƒç”¨<code>loop</code>çš„<code>call_soon</code>æ–¹æ³•ï¼Œä¼ å…¥äº†å®ä¾‹çš„<code>__step</code>å‡½æ•°ã€‚<code>call_soon</code>æ–¹æ³•ä¼ å…¥çš„å‡½æ•°ï¼Œä¼šé€šè¿‡<code>events.Handle</code>å°è£…ç”Ÿæˆä¸€ä¸ª<code>handle</code>å®ä¾‹ï¼Œå¹¶åŠ å…¥åˆ°äº‹ä»¶å¾ªç¯çš„<code>_ready</code>é˜Ÿåˆ—ä¸­ã€‚<br>â€‹</p>
<p><code>__step</code>æ–¹æ³•ä¼šé€šè¿‡<code>coro.send(None)</code>æˆ–æ˜¯<code>coro.throw(exc)</code>æ–¹æ³•å¯åŠ¨<code>Task</code>å®ä¾‹å†…éƒ¨çš„åç¨‹å¹¶è·å–åç¨‹çš„è¿”å›ç»“æœï¼Œå¯¹äºä¸€èˆ¬åç¨‹è€Œè¨€<code>coro.send(None)</code>ä¼šç›´æ¥<code>throw</code>ä¸€ä¸ª<code>StopIteration</code>å¼‚å¸¸ï¼Œå¹¶åœ¨å¼‚å¸¸ç»“æœé‡Œé™„ä¸Šåç¨‹è¿”å›å€¼ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰å…¶å®ƒæƒ…å†µï¼ˆæ¯”å¦‚<code>await</code>äº†ä¸€ä¸ª<code>yield</code>å¤šæ¬¡çš„<code>Awaitable</code>å®ä¾‹ï¼‰å¯èƒ½è¦å¤šæ¬¡<code>call_soon</code>åç¨‹<code>Task</code>çš„<code>__step</code>å‡½æ•°ï¼Œç›¸å…³çš„ä¾‹å­å¯ä»¥æŸ¥çœ‹stackoverflowçš„<span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjkwNjAvcHl0aG9uLW5hdGl2ZS1jb3JvdXRpbmVzLWFuZC1zZW5k" title="https://stackoverflow.com/questions/34469060/python-native-coroutines-and-send">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span>ã€‚<br>â€‹</p>
<p>åœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬å†å›åˆ°<code>run_until_complete</code>æ–¹æ³•ï¼Œåœ¨<code>ensure_future</code>åï¼Œä¾¿è°ƒç”¨<code>loop.run_forever</code>æ–¹æ³•ï¼Œå¯åŠ¨äº‹ä»¶å¾ªç¯ã€‚<br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># windows_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProactorEventLoop</span><span class="params">(proactor_events.BaseProactorEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_forever</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">assert</span> self._self_reading_future <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">            self.call_soon(self._loop_self_reading)</span><br><span class="line">            super().run_forever()</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">if</span> self._self_reading_future <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                ov = self._self_reading_future._ov</span><br><span class="line">                self._self_reading_future.cancel()</span><br><span class="line">                <span class="keyword">if</span> ov <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    self._proactor._unregister(ov)</span><br><span class="line">                self._self_reading_future = <span class="literal">None</span></span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line"><span class="comment"># proactor_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseProactorEventLoop</span><span class="params">(base_events.BaseEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_loop_self_reading</span><span class="params">(self, f=None)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                f.result()  <span class="comment"># may raise</span></span><br><span class="line">            <span class="keyword">if</span> self._self_reading_future <span class="keyword">is</span> <span class="keyword">not</span> f:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            f = self._proactor.recv(self._ssock, <span class="number">4096</span>)</span><br><span class="line">        <span class="keyword">except</span> exceptions.CancelledError:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">except</span> (SystemExit, KeyboardInterrupt):</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">except</span> BaseException <span class="keyword">as</span> exc:</span><br><span class="line">            self.call_exception_handler(&#123;</span><br><span class="line">                <span class="string">'message'</span>: <span class="string">'Error on reading from the event loop self pipe'</span>,</span><br><span class="line">                <span class="string">'exception'</span>: exc,</span><br><span class="line">                <span class="string">'loop'</span>: self,</span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._self_reading_future = f</span><br><span class="line">            f.add_done_callback(self._loop_self_reading)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># base_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseEventLoop</span><span class="params">(events.AbstractEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run_forever</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._check_closed()</span><br><span class="line">        self._check_running()</span><br><span class="line">        self._set_coroutine_origin_tracking(self._debug)</span><br><span class="line">        self._thread_id = threading.get_ident()</span><br><span class="line"></span><br><span class="line">        old_agen_hooks = sys.get_asyncgen_hooks()</span><br><span class="line">        sys.set_asyncgen_hooks(firstiter=self._asyncgen_firstiter_hook,</span><br><span class="line">                               finalizer=self._asyncgen_finalizer_hook)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            events._set_running_loop(self)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                self._run_once()</span><br><span class="line">                <span class="keyword">if</span> self._stopping:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self._stopping = <span class="literal">False</span></span><br><span class="line">            self._thread_id = <span class="literal">None</span></span><br><span class="line">            events._set_running_loop(<span class="literal">None</span>)</span><br><span class="line">            self._set_coroutine_origin_tracking(<span class="literal">False</span>)</span><br><span class="line">            sys.set_asyncgen_hooks(*old_agen_hooks)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_run_once</span><span class="params">(self)</span>:</span></span><br><span class="line">        sched_count = len(self._scheduled)</span><br><span class="line">        <span class="keyword">if</span> (sched_count &gt; _MIN_SCHEDULED_TIMER_HANDLES <span class="keyword">and</span></span><br><span class="line">            self._timer_cancelled_count / sched_count &gt;</span><br><span class="line">                _MIN_CANCELLED_TIMER_HANDLES_FRACTION):</span><br><span class="line">            new_scheduled = []</span><br><span class="line">            <span class="keyword">for</span> handle <span class="keyword">in</span> self._scheduled:</span><br><span class="line">                <span class="keyword">if</span> handle._cancelled:</span><br><span class="line">                    handle._scheduled = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    new_scheduled.append(handle)</span><br><span class="line"></span><br><span class="line">            heapq.heapify(new_scheduled)</span><br><span class="line">            self._scheduled = new_scheduled</span><br><span class="line">            self._timer_cancelled_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> self._scheduled <span class="keyword">and</span> self._scheduled[<span class="number">0</span>]._cancelled:</span><br><span class="line">                self._timer_cancelled_count -= <span class="number">1</span></span><br><span class="line">                handle = heapq.heappop(self._scheduled)</span><br><span class="line">                handle._scheduled = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        timeout = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> self._ready <span class="keyword">or</span> self._stopping:</span><br><span class="line">            timeout = <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> self._scheduled:</span><br><span class="line">            <span class="comment"># Compute the desired timeout.</span></span><br><span class="line">            when = self._scheduled[<span class="number">0</span>]._when</span><br><span class="line">            timeout = min(max(<span class="number">0</span>, when - self.time()), MAXIMUM_SELECT_TIMEOUT)</span><br><span class="line"></span><br><span class="line">        event_list = self._selector.select(timeout)</span><br><span class="line">        self._process_events(event_list)</span><br><span class="line"></span><br><span class="line">        end_time = self.time() + self._clock_resolution</span><br><span class="line">        <span class="keyword">while</span> self._scheduled:</span><br><span class="line">            handle = self._scheduled[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> handle._when &gt;= end_time:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            handle = heapq.heappop(self._scheduled)</span><br><span class="line">            handle._scheduled = <span class="literal">False</span></span><br><span class="line">            self._ready.append(handle)</span><br><span class="line"></span><br><span class="line">        ntodo = len(self._ready)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(ntodo):</span><br><span class="line">            handle = self._ready.popleft()</span><br><span class="line">            <span class="keyword">if</span> handle._cancelled:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> self._debug:</span><br><span class="line">                <span class="comment"># debugæ¨¡å¼ä¸‹ä»£ç ï¼ŒåŠ äº†æ—¶é—´ç»Ÿè®¡</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                handle._run()</span><br><span class="line">        handle = <span class="literal">None</span>  <span class="comment"># Needed to break cycles when an exception occurs.</span></span><br></pre></td></tr></table></figure>
<p><code>ProactorEventLoop</code>åœ¨è°ƒç”¨<code>run_forever</code>æ—¶ï¼Œé¦–å…ˆä¼šç”¨<code>call_soon</code>æ–¹æ³•å°†<code>_loop_self_reading</code>æ–¹æ³•åŠ å…¥æ’æœŸã€‚<code>_loop_self_reading</code>æ–¹æ³•ä¼šè¯»å–<code>proactor</code>ä¸­çš„<code>future</code>ï¼Œå¹¶ä¸”å°†è‡ªå·±åŠ å…¥<code>future</code>çš„å®Œæˆæ—¶å›è°ƒï¼Œå®ç°ä¸é—´æ–­åœ°è¯»å–<code>future</code>å®ä¾‹ã€‚<br>â€‹</p>
<p>ä¹‹åï¼Œ<code>ProactorEventLoop</code>è°ƒç”¨äº†<code>BaseEventLoop</code>çš„<code>run_forever</code>æ–¹æ³•ï¼Œåœ¨å…¶ä¸­ä¼šä¸æ–­æ‰§è¡Œ<code>_run_once</code>æ–¹æ³•å»ä¸€ééåœ°è¿­ä»£äº‹ä»¶å¾ªç¯ã€‚ä¸€è½®<code>_run_once</code>ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>æ¸…ç†<code>_scheduled</code>ä¸­è¢«å–æ¶ˆçš„å®šæ—¶ä»»åŠ¡</li>
<li><code>select</code>å‡ºäº‹ä»¶åˆ—è¡¨å¹¶è¿›è¡Œå¤„ç†</li>
<li>ä»<code>_scheduled</code>å–å‡ºåˆ°æ—¶çš„ä»»åŠ¡ï¼ŒåŠ å…¥åˆ°<code>_ready</code>åˆ—è¡¨ä¸­<ul>
<li>ç”±ä¸Šé¢çš„é€»è¾‘ä¹Ÿå¯çŸ¥ï¼Œ<code>call_soon</code>çš„ä»»åŠ¡ä¹Ÿä¼šè¢«åŠ å…¥åˆ°<code>_ready</code>åˆ—è¡¨ä¸­</li>
</ul>
</li>
<li>ä»<code>_ready</code>åˆ—è¡¨ä¸­ä¾æ¬¡å–å‡ºæ‰€æœ‰<code>handle</code>ï¼Œè°ƒç”¨<code>_run</code>æ–¹æ³•è¿è¡Œ</li>
</ul>
<p>é€šè¿‡è¿™ç§æœºåˆ¶ï¼Œäº‹ä»¶å¾ªç¯å°±èƒ½æŒç»­ä¸æ–­åœ°è¿è¡Œä»»åŠ¡ã€‚<br>â€‹<br>ç”±ä¸Šè¿°<code>_run_once</code>çš„å®šä¹‰ä¹Ÿå¯çŸ¥ï¼Œåœ¨<code>select</code>äº‹ä»¶åˆ—è¡¨ä¸€æ­¥ä¼šå‡ºç°<code>IOCP</code>çš„èº«å½±ï¼Œè¿™æ˜¯å› ä¸º<code>BaseProactorEventLoop</code>çš„<code>selector</code>å°±æ˜¯<code>proactor</code>ï¼Œå®é™…ä¼ å…¥çš„å°±æ˜¯<code>IOCP</code>å®ä¾‹ï¼Œå› æ­¤æœ€ç»ˆå°±æ˜¯è°ƒç”¨äº†<code>IOCP</code>å®ä¾‹çš„<code>select</code>æ–¹æ³•ã€‚ä¹Ÿæ˜¯åªæœ‰åœ¨è¿™ä¸€æ­¥ï¼Œæ‰ä¼šå»å¤„ç†ä¸€äº›IOæ“ä½œã€‚<br>â€‹<br>æ‰€ä»¥é—®é¢˜æ¥äº†ï¼Œé’ˆå¯¹IOæ“ä½œï¼Œ<code>asyncio</code>æ˜¯å¦‚ä½•è¿›è¡Œè°ƒåº¦çš„å‘¢ï¼Ÿæˆ‘ä»¬é¦–å…ˆçœ‹<code>IocpProactor.select</code>çš„å®ç°ï¼š<br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># windows_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IocpProactor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(self, timeout=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._results:</span><br><span class="line">            self._poll(timeout)</span><br><span class="line">        tmp = self._results</span><br><span class="line">        self._results = []</span><br><span class="line">        <span class="keyword">return</span> tmp</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_poll</span><span class="params">(self, timeout=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> timeout <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            ms = INFINITE</span><br><span class="line">        <span class="keyword">elif</span> timeout &lt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"negative timeout"</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ms = math.ceil(timeout * <span class="number">1e3</span>)</span><br><span class="line">            <span class="keyword">if</span> ms &gt;= INFINITE:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">"timeout too big"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            status = _overlapped.GetQueuedCompletionStatus(self._iocp, ms)</span><br><span class="line">            <span class="keyword">if</span> status <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            ms = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">            err, transferred, key, address = status</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                f, ov, obj, callback = self._cache.pop(address)</span><br><span class="line">            <span class="keyword">except</span> KeyError:</span><br><span class="line">                <span class="keyword">if</span> self._loop.get_debug():</span><br><span class="line">                    self._loop.call_exception_handler(&#123;</span><br><span class="line">                        <span class="string">'message'</span>: (<span class="string">'GetQueuedCompletionStatus() returned an '</span></span><br><span class="line">                                    <span class="string">'unexpected event'</span>),</span><br><span class="line">                        <span class="string">'status'</span>: (<span class="string">'err=%s transferred=%s key=%#x address=%#x'</span></span><br><span class="line">                                   % (err, transferred, key, address)),</span><br><span class="line">                    &#125;)</span><br><span class="line">                <span class="keyword">if</span> key <span class="keyword">not</span> <span class="keyword">in</span> (<span class="number">0</span>, _overlapped.INVALID_HANDLE_VALUE):</span><br><span class="line">                    _winapi.CloseHandle(key)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> obj <span class="keyword">in</span> self._stopped_serving:</span><br><span class="line">                f.cancel()</span><br><span class="line">            <span class="keyword">elif</span> <span class="keyword">not</span> f.done():</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    value = callback(transferred, key, ov)</span><br><span class="line">                <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">                    f.set_exception(e)</span><br><span class="line">                    self._results.append(f)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    f.set_result(value)</span><br><span class="line">                    self._results.append(f)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Remove unregistered futures</span></span><br><span class="line">        <span class="keyword">for</span> ov <span class="keyword">in</span> self._unregistered:</span><br><span class="line">            self._cache.pop(ov.address, <span class="literal">None</span>)</span><br><span class="line">        self._unregistered.clear()</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>IocpProactor._poll</code>ä¸­ï¼Œä¼šè°ƒç”¨<code>GetQueuedCompletionStatus</code>å»æŸ¥è¯¢å®Œæˆç«¯å£çš„ç»“æœã€‚ç›´åˆ°æœ‰ç»“æœå‡ºç°ï¼Œæ‰ä¼šæ ¹æ®ç»“æœä¸­ç¼“å­˜çš„<code>address</code>æ•°æ®<code>pop</code>å‡ºç¼“å­˜çš„å›è°ƒå¹¶ä¸”æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡å‰–æä¸€ä¸ªIOæ“ä½œçš„ä¾‹å­ï¼Œæ¥è§‚å¯Ÿå…¶ä¸­å…·ä½“çš„å¥¥ç§˜ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HOST, PORT = <span class="string">'127.0.0.1'</span>, <span class="number">31077</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_svr_handler</span><span class="params">(reader: asyncio.StreamReader, writer: asyncio.StreamWriter)</span>:</span></span><br><span class="line">    data = <span class="keyword">await</span> reader.read(<span class="number">1024</span>)</span><br><span class="line">    msg = data.decode()</span><br><span class="line">    print(<span class="string">f'[Server] recv: <span class="subst">&#123;msg&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    msg_back = <span class="string">''</span>.join([msg[i] <span class="keyword">for</span> i <span class="keyword">in</span> range(len(msg) - <span class="number">1</span>, <span class="number">0</span>, <span class="number">-1</span>)])</span><br><span class="line">    print(<span class="string">f'[Server] send: <span class="subst">&#123;msg_back&#125;</span>'</span>)</span><br><span class="line">    writer.write(msg_back.encode())</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line"></span><br><span class="line">    writer.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_svr_task</span><span class="params">()</span>:</span></span><br><span class="line">    svr = <span class="keyword">await</span> asyncio.start_server(_svr_handler, host=HOST, port=PORT)</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> svr:</span><br><span class="line">        <span class="keyword">await</span> svr.serve_forever()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_svr</span><span class="params">()</span>:</span></span><br><span class="line">    asyncio.run(_svr_task())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_test_cli</span><span class="params">(msg: str)</span>:</span></span><br><span class="line">    reader, writer = <span class="keyword">await</span> asyncio.open_connection(HOST, PORT)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">f'[Client] send: <span class="subst">&#123;msg&#125;</span>'</span>)</span><br><span class="line">    writer.write(msg.encode())</span><br><span class="line">    <span class="keyword">await</span> writer.drain()</span><br><span class="line"></span><br><span class="line">    data = <span class="keyword">await</span> reader.read(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="string">f'[Client] recv: <span class="subst">&#123;data.decode()&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    writer.close()</span><br><span class="line">    <span class="keyword">await</span> writer.wait_closed()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_cli</span><span class="params">()</span>:</span></span><br><span class="line">    p = Process(target=_svr, daemon=<span class="literal">True</span>)</span><br><span class="line">    p.start()</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    _msg = <span class="string">'helloworld'</span></span><br><span class="line">    asyncio.run(_test_cli(_msg))</span><br><span class="line">    p.kill()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_cli()</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„<code>echo server</code>çš„å®ç°ï¼Œ<code>client</code>å‘é€ç»™<code>server</code>ä¿¡æ¯ï¼Œ<code>server</code>è¿”å›ä¿¡æ¯çš„<code>reverse</code>ã€‚æˆ‘ä»¬ä»¥<code>client</code>çš„å†™æ“ä½œ<code>writer.write</code>ä¸ºä¾‹ï¼Œçœ‹ä¸‹IOäº‹ä»¶æ˜¯å¦‚ä½•åœ¨äº‹ä»¶å¾ªç¯é‡Œè¢«å¤„ç†çš„ã€‚<br>â€‹</p>
<p>é¦–å…ˆï¼Œ<code>open_connection</code>å‡½æ•°åˆ›å»ºäº†å¯¹ç‰¹å®š<code>host</code>ã€<code>port</code>çš„è¿æ¥ï¼Œå¹¶è¿”å›è¿æ¥æµçš„<code>reader</code>è·Ÿ<code>writer</code>ã€‚<br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">open_connection</span><span class="params">(host=None, port=None, *,</span></span></span><br><span class="line"><span class="function"><span class="params">                          limit=_DEFAULT_LIMIT, **kwds)</span>:</span></span><br><span class="line">    loop = events.get_running_loop()</span><br><span class="line">    reader = StreamReader(limit=limit, loop=loop)</span><br><span class="line">    protocol = StreamReaderProtocol(reader, loop=loop)</span><br><span class="line">    transport, _ = <span class="keyword">await</span> loop.create_connection(</span><br><span class="line">        <span class="keyword">lambda</span>: protocol, host, port, **kwds)</span><br><span class="line">    writer = StreamWriter(transport, protocol, reader, loop)</span><br><span class="line">    <span class="keyword">return</span> reader, writer</span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹<code>reader</code>ï¼Œé¦–å…ˆä¼šåˆå§‹åŒ–ä¸€ä¸ª<code>StreamReader</code>å®ä¾‹ï¼Œå†ç”¨<code>StreamReaderProtocol</code>å¯¹<code>reader</code>åšè¿›ä¸€æ­¥çš„å°è£…ã€‚<br>â€‹</p>
<p>é’ˆå¯¹<code>writer</code>ï¼Œé¦–å…ˆä¼šé€šè¿‡<code>loop</code>çš„<code>create_connection</code>æ–¹æ³•ï¼Œé’ˆå¯¹æœ¬æ¬¡è¿æ¥åˆ›å»º<code>transport</code>å®ä¾‹ï¼Œç›¸å½“äºä¸€ä¸ªé€šä¿¡ç®¡é“çš„å°è£…ã€‚<code>transport</code>å®ä¾‹ä¼šä¸å…ˆå‰åˆ›å»ºçš„<code>StreamReaderProtocol</code>å®ä¾‹è¿›è¡Œç»‘å®šã€‚ç„¶åï¼Œå†å°†åˆ›å»ºçš„<code>transport</code>å®ä¾‹å’Œ<code>writer</code>ç»‘å®šã€‚<br>â€‹</p>
<p>åœ¨<code>ProactorEventLoop</code>ä¸­ï¼Œä¼šè¿™æ ·åˆ›å»º<code>transport</code>å®ä¾‹ï¼š<br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># proactor_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseProactorEventLoop</span><span class="params">(base_events.BaseEventLoop)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> _ProactorSocketTransport(self, sock, protocol, waiter,</span><br><span class="line">                                        extra, server)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ProactorSocketTransport</span><span class="params">(_ProactorReadPipeTransport,</span></span></span><br><span class="line"><span class="class"><span class="params">                               _ProactorBaseWritePipeTransport,</span></span></span><br><span class="line"><span class="class"><span class="params">                               transports.Transport)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, loop, sock, protocol, waiter=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                 extra=None, server=None)</span>:</span></span><br><span class="line">        super().__init__(loop, sock, protocol, waiter, extra, server)</span><br><span class="line">        base_events._set_nodelay(sock)</span><br></pre></td></tr></table></figure>
<p><code>_ProactorSocketTransport</code>å®ä¾‹ä¼šåŒæ—¶å¯¹<code>_ProactorReadPipeTransport</code>ä»¥åŠ<code>_ProactorBaseWritePipeTransport</code>çš„åˆå§‹åŒ–ï¼Œå› æ­¤ä¼šæä¾›å¯¹ç®¡é“è¯»å†™çš„åŠŸèƒ½ã€‚å…¶ç»§æ‰¿é“¾å¦‚ä¸‹ï¼š<br>â€‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(&lt;class &apos;asyncio.proactor_events._ProactorSocketTransport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.proactor_events._ProactorReadPipeTransport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.proactor_events._ProactorBaseWritePipeTransport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.proactor_events._ProactorBasePipeTransport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.transports._FlowControlMixin&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.transports.Transport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.transports.ReadTransport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.transports.WriteTransport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;asyncio.transports.BaseTransport&apos;&gt;,</span><br><span class="line"> &lt;class &apos;object&apos;&gt;)</span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œå½“å®¢æˆ·ç«¯å¼€å§‹å†™æ“ä½œï¼Œè°ƒç”¨<code>writer.write</code>æ—¶ï¼Œå®è´¨æ˜¯è¿›è¡Œäº†ä»¥ä¸‹æ“ä½œï¼š<br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># proactor_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ProactorBaseWritePipeTransport</span><span class="params">(_ProactorBasePipeTransport,</span></span></span><br><span class="line"><span class="class"><span class="params">                                      transports.WriteTransport)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="comment"># çœç•¥ä¸€äº›åˆ¤æ–­é€»è¾‘</span></span><br><span class="line">        <span class="comment"># Observable states:</span></span><br><span class="line">        <span class="comment"># 1. IDLE: _write_fut and _buffer both None</span></span><br><span class="line">        <span class="comment"># 2. WRITING: _write_fut set; _buffer None</span></span><br><span class="line">        <span class="comment"># 3. BACKED UP: _write_fut set; _buffer a bytearray</span></span><br><span class="line">        <span class="comment"># We always copy the data, so the caller can't modify it</span></span><br><span class="line">        <span class="comment"># while we're still waiting for the I/O to happen.</span></span><br><span class="line">        <span class="keyword">if</span> self._write_fut <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># IDLE -&gt; WRITING</span></span><br><span class="line">            <span class="keyword">assert</span> self._buffer <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">            <span class="comment"># Pass a copy, except if it's already immutable.</span></span><br><span class="line">            self._loop_writing(data=bytes(data))</span><br><span class="line">        <span class="keyword">elif</span> <span class="keyword">not</span> self._buffer:  <span class="comment"># WRITING -&gt; BACKED UP</span></span><br><span class="line">            <span class="comment"># Make a mutable copy which we can extend.</span></span><br><span class="line">            self._buffer = bytearray(data)</span><br><span class="line">            self._maybe_pause_protocol()</span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># BACKED UP</span></span><br><span class="line">            <span class="comment"># Append to buffer (also copies).</span></span><br><span class="line">            self._buffer.extend(data)</span><br><span class="line">            self._maybe_pause_protocol()</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_loop_writing</span><span class="params">(self, f=None, data=None)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> f <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> self._write_fut <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">and</span> self._closing:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">assert</span> f <span class="keyword">is</span> self._write_fut</span><br><span class="line">            self._write_fut = <span class="literal">None</span></span><br><span class="line">            self._pending_write = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> f:</span><br><span class="line">                f.result()</span><br><span class="line">            <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                data = self._buffer</span><br><span class="line">                self._buffer = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">if</span> self._closing:</span><br><span class="line">                    self._loop.call_soon(self._call_connection_lost, <span class="literal">None</span>)</span><br><span class="line">                <span class="keyword">if</span> self._eof_written:</span><br><span class="line">                    self._sock.shutdown(socket.SHUT_WR)</span><br><span class="line">                self._maybe_resume_protocol()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._write_fut = self._loop._proactor.send(self._sock, data)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> self._write_fut.done():</span><br><span class="line">                    <span class="keyword">assert</span> self._pending_write == <span class="number">0</span></span><br><span class="line">                    self._pending_write = len(data)</span><br><span class="line">                    self._write_fut.add_done_callback(self._loop_writing)</span><br><span class="line">                    self._maybe_pause_protocol()</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self._write_fut.add_done_callback(self._loop_writing)</span><br><span class="line">            <span class="keyword">if</span> self._empty_waiter <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> self._write_fut <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                self._empty_waiter.set_result(<span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">except</span> ConnectionResetError <span class="keyword">as</span> exc:</span><br><span class="line">            self._force_close(exc)</span><br><span class="line">        <span class="keyword">except</span> OSError <span class="keyword">as</span> exc:</span><br><span class="line">            self._fatal_error(exc, <span class="string">'Fatal write error on pipe transport'</span>)</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸€æ¬¡<code>write</code>æ—¶ï¼Œ<code>write_future</code>ä»¥åŠ<code>buffer</code>ä¸ºç©ºï¼Œå› æ­¤è§¦å‘äº†<code>_loop_writing</code>é€»è¾‘ã€‚åœ¨<code>_loop_writing</code>ä¸­ï¼Œè°ƒç”¨äº†<code>self._loop._proactor.send(self._sock, data)</code>ç”Ÿæˆäº†ä¸€ä¸ªå†™æ“ä½œçš„<code>future</code>ã€‚è€Œ<code>_proactor</code>ï¼Œä¹Ÿå°±æ˜¯åœ¨<code>ProactorEventLoop</code>é‡Œçš„<code>IocpProactor</code>å®ä¾‹äº†ã€‚<br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># windows_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IocpProactor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span><span class="params">(self, conn, buf, flags=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self._register_with_iocp(conn)</span><br><span class="line">        ov = _overlapped.Overlapped(NULL)</span><br><span class="line">        <span class="keyword">if</span> isinstance(conn, socket.socket):</span><br><span class="line">            ov.WSASend(conn.fileno(), buf, flags)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ov.WriteFile(conn.fileno(), buf)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">finish_send</span><span class="params">(trans, key, ov)</span>:</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> ov.getresult()</span><br><span class="line">            <span class="keyword">except</span> OSError <span class="keyword">as</span> exc:</span><br><span class="line">                <span class="keyword">if</span> exc.winerror <span class="keyword">in</span> (_overlapped.ERROR_NETNAME_DELETED,</span><br><span class="line">                                    _overlapped.ERROR_OPERATION_ABORTED):</span><br><span class="line">                    <span class="keyword">raise</span> ConnectionResetError(*exc.args)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> self._register(ov, conn, finish_send)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_register_with_iocp</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> obj <span class="keyword">not</span> <span class="keyword">in</span> self._registered:</span><br><span class="line">            self._registered.add(obj)</span><br><span class="line">            _overlapped.CreateIoCompletionPort(obj.fileno(), self._iocp, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_register</span><span class="params">(self, ov, obj, callback)</span>:</span></span><br><span class="line">        self._check_closed()</span><br><span class="line"></span><br><span class="line">        f = _OverlappedFuture(ov, loop=self._loop)</span><br><span class="line">        <span class="keyword">if</span> f._source_traceback:</span><br><span class="line">            <span class="keyword">del</span> f._source_traceback[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ov.pending:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                value = callback(<span class="literal">None</span>, <span class="literal">None</span>, ov)</span><br><span class="line">            <span class="keyword">except</span> OSError <span class="keyword">as</span> e:</span><br><span class="line">                f.set_exception(e)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                f.set_result(value)</span><br><span class="line"></span><br><span class="line">        self._cache[ov.address] = (f, ov, obj, callback)</span><br><span class="line">        <span class="keyword">return</span> f</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>send</code>æ–¹æ³•ä¸­ï¼Œåšäº†å¦‚ä¸‹æ“ä½œï¼š<br>â€‹</p>
<ul>
<li>é€šè¿‡<code>CreateIoCompletionPort</code>æ³¨å†Œ<code>socket</code>åˆ°å®Œæˆç«¯å£</li>
<li>åˆ›å»ºä¸€ä¸ª<code>Overlapped</code>å®ä¾‹ï¼Œé€šè¿‡<code>WSASend</code>å‘é€æ•°æ®åˆ°<code>socket</code></li>
<li>åˆ›å»ºä¸€ä¸ªå…³è”<code>Overlapped</code>å®ä¾‹çš„<code>future</code>ï¼Œå¹¶ä¸”åˆ¤æ–­<code>Overlapped</code>å®ä¾‹å¦‚æœä¸åœ¨<code>pending</code>çŠ¶æ€å°±ç›´æ¥æ‰§è¡Œå›è°ƒã€‚ä¹‹åï¼Œç¼“å­˜è¿™ä¸ª<code>future</code>å®ä¾‹åˆ°<code>_cache</code>ä¸­ã€‚</li>
</ul>
<p>â€‹<br>åœ¨å…ˆå‰å·²ç»æåˆ°ï¼Œäº‹ä»¶å¾ªç¯æ‰§è¡Œæ—¶ï¼Œ<code>IocpProactor</code>å®ä¾‹ä¼šè°ƒç”¨<code>_poll</code>æ–¹æ³•ï¼Œå…¶ä¸­ä¼šé‡‡ç”¨<code>GetQueuedCompletionStatus</code>æŸ¥è¯¢IOæ“ä½œå®Œæˆç»“æœã€‚å¦‚æœå‘ç°æœ‰IOæ“ä½œå®Œæˆï¼Œå°±ä¼šä»æ“ä½œä¸­æå–<code>ov.address</code>å¹¶åœ¨<code>_cache</code>ä¸­<code>pop</code>å‡ºå›è°ƒç„¶åæ‰§è¡Œã€‚è¿™æ ·é€šè¿‡<code>IOCP</code>æ¨¡å‹åŠ ä¸Šäº‹ä»¶å¾ªç¯ï¼ˆäº‹ä»¶å¾ªç¯å®è´¨å°±æ˜¯<code>IOCP</code>é‡Œå¤´çš„<code>worker</code>ï¼‰ï¼Œå°±æŠŠ<code>writer.write</code>çš„æ“ä½œä»å¼€å§‹åˆ°å®Œæˆçš„æ­¥éª¤ç»™ä¸²èµ·æ¥äº†ã€‚<br>â€‹<br>ä¹‹åå°±æ˜¯<code>await writer.drain</code>ï¼Œå®è´¨æ˜¯åšäº†å¦‚ä¸‹æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># streams.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StreamWriter</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">drain</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">await</span> self._protocol._drain_helper()</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlowControlMixin</span><span class="params">(protocols.Protocol)</span>:</span>  <span class="comment"># è¿™ä¸ªä¼šè¢«StreamReaderProtocolç»§æ‰¿</span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_drain_helper</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self._connection_lost:</span><br><span class="line">            <span class="keyword">raise</span> ConnectionResetError(<span class="string">'Connection lost'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._paused:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        waiter = self._drain_waiter</span><br><span class="line">        <span class="keyword">assert</span> waiter <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> waiter.cancelled()</span><br><span class="line">        waiter = self._loop.create_future()</span><br><span class="line">        self._drain_waiter = waiter</span><br><span class="line">        <span class="keyword">await</span> waiter</span><br></pre></td></tr></table></figure>
<p><code>writer.drain</code>å®è´¨ä¸Šæ˜¯<code>await</code>äº†<code>StreamReaderProtocol</code>å®ä¾‹çš„<code>_drain_helper</code>åç¨‹ï¼Œå…¶ä¸­åšäº†ä¸€äº›å‰ç½®æ£€æŸ¥ï¼Œç„¶åä¾æ®å½“å‰äº‹ä»¶å¾ªç¯è®¾ç½®äº†ä¸€ä¸ª<code>_drain_waiter</code>çš„<code>future</code>å®ä¾‹ï¼Œå¹¶<code>await</code>ã€‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿ<br>â€‹<br>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿå¾—çŸ¥ï¼Œåœ¨<code>_run_once</code>çš„é€»è¾‘ä¸­ï¼Œå¦‚æœ<code>_ready</code>é˜Ÿåˆ—æœ‰ä»»åŠ¡ï¼Œæˆ–è€…æ˜¯æœ‰<code>_scheduled</code>é‡Œå¤´çš„å®šæ—¶ä»»åŠ¡ï¼Œé‚£ä¹ˆä¹‹å<code>IocpProactor._poll</code>é‡Œå¤´çš„<code>GetQueuedCompletionStatus</code>å°±ä¼šæœ‰<code>timeout</code>ï¼Œå¦åˆ™<code>GetQueuedCompletionStatus</code>å¯¹åº”çš„<code>timeout</code>å°±æ˜¯<code>INFINITE</code>ï¼Œä¼šä¸€ç›´é˜»å¡ç›´åˆ°æœ‰IOäº‹ä»¶å®Œæˆã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åˆ›å»ºä¸€ä¸ªåç¨‹ä»»åŠ¡ï¼Œé‡Œå¤´<code>create_future</code>ä¹‹å<code>await</code>ä¸‹ï¼Œä¸€è¯•ä¾¿çŸ¥ã€‚</p>
<p>ç„¶åï¼Œå›åˆ°<code>_ProactorBaseWritePipeTransport</code>çš„<code>_loop_writing</code>æ–¹æ³•ã€‚<code>_write_fut</code>è¢«åˆ›å»ºåï¼Œä¼šç›´æ¥æ·»åŠ <code>_loop_writing</code>ä¸ºè‡ªå·±çš„å®Œæˆå›è°ƒã€‚å½“<code>IocpProactor</code>å®ä¾‹ç”±<code>GetQueuedCompletionStatus</code>è·å¾—ä¸€ä¸ªå®Œæˆäº‹ä»¶ä¹‹åï¼Œä¼šå–å‡ºæ¥æ‰§è¡Œ<code>ov.getresult()</code>ï¼ˆåœ¨<code>send</code>æ–¹æ³•çš„<code>finish_send</code>é‡Œå¤´ï¼‰æ¥è·å–ç»“æœï¼Œè¿™ä¸ªç»“æœå°±ä¼šè¢«æ”¾åˆ°<code>_write_fut</code>ä½œä¸ºå…¶æœ€ç»ˆçš„è¿”å›ç»“æœã€‚æ­¤æ—¶<code>_write_fut</code>ç”±äºå®Œæˆäº†ï¼Œå› æ­¤ä¼šè°ƒç”¨è‡ªå·±çš„å›è°ƒ<code>_loop_writing</code>ï¼Œä½†è¿™ä¸ªæ—¶å€™å› ä¸º<code>buffer</code>é‡Œæ²¡æœ‰æ•°æ®äº†ï¼Œæ‰€ä»¥å°±ä¼šèµ°åˆ°<code>_maybe_resume_protocol</code><br>â€‹</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># transports.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_FlowControlMixin</span><span class="params">(Transport)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_maybe_resume_protocol</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (self._protocol_paused <span class="keyword">and</span></span><br><span class="line">                self.get_write_buffer_size() &lt;= self._low_water):</span><br><span class="line">            self._protocol_paused = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self._protocol.resume_writing()</span><br><span class="line">            <span class="keyword">except</span> (SystemExit, KeyboardInterrupt):</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">            <span class="keyword">except</span> BaseException <span class="keyword">as</span> exc:</span><br><span class="line">                self._loop.call_exception_handler(&#123;</span><br><span class="line">                    <span class="string">'message'</span>: <span class="string">'protocol.resume_writing() failed'</span>,</span><br><span class="line">                    <span class="string">'exception'</span>: exc,</span><br><span class="line">                    <span class="string">'transport'</span>: self,</span><br><span class="line">                    <span class="string">'protocol'</span>: self._protocol,</span><br><span class="line">                &#125;)</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line"><span class="comment"># streams.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlowControlMixin</span><span class="params">(protocols.Protocol)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">resume_writing</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> self._paused</span><br><span class="line">        self._paused = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">if</span> self._loop.get_debug():</span><br><span class="line">            logger.debug(<span class="string">"%r resumes writing"</span>, self)</span><br><span class="line"></span><br><span class="line">        waiter = self._drain_waiter</span><br><span class="line">        <span class="keyword">if</span> waiter <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self._drain_waiter = <span class="literal">None</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> waiter.done():</span><br><span class="line">                waiter.set_result(<span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>writer.drain</code>ä¸­ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯ä¸€ç›´åœ¨<code>await</code>è¿™ä¸ª<code>_drain_waiter</code>ã€‚åœ¨è°ƒç”¨<code>_maybe_resume_protocol</code>ä¹‹åï¼Œå®é™…æ˜¯èµ°åˆ°äº†<code>StreamReaderProtocol</code>å®ä¾‹çš„<code>resume_writing</code>æ–¹æ³•ï¼Œåœ¨<code>FlowControlMixin</code>ç±»è¢«å®šä¹‰ã€‚è¿™ä¸ªæ–¹æ³•æ‰§è¡Œäº†ä¸¤ä¸ªæ“ä½œï¼š<br>â€‹</p>
<ul>
<li>å°†<code>_paused</code>çŠ¶æ€ç½®ä¸º<code>False</code><ul>
<li><code>_loop_writing</code>ä¸­ï¼Œå¦‚æœæ•°æ®æ²¡å‘å®Œï¼Œå°±ä¼šå¦å¤–èµ°åˆ°<code>_maybe_pause_protocol</code>ï¼Œä¼šæŠŠè¿™ä¸ªçŠ¶æ€ç½®ä¸º<code>true</code>ã€‚æ­¤æ—¶è°ƒç”¨<code>await writer.drain</code>ï¼Œå°±æ­£å¥½ä¼šèµ°åˆ°äº†<code>await _drain_waiter</code></li>
</ul>
</li>
<li>å°†<code>_drain_waiter</code>è®¾ç½®å®Œæˆã€‚è¿™æ ·ï¼Œ<code>await writer.drain</code>å°±èƒ½å®Œæˆäº†</li>
</ul>
<p>å®¢æˆ·ç«¯çš„å†™æ“ä½œï¼Œåœ¨äº‹ä»¶å¾ªç¯é‡Œå°±æ˜¯é€šè¿‡å¦‚ä¸Šå¤æ‚çš„æ–¹å¼è°ƒåº¦çš„ã€‚æ€»çš„æ¥è¯´ï¼Œæ˜¯å¦‚ä¸‹çš„æ­¥éª¤ï¼š<br>â€‹</p>
<ul>
<li>ç”¨æˆ·è°ƒç”¨<code>writer.write</code>å°†æ•°æ®ä¼ è¿›<code>transport</code>çš„å†™<code>buffer</code></li>
<li><code>transport</code>çš„<code>_loop_writing</code>å‘ç°<code>buffer</code>æœ‰æ•°æ®ï¼Œåˆ›å»ºä¸€ä¸ªå†™<code>future</code><ul>
<li>é€šè¿‡<code>CreateIoCompletionPort</code>ç»‘å®š<code>socket</code>è·Ÿå®Œæˆç«¯å£</li>
<li>é€šè¿‡<code>WSASend</code>å‘é€æ•°æ®</li>
<li>è®¾ç½®ä¸€ä¸ªå›è°ƒç”¨æ¥å–å‘é€æ•°æ®çš„ç»“æœ</li>
<li>å–å‡ºæ¥çš„ç»“æœç»™åˆ°å†™<code>future</code></li>
<li>å†™<code>future</code>é¢„å…ˆè®¾ç½®<code>_loop_writing</code>ä¸ºå®Œæˆå›è°ƒï¼Œå¾—åˆ°ç»“æœåæ‰§è¡Œä¸‹ä¸€è½®<code>_loop_writing</code></li>
</ul>
</li>
<li>ç”¨æˆ·è°ƒç”¨<code>await writer.drain</code><ul>
<li>å†™<code>future</code>åœ¨åˆ›å»ºåï¼Œå‘ç°å†™<code>future</code>æ²¡æœ‰åˆ°å®ŒæˆçŠ¶æ€ï¼Œå…ˆè°ƒç”¨<code>_maybe_pause_protocol</code>è®¾ç½®<code>protocol</code>çš„<code>_paused</code>ä¸º<code>True</code></li>
<li>åœ¨<code>writer.drain</code>é‡Œåˆ¤æ–­<code>protocol</code>ä¸º<code>_paused</code>ï¼Œé‡ç½®<code>_drain_waiter</code>ä¸ºæ–°çš„å®ä¾‹å¹¶<code>await</code></li>
<li>å†™æ“ä½œå®Œæˆï¼Œè§¦å‘å†™<code>future</code>çš„å›è°ƒ<code>_loop_writing</code>ã€‚ä¸‹ä¸€è½®<code>_loop_writing</code>å‘ç°æ²¡æœ‰æ•°æ®å‘é€ï¼Œè°ƒç”¨<code>_maybe_resume_protocol</code>ï¼Œè®¾ç½®<code>protocol</code>çš„<code>_paused</code>ä¸º<code>False</code>ï¼Œå¹¶è®¾ç½®<code>_drain_waiter</code>ä¸ºå®Œæˆ</li>
<li><code>_drain_waiter</code>å®Œæˆï¼Œé€€å‡º<code>await writer.drain</code></li>
</ul>
</li>
</ul>
<p>é’ˆå¯¹è¯»æ“ä½œï¼Œä»¥åŠå…¶å®ƒçš„IOæ“ä½œï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥æ·±å…¥ç ”ç©¶^_^</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>äº‹ä»¶å¾ªç¯</tag>
        <tag>å¼‚æ­¥</tag>
        <tag>python</tag>
        <tag>asyncio</tag>
        <tag>proactor</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬äºŒç« -å¼‚æ­¥IOã€‘1ã€asyncioäº‹ä»¶å¾ªç¯çš„åˆ›å»º</title>
    <url>/2022/02/12/hardpython/2_asyncio_1/</url>
    <content><![CDATA[<p>python3ä¸­å¢åŠ çš„é‡è¦ç‰¹æ€§ä¹‹ä¸€å³ä¸º<code>asyncio</code>ï¼Œå…¶æä¾›äº†å¼‚æ­¥ç¼–ç¨‹çš„åŸè¯­æ”¯æŒï¼Œä»è€Œèƒ½å¤Ÿè®©pythonåœ¨äº‹ä»¶é©±åŠ¨ã€åç¨‹ååŒç­‰æ–¹é¢çš„ç¼–ç¨‹åœºæ™¯å¤§æ€å››æ–¹ã€‚</p>
<p>äº‹ä»¶å¾ªç¯<code>EventLoop</code>æ˜¯å¼‚æ­¥ç¼–ç¨‹ä¸­çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚pythonçš„å¼‚æ­¥IOï¼Œå°±ä»äº‹ä»¶å¾ªç¯çš„å®ç°å¼€å§‹è®²èµ·ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">_test_run_main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">3</span>):</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">        print(<span class="string">f'[test_run] <span class="subst">&#123;i&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_run</span><span class="params">()</span>:</span></span><br><span class="line">    coro = _test_run_main()</span><br><span class="line">    asyncio.run(coro)</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>async def</code>å®šä¹‰çš„å‡½æ•°ï¼Œå…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªå¼‚æ­¥åç¨‹<code>coroutine</code>ã€‚åç¨‹ç›¸å½“äºæ˜¯äº‹ä»¶å¾ªç¯é‡Œçš„ä¸€ä¸ªå•ä½ä»»åŠ¡ï¼Œé€šè¿‡<code>asyncio.run</code>æ¥å£å°±å¯ä»¥å°†å…¶è¿è¡Œèµ·æ¥ã€‚å› æ­¤æˆ‘ä»¬å…ˆæ¥çœ‹<code>asyncio.run</code>çš„å®ç°ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(main, *, debug=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> events._get_running_loop() <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(</span><br><span class="line">            <span class="string">"asyncio.run() cannot be called from a running event loop"</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> coroutines.iscoroutine(main):</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"a coroutine was expected, got &#123;!r&#125;"</span>.format(main))</span><br><span class="line"></span><br><span class="line">    loop = events.new_event_loop()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        events.set_event_loop(loop)</span><br><span class="line">        <span class="keyword">if</span> debug <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            loop.set_debug(debug)</span><br><span class="line">        <span class="keyword">return</span> loop.run_until_complete(main)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _cancel_all_tasks(loop)</span><br><span class="line">            loop.run_until_complete(loop.shutdown_asyncgens())</span><br><span class="line">            loop.run_until_complete(loop.shutdown_default_executor())</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            events.set_event_loop(<span class="literal">None</span>)</span><br><span class="line">            loop.close()</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>asyncio.run</code>ä¸­ï¼Œé¦–å…ˆä¼šæ£€æŸ¥åç¨‹åˆæ³•æ€§ä»¥åŠå½“å‰çº¿ç¨‹æ˜¯å¦æœ‰å·²åœ¨è·‘çš„äº‹ä»¶å¾ªç¯ï¼Œä¹‹åä¼šæ–°å¯åŠ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå¹¶è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹åœ¨è·‘çš„äº‹ä»¶å¾ªç¯ï¼Œæœ€åç­‰å¾…åç¨‹å®Œæˆã€‚å®Œæˆåï¼Œä¼šå…³é—­äº‹ä»¶å¾ªç¯ï¼Œå¹¶å–æ¶ˆå½“å‰çº¿ç¨‹äº‹ä»¶å¾ªç¯çš„è®¾ç½®ã€‚</p>
<p>äº‹ä»¶å¾ªç¯çš„è¯ç”Ÿï¼Œä¾¿æ˜¯ä»<code>new_event_loop</code>æ–¹æ³•å¼€å§‹äº†ã€‚ä»¥windowsä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å½“åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯æ—¶ï¼Œä¼šå‘ç”Ÿå“ªäº›è°ƒç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># runners.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">new_event_loop</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> get_event_loop_policy().new_event_loop()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># events.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_init_event_loop_policy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> _event_loop_policy</span><br><span class="line">    <span class="keyword">with</span> _lock:</span><br><span class="line">        <span class="keyword">if</span> _event_loop_policy <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># pragma: no branch</span></span><br><span class="line">            <span class="keyword">from</span> . <span class="keyword">import</span> DefaultEventLoopPolicy</span><br><span class="line">            _event_loop_policy = DefaultEventLoopPolicy()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_event_loop_policy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""Get the current event loop policy."""</span></span><br><span class="line">    <span class="keyword">if</span> _event_loop_policy <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        _init_event_loop_policy()</span><br><span class="line">    <span class="keyword">return</span> _event_loop_policy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># windows_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WindowsProactorEventLoopPolicy</span><span class="params">(events.BaseDefaultEventLoopPolicy)</span>:</span></span><br><span class="line">    _loop_factory = ProactorEventLoop</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">DefaultEventLoopPolicy = WindowsProactorEventLoopPolicy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseDefaultEventLoopPolicy</span><span class="params">(AbstractEventLoopPolicy)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new_event_loop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._loop_factory()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># windows_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProactorEventLoop</span><span class="params">(proactor_events.BaseProactorEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, proactor=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> proactor <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            proactor = IocpProactor()</span><br><span class="line">        super().__init__(proactor)</span><br></pre></td></tr></table></figure>
<p>äº‹ä»¶å¾ªç¯åˆ›å»ºçš„ç­–ç•¥æœ‰å¤šç§ï¼Œåœ¨è°ƒç”¨<code>new_event_loop</code>æ—¶ï¼Œå®è´¨æ˜¯æ‰§è¡Œé»˜è®¤äº‹ä»¶å¾ªç¯ç­–ç•¥çš„åˆ›å»ºæ–¹æ³•ã€‚ä»¥windowsä¸ºä¾‹ï¼Œé»˜è®¤ç­–ç•¥æ˜¯<code>ProactorEventLoop</code>ã€‚</p>
<p><code>proactor</code>æ¨¡å‹æœ¬èº«ä¸ºå¼‚æ­¥IOè€Œç”Ÿï¼Œå…¶åŸºæœ¬å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”¨æˆ·æ€åº”ç”¨é¢„å…ˆè®¾å®šä¸€ç»„é’ˆå¯¹ä¸åŒIOæ“ä½œå®Œæˆäº‹ä»¶çš„å›è°ƒï¼ˆ<code>Handler</code>ï¼‰ï¼ŒåŒæ—¶å‘å†…æ ¸æ³¨å†Œä¸€ä¸ªå®Œæˆäº‹ä»¶çš„<code>dispatcher</code>ï¼ˆä¹Ÿå°±æ˜¯<code>proactor</code>ï¼‰</li>
<li>ç”¨æˆ·æ€çº¿ç¨‹å‘èµ·å¼‚æ­¥IOæ“ä½œåä¼šå³åˆ»è¿”å›ç»“æœ</li>
<li>IOæ“ä½œåœ¨å†…æ ¸æ‰§è¡Œå®Œæˆåä¼šé€šçŸ¥<code>proactor</code>ï¼Œ<code>proactor</code>æ ¹æ®å®Œæˆäº‹ä»¶çš„ç±»å‹ï¼Œè§¦å‘å¯¹åº”çš„å®Œæˆäº‹ä»¶å›è°ƒ</li>
</ul>
<p>åœ¨windowsä¸‹<code>ProactorEventLoop</code>å®é™…æ˜¯ä½¿ç”¨äº†<code>IOCP</code>æ¨¡å‹ï¼Œä¸­æ–‡ç¿»è¯‘å«IOå®Œæˆç«¯å£ï¼Œå…¶åŸºæœ¬å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<ul>
<li>é€šè¿‡<code>CreateIoCompletionPort</code>åˆ›å»ºå®Œæˆç«¯å£<ul>
<li>å®Œæˆç«¯å£ï¼Œå®è´¨æ˜¯ä¸€ä¸ªç”¨äºç¼“å­˜IOå®Œæˆäº‹ä»¶çš„é˜Ÿåˆ—</li>
</ul>
</li>
<li>åˆ›å»ºä¸€ç»„<code>worker thread</code>å…³è”å®Œæˆç«¯å£</li>
<li>åˆ›å»º<code>listen server</code></li>
<li><code>listen server</code>åœ¨<code>accept</code>åˆ°å®¢æˆ·ç«¯è¿æ¥åï¼Œåˆ›å»º<code>PerHandleData</code>å®ä¾‹ï¼Œå°†å®¢æˆ·ç«¯<code>socket</code>ä¸<code>PerHandleData</code>å®ä¾‹ä¸å®Œæˆç«¯å£å…³è”èµ·æ¥ã€‚æ‰§è¡Œä¸Šè¿°çš„å…³è”åï¼Œå¯ä»¥é€šè¿‡<code>WSARecv</code>å‘èµ·æ¥æ”¶å®¢æˆ·ç«¯æ•°æ®çš„å¼‚æ­¥IOæ“ä½œï¼Œç„¶åç»§ç»­<code>accept</code></li>
<li>åœ¨<code>worker thread</code>ä¸­ï¼Œé€šè¿‡<code>GetQueueCompletionStatus</code>æ–¹æ³•è·å–IOæ“ä½œçš„å®Œæˆç»“æœã€‚å¦‚<code>WSARecv</code>å®Œæˆåï¼Œå¯ä»¥ç›´æ¥æå–æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯æ•°æ®ï¼Œæ‰§è¡Œå¯¹åº”çš„æ“ä½œ</li>
<li><code>listen server</code>é€€å‡ºï¼Œé€šè¿‡<code>PostQueuedCompletionStatus</code>å‘å®Œæˆç«¯å£å‘é€ç‰¹æ®Šçš„æ•°æ®åŒ…ï¼Œç”¨ä»¥è®©<code>worker thread</code>é€€å‡º</li>
</ul>
<p>äº†è§£äº†<code>proactor</code>å’Œ<code>iocp</code>çš„åŸºæœ¬å·¥ä½œåŸç†åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹pythonç‰ˆ<code>ProactorEventLoop</code>çš„å…·ä½“å®ç°äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># windows_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IocpProactor</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, concurrency=<span class="number">0xffffffff</span>)</span>:</span></span><br><span class="line">        self._loop = <span class="literal">None</span></span><br><span class="line">        self._results = []</span><br><span class="line">        self._iocp = _overlapped.CreateIoCompletionPort(</span><br><span class="line">            _overlapped.INVALID_HANDLE_VALUE, NULL, <span class="number">0</span>, concurrency)</span><br><span class="line">        self._cache = &#123;&#125;</span><br><span class="line">        self._registered = weakref.WeakSet()</span><br><span class="line">        self._unregistered = []</span><br><span class="line">        self._stopped_serving = weakref.WeakSet()</span><br><span class="line">        </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProactorEventLoop</span><span class="params">(proactor_events.BaseProactorEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, proactor=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> proactor <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            proactor = IocpProactor()</span><br><span class="line">        super().__init__(proactor)</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="comment"># proactor_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseProactorEventLoop</span><span class="params">(base_events.BaseEventLoop)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, proactor)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        logger.debug(<span class="string">'Using proactor: %s'</span>, proactor.__class__.__name__)</span><br><span class="line">        self._proactor = proactor</span><br><span class="line">        self._selector = proactor   <span class="comment"># convenient alias</span></span><br><span class="line">        self._self_reading_future = <span class="literal">None</span></span><br><span class="line">        self._accept_futures = &#123;&#125;   <span class="comment"># socket file descriptor =&gt; Future</span></span><br><span class="line">        proactor.set_loop(self)</span><br><span class="line">        self._make_self_pipe()</span><br><span class="line">        <span class="keyword">if</span> threading.current_thread() <span class="keyword">is</span> threading.main_thread():</span><br><span class="line">            <span class="comment"># wakeup fd can only be installed to a file descriptor from the main thread</span></span><br><span class="line">            signal.set_wakeup_fd(self._csock.fileno())</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_make_self_pipe</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># A self-socket, really. :-)</span></span><br><span class="line">        self._ssock, self._csock = socket.socketpair()</span><br><span class="line">        self._ssock.setblocking(<span class="literal">False</span>)</span><br><span class="line">        self._csock.setblocking(<span class="literal">False</span>)</span><br><span class="line">        self._internal_fds += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="comment"># base_events.py</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseEventLoop</span><span class="params">(events.AbstractEventLoop)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._timer_cancelled_count = <span class="number">0</span></span><br><span class="line">        self._closed = <span class="literal">False</span></span><br><span class="line">        self._stopping = <span class="literal">False</span></span><br><span class="line">        self._ready = collections.deque()</span><br><span class="line">        self._scheduled = []</span><br><span class="line">        self._default_executor = <span class="literal">None</span></span><br><span class="line">        self._internal_fds = <span class="number">0</span></span><br><span class="line">        <span class="comment"># Identifier of the thread running the event loop, or None if the</span></span><br><span class="line">        <span class="comment"># event loop is not running</span></span><br><span class="line">        self._thread_id = <span class="literal">None</span></span><br><span class="line">        self._clock_resolution = time.get_clock_info(<span class="string">'monotonic'</span>).resolution</span><br><span class="line">        self._exception_handler = <span class="literal">None</span></span><br><span class="line">        self.set_debug(coroutines._is_debug_mode())</span><br><span class="line">        <span class="comment"># In debug mode, if the execution of a callback or a step of a task</span></span><br><span class="line">        <span class="comment"># exceed this duration in seconds, the slow callback/task is logged.</span></span><br><span class="line">        self.slow_callback_duration = <span class="number">0.1</span></span><br><span class="line">        self._current_handle = <span class="literal">None</span></span><br><span class="line">        self._task_factory = <span class="literal">None</span></span><br><span class="line">        self._coroutine_origin_tracking_enabled = <span class="literal">False</span></span><br><span class="line">        self._coroutine_origin_tracking_saved_depth = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># A weak set of all asynchronous generators that are</span></span><br><span class="line">        <span class="comment"># being iterated by the loop.</span></span><br><span class="line">        self._asyncgens = weakref.WeakSet()</span><br><span class="line">        <span class="comment"># Set to True when `loop.shutdown_asyncgens` is called.</span></span><br><span class="line">        self._asyncgens_shutdown_called = <span class="literal">False</span></span><br><span class="line">        <span class="comment"># Set to True when `loop.shutdown_default_executor` is called.</span></span><br><span class="line">        self._executor_shutdown_called = <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<p>å½“<code>ProactorEventLoop</code>å®ä¾‹åˆå§‹åŒ–æ—¶ï¼Œä¼šå…ˆåˆ›å»º<code>IocpProactor</code>å®ä¾‹ï¼Œé‡Œé¢é€šè¿‡<code>CreateIoCompletionPort</code>åˆ›å»ºäº†ä¸€ä¸ªå®Œæˆç«¯å£ã€‚ä¹‹åå†è°ƒç”¨<code>BaseProactorEventLoop</code>çš„åˆå§‹åŒ–å‡½æ•°ã€‚<code>BaseProactorEventLoop</code>å…ˆåˆå§‹åŒ–<code>BaseEventLoop</code>ï¼Œç„¶åè®¾ç½®<code>proactor</code>ï¼Œå¹¶åˆ›å»ºäº†ä¸€ç»„<code>socketpair</code>ã€‚</p>
<p>è¿™æ ·ï¼Œäº‹ä»¶å¾ªç¯çš„å®ä¾‹å°±è¢«åˆ›å»ºå‡ºæ¥äº†ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>äº‹ä»¶å¾ªç¯</tag>
        <tag>python</tag>
        <tag>asyncio</tag>
        <tag>proactor</tag>
        <tag>iocp</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬ä¸€ç« -å¤šè¿›ç¨‹ã€‘3ã€Poolï¼Œå¤šä»»åŠ¡å¹¶è¡Œè¿›ç¨‹æ± </title>
    <url>/2022/01/30/hardpython/1_multiprocessing_3/</url>
    <content><![CDATA[<p>å‰é¢è®²äº†è¿›ç¨‹åˆ›å»ºä¸è¿›ç¨‹é€šä¿¡çš„å†…å®¹ï¼Œæ¥ä¸‹æ¥è®²ä¸€ä¸‹å¤šè¿›ç¨‹ç¼–ç¨‹æœ€èƒ½å‘æŒ¥çš„åœ°æ–¹ã€‚å¯¹äºåŒæ—¶è¿è¡Œå¤šä¸ªåŒè´¨ä»»åŠ¡æ¥è®²ï¼Œé‡‡ç”¨<code>multiprocessing.Pool</code>è¿›ç¨‹æ± å»ç®¡ç†æ˜¯æœ€æ–¹ä¾¿çš„ã€‚<code>Pool</code>çš„ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, process</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test_func</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    result = a + b</span><br><span class="line">    print(<span class="string">f'<span class="subst">&#123;os.getpid()&#125;</span>: <span class="subst">&#123;result&#125;</span>'</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_pool</span><span class="params">()</span>:</span></span><br><span class="line">    test_data = [(<span class="number">2</span> * i, <span class="number">2</span> * i + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">    <span class="keyword">with</span> Pool(<span class="number">4</span>) <span class="keyword">as</span> p:</span><br><span class="line">        pprint.pprint(process.active_children())</span><br><span class="line">        results = p.starmap(_test_func, test_data)  <span class="comment"># starmapæŒ‡iterableçš„unpackï¼Œ*argsè¿™æ ·ï¼Œè¯¦æƒ…çœ‹æºç æ³¨é‡Š</span></span><br><span class="line">        print(<span class="string">f'<span class="subst">&#123;os.getpid()&#125;</span>: <span class="subst">&#123;results&#125;</span>'</span>)  <span class="comment"># å¾—åˆ°_test_funcçš„æ‰€æœ‰ç»“æœ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_pool()</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºæ¥çš„ç»“æœï¼Œå¯èƒ½æ˜¯è¿™æ ·å­çš„ï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[&lt;SpawnProcess name=&apos;SpawnPoolWorker-4&apos; pid=7648 parent=2468 started daemon&gt;,</span><br><span class="line"> &lt;SpawnProcess name=&apos;SpawnPoolWorker-3&apos; pid=15812 parent=2468 started daemon&gt;,</span><br><span class="line"> &lt;SpawnProcess name=&apos;SpawnPoolWorker-1&apos; pid=3496 parent=2468 started daemon&gt;,</span><br><span class="line"> &lt;SpawnProcess name=&apos;SpawnPoolWorker-2&apos; pid=3120 parent=2468 started daemon&gt;]</span><br><span class="line">3496: 1</span><br><span class="line">3496: 5</span><br><span class="line">3496: 9</span><br><span class="line">3496: 13</span><br><span class="line">3496: 17</span><br><span class="line">3496: 21</span><br><span class="line">3496: 25</span><br><span class="line">3496: 29</span><br><span class="line">3496: 33</span><br><span class="line">3496: 37</span><br><span class="line">3496: 41</span><br><span class="line">3496: 45</span><br><span class="line">3496: 49</span><br><span class="line">3496: 53</span><br><span class="line">3496: 57</span><br><span class="line">3496: 61</span><br><span class="line">2468: [1, 5, 9, 13, 17, 21, 25, 29, 33, 37, 41, 45, 49, 53, 57, 61]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ç»“æœä¸­çœ‹åˆ°è¿™æ ·çš„æ™¯è±¡ï¼š</p>
<ul>
<li>å½“è¿›å…¥<code>with Pool</code>ä»£ç æ®µæ—¶ï¼Œè¿›ç¨‹æ± ä¸­çš„è¿›ç¨‹å·²ç»è¢«é¢„å…ˆåˆ›å»ºäº†</li>
<li>æ€»å…±16ä¸ªä»»åŠ¡ï¼Œæœ€åå´åªåœ¨è¿›ç¨‹æ± é‡Œå•ç‹¬1ä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼ˆå°æ¦‚ç‡åœ¨2ä¸ªè¿›ç¨‹ä¸­è¿è¡Œï¼‰</li>
</ul>
<p>å…·ä½“ç¼˜ç”±ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹<code>Pool</code>çš„ä»£ç å®ç°ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pool</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, processes=None, initializer=None, initargs=<span class="params">()</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                 maxtasksperchild=None, context=None)</span>:</span></span><br><span class="line">        <span class="comment"># å¿½ç•¥ä¸€äº›åˆå§‹å˜é‡è®¾ç½®</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># processes</span></span><br><span class="line">        self._processes = processes</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._repopulate_pool()</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> self._pool:</span><br><span class="line">                <span class="keyword">if</span> p.exitcode <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    p.terminate()</span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> self._pool:</span><br><span class="line">                p.join()</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">        sentinels = self._get_sentinels()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># worker handler</span></span><br><span class="line">        self._worker_handler = threading.Thread(</span><br><span class="line">            target=Pool._handle_workers,</span><br><span class="line">            args=(self._cache, self._taskqueue, self._ctx, self.Process,</span><br><span class="line">                  self._processes, self._pool, self._inqueue, self._outqueue,</span><br><span class="line">                  self._initializer, self._initargs, self._maxtasksperchild,</span><br><span class="line">                  self._wrap_exception, sentinels, self._change_notifier)</span><br><span class="line">            )</span><br><span class="line">        self._worker_handler.daemon = <span class="literal">True</span></span><br><span class="line">        self._worker_handler._state = RUN</span><br><span class="line">        self._worker_handler.start()</span><br><span class="line"></span><br><span class="line">        <span class="comment"># task handler</span></span><br><span class="line">        self._task_handler = threading.Thread(</span><br><span class="line">            target=Pool._handle_tasks,</span><br><span class="line">            args=(self._taskqueue, self._quick_put, self._outqueue,</span><br><span class="line">                  self._pool, self._cache)</span><br><span class="line">            )</span><br><span class="line">        self._task_handler.daemon = <span class="literal">True</span></span><br><span class="line">        self._task_handler._state = RUN</span><br><span class="line">        self._task_handler.start()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># result handler</span></span><br><span class="line">        self._result_handler = threading.Thread(</span><br><span class="line">            target=Pool._handle_results,</span><br><span class="line">            args=(self._outqueue, self._quick_get, self._cache)</span><br><span class="line">            )</span><br><span class="line">        self._result_handler.daemon = <span class="literal">True</span></span><br><span class="line">        self._result_handler._state = RUN</span><br><span class="line">        self._result_handler.start()</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ª<code>Pool</code>å®ä¾‹æ€»å…±åŒ…å«ä»¥ä¸‹çš„å†…å®¹ï¼š</p>
<ul>
<li><code>self._processes</code>ï¼šæ‰€æœ‰workerå­è¿›ç¨‹å®ä¾‹</li>
<li><code>self._worker_handler</code>ï¼šç®¡ç†workerå­è¿›ç¨‹çš„çº¿ç¨‹</li>
<li><code>self._task_handler</code>ï¼šä»»åŠ¡è°ƒåº¦çº¿ç¨‹</li>
<li><code>self._result_handler</code>ï¼šç»“æœæ”¶é›†çº¿ç¨‹</li>
</ul>
<p>ä¸Šè¿°æ‰€æœ‰çš„<code>worker</code>å­è¿›ç¨‹è·Ÿç®¡ç†çº¿ç¨‹åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œéƒ½ä¼šè¢«å¯åŠ¨ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹<code>worker</code>è¿›ç¨‹çš„æƒ…å†µï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_repopulate_pool</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self._repopulate_pool_static(self._ctx, self.Process,</span><br><span class="line">                                        self._processes,</span><br><span class="line">                                        self._pool, self._inqueue,</span><br><span class="line">                                        self._outqueue, self._initializer,</span><br><span class="line">                                        self._initargs,</span><br><span class="line">                                        self._maxtasksperchild,</span><br><span class="line">                                        self._wrap_exception)</span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_repopulate_pool_static</span><span class="params">(ctx, Process, processes, pool, inqueue,</span></span></span><br><span class="line"><span class="function"><span class="params">                            outqueue, initializer, initargs,</span></span></span><br><span class="line"><span class="function"><span class="params">                            maxtasksperchild, wrap_exception)</span>:</span></span><br><span class="line">    <span class="string">"""Bring the number of pool processes up to the specified number,</span></span><br><span class="line"><span class="string">    for use after reaping workers which have exited.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(processes - len(pool)):</span><br><span class="line">        w = Process(ctx, target=worker,</span><br><span class="line">                    args=(inqueue, outqueue,</span><br><span class="line">                          initializer,</span><br><span class="line">                          initargs, maxtasksperchild,</span><br><span class="line">                          wrap_exception))</span><br><span class="line">        w.name = w.name.replace(<span class="string">'Process'</span>, <span class="string">'PoolWorker'</span>)</span><br><span class="line">        w.daemon = <span class="literal">True</span></span><br><span class="line">        w.start()</span><br><span class="line">        pool.append(w)</span><br><span class="line">        util.debug(<span class="string">'added worker'</span>)</span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">worker</span><span class="params">(inqueue, outqueue, initializer=None, initargs=<span class="params">()</span>, maxtasks=None,</span></span></span><br><span class="line"><span class="function"><span class="params">           wrap_exception=False)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> (maxtasks <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>) <span class="keyword">and</span> <span class="keyword">not</span> (isinstance(maxtasks, int)</span><br><span class="line">                                       <span class="keyword">and</span> maxtasks &gt;= <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">raise</span> AssertionError(<span class="string">"Maxtasks &#123;!r&#125; is not valid"</span>.format(maxtasks))</span><br><span class="line">    put = outqueue.put</span><br><span class="line">    get = inqueue.get</span><br><span class="line">    <span class="keyword">if</span> hasattr(inqueue, <span class="string">'_writer'</span>):</span><br><span class="line">        inqueue._writer.close()</span><br><span class="line">        outqueue._reader.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> initializer <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        initializer(*initargs)</span><br><span class="line"></span><br><span class="line">    completed = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> maxtasks <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> (maxtasks <span class="keyword">and</span> completed &lt; maxtasks):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            task = get()</span><br><span class="line">        <span class="keyword">except</span> (EOFError, OSError):</span><br><span class="line">            util.debug(<span class="string">'worker got EOFError or OSError -- exiting'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> task <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            util.debug(<span class="string">'worker got sentinel -- exiting'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        job, i, func, args, kwds = task</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = (<span class="literal">True</span>, func(*args, **kwds))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> wrap_exception <span class="keyword">and</span> func <span class="keyword">is</span> <span class="keyword">not</span> _helper_reraises_exception:</span><br><span class="line">                e = ExceptionWithTraceback(e, e.__traceback__)</span><br><span class="line">            result = (<span class="literal">False</span>, e)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            put((job, i, result))</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            wrapped = MaybeEncodingError(e, result[<span class="number">1</span>])</span><br><span class="line">            util.debug(<span class="string">"Possible encoding error while sending result: %s"</span> % (</span><br><span class="line">                wrapped))</span><br><span class="line">            put((job, i, (<span class="literal">False</span>, wrapped)))</span><br><span class="line"></span><br><span class="line">        task = job = result = func = args = kwds = <span class="literal">None</span></span><br><span class="line">        completed += <span class="number">1</span></span><br><span class="line">    util.debug(<span class="string">'worker exiting after %d tasks'</span> % completed)</span><br></pre></td></tr></table></figure>
<p><code>_repopulate_pool</code>æ˜¯å¯åŠ¨æ‰€æœ‰<code>worker</code>è¿›ç¨‹çš„å‡ºå‘ç‚¹ï¼Œé¡ºæµè€Œä¸‹ï¼Œæ‰€æœ‰<code>worker</code>è¿›ç¨‹æœ€ç»ˆä¼šæ‰§è¡Œ<code>worker</code>å‡½æ•°ã€‚<code>worker</code>å‡½æ•°æœ‰å¦‚ä¸‹çš„æ­¥éª¤ï¼š</p>
<ul>
<li>æ‰§è¡Œ<code>initializer(*initargs)</code>ã€‚åœ¨å¤šè¿›ç¨‹çš„åœºæ™¯ä¸‹ï¼Œæœ‰å¾ˆå¤šæ¨¡å—åˆ°äº†å­è¿›ç¨‹å¯èƒ½æ˜¯æœªåˆå§‹åŒ–çš„çŠ¶æ€ï¼Œè€Œ<code>initializer</code>å°±æä¾›äº†ä¸€ä¸ªåœ¨å­è¿›ç¨‹ä¸­åˆå§‹åŒ–æŸäº›æ¨¡å—æˆ–è€…å˜é‡çš„é€”å¾„ã€‚</li>
<li>ä»<code>inqueue</code>ä¸­<code>get</code>ä¸€ä¸ª<code>task</code>çš„å®ä¾‹ï¼Œå°†å…¶<code>unpack</code></li>
<li>æ‰§è¡Œ<code>task</code>ä¸­çš„<code>func</code>ï¼Œå¾—åˆ°ç»“æœ</li>
<li>å°†ç»“æœ<code>put</code>åˆ°<code>outqueue</code></li>
</ul>
<p>ç„¶åæˆ‘ä»¬å†çœ‹ä¸‹<code>_task_handler</code>ï¼Œå¯¹åº”çš„å‡½æ•°æ˜¯<code>Pool._handle_tasks</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_handle_tasks</span><span class="params">(taskqueue, put, outqueue, pool, cache)</span>:</span></span><br><span class="line">    thread = threading.current_thread()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> taskseq, set_length <span class="keyword">in</span> iter(taskqueue.get, <span class="literal">None</span>):</span><br><span class="line">        task = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># iterating taskseq cannot fail</span></span><br><span class="line">            <span class="keyword">for</span> task <span class="keyword">in</span> taskseq:</span><br><span class="line">                <span class="keyword">if</span> thread._state != RUN:</span><br><span class="line">                    util.debug(<span class="string">'task handler found thread._state != RUN'</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    put(task)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    job, idx = task[:<span class="number">2</span>]</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        cache[job]._set(idx, (<span class="literal">False</span>, e))</span><br><span class="line">                    <span class="keyword">except</span> KeyError:</span><br><span class="line">                        <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> set_length:</span><br><span class="line">                    util.debug(<span class="string">'doing set_length()'</span>)</span><br><span class="line">                    idx = task[<span class="number">1</span>] <span class="keyword">if</span> task <span class="keyword">else</span> <span class="number">-1</span></span><br><span class="line">                    set_length(idx + <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            task = taskseq = job = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        util.debug(<span class="string">'task handler got sentinel'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># tell result handler to finish when cache is empty</span></span><br><span class="line">        util.debug(<span class="string">'task handler sending sentinel to result handler'</span>)</span><br><span class="line">        outqueue.put(<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># tell workers there is no more work</span></span><br><span class="line">        util.debug(<span class="string">'task handler sending sentinel to workers'</span>)</span><br><span class="line">        <span class="keyword">for</span> p <span class="keyword">in</span> pool:</span><br><span class="line">            put(<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">except</span> OSError:</span><br><span class="line">        util.debug(<span class="string">'task handler got OSError when sending sentinels'</span>)</span><br><span class="line"></span><br><span class="line">    util.debug(<span class="string">'task handler exiting'</span>)</span><br></pre></td></tr></table></figure>
<p><code>task_handler</code>è´Ÿè´£ä»<code>taskqueue</code>ä¸­å¾—åˆ°<code>task</code>å®ä¾‹ï¼Œå¹¶<code>put</code>åˆ°<code>inqueue</code>ä¸­ã€‚å½“æ‰€æœ‰<code>task</code>å®ä¾‹æ¨é€å®Œæ¯•åï¼Œåƒ<code>result_handler</code>å’Œæ‰€æœ‰<code>worker process</code>æ¨é€äº†<code>None</code>å®ä¾‹ã€‚ä»å…ˆå‰<code>worker</code>çš„ä»£ç ä¸­å¯ä»¥çŸ¥æ™“ï¼Œå½“<code>inqueue</code>æ”¶åˆ°äº†<code>None</code>ï¼Œå°±ä»£è¡¨ä»»åŠ¡å·²ç»æ¨é€å®Œæ¯•ï¼Œå¯ä»¥<code>break</code>é€€å‡ºäº†ã€‚è€Œè‡³äºä¸ºä½•ä¹Ÿç»™åˆ°<code>result_handler</code>ä¸€ä¸ª<code>None</code>å®ä¾‹ï¼Œæˆ‘ä»¬å°±çœ‹ä¸‹<code>result_handler</code>çš„ä»£ç ï¼Œæ¥åˆ†æå…¶ä¸­å…·ä½“çš„æœºåˆ¶ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_handle_results</span><span class="params">(outqueue, get, cache)</span>:</span></span><br><span class="line">    thread = threading.current_thread()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            task = get()</span><br><span class="line">        <span class="keyword">except</span> (OSError, EOFError):</span><br><span class="line">            util.debug(<span class="string">'result handler got EOFError/OSError -- exiting'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> thread._state != RUN:</span><br><span class="line">            <span class="keyword">assert</span> thread._state == TERMINATE, <span class="string">"Thread not in TERMINATE"</span></span><br><span class="line">            util.debug(<span class="string">'result handler found thread._state=TERMINATE'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> task <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            util.debug(<span class="string">'result handler got sentinel'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        job, i, obj = task</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cache[job]._set(i, obj)</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        task = job = obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> cache <span class="keyword">and</span> thread._state != TERMINATE:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            task = get()</span><br><span class="line">        <span class="keyword">except</span> (OSError, EOFError):</span><br><span class="line">            util.debug(<span class="string">'result handler got EOFError/OSError -- exiting'</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> task <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            util.debug(<span class="string">'result handler ignoring extra sentinel'</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        job, i, obj = task</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cache[job]._set(i, obj)</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">        task = job = obj = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> hasattr(outqueue, <span class="string">'_reader'</span>):</span><br><span class="line">        util.debug(<span class="string">'ensuring that outqueue is not full'</span>)</span><br><span class="line">        <span class="comment"># If we don't make room available in outqueue then</span></span><br><span class="line">        <span class="comment"># attempts to add the sentinel (None) to outqueue may</span></span><br><span class="line">        <span class="comment"># block.  There is guaranteed to be no more than 2 sentinels.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> outqueue._reader.poll():</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                get()</span><br><span class="line">        <span class="keyword">except</span> (OSError, EOFError):</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    util.debug(<span class="string">'result handler exiting: len(cache)=%s, thread._state=%s'</span>,</span><br><span class="line">          len(cache), thread._state)</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>handle_results</code>çš„ä¸»å¾ªç¯ä¸­ï¼Œä¼šä¸æ–­åœ°ä»<code>outqueue</code>é‡Œ<code>get</code>ç»“æœï¼Œç„¶åæ”¾åˆ°<code>cache</code>ä¸­ã€‚å‚è€ƒ<code>worker</code>è¿›ç¨‹çš„å®ç°ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥æ™“ï¼Œä»<code>outqueue</code>é‡Œè·å–çš„ç»“æœå³æ˜¯<code>worker</code>ä»»åŠ¡æ‰§è¡Œåçš„è¿”å›å€¼ã€‚</p>
<p>å½“æ‰€æœ‰<code>task</code>åœ¨<code>handle_tasks</code>çº¿ç¨‹è¢«æ¶ˆè´¹å®Œä¹‹åï¼Œ<code>handle_tasks</code>çº¿ç¨‹ä¼šåœ¨<code>outqueue</code>é‡Œ<code>put</code>ä¸€ä¸ª<code>None</code>å€¼ã€‚<code>handle_results</code>çº¿ç¨‹æ¥æ”¶åˆ°<code>None</code>å€¼åï¼Œç›´åˆ°<code>cache</code>ä¸ºç©ºæˆ–è€…<code>Pool</code>è¢«ç»ˆæ­¢ï¼ˆTERMINATEï¼‰ä¸ºæ­¢ï¼Œéƒ½ä¼šç»§ç»­æ¥æ”¶å­è¿›ç¨‹ä»»åŠ¡æ‰§è¡Œç»“æœå¹¶å­˜åˆ°<code>cache</code>é‡Œã€‚<code>cache</code>ä¸ºç©ºæˆ–è€…<code>Pool</code>è¢«ç»ˆæ­¢ä¹‹åï¼Œ<code>handle_results</code>çº¿ç¨‹ä¼šæ¸…ç©º<code>outqueue</code>ï¼Œç„¶åé€€å‡ºã€‚</p>
<p>ä»<code>worker</code>ã€<code>task</code>ã€<code>result</code>çº¿ç¨‹çš„ä½œç”¨å¯ä»¥çœ‹åˆ°ï¼Œ<code>inqueue</code>ã€<code>outqueue</code>ã€<code>cache</code>æ˜¯è¿æ¥ç”¨æˆ·ä¸šåŠ¡çº¿ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´çš„æ¡¥æ¢ã€‚<code>inqueue</code>å’Œ<code>outqueue</code>çš„ä½œç”¨åœ¨å‰é¢çš„å™è¿°ä¸­å·²ç»éå¸¸æ¸…æ¥šï¼Œä¸€ä¸ªç”¨æ¥ä¸Šä¼ ä»»åŠ¡ï¼Œä¸€ä¸ªç”¨æ¥ä¸‹å‘æ‰§è¡Œç»“æœã€‚å› æ­¤æœ€ç»ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æ·±å…¥ç ”ç©¶ä¸€ä¸‹<code>cache</code>çš„è¿è¡Œæœºåˆ¶ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯å›é¡¾ä¸€å¼€å§‹ç»™çš„ä¾‹å­ï¼Œ<code>test_pool</code>å‡½æ•°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_pool</span><span class="params">()</span>:</span></span><br><span class="line">    test_data = [(<span class="number">2</span> * i, <span class="number">2</span> * i + <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>)]</span><br><span class="line">    <span class="keyword">with</span> Pool(<span class="number">4</span>) <span class="keyword">as</span> p:</span><br><span class="line">        pprint.pprint(process.active_children())</span><br><span class="line">        results = p.starmap(_test_func, test_data)  <span class="comment"># starmapæŒ‡iterableçš„unpackï¼Œ*argsè¿™æ ·ï¼Œè¯¦æƒ…çœ‹æºç æ³¨é‡Š</span></span><br><span class="line">        print(<span class="string">f'<span class="subst">&#123;os.getpid()&#125;</span>: <span class="subst">&#123;results&#125;</span>'</span>)  <span class="comment"># å¾—åˆ°_test_funcçš„æ‰€æœ‰ç»“æœ</span></span><br></pre></td></tr></table></figure>
<p><code>test_pool</code>å‡½æ•°è°ƒç”¨äº†<code>starmap</code>ï¼Œ<code>starmap</code>æ–¹æ³•éœ€è¦ç»™å®šä¸€ä¸ªä»»åŠ¡å‡½æ•°ä»¥åŠä¸€ç»„å‚æ•°ï¼Œå’Œ<code>map</code>ä¸åŒçš„æ˜¯ï¼Œ<code>starmap</code>æŒ‡ä»£çš„å‚æ•°æ˜¯å¸¦æ˜Ÿçš„ï¼ˆ<code>*args</code>ï¼‰ï¼Œå› æ­¤åœ¨è°ƒç”¨ä»»åŠ¡å‡½æ•°æ—¶ä¼š<code>unpack</code>å¯¹åº”çš„å‚æ•°ã€‚</p>
<p><code>starmap</code>ä¹‹åï¼Œæ¶‰åŠåˆ°çš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">starmapstar</span><span class="params">(args)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> list(itertools.starmap(args[<span class="number">0</span>], args[<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">starmap</span><span class="params">(self, func, iterable, chunksize=None)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    Like `map()` method but the elements of the `iterable` are expected to</span></span><br><span class="line"><span class="string">    be iterables as well and will be unpacked as arguments. Hence</span></span><br><span class="line"><span class="string">    `func` and (a, b) becomes func(a, b).</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> self._map_async(func, iterable, starmapstar, chunksize).get()</span><br><span class="line"></span><br><span class="line"><span class="meta">@staticmethod</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_tasks</span><span class="params">(func, it, size)</span>:</span></span><br><span class="line">    it = iter(it)</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        x = tuple(itertools.islice(it, size))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> x:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">yield</span> (func, x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_guarded_task_generation</span><span class="params">(self, result_job, func, iterable)</span>:</span></span><br><span class="line">    <span class="string">'''Provides a generator of tasks for imap and imap_unordered with</span></span><br><span class="line"><span class="string">    appropriate handling for iterables which throw exceptions during</span></span><br><span class="line"><span class="string">    iteration.'''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        i = <span class="number">-1</span></span><br><span class="line">        <span class="keyword">for</span> i, x <span class="keyword">in</span> enumerate(iterable):</span><br><span class="line">            <span class="keyword">yield</span> (result_job, i, func, (x,), &#123;&#125;)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">yield</span> (result_job, i+<span class="number">1</span>, _helper_reraises_exception, (e,), &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_map_async</span><span class="params">(self, func, iterable, mapper, chunksize=None, callback=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        error_callback=None)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    Helper function to implement map, starmap and their async counterparts.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    self._check_running()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> hasattr(iterable, <span class="string">'__len__'</span>):</span><br><span class="line">        iterable = list(iterable)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> chunksize <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        chunksize, extra = divmod(len(iterable), len(self._pool) * <span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span> extra:</span><br><span class="line">            chunksize += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> len(iterable) == <span class="number">0</span>:</span><br><span class="line">        chunksize = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    task_batches = Pool._get_tasks(func, iterable, chunksize)</span><br><span class="line">    result = MapResult(self, chunksize, len(iterable), callback,</span><br><span class="line">                       error_callback=error_callback)</span><br><span class="line">    self._taskqueue.put(</span><br><span class="line">        (</span><br><span class="line">            self._guarded_task_generation(result._job,</span><br><span class="line">                                          mapper,</span><br><span class="line">                                          task_batches),</span><br><span class="line">            <span class="literal">None</span></span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure>
<p>å„ç±»<code>map/map_async</code>æ–¹æ³•ï¼Œæœ€ç»ˆéƒ½ä¼šè½å®åˆ°<code>_map_async</code>æ–¹æ³•ã€‚åœ¨<code>_map_async</code>æ–¹æ³•ä¸­ä¼šåšä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p>
<ul>
<li>è®¡ç®—<code>chunksize</code>ï¼Œå³æ¯<code>batch</code>å­ä»»åŠ¡çš„æ•°é‡</li>
<li>é€šè¿‡<code>_get_tasks</code>å‡½æ•°ï¼Œè·å–ä¼ é€’å­ä»»åŠ¡<code>batch</code>çš„<code>generator</code></li>
<li>ç”Ÿæˆ<code>MapResult</code>å®ä¾‹<code>result</code></li>
<li>åœ¨<code>taskqueue</code>ä¸­æ”¾å…¥<code>_guarded_task_generation</code>çš„ä»»åŠ¡<code>generator</code>å®ä¾‹</li>
</ul>
<p>æ¯ä¸ªå­è¿›ç¨‹æœ€ç»ˆä¼šè°ƒç”¨<code>mapper(task_batch)</code>ï¼Œç›¸å½“äºæ˜¯<code>list(itertools.starmap(func, task_batch))</code>ï¼Œä¹Ÿå°±æ˜¯å•ä¸ªå­è¿›ç¨‹ä¼šæ‰§è¡Œä¸€ä¸ª<code>batch</code>çš„ä»»åŠ¡ï¼Œç„¶åè¿”å›ä¸€ç»„è¿™ä¸ª<code>batch</code>çš„æ‰§è¡Œç»“æœã€‚</p>
<p>ä»è¿™ä¸ªè§’åº¦æ¨è®ºï¼Œå‡è®¾æ¯ä¸ªä»»åŠ¡å‡½æ•°æ‰§è¡Œè¦1sï¼Œæ€»å…±16ä¸ªå­ä»»åŠ¡ï¼Œ<code>chunksize</code>æ˜¯14ï¼Œ<code>pool</code>çš„<code>size</code>æ˜¯2ï¼Œé‚£ä¹ˆä¸€æ‰§è¡Œèµ·æ¥ï¼Œå‰2ç§’çš„è¯2ä¸ªå­è¿›ç¨‹éƒ½ä¼šæ‰“å°æ‰§è¡Œç»“æœï¼Œç„¶åæ¥ä¸‹æ¥12ç§’å°±åªæœ‰ç¬¬1ä¸ªå­è¿›ç¨‹æ‰“å°ç»“æœäº†ã€‚è¿™æ˜¯å› ä¸ºï¼Œç¬¬1ä¸ªå­è¿›ç¨‹ä¸€æ‰¹è¢«åˆ†äº†14ä¸ªï¼Œç¬¬2ä¸ªå­è¿›ç¨‹ä¸€æ‰¹å°±è¢«åˆ†äº†å‰©ä¸‹2ä¸ªã€‚å¦‚æœå…¶å®ƒå˜é‡ä¸å˜ï¼Œ<code>pool</code>çš„<code>size</code>æ˜¯3ï¼Œé‚£ä¹ˆæ‰“å°çš„æ•ˆæœä¹Ÿå’Œ<code>size</code>ä¸º2çš„æ—¶å€™ä¸€æ ·ï¼Œè¿™æ˜¯å› ä¸º<code>chunksize</code>å¤ªå¤§ï¼Œå‰2ä¸ªå­è¿›ç¨‹å·²ç»ç“œåˆ†äº†æ‰€æœ‰å­ä»»åŠ¡ï¼ˆ14ã€2ï¼‰ï¼Œç¬¬3ä¸ªå­è¿›ç¨‹å•¥ä»»åŠ¡éƒ½åˆ†ä¸åˆ°äº†ã€‚</p>
<p>æ‰€ä»¥<code>chunksize</code>çš„è®¾å®šï¼Œä¹Ÿæ˜¯ä¸€é—¨å­¦é—®ã€‚å®é™…ä½¿ç”¨<code>pool</code>çš„æ—¶å€™è¦æ³¨æ„è¿™ä¸ªå‘ã€‚</p>
<p>æ¥ä¸‹æ¥æ³¨æ„åŠ›è½¬åˆ°<code>MapResult</code>å®ä¾‹<code>result</code>ä¸Šï¼Œä¹Ÿæ˜¯åœ¨è¿™ä¸ªåœ°æ–¹ä¼šå¯¹ä»»åŠ¡ç¼“å­˜<code>cache</code>åšä¸€äº›æ“ä½œã€‚é¦–å…ˆæˆ‘ä»¬çœ‹<code>MapResult</code>çš„å®šä¹‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">job_counter = itertools.count()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApplyResult</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, pool, callback, error_callback)</span>:</span></span><br><span class="line">        self._pool = pool</span><br><span class="line">        self._event = threading.Event()</span><br><span class="line">        self._job = next(job_counter)</span><br><span class="line">        self._cache = pool._cache</span><br><span class="line">        self._callback = callback</span><br><span class="line">        self._error_callback = error_callback</span><br><span class="line">        self._cache[self._job] = self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ready</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self._event.is_set()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">successful</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.ready():</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"&#123;0!r&#125; not ready"</span>.format(self))</span><br><span class="line">        <span class="keyword">return</span> self._success</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wait</span><span class="params">(self, timeout=None)</span>:</span></span><br><span class="line">        self._event.wait(timeout)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, timeout=None)</span>:</span></span><br><span class="line">        self.wait(timeout)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.ready():</span><br><span class="line">            <span class="keyword">raise</span> TimeoutError</span><br><span class="line">        <span class="keyword">if</span> self._success:</span><br><span class="line">            <span class="keyword">return</span> self._value</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> self._value</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MapResult</span><span class="params">(ApplyResult)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, pool, chunksize, length, callback, error_callback)</span>:</span></span><br><span class="line">        ApplyResult.__init__(self, pool, callback,</span><br><span class="line">                             error_callback=error_callback)</span><br><span class="line">        self._success = <span class="literal">True</span></span><br><span class="line">        self._value = [<span class="literal">None</span>] * length</span><br><span class="line">        self._chunksize = chunksize</span><br><span class="line">        <span class="keyword">if</span> chunksize &lt;= <span class="number">0</span>:</span><br><span class="line">            self._number_left = <span class="number">0</span></span><br><span class="line">            self._event.set()</span><br><span class="line">            <span class="keyword">del</span> self._cache[self._job]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._number_left = length//chunksize + bool(length % chunksize)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_set</span><span class="params">(self, i, success_result)</span>:</span></span><br><span class="line">        self._number_left -= <span class="number">1</span></span><br><span class="line">        success, result = success_result</span><br><span class="line">        <span class="keyword">if</span> success <span class="keyword">and</span> self._success:</span><br><span class="line">            self._value[i*self._chunksize:(i+<span class="number">1</span>)*self._chunksize] = result</span><br><span class="line">            <span class="keyword">if</span> self._number_left == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> self._callback:</span><br><span class="line">                    self._callback(self._value)</span><br><span class="line">                <span class="keyword">del</span> self._cache[self._job]</span><br><span class="line">                self._event.set()</span><br><span class="line">                self._pool = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> success <span class="keyword">and</span> self._success:</span><br><span class="line">                <span class="comment"># only store first exception</span></span><br><span class="line">                self._success = <span class="literal">False</span></span><br><span class="line">                self._value = result</span><br><span class="line">            <span class="keyword">if</span> self._number_left == <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># only consider the result ready once all jobs are done</span></span><br><span class="line">                <span class="keyword">if</span> self._error_callback:</span><br><span class="line">                    self._error_callback(self._value)</span><br><span class="line">                <span class="keyword">del</span> self._cache[self._job]</span><br><span class="line">                self._event.set()</span><br><span class="line">                self._pool = <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<p>é’ˆå¯¹<code>starmap</code>è€Œè¨€ï¼Œåœ¨<code>worker</code>ä¸­ï¼Œæ‰§è¡Œäº†ä¸€æ‰¹å­ä»»åŠ¡ä¹‹åï¼Œä¼šè°ƒç”¨<code>put((job, i, result))</code>è¿”å›ç‹¬ç«‹çš„<code>job_id</code>ã€ä»»åŠ¡ç»„ç¼–å·ã€å­ä»»åŠ¡æ‰¹æ¬¡çš„ç»“æœé›†ã€‚æˆ‘ä»¬éœ€è¦æ³¨æ„åˆ°ï¼Œåœ¨<code>result</code>åˆå§‹åŒ–æ—¶ä¾¯ï¼Œä¼šé€šè¿‡<code>[None] * length</code>å ä½æ‰€æœ‰çš„ç»“æœï¼ˆ<code>self._values</code>ï¼‰ï¼Œå¹¶ä¸”åœ¨ç¼“å­˜ä¸­è®¾ç½®æœ¬æ¬¡<code>job</code>ï¼ˆ<code>ApplyResult</code>ä¸­<code>self._cache[self._job] = self</code>ï¼‰ï¼Œç„¶ååœ¨<code>handle_results</code>çº¿ç¨‹ä¸­<code>_set</code>ç»“æœæ—¶ï¼Œè°ƒç”¨äº†<code>MapResult._set</code>ï¼Œä¼šæ ¹æ®ä»»åŠ¡ç»„ç¼–å·<code>i</code>æŠŠå¯¹åº”ä½ç½®çš„ç»“æœæ›¿ä»£ã€‚ç›´åˆ°æ‰€æœ‰æ‰¹æ¬¡çš„ç»“æœé›†æ‰§è¡Œç»“æœè¿”å›åï¼Œæœ€ç»ˆä¼šæ¸…æ¥šç¼“å­˜ä¸­çš„è¿™æ¬¡<code>starmap</code>çš„<code>job_id</code>ï¼Œç„¶åè°ƒç”¨<code>self._event.set()</code></p>
<p><code>starmap</code>å‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æ‰€æœ‰ç»“æœè¿”å›ã€‚å®ç°é˜»å¡æ“ä½œçš„æ–¹å¼ï¼Œå³æ˜¯ç”¨äº†<code>threading.Event()</code>ã€‚<code>starmap</code>è¿”å›çš„æ˜¯<code>result.get()</code>ï¼Œåœ¨<code>get</code>çš„å®ç°é‡Œï¼Œä¼šè°ƒç”¨<code>self._event.wait</code>ï¼Œä¹Ÿå°±æ˜¯é˜»å¡ï¼Œç›´åˆ°<code>self._event.set</code>ã€‚è¿™æ ·ï¼Œåªæœ‰æ‰€æœ‰ç»“æœè¿”å›ï¼Œ<code>starmap</code>æ‰ä¼šè¿”å›ã€‚å¦‚æœå¤§å®¶æ—¥å¸¸å¼€å‘ä¸­ï¼Œæœ‰è¿™ç§ç­‰å¾…ç›´åˆ°æ‰§è¡ŒæˆåŠŸçš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¸å¦¨å°è¯•ç”¨<code>threading.Event()</code>ï¼Œæ¯”<code>sleep</code>è½®è¯¢çš„æ–¹å¼ä¼˜é›…çš„å¤šã€‚</p>
<p>è¯´åˆ°åº•ï¼Œ<code>Pool</code>ä¸ºå¤šè¿›ç¨‹ç¼–ç¨‹æä¾›äº†çµæ´»çš„ä»»åŠ¡è°ƒåº¦æ¨¡å‹ã€‚æ—¥å¸¸å¦‚æœéœ€è¦ç”¨åˆ°è¿›ç¨‹æ± åšå¹¶è¡Œæ“ä½œï¼Œç”¨åŸç”Ÿçš„<code>multiprocessing.Pool</code>å°±æ˜¯ä¸äºŒé€‰æ‹©ã€‚</p>
<p>å½“ç„¶ï¼Œå¹¶è¡Œä»»åŠ¡è¿˜æœ‰ä¸€ç§é€‰æ‹©æ–¹æ¡ˆå®ç”¨<code>ProcessPoolExecutor</code>ï¼Œæ¯”åŸç”Ÿçš„<code>Pool</code>ç¨å¾®è½»é‡çº§ä¸€ç‚¹ã€‚<code>ProcessPoolExecutor</code>çš„æœºç†å®ç°ï¼Œä¹Ÿå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTM4NDI1MDEvYXJ0aWNsZS9kZXRhaWxzLzExNzcxNzIwMA==" title="https://blog.csdn.net/u013842501/article/details/117717200">è¿™ç¯‡æ–‡æ¡£<i class="fa fa-external-link"></i></span>ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å¹¶è¡Œ</tag>
        <tag>multiprocessing</tag>
        <tag>pool</tag>
        <tag>è¿›ç¨‹æ± </tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬ä¸€ç« -å¤šè¿›ç¨‹ã€‘2ã€Pipeå’ŒQueueï¼Œè¿›ç¨‹é—´é€šä¿¡</title>
    <url>/2022/01/22/hardpython/1_multiprocessing_2/</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDEvMTYvaGFyZHB5dGhvbi8xX211bHRpcHJvY2Vzc2luZ18xLw==" title="https://utmhikari.top/2022/01/16/hardpython/1_multiprocessing_1/">ç¬¬ä¸€è¯<i class="fa fa-external-link"></i></span>è¯¦ç»†è®²è§£äº†Processæ–°è¿›ç¨‹æ˜¯å¦‚ä½•è¢«åˆ›å»ºçš„ï¼Œæ¥ä¸‹æ¥å°±æ¥è®²ä¸€ä¸‹è¿›ç¨‹ä¹‹é—´æœ‰ä»€ä¹ˆé€šä¿¡çš„æ–¹æ³•ã€‚</p>
<p>è¦åœ¨<code>multiprocessing</code>ä¸­å®ç°è¿›ç¨‹é—´é€šä¿¡ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•æ˜¯é‡‡ç”¨<code>Pipe</code>æˆ–è€…<code>Queue</code>ã€‚å…¶ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Pipe, Queue</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> mp_module <span class="keyword">import</span> log, seg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test_queue</span><span class="params">(q)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        msg = q.get()</span><br><span class="line">        <span class="keyword">if</span> msg == <span class="string">'quit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            log(<span class="string">f'recv: <span class="subst">&#123;msg&#125;</span>'</span>)</span><br><span class="line">    log(<span class="string">'child process end~'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_queue</span><span class="params">()</span>:</span></span><br><span class="line">    seg(<span class="string">'test queue start'</span>)</span><br><span class="line">    q = Queue()</span><br><span class="line">    p = Process(target=_test_queue, args=(q,))</span><br><span class="line">    p.start()</span><br><span class="line">    cmds = [<span class="string">'helloworld'</span>, <span class="string">'testmsg'</span>, <span class="string">'quit'</span>]</span><br><span class="line">    <span class="keyword">for</span> cmd <span class="keyword">in</span> cmds:</span><br><span class="line">        log(<span class="string">f'send: <span class="subst">&#123;cmd&#125;</span>'</span>)</span><br><span class="line">        q.put(cmd)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> p.is_alive()</span><br><span class="line">    seg(<span class="string">'test queue end'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test_pipe</span><span class="params">(r)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        msg = r.recv()</span><br><span class="line">        <span class="keyword">if</span> msg == <span class="string">'quit'</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            log(<span class="string">f'recv: <span class="subst">&#123;msg&#125;</span>'</span>)</span><br><span class="line">    log(<span class="string">'child process end~'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_pipe</span><span class="params">()</span>:</span></span><br><span class="line">    seg(<span class="string">'test pipe start'</span>)</span><br><span class="line">    r, w = Pipe()</span><br><span class="line">    p = Process(target=_test_pipe, args=(r,))</span><br><span class="line">    p.start()</span><br><span class="line">    cmds = [<span class="string">'helloworld'</span>, <span class="string">'testmsg'</span>, <span class="string">'quit'</span>]</span><br><span class="line">    <span class="keyword">for</span> cmd <span class="keyword">in</span> cmds:</span><br><span class="line">        log(<span class="string">f'send: <span class="subst">&#123;cmd&#125;</span>'</span>)</span><br><span class="line">        w.send(cmd)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> p.is_alive()</span><br><span class="line">    seg(<span class="string">'test pipe end'</span>)</span><br></pre></td></tr></table></figure>
<p>å½¢å¼ä¸Šéå¸¸ç®€å•ã€‚<code>Pipe</code>åˆ›å»ºäº†ä¸€å¯¹<code>reader</code>è·Ÿ<code>writer</code>ï¼Œå°†<code>reader</code>ä¼ å…¥å­è¿›ç¨‹ï¼Œä¸»è¿›ç¨‹åœ¨<code>writer</code>å†™å…¥æ•°æ®ï¼Œå­è¿›ç¨‹å³èƒ½é€šè¿‡<code>reader</code>è¯»å–åˆ°ï¼›<code>Queue</code>åˆ™æ›´ä¸ºæ–¹ä¾¿ï¼Œå…¶å®ä¾‹èƒ½å¤Ÿç›´æ¥ä¼ å…¥å­è¿›ç¨‹ã€‚ä¸»è¿›ç¨‹è°ƒç”¨<code>put</code>å³å¯å†™å…¥æ•°æ®ï¼Œå­è¿›ç¨‹è°ƒç”¨<code>get</code>å³å¯è·å–æ•°æ®ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹<code>Pipe</code>åœ¨windowsä¸‹çš„å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Pipe</span><span class="params">(duplex=True)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    Returns pair of connection objects at either end of a pipe</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    address = arbitrary_address(<span class="string">'AF_PIPE'</span>)</span><br><span class="line">    <span class="keyword">if</span> duplex:</span><br><span class="line">        openmode = _winapi.PIPE_ACCESS_DUPLEX</span><br><span class="line">        access = _winapi.GENERIC_READ | _winapi.GENERIC_WRITE</span><br><span class="line">        obsize, ibsize = BUFSIZE, BUFSIZE</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        openmode = _winapi.PIPE_ACCESS_INBOUND</span><br><span class="line">        access = _winapi.GENERIC_WRITE</span><br><span class="line">        obsize, ibsize = <span class="number">0</span>, BUFSIZE</span><br><span class="line"></span><br><span class="line">    h1 = _winapi.CreateNamedPipe(</span><br><span class="line">        address, openmode | _winapi.FILE_FLAG_OVERLAPPED |</span><br><span class="line">        _winapi.FILE_FLAG_FIRST_PIPE_INSTANCE,</span><br><span class="line">        _winapi.PIPE_TYPE_MESSAGE | _winapi.PIPE_READMODE_MESSAGE |</span><br><span class="line">        _winapi.PIPE_WAIT,</span><br><span class="line">        <span class="number">1</span>, obsize, ibsize, _winapi.NMPWAIT_WAIT_FOREVER,</span><br><span class="line">        <span class="comment"># default security descriptor: the handle cannot be inherited</span></span><br><span class="line">        _winapi.NULL</span><br><span class="line">        )</span><br><span class="line">    h2 = _winapi.CreateFile(</span><br><span class="line">        address, access, <span class="number">0</span>, _winapi.NULL, _winapi.OPEN_EXISTING,</span><br><span class="line">        _winapi.FILE_FLAG_OVERLAPPED, _winapi.NULL</span><br><span class="line">        )</span><br><span class="line">    _winapi.SetNamedPipeHandleState(</span><br><span class="line">        h2, _winapi.PIPE_READMODE_MESSAGE, <span class="literal">None</span>, <span class="literal">None</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    overlapped = _winapi.ConnectNamedPipe(h1, overlapped=<span class="literal">True</span>)</span><br><span class="line">    _, err = overlapped.GetOverlappedResult(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">assert</span> err == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    c1 = PipeConnection(h1, writable=duplex)</span><br><span class="line">    c2 = PipeConnection(h2, readable=duplex)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> c1, c2</span><br></pre></td></tr></table></figure>
<p><code>h1</code>ä¸<code>h2</code>äº’ä¸ºæœåŠ¡ç«¯/å®¢æˆ·ç«¯çš„å…³ç³»ã€‚<code>h1</code>é€šè¿‡<code>CreateNamedPipe</code>åˆ›å»ºï¼Œä¹‹å<code>h2</code>é€šè¿‡<code>CreateFile</code>è¿æ¥åˆ°<code>h1</code>çš„<code>NamedPipe</code>ä¸Šã€‚ä¹‹åç”¨<code>PipeConnection</code>å°è£…<code>h1</code>å’Œ<code>h2</code>ä¸¤ç«¯ï¼Œè¿”å›<code>reader</code>è·Ÿ<code>writer</code>ã€‚å½“ç„¶ï¼Œä¸¤ä¸ªç®¡é“å…¥å£æ˜¯å¦åŒå·¥ä¹Ÿæ˜¯å¯é€‰é¡¹ã€‚</p>
<p>ç»è¿‡<code>PipeConnection</code>çš„å°è£…ï¼Œç®¡é“å³æ‹¥æœ‰äº†å‘é€æˆ–æ¥æ”¶<code>python</code>å¯¹è±¡çš„æ–¹æ³•ã€‚<code>python</code>å¯¹è±¡çš„åºåˆ—åŒ–/ååºåˆ—åŒ–ä¼šç”¨å†…ç½®åº“<code>pickle</code>æ¥æ”¯æŒã€‚è¢«<code>pickle</code>çš„å¯¹è±¡ä¼šä¿ç•™ç‰¹å®šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æŸä¸ªæ¨¡å—<code>def</code>çš„å‡½æ•°ï¼Œåœ¨<code>pickle</code>æ—¶é™¤äº†å¯¹å‡½æ•°æœ¬èº«è¿›è¡Œåºåˆ—åŒ–å¤–ï¼Œä¹Ÿä¼šå°å­˜å‡½æ•°æ‰€å±æ¨¡å—çš„ä¿¡æ¯ã€‚åœ¨<code>unpickle</code>æ—¶ï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”æ¨¡å—çš„ä¿¡æ¯ï¼Œå°±ä¼šæŠ¥é”™ã€‚å› æ­¤å¤šè¿›ç¨‹ä¹‹é—´é€šä¿¡pythonå¯¹è±¡æ—¶ï¼Œéœ€è¦ç•™æ„åºåˆ—åŒ–/ååºåˆ—åŒ–åå¯¹åº”å¯¹è±¡çš„å–å€¼/æ¨¡å—ç¯å¢ƒç­‰æƒ…å†µã€‚<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9saWJyYXJ5L3BpY2tsZS5odG1s" title="https://docs.python.org/zh-cn/3/library/pickle.html">pickleçš„å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>ç»™åˆ°äº†æˆ‘ä»¬è¶³å¤Ÿçš„ä¿¡æ¯å»äº†è§£è¿™äº›æœºåˆ¶ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è½¬å‘<code>Queue</code>çš„å®ç°ã€‚ç›¸å¯¹äº<code>Pipe</code>ï¼Œ<code>Queue</code>æ˜¯å¯¹å…¶çš„å°è£…ï¼Œå¹¶æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬å®Œæ•´åˆ—ä¸¾ä¸€ä¸‹<code>Queue</code>çš„å…³é”®ä»£ç ï¼šï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, maxsize=<span class="number">0</span>, *, ctx)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> maxsize &lt;= <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">from</span> .synchronize <span class="keyword">import</span> SEM_VALUE_MAX <span class="keyword">as</span> maxsize</span><br><span class="line">        self._maxsize = maxsize</span><br><span class="line">        self._reader, self._writer = connection.Pipe(duplex=<span class="literal">False</span>)</span><br><span class="line">        self._rlock = ctx.Lock()</span><br><span class="line">        self._opid = os.getpid()</span><br><span class="line">        <span class="keyword">if</span> sys.platform == <span class="string">'win32'</span>:</span><br><span class="line">            self._wlock = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._wlock = ctx.Lock()</span><br><span class="line">        self._sem = ctx.BoundedSemaphore(maxsize)</span><br><span class="line">        self._ignore_epipe = <span class="literal">False</span></span><br><span class="line">        self._reset()</span><br><span class="line">        <span class="keyword">if</span> sys.platform != <span class="string">'win32'</span>:</span><br><span class="line">            register_after_fork(self, Queue._after_fork)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getstate__</span><span class="params">(self)</span>:</span></span><br><span class="line">        context.assert_spawning(self)</span><br><span class="line">        <span class="keyword">return</span> (self._ignore_epipe, self._maxsize, self._reader, self._writer,</span><br><span class="line">                self._rlock, self._wlock, self._sem, self._opid)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setstate__</span><span class="params">(self, state)</span>:</span></span><br><span class="line">        (self._ignore_epipe, self._maxsize, self._reader, self._writer,</span><br><span class="line">         self._rlock, self._wlock, self._sem, self._opid) = state</span><br><span class="line">        self._reset()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_reset</span><span class="params">(self, after_fork=False)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> after_fork:</span><br><span class="line">            self._notempty._at_fork_reinit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._notempty = threading.Condition(threading.Lock())</span><br><span class="line">        self._buffer = collections.deque()</span><br><span class="line">        self._thread = <span class="literal">None</span></span><br><span class="line">        self._jointhread = <span class="literal">None</span></span><br><span class="line">        self._joincancelled = <span class="literal">False</span></span><br><span class="line">        self._closed = <span class="literal">False</span></span><br><span class="line">        self._close = <span class="literal">None</span></span><br><span class="line">        self._send_bytes = self._writer.send_bytes</span><br><span class="line">        self._recv_bytes = self._reader.recv_bytes</span><br><span class="line">        self._poll = self._reader.poll</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, obj, block=True, timeout=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self._closed:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"Queue <span class="subst">&#123;self!r&#125;</span> is closed"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._sem.acquire(block, timeout):</span><br><span class="line">            <span class="keyword">raise</span> Full</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> self._notempty:</span><br><span class="line">            <span class="keyword">if</span> self._thread <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                self._start_thread()</span><br><span class="line">            self._buffer.append(obj)</span><br><span class="line">            self._notempty.notify()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, block=True, timeout=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self._closed:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">f"Queue <span class="subst">&#123;self!r&#125;</span> is closed"</span>)</span><br><span class="line">        <span class="keyword">if</span> block <span class="keyword">and</span> timeout <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">with</span> self._rlock:</span><br><span class="line">                res = self._recv_bytes()</span><br><span class="line">            self._sem.release()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> block:</span><br><span class="line">                deadline = time.monotonic() + timeout</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> self._rlock.acquire(block, timeout):</span><br><span class="line">                <span class="keyword">raise</span> Empty</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">if</span> block:</span><br><span class="line">                    timeout = deadline - time.monotonic()</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> self._poll(timeout):</span><br><span class="line">                        <span class="keyword">raise</span> Empty</span><br><span class="line">                <span class="keyword">elif</span> <span class="keyword">not</span> self._poll():</span><br><span class="line">                    <span class="keyword">raise</span> Empty</span><br><span class="line">                res = self._recv_bytes()</span><br><span class="line">                self._sem.release()</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                self._rlock.release()</span><br><span class="line">        <span class="keyword">return</span> _ForkingPickler.loads(res)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._closed = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._reader.close()</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            close = self._close</span><br><span class="line">            <span class="keyword">if</span> close:</span><br><span class="line">                self._close = <span class="literal">None</span></span><br><span class="line">                close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_start_thread</span><span class="params">(self)</span>:</span></span><br><span class="line">        self._buffer.clear()</span><br><span class="line">        self._thread = threading.Thread(</span><br><span class="line">            target=Queue._feed,</span><br><span class="line">            args=(self._buffer, self._notempty, self._send_bytes,</span><br><span class="line">                  self._wlock, self._writer.close, self._ignore_epipe,</span><br><span class="line">                  self._on_queue_feeder_error, self._sem),</span><br><span class="line">            name=<span class="string">'QueueFeederThread'</span></span><br><span class="line">        )</span><br><span class="line">        self._thread.daemon = <span class="literal">True</span></span><br><span class="line">        self._thread.start()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._joincancelled:</span><br><span class="line">            self._jointhread = Finalize(</span><br><span class="line">                self._thread, Queue._finalize_join,</span><br><span class="line">                [weakref.ref(self._thread)],</span><br><span class="line">                exitpriority=<span class="number">-5</span></span><br><span class="line">                )</span><br><span class="line">        self._close = Finalize(</span><br><span class="line">            self, Queue._finalize_close,</span><br><span class="line">            [self._buffer, self._notempty],</span><br><span class="line">            exitpriority=<span class="number">10</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_feed</span><span class="params">(buffer, notempty, send_bytes, writelock, close, ignore_epipe,</span></span></span><br><span class="line"><span class="function"><span class="params">              onerror, queue_sem)</span>:</span></span><br><span class="line">        debug(<span class="string">'starting thread to feed data to pipe'</span>)</span><br><span class="line">        nacquire = notempty.acquire</span><br><span class="line">        nrelease = notempty.release</span><br><span class="line">        nwait = notempty.wait</span><br><span class="line">        bpopleft = buffer.popleft</span><br><span class="line">        sentinel = _sentinel</span><br><span class="line">        <span class="keyword">if</span> sys.platform != <span class="string">'win32'</span>:</span><br><span class="line">            wacquire = writelock.acquire</span><br><span class="line">            wrelease = writelock.release</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            wacquire = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                nacquire()</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> buffer:</span><br><span class="line">                        nwait()</span><br><span class="line">                <span class="keyword">finally</span>:</span><br><span class="line">                    nrelease()</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">                        obj = bpopleft()</span><br><span class="line">                        <span class="keyword">if</span> obj <span class="keyword">is</span> sentinel:</span><br><span class="line">                            debug(<span class="string">'feeder thread got sentinel -- exiting'</span>)</span><br><span class="line">                            close()</span><br><span class="line">                            <span class="keyword">return</span></span><br><span class="line">                        obj = _ForkingPickler.dumps(obj)</span><br><span class="line">                        <span class="keyword">if</span> wacquire <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                            send_bytes(obj)</span><br><span class="line">                        <span class="keyword">else</span>:</span><br><span class="line">                            wacquire()</span><br><span class="line">                            <span class="keyword">try</span>:</span><br><span class="line">                                send_bytes(obj)</span><br><span class="line">                            <span class="keyword">finally</span>:</span><br><span class="line">                                wrelease()</span><br><span class="line">                <span class="keyword">except</span> IndexError:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">if</span> ignore_epipe <span class="keyword">and</span> getattr(e, <span class="string">'errno'</span>, <span class="number">0</span>) == errno.EPIPE:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">if</span> is_exiting():</span><br><span class="line">                    info(<span class="string">'error in queue thread: %s'</span>, e)</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    queue_sem.release()</span><br><span class="line">                    onerror(e, obj)</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>Queue</code>çš„<code>__init__</code>å‡½æ•°ä¸­ï¼Œæ„é€ äº†è¿™ä¹ˆäº›å¯¹è±¡ï¼š</p>
<ul>
<li><code>self._maxsize</code>ï¼š<code>Queue</code>é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦</li>
<li><code>self._reader</code>, <code>self._writer</code>ï¼š<code>pipe</code>çš„ä¸¤ç«¯</li>
<li><code>self._rlock</code>ï¼š<code>self._reader</code>çš„è¯»é”</li>
<li><code>self._wlock</code>ï¼š<code>self._writer</code>çš„å†™é”</li>
<li><code>self._sem</code>ï¼šä»¥<code>self._maxsize</code>ä¸ºåŸºå‡†çš„ä¿¡å·é‡ï¼Œç”¨æ¥è®°å½•é˜Ÿåˆ—å¡«æ»¡æƒ…å†µ</li>
<li><code>self._notempty</code>ï¼šé˜Ÿåˆ—éç©ºçš„æ¡ä»¶å˜é‡ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œéœ€è¦<code>wait</code></li>
<li><code>self._buffer</code>ï¼šå­˜å‚¨<code>python</code>å¯¹è±¡çš„é˜Ÿåˆ—<code>deque</code></li>
<li><code>self._thread</code>ï¼šæ¶ˆè´¹çº¿ç¨‹ï¼Œç”¨äºæ¶ˆè´¹<code>self._buffer</code>ä¸­çš„å†…å®¹å¹¶å‘é€åˆ°<code>pipe</code>ä¸­</li>
<li><code>self._jointhread</code>ï¼šå…³é—­æ¶ˆè´¹çº¿ç¨‹çš„<code>finalizer</code></li>
<li><code>self._close</code>ï¼šå…³é—­<code>pipe</code>çš„<code>finalizer</code></li>
</ul>
<p>å…¶ä¸­è¿˜è¦ç•™æ„ä¸€ç‚¹æ˜¯ï¼Œ<code>Queue</code>å®ä¾‹æœ¬èº«æ˜¯è¦ä¼ ç»™<code>Process</code>å®ä¾‹ï¼Œå¹¶åœ¨å¦ä¸€ä¸ªè¿›ç¨‹è¢«ååºåˆ—åŒ–ä¸€æ¬¡ã€‚å› æ­¤ä¸ºäº†ä¿è¯åºåˆ—åŒ–/ååºåˆ—åŒ–ä¹‹åéƒ¨åˆ†çŠ¶æ€å¾—åˆ°ä¿ç•™ï¼ˆæ¯”å¦‚<code>pipe</code>ï¼‰ï¼Œ<code>Queue</code>çš„ç±»å®šä¹‰ä¸­é‡‡ç”¨äº†<code>__getstate__</code>å’Œ<code>__setstate__</code>ä¸¤ä¸ªé’©å­å»å®ç°å®ä¾‹å†…éƒ¨çŠ¶æ€çš„å­˜å‚¨ä¸è¯»å–ã€‚è¿™ä¸ªç‰¹æ€§åœ¨<code>pickle</code>çš„å®˜æ–¹æ–‡æ¡£å†…æœ‰è¯¦ç»†çš„è¯´æ˜ã€‚</p>
<p>å¤§è‡´äº†è§£äº†è¿™äº›å¯¹è±¡çš„å«ä¹‰åï¼Œæ¥ä¸‹æ¥ï¼Œå°±è¯¦ç»†æŠŠ<code>Queue</code>çš„å·¥ä½œæµç¨‹åˆ—ä¸€ä¸‹ï¼š</p>
<ul>
<li>ç”¨æˆ·è°ƒç”¨<code>put</code>ï¼Œä¿¡å·é‡<code>self._sem</code>å¢åŠ ä¸€ä¸ªå ä½ï¼Œä¹‹åå‘ç°æ¶ˆè´¹çº¿ç¨‹æœªå¯åŠ¨ï¼Œé€šè¿‡<code>self._start_thread</code>å¯åŠ¨æ¶ˆè´¹çº¿ç¨‹<code>Queue._feed</code></li>
<li>æ¶ˆè´¹çº¿ç¨‹è¿›å…¥å¾ªç¯ï¼Œå‘ç°é˜Ÿåˆ—<code>self._buffer</code>ä¸ºç©ºï¼Œæ¡ä»¶å˜é‡<code>self._notempty</code>è¿›å…¥<code>wait</code></li>
<li><code>self._start_thread</code>ä¹‹åï¼Œå°†<code>python</code>å¯¹è±¡æ¨å…¥<code>self._buffer</code>ï¼Œå¹¶<code>notify</code>æ¡ä»¶å˜é‡<code>self._notempty</code><ul>
<li>è¿™ä¸€æ­¥å¾ˆæœ‰æ¦‚ç‡å‘ç”Ÿåœ¨ä¸Šä¸€æ­¥ä¹‹å‰ï¼Œä¸è¿‡æ— æ‰€è°“äº†</li>
</ul>
</li>
<li><code>_feed</code>é€€å‡º<code>wait</code>çŠ¶æ€ï¼Œ<code>pop</code>å‡º<code>python</code>å¯¹è±¡ï¼Œç„¶åå°†å…¶<code>pickle</code>ï¼Œæœ€åè°ƒç”¨<code>self._writer._send_bytes</code>å‘é€åºåˆ—åŒ–ä¹‹åçš„æ•°æ®åˆ°<code>pipe</code>å†…<ul>
<li>è¿™é‡Œæ³¨æ„ï¼Œå¦‚æœ<code>python</code>å¯¹è±¡æ˜¯<code>object()</code>ï¼Œä¼šè§¦å‘<code>self._writer.close</code>ã€‚å› æ­¤å®é™…ä¸šåŠ¡ä»£ç ä¸­æœ€å¥½ä¸è¦å‡ºç°å‘é€<code>object()</code>çš„æƒ…å†µ</li>
</ul>
</li>
<li>ç”¨æˆ·è°ƒç”¨<code>get</code>ï¼Œé€šè¿‡<code>self._reader</code>è¯»å–<code>pipe</code>ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”è®©ä¿¡å·é‡<code>self._sem</code>é‡Šæ”¾ä¸€ä¸ªå ä½ã€‚ä¹‹åå¯¹æ•°æ®è¿›è¡Œååºåˆ—åŒ–ï¼Œå¾—åˆ°å‘é€è¿‡æ¥çš„å¯¹è±¡</li>
<li>ç”¨æˆ·è°ƒç”¨<code>close</code>ï¼Œé¦–å…ˆå…³é—­<code>self._reader</code>ï¼Œç„¶ååœ¨<code>self._writer</code>ä¸­å‘é€ä¸€ä¸ª<code>object()</code>ã€‚<code>_feed</code>ä¼šä¸€ç›´æ¶ˆè´¹é˜Ÿåˆ—ï¼Œç›´åˆ°æ£€æµ‹åˆ°æœ€åçš„<code>object()</code>ï¼Œç»ˆäºè§¦å‘<code>self._writer</code>çš„å…³é—­ã€‚è¿™æ ·<code>pipe</code>çš„ä¸¤ç«¯å°±éƒ½å…³é—­ï¼Œå¹¶ä¸”<code>buffer</code>é‡Œä¹Ÿæ²¡æœ‰ä»»ä½•å…¶å®ƒæ•°æ®äº†ã€‚</li>
<li>ç”¨æˆ·è°ƒç”¨<code>join_thread</code>ï¼Œè§¦å‘<code>self._thread.join()</code>ï¼Œå…³é—­æ¶ˆè´¹çº¿ç¨‹</li>
</ul>
<p>åœ¨<code>multiprocessing</code>å½“ä¸­ï¼Œ<code>Queue</code>è¿˜æœ‰ä¸¤ç§å˜ä½“ï¼Œåˆ†åˆ«ä¸º<code>SimpleQueue</code>å’Œ<code>JoinableQueue</code>ã€‚<code>SimpleQueue</code>æ²¡æœ‰æä¾›<code>blocking</code>æˆ–<code>timeout</code>çš„åŠŸèƒ½ï¼Œåªæ˜¯ç®€å•åˆ›å»ºä¸€å¯¹<code>pipe</code>äº¤æ¢åºåˆ—åŒ–çš„æ•°æ®ã€‚<code>JoinableQueue</code>åˆ™æ˜¯åœ¨<code>Queue</code>çš„åŸºç¡€ä¸Šå¢åŠ äº†<code>join</code>çš„åŠŸèƒ½ï¼Œå…¶å®ç°ä¸Šæ˜¯å¢åŠ äº†ä¸€ä¸ªåˆå§‹å€¼0çš„ä¿¡å·é‡<code>_unfinished_tasks</code>ä»¥åŠä¸€ä¸ªæ¡ä»¶å˜é‡<code>_cond</code>ã€‚<code>JoinableQueue</code>åœ¨è°ƒç”¨<code>join</code>æ—¶ï¼Œå¦‚æœ<code>_unfinished_tasks</code>ä¿¡å·é‡ä¸ä¸º0ä¼šè¿›å…¥<code>_cond.wait</code>ï¼Œè¿™æ˜¯å› ä¸ºæ¯æ¬¡<code>put</code>çš„æ—¶å€™<code>_unfinished_tasks</code>ä¿¡å·é‡ä¼š<code>release</code>ä¸€æ¬¡ï¼Œåªæœ‰ç”¨æˆ·æ¯æ¬¡<code>get</code>ä¹‹åæ˜¾å¼è°ƒç”¨<code>JoinableQueue.task_done</code>æ‰èƒ½<code>acquire</code>ä¸€æ¬¡ä¿¡å·é‡ï¼Œæœ€ç»ˆä½¿å¾—<code>_unfinished_tasks</code>ä¿¡å·é‡å½’é›¶å¹¶<code>notify_all</code>æ‰€æœ‰<code>join</code>çš„è°ƒç”¨ã€‚</p>
<p>æœ€åï¼Œè¿›ç¨‹é—´é€šä¿¡çš„æ–¹æ³•è¯´åˆ°åº•ï¼Œé™¤äº†<code>Pipe</code>è·Ÿ<code>Queue</code>å¤–ï¼Œé‡‡ç”¨<code>Manager</code>å…±äº«å†…å­˜æˆ–è€…ç›´æ¥ç”¨<code>socket</code>ç½‘ç»œé€šä¿¡éƒ½æ˜¯okçš„æ–¹å¼ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯åœ¨å•èŠ‚ç‚¹ä¸Šé¢ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå†…èšçš„<code>python</code>é¡¹ç›®çš„è¯ï¼Œ<code>Queue</code>æ˜¯ä¸äºŒé€‰æ‹©ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>multiprocessing</tag>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>pipe</tag>
        <tag>queue</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘ã€ç¬¬ä¸€ç« -å¤šè¿›ç¨‹ã€‘1ã€Processï¼Œæ–°è¿›ç¨‹çš„è¯ç”Ÿ</title>
    <url>/2022/01/16/hardpython/1_multiprocessing_1/</url>
    <content><![CDATA[<p>åœ¨pythonä¸­ï¼Œå¦‚æœè¦åšå¤šä»»åŠ¡å¹¶è¡Œçš„ç¼–ç¨‹ï¼Œå¿…é¡»è¦æŒæ¡<code>multiprocessing</code>åº“çš„ç›¸å…³è¿ç”¨ã€‚åœ¨pythonçš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9saWJyYXJ5L211bHRpcHJvY2Vzc2luZy5odG1s" title="https://docs.python.org/zh-cn/3/library/multiprocessing.html">multiprocessingå®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>ä¸­ï¼Œå·²ç„¶è¯¦ç»†ç»™å‡ºäº†<code>multiprocessing</code>åº“çš„ç›¸å…³ç”¨æ³•ã€‚å¤šè¿›ç¨‹ç¼–ç¨‹å…¶å®è¿˜æ˜¯æœ‰å¾ˆå¤šå‘å­˜åœ¨çš„ï¼Œä¸ºäº†è¿›ä¸€æ­¥æ¢ç´¢pythonå¤šè¿›ç¨‹çš„æœºåˆ¶ï¼Œæå‡å¯¹pythonå¤šè¿›ç¨‹ç¼–ç¨‹çš„ç†è§£ï¼Œæœ¬ç¯‡æ–‡ç« ä¼šå¯¹å¤šè¿›ç¨‹æ¨¡å—çš„å®ç°è¿›è¡Œä¸€æ¬¡è¯¦ç»†çš„å‰–æã€‚</p>
<p>å¤šè¿›ç¨‹ç¼–ç¨‹çš„ç¬¬ä¸€è¯ï¼Œé¦–å…ˆæ¥èŠèŠä¸€ä¸ªæ–°çš„pythonå­è¿›ç¨‹æ˜¯å¦‚ä½•è¯ç”Ÿçš„ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£è¿™ä¹ˆä¸€ä¸ªäº‹æƒ…ï¼Œpythonåˆ›å»ºçš„è¿›ç¨‹ä¹‹é—´æ¨¡å—çŠ¶æ€æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚åœ¨å¤šè¿›ç¨‹çš„åœºæ™¯ä¸‹ï¼Œä»£ç ä¸­å®šä¹‰çš„å„ç§å˜é‡ï¼Œå…¶å€¼å¹¶ä¸ä¸€å®šä¼šå…±äº«ã€‚æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™åªæ˜¯å¦å¤–ä¸€ä¸ªæ¨¡å—ï¼Œé‡Œå¤´æœ‰ä¸ªå˜é‡FLAGï¼Œé»˜è®¤æ˜¯0ï¼Œinitä¹‹åæ˜¯-1</span></span><br><span class="line"><span class="keyword">import</span> mp_module</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"># mp_module.py</span></span><br><span class="line"><span class="string">FLAG = -1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def get_flag():</span></span><br><span class="line"><span class="string">    return FLAG</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def init_flag():</span></span><br><span class="line"><span class="string">    global FLAG</span></span><br><span class="line"><span class="string">    FLAG = 1</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test_module_isolation</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">from</span> multiprocessing <span class="keyword">import</span> process</span><br><span class="line">    parent = process.parent_process()</span><br><span class="line">    <span class="keyword">if</span> parent:</span><br><span class="line">        print(<span class="string">f'[<span class="subst">&#123;os.getpid()&#125;</span>] <span class="subst">&#123;parent.pid&#125;</span>'</span>)</span><br><span class="line">    print(<span class="string">f'[<span class="subst">&#123;os.getpid()&#125;</span>] [<span class="subst">&#123;threading.current_thread()&#125;</span>] <span class="subst">&#123;mp_module.get_flag()&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_module_isolation</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">f'main process pid: <span class="subst">&#123;os.getpid()&#125;</span>'</span>)</span><br><span class="line"></span><br><span class="line">    p = mp.Process(target=_test_module_isolation)</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    _test_module_isolation()</span><br><span class="line">    p.join()</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    mp.set_start_method(<span class="string">'spawn'</span>)</span><br><span class="line">    mp_module.init_flag()</span><br><span class="line">    test_module_isolation()</span><br></pre></td></tr></table></figure>
<p>åœ¨å‡½æ•°<code>test_module_isolation</code>ä¸­ï¼Œé¦–å…ˆæ˜¯è°ƒç”¨<code>mp_module.init_flag()</code>æ”¹å˜äº†<code>mp_module</code>æ¨¡å—ä¸€ä¸ªå˜é‡çš„å€¼ï¼Œä¹‹ååŒæ—¶åœ¨ä¸»è¿›ç¨‹å’Œæ–°èµ·çš„è¿›ç¨‹è°ƒç”¨äº†<code>_test_module_isolation()</code>å»æ‰“å°<code>mp_module</code>ä¸­çš„å˜é‡ã€‚ç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main process pid: 14836</span><br><span class="line">[14836] [&lt;_MainThread(MainThread, started 20244)&gt;] 1</span><br><span class="line">[22212] 14836</span><br><span class="line">[22212] [&lt;_MainThread(MainThread, started 23804)&gt;] -1</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¿›ç¨‹ï¼ˆ14836ï¼‰ä¸­æ‰“å°å‡ºæ¥çš„å˜é‡æ˜¯åˆå§‹åŒ–è¿‡çš„ï¼Œè€Œå­è¿›ç¨‹ï¼ˆ22212ï¼‰æ‰“å°å‡ºæ¥çš„å˜é‡æ˜¯æ²¡æœ‰ç»è¿‡åˆå§‹åŒ–çš„ã€‚</p>
<p>é€šè¿‡<code>Process</code>å®ä¾‹åˆ›å»ºå‡ºæ¥çš„è¿›ç¨‹å¯¹è±¡ï¼Œè°ƒç”¨<code>start</code>æ–¹æ³•å³å¯å¯åŠ¨æ–°è¿›ç¨‹ï¼Œæ‰§è¡Œ<code>target</code>å¯¹åº”çš„æ–¹æ³•ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># BaseProcess.start</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">        Start child process</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">    self._check_closed()</span><br><span class="line">    <span class="keyword">assert</span> self._popen <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">'cannot start a process twice'</span></span><br><span class="line">    <span class="keyword">assert</span> self._parent_pid == os.getpid(), \</span><br><span class="line">    <span class="string">'can only start a process object created by current process'</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="keyword">not</span> _current_process._config.get(<span class="string">'daemon'</span>), \</span><br><span class="line">    <span class="string">'daemonic processes are not allowed to have children'</span></span><br><span class="line">    _cleanup()</span><br><span class="line">    self._popen = self._Popen(self)</span><br><span class="line">    self._sentinel = self._popen.sentinel</span><br><span class="line">    <span class="comment"># Avoid a refcycle if the target function holds an indirect</span></span><br><span class="line">    <span class="comment"># reference to the process object (see bpo-30775)</span></span><br><span class="line">    <span class="keyword">del</span> self._target, self._args, self._kwargs</span><br><span class="line">    _children.add(self)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Process._Popen</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpawnProcess</span><span class="params">(process.BaseProcess)</span>:</span></span><br><span class="line">    _start_method = <span class="string">'spawn'</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_Popen</span><span class="params">(process_obj)</span>:</span></span><br><span class="line">        <span class="keyword">from</span> .popen_spawn_win32 <span class="keyword">import</span> Popen</span><br><span class="line">        <span class="keyword">return</span> Popen(process_obj)</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºè¿›ç¨‹çš„æ–¹å¼æœ‰å¤šç§ï¼Œå…¶ä¸­<code>spawn</code>æ¨¡å¼ä¸ºwindows/linuxç³»ç»Ÿä¸‹å‡å…¼å®¹çš„ï¼Œä¸”ä¸ºwindowsçš„é»˜è®¤æ¨¡å¼ã€‚åœ¨<code>Process._Popen</code>ä¸­ï¼Œä¼šé€šè¿‡<code>_default_context.get_context()</code>è·å–å½“å‰çš„è¿›ç¨‹å¯åŠ¨æ¨¡å¼ã€‚</p>
<p>ä»¥windowsä¸‹çš„<code>spawn</code>æ¨¡å¼ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹ä¸‹è¿›ç¨‹å¯åŠ¨çš„ä»£ç çš„å®ç°ã€‚ä¸»è¦é€»è¾‘åˆ†å¸ƒåœ¨3ä¸ªåœ°æ–¹ï¼š</p>
<ul>
<li><code>popen_spawn_win32.Popen</code></li>
<li><code>multiprocessing/spawn.py</code></li>
<li><code>process.BaseProcess</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># popen_fork.Popen</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Popen</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, process_obj)</span>:</span></span><br><span class="line">        util._flush_std_streams()</span><br><span class="line">        self.returncode = <span class="literal">None</span></span><br><span class="line">        self.finalizer = <span class="literal">None</span></span><br><span class="line">        self._launch(process_obj)</span><br><span class="line">        </span><br><span class="line"><span class="comment"># popen_spawn_win32.Popen</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Popen</span><span class="params">(object)</span>:</span></span><br><span class="line">    method = <span class="string">'spawn'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, process_obj)</span>:</span></span><br><span class="line">        prep_data = spawn.get_preparation_data(process_obj._name)</span><br><span class="line"></span><br><span class="line">        rhandle, whandle = _winapi.CreatePipe(<span class="literal">None</span>, <span class="number">0</span>)</span><br><span class="line">        wfd = msvcrt.open_osfhandle(whandle, <span class="number">0</span>)</span><br><span class="line">        cmd = spawn.get_command_line(parent_pid=os.getpid(),</span><br><span class="line">                                     pipe_handle=rhandle)</span><br><span class="line">        cmd = <span class="string">' '</span>.join(<span class="string">'"%s"'</span> % x <span class="keyword">for</span> x <span class="keyword">in</span> cmd)</span><br><span class="line"></span><br><span class="line">        python_exe = spawn.get_executable()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> WINENV <span class="keyword">and</span> _path_eq(python_exe, sys.executable):</span><br><span class="line">            python_exe = sys._base_executable</span><br><span class="line">            env = os.environ.copy()</span><br><span class="line">            env[<span class="string">"__PYVENV_LAUNCHER__"</span>] = sys.executable</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            env = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> open(wfd, <span class="string">'wb'</span>, closefd=<span class="literal">True</span>) <span class="keyword">as</span> to_child:</span><br><span class="line">            <span class="comment"># start process</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                hp, ht, pid, tid = _winapi.CreateProcess(</span><br><span class="line">                    python_exe, cmd,</span><br><span class="line">                    <span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">False</span>, <span class="number">0</span>, env, <span class="literal">None</span>, <span class="literal">None</span>)</span><br><span class="line">                _winapi.CloseHandle(ht)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                _winapi.CloseHandle(rhandle)</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># set attributes of self</span></span><br><span class="line">            self.pid = pid</span><br><span class="line">            self.returncode = <span class="literal">None</span></span><br><span class="line">            self._handle = hp</span><br><span class="line">            self.sentinel = int(hp)</span><br><span class="line">            self.finalizer = util.Finalize(self, _close_handles,</span><br><span class="line">                                           (self.sentinel, int(rhandle)))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># send information to child</span></span><br><span class="line">            set_spawning_popen(self)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                reduction.dump(prep_data, to_child)</span><br><span class="line">                reduction.dump(process_obj, to_child)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                set_spawning_popen(<span class="literal">None</span>)</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line"><span class="comment"># multiprocessing/spawn.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_command_line</span><span class="params">(**kwds)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> getattr(sys, <span class="string">'frozen'</span>, <span class="literal">False</span>):</span><br><span class="line">        <span class="keyword">return</span> ([sys.executable, <span class="string">'--multiprocessing-fork'</span>] +</span><br><span class="line">                [<span class="string">'%s=%r'</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> kwds.items()])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        prog = <span class="string">'from multiprocessing.spawn import spawn_main; spawn_main(%s)'</span></span><br><span class="line">        prog %= <span class="string">', '</span>.join(<span class="string">'%s=%r'</span> % item <span class="keyword">for</span> item <span class="keyword">in</span> kwds.items())</span><br><span class="line">        opts = util._args_from_interpreter_flags()</span><br><span class="line">        <span class="keyword">return</span> [_python_exe] + opts + [<span class="string">'-c'</span>, prog, <span class="string">'--multiprocessing-fork'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">spawn_main</span><span class="params">(pipe_handle, parent_pid=None, tracker_fd=None)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> is_forking(sys.argv), <span class="string">"Not forking"</span></span><br><span class="line">    <span class="keyword">if</span> sys.platform == <span class="string">'win32'</span>:</span><br><span class="line">        <span class="keyword">import</span> msvcrt</span><br><span class="line">        <span class="keyword">import</span> _winapi</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> parent_pid <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            source_process = _winapi.OpenProcess(</span><br><span class="line">                _winapi.SYNCHRONIZE | _winapi.PROCESS_DUP_HANDLE,</span><br><span class="line">                <span class="literal">False</span>, parent_pid)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            source_process = <span class="literal">None</span></span><br><span class="line">        new_handle = reduction.duplicate(pipe_handle,</span><br><span class="line">                                         source_process=source_process)</span><br><span class="line">        fd = msvcrt.open_osfhandle(new_handle, os.O_RDONLY)</span><br><span class="line">        parent_sentinel = source_process</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">from</span> . <span class="keyword">import</span> resource_tracker</span><br><span class="line">        resource_tracker._resource_tracker._fd = tracker_fd</span><br><span class="line">        fd = pipe_handle</span><br><span class="line">        parent_sentinel = os.dup(pipe_handle)</span><br><span class="line">    exitcode = _main(fd, parent_sentinel)</span><br><span class="line">    sys.exit(exitcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_main</span><span class="params">(fd, parent_sentinel)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> os.fdopen(fd, <span class="string">'rb'</span>, closefd=<span class="literal">True</span>) <span class="keyword">as</span> from_parent:</span><br><span class="line">        process.current_process()._inheriting = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            preparation_data = reduction.pickle.load(from_parent)</span><br><span class="line">            prepare(preparation_data)</span><br><span class="line">            self = reduction.pickle.load(from_parent)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">del</span> process.current_process()._inheriting</span><br><span class="line">    <span class="keyword">return</span> self._bootstrap(parent_sentinel)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># process.BaseProcess</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseProcess</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_bootstrap</span><span class="params">(self, parent_sentinel=None)</span>:</span></span><br><span class="line">        <span class="comment"># å¿½ç•¥</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># å¿½ç•¥ï¼Œè®¾ç½®ä¸€äº›å‚æ•°</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.run()</span><br><span class="line">                exitcode = <span class="number">0</span></span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                util._exit_function()</span><br><span class="line">        <span class="keyword">except</span> SystemExit <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">if</span> e.code <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                exitcode = <span class="number">0</span></span><br><span class="line">            <span class="keyword">elif</span> isinstance(e.code, int):</span><br><span class="line">                exitcode = e.code</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                sys.stderr.write(str(e.code) + <span class="string">'\n'</span>)</span><br><span class="line">                exitcode = <span class="number">1</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            exitcode = <span class="number">1</span></span><br><span class="line">            <span class="comment"># å¿½ç•¥ï¼Œæ‰“å°é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            threading._shutdown()</span><br><span class="line">            util.info(<span class="string">'process exiting with exitcode %d'</span> % exitcode)</span><br><span class="line">            util._flush_std_streams()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> exitcode</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self._target:</span><br><span class="line">            self._target(*self._args, **self._kwargs)</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œç»å†äº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>ç”¨<code>_winapi.CreatePipe</code>åˆ›å»ºä¸€å¯¹ç”¨äºè¿›ç¨‹é—´é€šä¿¡çš„<code>handle</code><ul>
<li><code>rhandle</code>ä¼šä¼ ç»™å­è¿›ç¨‹ï¼Œ<code>whandle</code>ä¼šè¢«ä¸»è¿›ç¨‹ç”¨äºç»™å­è¿›ç¨‹å‘é€æ•°æ®</li>
</ul>
</li>
<li>è·å–æ„å»ºå­è¿›ç¨‹è¿è¡Œæ—¶ç¯å¢ƒæ‰€éœ€è¦çš„å‡†å¤‡æ•°æ®<code>prep_data</code><ul>
<li>åŒ…æ‹¬<code>sys.argv</code>ã€<code>sys.path</code>ã€æ—¥å¿—é…ç½®ã€åˆå§‹åŒ–<code>__main__</code>æ¨¡å—çš„æ–‡ä»¶è·¯å¾„ç­‰</li>
</ul>
</li>
<li>é€šè¿‡<code>spawn.get_command_line</code>åˆå§‹åŒ–<code>spawn</code>è¿›ç¨‹æ‰€éœ€çš„å‘½ä»¤<ul>
<li>ä»å‡½æ•°å®šä¹‰ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå­è¿›ç¨‹æ‰§è¡Œçš„å‘½ä»¤ä¸­ä¼šè°ƒç”¨<code>spawn.spawn_main</code>å‡½æ•°</li>
</ul>
</li>
<li>è°ƒç”¨<code>_winapi.CreateProcess</code>ç”Ÿæˆå­è¿›ç¨‹</li>
<li>é€šè¿‡<code>whandle</code>è½¬æ¢åçš„fdå‘å­è¿›ç¨‹å†™å…¥åºåˆ—åŒ–åçš„å‡†å¤‡æ•°æ®ä»¥åŠè‡ªèº«<code>Process</code>å®ä¾‹æ•°æ®</li>
<li>å­è¿›ç¨‹åœ¨<code>spawn_main</code>å‡½æ•°å°†ä¼ å…¥çš„<code>rhandle</code>è½¬åŒ–ä¸ºfdï¼Œåœ¨<code>_main</code>å‡½æ•°ä¸­æ¥æ”¶ä¸»è¿›ç¨‹ä¼ å…¥çš„æ•°æ®ï¼Œå¹¶æ‰§è¡Œå¯¹åº”æ“ä½œ<ul>
<li>æ¥æ”¶<code>prep_data</code>ï¼Œåˆå§‹åŒ–å­è¿›ç¨‹è¿è¡Œæ—¶ç¯å¢ƒã€‚å…¶ä¸­ä¼šé‡æ–°æ‰§è¡ŒåŸæ¥<code>__main__</code>æ¨¡å—å¯¹åº”çš„ä»£ç å—<ul>
<li>è¿™é‡Œæ³¨æ„ï¼Œå­è¿›ç¨‹æ‰§è¡ŒåŸæ¥<code>__main__</code>æ¨¡å—çš„ä»£ç å—ï¼Œæ˜¯ä»¥<code>__mp_main__</code>è¿™ä¸ªæ¨¡å—åæ‰§è¡Œçš„ã€‚å› æ­¤ï¼ŒåŸæ¥ä»£ç é‡Œå¤´<code>if __name__ == &#39;__main__&#39;</code>ä¸‹é¢çš„éƒ½æ‰§è¡Œä¸åˆ°ã€‚æ‰€ä»¥ï¼Œå­è¿›ç¨‹è·‘ä¸åˆ°<code>mp_module.init_flag()</code>ï¼Œé‡Œé¢çš„<code>flag</code>å€¼å½“ç„¶æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚å¦‚æœè¦è®©<code>flag</code>è¢«åˆå§‹åŒ–çš„è¯ï¼Œç›¸ä¿¡èªæ˜çš„ä½ çŸ¥é“æ€ä¹ˆåšã€‚</li>
</ul>
</li>
<li>æ‰§è¡Œ<code>Process</code>å®ä¾‹çš„<code>_bootstrap</code>å‡½æ•°ã€‚<code>_bootstrap</code>å‡½æ•°æœ€ç»ˆè°ƒç”¨<code>run</code>å‡½æ•°ï¼Œæ‰§è¡Œ<code>_target</code>å¯¹åº”çš„å†…å®¹</li>
</ul>
</li>
</ul>
<p>è¿™æ ·ï¼Œæ–°çš„pythonè¿›ç¨‹å°±è¢«åˆ›å»ºå¹¶å¼€å§‹è¿è¡Œäº†ã€‚</p>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>multiprocessing</tag>
        <tag>Process</tag>
        <tag>å¤šè¿›ç¨‹</tag>
        <tag>spawn</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Hard Pythonã€‘å‰è¨€</title>
    <url>/2022/01/08/hardpython/preface/</url>
    <content><![CDATA[<p>å†™å®ŒMedium Pythonä¹‹åï¼Œä¸çŸ¥ä¸è§‰å°±æœ‰å¼€å§‹ç»§ç»­å†™Hard Pythonçš„å†²åŠ¨ã€‚æ‹©æ—¥ä¸å¦‚æ’æ—¥ï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ï¼Œ2022å¹´å¼€ç¯‡ï¼Œæœæ–­å°†Hard Pythonæä¸Šæ—¥ç¨‹ã€‚</p>
<p>æˆªè‡³2021å¹´åº•ï¼Œpythonä¾æ—§æ˜¯æœ€çƒ­é—¨çš„è¯­è¨€ä¹‹ä¸€ï¼Œéšç€3.10ã€3.11åŠåç»­ç‰ˆæœ¬çš„å‘å¸ƒï¼Œpythonçš„runtimeåœ¨åŠŸèƒ½åŠæ€§èƒ½ä¸Šéƒ½ä¼šæœ‰è¾ƒå¤§çš„æå‡ã€‚æ—¶è‡³ä»Šæ—¥ï¼Œæåˆ°æŠ€æœ¯åº”ç”¨æœ€å¹¿æ³›çš„è¯­è¨€ï¼Œé™¤äº†pythonï¼Œè¿˜ä¼šæœ‰å¦å¤–çš„å—ï¼Ÿæ’é™¤åŒºå—é“¾ã€æ¸¸æˆã€éŸ³è§†é¢‘é‡Œè¾ƒä¸ºæ·±åº¦çš„é¢†åŸŸï¼ŒåŸºæœ¬ä¸Šå„ç§æŠ€æœ¯ä¸šåŠ¡åœºæ™¯ï¼Œéƒ½ä¼šæœ‰pythonçš„å½±å­ã€‚</p>
<p>å¯ä»¥è¯´ï¼Œpythonæ˜¯ç¼–ç¨‹ç•Œçš„ä¸€æŠŠç‘å£«å†›åˆ€ã€‚å¦‚æœæˆ‘ä»¬èƒ½æ›´åŠ æ·±å…¥çš„äº†è§£pythonå„ä¸ªé‡ç‚¹æ¨¡å—çš„æŠ€æœ¯åŸç†ï¼Œä¸ä»…å¯¹äºæˆ‘ä»¬ç†è§£è¿™é—¨è¯­è¨€ä»¥åŠç¼–ç¨‹è¯­è¨€ç›¸å…³æŠ€æœ¯æœ‰ç›Šå¤„ï¼Œå¹¶ä¸”ä»¥åæˆ‘ä»¬åœ¨é¢å¯¹ä¸€äº›pythonçš„ç¼–ç¨‹åœºæ™¯æ—¶ä¹Ÿä¼šæ›´åŠ å¾—å¿ƒåº”æ‰‹ã€‚</p>
<p>åœ¨å…ˆå‰å·²ç»å†™è¿‡ä¸¤ä¸ªpythonç³»åˆ—ï¼Œåˆ†åˆ«æ˜¯<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvRWFzeS1QeXRob24v" title="https://utmhikari.top/categories/Easy-Python/">Easy Python<i class="fa fa-external-link"></i></span>ä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvTWVkaXVtLVB5dGhvbi8=" title="https://utmhikari.top/categories/Medium-Python/">Medium Python<i class="fa fa-external-link"></i></span>ã€‚åœ¨Easy Pythonä¸­ï¼Œå¯¹pythonçš„å„ç§åŸºç¡€æ¦‚å¿µä»¥åŠå®ç”¨åœºæ™¯ä»‹ç»äº†ç›¸å…³æ¡ˆä¾‹ï¼›è€Œåœ¨Medium Pythonä¸­ï¼Œé€šè¿‡æºç åˆ†æçš„æ–¹å¼ï¼Œå‰–æäº†pythonå†…éƒ¨æŸäº›è¯­è¨€ç‰¹æ€§çš„å®ç°ï¼Œè®²è¿°äº†è®¸å¤špythonç›¸å…³çš„å†·çŸ¥è¯†ã€‚è¿™æ¬¡Hard Pythonï¼Œè¿˜æ˜¯å›å½’æœ¬æºï¼Œå°†ä¼šæŒ‘é€‰ä¸€äº›pythonå†…éƒ¨æ¯”è¾ƒé‡ç‚¹çš„åŸºç¡€æ¨¡å—è¿›è¡Œæ·±å…¥å‰–æè®²è§£ï¼Œäº‰å–è®©æ¯ä¸€ä½é˜…è¯»æœ¬ç³»åˆ—æ–‡ç« çš„åŒå­¦å¯¹pythonè¿™é—¨è¯­è¨€æœ‰æ›´åŠ å…¨æ–°çš„ç†è§£ã€‚</p>
<p>è¯ä¸å¤šè¯´ï¼Œå‡†å¤‡ä¸Šèœï¼</p>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li>ç¬¬ä¸€ç« ï¼šå¤šçº¿ç¨‹<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDEvMTYvaGFyZHB5dGhvbi8xX211bHRpcHJvY2Vzc2luZ18xLw==" title="https://utmhikari.top/2022/01/16/hardpython/1_multiprocessing_1/">1ã€Processï¼Œæ–°è¿›ç¨‹çš„è¯ç”Ÿ<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDEvMjIvaGFyZHB5dGhvbi8xX211bHRpcHJvY2Vzc2luZ18yLw==" title="https://utmhikari.top/2022/01/22/hardpython/1_multiprocessing_2/">2ã€Pipeå’ŒQueueï¼Œè¿›ç¨‹é—´é€šä¿¡<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDEvMzAvaGFyZHB5dGhvbi8xX211bHRpcHJvY2Vzc2luZ18zLw==" title="https://utmhikari.top/2022/01/30/hardpython/1_multiprocessing_3/">3ã€Poolï¼Œå¤šä»»åŠ¡å¹¶è¡Œè¿›ç¨‹æ± <i class="fa fa-external-link"></i></span></li>
</ul>
</li>
<li>ç¬¬äºŒç« ï¼šå¼‚æ­¥IO<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDIvMTIvaGFyZHB5dGhvbi8yX2FzeW5jaW9fMS8=" title="https://utmhikari.top/2022/02/12/hardpython/2_asyncio_1/">1ã€asyncioäº‹ä»¶å¾ªç¯çš„åˆ›å»º<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDIvMjAvaGFyZHB5dGhvbi8yX2FzeW5jaW9fMi8=" title="https://utmhikari.top/2022/02/20/hardpython/2_asyncio_2/">2ã€å¼‚æ­¥ä»»åŠ¡åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„æ‰§è¡Œ<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDIvMjYvaGFyZHB5dGhvbi8yX2FzeW5jaW9fMy8=" title="https://utmhikari.top/2022/02/26/hardpython/2_asyncio_3/">3ã€async/awaitçš„æºç å®ç°<i class="fa fa-external-link"></i></span></li>
</ul>
</li>
<li>ç¬¬ä¸‰ç« ï¼šGC<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDMvMTIvaGFyZHB5dGhvbi8zX2djXzEv" title="https://utmhikari.top/2022/03/12/hardpython/3_gc_1/">1ã€å¼•ç”¨è®¡æ•°ä¸å†…å­˜é‡Šæ”¾æœºåˆ¶<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDMvMTkvaGFyZHB5dGhvbi8zX2djXzIv" title="https://utmhikari.top/2022/03/19/hardpython/3_gc_2/">2ã€pythonçš„GCæµç¨‹<i class="fa fa-external-link"></i></span></li>
</ul>
</li>
<li>ç¬¬å››ç« ï¼šæ—¥å¿—<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDQvMDkvaGFyZHB5dGhvbi80X2xvZ18xLw==" title="https://utmhikari.top/2022/04/09/hardpython/4_log_1/">1ã€Loggerä¸Managerçš„æºç å®ç°<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDQvMTYvaGFyZHB5dGhvbi80X2xvZ18yLw==" title="https://utmhikari.top/2022/04/16/hardpython/4_log_2/">2ã€æ—¥å¿—æ¶ˆè´¹è€…Handlerçš„å®ç°<i class="fa fa-external-link"></i></span></li>
</ul>
</li>
<li>ç¬¬äº”ç« ï¼šå­—ç¬¦ä¸²<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDUvMDgvaGFyZHB5dGhvbi81X3N0cl8xLw==" title="https://utmhikari.top/2022/05/08/hardpython/5_str_1/">1ã€unicodeï¼Œpy3çš„å­—ç¬¦ä¸²å®ç°<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjIvMDUvMTQvaGFyZHB5dGhvbi81X3N0cl8yLw==" title="https://utmhikari.top/2022/05/14/hardpython/5_str_2/">2ã€reï¼Œæ­£åˆ™è¡¨è¾¾å¼æºç è¯¦è§£<i class="fa fa-external-link"></i></span></li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Hard Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>Medium Python</tag>
        <tag>Easy Python</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘å¦‚ä½•æå–pythonå‡½æ•°çš„æ¥å£å®šä¹‰ä¿¡æ¯</title>
    <url>/2021/12/12/pythonnotes/function_info/</url>
    <content><![CDATA[<p>åœ¨æŸäº›pythonæ¡†æ¶åº•å±‚çš„å¼€å‘éœ€æ±‚ä¸­ï¼Œéœ€è¦é€šè¿‡ä¸€äº›ç±»ä¼¼åå°„çš„æ‰‹æ®µï¼Œæå–å‡½æ•°æ¥å£çš„ä¿¡æ¯ï¼Œä»è€Œå¯¹ä¸€ç³»åˆ—å‡½æ•°æ¥å£è¿›è¡Œç®¡ç†ã€‚æœ¬ç¯‡æ–‡ç« å°±æ¥ç²—æµ…è°ˆä¸€ä¸‹ï¼Œå¦‚ä½•æå–pythonå‡½æ•°çš„æ¥å£å®šä¹‰ä¿¡æ¯ã€‚</p>
<h2 id="functionå¯¹è±¡çš„ä¿¡æ¯"><a href="#functionå¯¹è±¡çš„ä¿¡æ¯" class="headerlink" title="functionå¯¹è±¡çš„ä¿¡æ¯"></a>functionå¯¹è±¡çš„ä¿¡æ¯</h2><p>é¦–å…ˆæˆ‘ä»¬æ‹¿ä¸€ä¸ªå‡½æ•°æ¥è¯•è¯•æ‰‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myprinter</span><span class="params">(s: str, /, e: str = <span class="string">'\n'</span>, *, prefix: Any = <span class="string">''</span>)</span> -&gt; Tuple[bool, str]:</span></span><br><span class="line">    <span class="string">"""hello world"""</span></span><br><span class="line">    msg = str(prefix) + s + e</span><br><span class="line">    print(msg, end=<span class="string">''</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span>, msg</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå‡½æ•°<code>myprinter</code>é‡‡ç”¨äº†æ–°çš„è¯­æ³•ç³–<code>/</code>ä»¥åŠ<code>*</code>ï¼Œ<code>/</code>çš„å·¦è¾¹è¡¨ç¤ºå¼ºåˆ¶ä½ç½®å‚æ•°ï¼ˆpositional-only argumentsï¼‰ï¼Œ<code>*</code>çš„å³è¾¹è¡¨ç¤ºå¼ºåˆ¶å…³é”®å­—å‚æ•°ï¼ˆkeyword-only argumentsï¼‰ï¼Œè€Œä¸¤è€…ä¸­é—´çš„å‚æ•°åœ¨ä½¿ç”¨æ—¶ä»¥ä½ç½®å‚æ•°æˆ–è€…æ˜¯å…³é”®å­—å‚æ•°çš„å½¢å¼è¡¨è¾¾éƒ½å¯ä»¥ã€‚</p>
<p>è¦æå–è¿™ä¸ªå‡½æ•°çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“å‡½æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡ã€‚å› æ­¤ï¼Œå¯ä»¥ç”¨åˆ°<code>dir</code>å‡½æ•°ï¼Œéå†è¿™ä¸ªå¯¹è±¡çš„å±æ€§ï¼Œä»è€Œæå–æ‰€æœ‰å±æ€§çš„å€¼ã€‚</p>
<p>é€šè¿‡<code>dir</code>å¯¼å‡ºå‡½æ•°å¯¹è±¡çš„å±æ€§ä¸å€¼ï¼Œæ‰“å°çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&apos;__annotations__&apos;: &#123;&apos;e&apos;: &lt;class &apos;str&apos;&gt;,</span><br><span class="line">                     &apos;prefix&apos;: typing.Any,</span><br><span class="line">                     &apos;return&apos;: typing.Tuple[bool, str],</span><br><span class="line">                     &apos;s&apos;: &lt;class &apos;str&apos;&gt;&#125;,</span><br><span class="line"> &apos;__call__&apos;: &lt;method-wrapper &apos;__call__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__class__&apos;: &lt;class &apos;function&apos;&gt;,</span><br><span class="line"> &apos;__closure__&apos;: None,</span><br><span class="line"> &apos;__code__&apos;: &lt;code object myprinter at 0x000001C78CC823A0, file &quot;H:\Projects\Python\playground\datastruct\functionobj.py&quot;, line 11&gt;,</span><br><span class="line"> &apos;__defaults__&apos;: (&apos;\n&apos;,),</span><br><span class="line"> &apos;__delattr__&apos;: &lt;method-wrapper &apos;__delattr__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__dict__&apos;: &#123;&#125;,</span><br><span class="line"> &apos;__dir__&apos;: [å‡½æ•°å¯¹è±¡çš„å±æ€§åˆ—è¡¨ï¼Œå…¶å®å°±æ‰“å°çš„è¿™äº›ï¼Œä¸å†é‡å¤åˆ—ä¸¾äº†],</span><br><span class="line"> &apos;__doc__&apos;: &apos;hello world&apos;,</span><br><span class="line"> &apos;__eq__&apos;: &lt;method-wrapper &apos;__eq__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__format__&apos;: &lt;built-in method __format__ of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__ge__&apos;: &lt;method-wrapper &apos;__ge__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__get__&apos;: &lt;method-wrapper &apos;__get__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__getattribute__&apos;: &lt;method-wrapper &apos;__getattribute__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__globals__&apos;: &#123;å‡½æ•°å¯¹åº”çš„å…¨å±€ç¯å¢ƒæƒ…å†µï¼Œä¸ä¸€ä¸€åˆ—ä¸¾äº†&#125;,</span><br><span class="line"> &apos;__gt__&apos;: &lt;method-wrapper &apos;__gt__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__hash__&apos;: 122285281028,</span><br><span class="line"> &apos;__init__&apos;: None,</span><br><span class="line"> &apos;__init_subclass__&apos;: None,</span><br><span class="line"> &apos;__kwdefaults__&apos;: &#123;&apos;prefix&apos;: &apos;&apos;&#125;,</span><br><span class="line"> &apos;__le__&apos;: &lt;method-wrapper &apos;__le__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__lt__&apos;: &lt;method-wrapper &apos;__lt__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__module__&apos;: &apos;__main__&apos;,</span><br><span class="line"> &apos;__name__&apos;: &apos;myprinter&apos;,</span><br><span class="line"> &apos;__ne__&apos;: &lt;method-wrapper &apos;__ne__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__new__&apos;: &lt;built-in method __new__ of type object at 0x00007FFF57678C50&gt;,</span><br><span class="line"> &apos;__qualname__&apos;: &apos;myprinter&apos;,</span><br><span class="line"> &apos;__reduce__&apos;: &lt;built-in method __reduce__ of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__reduce_ex__&apos;: &lt;built-in method __reduce_ex__ of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__repr__&apos;: &apos;&lt;function myprinter at 0x000001C78C54F040&gt;&apos;,</span><br><span class="line"> &apos;__setattr__&apos;: &lt;method-wrapper &apos;__setattr__&apos; of function object at 0x000001C78C54F040&gt;,</span><br><span class="line"> &apos;__sizeof__&apos;: 120,</span><br><span class="line"> &apos;__str__&apos;: &apos;&lt;function myprinter at 0x000001C78C54F040&gt;&apos;,</span><br><span class="line"> &apos;__subclasshook__&apos;: NotImplemented&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é‡Œé¢çš„ä¸€äº›å…³é”®å±æ€§ï¼š</p>
<ul>
<li><code>__name__</code>ï¼šå‡½æ•°åå­—ã€‚</li>
<li><code>__qualname__</code>ï¼šå‡½æ•°çš„åˆæ³•åç§°<ul>
<li>æ¯”å¦‚åœ¨<code>class A</code>ä¸­å®šä¹‰ä¸€ä¸ªå‡½æ•°<code>f</code>ï¼Œé‚£ä¹ˆ<code>A.f.__name__</code>æ˜¯<code>f</code>ï¼Œè€Œ<code>A.f.__qualname__</code>æ˜¯<code>A.f</code></li>
</ul>
</li>
<li><code>__doc__</code>ï¼šå‡½æ•°æ³¨é‡Šæ–‡æœ¬</li>
<li><code>__annotations__</code>ï¼šå‡½æ•°å‚æ•°æ³¨é‡Šä¿¡æ¯<ul>
<li>ä¸€èˆ¬å¼€å‘æ—¶å€™æ³¨é‡Šä¿¡æ¯éƒ½æ˜¯å‚æ•°åä»¥åŠå¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œå› æ­¤æœ‰äº†è¿™ä¸ªå°±å¯ä»¥å¯¹å‡½æ•°çš„å…¥å‚è¿›è¡Œåˆæ³•æ ¡éªŒã€‚å½“ç„¶ï¼Œæ˜æ˜¾ä¹Ÿåˆ©å¥½ä¸€äº›IoCæœºåˆ¶çš„åº•å±‚å¼€å‘çš„éœ€æ±‚ã€‚</li>
<li>è¿”å›å€¼å¯¹åº”çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥åœ¨<code>return</code>è¿™ä¸ªkeyä¸‹æ‰¾</li>
</ul>
</li>
<li><code>__defaults__</code>ï¼šä½ç½®å‚æ•°/éå¼ºåˆ¶å…³é”®å­—å‚æ•°çš„é»˜è®¤å€¼çš„tuple</li>
<li><code>__kwdefaults__</code>ï¼šå¼ºåˆ¶å…³é”®å­—å‚æ•°çš„é»˜è®¤å€¼çš„dict</li>
<li><code>__module__</code>ï¼šå‡½æ•°æ‰€å±çš„æ¨¡å—</li>
<li><code>__code__</code>ï¼šå‡½æ•°æ‰€åŒ…å«çš„ä»£ç æ®µå¯¹è±¡</li>
</ul>
<p>é™¤äº†é€šè¿‡<code>dir</code>çš„æ–¹å¼è·å–è¿™äº›å…³é”®å±æ€§ä¹‹å¤–ï¼Œé€šè¿‡<code>inspect</code>åº“çš„<code>getmembers</code>å‡½æ•°ä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚å¯¹äº<code>inspect</code>åº“çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L2luc3BlY3QuaHRtbA==" title="https://docs.python.org/3/library/inspect.html">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>ã€‚</p>
<h2 id="å‚æ•°æ•°æ®ç»“æ„ç±»å‹ä¿¡æ¯"><a href="#å‚æ•°æ•°æ®ç»“æ„ç±»å‹ä¿¡æ¯" class="headerlink" title="å‚æ•°æ•°æ®ç»“æ„ç±»å‹ä¿¡æ¯"></a>å‚æ•°æ•°æ®ç»“æ„ç±»å‹ä¿¡æ¯</h2><p>åœ¨ä¸Šè¿°çš„<code>__annotations__</code>å±æ€§ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæå–åˆ°æ ‡æ³¨çš„å‚æ•°æ•°æ®ç»“æ„ç±»å‹ã€‚å¯¹äº<code>str</code>ã€<code>int</code>è¿™ç§ä¸€èˆ¬å‹æ•°æ®å°±ç›´æ¥æ ‡æ³¨å¯¹åº”çš„ç±»å‹ï¼›è€Œå¯¹äºä¸€äº›æ³›å‹åˆ™éœ€è¦æ ‡æ³¨ä¸º<code>typing</code>ï¼Œæ¯”å¦‚è¯´<code>typing.Dict</code>ã€<code>typing.Any</code>ç­‰ç­‰ã€‚</p>
<p>é’ˆå¯¹<code>typing</code>çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L3R5cGluZy5odG1s" title="https://docs.python.org/3/library/typing.html">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>ã€‚ä¸è¿‡æœ¬æ–‡è®¡åˆ’è¿›ä¸€æ­¥æ¢ç´¢<code>typing</code>å¯¹è±¡çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬ç”¨ä¸€æ®µä»£ç å°±èƒ½ç²—ç•¥å¯¹<code>typing</code>çš„å„ç±»å¯¹è±¡ä¿¡æ¯çœ‹ä¸ªæ˜ç™½ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'typing.Dict:'</span>)</span><br><span class="line">dtype = typing.Dict[str, typing.Union[</span><br><span class="line">    typing.List[int],</span><br><span class="line">    typing.Tuple[bool, str],</span><br><span class="line">    typing.Callable[[float, int], typing.NoReturn]</span><br><span class="line">]]</span><br><span class="line">pprint.pprint(dtype.__dict__)</span><br><span class="line">print(<span class="string">'typing.Union:'</span>)</span><br><span class="line">utype = dtype.__dict__[<span class="string">'__args__'</span>][<span class="number">1</span>]</span><br><span class="line">pprint.pprint(utype.__dict__)</span><br><span class="line">print(<span class="string">'typing.List:'</span>)</span><br><span class="line">ltype = utype.__dict__[<span class="string">'__args__'</span>][<span class="number">0</span>]</span><br><span class="line">pprint.pprint(ltype.__dict__)</span><br><span class="line">print(<span class="string">'typing.Tuple:'</span>)</span><br><span class="line">ttype = utype.__dict__[<span class="string">'__args__'</span>][<span class="number">1</span>]</span><br><span class="line">pprint.pprint(ttype.__dict__)</span><br><span class="line">print(<span class="string">'typing.Callable:'</span>)</span><br><span class="line">ftype = utype.__dict__[<span class="string">'__args__'</span>][<span class="number">2</span>]</span><br><span class="line">pprint.pprint(ftype.__dict__)</span><br><span class="line">print(<span class="string">'typing.NoReturn:'</span>)</span><br><span class="line">norettype = ftype.__dict__[<span class="string">'__args__'</span>][<span class="number">-1</span>]</span><br><span class="line">print(norettype._name)</span><br><span class="line">print(isinstance(norettype, typing._SpecialForm))</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">typing.Dict:</span><br><span class="line">&#123;&apos;__args__&apos;: (&lt;class &apos;str&apos;&gt;,</span><br><span class="line">              typing.Union[typing.List[int], typing.Tuple[bool, str], typing.Callable[[float, int], typing.NoReturn]]),</span><br><span class="line"> &apos;__origin__&apos;: &lt;class &apos;dict&apos;&gt;,</span><br><span class="line"> &apos;__parameters__&apos;: (),</span><br><span class="line"> &apos;__slots__&apos;: None,</span><br><span class="line"> &apos;_inst&apos;: False,</span><br><span class="line"> &apos;_name&apos;: &apos;Dict&apos;&#125;</span><br><span class="line">typing.Union:</span><br><span class="line">&#123;&apos;__args__&apos;: (typing.List[int],</span><br><span class="line">              typing.Tuple[bool, str],</span><br><span class="line">              typing.Callable[[float, int], typing.NoReturn]),</span><br><span class="line"> &apos;__module__&apos;: &apos;typing&apos;,</span><br><span class="line"> &apos;__origin__&apos;: typing.Union,</span><br><span class="line"> &apos;__parameters__&apos;: (),</span><br><span class="line"> &apos;__slots__&apos;: None,</span><br><span class="line"> &apos;_inst&apos;: True,</span><br><span class="line"> &apos;_name&apos;: None&#125;</span><br><span class="line">typing.List:</span><br><span class="line">&#123;&apos;__args__&apos;: (&lt;class &apos;int&apos;&gt;,),</span><br><span class="line"> &apos;__origin__&apos;: &lt;class &apos;list&apos;&gt;,</span><br><span class="line"> &apos;__parameters__&apos;: (),</span><br><span class="line"> &apos;__slots__&apos;: None,</span><br><span class="line"> &apos;_inst&apos;: False,</span><br><span class="line"> &apos;_name&apos;: &apos;List&apos;&#125;</span><br><span class="line">typing.Tuple:</span><br><span class="line">&#123;&apos;__args__&apos;: (&lt;class &apos;bool&apos;&gt;, &lt;class &apos;str&apos;&gt;),</span><br><span class="line"> &apos;__origin__&apos;: &lt;class &apos;tuple&apos;&gt;,</span><br><span class="line"> &apos;__parameters__&apos;: (),</span><br><span class="line"> &apos;__slots__&apos;: None,</span><br><span class="line"> &apos;_inst&apos;: False,</span><br><span class="line"> &apos;_name&apos;: &apos;Tuple&apos;&#125;</span><br><span class="line">typing.Callable:</span><br><span class="line">&#123;&apos;__args__&apos;: (&lt;class &apos;float&apos;&gt;, &lt;class &apos;int&apos;&gt;, typing.NoReturn),</span><br><span class="line"> &apos;__origin__&apos;: &lt;class &apos;collections.abc.Callable&apos;&gt;,</span><br><span class="line"> &apos;__parameters__&apos;: (),</span><br><span class="line"> &apos;__slots__&apos;: None,</span><br><span class="line"> &apos;_inst&apos;: True,</span><br><span class="line"> &apos;_name&apos;: &apos;Callable&apos;&#125;</span><br><span class="line">typing.NoReturn:</span><br><span class="line">NoReturn</span><br><span class="line">True</span><br></pre></td></tr></table></figure>
<p>å¯¹äºä¸€äº›å®¹å™¨ç±»å‹çš„å¯¹è±¡ï¼Œé€šè¿‡<code>__dict__[&#39;__args__&#39;]</code>å°±èƒ½å¤Ÿè·å¾—é‡Œé¢çš„æ•°æ®ç±»å‹æ ‡æ³¨ï¼Œä»è€Œå¯¹å®¹å™¨å¯¹è±¡åˆæ³•æ€§è¿›è¡Œæ£€æŸ¥ã€‚å¯¹äºä¸€äº›éš¶å±äº<code>typing._SpecialForm</code>çš„å¯¹è±¡ï¼Œæ¯”å¦‚<code>Any</code>ã€<code>NoReturn</code>ç­‰ï¼Œå¯ä»¥é€šè¿‡<code>_name</code>å±æ€§æ¥åˆ¤æ–­å…·ä½“æ˜¯å“ªä¸ªã€‚</p>
<h2 id="å‡½æ•°ä½“å¯¹è±¡çš„ä¿¡æ¯"><a href="#å‡½æ•°ä½“å¯¹è±¡çš„ä¿¡æ¯" class="headerlink" title="å‡½æ•°ä½“å¯¹è±¡çš„ä¿¡æ¯"></a>å‡½æ•°ä½“å¯¹è±¡çš„ä¿¡æ¯</h2><p><code>code</code>å¯¹è±¡ï¼ˆå‡½æ•°çš„å‡½æ•°ä½“ï¼‰çš„ä¿¡æ¯ï¼Œä»ä¸Šé¢çš„å±æ€§å¯¼å‡ºæƒ…å†µå¯çŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>__code__</code>æ¥è·å–å‡½æ•°çš„å‡½æ•°ä½“å¯¹è±¡ã€‚</p>
<p>é€šè¿‡<code>dir</code>æˆ–è€…<code>inspect</code>ç­‰æ–¹å¼ï¼Œå¯ä»¥å¯¼å‡º<code>code</code>å¯¹è±¡çš„å±æ€§ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">codeobj = myprinter.__code__</span><br><span class="line">pprint.pprint(objdict(codeobj))</span><br></pre></td></tr></table></figure>
<p>æ‰“å°ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&apos;__class__&apos;: &lt;class &apos;code&apos;&gt;,</span><br><span class="line"> &apos;__delattr__&apos;: &lt;method-wrapper &apos;__delattr__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__dir__&apos;: [å¿½ç•¥],</span><br><span class="line"> &apos;__doc__&apos;: &apos;code(argcount, posonlyargcount, kwonlyargcount, nlocals, &apos;</span><br><span class="line">            &apos;stacksize,\n&apos;</span><br><span class="line">            &apos;      flags, codestring, constants, names, varnames, filename, &apos;</span><br><span class="line">            &apos;name,\n&apos;</span><br><span class="line">            &apos;      firstlineno, lnotab[, freevars[, cellvars]])\n&apos;</span><br><span class="line">            &apos;\n&apos;</span><br><span class="line">            &apos;Create a code object.  Not for the faint of heart.&apos;,</span><br><span class="line"> &apos;__eq__&apos;: &lt;method-wrapper &apos;__eq__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__format__&apos;: &lt;built-in method __format__ of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__ge__&apos;: &lt;method-wrapper &apos;__ge__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__getattribute__&apos;: &lt;method-wrapper &apos;__getattribute__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__gt__&apos;: &lt;method-wrapper &apos;__gt__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__hash__&apos;: -7836529936335626281,</span><br><span class="line"> &apos;__init__&apos;: None,</span><br><span class="line"> &apos;__init_subclass__&apos;: None,</span><br><span class="line"> &apos;__le__&apos;: &lt;method-wrapper &apos;__le__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__lt__&apos;: &lt;method-wrapper &apos;__lt__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__ne__&apos;: &lt;method-wrapper &apos;__ne__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__new__&apos;: &lt;built-in method __new__ of type object at 0x00007FFF5766F870&gt;,</span><br><span class="line"> &apos;__reduce__&apos;: &lt;built-in method __reduce__ of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__reduce_ex__&apos;: &lt;built-in method __reduce_ex__ of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__repr__&apos;: &apos;&lt;code object myprinter at 0x0000012FB44A2500, file &apos;</span><br><span class="line">             &apos;&quot;H:\\Projects\\Python\\playground\\datastruct\\functionobj.py&quot;, &apos;</span><br><span class="line">             &apos;line 12&gt;&apos;,</span><br><span class="line"> &apos;__setattr__&apos;: &lt;method-wrapper &apos;__setattr__&apos; of code object at 0x0000012FB44A2500&gt;,</span><br><span class="line"> &apos;__sizeof__&apos;: 176,</span><br><span class="line"> &apos;__str__&apos;: &apos;&lt;code object myprinter at 0x0000012FB44A2500, file &apos;</span><br><span class="line">            &apos;&quot;H:\\Projects\\Python\\playground\\datastruct\\functionobj.py&quot;, &apos;</span><br><span class="line">            &apos;line 12&gt;&apos;,</span><br><span class="line"> &apos;__subclasshook__&apos;: NotImplemented,</span><br><span class="line"> &apos;co_argcount&apos;: 2,</span><br><span class="line"> &apos;co_cellvars&apos;: (),</span><br><span class="line"> &apos;co_code&apos;: b&apos;t\x00|\x02\x83\x01|\x00\x17\x00|\x01\x17\x00&#125;\x03t\x01|\x03&apos;</span><br><span class="line">            b&apos;d\x01d\x02\x8d\x02\x01\x00d\x03|\x03f\x02S\x00&apos;,</span><br><span class="line"> &apos;co_consts&apos;: (&apos;hello world&apos;, &apos;&apos;, (&apos;end&apos;,), True),</span><br><span class="line"> &apos;co_filename&apos;: &apos;H:\\Projects\\Python\\playground\\datastruct\\functionobj.py&apos;,</span><br><span class="line"> &apos;co_firstlineno&apos;: 12,</span><br><span class="line"> &apos;co_flags&apos;: 67,</span><br><span class="line"> &apos;co_freevars&apos;: (),</span><br><span class="line"> &apos;co_kwonlyargcount&apos;: 1,</span><br><span class="line"> &apos;co_lnotab&apos;: b&apos;\x00\x02\x10\x01\x0c\x01&apos;,</span><br><span class="line"> &apos;co_name&apos;: &apos;myprinter&apos;,</span><br><span class="line"> &apos;co_names&apos;: (&apos;str&apos;, &apos;print&apos;),</span><br><span class="line"> &apos;co_nlocals&apos;: 4,</span><br><span class="line"> &apos;co_posonlyargcount&apos;: 1,</span><br><span class="line"> &apos;co_stacksize&apos;: 4,</span><br><span class="line"> &apos;co_varnames&apos;: (&apos;s&apos;, &apos;e&apos;, &apos;prefix&apos;, &apos;msg&apos;),</span><br><span class="line"> &apos;replace&apos;: &lt;code object myprinter at 0x0000012FB44CAA80, file &quot;H:\Projects\Python\playground\datastruct\functionobj.py&quot;, line 12&gt;&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ä¸€äº›å…³é”®å±æ€§å¦‚ä¸‹ï¼ˆåŒæ ·åœ¨<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L2luc3BlY3QuaHRtbA==" title="https://docs.python.org/3/library/inspect.html">inspectçš„æ–‡æ¡£<i class="fa fa-external-link"></i></span>ä¸­èƒ½æŸ¥åˆ°ï¼‰ï¼š</p>
<ul>
<li><code>co_argcount</code>ï¼šå‚æ•°ä¸ªæ•°ï¼ˆä¸åŒ…æ‹¬å¼ºåˆ¶å…³é”®å­—å‚æ•°ï¼Œä»¥åŠå¸¦æ˜Ÿå·çš„å‚æ•°ï¼‰</li>
<li><code>co_filename</code>: æ‰€å±æ–‡ä»¶</li>
<li><code>co_firstlineno</code>ï¼šç¬¬ä¸€è¡Œè¡Œå·</li>
<li><code>co_kwonlyargcount</code>ï¼šå¼ºåˆ¶å…³é”®å­—å‚æ•°ä¸ªæ•°</li>
<li><code>co_name</code>ï¼šå‡½æ•°ä½“çš„åå­—</li>
<li><code>co_varnames</code>ï¼šå‚æ•°ä¸å˜é‡çš„åå­—çš„tuple</li>
</ul>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>åå°„</tag>
        <tag>inspect</tag>
        <tag>dir</tag>
        <tag>typing</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¸¸æˆå¼€å‘ã€‘è¸©å‘UE4çš„Pythonè„šæœ¬æ’ä»¶</title>
    <url>/2021/11/21/gamedev/ue4_python_script_plugin/</url>
    <content><![CDATA[<p>UE4ä»¥C++ä¸ºåŸºç¡€ï¼Œåœ¨æ¸¸æˆå¼€å‘éœ€æ±‚å½“ä¸­ï¼Œå®˜æ–¹æ¨å´‡çš„æ˜¯Blueprintå¯è§†åŒ–ç¼–ç¨‹ï¼Œè€Œé™¤æ­¤ä¹‹å¤–åƒUnLuaã€puertsç­‰è§£å†³æ–¹æ¡ˆä¹Ÿæä¾›äº†luaã€tsç­‰å…¶å®ƒè„šæœ¬è¯­è¨€çš„æ”¯æŒã€‚è‡³äºpythonï¼ŒUE4æœ¬èº«å°±æœ‰æ’ä»¶æ”¯æŒï¼Œå«åš<code>PythonScriptPlugin</code>ï¼Œå¯ç”¨æ’ä»¶åï¼Œåœ¨ç¼–è¾‘å™¨é‡Œï¼Œå¯ä»¥è¾“å…¥pythonä»£ç æ‰§è¡Œä¸€ç³»åˆ—å‘½ä»¤ã€‚åœ¨æœ€æ–°çš„4.27ç‰ˆæœ¬ä¸­ï¼Œpythonçš„ç‰ˆæœ¬æ˜¯3.7.7ã€‚</p>
<p>å›åˆ°æ­£é¢˜ï¼Œä¹‹æ‰€ä»¥è¿™ç¯‡æ–‡ç« æ ‡é¢˜å«è¸©å‘ï¼Œæ˜¯å› ä¸ºçœŸçš„è¸©å‘äº†â€”â€”å°è¯•ç”¨<code>PythonScriptPlugin</code>æ¥ç¼–å†™UE4çš„æ¸¸æˆé€»è¾‘ï¼Œæœ€ç»ˆæ”¾å¼ƒã€‚<code>PythonScriptPlugin</code>é€‚åˆåšä¸€äº›é©±åŠ¨ç¼–è¾‘å™¨çš„æ“ä½œï¼Œæˆ–è€…æ˜¯åšä¸€äº›é™æ€èµ„æºæ£€æŸ¥ç›¸å…³çš„å·¥ä½œï¼ˆå…¶å®è¿™ä¸ªæ’ä»¶çœŸåå°±å«<code>Python Editor Script Plugin</code>ï¼‰ï¼Œå¦‚æœç”¨å®ƒæ¥å†™æ¸¸æˆé€»è¾‘çš„è¯ï¼Œå¾ˆå¤šå¿…é¡»çš„å†…å®¹éƒ½éš¾ä»¥æ”¯æŒã€‚ä½†ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ—¢ç„¶è¸©å‘äº†è¿˜æ˜¯è¦åˆ†äº«ç‚¹ä¸œè¥¿å‡ºæ¥ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« å…ˆç²—æµ…è°ˆä¸€ä¸‹<code>PythonScriptPlugin</code>çš„å·¥ä½œæµã€‚</p>
<a id="more"></a>
<p><code>PythonScriptPlugin</code>çš„ä½¿ç”¨æ–¹æ³•ï¼ŒåŸºæœ¬å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy9lbi1VUy9Qcm9kdWN0aW9uUGlwZWxpbmVzL1NjcmlwdGluZ0FuZEF1dG9tYXRpb24vUHl0aG9uLw==" title="https://docs.unrealengine.com/4.27/en-US/ProductionPipelines/ScriptingAndAutomation/Python/">Scripting the Editor using Python<i class="fa fa-external-link"></i></span></p>
<p>ä¸€äº›å¿…é¡»çš„æ­¥éª¤æœ‰ï¼š</p>
<ul>
<li>æ’ä»¶ä¸­ï¼Œå¯ç”¨<code>Python Editor Script Plugin</code></li>
<li>é¡¹ç›®è®¾ç½®çš„Pythonæ’ä»¶è®¾ç½®é‡Œé¢ï¼Œ<code>sys.path</code>å¢åŠ è‡ªå·±è„šæœ¬çš„ç›®å½•</li>
<li>é¡¹ç›®è®¾ç½®çš„Pythonæ’ä»¶è®¾ç½®é‡Œé¢ï¼Œå¯ç”¨å¼€å‘è€…æ¨¡å¼ï¼Œé‡å¯ååœ¨<code>Intermediate/PythonStubs</code>èƒ½å¤Ÿçœ‹åˆ°å¯¼å‡ºçš„<code>unreal.py</code><ul>
<li>å°†<code>unreal.py</code>æ”¾åˆ°è‡ªå·±è„šæœ¬ç›®å½•ä¸‹ï¼Œå…¶å®ƒ<code>.py</code>è„šæœ¬å°±å¯ä»¥é€šè¿‡<code>import unreal</code>æ¥è°ƒç”¨UEç›¸å…³çš„åº“äº†</li>
<li><code>unreal.py</code>å†…å®¹éå¸¸å¤§ï¼Œideéœ€è¦é…ç½®intellisenseç›¸å…³è®¾ç½®</li>
</ul>
</li>
</ul>
<p>å¦‚æœè¦åœ¨æ¸¸æˆé€»è¾‘é‡Œæ‰§è¡Œpythonå‘½ä»¤ï¼Œå°¤å…¶æ˜¯åœ¨C++é‡Œçš„è¯ï¼ˆè“å›¾å·²ç»æœ‰æ”¯æŒäº†ï¼‰ï¼Œéœ€è¦åœ¨<code>Build.cs</code>çš„<code>PublicDependencyModuleNames</code>åŠ ä¸Š<code>PythonScriptPlugin</code></p>
<p>åœ¨C++æ‰§è¡Œpythonä»£ç çš„è¯ï¼Œå¯ä»¥è¿™æ ·å­åšï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œç¬”è€…å•ç‹¬å†™äº†ä¸ªGameInstanceSubsystemå°è£…äº†ç›¸å…³æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"IPythonScriptPlugin.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> UPyEnvGameInstanceSubsystem::ExecPyCmd(<span class="keyword">const</span> FString&amp; Cmd)</span><br><span class="line">&#123;</span><br><span class="line">    IPythonScriptPlugin* ScriptPlugin = GetScriptPlugin();</span><br><span class="line">    <span class="keyword">if</span> (!_IsScriptPluginAvailable(ScriptPlugin))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ScriptPlugin-&gt;ExecPythonCommand(*Cmd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">IPythonScriptPlugin* UPyEnvGameInstanceSubsystem::GetScriptPlugin()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> IPythonScriptPlugin::Get();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> UPyEnvGameInstanceSubsystem::_IsScriptPluginAvailable(IPythonScriptPlugin* ScriptPlugin)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> ScriptPlugin != <span class="literal">nullptr</span> &amp;&amp; ScriptPlugin-&gt;IsPythonAvailable();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•çš„ä»£ç æ‰§è¡Œå¯ä»¥é€šè¿‡<code>IPythonScriptPlugin</code>çš„<code>ExecPyCmd</code>å®ç°ã€‚å¦‚æœè¯´è¦è·å–æ‰§è¡Œç»“æœï¼Œå¯ä»¥è°ƒç”¨<code>IPythonScriptPlugin</code>çš„<code>ExecPythonCommandEx</code>æ–¹æ³•ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Engine\Plugins\Experimental\PythonScriptPlugin\Source\PythonScriptPlugin\Private\PythonScriptPlugin.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> FPythonScriptPlugin::ExecPythonCommandEx(FPythonCommandEx&amp; InOutPythonCommand)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_PYTHON</span></span><br><span class="line">    <span class="keyword">if</span> (!IsPythonAvailable())</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        InOutPythonCommand.CommandResult = TEXT(<span class="string">"Python is not available!"</span>);</span><br><span class="line">        ensureAlwaysMsgf(<span class="literal">false</span>, TEXT(<span class="string">"%s"</span>), *InOutPythonCommand.CommandResult);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_PYTHON</span></span><br><span class="line">    <span class="keyword">if</span> (InOutPythonCommand.ExecutionMode == EPythonCommandExecutionMode::ExecuteFile)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// We may have been passed literal code or a file</span></span><br><span class="line">        <span class="comment">// To work out which, extract the first token and see if it's a .py file</span></span><br><span class="line">        <span class="comment">// If it is, treat the remaining text as arguments to the file</span></span><br><span class="line">        <span class="comment">// Otherwise, treat it as literal code</span></span><br><span class="line">        FString ExtractedFilename;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">const</span> TCHAR* Tmp = *InOutPythonCommand.Command;</span><br><span class="line">            ExtractedFilename = FParse::Token(Tmp, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (FPaths::GetExtension(ExtractedFilename) == TEXT(<span class="string">"py"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> RunFile(*ExtractedFilename, *InOutPythonCommand.Command, InOutPythonCommand);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> RunString(InOutPythonCommand);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> RunString(InOutPythonCommand);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// WITH_PYTHON</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> FPythonScriptPlugin::RunString(FPythonCommandEx&amp; InOutPythonCommand)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Execute Python code within this block</span></span><br><span class="line">    &#123;</span><br><span class="line">        FPyScopedGIL GIL;</span><br><span class="line">        TGuardValue&lt;<span class="keyword">bool</span>&gt; UnattendedScriptGuard(GIsRunningUnattendedScript, GIsRunningUnattendedScript || EnumHasAnyFlags(InOutPythonCommand.Flags, EPythonCommandFlags::Unattended));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> PyExecMode = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (InOutPythonCommand.ExecutionMode)</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="keyword">case</span> EPythonCommandExecutionMode::ExecuteFile:</span><br><span class="line">            PyExecMode = Py_file_input;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> EPythonCommandExecutionMode::ExecuteStatement:</span><br><span class="line">            PyExecMode = Py_single_input;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> EPythonCommandExecutionMode::EvaluateStatement:</span><br><span class="line">            PyExecMode = Py_eval_input;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            checkf(<span class="literal">false</span>, TEXT(<span class="string">"Invalid EPythonCommandExecutionMode!"</span>));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        FDelegateHandle LogCaptureHandle = PyCore::GetPythonLogCapture().AddLambda([&amp;InOutPythonCommand](EPythonLogOutputType InLogType, <span class="keyword">const</span> TCHAR* InLogString) &#123; InOutPythonCommand.LogOutput.Add(FPythonLogOutputEntry&#123; InLogType, InLogString &#125;); &#125;);</span><br><span class="line">        FPyObjectPtr PyResult = FPyObjectPtr::StealReference(EvalString(*InOutPythonCommand.Command, TEXT(<span class="string">"&lt;string&gt;"</span>), PyExecMode));</span><br><span class="line">        PyCore::GetPythonLogCapture().Remove(LogCaptureHandle);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (PyResult)</span><br><span class="line">        &#123;</span><br><span class="line">            InOutPythonCommand.CommandResult = PyUtil::PyObjectToUEStringRepr(PyResult);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (PyUtil::LogPythonError(&amp;InOutPythonCommand.CommandResult))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FPyWrapperTypeReinstancer::Get().ProcessPending();</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œæ—¶å€™ä¼ å…¥<code>FPythonCommandEx</code>ç»“æ„ä½“ï¼Œå…¶<code>CommandResult</code>å±æ€§ä¼šå­˜å‚¨æ‰§è¡Œçš„ç»“æœã€‚å¦‚æœè¦ä¼ å…¥ç»“æœçš„è¯ï¼Œå¾—é€‰æ‹©<code>EPythonCommandExecutionMode::EvaluateStatement</code>æ‰§è¡Œæ¨¡å¼ã€‚è€Œæœ€ç»ˆä¼ å…¥çš„ç»“æœï¼Œæ˜¯pythonæ•°æ®çš„<code>repr</code>ï¼Œå¹¶éå…¼å®¹æˆUE4çš„æ•°æ®ç»“æ„ã€‚</p>
<p>æ€»ç»“èµ·æ¥å¯ä»¥çœ‹åˆ°ï¼Œç›´æ¥ç”¨<code>PythonScriptPlugin</code>å†™æ¸¸æˆæ˜¯ä¸å¤§ç°å®ï¼Œæœ‰å‡ ä¸ªç‚¹è¿˜è¦è§£å†³ï¼š</p>
<ul>
<li>pythonä¸C++ä¹‹é—´çš„ç›¸äº’é€šä¿¡ï¼Œæ•°æ®ç»“æ„å…¼å®¹ã€‚åªæœ‰<code>string repr</code>æ˜¯è‚¯å®šä¸è¡Œçš„= =</li>
<li>æ¸¸æˆæœ€ç»ˆå‘ˆç°çš„æ€§èƒ½</li>
<li>å¤šå¹³å°å‘å¸ƒ</li>
<li>å¼€å‘æ•ˆç‡ï¼ˆè‡³å°‘è‡ªå·±16Gçƒ‚æœ¬æœ¬å¹²ä¸åŠ¨ï¼Œè¿˜ä¸å¦‚çº¯C++ï¼‰</li>
<li>etc</li>
</ul>
<p>ä¸è¿‡åŸç”Ÿä½œä¸ºé¢å‘UE4ç¼–è¾‘å™¨å·¥ä½œçš„è„šæœ¬æ’ä»¶ï¼Œ<code>PythonScriptPlugin</code>åº”å½“æœ‰å…¶ç”¨æ­¦ä¹‹åœ°ã€‚åé¢æœ‰ç©ºå†æ…¢æ…¢æ¢ç´¢ã€‚</p>
]]></content>
      <categories>
        <category>æ¸¸æˆå¼€å‘</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>UE4</tag>
        <tag>C++</tag>
        <tag>PythonScriptPlugin</tag>
        <tag>UE4ç¼–è¾‘å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Medium Pythonã€‘æœ€ç»ˆè¯ï¼šå¦‚ä½•å½»åº•ç†è§£withå…³é”®å­—çš„ç”¨æ³•ï¼Ÿ</title>
    <url>/2021/11/13/mediumpython/v/</url>
    <content><![CDATA[<p>Medium Pythonç»ˆäºæ¥åˆ°äº†æœ€ç»ˆè¯ã€‚ç»å†äº†å‰å››è¯çš„æ’°å†™ï¼Œç¬”è€…å†³å®šä»¥ç¬¬äº”è¯ä½œä¸ºæ”¶å°¾ï¼Œæ•…è¿™æ®µæ—¶é—´ä¸€ç›´åœ¨æ€è€ƒpythoné‡Œè¿˜æœ‰ä»€ä¹ˆå†…å®¹æ˜¯æˆ‘ä»¬å¸¸è§ä½†å€¼å¾—æ¨æ•²ä¸”æœ‰åº”ç”¨æ„ä¹‰çš„ç‚¹ã€‚ç»å°½è„‘æ±ï¼Œæœ€ç»ˆå¾—åˆ°äº†ä»Šå¤©è¿™ä¸ªä¸»é¢˜ï¼š<code>with</code>å…³é”®å­—ã€‚</p>
<p><code>with</code>å…³é”®å­—çš„å«ä¹‰ï¼Œæ˜¯ç¬”è€…æ¥è§¦pythonä»¥æ¥å¸Œæœ›å½»åº•ææ‡‚çš„é—®é¢˜ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ä¸€å®šä¼šå›°æƒ‘å¤§é‡ç©pythonçš„åŒå­¦çš„é—®é¢˜ä¹‹ä¸€ã€‚ç›¸ä¿¡æ¯ä¸€ä¸ªç©è¿‡pythonçš„åŒå­¦éƒ½æ¥è§¦è¿‡<code>with</code>è¯­æ³•ï¼Œæ¯”å¦‚<code>with open(xxx) as f</code>çš„æ–‡ä»¶æ“ä½œï¼Œæˆ–è€…æ˜¯<code>with lock</code>è¿™æ ·çš„åŠ è§£é”æ“ä½œï¼Œè¿™äº›ä¸œè¥¿æ¯ä¸ªpythonæ•™ç¨‹é‡Œéƒ½æœ‰ã€‚ä½†æ˜¯<code>with</code>è¯­æ³•å…·ä½“è¡¨ç¤ºä»€ä¹ˆï¼Œå…·ä½“èƒ½å¤Ÿç¿»è¯‘æˆæ€æ ·çš„ç®€å•è¯­æ³•ï¼ŒåŸºæœ¬æ²¡å•¥äººèƒ½å¤Ÿè¯´çš„æ¸…æ¥šï¼Œè¯´çš„ç§‘å­¦ã€‚å³ä¾¿åœ¨ç½‘ä¸Šæœ‰è®¸å¤šæ–‡ç« åœ¨å‰–æè¿™ä¸€ç‚¹ï¼Œæåˆ°äº†è®¸å¤šè¯¸å¦‚â€œä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆ<code>context manager</code>ï¼‰â€ã€â€œå¼‚å¸¸å¤„ç†â€ã€â€œ<code>__enter__</code>ã€<code>__exit__</code>â€ä¹‹ç±»çš„è¯æ±‡ï¼Œä½†æ˜¯å°±æ­£å› ä¸ºç¼ºå°‘äº›ç¡¬æ ¸çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æºç åˆ†æï¼Œå¯¼è‡´è®¸å¤šä¸ªæ–‡ç« çš„å†…å®¹éƒ½å¾ˆæ°´ï¼Œçœ‹äº†ä¹Ÿä¸èƒ½å®Œå®Œå…¨å…¨çš„æ˜ç™½ï¼Œå®é™…å†™ä»£ç çš„æ—¶å€™ä¹Ÿè§‰å¾—éš¾ä»¥å½»åº•æŒæ¡ã€‚</p>
<p>å› æ­¤ï¼Œä¸ºäº†æŠŠè¿™ä»¶äº‹æƒ…è¯´æ˜ç™½ï¼Œæœ¬æ–‡å†³å®šç»§ç»­æºç åˆ†æçš„å¥—è·¯ï¼Œè®©å¤§ä¼™å„¿å½»åº•ç†è§£<code>with</code>å…³é”®å­—æ˜¯æ€ä¹ˆä¸€å›äº‹ã€‚è€æ ·å­ï¼Œä¸€åˆ‡çš„å¹æ°´éƒ½æ²¡æœ‰æºç åˆ†ææ¥çš„å®åœ¨ã€‚çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œå…¶å®ƒå…³äº<code>with</code>çš„æ–‡ç« éƒ½å¯ä»¥ç»Ÿç»Ÿæ— è§†äº†ã€‚</p>
<h2 id="withä»£ç æµ‹è¯•"><a href="#withä»£ç æµ‹è¯•" class="headerlink" title="withä»£ç æµ‹è¯•"></a>withä»£ç æµ‹è¯•</h2><p>é¦–å…ˆæˆ‘ä»¬ä¸Šä¸€æ®µæµ‹è¯•ä»£ç ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Lock, Thread</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_seg</span><span class="params">(msg)</span>:</span></span><br><span class="line">    print(<span class="string">'\n'</span>.join([<span class="string">'='</span> * <span class="number">40</span>, str(msg), <span class="string">'='</span> * <span class="number">40</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_fopen</span><span class="params">()</span>:</span></span><br><span class="line">    filename = <span class="string">'1.log'</span></span><br><span class="line">    <span class="keyword">with</span> open(filename) <span class="keyword">as</span> f:</span><br><span class="line">        print(f.read())</span><br><span class="line">        f.close()</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_NUM_THREADS = <span class="number">3</span></span><br><span class="line">_LOCK = Lock()</span><br><span class="line">_CNT = <span class="number">0</span></span><br><span class="line">_MAX_CNT = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_test_thread_lock_task</span><span class="params">()</span>:</span></span><br><span class="line">    thread_name = threading.current_thread().name</span><br><span class="line">    <span class="keyword">global</span> _CNT</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">with</span> _LOCK:</span><br><span class="line">            <span class="keyword">if</span> _CNT &lt; _MAX_CNT:</span><br><span class="line">                _CNT += <span class="number">1</span></span><br><span class="line">                print(<span class="string">'[%s] count: %d'</span> % (thread_name, _CNT))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                print(<span class="string">'[%s] count reached max: %d'</span> % (thread_name, _MAX_CNT))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_thread_lock</span><span class="params">()</span>:</span></span><br><span class="line">    sys.setswitchinterval(<span class="number">0.001</span>)</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(_NUM_THREADS):</span><br><span class="line">        threads.append(Thread(target=_test_thread_lock_task, name=<span class="string">'Thread-%d'</span> % (i + <span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(_NUM_THREADS):</span><br><span class="line">        threads[i].start()</span><br><span class="line">    time.sleep(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(_NUM_THREADS):</span><br><span class="line">        threads[i].join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    test_thread_lock()</span><br><span class="line">    test_fopen()</span><br><span class="line">    _seg(<span class="string">'disassemble test_fopen'</span>)</span><br><span class="line">    dis.dis(test_fopen)</span><br><span class="line">    _seg(<span class="string">'disassemble _test_thread_lock_task'</span>)</span><br><span class="line">    dis.dis(_test_thread_lock_task)</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µæµ‹è¯•ä»£ç åŒ…å«äº†ä¸¤ä¸ªæˆ‘ä»¬å¸¸è§çš„<code>with</code>æ“ä½œï¼šæ–‡ä»¶è¯»å†™å’Œçº¿ç¨‹åŠ é”ã€‚<code>test_fopen</code>æ˜¯è¯»æ–‡ä»¶å†…å®¹ï¼Œ<code>test_thread_lock</code>æ˜¯ä¸åŒçº¿ç¨‹äº¤æ›¿å¢åŠ <code>_CNT</code>çš„æ“ä½œã€‚åœ¨ä»£ç é‡Œé¢ï¼Œå†æ¬¡å‡ºç°äº†æˆ‘ä»¬çš„è€åŒå¿—ï¼šåç¼–è¯‘åº“<code>dis</code>ï¼Œè¿™æ˜¯ä¸ºäº†ç”¨æ¥è§£ææ¯ä¸€ä¸ªå‡½æ•°å…·ä½“åŒ…å«å“ªäº›æ“ä½œç ï¼Œä»¥èƒ½å¤Ÿè®©æˆ‘ä»¬å¿«é€Ÿå®šä½å¯¹åº”æ“ä½œçš„æºä»£ç å®ç°ã€‚æ¯ä¸ªè¢«<code>dis</code>çš„å‡½æ•°ï¼Œåœ¨<code>with</code>çš„æœ€åéƒ½æœ‰<code>pass</code>æ“ä½œï¼Œè¿™æ˜¯ä¸ºäº†æ›´åŠ æ–¹ä¾¿çœ‹åˆ°åœ¨é€€å‡º<code>with</code>èŒƒå›´æ—¶ï¼Œä»£ç å®é™…åšäº†å“ªäº›é™„åŠ æ“ä½œï¼ˆå—¯ï¼Œè¿™äº›<code>pass</code>æ˜¯å®é™…è°ƒè¯•ä¹‹åæ‰åŠ çš„ï¼‰ã€‚</p>
<p>ä»¥æ–‡ä»¶è¯»å†™<code>test_fopen</code>ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹ä¸‹åç¼–è¯‘ä¹‹åçš„ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">13           0 LOAD_CONST               1 (&apos;1.log&apos;)</span><br><span class="line">             2 STORE_FAST               0 (filename)</span><br><span class="line"></span><br><span class="line">14           4 LOAD_GLOBAL              0 (open)</span><br><span class="line">             6 LOAD_FAST                0 (filename)</span><br><span class="line">             8 CALL_FUNCTION            1</span><br><span class="line">            10 SETUP_WITH              36 (to 48)</span><br><span class="line">            12 STORE_FAST               1 (f)</span><br><span class="line"></span><br><span class="line">15          14 LOAD_GLOBAL              1 (print)</span><br><span class="line">            16 LOAD_FAST                1 (f)</span><br><span class="line">            18 LOAD_METHOD              2 (read)</span><br><span class="line">            20 CALL_METHOD              0</span><br><span class="line">            22 CALL_FUNCTION            1</span><br><span class="line">            24 POP_TOP</span><br><span class="line"></span><br><span class="line">16          26 LOAD_FAST                1 (f)</span><br><span class="line">            28 LOAD_METHOD              3 (close)</span><br><span class="line">            30 CALL_METHOD              0</span><br><span class="line">            32 POP_TOP</span><br><span class="line"></span><br><span class="line">18          34 POP_BLOCK</span><br><span class="line">            36 LOAD_CONST               0 (None)</span><br><span class="line">            38 DUP_TOP</span><br><span class="line">            40 DUP_TOP</span><br><span class="line">            42 CALL_FUNCTION            3</span><br><span class="line">            44 POP_TOP</span><br><span class="line">            46 JUMP_FORWARD            16 (to 64)</span><br><span class="line">       &gt;&gt;   48 WITH_EXCEPT_START</span><br><span class="line">            50 POP_JUMP_IF_TRUE        54</span><br><span class="line">            52 RERAISE</span><br><span class="line">       &gt;&gt;   54 POP_TOP</span><br><span class="line">            56 POP_TOP</span><br><span class="line">            58 POP_TOP</span><br><span class="line">            60 POP_EXCEPT</span><br><span class="line">            62 POP_TOP</span><br><span class="line">       &gt;&gt;   64 LOAD_CONST               0 (None)</span><br><span class="line">            66 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨<code>with</code>çš„ä¸€è¡Œï¼ˆ14ï¼‰ï¼Œå¤šäº†<code>SETUP_WITH</code>çš„æ“ä½œæŒ‡ä»¤ï¼Œè€Œåœ¨å³å°†é€€å‡º<code>with</code>ä»£ç å—çš„<code>pass</code>ä¸€è¡Œï¼ˆ18ï¼‰ï¼Œå‡ºç°äº†å¤§é‡æŒ‡ä»¤ï¼Œå¹¶ä¸”æœ‰ç‚¹ç±»ä¼¼äºå¼‚å¸¸å¤„ç†çš„å†…å®¹ã€‚é‚£ä¹ˆè¿™é‡Œåˆ°åº•è•´å«äº†ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ<br>é‚£ä¹ˆé¦–å…ˆï¼Œæˆ‘ä»¬ä»<code>SETUP_WITH</code>â€”â€”<code>with</code>ä»£ç å—çš„åˆå§‹åŒ–æ“ä½œå¼€å§‹çœ‹èµ·ã€‚</p>
<h2 id="withä»£ç å—çš„åˆå§‹åŒ–"><a href="#withä»£ç å—çš„åˆå§‹åŒ–" class="headerlink" title="withä»£ç å—çš„åˆå§‹åŒ–"></a>withä»£ç å—çš„åˆå§‹åŒ–</h2><p>æˆ‘ä»¬åœ¨<code>EvalFrame</code>çš„å¾ªç¯ä¸­ï¼Œå…ˆæ‰¾åˆ°<code>SETUP_WITH</code>å¯¹åº”çš„ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line"></span><br><span class="line">case TARGET(SETUP_WITH): &#123;</span><br><span class="line">    _Py_IDENTIFIER(__enter__);</span><br><span class="line">    _Py_IDENTIFIER(__exit__);</span><br><span class="line">    PyObject *mgr = TOP();</span><br><span class="line">    PyObject *enter = special_lookup(tstate, mgr, &amp;PyId___enter__);</span><br><span class="line">    PyObject *res;</span><br><span class="line">    <span class="keyword">if</span> (enter == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    PyObject *<span class="built_in">exit</span> = special_lookup(tstate, mgr, &amp;PyId___exit__);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">exit</span> == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_DECREF(enter);</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line">    SET_TOP(<span class="built_in">exit</span>);</span><br><span class="line">    Py_DECREF(mgr);</span><br><span class="line">    res = _PyObject_CallNoArg(enter);</span><br><span class="line">    Py_DECREF(enter);</span><br><span class="line">    <span class="keyword">if</span> (res == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    <span class="comment">/* Setup the finally block before pushing the result</span></span><br><span class="line"><span class="comment">               of __enter__ on the stack. */</span></span><br><span class="line">    PyFrame_BlockSetup(f, SETUP_FINALLY, INSTR_OFFSET() + oparg,</span><br><span class="line">                       STACK_LEVEL());</span><br><span class="line"></span><br><span class="line">    PUSH(res);</span><br><span class="line">    DISPATCH();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>SETUP_WITH</code>æ“ä½œçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸€å¼€å§‹ï¼Œå¯»æ‰¾<code>with</code>å¯¹åº”å®ä¾‹çš„<code>__enter__</code>ä»¥åŠ<code>__exit__</code>æ–¹æ³•ï¼ˆç»‘å®šå®ä¾‹çš„ï¼‰ï¼Œå¦‚æœä¸¤è€…æœ‰å…¶ä¸€æ‰¾ä¸åˆ°çš„è¯éƒ½ä¼šç›´æ¥è·³åˆ°<code>error</code>æŠ¥é”™ã€‚</li>
<li>è®¾ç½®<code>__exit__</code>ä¸ºæ ˆé¡¶</li>
<li>ç›´æ¥è°ƒç”¨<code>instance.__enter__()</code></li>
<li>è¿›è¡ŒBlockSetupï¼š<code>PyFrame_BlockSetup(f, SETUP_FINALLY, INSTR_OFFSET() + oparg, STACK_LEVEL())</code></li>
<li>å°†<code>__enter__</code>çš„è¿”å›å€¼<code>PUSH</code>åˆ°æ ˆä¸Š</li>
</ul>
<p>åœ¨<code>test_fopen</code>é‡Œé¢ï¼Œ<code>__enter__</code>å‡½æ•°å¯¹åº”çš„æ˜¯<code>iobase_enter</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// iobase.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">iobase_enter(PyObject *self, PyObject *args)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (iobase_check_closed(self))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    Py_INCREF(self);</span><br><span class="line">    <span class="keyword">return</span> self;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>__enter__</code>å‡½æ•°ä¸­ä¼šæ£€æµ‹è¿™ä¸ª<code>io</code>å¯¹è±¡æ˜¯å¦å·²ç»<code>close</code>æ‰ï¼Œå¦‚æœ<code>close</code>æ‰çš„è¯ä¼šè¿”å›<code>NULL</code>ï¼Œæ­£å¸¸çš„è¯è¿”å›<code>io</code>å¯¹è±¡ã€‚å¦‚æœ<code>__enter__</code>è¿”å›<code>NULL</code>ï¼Œåœ¨<code>SETUP_WITH</code>é‡Œé¢ï¼Œå°±<code>goto</code>åˆ°<code>error</code>é€»è¾‘äº†ã€‚</p>
<p>ä¹‹åæˆ‘ä»¬å†çœ‹ä¸€ä¸‹<code>BlockSetup</code>è¯­å¥ï¼Œå…¶ä¸­ä¼šè°ƒç”¨<code>PyFrame_BlockSetup</code>å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// frameobject.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">PyFrame_BlockSetup(PyFrameObject *f, <span class="keyword">int</span> type, <span class="keyword">int</span> handler, <span class="keyword">int</span> level)</span><br><span class="line">&#123;</span><br><span class="line">    PyTryBlock *b;</span><br><span class="line">    <span class="keyword">if</span> (f-&gt;f_iblock &gt;= CO_MAXBLOCKS) &#123;</span><br><span class="line">        Py_FatalError(<span class="string">"block stack overflow"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    b = &amp;f-&gt;f_blockstack[f-&gt;f_iblock++];</span><br><span class="line">    b-&gt;b_type = type;</span><br><span class="line">    b-&gt;b_level = level;</span><br><span class="line">    b-&gt;b_handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>PyFrame_BlockSetup</code>çš„æœ¬è´¨æ˜¯è®¾ç½®äº†ä¸€ä¸ª<code>PyTryBlock</code>ã€‚å¦‚æœè¿›ä¸€æ­¥æ£€ç´¢<code>PyFrame_BlockSetup</code>çš„å¼•ç”¨çš„è¯ï¼Œä¼šå‘ç°<code>SETUP_FINALLY</code>è¿™ä¸ªæ“ä½œæœ¬è´¨å°±æ˜¯è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ã€‚è€Œ<code>SETUP_FINALLY</code>æœ¬èº«ï¼Œæ¯”å¦‚åœ¨<code>try/except/finally</code>ç»“æ„é‡Œï¼Œä¸è®ºæ˜¯<code>except</code>è¿˜æ˜¯<code>finally</code>ï¼Œéƒ½ç”¨çš„è¿™ä¸ªå­—èŠ‚ç ã€‚</p>
<p><code>PyTryBlock</code>é™¤äº†åœ¨<code>try/except/finally</code>ç»“æ„ä¸­æœ‰ä½¿ç”¨ä¹‹å¤–ï¼Œåœ¨å¾ªç¯<code>loop</code>çš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°ï¼Œå…¶ä¸‰ä¸ªå±æ€§çš„æ„ä¹‰åˆ†åˆ«ä¸ºï¼š</p>
<ul>
<li><code>b_type</code>ï¼šå½“å‰ä»£ç å—<code>block</code>çš„ç±»å‹ï¼ˆ<code>SETUP_FINALLY</code>ï¼‰</li>
<li><code>b_handler</code>ï¼šå¤„ç†é”™è¯¯ä¿¡æ¯çš„<code>handler</code>çš„æŒ‡ä»¤ä½ç½®ï¼ˆ<code>INSTR_OFFSET() + oparg</code>ï¼‰</li>
<li><code>b_level</code>ï¼šæ¯”å¦‚å‡ºç°<code>exception</code>çš„åœºæ™¯ä¸‹ï¼Œè¦å¯¹æ ˆåšæ¢å¤ï¼Œpopä¸€ç³»åˆ—æ ˆä¸Šçš„valueæ—¶ï¼Œç”¨æ¥å‚è€ƒçš„æ ˆé«˜åº¦ï¼ˆ<code>STACK_LEVEL()</code>ï¼‰</li>
</ul>
<p>æˆ‘ä»¬è¿›ä¸€æ­¥çœ‹<code>PyTryBlock</code>è·Ÿ<code>FrameObject</code>çš„å®šä¹‰åŠæ³¨é‡Šï¼Œä¹Ÿå¯ä»¥è¯å®è¿™äº›ä¿¡æ¯ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// frameobject.h</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> b_type;                 <span class="comment">/* what kind of block this is */</span></span><br><span class="line">    <span class="keyword">int</span> b_handler;              <span class="comment">/* where to jump to find handler */</span></span><br><span class="line">    <span class="keyword">int</span> b_level;                <span class="comment">/* value stack level to pop to */</span></span><br><span class="line">&#125; PyTryBlock;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">frame</span> &#123;</span></span><br><span class="line">    PyObject_VAR_HEAD</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">frame</span> *<span class="title">f_back</span>;</span>      <span class="comment">/* previous frame, or NULL */</span></span><br><span class="line">    PyCodeObject *f_code;       <span class="comment">/* code segment */</span></span><br><span class="line">    PyObject *f_builtins;       <span class="comment">/* builtin symbol table (PyDictObject) */</span></span><br><span class="line">    PyObject *f_globals;        <span class="comment">/* global symbol table (PyDictObject) */</span></span><br><span class="line">    PyObject *f_locals;         <span class="comment">/* local symbol table (any mapping) */</span></span><br><span class="line">    PyObject **f_valuestack;    <span class="comment">/* points after the last local */</span></span><br><span class="line">    <span class="comment">/* Next free slot in f_valuestack.  Frame creation sets to f_valuestack.</span></span><br><span class="line"><span class="comment">       Frame evaluation usually NULLs it, but a frame that yields sets it</span></span><br><span class="line"><span class="comment">       to the current stack top. */</span></span><br><span class="line">    PyObject **f_stacktop;</span><br><span class="line">    PyObject *f_trace;          <span class="comment">/* Trace function */</span></span><br><span class="line">    <span class="keyword">char</span> f_trace_lines;         <span class="comment">/* Emit per-line trace events? */</span></span><br><span class="line">    <span class="keyword">char</span> f_trace_opcodes;       <span class="comment">/* Emit per-opcode trace events? */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Borrowed reference to a generator, or NULL */</span></span><br><span class="line">    PyObject *f_gen;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> f_lasti;                <span class="comment">/* Last instruction if called */</span></span><br><span class="line">    <span class="comment">/* Call PyFrame_GetLineNumber() instead of reading this field</span></span><br><span class="line"><span class="comment">       directly.  As of 2.3 f_lineno is only valid when tracing is</span></span><br><span class="line"><span class="comment">       active (i.e. when f_trace is set).  At other times we use</span></span><br><span class="line"><span class="comment">       PyCode_Addr2Line to calculate the line from the current</span></span><br><span class="line"><span class="comment">       bytecode index. */</span></span><br><span class="line">    <span class="keyword">int</span> f_lineno;               <span class="comment">/* Current line number */</span></span><br><span class="line">    <span class="keyword">int</span> f_iblock;               <span class="comment">/* index in f_blockstack */</span></span><br><span class="line">    <span class="keyword">char</span> f_executing;           <span class="comment">/* whether the frame is still executing */</span></span><br><span class="line">    PyTryBlock f_blockstack[CO_MAXBLOCKS]; <span class="comment">/* for try and loop blocks */</span></span><br><span class="line">    PyObject *f_localsplus[<span class="number">1</span>];  <span class="comment">/* locals+stack, dynamically sized */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†<code>PyTryBlock</code>å­˜å‚¨ä¸€ç³»åˆ—æ ˆä¸Šä¿¡æ¯ï¼Œå°±å¯ä»¥ä¿è¯<code>with</code>ç»“æ„ä¸‹çš„ä»£ç å—åœ¨ç»“æŸä¹‹åï¼Œæ•´ä¸ªæ ˆä¸Šçš„çŠ¶æ€èƒ½å¤Ÿæ¢å¤åˆ°<code>with</code>ä¹‹å‰çš„çŠ¶æ€ã€‚æ³¨æ„è¿™ä¸ªæ—¶å€™æ ˆé¡¶ä¸Šæ˜¯<code>__exit__</code>å‡½æ•°ï¼Œè¿™æ ·å¦‚æœä¹‹åæ¢å¤æ ˆï¼Œç„¶åpushä¸€ç³»åˆ—é”™è¯¯ä¿¡æ¯ï¼Œæˆ‘ä»¬çš„<code>__exit__</code>å‡½æ•°å°±èƒ½å¤„ç†å¯¹åº”çš„é”™è¯¯ä¿¡æ¯äº†ã€‚</p>
<p><code>BlockSetup</code>ä¹‹åï¼Œå°±æ˜¯æŠŠ<code>__enter__</code>çš„è¿”å›å€¼æ¨è¿›æ ˆé‡Œï¼Œäº¤ç”±åé¢çš„<code>STORE</code>æŒ‡ä»¤å­˜å‚¨åˆ°<code>locals</code>é‡Œé¢ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨<code>python</code>ä¸­ç¼–å†™çš„<code>with a as b</code>è¿™ç§å½¢å¼ï¼Œæœ€åæˆ‘ä»¬å–åˆ°çš„<code>b</code>ï¼Œå°±æ˜¯<code>__enter__</code>çš„è¿”å›å€¼äº†ã€‚</p>
<h2 id="withä»£ç å—çš„é€€å‡ºä»¥åŠå¼‚å¸¸å¤„ç†"><a href="#withä»£ç å—çš„é€€å‡ºä»¥åŠå¼‚å¸¸å¤„ç†" class="headerlink" title="withä»£ç å—çš„é€€å‡ºä»¥åŠå¼‚å¸¸å¤„ç†"></a>withä»£ç å—çš„é€€å‡ºä»¥åŠå¼‚å¸¸å¤„ç†</h2><p>æ‰§è¡Œå®Œ<code>with</code>ä¸€è¡Œçš„ä»£ç ä¹‹åï¼Œæˆ‘ä»¬å¼€å§‹æ‰§è¡Œ<code>with</code>ä»£ç å—é‡Œé¢çš„å†…å®¹ã€‚<code>with</code>ä»£ç å—æ‰§è¡Œå®Œä¹‹åï¼Œå½“é€€å‡ºä¹‹æ—¶ï¼Œä¹Ÿä¼šæ‰§è¡Œä¸€ç³»åˆ—è¡Œä¸ºã€‚<br>ä»ä¸Šé¢çš„å­—èŠ‚ç ç»“æœä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæœ‰éå¸¸é•¿çš„ä¸€ä¸²ï¼Œè¿™é‡Œä¹Ÿå†åˆ—å‡ºæ¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">18          34 POP_BLOCK</span><br><span class="line">            36 LOAD_CONST               0 (None)</span><br><span class="line">            38 DUP_TOP</span><br><span class="line">            40 DUP_TOP</span><br><span class="line">            42 CALL_FUNCTION            3</span><br><span class="line">            44 POP_TOP</span><br><span class="line">            46 JUMP_FORWARD            16 (to 64)</span><br><span class="line">       &gt;&gt;   48 WITH_EXCEPT_START</span><br><span class="line">            50 POP_JUMP_IF_TRUE        54</span><br><span class="line">            52 RERAISE</span><br><span class="line">       &gt;&gt;   54 POP_TOP</span><br><span class="line">            56 POP_TOP</span><br><span class="line">            58 POP_TOP</span><br><span class="line">            60 POP_EXCEPT</span><br><span class="line">            62 POP_TOP</span><br><span class="line">       &gt;&gt;   64 LOAD_CONST               0 (None)</span><br><span class="line">            66 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>é€€å‡º<code>with</code>çš„ä¸€åˆ»ï¼Œéœ€è¦è€ƒè™‘ä¸¤ç§æƒ…å†µï¼šæœ‰å¼‚å¸¸å’Œæ²¡æœ‰å¼‚å¸¸ã€‚å½“æ²¡æœ‰å¼‚å¸¸çš„æ—¶å€™ä¸‹æ¥ï¼Œä¼šåˆ°å­—èŠ‚ç çš„34~46ã€‚34å…ˆ<code>POP_BLOCK</code>é€€å‡ºä»£ç å—ï¼Œç„¶åä¹‹åæœ‰ä¸€ä¸ª<code>CALL_FUNCTION</code>æ“ä½œï¼šç”±äºå…ˆå‰è®²åˆ°æ ˆé¡¶å·²ç»è¢«è®¾ç½®æˆäº†<code>__exit__</code>å‡½æ•°ï¼Œé‚£ä¹ˆè¿™é‡Œç›¸å½“äºå†é¡¶äº†3ä¸ª<code>None</code>ï¼Œç„¶åæ‰§è¡Œäº†<code>instance.__exit__(None, None, None)</code>ã€‚ä¹‹åå°±èµ°åˆ°64ï¼Œé€€å‡ºè¿™ä¸ª<code>with</code>æµç¨‹äº†ã€‚<br>â€‹</p>
<p>è€Œå½“æœ‰å¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬ä¼šè·³åˆ°48ï¼š<code>WITH_EXCEPT_START</code>ï¼Œè¿™ä¸€å—åœ¨å‰é¢<code>SETUP_WITH</code>çš„å­—èŠ‚ç æœ‰æ ‡æ³¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">10 SETUP_WITH              36 (to 48)</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¯´<code>with</code>ç»“æ„æœ€ç»ˆèµ°åˆ°äº†<code>WITH_EXCEPT_START</code>çš„åˆ†æ”¯ï¼Œé‚£ä¹ˆåœ¨æ­¤ä¹‹å‰ä¸€å®šå·²ç»æ‰§è¡Œäº†æŸäº›æŠ›å¼‚å¸¸ï¼ˆæ¯”å¦‚<code>raise</code>ï¼‰ä¸”æ²¡æœ‰æ•è·çš„æ“ä½œã€‚ä¸ºäº†æ¨¡æ‹Ÿè¿™ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬åœ¨<code>with</code>ä»£ç å—ä¸­åŠ ä¸€è¡Œä»£ç <code>raise Exception</code>ï¼Œæ¥çœ‹ä¸‹æŠ›å¼‚å¸¸æ—¶å€™çš„æƒ…å†µã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> dis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_with_except</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'./1.log'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        print(f.read())</span><br><span class="line">        <span class="keyword">raise</span> KeyError(<span class="string">'haha'</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    dis.dis(test_with_except)</span><br><span class="line">    test_with_except()</span><br></pre></td></tr></table></figure>
<p>ç”¨<code>dis</code>å¾—åˆ°çš„åç¼–è¯‘ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5           0 LOAD_GLOBAL              0 (open)</span><br><span class="line">            2 LOAD_CONST               1 (&apos;./1.log&apos;)</span><br><span class="line">            4 CALL_FUNCTION            1</span><br><span class="line">            6 SETUP_WITH              36 (to 44)</span><br><span class="line">            8 STORE_FAST               0 (f)</span><br><span class="line"></span><br><span class="line">6          10 LOAD_GLOBAL              1 (print)</span><br><span class="line">           12 LOAD_FAST                0 (f)</span><br><span class="line">           14 LOAD_METHOD              2 (read)</span><br><span class="line">           16 CALL_METHOD              0</span><br><span class="line">           18 CALL_FUNCTION            1</span><br><span class="line">           20 POP_TOP</span><br><span class="line"></span><br><span class="line">7          22 LOAD_GLOBAL              3 (KeyError)</span><br><span class="line">           24 LOAD_CONST               2 (&apos;haha&apos;)</span><br><span class="line">           26 CALL_FUNCTION            1</span><br><span class="line">           28 RAISE_VARARGS            1</span><br><span class="line"></span><br><span class="line">8          30 POP_BLOCK</span><br><span class="line">           32 LOAD_CONST               0 (None)</span><br><span class="line">           34 DUP_TOP</span><br><span class="line">           36 DUP_TOP</span><br><span class="line">           38 CALL_FUNCTION            3</span><br><span class="line">           40 POP_TOP</span><br><span class="line">           42 JUMP_FORWARD            16 (to 60)</span><br><span class="line">      &gt;&gt;   44 WITH_EXCEPT_START</span><br><span class="line">           46 POP_JUMP_IF_TRUE        50</span><br><span class="line">           48 RERAISE</span><br><span class="line">      &gt;&gt;   50 POP_TOP</span><br><span class="line">           52 POP_TOP</span><br><span class="line">           54 POP_TOP</span><br><span class="line">           56 POP_EXCEPT</span><br><span class="line">           58 POP_TOP</span><br><span class="line">      &gt;&gt;   60 LOAD_CONST               0 (None)</span><br><span class="line">           62 RETURN_VALUE</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥ä»ä¸­çœ‹åˆ°ï¼Œå½“<code>raise</code>å¼‚å¸¸æ—¶ï¼Œä¼šæ‰§è¡Œ<code>RAISE_VARARGS 1</code>çš„æŒ‡ä»¤ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹<code>RAISE_VARARGS</code>å¯¹åº”çš„ä»£ç ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line"></span><br><span class="line">case TARGET(RAISE_VARARGS): &#123;</span><br><span class="line">    PyObject *cause = <span class="literal">NULL</span>, *exc = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">switch</span> (oparg) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            cause = POP(); <span class="comment">/* cause */</span></span><br><span class="line">            <span class="comment">/* fall through */</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            exc = POP(); <span class="comment">/* exc */</span></span><br><span class="line">            <span class="comment">/* fall through */</span></span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> (do_raise(tstate, exc, cause)) &#123;</span><br><span class="line">                <span class="keyword">goto</span> exception_unwind;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            _PyErr_SetString(tstate, PyExc_SystemError,</span><br><span class="line">                             <span class="string">"bad RAISE_VARARGS oparg"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">goto</span> error;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>RAISE_VARARGS</code>ä¸­ï¼Œ<code>case</code>å¯¹åº”çš„æŒ‡ä»¤ä¼šé¡ºç€å¾€ä¸‹èµ°ï¼Œç›´åˆ°<code>case 0</code>çš„<code>do_raise</code>é€»è¾‘é‡Œé¢ã€‚<code>do_raise</code>æ˜¯æŠ›å¼‚å¸¸çš„å®é™…æ“ä½œï¼Œé‡Œé¢ä¼šæ£€æŸ¥æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ä»¥åŠå‚æ•°æ˜¯å¦åˆç†ï¼Œä¹‹åå†è®¾ç½®å½“å‰çº¿ç¨‹çš„å¼‚å¸¸ç±»å‹<code>type</code>ä»¥åŠå¼‚å¸¸å€¼<code>value</code><br><code>RAISE_VARARGS</code>æœ€åä¼šè·³åˆ°<code>error</code>ä»¥åŠ<code>exception_unwind</code>ä»£ç æ®µï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line"></span><br><span class="line">error:</span><br><span class="line">        <span class="comment">/* Double-check exception status. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> NDEBUG</span></span><br><span class="line">        <span class="keyword">if</span> (!_PyErr_Occurred(tstate)) &#123;</span><br><span class="line">            _PyErr_SetString(tstate, PyExc_SystemError,</span><br><span class="line">                             <span class="string">"error return without exception set"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">        assert(_PyErr_Occurred(tstate));</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Log traceback info. */</span></span><br><span class="line">        PyTraceBack_Here(f);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (tstate-&gt;c_tracefunc != <span class="literal">NULL</span>)</span><br><span class="line">            call_exc_trace(tstate-&gt;c_tracefunc, tstate-&gt;c_traceobj,</span><br><span class="line">                           tstate, f);</span><br><span class="line"></span><br><span class="line">exception_unwind:</span><br><span class="line"></span><br><span class="line"><span class="comment">// æš‚æ—¶å¿½ç•¥ä¸‹é¢</span></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>error</code>æ®µä¸­ï¼Œä¼šæå–å½“å‰<code>frame</code>ä¸Šçš„å¼‚å¸¸<code>traceback</code>ä¿¡æ¯ï¼Œç„¶åå°±ç›´æ¥åˆ°äº†<code>exception_unwind</code>æ®µã€‚<code>exception_unwind</code>æ®µä¼šæ¢å¤æ ˆä¸Šçš„ä¿¡æ¯ï¼Œå…¶é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line"></span><br><span class="line">exception_unwind:</span><br><span class="line">        <span class="comment">/* Unwind stacks if an exception occurred */</span></span><br><span class="line">  <span class="keyword">while</span> (f-&gt;f_iblock &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">/* Pop the current block. */</span></span><br><span class="line">            PyTryBlock *b = &amp;f-&gt;f_blockstack[--f-&gt;f_iblock];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (b-&gt;b_type == EXCEPT_HANDLER) &#123;</span><br><span class="line">                UNWIND_EXCEPT_HANDLER(b);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            UNWIND_BLOCK(b);</span><br><span class="line">            <span class="keyword">if</span> (b-&gt;b_type == SETUP_FINALLY) &#123;</span><br><span class="line">                PyObject *exc, *val, *tb;</span><br><span class="line">                <span class="keyword">int</span> handler = b-&gt;b_handler;</span><br><span class="line">                _PyErr_StackItem *exc_info = tstate-&gt;exc_info;</span><br><span class="line">                <span class="comment">/* Beware, this invalidates all b-&gt;b_* fields */</span></span><br><span class="line">                PyFrame_BlockSetup(f, EXCEPT_HANDLER, <span class="number">-1</span>, STACK_LEVEL());</span><br><span class="line">                PUSH(exc_info-&gt;exc_traceback);</span><br><span class="line">                PUSH(exc_info-&gt;exc_value);</span><br><span class="line">                <span class="keyword">if</span> (exc_info-&gt;exc_type != <span class="literal">NULL</span>) &#123;</span><br><span class="line">                    PUSH(exc_info-&gt;exc_type);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    Py_INCREF(Py_None);</span><br><span class="line">                    PUSH(Py_None);</span><br><span class="line">                &#125;</span><br><span class="line">                _PyErr_Fetch(tstate, &amp;exc, &amp;val, &amp;tb);</span><br><span class="line">                <span class="comment">/* Make the raw exception data</span></span><br><span class="line"><span class="comment">                   available to the handler,</span></span><br><span class="line"><span class="comment">                   so a program can emulate the</span></span><br><span class="line"><span class="comment">                   Python main loop. */</span></span><br><span class="line">                _PyErr_NormalizeException(tstate, &amp;exc, &amp;val, &amp;tb);</span><br><span class="line">                <span class="keyword">if</span> (tb != <span class="literal">NULL</span>)</span><br><span class="line">                    PyException_SetTraceback(val, tb);</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    PyException_SetTraceback(val, Py_None);</span><br><span class="line">                Py_INCREF(exc);</span><br><span class="line">                exc_info-&gt;exc_type = exc;</span><br><span class="line">                Py_INCREF(val);</span><br><span class="line">                exc_info-&gt;exc_value = val;</span><br><span class="line">                exc_info-&gt;exc_traceback = tb;</span><br><span class="line">                <span class="keyword">if</span> (tb == <span class="literal">NULL</span>)</span><br><span class="line">                    tb = Py_None;</span><br><span class="line">                Py_INCREF(tb);</span><br><span class="line">                PUSH(tb);</span><br><span class="line">                PUSH(val);</span><br><span class="line">                PUSH(exc);</span><br><span class="line">                JUMPTO(handler);</span><br><span class="line">                <span class="keyword">if</span> (_Py_TracingPossible(ceval2)) &#123;</span><br><span class="line">                    <span class="keyword">int</span> needs_new_execution_window = (f-&gt;f_lasti &lt; instr_lb || f-&gt;f_lasti &gt;= instr_ub);</span><br><span class="line">                    <span class="keyword">int</span> needs_line_update = (f-&gt;f_lasti == instr_lb || f-&gt;f_lasti &lt; instr_prev);</span><br><span class="line">                    <span class="comment">/* Make sure that we trace line after exception if we are in a new execution</span></span><br><span class="line"><span class="comment">                     * window or we don't need a line update and we are not in the first instruction</span></span><br><span class="line"><span class="comment">                     * of the line. */</span></span><br><span class="line">                    <span class="keyword">if</span> (needs_new_execution_window || (!needs_line_update &amp;&amp; instr_lb &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">                        instr_prev = INT_MAX;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">/* Resume normal execution */</span></span><br><span class="line">                <span class="keyword">goto</span> main_loop;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="comment">/* unwind stack */</span></span><br></pre></td></tr></table></figure>
<p>ç”±äºæˆ‘ä»¬å…ˆå‰æ‰§è¡Œè¿‡äº†<code>PyFrame_BlockSetup(f, SETUP_FINALLY, INSTR_OFFSET() + oparg, STACK_LEVEL())</code>ï¼Œæœ€ç»ˆä»£ç ä¼šè¿è¡Œåˆ°<code>if (b-&gt;b_type == SETUP_FINALLY)</code>å¯¹åº”çš„æ®µè½ã€‚åœ¨å…¶ä¸­è¿›è¡Œäº†ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li><code>PyFrame_BlockSetup(f, EXCEPT_HANDLER, -1, STACK_LEVEL())</code>ï¼šè®¾å®šäº†ä¸€ä¸ªæ–°çš„ä»£ç å—ï¼Œæ ‡è¯†ä¸º<code>EXCEPT_HANDLER</code></li>
<li>å°†å¼‚å¸¸æ ˆï¼ˆä¸²è¿å¼‚å¸¸ä¿¡æ¯çš„é“¾ï¼‰å½“å‰æœ€é¡¶ç«¯çš„å¼‚å¸¸ä¿¡æ¯pushåˆ°æ ˆä¸­</li>
<li>å°†å½“å‰éœ€è¦<code>raise</code>çš„å¼‚å¸¸ä¿¡æ¯pushåˆ°æ ˆä¸­<ul>
<li>è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œåº”å½“å’Œå¼‚å¸¸æ ˆæœ€é¡¶ç«¯çš„ä¸€æ ·</li>
<li>æ³¨æ„<code>_PyErr_Fetch</code>ä¼šå°†è¡¨ç¤ºå½“å‰çº¿ç¨‹è¦æŠ›å‡ºçš„å¼‚å¸¸çš„å‡ ä¸ªå˜é‡ï¼ˆ<code>curexc_type</code>ã€<code>curexc_value</code>ã€<code>curexc_traceback</code>ï¼‰é‡ç½®ä¸º<code>NULL</code>ã€‚è¿™æ ·å¦‚æœå½“å‰å¼‚å¸¸å¾—åˆ°å¦¥å–„å¤„ç†æ‰ï¼Œåé¢æ‰§è¡Œæ—¶å€™å‘ç°çº¿ç¨‹é‡Œé¢è¿™äº›å˜é‡æ˜¯<code>NULL</code>ï¼Œä¹Ÿä¸ä¼šè§¦å‘ç¨‹åºç»ˆæ­¢æ‰“å°å¼‚å¸¸ã€‚</li>
<li><code>_PyErr_Fetch</code>ç›¸åçš„æ“ä½œå«åš<code>_PyErr_Restore</code>ï¼Œç›¸å½“äºè®¾å®šå½“å‰çº¿ç¨‹å·²ç»å‡ºç°å¼‚å¸¸ã€‚</li>
</ul>
</li>
</ul>
<p>è¿›è¡Œäº†è¿™ä¸ªæ“ä½œä¹‹åï¼Œç°åœ¨æ ˆä¸Šåº”å½“è‡³å°‘æœ‰7ä¸ªå…ƒç´ ï¼Œè‡ªé¡¶è€Œä¸‹æ˜¯ï¼š</p>
<ul>
<li>å‰3ä¸ªæ˜¯å½“å‰éœ€è¦<code>raise</code>çš„å¼‚å¸¸ä¿¡æ¯</li>
<li>ä¸­é—´3ä¸ªæ˜¯å¼‚å¸¸æ ˆæœ€é¡¶ç«¯çš„å¼‚å¸¸ä¿¡æ¯</li>
<li>ç„¶åç¬¬7ä¸ªå°±æ˜¯<code>__exit__</code>å‡½æ•°</li>
</ul>
<p>ä¹‹åé€šè¿‡<code>JUMPTO(handler)</code>ã€<code>goto main_loop</code>ï¼Œå°±èµ°åˆ°äº†<code>WITH_EXCEPT_START</code>é€»è¾‘</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line"></span><br><span class="line">case TARGET(WITH_EXCEPT_START): &#123;</span><br><span class="line">    <span class="comment">/* At the top of the stack are 7 values:</span></span><br><span class="line"><span class="comment">       - (TOP, SECOND, THIRD) = exc_info()</span></span><br><span class="line"><span class="comment">       - (FOURTH, FIFTH, SIXTH) = previous exception for EXCEPT_HANDLER</span></span><br><span class="line"><span class="comment">       - SEVENTH: the context.__exit__ bound method</span></span><br><span class="line"><span class="comment">       We call SEVENTH(TOP, SECOND, THIRD).</span></span><br><span class="line"><span class="comment">       Then we push again the TOP exception and the __exit__ return value.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    PyObject *exit_func;</span><br><span class="line">    PyObject *exc, *val, *tb, *res;</span><br><span class="line"></span><br><span class="line">    exc = TOP();</span><br><span class="line">    val = SECOND();</span><br><span class="line">    tb = THIRD();</span><br><span class="line">    assert(exc != Py_None);</span><br><span class="line">    assert(!PyLong_Check(exc));</span><br><span class="line">    exit_func = PEEK(<span class="number">7</span>);</span><br><span class="line">    PyObject *<span class="built_in">stack</span>[<span class="number">4</span>] = &#123;<span class="literal">NULL</span>, exc, val, tb&#125;;</span><br><span class="line">    res = PyObject_Vectorcall(exit_func, <span class="built_in">stack</span> + <span class="number">1</span>,</span><br><span class="line">                              <span class="number">3</span> | PY_VECTORCALL_ARGUMENTS_OFFSET, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (res == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line"></span><br><span class="line">    PUSH(res);</span><br><span class="line">    DISPATCH();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>WITH_EXCEPT_START</code>çš„é€»è¾‘é‡Œï¼Œç›´æ¥è°ƒç”¨äº†<code>instance.__exit__(exc_type, exc_value, exc_traceback)</code>ï¼Œç„¶åæŠŠç»“æœå†æ¨åˆ°æ ˆä¸Šã€‚è¿™æ ·æ ˆä¸Šå°±æœ‰8ä¸ªå…ƒç´ äº†ã€‚<br>ä»¥å…ˆå‰çš„<code>with open(xxx) as f</code>ä¸ºä¾‹ï¼Œå…¶<code>__exit__</code>å‡½æ•°å¯¹åº”äº†<code>iobase_exit</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// iobase.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">iobase_exit(PyObject *self, PyObject *args)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> PyObject_CallMethodNoArgs(self, _PyIO_str_close);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°ä¼šè¿”å›<code>f.close</code>çš„è¿”å›å€¼ï¼Œå…¶å®å°±æ˜¯<code>None</code>ï¼Œå¹¶ä¸”å¯¹å¼‚å¸¸ä¿¡æ¯ï¼ˆåŒ…åœ¨<code>args</code>é‡Œï¼‰æ²¡æœ‰ä»»ä½•å¤„ç†ã€‚<br><code>__exit__</code>å‡½æ•°çš„è¿”å›å€¼æœ‰ä»€ä¹ˆç”¨å¤„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹åˆ°ç´§æ¥ç€çš„æ“ä½œæ˜¯<code>POP_JUMP_IF_TRUE</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line"></span><br><span class="line">case TARGET(POP_JUMP_IF_TRUE): &#123;</span><br><span class="line">    PREDICTED(POP_JUMP_IF_TRUE);</span><br><span class="line">    PyObject *cond = POP();</span><br><span class="line">    <span class="keyword">int</span> err;</span><br><span class="line">    <span class="keyword">if</span> (cond == Py_False) &#123;</span><br><span class="line">        Py_DECREF(cond);</span><br><span class="line">        FAST_DISPATCH();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cond == Py_True) &#123;</span><br><span class="line">        Py_DECREF(cond);</span><br><span class="line">        JUMPTO(oparg);</span><br><span class="line">        FAST_DISPATCH();</span><br><span class="line">    &#125;</span><br><span class="line">    err = PyObject_IsTrue(cond);</span><br><span class="line">    Py_DECREF(cond);</span><br><span class="line">    <span class="keyword">if</span> (err &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        JUMPTO(oparg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (err == <span class="number">0</span>)</span><br><span class="line">        ;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    DISPATCH();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸€å¼€å§‹æˆ‘ä»¬ä¼š<code>POP</code>å‡ºæ¥æ ˆé¡¶çš„å€¼ï¼Œä¹Ÿå°±æ˜¯<code>__exit__</code>çš„è¿”å›å€¼ï¼Œç„¶åå†æ ¹æ®è¿™ä¸ªè¿”å›å€¼èµ°ä¸‹é¢çš„é€»è¾‘ã€‚å¦‚æœè¿™ä¸ªè¿”å›å€¼å¯ä»¥ä½œä¸ºçœŸå€¼ï¼ˆæ¯”å¦‚1ã€æœ‰å†…å®¹çš„<code>list</code>/<code>dict</code>ï¼‰çš„è¯ï¼Œå°±è·³åˆ°æŒ‡å®šçš„æŒ‡ä»¤ï¼Œå¦‚æœä¸æ˜¯çœŸå€¼ï¼ˆæ¯”å¦‚<code>None</code>ã€0ã€ç©ºçš„<code>list</code>/<code>dict</code>ï¼‰çš„è¯ï¼Œå°±æ¥ç»­ä¸‹å»ã€‚å› æ­¤ç»“åˆå…ˆå‰åç¼–è¯‘æ“ä½œç çš„ç»“æœæ¥çœ‹ï¼Œä¼šæ˜¯è¿™æ ·çš„æ•ˆæœï¼š</p>
<ul>
<li>å¦‚æœ<code>__exit__</code>è¿”å›çœŸå€¼ï¼Œåˆ™èµ°åé¢çš„<code>POP</code>ä¸€å †ä¸œè¥¿çš„é€»è¾‘ï¼ˆ50ï¼‰<ul>
<li>ç†è®ºä¸Šï¼Œä¸ä¼šç»“æŸç¨‹åºï¼Œæ‰“ä¸æ‰“å°å¼‚å¸¸çœ‹ä½ åœ¨<code>__exit__</code>é‡Œæœ‰æ²¡æœ‰æ“ä½œäº†</li>
</ul>
</li>
<li>å¦‚æœ<code>__exit__</code>è¿”å›éçœŸå€¼ï¼Œå°±èµ°ä¸‹é¢çš„<code>RERAISE</code>æŒ‡ä»¤ï¼ˆ48ï¼‰ï¼Œç»“æŸç¨‹åºæ‰“å°å¼‚å¸¸</li>
</ul>
<p>é¦–å…ˆæ¥çœ‹<code>RERAISE</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">case TARGET(RERAISE): &#123;</span><br><span class="line">    PyObject *exc = POP();</span><br><span class="line">    PyObject *val = POP();</span><br><span class="line">    PyObject *tb = POP();</span><br><span class="line">    assert(PyExceptionClass_Check(exc));</span><br><span class="line">    _PyErr_Restore(tstate, exc, val, tb);</span><br><span class="line">    <span class="keyword">goto</span> exception_unwind;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>RERAISE</code>å®é™…æŠŠæ ˆé¡¶3ä¸ªå¾…<code>raise</code>çš„å¼‚å¸¸ä¿¡æ¯POPå‡ºæ¥ï¼Œå¹¶é€šè¿‡<code>_PyErr_Restore</code>é‡æ–°è®¾ç½®å½“å‰çº¿ç¨‹å‡ºç°çš„å¼‚å¸¸ä¿¡æ¯ï¼Œç„¶ååˆèµ°åˆ°äº†<code>exception_unwind</code>ã€‚åœ¨<code>exception_unwind</code>çš„éå†ä»£ç å—çš„<code>while</code>å¾ªç¯ä¸­ï¼Œé¦–å…ˆè¯†åˆ«åˆ°å…ˆå‰<code>BlockSetup</code>çš„<code>EXCEPT_HANDLER</code>ä»£ç æ®µï¼Œè°ƒç”¨<code>UNWIND_EXCEPT_HANDLER</code>æŠŠå…ˆå‰<code>PUSH</code>çš„å¼‚å¸¸æ ˆé¡¶çš„å¼‚å¸¸ä¿¡æ¯å…¨ç»™<code>POP</code>äº†ï¼Œä¹‹åç”±äºæ²¡æœ‰ä»»ä½•<code>SETUP_FINALLY</code>çš„æ ‡è®°ï¼Œæ•´ä¸ªéå†ä»£ç å—å°±ç»“æŸäº†ï¼Œæœ€ç»ˆå°±ä¼šæŠŠæ ˆé‡Œå‰©ä¸‹çš„å€¼ï¼ˆ<code>__exit__</code>ï¼‰æ¸…æ‰ï¼Œé€€å‡ºä»£ç æ‰§è¡Œã€‚<br>ä»£ç æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œç”±äºè¡¨ç¤ºå½“å‰çº¿ç¨‹è¦æŠ›å‡ºçš„å¼‚å¸¸çš„å‡ ä¸ªå˜é‡è¢«<code>_PyErr_Restore</code>è®¾ç½®äº†ï¼Œæœ€ç»ˆå°±ä¼šè§¦å‘ç¨‹åºç»ˆæ­¢ï¼Œå¹¶åœ¨<code>stderr</code>æ‰“å°å¼‚å¸¸ä¿¡æ¯ã€‚</p>
<p>ç„¶åæˆ‘ä»¬å†çœ‹<code>__exit__</code>è¿”å›çœŸå€¼æƒ…å†µä¸‹é‚£ä¸€å †<code>POP</code>æ“ä½œï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<ul>
<li>é¦–å…ˆæ˜¯3ä¸ª<code>POP_TOP</code>ï¼ŒæŠŠå¾…<code>raise</code>çš„å¼‚å¸¸ä¿¡æ¯<code>POP</code>æ‰</li>
<li>ç„¶åæ˜¯<code>POP_EXCEPT</code>ï¼Œä¸€æ–¹é¢ä¼šé€€å‡ºå‰é¢è®¾ç½®çš„<code>EXCEPT_HANDLER</code>ä»£ç æ®µï¼Œå¦ä¸€æ–¹é¢ä¼šæŠŠå…ˆå‰<code>PUSH</code>è¿›å»çš„é‚£ä¸ªæ—¶åˆ»çš„å¼‚å¸¸æ ˆé¡¶çš„ä¿¡æ¯ç»™POPå‡ºæ¥ï¼Œå¹¶é‡æ–°è®¾ç½®åˆ°å¼‚å¸¸æ ˆé¡¶ä¸Šï¼Œä¿è¯å¼‚å¸¸ä¿¡æ¯æ¢å¤åŸæ ·</li>
<li>æœ€ååˆæ¥ä¸€ä¸ª<code>POP_TOP</code>ï¼Œå°±æ˜¯æŠŠ<code>__exit__</code>ç»™POPæ‰</li>
</ul>
<p>è¿™æ ·ï¼Œæ•´ä¸ª<code>with</code>ä»£ç å—çš„éƒ¨åˆ†å°±æ‰§è¡Œå®Œæˆäº†ï¼</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><code>with</code>å…³é”®å­—åˆ†æäº†é‚£ä¹ˆä¹…ï¼Œå¤§å®¶ä¹Ÿèƒ½å¤Ÿçœ‹çš„æ˜ç™½ï¼Œ<code>with</code>æœ¬èº«å…¶å®ç›¸å½“äº<code>try/except/finally</code>ç»“æ„çš„å˜ä½“ã€‚å‰–æ<code>with</code>ç»“æ„çš„åŒæ—¶ï¼Œä¹Ÿä¸å¾—ä¸éœ€è¦å‚è€ƒå¼‚å¸¸å¤„ç†ç›¸å…³çš„ä»£ç é€»è¾‘ã€‚è¿™ç¯‡æ–‡ç« ä¸å…¶è¯´åœ¨è®²<code>with</code>ï¼Œä¸å¦‚è¯´åœ¨è®²ä¸€äº›å¼‚å¸¸å¤„ç†ç›¸å…³çš„å®ç°ã€‚<br>â€‹<br>ä»ä¸Šé¢çš„åˆ†æç»“æœï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—å‡ºæ¥ï¼š<br>â€‹<br>æ¯”å¦‚ä¸€ä¸ªpythonä»£ç æ®µï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> a <span class="keyword">as</span> b:</span><br><span class="line">    xxx</span><br><span class="line">    yyy</span><br><span class="line">    zzz</span><br></pre></td></tr></table></figure>
<p>å°±èƒ½å¤Ÿè¢«ç®€å•åœ°ç¿»è¯‘ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = a.__enter__()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    xxx</span><br><span class="line">    yyy</span><br><span class="line">    zzz</span><br><span class="line"><span class="keyword">except</span> exception_type, exception_value, exception_traceback:</span><br><span class="line">    <span class="comment"># handle exception</span></span><br><span class="line">    ok = a.__exit__(exception_type, exception_value, exception_traceback)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> ok:</span><br><span class="line">        <span class="comment"># RERAISE</span></span><br><span class="line">        <span class="keyword">raise</span> (exception_type, exception_value, exception_traceback)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="comment"># normal ending</span></span><br><span class="line">    a.__exit__(<span class="literal">None</span>, <span class="literal">None</span>, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
<p>ç¿»è¯‘æˆè¿™æ ·ï¼Œæ¯ä¸€ä¸ªå­¦è¿‡ä¸€ç‚¹pythonçš„åŒå­¦éƒ½ä¼šå¾ˆæ¸…æ¥šåœ°ç†è§£å§ï¼</p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬è¦è‡ªå·±ç¼–å†™æ”¯æŒwithè¯­æ³•çš„ç¨‹åºï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„pythonä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WithTester</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__flag = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__flag = <span class="number">1</span></span><br><span class="line">        print(<span class="string">'[WithTester] triggered enter: %d'</span> % self.__flag)</span><br><span class="line">        <span class="keyword">return</span> self.__flag + <span class="number">99</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        self.__flag = <span class="number">0</span></span><br><span class="line">        print(<span class="string">'[WithTester] triggered exit: %d\n%s'</span> % (</span><br><span class="line">            self.__flag,</span><br><span class="line">            pprint.pformat(&#123;</span><br><span class="line">                <span class="string">'exc_type'</span>: exc_type,</span><br><span class="line">                <span class="string">'exc_val'</span>: exc_val,</span><br><span class="line">                <span class="string">'exc_tb'</span>: exc_tb</span><br><span class="line">            &#125;)</span><br><span class="line">        ))</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'a true value'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    wt = WithTester()</span><br><span class="line">    <span class="keyword">with</span> wt <span class="keyword">as</span> f:</span><br><span class="line">        print(type(f))</span><br><span class="line">        print(f)</span><br><span class="line">        print(<span class="string">'haha'</span>)</span><br><span class="line">        <span class="keyword">raise</span> KeyError(<span class="string">'hehe'</span>)</span><br></pre></td></tr></table></figure>
<p>æ”¯æŒ<code>with</code>çš„å®ä¾‹ï¼Œéœ€è¦æœ‰åªå¸¦<code>self</code>ä¸€ä¸ªå‚æ•°çš„<code>__enter__</code>å‡½æ•°ï¼Œä»¥åŠå¸¦<code>self</code>ä»¥åŠå¼‚å¸¸ç±»å‹ã€å¼‚å¸¸å€¼ã€å¼‚å¸¸tracebackä¸‰ä¸ªå‚æ•°çš„<code>__exit__</code>å‡½æ•°ã€‚é€šè¿‡ä¸Šé¢â€œä»£ç ç¿»è¯‘â€çš„æ ·å¼ï¼Œä¸éš¾çœ‹å‡ºï¼Œæ‰§è¡Œ<code>main</code>å‡½æ•°ä¼šè¾“å‡ºè¿™æ ·çš„ç»“æœï¼Œä¸å¸¦<code>Exception</code>æŠ¥é”™ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[WithTester] triggered enter: 1</span><br><span class="line">&lt;class &apos;int&apos;&gt;</span><br><span class="line">100</span><br><span class="line">haha</span><br><span class="line">[WithTester] triggered exit: 0</span><br><span class="line">&#123;&apos;exc_tb&apos;: &lt;traceback object at 0x000001D64D6F58C0&gt;,</span><br><span class="line"> &apos;exc_type&apos;: &lt;class &apos;KeyError&apos;&gt;,</span><br><span class="line"> &apos;exc_val&apos;: KeyError(&apos;hehe&apos;)&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°äº†å§ï¼<code>with</code>å…³é”®å­—çš„å«ä¹‰ï¼Œå°±æ˜¯è¿™æ ·ç®€å•ã€‚<br>â€‹</p>
<h2 id="å†™åœ¨æœ€åçš„è¯"><a href="#å†™åœ¨æœ€åçš„è¯" class="headerlink" title="å†™åœ¨æœ€åçš„è¯"></a>å†™åœ¨æœ€åçš„è¯</h2><p>ç›¸ä¿¡é€šè¿‡Medium Pythonç³»åˆ—çš„è®²è§£ï¼Œå¤§å®¶åº”è¯¥ä¼šå¯¹pythonè¯­è¨€æœ¬èº«æœ‰äº†æ–°çš„ç†è§£å§ï¼åœ¨æœ€åï¼Œç¬”è€…ä¹Ÿæ¨èä¸€æœ¬ä¹¦ï¼šã€ŠPythonæºç å‰–æã€‹ï¼Œæ˜¯ä¸€æœ¬è€ä¹¦ï¼ŒåŸºäºpython2.5çš„ï¼Œä½†æ˜¯åœ¨pythonå·²ç»åˆ°3.10çš„ä»Šå¤©ï¼Œè¯»èµ·æ¥ä»ç„¶ä»¤äººå¤§å¼€çœ¼ç•Œã€‚è¿™ä¸ªç³»åˆ—çš„è®¸å¤šåˆ†æï¼Œéƒ½å‚è€ƒäº†è¿™æœ¬ä¹¦çš„åˆ†ææ–¹æ³•ä»¥åŠç»“è®ºã€‚</p>
<p>â€‹<br>çŸ¥è¯†æ˜¯æ°¸è¿œæ²¡æœ‰å°½å¤´çš„ï¼åšè¿™ä¸ªç³»åˆ—çš„è¿‡ç¨‹ä¸­ï¼Œç¬”è€…æ˜¯ä¸€æ¬¡åˆä¸€æ¬¡åœ°åœ¨ä½“éªŒç€è¿™æ ·çš„çœŸç†ã€‚ä»Šåçš„å°†æ¥ï¼Œå¸Œæœ›å¤§å®¶ä¸€èµ·å‹‰åŠ±ï¼<br>â€‹</p>
]]></content>
      <categories>
        <category>Medium Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>with</tag>
        <tag>å­—èŠ‚ç </tag>
        <tag>å¼‚å¸¸å¤„ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Medium Pythonã€‘ç¬¬å››è¯ï¼šç±»å±æ€§å’Œå®ä¾‹å±æ€§æ˜¯æ€æ ·çš„å…³ç³»ï¼Ÿ</title>
    <url>/2021/11/06/mediumpython/iv/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æåˆ°ç¼–ç¨‹ä¸å¾—ä¸æåˆ°é¢å‘å¯¹è±¡ï¼Œä¸€ä¸ªè¯´çƒ‚äº†çš„è¯é¢˜ï¼Œå‡ åå¹´æ¥ä¸€ç›´éƒ½æœ‰äººåœ¨äº‰è®ºé¢å‘å¯¹è±¡çš„å¥½åã€‚ä»å®è§‚è§’åº¦æ¥è¯´ï¼Œä¸€ä¸ªåºå¤§çš„ç¨‹åºæœ¬è´¨æ˜¯å¯¹ä¸šåŠ¡ä¸­å®ä½“é›†åˆä»¥åŠå…¶ä¸­çš„å…³ç³»çš„æ¨¡æ‹Ÿï¼Œè™½ç„¶è§£å†³å®ä½“çš„å…³ç³»é—®é¢˜ï¼Œç”¨é¢å‘è¿‡ç¨‹ã€ç»„åˆç­‰æ–¹å¼å»ä½“ç°æ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†è¦è§£å†³å®ä½“æ¦‚å¿µçš„æŠ½è±¡ï¼Œå°±éœ€è¦é¢å‘å¯¹è±¡çš„ç¼–ç¨‹åŸºç¡€ã€‚å› æ­¤ï¼Œé¢å‘å¯¹è±¡åœ¨ç¼–ç¨‹ä¸­æ˜¯éå¸¸é‡è¦çš„ä¸€éƒ¨åˆ†æ€æƒ³ï¼Œä¸èƒ½éšéšä¾¿ä¾¿è¢«å¦å®šæˆ–è€…å¿½ç•¥ã€‚</p>
<p>â€‹<br>é¢å‘å¯¹è±¡çš„çµé­‚åœ¨äºå¯¹ç±»ï¼ˆclassï¼‰æ¦‚å¿µçš„å‰–æï¼Œè€Œpythonä¸­ä¹Ÿæœ‰å¯¹ç±»çš„æ”¯æŒï¼Œè™½ç„¶ä¸åƒå…¶å®ƒé™æ€è¯­è¨€æœ‰æ¯”è¾ƒå¼ºçš„çº¦æŸï¼Œä½†å¦‚æœæƒ³å°†ä»£ç ç»„ç»‡æˆé¢å‘å¯¹è±¡å¼çš„è¯ä¹Ÿæ˜¯å®Œå…¨æ»¡è¶³çš„ã€‚åœ¨å¹³å¸¸pythonçš„äº¤æµä»¥åŠé¢è¯•çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ¶‰åŠåˆ°è®¸å¤šå…³äºç±»çš„é—®é¢˜ï¼Œæ¯”å¦‚æœ€å¸¸è§çš„å°±æ˜¯é˜è¿°ç±»ä¸å®ä¾‹çš„å…³ç³»ã€‚è¦ç†è§£ç±»ä¸å®ä¾‹çš„å…³ç³»ï¼Œä»ç±»å±æ€§å’Œå®ä¾‹å±æ€§åˆ‡å…¥æ˜¯ä¸ºæœ€ç›´è§‚çš„ã€‚å› æ­¤ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±æ¥è®²è®²pythoné‡Œç±»å±æ€§å’Œå®ä¾‹å±æ€§çš„äºŒä¸‰äº‹ã€‚<br>â€‹</p>
<h2 id="åœ¨ç±»å’Œå®ä¾‹ä¸­è®¿é—®å±æ€§"><a href="#åœ¨ç±»å’Œå®ä¾‹ä¸­è®¿é—®å±æ€§" class="headerlink" title="åœ¨ç±»å’Œå®ä¾‹ä¸­è®¿é—®å±æ€§"></a>åœ¨ç±»å’Œå®ä¾‹ä¸­è®¿é—®å±æ€§</h2><p>é¦–å…ˆä¸Šä¸€æ®µæµ‹è¯•ä»£ç ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_seg</span><span class="params">(msg)</span>:</span></span><br><span class="line">    print(<span class="string">'\n'</span>.join([<span class="string">'='</span> * <span class="number">40</span>, str(msg), <span class="string">'='</span> * <span class="number">40</span> ]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeadmasterDescriptor</span>:</span></span><br><span class="line">    headmaster: str = <span class="string">'Dumbledore'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, obj, cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;HeadmasterDescriptor %s&gt;'</span> % self.headmaster</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, obj, value)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;HeadmasterDescriptor&gt; set new headmaster: %s'</span> % value)</span><br><span class="line">        self.headmaster = str(value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    headmaster = HeadmasterDescriptor()</span><br><span class="line">    students = set()</span><br><span class="line">    teacher = <span class="string">'Snape'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, gender: str, age: int)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> gender <span class="keyword">in</span> [<span class="string">'male'</span>, <span class="string">'female'</span>]</span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line">        <span class="comment"># add to students</span></span><br><span class="line">        self.students.add(name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'&lt;Student&gt; remove student %s'</span> % self.name)</span><br><span class="line">        self.students.remove(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># ============================== test #1 start ==================================</span></span><br><span class="line">    student_1 = Student(name=<span class="string">'conan'</span>, gender=<span class="string">'male'</span>, age=<span class="number">18</span>)</span><br><span class="line">    student_2 = Student(name=<span class="string">'saki'</span>, gender=<span class="string">'female'</span>, age=<span class="number">15</span>)</span><br><span class="line">    print_seg(<span class="string">'test #1 start'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># students</span></span><br><span class="line">    print(<span class="string">'[student-1] students: %s'</span> % student_1.students)</span><br><span class="line">    print(<span class="string">'[student-2] students: %s'</span> % student_2.students)</span><br><span class="line">    print(<span class="string">'[Student] students: %s'</span> % Student.students)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># dir</span></span><br><span class="line">    print(<span class="string">'[student-1] dir: %s'</span> % dir(student_1))</span><br><span class="line">    print(<span class="string">'[Student] dir: %s'</span> % dir(student_1))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># instance attributes</span></span><br><span class="line">    print(<span class="string">'[student-1] name: %s'</span> % student_1.name)</span><br><span class="line">    print(<span class="string">'[student-2] gender: %s'</span> % student_2.gender)</span><br><span class="line">    print(<span class="string">'[student-2] age: %s'</span> % getattr(student_2, <span class="string">'age'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># headmaster</span></span><br><span class="line">    print(<span class="string">'[student-1] old headmaster: %s'</span> % getattr(student_1, <span class="string">'headmaster'</span>))</span><br><span class="line">    print(<span class="string">'[student-2] old headmaster: %s'</span> % student_2.headmaster)</span><br><span class="line">    print(<span class="string">'[Student] new headmaster: %s'</span> % Student.headmaster)</span><br><span class="line">    print(<span class="string">'%s, %s'</span> % (id(student_2.headmaster), id(Student.headmaster)))</span><br><span class="line">    student_1.headmaster = <span class="string">'Alan Tam'</span></span><br><span class="line">    print(<span class="string">'[student-1] new headmaster: %s'</span> % student_1.headmaster)</span><br><span class="line">    print(<span class="string">'[student-2] new headmaster: %s'</span> % student_2.headmaster)</span><br><span class="line">    print(<span class="string">'[Student] new headmaster: %s'</span> % getattr(Student, <span class="string">'headmaster'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># remove student</span></span><br><span class="line">    <span class="keyword">del</span> student_1</span><br><span class="line">    print(<span class="string">'[student-2] students: %s'</span> % student_2.students)</span><br><span class="line">    print(<span class="string">'[Student] students: %s'</span> % Student.students)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># set teacher</span></span><br><span class="line">    print(<span class="string">'[student-2] teacher: %s'</span> % student_2.teacher)</span><br><span class="line">    print(<span class="string">'[Student] teacher: %s'</span> % Student.teacher)</span><br><span class="line">    student_2.teacher = <span class="string">'Jodie'</span></span><br><span class="line">    print(<span class="string">'[student-2] teacher: %s'</span> % student_2.teacher)</span><br><span class="line">    print(<span class="string">'[Student] teacher: %s'</span> % Student.teacher)</span><br><span class="line"></span><br><span class="line">    print_seg(<span class="string">'test#1 end'</span>)</span><br><span class="line">    <span class="comment"># ============================== test #1 end ==================================</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸€æ®µä»£ç æ„é€ äº†è¿™æ ·çš„åœºæ™¯ï¼š</p>
<ul>
<li>é¦–å…ˆåˆ›å»ºä¸¤ä¸ªå­¦ç”Ÿï¼Œåˆ›å»ºçš„è¿‡ç¨‹ä¸­å°†å­¦ç”ŸååŠ å…¥åˆ°é›†åˆ<code>students</code></li>
<li>ç”¨<code>dir</code>æ‰“å°å­¦ç”Ÿå®ä¾‹<code>student-1</code>åŠå­¦ç”Ÿç±»<code>Student</code>çš„å±æ€§&amp;æ–¹æ³•ï¼Œå†é€šè¿‡ç‚¹æˆ–è€…<code>getattr</code>çš„æ–¹å¼è®¿é—®å®ä¾‹å±æ€§</li>
<li>æ›´æ¢<code>headmaster</code></li>
<li>åˆ é™¤<code>student_1</code></li>
<li>æ›´æ¢<code>teacher</code></li>
</ul>
<p>æˆ‘ä»¬çœ‹åˆ°æ‰“å°çš„ç»“æœæ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">========================================</span><br><span class="line">test #1 start</span><br><span class="line">========================================</span><br><span class="line">[student-1] students: &#123;&apos;saki&apos;, &apos;conan&apos;&#125;</span><br><span class="line">[student-2] students: &#123;&apos;saki&apos;, &apos;conan&apos;&#125;</span><br><span class="line">[Student] students: &#123;&apos;saki&apos;, &apos;conan&apos;&#125;</span><br><span class="line">[student-1] dir: [&apos;__class__&apos;, &apos;__del__&apos;, &apos;__delattr__&apos;, &apos;__dict__&apos;, &apos;__dir__&apos;, &apos;__doc__&apos;, &apos;__eq__&apos;, &apos;__format__&apos;, &apos;__ge__&apos;, &apos;__getattribute__&apos;, &apos;__gt__&apos;, &apos;__hash__&apos;, &apos;__init__&apos;, &apos;__init_subclass__&apos;, &apos;__le__&apos;, &apos;__lt__&apos;, &apos;__module__&apos;, &apos;__ne__&apos;, &apos;__new__&apos;, &apos;__reduce__&apos;, &apos;__reduce_ex__&apos;, &apos;__repr__&apos;, &apos;__setattr__&apos;, &apos;__sizeof__&apos;, &apos;__str__&apos;, &apos;__subclasshook__&apos;, &apos;__weakref__&apos;, &apos;age&apos;, &apos;gender&apos;, &apos;headmaster&apos;, &apos;name&apos;, &apos;students&apos;, &apos;teacher&apos;]</span><br><span class="line">[Student] dir: [&apos;__class__&apos;, &apos;__del__&apos;, &apos;__delattr__&apos;, &apos;__dict__&apos;, &apos;__dir__&apos;, &apos;__doc__&apos;, &apos;__eq__&apos;, &apos;__format__&apos;, &apos;__ge__&apos;, &apos;__getattribute__&apos;, &apos;__gt__&apos;, &apos;__hash__&apos;, &apos;__init__&apos;, &apos;__init_subclass__&apos;, &apos;__le__&apos;, &apos;__lt__&apos;, &apos;__module__&apos;, &apos;__ne__&apos;, &apos;__new__&apos;, &apos;__reduce__&apos;, &apos;__reduce_ex__&apos;, &apos;__repr__&apos;, &apos;__setattr__&apos;, &apos;__sizeof__&apos;, &apos;__str__&apos;, &apos;__subclasshook__&apos;, &apos;__weakref__&apos;, &apos;age&apos;, &apos;gender&apos;, &apos;headmaster&apos;, &apos;name&apos;, &apos;students&apos;, &apos;teacher&apos;]</span><br><span class="line">[student-1] name: conan</span><br><span class="line">[student-2] gender: female</span><br><span class="line">[student-2] age: 15</span><br><span class="line">[student-1] old headmaster: &lt;HeadmasterDescriptor Dumbledore&gt;</span><br><span class="line">[student-2] old headmaster: &lt;HeadmasterDescriptor Dumbledore&gt;</span><br><span class="line">[Student] new headmaster: &lt;HeadmasterDescriptor Dumbledore&gt;</span><br><span class="line">1999801558000, 1999801558000</span><br><span class="line">&lt;HeadmasterDescriptor&gt; set new headmaster: Alan Tam</span><br><span class="line">[student-1] new headmaster: &lt;HeadmasterDescriptor Alan Tam&gt;</span><br><span class="line">[student-2] new headmaster: &lt;HeadmasterDescriptor Alan Tam&gt;</span><br><span class="line">[Student] new headmaster: &lt;HeadmasterDescriptor Alan Tam&gt;</span><br><span class="line">&lt;Student&gt; remove student conan</span><br><span class="line">[student-2] students: &#123;&apos;saki&apos;&#125;</span><br><span class="line">[Student] students: &#123;&apos;saki&apos;&#125;</span><br><span class="line">[student-2] teacher: Snape</span><br><span class="line">[Student] teacher: Snape</span><br><span class="line">[student-2] teacher: Jodie</span><br><span class="line">[Student] teacher: Snape</span><br><span class="line">========================================</span><br><span class="line">test#1 end</span><br><span class="line">========================================</span><br><span class="line">&lt;Student&gt; remove student saki</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>åˆ›å»ºä¸¤ä¸ªå­¦ç”Ÿçš„æ—¶å€™ï¼Œ<code>student</code>çš„åå­—è¢«åŠ å…¥åˆ°äº†ç±»å±æ€§<code>students</code>ä¸­ã€‚ä¸è®ºåœ¨ç±»è¿˜æ˜¯è¿˜æ˜¯åœ¨å®ä¾‹å»è®¿é—®<code>students</code>ï¼Œéƒ½èƒ½å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚</li>
<li>é€šè¿‡<code>getattr</code>æˆ–è€…å¸¦ç‚¹çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿæ­£å¸¸è®¿é—®åˆ°ç±»æˆ–è€…å®ä¾‹çš„å±æ€§ã€‚</li>
<li>æ›´æ¢<code>headmaster</code>ã€‚<ul>
<li><code>headmaster</code>æ˜¯ä¸€ä¸ªå¸¦<code>getter</code>è·Ÿ<code>setter</code>çš„<code>descriptor</code></li>
<li>æ‰€è°“<code>descriptor</code>ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªæ”¯æŒæ ¹æ®ä¸åŒè®¿é—®æ–¹å¼åšå‡ºç‰¹å®šè¡Œä¸ºçš„ç‰¹æ®Šå±æ€§ã€‚æˆ‘ä»¬å¯¹<code>headmaster</code>æ‰§è¡Œ<code>get</code>æ“ä½œï¼Œè·å¾—çš„æ˜¯<code>__get__</code>æ–¹æ³•çš„è¿”å›ç»“æœï¼Œå½“å¯¹<code>headmaster</code>èµ‹æ–°å€¼æ—¶ï¼Œå¦‚æœå‘ç°äº†å¸¦<code>__set__</code>çš„<code>descriptor</code>ï¼Œå°±ä¼šè§¦å‘è¿™ä¸ªé€»è¾‘ï¼Œæ”¹å˜ç±»å±æ€§<code>headmaster</code>è¿™ä¸ª<code>descriptor</code>é‡Œé¢ç»´æŠ¤çš„å€¼ã€‚</li>
<li>å¦åˆ™ï¼Œå±æ€§åœ¨ç±»é‡Œæ²¡æœ‰è¢«å®šä¹‰æˆä¸º<code>descriptor</code>ï¼Œä¸”åœ¨å®ä¾‹é‡Œé¢æœ‰å®šä¹‰çš„è¯ï¼Œä¿®æ”¹æ“ä½œåªä¼šæ”¹å®ä¾‹æœ¬èº«ç»´æŠ¤çš„å±æ€§å€¼ï¼Œå°±åƒä¸‹é¢çš„<code>teacher</code>ä¸€æ ·ã€‚</li>
</ul>
</li>
<li>åˆ é™¤<code>student_1</code>ï¼Œè§¦å‘äº†ç±»å®šä¹‰çš„<code>__del__</code>å‡½æ•°ï¼Œå°†<code>student_1</code>çš„åå­—ä»<code>students</code>é‡Œé¢ç§»é™¤</li>
<li><code>student_2</code>æ›´æ¢<code>teacher</code>ï¼Œåªæ›´æ¢äº†è‡ªå·±çš„ï¼Œç±»å±æ€§é‡Œé¢è¿˜æ˜¯é»˜è®¤åŸæ¥çš„ã€‚</li>
</ul>
<p>ä»è¡¨ç°ä¸Šæ¥çœ‹ï¼Œç±»ç›¸å¯¹äºå®ä¾‹æ›´å¤šæ˜¯èµ·åˆ°ä¸€ä¸ªæ¨¡æ¿çš„ä½œç”¨ï¼Œæ¯ä¸€ä¸ªå®ä¾‹ç±»ä¼¼äº<code>fork</code>äº†ä¸€ä¸ªç±»ï¼Œç„¶ååœ¨<code>__init__</code>ä¸­æ·»åŠ å±äºè‡ªå·±çš„å±æ€§ã€‚å¦‚æœä¸€ä¸ªå®ä¾‹è¦è®¿é—®æŸä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§åœ¨<code>__init__</code>é‡Œé¢æ²¡æœ‰å®šä¹‰åˆ°çš„è¯ï¼Œå°±ä¼šä¸‹ä¸€æ­¥ä»è‡ªå·±çš„ç±»é‡Œå¯»æ‰¾å±æ€§ã€‚å¦‚æœè¿˜æ‰¾ä¸åˆ°ï¼Œå°±å¾—ä»çˆ¶ç±»é‡Œæ‰¾äº†ï¼Œå°±åˆ°äº†ï¼ˆå¤šé‡ï¼‰ç»§æ‰¿ç›¸å…³çš„è¯é¢˜ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„å‘ˆç°å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬æ·±å…¥æºç ï¼Œä¸€æ¢ç©¶ç«Ÿã€‚<br>è·å–ç±»çš„å±æ€§ï¼Œå…¶å­—èŠ‚ç ä¸º<code>LOAD_ATTR</code>ã€‚ç»è¿‡ä¸€ç•ªæ·±å…¥ï¼Œæœ€ç»ˆä¼šè½å®åˆ°<code>_PyObject_GenericGetAttrWithDict</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// object.c</span></span><br><span class="line"></span><br><span class="line">PyObject *</span><br><span class="line">_PyObject_GenericGetAttrWithDict(PyObject *obj, PyObject *name,</span><br><span class="line">                                 PyObject *dict, <span class="keyword">int</span> suppress)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/* Make sure the logic of _PyObject_GetMethod is in sync with</span></span><br><span class="line"><span class="comment">       this method.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">       When suppress=1, this function suppress AttributeError.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    PyTypeObject *tp = Py_TYPE(obj);</span><br><span class="line">    PyObject *descr = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject *res = <span class="literal">NULL</span>;</span><br><span class="line">    descrgetfunc f;</span><br><span class="line">    Py_ssize_t dictoffset;</span><br><span class="line">    PyObject **dictptr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyUnicode_Check(name))&#123;</span><br><span class="line">        PyErr_Format(PyExc_TypeError,</span><br><span class="line">                     <span class="string">"attribute name must be string, not '%.200s'"</span>,</span><br><span class="line">                     Py_TYPE(name)-&gt;tp_name);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Py_INCREF(name);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tp-&gt;tp_dict == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (PyType_Ready(tp) &lt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    descr = _PyType_Lookup(tp, name);</span><br><span class="line"></span><br><span class="line">    f = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (descr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_INCREF(descr);</span><br><span class="line">        f = Py_TYPE(descr)-&gt;tp_descr_get;</span><br><span class="line">        <span class="keyword">if</span> (f != <span class="literal">NULL</span> &amp;&amp; PyDescr_IsData(descr)) &#123;</span><br><span class="line">            res = f(descr, obj, (PyObject *)Py_TYPE(obj));</span><br><span class="line">            <span class="keyword">if</span> (res == <span class="literal">NULL</span> &amp;&amp; suppress &amp;&amp;</span><br><span class="line">                    PyErr_ExceptionMatches(PyExc_AttributeError)) &#123;</span><br><span class="line">                PyErr_Clear();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">goto</span> done;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dict == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">/* Inline _PyObject_GetDictPtr */</span></span><br><span class="line">        dictoffset = tp-&gt;tp_dictoffset;</span><br><span class="line">        <span class="keyword">if</span> (dictoffset != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dictoffset &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                Py_ssize_t tsize = Py_SIZE(obj);</span><br><span class="line">                <span class="keyword">if</span> (tsize &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    tsize = -tsize;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">size_t</span> size = _PyObject_VAR_SIZE(tp, tsize);</span><br><span class="line">                _PyObject_ASSERT(obj, size &lt;= PY_SSIZE_T_MAX);</span><br><span class="line"></span><br><span class="line">                dictoffset += (Py_ssize_t)size;</span><br><span class="line">                _PyObject_ASSERT(obj, dictoffset &gt; <span class="number">0</span>);</span><br><span class="line">                _PyObject_ASSERT(obj, dictoffset % SIZEOF_VOID_P == <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            dictptr = (PyObject **) ((<span class="keyword">char</span> *)obj + dictoffset);</span><br><span class="line">            dict = *dictptr;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (dict != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_INCREF(dict);</span><br><span class="line">        res = PyDict_GetItemWithError(dict, name);</span><br><span class="line">        <span class="keyword">if</span> (res != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            Py_INCREF(res);</span><br><span class="line">            Py_DECREF(dict);</span><br><span class="line">            <span class="keyword">goto</span> done;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Py_DECREF(dict);</span><br><span class="line">            <span class="keyword">if</span> (PyErr_Occurred()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (suppress &amp;&amp; PyErr_ExceptionMatches(PyExc_AttributeError)) &#123;</span><br><span class="line">                    PyErr_Clear();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">goto</span> done;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (f != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        res = f(descr, obj, (PyObject *)Py_TYPE(obj));</span><br><span class="line">        <span class="keyword">if</span> (res == <span class="literal">NULL</span> &amp;&amp; suppress &amp;&amp;</span><br><span class="line">                PyErr_ExceptionMatches(PyExc_AttributeError)) &#123;</span><br><span class="line">            PyErr_Clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (descr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        res = descr;</span><br><span class="line">        descr = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">goto</span> done;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!suppress) &#123;</span><br><span class="line">        PyErr_Format(PyExc_AttributeError,</span><br><span class="line">                     <span class="string">"'%.50s' object has no attribute '%U'"</span>,</span><br><span class="line">                     tp-&gt;tp_name, name);</span><br><span class="line">    &#125;</span><br><span class="line">  done:</span><br><span class="line">    Py_XDECREF(descr);</span><br><span class="line">    Py_DECREF(name);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»è¿™æ®µä»£ç ä»¥åŠå…¶ä¸­çš„éƒ¨åˆ†å‡½æ•°è°ƒç”¨å®šä¹‰ï¼Œå¯ä»¥çŸ¥æ‚‰ï¼Œè·å–å±æ€§æœ‰ä»¥ä¸‹çš„ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li>é¦–å…ˆåœ¨ç±»ç»§æ‰¿é“¾æœç´¢æ˜¯å¦æœ‰å¯¹åº”åå­—çš„<code>descriptor</code>ã€‚å¦‚æœæœ‰å¸¦<code>__get__</code>çš„<code>descriptor</code>ï¼Œä¸”åŒ…å«<code>__set__</code>çš„è¯ï¼ˆ<code>PyDescr_IsData</code>çš„åˆ¤æ–­ï¼‰ï¼Œä¼˜å…ˆé€‰æ‹©è¿™ä¸ª<code>descriptor</code></li>
<li>å…¶æ¬¡æ˜¯åœ¨å®ä¾‹çš„<code>__dict__</code>ä¸­å¯»æ‰¾å±æ€§<ul>
<li>æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥åœ¨ä¸Šé¢çš„æµ‹è¯•ä»£ç ä¸­ç»™å®ä¾‹å’Œç±»åŠ ä¸Š<code>__dict__</code>ï¼Œçœ‹ä¸€ä¸‹è¾“å‡ºç»“æœ</li>
</ul>
</li>
<li>ç„¶åå¦‚æœè¿™ä¸ª<code>descriptor</code>æ˜¯æœ‰å¸¦<code>__get__</code>çš„ï¼Œå°±é€šè¿‡è¿™ä¸ª<code>descriptor</code>çš„<code>__get__</code>æ–¹æ³•è·å–è¿™ä¸ªå±æ€§å€¼</li>
<li>æœ€åå¦‚æœæ²¡æœ‰å¸¦<code>__get__</code>çš„ï¼Œé‚£å¯èƒ½è¿™åªæ˜¯ä¸ªæ™®é€šå®ä¾‹ï¼Œä¸ç®—ä¸¥æ ¼æ„ä¹‰ä¸Šçš„<code>descriptor</code>ï¼ˆæ¯”å¦‚<code>Student.teacher</code>ï¼‰ï¼Œå°±è¿”å›å¯¹åº”çš„å€¼å³å¯</li>
</ul>
<p>ç±»çš„ç»§æ‰¿é“¾ï¼Œå¯ä»¥é€šè¿‡ç±»çš„<code>__mro__</code>å±æ€§è·å¾—åˆ°ï¼Œæ˜¯ç”¨C3çº¿æ€§åŒ–ç®—æ³•å¾—åˆ°çš„ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥äº†è§£èƒŒåçš„åŸç†ä»¥åŠä»£ç å®ç°ã€‚pythonçš„å¤šé‡ç»§æ‰¿ï¼Œå°±æ˜¯åŸºäºè¿™ä¸€å¥—æœºåˆ¶ã€‚<br>ç”±å…ˆå‰ä»£ç çš„ä¾‹å­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¸¦<code>__get__</code>ã€<code>__set__</code>çš„<code>descriptor</code>ç¡®å®ä»ç±»ã€å®ä¾‹é‡Œéƒ½è·å¾—çš„æ˜¯åŒä¸€ä¸ª<code>descriptor</code>ã€‚<br>â€‹<br>åŒæ ·ï¼Œå½“è®¾ç½®å±æ€§æ—¶ï¼Œæœ€ç»ˆä¼šè°ƒç”¨<code>_PyObject_GenericSetAttrWithDict</code>ï¼ˆ<code>object.c</code>é‡Œï¼Œè¿™é‡Œä¸æ”¾æºç äº†ï¼Œæœ‰å…´è¶£è‡ªè¡ŒæŸ¥é˜…ï¼‰ã€‚å…¶ä¸­çš„ä¼˜å…ˆçº§æ˜¯ï¼š</p>
<ul>
<li>åœ¨ç»§æ‰¿é“¾æŸ¥æ‰¾å±æ€§æœ‰å¸¦<code>__set__</code>çš„<code>descriptor</code>ï¼Œç›´æ¥è°ƒç”¨<code>descriptor.__set__</code></li>
<li>å¦‚æœæ²¡æœ‰ï¼Œå°±åœ¨å®ä¾‹çš„<code>__dict__</code>é‡Œç›´æ¥è®¾ç½®å±æ€§</li>
</ul>
<p>â€‹</p>
<h2 id="åœ¨ç±»æ–¹æ³•ä¸­è®¿é—®å®ä¾‹å±æ€§"><a href="#åœ¨ç±»æ–¹æ³•ä¸­è®¿é—®å®ä¾‹å±æ€§" class="headerlink" title="åœ¨ç±»æ–¹æ³•ä¸­è®¿é—®å®ä¾‹å±æ€§"></a>åœ¨ç±»æ–¹æ³•ä¸­è®¿é—®å®ä¾‹å±æ€§</h2><p>åœ¨ç±»å®šä¹‰é‡Œé¢æˆ‘ä»¬é€šå¸¸ä¼šåŠ å„å¼å„æ ·çš„å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰ï¼Œåœ¨æ–¹æ³•çš„å®šä¹‰é‡Œé¢ä¹Ÿä¼šå¤§é‡è®¿é—®<code>self</code>çš„å±æ€§ã€‚ä½†æˆ‘ä»¬è¦çŸ¥é“ï¼Œpythonæ˜¯ä¸€ä¸ªåŠ¨æ€è¯­è¨€ï¼Œå‡½æ•°å®šä¹‰é‡Œçš„<code>self</code>ï¼Œå¹¶ä¸ä¸€å®šåªèƒ½æ˜¯è¿™ä¸ªç±»çš„å®ä¾‹ã€‚ä¸ä»…ä¼ è¿›å­ç±»å®ä¾‹æ˜¯å¯ä»¥çš„ï¼Œè€Œæ˜¯åªè¦æ»¡è¶³å‡½æ•°é‡Œé¢å±æ€§çš„è®¿é—®çš„ç±»å®ä¾‹ï¼Œéƒ½è¡Œã€‚</p>
<p>å¦‚æœæœ‰å­¦è¿‡golangï¼Œæˆ–æ˜¯äº†è§£è¿‡ç»„åˆã€ecsçš„æ¦‚å¿µçš„åŒå­¦éƒ½ä¼šä¸€ä¸‹æ˜ç™½â€”â€”å¦‚æœä¸€ä¸ªä¸œè¥¿ï¼Œå®ƒçš®è‚¤æ˜¯åœŸé»„è‰²æ— èŠ±çº¹ï¼Œä½“å‹å¤§ï¼Œè·‘å¾—å¿«ï¼Œç‰™é½¿é”‹åˆ©ï¼Œè‚‰é£Ÿï¼Œæœ‰é‡‘é»„è‰²çš„å¤´å‘ï¼Œé‚£ä¹ˆå®ƒåº”å½“æ˜¯ä¸ªé›„ç‹®ã€‚å°±ç®—ä¸–ç•Œä¸Šå¯èƒ½æœ‰å…¶å®ƒåŠ¨ç‰©ä¹Ÿæ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œä½†å¦‚æœæˆ‘ä»¬åªå…³å¿ƒè¿™äº›ç‰¹å¾å±æ€§ï¼Œé‚£å°±å¯ä»¥ä¸€è§†åŒä»ã€‚ç±»æ–¹æ³•ä¹Ÿæ˜¯è¿™æ ·ï¼Œå¦‚æœæ²¡æœ‰å¯¹å®ä¾‹ç±»å‹çš„çº¦æŸï¼Œåªæœ‰å¯¹å®ä¾‹å±æ€§çš„çº¦æŸï¼Œé‚£ä¹ˆåªè¦æ»¡è¶³è¿™äº›å±æ€§çš„å®ä¾‹ï¼Œéƒ½å¯ä»¥æˆä¸ºç±»æ–¹æ³•çš„å‚æ•°ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lion</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, age: int)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name: str, gender: str, age: int)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> gender <span class="keyword">in</span> [<span class="string">'male'</span>, <span class="string">'female'</span>]</span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">output</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'class: %s, name: %s, age: %s'</span> % (</span><br><span class="line">            self.__class__.__name__,</span><br><span class="line">            self.name,</span><br><span class="line">            self.age</span><br><span class="line">        ))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    s = Student(name=<span class="string">'haha'</span>, gender=<span class="string">'male'</span>, age=<span class="number">18</span>)</span><br><span class="line">    s.output()</span><br><span class="line">    Student.output(s)</span><br><span class="line">    Student.output(Lion(name=<span class="string">'simba'</span>, age=<span class="number">5</span>))</span><br></pre></td></tr></table></figure>
<p>é‡ç‚¹åœ¨äºæœ€åä¸€å¥ï¼š<code>Student.output(Lion(name=&#39;simba&#39;, age=5))</code>â€”â€”è¿™å¥è¯æ˜¯æˆç«‹çš„ï¼Œä»æ‰“å°çš„ç»“æœæ¥çœ‹ä¹Ÿæ²¡æœ‰æŠ¥é”™ã€‚è€ŒåŒæ—¶ï¼Œ<code>s.output()</code>å’Œ<code>Student.output(s)</code>åˆ™å‘ˆç°äº†ç›¸åŒçš„æ•ˆæœã€‚</p>
<p>æˆ‘ä»¬æ‰“å°<code>s.output()</code>ä»¥åŠ<code>Student.output(s)</code>çš„<code>opcode</code>ç»“æœï¼ˆä¸Šé¢ä»£ç ç¨å¾®æ”¹äº†ç‚¹å†…å®¹ï¼Œæ¯”å¦‚å®ä¾‹<code>s</code>å˜æˆäº†<code>student</code>ï¼‰ï¼Œå¯ä»¥å‘ç°å…¶ä¸­çš„ä¸åŒï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">29          26 LOAD_FAST                0 (student)</span><br><span class="line">            28 LOAD_METHOD              2 (output)</span><br><span class="line">            30 CALL_METHOD              0</span><br><span class="line">            32 POP_TOP</span><br><span class="line"></span><br><span class="line">30          34 LOAD_GLOBAL              0 (Student)</span><br><span class="line">            36 LOAD_METHOD              2 (output)</span><br><span class="line">            38 LOAD_FAST                0 (student)</span><br><span class="line">            40 CALL_METHOD              1</span><br><span class="line">            42 POP_TOP</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨<code>student.output</code>æ—¶ï¼Œç›´æ¥<code>LOAD_METHOD</code>åå°±<code>call</code>äº†ï¼›è€Œè°ƒç”¨<code>Student.output</code>æ—¶ï¼Œè¿˜è¦<code>load</code>ä¸€ä¸ªå‚æ•°<code>student</code>ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒå®ä¾‹ï¼‰å†<code>call</code>ã€‚<code>opcode</code>çš„å‘ˆç°å’Œæºä»£ç æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆçœ‹<code>LOAD_METHOD</code>å¯¹åº”çš„å†…å®¹</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">case TARGET(LOAD_METHOD): &#123;</span><br><span class="line">    <span class="comment">/* Designed to work in tandem with CALL_METHOD. */</span></span><br><span class="line">    PyObject *name = GETITEM(names, oparg);</span><br><span class="line">    PyObject *obj = TOP();</span><br><span class="line">    PyObject *meth = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> meth_found = _PyObject_GetMethod(obj, name, &amp;meth);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (meth == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">/* Most likely attribute wasn't found. */</span></span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (meth_found) &#123;</span><br><span class="line">        <span class="comment">/* We can bypass temporary bound method object.</span></span><br><span class="line"><span class="comment">                   meth is unbound method and obj is self.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                   meth | self | arg1 | ... | argN</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">        SET_TOP(meth);</span><br><span class="line">        PUSH(obj);  <span class="comment">// self</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* meth is not an unbound method (but a regular attr, or</span></span><br><span class="line"><span class="comment">                   something was returned by a descriptor protocol).  Set</span></span><br><span class="line"><span class="comment">                   the second element of the stack to NULL, to signal</span></span><br><span class="line"><span class="comment">                   CALL_METHOD that it's not a method call.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                   NULL | meth | arg1 | ... | argN</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">        SET_TOP(<span class="literal">NULL</span>);</span><br><span class="line">        Py_DECREF(obj);</span><br><span class="line">        PUSH(meth);</span><br><span class="line">    &#125;</span><br><span class="line">    DISPATCH();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>LOAD_METHOD</code>ä¼šè½å®åˆ°<code>_PyObject_GetMethod</code>æ–¹æ³•ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method)</span><br><span class="line">&#123;</span><br><span class="line">    PyTypeObject *tp = Py_TYPE(obj);</span><br><span class="line">    PyObject *descr;</span><br><span class="line">    descrgetfunc f = <span class="literal">NULL</span>;</span><br><span class="line">    PyObject **dictptr, *dict;</span><br><span class="line">    PyObject *attr;</span><br><span class="line">    <span class="keyword">int</span> meth_found = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    assert(*method == <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Py_TYPE(obj)-&gt;tp_getattro != PyObject_GenericGetAttr</span><br><span class="line">            || !PyUnicode_Check(name)) &#123;</span><br><span class="line">        *method = PyObject_GetAttr(obj, name);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tp-&gt;tp_dict == <span class="literal">NULL</span> &amp;&amp; PyType_Ready(tp) &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    descr = _PyType_Lookup(tp, name);</span><br><span class="line">    <span class="keyword">if</span> (descr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_INCREF(descr);</span><br><span class="line">        <span class="keyword">if</span> (_PyType_HasFeature(Py_TYPE(descr), Py_TPFLAGS_METHOD_DESCRIPTOR)) &#123;</span><br><span class="line">            meth_found = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            f = Py_TYPE(descr)-&gt;tp_descr_get;</span><br><span class="line">            <span class="keyword">if</span> (f != <span class="literal">NULL</span> &amp;&amp; PyDescr_IsData(descr)) &#123;</span><br><span class="line">                *method = f(descr, obj, (PyObject *)Py_TYPE(obj));</span><br><span class="line">                Py_DECREF(descr);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dictptr = _PyObject_GetDictPtr(obj);</span><br><span class="line">    <span class="keyword">if</span> (dictptr != <span class="literal">NULL</span> &amp;&amp; (dict = *dictptr) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_INCREF(dict);</span><br><span class="line">        attr = PyDict_GetItemWithError(dict, name);</span><br><span class="line">        <span class="keyword">if</span> (attr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            Py_INCREF(attr);</span><br><span class="line">            *method = attr;</span><br><span class="line">            Py_DECREF(dict);</span><br><span class="line">            Py_XDECREF(descr);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            Py_DECREF(dict);</span><br><span class="line">            <span class="keyword">if</span> (PyErr_Occurred()) &#123;</span><br><span class="line">                Py_XDECREF(descr);</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (meth_found) &#123;</span><br><span class="line">        *method = descr;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (f != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        *method = f(descr, obj, (PyObject *)Py_TYPE(obj));</span><br><span class="line">        Py_DECREF(descr);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (descr != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        *method = descr;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyErr_Format(PyExc_AttributeError,</span><br><span class="line">                 <span class="string">"'%.50s' object has no attribute '%U'"</span>,</span><br><span class="line">                 tp-&gt;tp_name, name);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>_PyObject_GetMethod</code>åŒ…å«äº†å¤šå¤„åˆ¤æ–­ã€‚å¯¹äº<code>student.output</code>å’Œ<code>Student.output</code>ï¼Œèµ°åˆ°äº†ä¸åŒçš„åˆ†æ”¯ï¼š</p>
<ul>
<li>å½“è°ƒç”¨<code>student.output</code>æ—¶ï¼Œé€šè¿‡<code>_PyType_Lookup(tp, name)</code>æ‰¾åˆ°äº†<code>output</code>å‡½æ•°ï¼ˆ<code>PyFunction_Type</code>ï¼‰çš„<code>descriptor</code>ï¼Œè°ƒç”¨<code>tp_descr_get</code>å¯¹åº”çš„æ–¹æ³•<ul>
<li>æœ€ç»ˆå›åˆ°<code>LOAD_METHOD</code>ï¼Œèµ°åˆ°<code>if (meth_found)</code>å¯¹åº”çš„åˆ†æ”¯</li>
<li>æ ˆé¡¶æ˜¯<code>student</code>å®ä¾‹ï¼Œç„¶åæ˜¯<code>output</code>æ–¹æ³•</li>
</ul>
</li>
<li>å½“è°ƒç”¨<code>Student.output</code>æ—¶ï¼Œç”±äº<code>Student</code>æ˜¯ä¸€ä¸ª<code>type</code>ï¼Œ<code>Py_TYPE(obj)-&gt;tp_getattro</code>æ˜¯<code>PyType_Type</code>é‡Œé¢çš„<code>type_getattro</code>è€Œä¸æ˜¯<code>PyObject_GenericGetAttr</code>ï¼Œä¸”<code>name</code>åˆæ³•ï¼Œæ‰€ä»¥ç›´æ¥ç”¨<code>PyObject_GetAttr(obj, name)</code>æ‰¾åˆ°äº†å¯¹åº”çš„<code>output</code>æ–¹æ³•<ul>
<li>æœ€ç»ˆå›åˆ°<code>LOAD_METHOD</code>ï¼Œèµ°åˆ°<code>if (meth_found)</code>çš„<code>else</code>å¯¹åº”çš„åˆ†æ”¯</li>
<li>æ ˆé¡¶æ˜¯<code>output</code>æ–¹æ³•ï¼Œç„¶åæ˜¯<code>NULL</code></li>
</ul>
</li>
</ul>
<p><code>LOAD_METHOD</code>ä¹‹åå°±æ˜¯<code>CALL_METHOD</code>ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦è®°å¾—<code>Student.output</code>æ˜¯æœ‰ä¼ å‚çš„ï¼Œå› æ­¤è¿˜ä¼šé¢å¤–<code>push</code>ä¸€ä¸ª<code>student</code>åˆ°æ ˆä¸Šã€‚ä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹<code>CALL_METHOD</code>ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">case TARGET(CALL_METHOD): &#123;</span><br><span class="line">    <span class="comment">/* Designed to work in tamdem with LOAD_METHOD. */</span></span><br><span class="line">    PyObject **sp, *res, *meth;</span><br><span class="line"></span><br><span class="line">    sp = stack_pointer;</span><br><span class="line"></span><br><span class="line">    meth = PEEK(oparg + <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (meth == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="comment">/* `meth` is NULL when LOAD_METHOD thinks that it's not</span></span><br><span class="line"><span class="comment">                   a method call.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                   Stack layout:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                       ... | NULL | callable | arg1 | ... | argN</span></span><br><span class="line"><span class="comment">                                                            ^- TOP()</span></span><br><span class="line"><span class="comment">                                               ^- (-oparg)</span></span><br><span class="line"><span class="comment">                                    ^- (-oparg-1)</span></span><br><span class="line"><span class="comment">                             ^- (-oparg-2)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                   `callable` will be POPed by call_function.</span></span><br><span class="line"><span class="comment">                   NULL will will be POPed manually later.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">        res = call_function(tstate, &amp;sp, oparg, <span class="literal">NULL</span>);</span><br><span class="line">        stack_pointer = sp;</span><br><span class="line">        (<span class="keyword">void</span>)POP(); <span class="comment">/* POP the NULL. */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">/* This is a method call.  Stack layout:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                     ... | method | self | arg1 | ... | argN</span></span><br><span class="line"><span class="comment">                                                        ^- TOP()</span></span><br><span class="line"><span class="comment">                                           ^- (-oparg)</span></span><br><span class="line"><span class="comment">                                    ^- (-oparg-1)</span></span><br><span class="line"><span class="comment">                           ^- (-oparg-2)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">                  `self` and `method` will be POPed by call_function.</span></span><br><span class="line"><span class="comment">                  We'll be passing `oparg + 1` to call_function, to</span></span><br><span class="line"><span class="comment">                  make it accept the `self` as a first argument.</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">        res = call_function(tstate, &amp;sp, oparg + <span class="number">1</span>, <span class="literal">NULL</span>);</span><br><span class="line">        stack_pointer = sp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PUSH(res);</span><br><span class="line">    <span class="keyword">if</span> (res == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">goto</span> error;</span><br><span class="line">    DISPATCH();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>CALL_METHOD</code>ä¸­ä¼šå¯¹æ ˆåšæ£€æŸ¥ã€‚å¦‚æœä¸å‡ºæ„å¤–ï¼Œæ ˆä¸Šè‡ªé¡¶å‘ä¸‹åº”è¯¥æ˜¯è¿™æ ·çš„ç»“æ„ï¼ˆçœ‹ä¸‹<code>LOAD_METHOD</code>è·Ÿ<code>CALL_METHOD</code>çš„æ³¨é‡Šå°±èƒ½æ˜ç™½ï¼‰ï¼š</p>
<ul>
<li><code>student.output</code>ï¼šå‚æ•°N~å‚æ•°1ï¼ˆå‡ä½¿æœ‰çš„è¯ï¼‰ï¼Œ<code>student</code>å®ä¾‹ï¼Œ<code>output</code>æ–¹æ³•</li>
<li><code>Student.output</code>ï¼šå‚æ•°N+1~å‚æ•°2ï¼ˆå‡ä½¿æœ‰çš„è¯ï¼‰ï¼Œ<code>student</code>å®ä¾‹ï¼ˆå‚æ•°1ï¼‰ï¼Œ<code>output</code>æ–¹æ³•ï¼Œ<code>NULL</code></li>
</ul>
<p>æœ€ç»ˆéƒ½ä¼šè°ƒç”¨<code>call_function</code>ï¼Œè€Œä¸¤è€…æœ€ç»ˆçš„æ•ˆæœéƒ½æ˜¯<code>Student.output(student, *args, **kwargs)</code>äº†ã€‚<br>å› æ­¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå‡ä½¿åœ¨<code>Student.output</code>ä¼ å‚å¦å¤–ä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œå¦‚æœè°ƒç”¨åˆ°ç›¸å…³å±æ€§çš„è¯ï¼Œæœ€ç»ˆè¿˜æ˜¯ä¼šåœ¨å¦å¤–ä¸€ä¸ªç±»çš„å®ä¾‹é‡Œé¢è°ƒç”¨<code>PyObject_GenericGetAttrWithDict</code>ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯é€šç”¨çš„ï¼Œå¹¶çº¦æŸä¸ºå•ä¸€çš„ç±»ï¼Œæ‰€ä»¥è¿™æ‰èƒ½è§£é‡Š<code>Student.output(Lion(name=&#39;simba&#39;, age=5))</code>ä¸ºä»€ä¹ˆæˆç«‹ï¼ˆå½“ç„¶ï¼Œç°å®ç¼–ç¨‹ä¸å»ºè®®è¿™æ ·å†™å“¦ï¼æœ‰å…¶å®ƒæ›´å¥½çš„workaroundæå‡ä»£ç å¯è¯»æ€§ï¼‰ã€‚</p>
<h2 id="descriptorå±æ€§çš„åº”ç”¨ï¼šproperty"><a href="#descriptorå±æ€§çš„åº”ç”¨ï¼šproperty" class="headerlink" title="descriptorå±æ€§çš„åº”ç”¨ï¼šproperty"></a>descriptorå±æ€§çš„åº”ç”¨ï¼šproperty</h2><p>åœ¨ä¸Šä¸¤ä¸ªå°èŠ‚å½“ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡æåˆ°äº†<code>descriptor</code>è¿™ä¸ªæ¦‚å¿µã€‚åœ¨å¹³æ—¶çš„pythonç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå¾ˆéš¾æ¥è§¦åˆ°<code>descriptor</code>ï¼Œä½†åœ¨pythonçš„å†…éƒ¨å®ç°ä¸­ï¼Œ<code>descriptor</code>æ˜¯éå¸¸æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥è¯´æ˜¯ä¸€ç§ä¸ºäº†é€‚é…pythonçš„ç±»å±æ€§è®¿é—®æ¥å£è€Œç”Ÿçš„æ•°æ®ç»“æ„ã€‚å› æ­¤ï¼Œæ¯ä¸ªä¿®ä¹ pythonçš„åŒå­¦ï¼Œéƒ½æœ‰å¿…è¦äº†è§£è¿™ä¸ªæ¦‚å¿µã€‚</p>
<p>å°±è¯´ä¸€äº›å¸¸è§çš„å†…ç½®ç±»å±æ€§å®šä¹‰ï¼Œåƒæ˜¯<code>property</code>ã€<code>classmethod</code>ã€<code>staticmethod</code>ï¼Œè™½ç„¶å®ƒä»¬ä»¥è£…é¥°å™¨çš„å½¢å¼å‘ˆç°åœ¨æˆ‘ä»¬çš„ç¨‹åºé‡Œï¼Œä½†å®ƒä»¬çš„å®è´¨ï¼Œéƒ½æ˜¯<code>descriptor</code>ã€‚è¿™ä¹Ÿæ˜¯<code>descriptor</code>çš„é­”åŠ›æ‰€åœ¨ã€‚</p>
<p>æœ¬æ–‡ä»¥<code>property</code>ä¸ºä¾‹è§£æä¸‹<code>descriptor</code>çš„åº”ç”¨ã€‚é¦–å…ˆæ¥çœ‹æµ‹è¯•ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, first_name=<span class="string">''</span>, last_name=<span class="string">''</span>)</span>:</span></span><br><span class="line">        self.__first_name = first_name</span><br><span class="line">        self.__last_name = last_name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">first_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__first_name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @first_name.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">first_name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(<span class="string">'[%s] change first name to %s'</span> % (id(self), value))</span><br><span class="line">        self.__first_name = str(value)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">last_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__last_name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @last_name.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">last_name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(<span class="string">'[%s] change last name to %s'</span> % (id(self), value))</span><br><span class="line">        self.__last_name = str(value)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">full_name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'%s %s'</span> % (self.first_name, self.last_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    h = Human(first_name=<span class="string">'James'</span>, last_name=<span class="string">'Bond'</span>)</span><br><span class="line">    h1 = Human(first_name=<span class="string">'Anatoli'</span>, last_name=<span class="string">'Todorov'</span>)</span><br><span class="line">    print(<span class="string">'first name: %s'</span> % h.first_name)</span><br><span class="line">    print(<span class="string">'last name: %s'</span> % h.last_name)</span><br><span class="line">    print(<span class="string">'full name: %s'</span> % h.full_name)</span><br><span class="line">    h.first_name = <span class="string">'Jiss'</span></span><br><span class="line">    h1.last_name = <span class="string">'Toledo'</span></span><br><span class="line">    print(<span class="string">'[h] first name: %s'</span> % h.first_name)</span><br><span class="line">    print(<span class="string">'[h] full name: %s'</span> % h.full_name)</span><br><span class="line">    print(<span class="string">'[h1] last name: %s'</span> % h1.last_name)</span><br><span class="line">    print(<span class="string">'[h1] full name: %s'</span> % h1.full_name)</span><br><span class="line">    print(<span class="string">'[Human] first name: %s'</span> % Human.first_name)</span><br><span class="line">    print(<span class="string">'[Human] last name: %s'</span> % Human.last_name)</span><br><span class="line">    print(<span class="string">'[Human] full name: %s'</span> % Human.full_name)</span><br><span class="line">    print(<span class="string">'[h] dict: %s'</span> % h.__dict__)</span><br><span class="line">    print(<span class="string">'[h1] dict: %s'</span> % h1.__dict__)</span><br><span class="line">    print(<span class="string">'[Human] dict: %s'</span> % pprint.pformat(Human.__dict__))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">first name: James</span><br><span class="line">last name: Bond</span><br><span class="line">full name: James Bond</span><br><span class="line">[1661162208128] change first name to Jiss</span><br><span class="line">[1661162208032] change last name to Toledo</span><br><span class="line">[h] first name: Jiss</span><br><span class="line">[h] full name: Jiss Bond</span><br><span class="line">[h1] last name: Toledo</span><br><span class="line">[h1] full name: Anatoli Toledo</span><br><span class="line">[Human] first name: &lt;property object at 0x00000182C4FB7B80&gt;</span><br><span class="line">[Human] last name: &lt;property object at 0x00000182C4FB7BD0&gt;</span><br><span class="line">[Human] full name: &lt;property object at 0x00000182C4F9E220&gt;</span><br><span class="line">[h] dict: &#123;&apos;_Human__first_name&apos;: &apos;Jiss&apos;, &apos;_Human__last_name&apos;: &apos;Bond&apos;&#125;</span><br><span class="line">[h1] dict: &#123;&apos;_Human__first_name&apos;: &apos;Anatoli&apos;, &apos;_Human__last_name&apos;: &apos;Toledo&apos;&#125;</span><br><span class="line">[Human] dict: mappingproxy(&#123;&apos;__dict__&apos;: &lt;attribute &apos;__dict__&apos; of &apos;Human&apos; objects&gt;,</span><br><span class="line">              &apos;__doc__&apos;: None,</span><br><span class="line">              &apos;__init__&apos;: &lt;function Human.__init__ at 0x00000182C4FB3B80&gt;,</span><br><span class="line">              &apos;__module__&apos;: &apos;__main__&apos;,</span><br><span class="line">              &apos;__weakref__&apos;: &lt;attribute &apos;__weakref__&apos; of &apos;Human&apos; objects&gt;,</span><br><span class="line">              &apos;first_name&apos;: &lt;property object at 0x00000182C4FB7B80&gt;,</span><br><span class="line">              &apos;full_name&apos;: &lt;property object at 0x00000182C4F9E220&gt;,</span><br><span class="line">              &apos;last_name&apos;: &lt;property object at 0x00000182C4FB7BD0&gt;&#125;)</span><br></pre></td></tr></table></figure>
<p><code>property</code>å¸¸ç”¨äºä¸€äº›ç§æœ‰å˜é‡å®šä¹‰çš„è§„èŒƒåŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä»å®ä¾‹çš„<code>__dict__</code>ä¹Ÿå¯ä»¥é¢å¤–çœ‹åˆ°å¸¦ä¸¤ä¸ªä¸‹åˆ’çº¿å‰ç¼€çš„ç§æœ‰å˜é‡åœ¨ä»£ç ç¼–è¯‘æ—¶å°±å·²ç»è¢«å·å·åœ°æ”¹åäº†ï¼ˆæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥äº†è§£ä¸‹<code>_Py_Mangle</code>ï¼‰ã€‚åœ¨ç±»é‡Œé¢ï¼Œæ‰€æœ‰<code>property</code>ç›¸å…³çš„å±æ€§éƒ½æ˜¯<code>property object</code>ï¼›è€Œåœ¨å®ä¾‹é‡Œé¢ï¼Œæ‰€æœ‰<code>property</code>ç›¸å…³çš„å±æ€§ç›¸äº’ç‹¬ç«‹ï¼Œå¹¶ä¸”æ˜¯ç‰¹å®šçš„å€¼ã€‚</p>
<p><code>property</code>æ˜¯å¦‚ä½•å®ç°è¿™ä¸ªæ•ˆæœçš„ï¼Ÿæˆ‘ä»¬éœ€è¦è¿›å…¥æºç ä¸€æ¢ç©¶ç«Ÿã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬çœ‹<code>property</code>å¯¹åº”çš„ç±»å‹å®šä¹‰<code>PyProperty_Type</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">PyTypeObject PyProperty_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"property"</span>,                                 <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(propertyobject),                     <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_itemsize */</span></span><br><span class="line">    <span class="comment">/* methods */</span></span><br><span class="line">    property_dealloc,                           <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_vectorcall_offset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_async */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_repr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_number */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_hash */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_call */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_str */</span></span><br><span class="line">    PyObject_GenericGetAttr,                    <span class="comment">/* tp_getattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_buffer */</span></span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC |</span><br><span class="line">        Py_TPFLAGS_BASETYPE,                    <span class="comment">/* tp_flags */</span></span><br><span class="line">    property_init__doc__,                       <span class="comment">/* tp_doc */</span></span><br><span class="line">    property_traverse,                          <span class="comment">/* tp_traverse */</span></span><br><span class="line">    (inquiry)property_clear,                    <span class="comment">/* tp_clear */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_richcompare */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_weaklistoffset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iter */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iternext */</span></span><br><span class="line">    property_methods,                           <span class="comment">/* tp_methods */</span></span><br><span class="line">    property_members,                           <span class="comment">/* tp_members */</span></span><br><span class="line">    property_getsetlist,                        <span class="comment">/* tp_getset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_base */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dict */</span></span><br><span class="line">    property_descr_get,                         <span class="comment">/* tp_descr_get */</span></span><br><span class="line">    property_descr_set,                         <span class="comment">/* tp_descr_set */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dictoffset */</span></span><br><span class="line">    property_init,                              <span class="comment">/* tp_init */</span></span><br><span class="line">    PyType_GenericAlloc,                        <span class="comment">/* tp_alloc */</span></span><br><span class="line">    PyType_GenericNew,                          <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_GC_Del,                            <span class="comment">/* tp_free */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»å®šä¹‰ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>PyProperty_Type</code>çš„<code>tp_descr_get</code>å’Œ<code>tp_descr_set</code>éƒ½æœ‰å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œå› æ­¤ä»»ä½•ä¸€ä¸ª<code>property</code>çš„å®ä¾‹éƒ½å¯ä»¥å½“ä½œæ˜¯ä¸€ä¸ª<code>descriptor</code></p>
<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>property</code>å®ä¾‹çš„æ—¶å€™ï¼Œæ˜¯é‡‡ç”¨è£…é¥°å™¨çš„å†™æ³•ï¼Œè§£æå‡ºæ¥å°±æ˜¯ç±»ä¼¼äº<code>property(function)</code>çš„å½¢å¼ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å†çœ‹ä¸€ä¸‹<code>property</code>å®ä¾‹åˆ›å»ºçš„è¿‡ç¨‹ã€‚</p>
<p><code>property</code>æœ¬èº«æ˜¯ä¸€ä¸ª<code>type object</code>ï¼Œåˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§<code>property(function)</code>çš„å†™æ³•æ¥è§£æï¼Œè¿™å°±ç›¸å½“äºæŠŠ<code>property</code>å½“æˆä¸€ä¸ªå‡½æ•°æ¥çœ‹å¾…ã€‚æˆ‘ä»¬å¯ä»¥é¦–å…ˆçœ‹ä¸‹<code>type object</code>çš„ç±»<code>PyType_Type</code>çš„å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">PyTypeObject PyType_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"type"</span>,                                     <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(PyHeapTypeObject),                   <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(PyMemberDef),                        <span class="comment">/* tp_itemsize */</span></span><br><span class="line">    (destructor)type_dealloc,                   <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    offsetof(PyTypeObject, tp_vectorcall),      <span class="comment">/* tp_vectorcall_offset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_async */</span></span><br><span class="line">    (reprfunc)type_repr,                        <span class="comment">/* tp_repr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_number */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_hash */</span></span><br><span class="line">    (ternaryfunc)type_call,                     <span class="comment">/* tp_call */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_str */</span></span><br><span class="line">    (getattrofunc)type_getattro,                <span class="comment">/* tp_getattro */</span></span><br><span class="line">    (setattrofunc)type_setattro,                <span class="comment">/* tp_setattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_buffer */</span></span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC |</span><br><span class="line">    Py_TPFLAGS_BASETYPE | Py_TPFLAGS_TYPE_SUBCLASS |</span><br><span class="line">    Py_TPFLAGS_HAVE_VECTORCALL,                 <span class="comment">/* tp_flags */</span></span><br><span class="line">    type_doc,                                   <span class="comment">/* tp_doc */</span></span><br><span class="line">    (traverseproc)type_traverse,                <span class="comment">/* tp_traverse */</span></span><br><span class="line">    (inquiry)type_clear,                        <span class="comment">/* tp_clear */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_richcompare */</span></span><br><span class="line">    offsetof(PyTypeObject, tp_weaklist),        <span class="comment">/* tp_weaklistoffset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iter */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iternext */</span></span><br><span class="line">    type_methods,                               <span class="comment">/* tp_methods */</span></span><br><span class="line">    type_members,                               <span class="comment">/* tp_members */</span></span><br><span class="line">    type_getsets,                               <span class="comment">/* tp_getset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_base */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dict */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_get */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_set */</span></span><br><span class="line">    offsetof(PyTypeObject, tp_dict),            <span class="comment">/* tp_dictoffset */</span></span><br><span class="line">    type_init,                                  <span class="comment">/* tp_init */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_alloc */</span></span><br><span class="line">    type_new,                                   <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_GC_Del,                            <span class="comment">/* tp_free */</span></span><br><span class="line">    (inquiry)type_is_gc,                        <span class="comment">/* tp_is_gc */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ˜“çŸ¥ï¼Œå¦‚æœæŠŠ<code>type object</code>å½“ä½œå‡½æ•°ï¼ˆä¸¥æ ¼æ„ä¹‰ä¸Šè®²ï¼Œå«åšå¯è°ƒç”¨çš„ï¼Œ<code>callable</code>ï¼‰çœ‹å¾…ï¼Œä¼šè§¦å‘<code>tp_call</code>å¯¹åº”çš„<code>type_call</code>å‡½æ•°ã€‚<code>type_call</code>å‡½æ•°è¿™é‡Œå°±ä¸åˆ—å‡ºæ¥äº†ï¼Œå› ä¸ºåªæœ‰ä¸¤æ­¥æ˜¯æœ€ä¸ºå…³é”®çš„ï¼š</p>
<ul>
<li><code>obj = type-&gt;tp_new(type, args, kwds)</code></li>
<li><code>res = type-&gt;tp_init(obj, args, kwds)</code></li>
</ul>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¦åˆ›å»º<code>property</code>å®ä¾‹ï¼Œéœ€è¦æ‰¾åˆ°<code>property</code>çš„<code>tp_new</code>å¯¹åº”çš„å‡½æ•°å…ˆå¼„ä¸€ä¸ªç©ºçš„å®ä¾‹ï¼Œç„¶åå†æ‰¾<code>tp_init</code>å¯¹åº”çš„å‡½æ•°åˆå§‹åŒ–å®ä¾‹ã€‚ç”±<code>PyProperty_Type</code>çš„å®šä¹‰å¯çŸ¥ï¼Œ<code>property</code>çš„<code>tp_new</code>å¯¹åº”çš„æ˜¯<code>PyType_GenericNew</code>ï¼Œç®€å•åˆ†é…äº†å†…å­˜ç©ºé—´ï¼›è€Œ<code>tp_init</code>åˆ™å¯¹åº”<code>property_init</code>ï¼Œ<code>property_init</code>å®è´¨çš„å®ç°æ˜¯<code>property_init_impl</code>ï¼Œå› æ­¤æˆ‘ä»¬ç›´æ¥çœ‹<code>property_init_impl</code>çš„å®šä¹‰ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">property_init_impl(propertyobject *self, PyObject *fget, PyObject *fset,</span><br><span class="line">                   PyObject *fdel, PyObject *doc)</span><br><span class="line"><span class="comment">/*[clinic end generated code: output=01a960742b692b57 input=dfb5dbbffc6932d5]*/</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (fget == Py_None)</span><br><span class="line">        fget = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (fset == Py_None)</span><br><span class="line">        fset = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (fdel == Py_None)</span><br><span class="line">        fdel = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    Py_XINCREF(fget);</span><br><span class="line">    Py_XINCREF(fset);</span><br><span class="line">    Py_XINCREF(fdel);</span><br><span class="line">    Py_XINCREF(doc);</span><br><span class="line"></span><br><span class="line">    Py_XSETREF(self-&gt;prop_get, fget);</span><br><span class="line">    Py_XSETREF(self-&gt;prop_set, fset);</span><br><span class="line">    Py_XSETREF(self-&gt;prop_del, fdel);</span><br><span class="line">    Py_XSETREF(self-&gt;prop_doc, doc);</span><br><span class="line">    self-&gt;getter_doc = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* if no docstring given and the getter has one, use that one */</span></span><br><span class="line">    <span class="keyword">if</span> ((doc == <span class="literal">NULL</span> || doc == Py_None) &amp;&amp; fget != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        _Py_IDENTIFIER(__doc__);</span><br><span class="line">        PyObject *get_doc;</span><br><span class="line">        <span class="keyword">int</span> rc = _PyObject_LookupAttrId(fget, &amp;PyId___doc__, &amp;get_doc);</span><br><span class="line">        <span class="keyword">if</span> (rc &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> rc;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Py_IS_TYPE(self, &amp;PyProperty_Type)) &#123;</span><br><span class="line">            Py_XSETREF(self-&gt;prop_doc, get_doc);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* If this is a property subclass, put __doc__</span></span><br><span class="line"><span class="comment">               in dict of the subclass instance instead,</span></span><br><span class="line"><span class="comment">               otherwise it gets shadowed by __doc__ in the</span></span><br><span class="line"><span class="comment">               class's dict. */</span></span><br><span class="line">            <span class="keyword">int</span> err = _PyObject_SetAttrId((PyObject *)self, &amp;PyId___doc__, get_doc);</span><br><span class="line">            Py_DECREF(get_doc);</span><br><span class="line">            <span class="keyword">if</span> (err &lt; <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        self-&gt;getter_doc = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>property</code>å®ä¾‹åˆå§‹åŒ–ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯<code>fget</code>ã€<code>fset</code>ã€<code>fdel</code>ã€<code>doc</code>ï¼Œä»<code>property_init_impl</code>ä¸­æˆ‘ä»¬æ˜“çŸ¥ï¼Œå››ä¸ªå‚æ•°æœ€ç»ˆä¼šæ”¾åˆ°<code>prop_get</code>ã€<code>prop_set</code>ã€<code>prop_del</code>ã€<code>prop_doc</code>ä¸­ã€‚ä¸€èˆ¬æˆ‘ä»¬ç”¨<code>property</code>è£…é¥°å™¨åŒ…è£¹çš„å‡½æ•°ï¼Œå°±å¯¹åº”äº†<code>fget</code>ã€‚<br>â€‹<br>åœ¨å…ˆå‰çš„â€œè®¿é—®å±æ€§â€ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°å¦‚æœä¸€ä¸ªç±»å®ä¾‹è®¿é—®å±æ€§ï¼Œç¬¬ä¸€ä¼˜å…ˆçº§æ˜¯åˆ¤æ–­ç»§æ‰¿é“¾ä¸Šæ˜¯ä¸æ˜¯æœ‰åå­—å¯¹åº”äº†ä¸€ä¸ª<code>data-descriptor</code>ï¼ˆåŒæ—¶åŒ…å«<code>__get__</code>ä¸<code>__set__</code>ï¼‰ã€‚ä»ä¸Šé¢çš„ä¾‹å­æˆ‘ä»¬æœ€ç»ˆä¼šå‘ç°åœ¨ç±»é‡Œé¢å®šä¹‰äº†<code>first_name</code>ä¹‹ç±»çš„<code>property object</code>ï¼Œè€Œ<code>property object</code>çš„ç±»å‹<code>PyProperty_Type</code>å°±æ˜¯åŒæ—¶æ‹¥æœ‰<code>tp_descr_get</code>è·Ÿ<code>tp_descr_set</code>ï¼Œå¯ä»¥å½“ä½œä¸€ä¸ª<code>data-descriptor</code>ï¼Œå› æ­¤åœ¨<code>_PyObject_GenericGetAttrWithDict</code>ä¸­ï¼Œä¼šç›´æ¥èµ°åˆ°<code>f(descr, obj, (PyObject *)Py_TYPE(obj))</code>è¿™ä¸€ä¸ªé€»è¾‘æ¥è¿”å›ç»“æœã€‚è½¬æ¢ä¸€ä¸‹å‡½æ•°é‡Œé¢æ¶‰åŠçš„å˜é‡åï¼Œå°±å˜æˆäº†<code>tp_descr_get(propertyå®ä¾‹, ç±»å®ä¾‹, ç±»)</code></p>
<p><code>property</code>çš„<code>tp_descr_get</code>å¯¹åº”çš„æ˜¯<code>property_descr_get</code>ï¼Œæˆ‘ä»¬çœ‹ä¸‹å…¶ä¸­çš„å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">property_descr_get(PyObject *self, PyObject *obj, PyObject *type)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj == <span class="literal">NULL</span> || obj == Py_None) &#123;</span><br><span class="line">        Py_INCREF(self);</span><br><span class="line">        <span class="keyword">return</span> self;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    propertyobject *gs = (propertyobject *)self;</span><br><span class="line">    <span class="keyword">if</span> (gs-&gt;prop_get == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_AttributeError, <span class="string">"unreadable attribute"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> PyObject_CallOneArg(gs-&gt;prop_get, obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œ<code>getter</code>çš„é€»è¾‘æœ€ç»ˆä¼šè°ƒç”¨<code>property object</code>çš„<code>prop_get</code>ï¼Œä¼ å‚<code>obj</code>ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ª<code>prop_get</code>å°±æ˜¯æˆ‘ä»¬ç”¨<code>property</code>åŒ…è£¹çš„<code>fget</code>å‡½æ•°ï¼Œè€Œ<code>obj</code>å°±æ˜¯ç±»å®ä¾‹ï¼Œæˆ‘ä»¬çš„<code>fget</code>å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯<code>self</code>ã€‚é‚£ä¹ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬å°±ç›´æ¥é€šè¿‡<code>fget</code>è·å–äº†ç±»å®ä¾‹å¯¹åº”çš„å±æ€§ã€‚<br>â€‹<br>è‡³æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼Œåœ¨ä¸Šé¢çš„pythonæµ‹è¯•ä»£ç ä¸­ï¼Œ<code>h.first_name</code>å’Œ<code>Human.first_name.fget(h)</code>ï¼Œä¸¤è€…å°±æ˜¯ç›¸åŒçš„è¡¨è¾¾ã€‚å†å¼•ç”³ä¸€ä¸‹ï¼Œå‡ä½¿æœ‰ä¸ªç±»çš„å®ä¾‹å«åš<code>fakehuman</code>ï¼Œå®ƒåŒ…å«ä¸€ä¸ªå±æ€§å«åš<code>_Human__first_name</code>ï¼ˆè®°å¾—ä¸Šé¢è¯´çš„ï¼ŒåŒä¸‹åˆ’çº¿çš„å˜é‡ä¼šè¢«æ”¹åï¼‰ï¼Œé‚£ä¹ˆ<code>Human.first_name.fget(fakehuman)</code>è¿™ä¸ªè¡¨è¾¾å¼ä¹Ÿæ˜¯é€šè¿‡çš„ï¼</p>
<p><code>property</code>çš„<code>setter</code>ä¹Ÿæ˜¯ä¸€æ ·çš„å¥—è·¯ï¼Œæœ€ç»ˆä¼šè½å®åˆ°<code>property_descr_set</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">property_descr_set(PyObject *self, PyObject *obj, PyObject *value)</span><br><span class="line">&#123;</span><br><span class="line">    propertyobject *gs = (propertyobject *)self;</span><br><span class="line">    PyObject *func, *res;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">NULL</span>)</span><br><span class="line">        func = gs-&gt;prop_del;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        func = gs-&gt;prop_set;</span><br><span class="line">    <span class="keyword">if</span> (func == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_AttributeError,</span><br><span class="line">                        value == <span class="literal">NULL</span> ?</span><br><span class="line">                        <span class="string">"can't delete attribute"</span> :</span><br><span class="line">                <span class="string">"can't set attribute"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (value == <span class="literal">NULL</span>)</span><br><span class="line">        res = PyObject_CallOneArg(func, obj);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        res = PyObject_CallFunctionObjArgs(func, obj, value, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">if</span> (res == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    Py_DECREF(res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»<code>property_descr_set</code>é‡Œå¯ä»¥çœ‹å‡ºï¼Œå½“<code>value</code>ä¸º<code>NULL</code>ï¼ˆä¸æ˜¯ä¼ è¿›pythonçš„<code>None</code>å“ˆï¼‰ï¼Œå°±ä¼šè°ƒç”¨<code>prop_del</code>å¯¹åº”çš„<code>deleter</code>ï¼ˆåˆ é™¤å±æ€§ç”¨<code>del</code>ï¼Œå¯¹åº”<code>opcode</code>ä¸º<code>DELETE_ATTR</code>ï¼Œå®è´¨å°±æ˜¯è®¾ç½®<code>attr</code>ä¸º<code>NULL</code>ï¼‰ï¼›å½“<code>value</code>ä¸ºé<code>null</code>çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨<code>prop_set</code>å¯¹åº”çš„<code>setter</code>ã€‚è¿™æ ·ï¼Œä¸€ä¸ªå±æ€§<code>setter</code>è·Ÿ<code>deleter</code>çš„çš„éœ€æ±‚ä¹Ÿå°±è½»è€Œæ˜“ä¸¾åœ°è¢«æ»¡è¶³äº†ã€‚<br>â€‹</p>
<p>ä»<code>property</code>çš„å®ç°å¯ä»¥çœ‹åˆ°ï¼Œ<code>descriptor</code>ç›¸å½“äºåœ¨å±æ€§æœ¬èº«å’Œç”¨æˆ·è®¿é—®ä¹‹é—´èµ·åˆ°äº†ä¸€å±‚æ¡¥æ¢çš„ä½œç”¨ï¼Œæ˜¯éå¸¸çµæ´»å·§å¦™çš„æ„æ€ã€‚è€Œ<code>classmethod</code>ã€<code>staticmethod</code>ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯<code>non-data-descriptor</code>ï¼ˆä¸å¸¦<code>setter</code>ï¼‰ï¼Œæœ‰å…´è¶£çš„åŒå­¦ä¹Ÿå¯ä»¥æ·±å…¥ç ”ç©¶ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡é€šè¿‡ç±»/å®ä¾‹å±æ€§ä¹‹é—´çš„è”ç³»ï¼Œå¯¹pythonçš„ç±»å’Œå®ä¾‹ä¹‹é—´çš„å…³ç³»åšäº†å‰–æï¼Œå¹¶å¼•ç”³äº†pythonå†…éƒ¨å®ç°ä¸­é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µâ€”â€”<code>descriptor</code>ã€‚åœ¨ä¸‰ä¸ªæœˆå‰ï¼Œç¬”è€…ç”šè‡³æ ¹æœ¬ä¸çŸ¥é“<code>descriptor</code>æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œè€Œç»è¿‡äº†è¿™ä¸€æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œä¹Ÿå¯¹pythonç±»/å®ä¾‹å±æ€§å®ç°æœºåˆ¶æœ‰äº†å…¨æ–°çš„ç†è§£ã€‚å¸Œæœ›å¤§å®¶é˜…è¯»æ­¤æ–‡ï¼Œä¹Ÿèƒ½æœ‰æ‰€æ”¶è·ã€‚</p>
]]></content>
      <categories>
        <category>Medium Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>descriptor</tag>
        <tag>ç±»</tag>
        <tag>property</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Medium Pythonã€‘ç¬¬ä¸‰è¯ï¼špythonå¤šçº¿ç¨‹ä¸ºä»€ä¹ˆä¸èƒ½å¹¶è¡Œï¼Ÿ</title>
    <url>/2021/10/30/mediumpython/iii/</url>
    <content><![CDATA[<p>pythonçš„å¤šçº¿ç¨‹ï¼Œè¿™æ˜¯ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜äº†ï¼Œç½‘ä¸Šèµ„æ–™ä¹Ÿä¸€å¤§æŠŠã€‚pythoné»˜è®¤çš„<code>threading</code>æ¨¡å—å¯¹å¤šçº¿ç¨‹æä¾›äº†æ”¯æŒï¼Œä½†å®é™…å¤šä¸ª<code>threading.Thread</code>å®ä¾‹æ— æ³•å¹¶è¡Œè¿è¡Œï¼ˆä¸æ˜¯æ— æ³•å¹¶å‘å“¦ï¼ï¼‰ã€‚<br>â€‹<br>ä¸€å¥è¯æ¦‚æ‹¬ç­”æ¡ˆï¼š<strong>pythonçš„çº¿ç¨‹å®è´¨æ˜¯æ“ä½œç³»ç»ŸåŸç”Ÿçš„çº¿ç¨‹ï¼Œè€Œæ¯ä¸ªçº¿ç¨‹è¦æ‰§è¡Œpythonä»£ç çš„è¯ï¼Œéœ€è¦è·å¾—å¯¹åº”ä»£ç è§£é‡Šå™¨çš„é”GILã€‚ä¸€èˆ¬æˆ‘ä»¬è¿è¡Œpythonç¨‹åºéƒ½åªæœ‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™æ ·ä¸åŒçº¿ç¨‹éœ€è¦è·å¾—åŒä¸€ä¸ªé”æ‰èƒ½æ‰§è¡Œå„è‡ªçš„ä»£ç ï¼Œäº’æ–¥äº†ï¼Œäºæ˜¯ä»£ç å°±ä¸èƒ½åŒæ—¶è¿è¡Œäº†ã€‚</strong><br>â€‹<br>å¥½çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»†ç»†è®²è§£è¿™å¥è¯èƒŒåçš„æ•…äº‹ï¼š</p>
<h2 id="å¤šçº¿ç¨‹å¹¶è¡Œæµ‹è¯•"><a href="#å¤šçº¿ç¨‹å¹¶è¡Œæµ‹è¯•" class="headerlink" title="å¤šçº¿ç¨‹å¹¶è¡Œæµ‹è¯•"></a>å¤šçº¿ç¨‹å¹¶è¡Œæµ‹è¯•</h2><p>é¦–å…ˆæˆ‘ä»¬é€šè¿‡ä¸€äº›ä»£ç æ¥æµ‹è¯•å¤šçº¿ç¨‹æ˜¯å¦çœŸçš„å¹¶è¡Œï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">COUNT = int(<span class="number">1e8</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_count_task</span><span class="params">(start, end)</span>:</span></span><br><span class="line">    start_time = datetime.datetime.now()</span><br><span class="line">    <span class="keyword">while</span> start &lt; end:</span><br><span class="line">        start += <span class="number">1</span></span><br><span class="line">    duration = datetime.datetime.now() - start_time</span><br><span class="line">    cur_thread_name = threading.current_thread().name</span><br><span class="line">    print(<span class="string">'[THREAD] [%s] %.4f seconds'</span> % (cur_thread_name, duration.total_seconds()))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">increment_singlethread</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'[SINGLE_THREAD] start by count pair: (%d, %d)'</span> % (<span class="number">0</span>, COUNT))</span><br><span class="line">    start_time = datetime.datetime.now()</span><br><span class="line">    _count_task(<span class="number">0</span>, COUNT)</span><br><span class="line">    duration = datetime.datetime.now() - start_time</span><br><span class="line">    print(<span class="string">'[SINGLE_THREAD] %.4f seconds'</span> % duration.total_seconds())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NUM_THREADS = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_counts</span><span class="params">()</span>:</span></span><br><span class="line">    segs = [<span class="number">0</span>]</span><br><span class="line">    div, mod = int(COUNT / NUM_THREADS), int(COUNT % NUM_THREADS)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(NUM_THREADS):</span><br><span class="line">        segs.append(div)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(mod):</span><br><span class="line">        segs[i + <span class="number">1</span>] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(segs)):</span><br><span class="line">        segs[i] += segs[i - <span class="number">1</span>]</span><br><span class="line">    cnts = []</span><br><span class="line">    segs[<span class="number">0</span>] = <span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(NUM_THREADS):</span><br><span class="line">        cnts.append((segs[i] + <span class="number">1</span>, segs[i + <span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">return</span> cnts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">increment_multithread</span><span class="params">()</span>:</span></span><br><span class="line">    cnts = _get_counts()</span><br><span class="line">    print(<span class="string">'[MULTI_THREAD] start by counts: %s'</span> % cnts)</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(NUM_THREADS):</span><br><span class="line">        threads.append(threading.Thread(</span><br><span class="line">            target=_count_task,</span><br><span class="line">            args=cnts[i],</span><br><span class="line">            name=<span class="string">'Task-%d'</span> % i</span><br><span class="line">        ))</span><br><span class="line">    start_time = datetime.datetime.now()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(NUM_THREADS):</span><br><span class="line">        threads[i].start()</span><br><span class="line">    time.sleep(<span class="number">0</span>)  <span class="comment"># yield exexcution to task threads</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(NUM_THREADS):</span><br><span class="line">        threads[i].join()</span><br><span class="line">    duration = datetime.datetime.now() - start_time</span><br><span class="line">    print(<span class="string">'[MULTI_THREAD] %.4f seconds'</span> % duration.total_seconds())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    increment_singlethread()</span><br><span class="line">    increment_multithread()</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸ªæµ‹è¯•ä»£ç ï¼Œæ€»å…±æ‰§è¡ŒCOUNTæ¬¡+=1çš„æ“ä½œï¼Œä¸€ä¸ªæ˜¯å•çº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯å¤šçº¿ç¨‹ã€‚å‡ºæ¥çš„ç»“æœï¼Œä¸¤ç§æ–¹å¼æ²¡æœ‰æ˜æ˜¾çš„æ—¶é—´ä¸Šçš„å·®å¼‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[SINGLE_THREAD] start by count pair: (0, 100000000)</span><br><span class="line">[THREAD] [MainThread] 7.1221 seconds</span><br><span class="line">[SINGLE_THREAD] 7.1221 seconds</span><br><span class="line">[MULTI_THREAD] start by counts: [(0, 20000000), (20000001, 40000000), (40000001, 60000000), (60000001, 80000000), (80000001, 100000000)]</span><br><span class="line">[THREAD] [Task-3] 5.8285 seconds</span><br><span class="line">[THREAD] [Task-0] 6.0101 seconds</span><br><span class="line">[THREAD] [Task-4] 6.6114 seconds</span><br><span class="line">[THREAD] [Task-1] 6.9136 seconds</span><br><span class="line">[THREAD] [Task-2] 6.9735 seconds</span><br><span class="line">[MULTI_THREAD] 7.0034 seconds</span><br></pre></td></tr></table></figure>
<p>è¿™ä¹Ÿä¾§é¢è¯æ˜äº†åŸºäº<code>threading.Thread</code>çš„å¤šçº¿ç¨‹å¹¶éå®Œå…¨å¹¶è¡Œè¿è¡Œçš„ã€‚ä¸ºäº†æ·±å…¥ç¡®è®¤è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸‹pythonå†…éƒ¨çš„çº¿ç¨‹è¿è¡Œçš„æœºåˆ¶</p>
<h2 id="çº¿ç¨‹æ˜¯å¦‚ä½•å¯åŠ¨çš„"><a href="#çº¿ç¨‹æ˜¯å¦‚ä½•å¯åŠ¨çš„" class="headerlink" title="çº¿ç¨‹æ˜¯å¦‚ä½•å¯åŠ¨çš„"></a>çº¿ç¨‹æ˜¯å¦‚ä½•å¯åŠ¨çš„</h2><p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸‹çº¿ç¨‹å¯åŠ¨çš„è¿‡ç¨‹ï¼Œç›´æ¥ä»<code>Thread</code>ç±»çš„<code>start</code>æ–¹æ³•å¼€å§‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span>:</span></span><br><span class="line">    <span class="string">"""A class that represents a thread of control.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This class can be safely subclassed in a limited fashion. There are two ways</span></span><br><span class="line"><span class="string">    to specify the activity: by passing a callable object to the constructor, or</span></span><br><span class="line"><span class="string">    by overriding the run() method in a subclass.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Start the thread's activity.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        It must be called at most once per thread object. It arranges for the</span></span><br><span class="line"><span class="string">        object's run() method to be invoked in a separate thread of control.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        This method will raise a RuntimeError if called more than once on the</span></span><br><span class="line"><span class="string">        same thread object.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._initialized:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"thread.__init__() not called"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self._started.is_set():</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">"threads can only be started once"</span>)</span><br><span class="line">        <span class="keyword">with</span> _active_limbo_lock:</span><br><span class="line">            _limbo[self] = self</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            _start_new_thread(self._bootstrap, ())</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">with</span> _active_limbo_lock:</span><br><span class="line">                <span class="keyword">del</span> _limbo[self]</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        self._started.wait()</span><br></pre></td></tr></table></figure>
<p><code>start</code>æ–¹æ³•ä¸­ï¼Œä»è¡Œä¸ºä¸Šæ¥çœ‹æ˜¯è¿™ä¹ˆä¸€ä¸ªé€»è¾‘ï¼š</p>
<ul>
<li>é¦–å…ˆä¼šæ£€æŸ¥<code>Thread</code>å®ä¾‹æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œæ˜¯å¦æ²¡æœ‰å¯åŠ¨è¿‡</li>
<li>ç„¶åä¼šæŠŠè‡ªå·±åŠ å…¥åˆ°<code>_limbo</code>ä¸­</li>
<li>è°ƒç”¨å¯åŠ¨çº¿ç¨‹çš„æ–¹æ³•<code>_start_new_thread</code>ï¼ŒæŠŠè‡ªå·±çš„<code>_bootstrap</code>æ–¹æ³•ä¹Ÿå¸¦è¿›å»<ul>
<li><code>_bootstrap</code>æ˜¯pythonç«¯æœ€ç»ˆå¼€å§‹çº¿ç¨‹ä»»åŠ¡æ‰€è°ƒç”¨çš„é€»è¾‘ï¼Œæ˜¯åœ¨æ–°çº¿ç¨‹é‡Œè¿è¡Œçš„ï¼åé¢ä¼šæ…¢æ…¢çœ‹åˆ°</li>
</ul>
</li>
<li>ç­‰å¾…<code>self._started</code>ï¼ˆä¸€ä¸ªEventå®ä¾‹ï¼‰çš„ä¿¡å·</li>
</ul>
<p>é¦–å…ˆæ¥çœ‹<code>_limbo</code>çš„ä½œç”¨ã€‚ç©æ¸¸æˆç©å¤šçš„åŒå­¦éƒ½çŸ¥é“ï¼Œ<code>limbo</code>å«åšâ€œåœ°ç‹±è¾¹å¢ƒâ€ï¼Œå¦‚æœå†æŸ¥ä¸‹å­—å…¸çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¹‹ç®€å•ç†è§£ä¸ºâ€œå‡†å¤‡æ€â€ã€‚å…ˆè®°å½•çº¿ç¨‹ä¸ºâ€œå‡†å¤‡æ€â€ï¼Œç„¶åæ‰ä¼šå¼€å§‹çœŸæ­£æ‰§è¡Œçº¿ç¨‹å¯åŠ¨çš„è¿‡ç¨‹ã€‚çº¿ç¨‹å¯åŠ¨çš„è¿‡ç¨‹æ˜¯åœ¨Cå±‚è¿›è¡Œçš„ï¼Œæˆ‘ä»¬ç‚¹è¿›<code>_start_new_thread</code>çš„å®šä¹‰å°±èƒ½çœ‹åˆ°pythonå±‚æ˜¯æ²¡æœ‰å¯¹åº”çš„ä»£ç çš„ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _threadmodule.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">thread_PyThread_start_new_thread(PyObject *self, PyObject *fargs)</span><br><span class="line">&#123;</span><br><span class="line">    _PyRuntimeState *runtime = &amp;_PyRuntime;</span><br><span class="line">    PyObject *func, *args, *keyw = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bootstate</span> *<span class="title">boot</span>;</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> ident;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// è§£åŒ…functionè·Ÿargså¹¶æ£€æŸ¥åˆæ³•æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (!PyArg_UnpackTuple(fargs, <span class="string">"start_new_thread"</span>, <span class="number">2</span>, <span class="number">3</span>,</span><br><span class="line">                           &amp;func, &amp;args, &amp;keyw))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (!PyCallable_Check(func)) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_TypeError,</span><br><span class="line">                        <span class="string">"first arg must be callable"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!PyTuple_Check(args)) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_TypeError,</span><br><span class="line">                        <span class="string">"2nd arg must be a tuple"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keyw != <span class="literal">NULL</span> &amp;&amp; !PyDict_Check(keyw)) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_TypeError,</span><br><span class="line">                        <span class="string">"optional 3rd arg must be a dictionary"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    PyInterpreterState *interp = _PyInterpreterState_GET();</span><br><span class="line">    <span class="keyword">if</span> (interp-&gt;config._isolated_interpreter) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_RuntimeError,</span><br><span class="line">                        <span class="string">"thread is not supported for isolated subinterpreters"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// è®¾ç½®bootstateå®ä¾‹</span></span><br><span class="line">    boot = PyMem_NEW(struct bootstate, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (boot == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> PyErr_NoMemory();</span><br><span class="line">    boot-&gt;interp = _PyInterpreterState_GET();</span><br><span class="line">    boot-&gt;func = func;</span><br><span class="line">    boot-&gt;args = args;</span><br><span class="line">    boot-&gt;keyw = keyw;</span><br><span class="line">    boot-&gt;tstate = _PyThreadState_Prealloc(boot-&gt;interp);</span><br><span class="line">    boot-&gt;runtime = runtime;</span><br><span class="line">    <span class="keyword">if</span> (boot-&gt;tstate == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        PyMem_DEL(boot);</span><br><span class="line">        <span class="keyword">return</span> PyErr_NoMemory();</span><br><span class="line">    &#125;</span><br><span class="line">    Py_INCREF(func);</span><br><span class="line">    Py_INCREF(args);</span><br><span class="line">    Py_XINCREF(keyw);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// å¯åŠ¨çº¿ç¨‹ï¼Œä¼ å‚t_bootstrapè·Ÿbootstateå®ä¾‹</span></span><br><span class="line">    ident = PyThread_start_new_thread(t_bootstrap, (<span class="keyword">void</span>*) boot);</span><br><span class="line">    <span class="keyword">if</span> (ident == PYTHREAD_INVALID_THREAD_ID) &#123;</span><br><span class="line">        PyErr_SetString(ThreadError, <span class="string">"can't start new thread"</span>);</span><br><span class="line">        Py_DECREF(func);</span><br><span class="line">        Py_DECREF(args);</span><br><span class="line">        Py_XDECREF(keyw);</span><br><span class="line">        PyThreadState_Clear(boot-&gt;tstate);</span><br><span class="line">        PyMem_DEL(boot);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> PyLong_FromUnsignedLong(ident);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pythonä¸­çš„<code>_start_new_thread</code>ï¼Œå¯¹åº”äº†Cå±‚çš„<code>thread_PyThread_start_new_thread</code>ï¼Œè€Œ<code>thread_PyThread_start_new_thread</code>ä¼ å…¥çš„ä¸¤ä¸ªå‚æ•°<code>self</code>è·Ÿ<code>fargs</code>ï¼Œåˆ™å¯¹åº”pythonä»£ç é‡Œçš„<code>self._bootstrap</code>è·Ÿç©ºçš„tupleã€‚<code>_start_new_thread</code>çš„å¤§è‡´æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ul>
<li>è§£åŒ…<code>fargs</code>ï¼Œå¹¶æ£€æŸ¥åˆæ³•æ€§ã€‚è¿™é‡Œç”±äºè¿›äº†ç©ºçš„tupleï¼Œæ‰€ä»¥æš‚æ—¶ä¸éœ€è¦è¿‡å¤šåˆ†æã€‚</li>
<li>è®¾ç½®<code>bootstate</code>å®ä¾‹<code>boot</code><ul>
<li>ä¸€ä¸ª<code>bootstate</code>æ˜¯<code>fargs</code>ä»¥åŠå¯¹åº”çš„<code>thread state</code>ã€<code>intepreter state</code>ä»¥åŠ<code>runtime state</code>çš„æ‰“åŒ…ï¼Œå›Šæ‹¬äº†å¯åŠ¨æ–°çº¿ç¨‹éœ€è¦æœ‰çš„ä¿¡æ¯</li>
</ul>
</li>
<li>è°ƒç”¨<code>PyThread_start_new_thread</code>å‡½æ•°ï¼ŒæŠŠ<code>bootstate</code>å®ä¾‹ä»¥åŠä¸€ä¸ªå›è°ƒå‡½æ•°<code>t_bootstrap</code>ä¼ è¿›å»<ul>
<li>å…¶è¿”å›å€¼æ˜¯çº¿ç¨‹çš„å®ä¾‹IDï¼Œåœ¨pythonç«¯ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡çº¿ç¨‹å®ä¾‹çš„<code>ident</code>å±æ€§å¾—åˆ°ã€‚</li>
<li><code>t_bootstrap</code>å›è°ƒå‡½æ•°ï¼Œæ˜¯éœ€è¦åœ¨æ–°å¯åŠ¨çš„å­çº¿ç¨‹é‡Œè¿è¡Œçš„ï¼</li>
</ul>
</li>
</ul>
<p><code>PyThread_start_new_thread</code>å‡½æ•°ï¼Œæ ¹æ®ä¸åŒæ“ä½œç³»ç»Ÿç¯å¢ƒæœ‰ä¸åŒçš„å®šä¹‰ã€‚ä»¥windowsç¯å¢ƒä¸ºä¾‹ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// thread_nt.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* thunker to call adapt between the function type used by the system's</span></span><br><span class="line"><span class="comment">thread start function and the internally used one. */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> __stdcall</span><br><span class="line">bootstrap(<span class="keyword">void</span> *call)</span><br><span class="line">&#123;</span><br><span class="line">    callobj *obj = (callobj*)call;</span><br><span class="line">    <span class="keyword">void</span> (*func)(<span class="keyword">void</span>*) = obj-&gt;func;</span><br><span class="line">    <span class="keyword">void</span> *arg = obj-&gt;arg;</span><br><span class="line">    HeapFree(GetProcessHeap(), <span class="number">0</span>, obj);</span><br><span class="line">    func(arg);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span></span><br><span class="line">PyThread_start_new_thread(<span class="keyword">void</span> (*func)(<span class="keyword">void</span> *), <span class="keyword">void</span> *arg)</span><br><span class="line">&#123;</span><br><span class="line">    HANDLE hThread;</span><br><span class="line">    <span class="keyword">unsigned</span> threadID;</span><br><span class="line">    callobj *obj;</span><br><span class="line"></span><br><span class="line">    dprintf((<span class="string">"%lu: PyThread_start_new_thread called\n"</span>,</span><br><span class="line">             PyThread_get_thread_ident()));</span><br><span class="line">    <span class="keyword">if</span> (!initialized)</span><br><span class="line">        PyThread_init_thread();</span><br><span class="line"></span><br><span class="line">    obj = (callobj*)HeapAlloc(GetProcessHeap(), <span class="number">0</span>, <span class="keyword">sizeof</span>(*obj));</span><br><span class="line">    <span class="keyword">if</span> (!obj)</span><br><span class="line">        <span class="keyword">return</span> PYTHREAD_INVALID_THREAD_ID;</span><br><span class="line">    obj-&gt;func = func;</span><br><span class="line">    obj-&gt;arg = arg;</span><br><span class="line">    PyThreadState *tstate = _PyThreadState_GET();</span><br><span class="line">    <span class="keyword">size_t</span> stacksize = tstate ? tstate-&gt;interp-&gt;pythread_stacksize : <span class="number">0</span>;</span><br><span class="line">    hThread = (HANDLE)_beginthreadex(<span class="number">0</span>,</span><br><span class="line">                      Py_SAFE_DOWNCAST(stacksize, Py_ssize_t, <span class="keyword">unsigned</span> <span class="keyword">int</span>),</span><br><span class="line">                      bootstrap, obj,</span><br><span class="line">                      <span class="number">0</span>, &amp;threadID);</span><br><span class="line">    <span class="keyword">if</span> (hThread == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">/* I've seen errno == EAGAIN here, which means "there are</span></span><br><span class="line"><span class="comment">         * too many threads".</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> e = errno;</span><br><span class="line">        dprintf((<span class="string">"%lu: PyThread_start_new_thread failed, errno %d\n"</span>,</span><br><span class="line">                 PyThread_get_thread_ident(), e));</span><br><span class="line">        threadID = (<span class="keyword">unsigned</span>)<span class="number">-1</span>;</span><br><span class="line">        HeapFree(GetProcessHeap(), <span class="number">0</span>, obj);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        dprintf((<span class="string">"%lu: PyThread_start_new_thread succeeded: %p\n"</span>,</span><br><span class="line">                 PyThread_get_thread_ident(), (<span class="keyword">void</span>*)hThread));</span><br><span class="line">        CloseHandle(hThread);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> threadID;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°<code>func</code>å’Œ<code>arg</code>ï¼Œå¯¹åº”çš„æ˜¯<code>t_bootstrap</code>å›è°ƒè·Ÿ<code>bootstate</code>å®ä¾‹ã€‚ä¸ºäº†é€‚é…<code>windows</code>ä¸‹çš„<code>_beginthreadex</code>æ¥å£å®šä¹‰ï¼Œ<code>t_bootstrap</code>è·Ÿ<code>bootstate</code>å®ä¾‹åˆæ‰“åŒ…æˆ<code>callobj</code>ï¼Œä½œä¸º<code>bootstrap</code>å‡½æ•°ï¼ˆé€‚é…ç”¨ï¼‰çš„å‚æ•°ï¼Œéš<code>bootstrap</code>ä¸€èµ·å…¥å‚<code>_beginthreadex</code>ã€‚</p>
<p><strong>è¿™æ—¶å€™æˆ‘ä»¬å·²ç»å¯ä»¥ç¡®å®šï¼Œpythonå¯åŠ¨çš„æ–°çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçš„åŸç”Ÿçº¿ç¨‹ã€‚</strong></p>
<p>æ–°çº¿ç¨‹è¯ç”Ÿæ—¶ï¼Œè°ƒç”¨äº†<code>bootstrap</code>ï¼Œåœ¨<code>bootstrap</code>é‡Œæ‹†åŒ…<code>callobj</code>ï¼Œè°ƒç”¨<code>func(arg)</code>ï¼Œä¹Ÿå°±æ˜¯<code>t_bootstrap(boot)</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// _threadmodule.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">t_bootstrap(<span class="keyword">void</span> *boot_raw)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">bootstate</span> *<span class="title">boot</span> = (<span class="title">struct</span> <span class="title">bootstate</span> *) <span class="title">boot_raw</span>;</span></span><br><span class="line">    PyThreadState *tstate;</span><br><span class="line">    PyObject *res;</span><br><span class="line"></span><br><span class="line">    tstate = boot-&gt;tstate;</span><br><span class="line">    tstate-&gt;thread_id = PyThread_get_thread_ident();  <span class="comment">// reset thread ID</span></span><br><span class="line">    _PyThreadState_Init(tstate);</span><br><span class="line">    PyEval_AcquireThread(tstate);  <span class="comment">// take gil for executing thread task</span></span><br><span class="line">    tstate-&gt;interp-&gt;num_threads++;</span><br><span class="line">    res = PyObject_Call(boot-&gt;func, boot-&gt;args, boot-&gt;keyw);</span><br><span class="line">    <span class="keyword">if</span> (res == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (PyErr_ExceptionMatches(PyExc_SystemExit))</span><br><span class="line">            <span class="comment">/* SystemExit is ignored silently */</span></span><br><span class="line">            PyErr_Clear();</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            _PyErr_WriteUnraisableMsg(<span class="string">"in thread started by"</span>, boot-&gt;func);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Py_DECREF(res);</span><br><span class="line">    &#125;</span><br><span class="line">    Py_DECREF(boot-&gt;func);</span><br><span class="line">    Py_DECREF(boot-&gt;args);</span><br><span class="line">    Py_XDECREF(boot-&gt;keyw);</span><br><span class="line">    PyMem_DEL(boot_raw);</span><br><span class="line">    tstate-&gt;interp-&gt;num_threads--;</span><br><span class="line">    PyThreadState_Clear(tstate);</span><br><span class="line">    _PyThreadState_DeleteCurrent(tstate);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// bpo-44434: Don't call explicitly PyThread_exit_thread(). On Linux with</span></span><br><span class="line">    <span class="comment">// the glibc, pthread_exit() can abort the whole process if dlopen() fails</span></span><br><span class="line">    <span class="comment">// to open the libgcc_s.so library (ex: EMFILE error).</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å›åˆ°<code>t_bootstrap</code>ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæœ€ç»ˆ<code>t_bootstrap</code>ä¼šå–å‡ºæ¥<code>boot</code>çš„<code>func</code>&amp;<code>args</code>ï¼Œç„¶åè°ƒç”¨<code>PyObject_Call</code>è°ƒç”¨<code>func(args)</code>ã€‚å›åˆ°å‰é¢å»çœ‹ï¼Œè¿™ä¸ª<code>func(args)</code>å°±æ˜¯pythonç«¯çš„<code>self._bootstrap()</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_bootstrap</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># Wrapper around the real bootstrap code that ignores</span></span><br><span class="line">        <span class="comment"># exceptions during interpreter cleanup.  Those typically</span></span><br><span class="line">        <span class="comment"># happen when a daemon thread wakes up at an unfortunate</span></span><br><span class="line">        <span class="comment"># moment, finds the world around it destroyed, and raises some</span></span><br><span class="line">        <span class="comment"># random exception *** while trying to report the exception in</span></span><br><span class="line">        <span class="comment"># _bootstrap_inner() below ***.  Those random exceptions</span></span><br><span class="line">        <span class="comment"># don't help anybody, and they confuse users, so we suppress</span></span><br><span class="line">        <span class="comment"># them.  We suppress them only when it appears that the world</span></span><br><span class="line">        <span class="comment"># indeed has already been destroyed, so that exceptions in</span></span><br><span class="line">        <span class="comment"># _bootstrap_inner() during normal business hours are properly</span></span><br><span class="line">        <span class="comment"># reported.  Also, we only suppress them for daemonic threads;</span></span><br><span class="line">        <span class="comment"># if a non-daemonic encounters this, something else is wrong.</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._bootstrap_inner()</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">if</span> self._daemonic <span class="keyword">and</span> _sys <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">   </span><br><span class="line"> <span class="function"><span class="keyword">def</span> <span class="title">_bootstrap_inner</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._set_ident()</span><br><span class="line">            self._set_tstate_lock()</span><br><span class="line">            <span class="keyword">if</span> _HAVE_THREAD_NATIVE_ID:</span><br><span class="line">                self._set_native_id()</span><br><span class="line">            self._started.set()</span><br><span class="line">            <span class="keyword">with</span> _active_limbo_lock:</span><br><span class="line">                _active[self._ident] = self</span><br><span class="line">                <span class="keyword">del</span> _limbo[self]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> _trace_hook:</span><br><span class="line">                _sys.settrace(_trace_hook)</span><br><span class="line">            <span class="keyword">if</span> _profile_hook:</span><br><span class="line">                _sys.setprofile(_profile_hook)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                self.run()</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                self._invoke_excepthook(self)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">with</span> _active_limbo_lock:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="comment"># We don't call self._delete() because it also</span></span><br><span class="line">                    <span class="comment"># grabs _active_limbo_lock.</span></span><br><span class="line">                    <span class="keyword">del</span> _active[get_ident()]</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>åœ¨<code>self._bootstrap_inner()</code>ä¸­ï¼Œå¤§è‡´æœ‰ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li>notify <code>self._started</code>ï¼Œè¿™æ ·å…ˆå‰pythonç«¯çš„<code>start</code>å‡½æ•°æµç¨‹å°±å®Œæˆäº†</li>
<li>æŠŠè‡ªå·±ä»å‡†å¤‡æ€<code>_limbo</code>ä¸­ç§»é™¤ï¼Œå¹¶æŠŠè‡ªå·±åŠ åˆ°<code>active</code>æ€é‡Œ</li>
<li>æ‰§è¡Œ<code>self.run</code>ï¼Œå¼€å§‹çº¿ç¨‹é€»è¾‘</li>
</ul>
<p>è¿™æ ·ï¼Œpythonä¸­æ–°çº¿ç¨‹å¯åŠ¨çš„å…¨è²Œå°±å±•ç°åœ¨æˆ‘ä»¬é¢å‰äº†ã€‚é™¤äº†çº¿ç¨‹çš„æ¥æºå¤–ï¼Œå¾ˆå¤šå…³äºçº¿ç¨‹ç›¸å…³çš„åŸºç¡€é—®é¢˜ï¼ˆæ¯”å¦‚ä¸ºå•¥ä¸èƒ½ç›´æ¥æ‰§è¡Œ<code>self.run</code>ï¼‰ï¼Œç­”æ¡ˆä¹Ÿéƒ½ä¸€ç›®äº†ç„¶</p>
<h2 id="çº¿ç¨‹æ‰§è¡Œä»£ç çš„è¿‡ç¨‹"><a href="#çº¿ç¨‹æ‰§è¡Œä»£ç çš„è¿‡ç¨‹" class="headerlink" title="çº¿ç¨‹æ‰§è¡Œä»£ç çš„è¿‡ç¨‹"></a>çº¿ç¨‹æ‰§è¡Œä»£ç çš„è¿‡ç¨‹</h2><p>åœ¨å…ˆå‰ä¸€å°èŠ‚æˆ‘ä»¬çŸ¥æ™“äº†pythonæ–°çš„çº¿ç¨‹ä»ä½•è€Œæ¥ï¼Œç„¶è€Œï¼Œåªæœ‰é€šè¿‡å‰–æçº¿ç¨‹æ‰§è¡Œä»£ç çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ‰å¯ä»¥æ˜ç¡®ä¸ºä»€ä¹ˆpythonçº¿ç¨‹ä¸èƒ½å¹¶è¡Œè¿è¡Œã€‚</p>
<p>ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå…¶ä»»åŠ¡ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦è½å®åˆ°<code>run</code>æ–¹æ³•ä¸Šæ¥ã€‚é¦–å…ˆæˆ‘ä»¬é€šè¿‡pythonè‡ªå¸¦çš„åç¼–è¯‘åº“<code>dis</code>æ¥çœ‹ä¸‹Threadçš„runå‡½æ•°å¯¹åº”çš„æ“ä½œç ï¼ˆopcodeï¼‰ï¼Œè¿™æ ·å°±é€šè¿‡pythonå†…éƒ¨å¯¹åº”opcodeçš„æ‰§è¡Œé€»è¾‘æ¥è¿›ä¸€æ­¥åˆ†æï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""Method representing the thread's activity.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        You may override this method in a subclass. The standard run() method</span></span><br><span class="line"><span class="string">        invokes the callable object passed to the object's constructor as the</span></span><br><span class="line"><span class="string">        target argument, if any, with sequential and keyword arguments taken</span></span><br><span class="line"><span class="string">        from the args and kwargs arguments, respectively.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> self._target:</span><br><span class="line">                self._target(*self._args, **self._kwargs)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="comment"># Avoid a refcycle if the thread is running a function with</span></span><br><span class="line">            <span class="comment"># an argument that has a member that points to the thread.</span></span><br><span class="line">            <span class="keyword">del</span> self._target, self._args, self._kwargs</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çœŸæ­£æ‰§è¡Œå‡½æ•°çš„ä¸€è¡Œ<code>self._target(*self._args, **self._kwargs)</code>ï¼Œå¯¹åº”çš„opcodesæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">910           8 LOAD_FAST                0 (self)</span><br><span class="line">             10 LOAD_ATTR                0 (_target)</span><br><span class="line">             12 LOAD_FAST                0 (self)</span><br><span class="line">             14 LOAD_ATTR                1 (_args)</span><br><span class="line">             16 BUILD_MAP                0</span><br><span class="line">             18 LOAD_FAST                0 (self)</span><br><span class="line">             20 LOAD_ATTR                2 (_kwargs)</span><br><span class="line">             22 DICT_MERGE               1</span><br><span class="line">             24 CALL_FUNCTION_EX         1</span><br><span class="line">             26 POP_TOP</span><br><span class="line">        &gt;&gt;   28 POP_BLOCK</span><br></pre></td></tr></table></figure>
<p>å¾ˆæ˜æ˜¾ï¼Œ<code>CALL_FUNCTION_EX</code>â€”â€”è°ƒç”¨å‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦æ‰¾åˆ°çš„opcodeã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line">PyObject* _Py_HOT_FUNCTION</span><br><span class="line">_PyEval_EvalFrameDefault(PyThreadState *tstate, PyFrameObject *f, <span class="keyword">int</span> throwflag)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// çœç•¥è¶…å¤šè¡Œ</span></span><br><span class="line">    <span class="keyword">switch</span> (opcode) &#123;</span><br><span class="line">        <span class="comment">// çœç•¥è¶…å¤šè¡Œ</span></span><br><span class="line">        case TARGET(CALL_FUNCTION_EX): &#123;</span><br><span class="line">            <span class="comment">// æ£€æŸ¥å‡½æ•°è·Ÿå‚æ•°</span></span><br><span class="line">            PREDICTED(CALL_FUNCTION_EX);</span><br><span class="line">            PyObject *func, *callargs, *kwargs = <span class="literal">NULL</span>, *result;</span><br><span class="line">            <span class="keyword">if</span> (oparg &amp; <span class="number">0x01</span>) &#123;</span><br><span class="line">                kwargs = POP();</span><br><span class="line">                <span class="keyword">if</span> (!PyDict_CheckExact(kwargs)) &#123;</span><br><span class="line">                    PyObject *d = PyDict_New();</span><br><span class="line">                    <span class="keyword">if</span> (d == <span class="literal">NULL</span>)</span><br><span class="line">                        <span class="keyword">goto</span> error;</span><br><span class="line">                    <span class="keyword">if</span> (_PyDict_MergeEx(d, kwargs, <span class="number">2</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                        Py_DECREF(d);</span><br><span class="line">                        format_kwargs_error(tstate, SECOND(), kwargs);</span><br><span class="line">                        Py_DECREF(kwargs);</span><br><span class="line">                        <span class="keyword">goto</span> error;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Py_DECREF(kwargs);</span><br><span class="line">                    kwargs = d;</span><br><span class="line">                &#125;</span><br><span class="line">                assert(PyDict_CheckExact(kwargs));</span><br><span class="line">            &#125;</span><br><span class="line">            callargs = POP();</span><br><span class="line">            func = TOP();</span><br><span class="line">            <span class="keyword">if</span> (!PyTuple_CheckExact(callargs)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (check_args_iterable(tstate, func, callargs) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    Py_DECREF(callargs);</span><br><span class="line">                    <span class="keyword">goto</span> error;</span><br><span class="line">                &#125;</span><br><span class="line">                Py_SETREF(callargs, PySequence_Tuple(callargs));</span><br><span class="line">                <span class="keyword">if</span> (callargs == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                    <span class="keyword">goto</span> error;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            assert(PyTuple_CheckExact(callargs));</span><br><span class="line">            <span class="comment">// è°ƒç”¨å‡½æ•°</span></span><br><span class="line">            result = do_call_core(tstate, func, callargs, kwargs);</span><br><span class="line">            Py_DECREF(func);</span><br><span class="line">            Py_DECREF(callargs);</span><br><span class="line">            Py_XDECREF(kwargs);</span><br><span class="line"></span><br><span class="line">            SET_TOP(result);</span><br><span class="line">            <span class="keyword">if</span> (result == <span class="literal">NULL</span>) &#123;</span><br><span class="line">                <span class="keyword">goto</span> error;</span><br><span class="line">            &#125;</span><br><span class="line">            DISPATCH();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// çœç•¥è¶…å¤šè¡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çœç•¥è¶…å¤šè¡Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>ceval.c</code>ä¸­ï¼Œè¶…å¤§å‡½æ•°<code>_PyEval_EvalFrameDefault</code>å°±æ˜¯ç”¨æ¥è§£æopcodeçš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œå¯ä»¥æ£€ç´¢opcodeç ”ç©¶å¯¹åº”çš„é€»è¾‘ã€‚æ‰¾åˆ°<code>CALL_FUNCTION_EX</code>å¯¹åº”çš„é€»è¾‘ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ï¼Œé¡ºè—¤æ‘¸ç“œï¼Œæœ€ç»ˆä¼šè½å®åˆ°è¿™é‡Œï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// call.c</span></span><br><span class="line"></span><br><span class="line">PyObject *</span><br><span class="line">_PyObject_Call(PyThreadState *tstate, PyObject *callable,</span><br><span class="line">               PyObject *args, PyObject *kwargs)</span><br><span class="line">&#123;</span><br><span class="line">    ternaryfunc call;</span><br><span class="line">    PyObject *result;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* PyObject_Call() must not be called with an exception set,</span></span><br><span class="line"><span class="comment">       because it can clear it (directly or indirectly) and so the</span></span><br><span class="line"><span class="comment">       caller loses its exception */</span></span><br><span class="line">    assert(!_PyErr_Occurred(tstate));</span><br><span class="line">    assert(PyTuple_Check(args));</span><br><span class="line">    assert(kwargs == <span class="literal">NULL</span> || PyDict_Check(kwargs));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (PyVectorcall_Function(callable) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> PyVectorcall_Call(callable, args, kwargs);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        call = Py_TYPE(callable)-&gt;tp_call;</span><br><span class="line">        <span class="keyword">if</span> (call == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            _PyErr_Format(tstate, PyExc_TypeError,</span><br><span class="line">                          <span class="string">"'%.200s' object is not callable"</span>,</span><br><span class="line">                          Py_TYPE(callable)-&gt;tp_name);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (_Py_EnterRecursiveCall(tstate, <span class="string">" while calling a Python object"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        result = (*call)(callable, args, kwargs);</span><br><span class="line"></span><br><span class="line">        _Py_LeaveRecursiveCall(tstate);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _Py_CheckFunctionResult(tstate, callable, result, <span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>_PyObject_Call</code>ä¸­ï¼Œè°ƒç”¨å‡½æ•°çš„æ–¹å¼æœ€åéƒ½ä»¥é€šç”¨çš„å½¢å¼ï¼ˆ<code>vectorcall</code>ä»¥åŠ<code>Py_TYPE(callable)-&gt;tp_call</code>ï¼‰å‘ˆç°ï¼Œè¿™è¯´æ˜å…¥å‚ä¸åŒçš„<code>callable</code>ï¼Œå¯èƒ½éœ€è¦ä¸åŒçš„calleræ–¹æ³•æ¥handleã€‚åŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥debugçº¿ç¨‹ç±»Threadçš„<code>run</code>æ–¹æ³•ï¼ˆåœ¨ä¸»çº¿ç¨‹ç›´æ¥è·‘å°±è¡Œäº†ï¼‰ï¼Œæ¥è§‚å¯Ÿçº¿ç¨‹runå‡½æ•°è°ƒç”¨çš„è¿‡ç¨‹ã€‚æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_stat</span><span class="params">(a, b)</span>:</span> print(a + b)</span><br><span class="line">t = Thread(target=_stat, args=(<span class="number">2</span>, <span class="number">5</span>))</span><br><span class="line">t.run()</span><br></pre></td></tr></table></figure>
<p><code>t.run</code>ä¸­çš„<code>self._target(*self._args, **self._kwargs)</code>ä¸€è¡Œè§¦å‘äº†<code>_PyObject_Call</code>ä¸­<code>PyVectorcall_Call</code>åˆ†æ”¯ã€‚ä¸€è·¯step intoä¸‹å»ï¼Œæœ€ç»ˆæ¥åˆ°äº†<code>_PyEval_EvalFrame</code>å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> PyObject*</span><br><span class="line">_PyEval_EvalFrame(PyThreadState *tstate, PyFrameObject *f, <span class="keyword">int</span> throwflag)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> tstate-&gt;interp-&gt;eval_frame(tstate, f, throwflag);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>frame</code>å°±æ˜¯pythonå‡½æ•°è°ƒç”¨æ ˆä¸Šé¢çš„å•ä½å®ä¾‹ï¼ˆç±»ä¼¼äºluaçš„<code>callinfo</code>ï¼‰ï¼ŒåŒ…å«äº†ä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„ç›¸å…³ä¿¡æ¯ã€‚<code>eval_frame</code>å°±æ˜¯å¯¹<code>frame</code>ä¿å­˜çš„<code>code</code>ï¼ˆä»£ç ï¼‰å®ä¾‹è§£æå¹¶æ‰§è¡Œã€‚è§£é‡Šå™¨ç”¨çš„æ˜¯<code>tstate-&gt;interp</code>ï¼Œä»å…ˆå‰çº¿ç¨‹å¯åŠ¨çš„é€»è¾‘æ¥çœ‹ï¼Œåœ¨<code>thread_PyThread_start_new_thread</code>é‡Œï¼Œä¸»çº¿ç¨‹å°±æŠŠè‡ªå·±çš„<code>interp</code>ç»™åˆ°å­çº¿ç¨‹äº†ï¼Œæ‰€ä»¥ä¸ç®¡åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å…±ç”¨ä¸€å¥—è§£é‡Šå™¨ã€‚é‚£è§£é‡Šå™¨çš„<code>eval_frame</code>æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…œå…œè½¬è½¬ï¼Œåˆå›åˆ°äº†è¶…å¤§å‡½æ•°<code>_PyEval_EvalFrameDefault</code>ã€‚</p>
<p>ä»<code>_PyEval_EvalFrameDefault</code>çš„<code>main_loop</code>è¿™ä¸ªgotoè®°å·å¾€ä¸‹ï¼Œå°±æ˜¯æ— é™å¾ªç¯å¤„ç†opcodeäº†ã€‚ä½†åœ¨switch opcodeä¹‹å‰ï¼Œæœ‰ä¸€ä¸ªåˆ¤æ–­é€»è¾‘ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line">PyObject* _Py_HOT_FUNCTION</span><br><span class="line">_PyEval_EvalFrameDefault(PyThreadState *tstate, PyFrameObject *f, <span class="keyword">int</span> throwflag)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// çœç•¥ä¸Šé¢</span></span><br><span class="line">main_loop:</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="comment">// çœç•¥ä¸Šé¢</span></span><br><span class="line">  <span class="keyword">if</span> (_Py_atomic_load_relaxed(eval_breaker)) &#123;</span><br><span class="line">            opcode = _Py_OPCODE(*next_instr);</span><br><span class="line">            <span class="keyword">if</span> (opcode == SETUP_FINALLY ||</span><br><span class="line">                opcode == SETUP_WITH ||</span><br><span class="line">                opcode == BEFORE_ASYNC_WITH ||</span><br><span class="line">                opcode == YIELD_FROM) &#123;</span><br><span class="line">                <span class="comment">/* Few cases where we skip running signal handlers and other</span></span><br><span class="line"><span class="comment">                   pending calls:</span></span><br><span class="line"><span class="comment">                   - If we're about to enter the 'with:'. It will prevent</span></span><br><span class="line"><span class="comment">                     emitting a resource warning in the common idiom</span></span><br><span class="line"><span class="comment">                     'with open(path) as file:'.</span></span><br><span class="line"><span class="comment">                   - If we're about to enter the 'async with:'.</span></span><br><span class="line"><span class="comment">                   - If we're about to enter the 'try:' of a try/finally (not</span></span><br><span class="line"><span class="comment">                     *very* useful, but might help in some cases and it's</span></span><br><span class="line"><span class="comment">                     traditional)</span></span><br><span class="line"><span class="comment">                   - If we're resuming a chain of nested 'yield from' or</span></span><br><span class="line"><span class="comment">                     'await' calls, then each frame is parked with YIELD_FROM</span></span><br><span class="line"><span class="comment">                     as its next opcode. If the user hit control-C we want to</span></span><br><span class="line"><span class="comment">                     wait until we've reached the innermost frame before</span></span><br><span class="line"><span class="comment">                     running the signal handler and raising KeyboardInterrupt</span></span><br><span class="line"><span class="comment">                     (see bpo-30039).</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">goto</span> fast_next_opcode;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (eval_frame_handle_pending(tstate) != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">goto</span> error;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// çœç•¥ä¸‹é¢</span></span><br><span class="line">    &#125;</span><br><span class="line"> <span class="comment">// çœç•¥ä¸‹é¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç é¦–å…ˆä¼šåˆ¤æ–­ä»£ç è§£é‡Šæ˜¯å¦è¾¾åˆ°ä¸­æ–­æ¡ä»¶<code>eval_breaker</code>ï¼Œå¦‚æœè¾¾åˆ°äº†çš„è¯ï¼Œå¯èƒ½ä¼šèµ°åˆ°<code>eval_frame_handle_pending</code>å¤„ç†ä¸­æ–­ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Handle signals, pending calls, GIL drop request</span></span><br><span class="line"><span class="comment">   and asynchronous exception */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">eval_frame_handle_pending(PyThreadState *tstate)</span><br><span class="line">&#123;</span><br><span class="line">    _PyRuntimeState * <span class="keyword">const</span> runtime = &amp;_PyRuntime;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">ceval_runtime_state</span> *<span class="title">ceval</span> = &amp;<span class="title">runtime</span>-&gt;<span class="title">ceval</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Pending signals */</span></span><br><span class="line">    <span class="keyword">if</span> (_Py_atomic_load_relaxed(&amp;ceval-&gt;signals_pending)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (handle_signals(tstate) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Pending calls */</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">ceval_state</span> *<span class="title">ceval2</span> = &amp;<span class="title">tstate</span>-&gt;<span class="title">interp</span>-&gt;<span class="title">ceval</span>;</span></span><br><span class="line">    <span class="keyword">if</span> (_Py_atomic_load_relaxed(&amp;ceval2-&gt;pending.calls_to_do)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (make_pending_calls(tstate) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* GIL drop request */</span></span><br><span class="line">    <span class="keyword">if</span> (_Py_atomic_load_relaxed(&amp;ceval2-&gt;gil_drop_request)) &#123;</span><br><span class="line">        <span class="comment">/* Give another thread a chance */</span></span><br><span class="line">        <span class="keyword">if</span> (_PyThreadState_Swap(&amp;runtime-&gt;gilstate, <span class="literal">NULL</span>) != tstate) &#123;</span><br><span class="line">            Py_FatalError(<span class="string">"tstate mix-up"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        drop_gil(ceval, ceval2, tstate);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Other threads may run now */</span></span><br><span class="line"></span><br><span class="line">        take_gil(tstate);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (_PyThreadState_Swap(&amp;runtime-&gt;gilstate, tstate) != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            Py_FatalError(<span class="string">"orphan tstate"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Check for asynchronous exception. */</span></span><br><span class="line">    <span class="keyword">if</span> (tstate-&gt;async_exc != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        PyObject *exc = tstate-&gt;async_exc;</span><br><span class="line">        tstate-&gt;async_exc = <span class="literal">NULL</span>;</span><br><span class="line">        UNSIGNAL_ASYNC_EXC(tstate-&gt;interp);</span><br><span class="line">        _PyErr_SetNone(tstate, exc);</span><br><span class="line">        Py_DECREF(exc);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> MS_WINDOWS</span></span><br><span class="line">    <span class="comment">// bpo-42296: On Windows, _PyEval_SignalReceived() can be called in a</span></span><br><span class="line">    <span class="comment">// different thread than the Python thread, in which case</span></span><br><span class="line">    <span class="comment">// _Py_ThreadCanHandleSignals() is wrong. Recompute eval_breaker in the</span></span><br><span class="line">    <span class="comment">// current Python thread with the correct _Py_ThreadCanHandleSignals()</span></span><br><span class="line">    <span class="comment">// value. It prevents to interrupt the eval loop at every instruction if</span></span><br><span class="line">    <span class="comment">// the current Python thread cannot handle signals (if</span></span><br><span class="line">    <span class="comment">// _Py_ThreadCanHandleSignals() is false).</span></span><br><span class="line">    COMPUTE_EVAL_BREAKER(tstate-&gt;interp, ceval, ceval2);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>eval_frame_handle_pending</code>å¤„ç†äº†å¤šç§opcodeè§£æä¸­æ–­çš„åœºæ™¯ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºæ˜¯å“ªä¸ªçº¿ç¨‹è·‘åˆ°è¿™é‡Œï¼Œå¦‚æœé‡åˆ°äº†<code>gil_drop_request</code>ï¼Œå°±å¾—<code>drop_gil</code>ç»™åˆ°å…¶ä»–çº¿ç¨‹ï¼Œä¹‹åå†å°è¯•<code>take_gil</code>ï¼Œé‡æ–°ç«äº‰è§£é‡Šå™¨é”ã€‚<br>åœ¨å…ˆå‰è®²è§£çº¿ç¨‹å¯åŠ¨é€»è¾‘çš„æ—¶å€™ï¼Œæ–°çº¿ç¨‹è°ƒç”¨çš„<code>t_bootstrap</code>å‡½æ•°é‡Œï¼Œæœ‰ä¸€å¥<code>PyEval_AcquireThread(tstate)</code>ï¼Œè¿™é‡Œé¢å°±åŒ…å«äº†<code>take_gil</code>çš„é€»è¾‘ã€‚æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹<code>take_gil</code>åˆ°åº•å¹²äº†ä»€ä¹ˆäº‹æƒ…ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ceval_gil.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Take the GIL.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   The function saves errno at entry and restores its value at exit.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   tstate must be non-NULL. */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">take_gil(PyThreadState *tstate)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// çœç•¥ä¸Šé¢</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!_Py_atomic_load_relaxed(&amp;gil-&gt;locked)) &#123;</span><br><span class="line">        <span class="keyword">goto</span> _ready;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (_Py_atomic_load_relaxed(&amp;gil-&gt;locked)) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰æ‹¿åˆ°gilçš„æƒ…å†µ</span></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">long</span> saved_switchnum = gil-&gt;switch_number;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">long</span> interval = (gil-&gt;interval &gt;= <span class="number">1</span> ? gil-&gt;interval : <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> timed_out = <span class="number">0</span>;</span><br><span class="line">        COND_TIMED_WAIT(gil-&gt;cond, gil-&gt;mutex, interval, timed_out);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* If we timed out and no switch occurred in the meantime, it is time</span></span><br><span class="line"><span class="comment">           to ask the GIL-holding thread to drop it. */</span></span><br><span class="line">        <span class="keyword">if</span> (timed_out &amp;&amp;</span><br><span class="line">            _Py_atomic_load_relaxed(&amp;gil-&gt;locked) &amp;&amp;</span><br><span class="line">            gil-&gt;switch_number == saved_switchnum)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (tstate_must_exit(tstate)) &#123;</span><br><span class="line">                MUTEX_UNLOCK(gil-&gt;mutex);</span><br><span class="line">                PyThread_exit_thread();</span><br><span class="line">            &#125;</span><br><span class="line">            assert(is_tstate_valid(tstate));</span><br><span class="line"></span><br><span class="line">            SET_GIL_DROP_REQUEST(interp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">_ready:</span><br><span class="line">    <span class="comment">// çœç•¥FORCE_SWITCHINGå®ç›¸å…³ä»£ç </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* We now hold the GIL */</span></span><br><span class="line">    _Py_atomic_store_relaxed(&amp;gil-&gt;locked, <span class="number">1</span>);</span><br><span class="line">    _Py_ANNOTATE_RWLOCK_ACQUIRED(&amp;gil-&gt;locked, <span class="comment">/*is_write=*/</span><span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (tstate != (PyThreadState*)_Py_atomic_load_relaxed(&amp;gil-&gt;last_holder)) &#123;</span><br><span class="line">        _Py_atomic_store_relaxed(&amp;gil-&gt;last_holder, (<span class="keyword">uintptr_t</span>)tstate);</span><br><span class="line">        ++gil-&gt;switch_number;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çœç•¥FORCE_SWITCHINGå®ç›¸å…³ä»£ç </span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çœç•¥ä¸‹é¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°è¿™æ®µé€»è¾‘ï¼šå½“<code>gil</code>ä¸€ç›´è¢«å æ—¶ï¼Œå°±ä¼šè¿›å…¥whileå¾ªç¯çš„<code>COND_TIMED_WAIT</code>ï¼Œç­‰å¾…<code>gil-&gt;cond</code>çš„ä¿¡å·ã€‚è¿™ä¸ªä¿¡å·çš„é€šçŸ¥é€»è¾‘æ˜¯åœ¨<code>drop_gil</code>çš„é‡Œé¢çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†<code>drop_gil</code>å°±ä¼šè§¦å‘è¿™ä¸ªä¿¡å·ï¼Œè€Œç”±äºpythonçš„çº¿ç¨‹æ˜¯æ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœæ·±æŒ–<code>COND_TIMED_WAIT</code>å†…éƒ¨çš„å®ç°ä¹Ÿå¯ä»¥çœ‹åˆ°å®è´¨ä¸Šæ˜¯æ“ä½œç³»ç»Ÿåœ¨è°ƒåº¦ä¿¡å·è§¦å‘åçº¿ç¨‹çš„å”¤é†’ã€‚<code>COND_TIMED_WAIT</code>çš„æ—¶é•¿æ˜¯<code>gil-&gt;interval</code>ï¼ˆä¹Ÿå°±æ˜¯<code>sys.getswitchinterval()</code>ï¼Œçº¿ç¨‹åˆ‡æ¢æ—¶é—´ï¼‰ï¼Œè¿‡äº†è¿™æ®µæ—¶é—´è¿˜æ˜¯åŸæ¥çº¿ç¨‹holdä½<code>gil</code>çš„è¯ï¼Œå°±å¼ºåˆ¶è§¦å‘<code>SET_GIL_DROP_REQUEST</code>é€»è¾‘</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">void</span></span><br><span class="line">SET_GIL_DROP_REQUEST(PyInterpreterState *interp)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> _<span class="title">ceval_state</span> *<span class="title">ceval2</span> = &amp;<span class="title">interp</span>-&gt;<span class="title">ceval</span>;</span></span><br><span class="line">    _Py_atomic_store_relaxed(&amp;ceval2-&gt;gil_drop_request, <span class="number">1</span>);</span><br><span class="line">    _Py_atomic_store_relaxed(&amp;ceval2-&gt;eval_breaker, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°<code>SET_GIL_DROP_REQUEST</code>å¼ºåˆ¶æ¿€æ´»<code>gil_drop_request</code>è·Ÿ<code>eval_breaker</code>ï¼Œè¿™æ ·æŒæœ‰GILçš„çº¿ç¨‹åœ¨<code>EvalFrame</code>çš„æ—¶å€™å‘ç°æ»¡è¶³<code>eval_breaker</code>ï¼Œå°±ä¼šèµ°<code>eval_frame_handle_pending</code>çš„é€»è¾‘ï¼Œé‡Œé¢å†åˆ¤æ–­æœ‰<code>gil_drop_request</code>ä¹‹åï¼Œå°±è°ƒç”¨<code>drop_gil</code>æŠŠè§£é‡Šå™¨é”é‡Šæ”¾å‡ºæ¥ã€‚è¿™æ ·ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œ<code>SET_GIL_DROP_REQUEST</code>ä¹‹åçš„æŸæ¬¡<code>COND_TIMED_WAIT</code>æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æå‰è¢«signalåˆ°ï¼Œä¹‹ååˆå‘ç°<code>gil</code>æ²¡æœ‰è¢«lockedï¼Œäºæ˜¯å°±èƒ½å¤Ÿç»§ç»­ä¸‹é¢çš„é€»è¾‘ï¼ŒæŒæœ‰GILäº†ã€‚æœ€åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°äº†ä»£ç çš„æ‰§è¡Œæƒï¼Œè€ŒåŸå…ˆä¸¢æ‰GILçš„çº¿ç¨‹ï¼Œåœ¨<code>eval_frame_handle_pending</code>å†æ¬¡è°ƒç”¨<code>take_gil</code>ï¼Œåè¿‡æ¥èµ°åœ¨äº†ç«äº‰ä»£ç æ‰§è¡Œæƒçš„è·¯ä¸Šã€‚å¾ªç¯å¾€å¤ï¼Œå¦‚æ˜¯è€Œå·²ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>é€šè¿‡å¯¹çº¿ç¨‹å¯åŠ¨æœºåˆ¶ã€ä»£ç è¿è¡Œæœºåˆ¶ä»¥åŠåŸºäºGILçš„çº¿ç¨‹è°ƒåº¦æœºåˆ¶çš„å‰–æï¼Œæˆ‘ä»¬å¯ä»¥â€œä¸€å›¾æµâ€ï¼Œè§£é‡Šâ€œpythonå¤šçº¿ç¨‹ä¸ºä»€ä¹ˆä¸èƒ½å¹¶è¡Œâ€è¿™ä¸ªé—®é¢˜ï¼š</p>
<p><img src="/uploads/mediumpython/iii/threads.png" alt="threads" title="&#39;threads&#39;"></p>
]]></content>
      <categories>
        <category>Medium Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>GIL</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>opcode</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Medium Pythonã€‘ç¬¬äºŒè¯ï¼šdictçš„keys()è¿”å›äº†ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Ÿ</title>
    <url>/2021/10/23/mediumpython/ii/</url>
    <content><![CDATA[<p>åœ¨python3é‡Œé¢ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨<code>if k in d.keys()</code>æ¥åˆ¤æ–­æŸä¸ªkeyæ˜¯ä¸æ˜¯åœ¨æŸä¸ªdicté‡Œé¢ï¼Œæˆ–è€…æ˜¯ç”¨<code>a_dict.keys() - b_dict.keys()</code>æ¥è·å–ä¸¤ä¸ªå­—å…¸ä¹‹é—´keysçš„å·®é›†ã€‚é‚£ä¹ˆè¿™é‡Œå°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œdictçš„<code>keys()</code>è¿”å›äº†ä»€ä¹ˆæ•°æ®ç±»å‹å‘¢ï¼Ÿ</p>
<p>listï¼Ÿsetï¼Ÿä¸¤è€…éƒ½æ˜¯é”™è¯¯ç­”æ¡ˆã€‚Donâ€™t say so muchï¼Œæ‰“å°ä¸€ä¸‹typeï¼Œå‘ç°æ˜¯è¿™ä¹ˆä¸ªæ•°æ®ç±»å‹ï¼š<code>&lt;class &#39;dict_keys&#39;&gt;</code></p>
<h2 id="dict-keysæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ"><a href="#dict-keysæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ" class="headerlink" title="dict_keysæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ"></a>dict_keysæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</h2><p>åœ¨python dictæ•°æ®ç»“æ„å®šä¹‰ä¸­ï¼ˆ<code>dictobject.c</code>ï¼‰ï¼Œå¯ä»¥çœ‹åˆ°<code>dict_keys</code>çš„å®šä¹‰</p>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dictobject.c</span></span><br><span class="line"></span><br><span class="line">PyTypeObject PyDictKeys_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"dict_keys"</span>,                                <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(_PyDictViewObject),                  <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_itemsize */</span></span><br><span class="line">    <span class="comment">/* methods */</span></span><br><span class="line">    (destructor)dictview_dealloc,               <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_vectorcall_offset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_async */</span></span><br><span class="line">    (reprfunc)dictview_repr,                    <span class="comment">/* tp_repr */</span></span><br><span class="line">    &amp;dictviews_as_number,                       <span class="comment">/* tp_as_number */</span></span><br><span class="line">    &amp;dictkeys_as_sequence,                      <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_hash */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_call */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_str */</span></span><br><span class="line">    PyObject_GenericGetAttr,                    <span class="comment">/* tp_getattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_buffer */</span></span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC,<span class="comment">/* tp_flags */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_doc */</span></span><br><span class="line">    (traverseproc)dictview_traverse,            <span class="comment">/* tp_traverse */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_clear */</span></span><br><span class="line">    dictview_richcompare,                       <span class="comment">/* tp_richcompare */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_weaklistoffset */</span></span><br><span class="line">    (getiterfunc)dictkeys_iter,                 <span class="comment">/* tp_iter */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iternext */</span></span><br><span class="line">    dictkeys_methods,                           <span class="comment">/* tp_methods */</span></span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>dict_keys</code>æ•°æ®ç»“æ„çš„sizeï¼Œæ˜¯ä»¥<code>_PyDictViewObject</code>ä¸ºå‡†çš„ã€‚<code>_PyDictViewObject</code>ä»è¯­ä¹‰ä¸Šçœ‹æ˜¯dictçš„ä¸€ä¸ªè§†å›¾ï¼Œä»é€»è¾‘ä¸Šçœ‹åªåŒ…å«äº†ä¸€ä¸ªå¯¹åº”dictçš„æŒ‡é’ˆ</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dictobject.h</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    PyObject_HEAD</span><br><span class="line">    PyDictObject *dv_dict;</span><br><span class="line">&#125; _PyDictViewObject;</span><br></pre></td></tr></table></figure>
<p>å¦‚ä½•ç†è§£<code>DictView</code>çš„è®¾è®¡ï¼Ÿå…¶å®è¿™ç§ç›¸å½“äºä¸€ä¸ªdictå®ä¾‹çš„ä»£ç†ï¼ˆAgent/Proxyï¼‰ï¼Œç”¨æˆ·ï¼ˆå¼€å‘è€…ï¼‰ä¾§è¯·æ±‚å¯¹åº”çš„æ“ä½œï¼ˆinã€è¿ç®—ç¬¦ç­‰ï¼‰ï¼Œä»£ç†ä¾§æ¥ç»™å‡ºä¸€ä¸ªæœ€æœ‰æ•ˆç‡çš„æ–¹æ¡ˆã€‚ä¸¾ä¸€äº›ä¾‹å­ï¼š</p>
<h3 id="inæ“ä½œ"><a href="#inæ“ä½œ" class="headerlink" title="inæ“ä½œ"></a>inæ“ä½œ</h3><p>inæ¶‰åŠåˆ°<code>for k in d.keys()</code>è·Ÿ<code>has_key = (k in d.keys())</code>ä¸¤ç§å½¢å¼ï¼Œå¯¹åº”è¿­ä»£éå†è·ŸåŒ…å«ä¸¤ç§æ“ä½œã€‚<br><code>for k in d.keys()</code>æ“ä½œå¯¹åº”çš„æ˜¯<code>PyDictKeys_Type</code>é‡Œçš„<code>dictkeys_iter</code>å‡½æ•°ï¼Œè¿”å›äº†è¿™ä¸ª<code>DictView</code>è§†å›¾å¯¹åº”çš„dictçš„keyçš„iteratorï¼Œç±»å‹ä¸º<code>PyDictIterKey_Type</code>ã€‚åœ¨è¿­ä»£éå†æ—¶å€™ï¼Œä¼šä¸€ç›´è°ƒç”¨<code>PyDictIterKey_Type</code>é‡Œå®šä¹‰çš„<code>dictiter_iternextkey</code>æ‰§è¡Œè¿­ä»£è¿‡ç¨‹ä¸­çš„nextæ“ä½œï¼Œä»è€Œä¸€ä¸ªä¸ªåœ°è·å¾—dicté‡Œæ‰€æœ‰keyã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dictobject.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// dictçš„keyçš„iteratorçš„å®šä¹‰ï¼Œè¿™é‡ŒåªèŠ‚é€‰ä¸€éƒ¨åˆ†</span></span><br><span class="line">PyTypeObject PyDictIterKey_Type = &#123;</span><br><span class="line">    <span class="string">"dict_keyiterator"</span>,                         <span class="comment">/* tp_name */</span></span><br><span class="line">    <span class="keyword">sizeof</span>(dictiterobject),                     <span class="comment">/* tp_basicsize */</span></span><br><span class="line">    PyObject_SelfIter,                          <span class="comment">/* tp_iter */</span></span><br><span class="line">    (iternextfunc)dictiter_iternextkey,         <span class="comment">/* tp_iternext */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>has_key = (k in d.keys())</code>å¯¹åº”çš„æ˜¯åŒ…å«æ“ä½œï¼Œåœ¨<code>PyDictKeys_Type</code>é‡Œé¢ï¼Œå¯¹åº”çš„æ˜¯<code>dictkeys_as_sequence</code>çš„<code>dictkeys_contains</code>å›è°ƒã€‚åœ¨ä¸Šä¸€è®²<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMTAvMTcvbWVkaXVtcHl0aG9uL2kv" title="https://utmhikari.top/2021/10/17/mediumpython/i/">listå¯å˜ã€tupleä¸å¯å˜<i class="fa fa-external-link"></i></span>ä¸­å·²ç»æåˆ°ï¼Œpythoné‡Œé¢å®ç°å¯¹ç‰¹å®šæ•°æ®çš„å¤šç§æ“ä½œï¼Œå®é™…ä¸Šä¼šå°è¯•å°†æ•°æ®çœ‹æˆsequenceã€mappingç­‰å½¢å¼ï¼Œæ‰§è¡Œå¯¹åº”æ•°æ®å½¢å¼ä¸­å®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œè€Œè¿™é‡Œä¾¿æ˜¯å°†keysçœ‹ä½œæ˜¯sequenceï¼Œæ‰§è¡Œ<code>sq_contains</code>å¯¹åº”çš„å›è°ƒï¼Œè¡¨ç¤ºä¸€ä¸ªæ˜¯å¦åŒ…å«çš„åˆ¤æ–­ã€‚<code>dictkeys_contains</code>å®è´¨ä¸Šè°ƒç”¨çš„æ˜¯dictè‡ªå·±çš„containsæ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´<code>k in d.keys()</code>å’Œ<code>k in d</code>è¿™ä¸¤ç§å†™æ³•ï¼Œå®è´¨ä¸Šæ˜¯ç­‰ä»·çš„</p>
<h3 id="è¿ç®—ç¬¦æ“ä½œ"><a href="#è¿ç®—ç¬¦æ“ä½œ" class="headerlink" title="è¿ç®—ç¬¦æ“ä½œ"></a>è¿ç®—ç¬¦æ“ä½œ</h3><p>dict_keysæ”¯æŒå¤šç§è¿ç®—ç¬¦æ“ä½œã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨å¯¹æ¯”ä½œä¸ºcounterçš„dictæ—¶ï¼ˆä¸æ˜¯å†…ç½®çš„Counterç±»ï¼‰ï¼Œä¼šç”¨keysç›¸å‡çš„æ–¹å¼æ¥å¾—åˆ°ä¸¤æ¬¡ç»Ÿè®¡é‡Œæ–°å¢/åˆ é™¤çš„keyã€‚ç›¸å‡çš„æ“ä½œï¼Œæ¯”å¦‚<code>a.keys() - b.keys()</code>ï¼Œä¼šæ‰§è¡Œå°†keysçœ‹ä½œä¸ºnumberæ—¶çš„<code>dictviews_sub</code>å‡½æ•°ã€‚åœ¨å‡½æ•°å†…éƒ¨çš„å®ç°é‡Œï¼Œä¼šé¦–å…ˆå°†<code>a.keys()</code>è½¬åŒ–ä¸ºä¸€ä¸ªsetï¼Œç„¶åè°ƒç”¨setæ•°æ®ç»“æ„çš„<code>difference_update</code>å‡½æ•°ï¼Œé€æ­¥removeæ‰å³ä¾§<code>b.keys()</code>é‡Œé¢çš„å…ƒç´ ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dictobject.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject*</span><br><span class="line">dictviews_sub(PyObject *self, PyObject *other)</span><br><span class="line">&#123;</span><br><span class="line">    PyObject *result = dictviews_to_set(self);</span><br><span class="line">    <span class="keyword">if</span> (result == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _Py_IDENTIFIER(difference_update);</span><br><span class="line">    PyObject *tmp = _PyObject_CallMethodIdOneArg(</span><br><span class="line">            result, &amp;PyId_difference_update, other);</span><br><span class="line">    <span class="keyword">if</span> (tmp == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        Py_DECREF(result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Py_DECREF(tmp);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>dictviews_sub</code>å†…éƒ¨æŒ‡å®šäº†ä¸€ä¸ªæ ‡è¯†ç¬¦<code>PyId_difference_update</code>ï¼Œé€šè¿‡<code>_PyObject_CallMethodIdOneArg</code>å‡½æ•°å»è°ƒç”¨<code>result</code>å®ä¾‹é‡Œæ ‡è¯†ä¸º<code>PyId_difference_update</code>çš„å‡½æ•°ï¼Œå…¥å‚ä¸º<code>other</code>ã€‚è¿™æ ·è°ƒç”¨æ¥å£çš„æ–¹å¼ï¼Œåœ¨pythoné‡Œç§°ä¹‹ä¸º<span class="exturl" data-url="aHR0cHM6Ly93d3cucHl0aG9uLm9yZy9kZXYvcGVwcy9wZXAtMDU5MC8=" title="https://www.python.org/dev/peps/pep-0590/">vectorcall<i class="fa fa-external-link"></i></span>ï¼Œæ˜¯3.9å®Œå…¨åº”ç”¨çš„cpythonçš„ç‰¹æ€§ï¼Œç›¸å¯¹äºä»¥å‰çš„ç‰ˆæœ¬ï¼Œæ˜¾è‘—ä¼˜åŒ–äº†cpythonå†…éƒ¨ä¸åŒæ•°æ®ç»“æ„é—´å‡½æ•°è°ƒç”¨çš„æ•ˆç‡ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥äº†è§£ã€‚</p>
<p>å¦‚æœæ˜¯ç±»ä¼¼=ã€&gt;ã€&lt;ä¹‹ç±»çš„æ“ä½œï¼Œdict_keysä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>dictview_richcompare</code>å‡½æ•°ä¸­çœ‹åˆ°è¿™äº›æ¯”è¾ƒç¬¦å¯¹åº”çš„è®¡ç®—æ–¹å¼ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// dictobject.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyObject *</span><br><span class="line">dictview_richcompare(PyObject *self, PyObject *other, <span class="keyword">int</span> op)</span><br><span class="line">&#123;</span><br><span class="line">    Py_ssize_t len_self, len_other;</span><br><span class="line">    <span class="keyword">int</span> ok;</span><br><span class="line">    PyObject *result;</span><br><span class="line"></span><br><span class="line">    assert(self != <span class="literal">NULL</span>);</span><br><span class="line">    assert(PyDictViewSet_Check(self));</span><br><span class="line">    assert(other != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!PyAnySet_Check(other) &amp;&amp; !PyDictViewSet_Check(other))</span><br><span class="line">        Py_RETURN_NOTIMPLEMENTED;</span><br><span class="line"></span><br><span class="line">    len_self = PyObject_Size(self);</span><br><span class="line">    <span class="keyword">if</span> (len_self &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    len_other = PyObject_Size(other);</span><br><span class="line">    <span class="keyword">if</span> (len_other &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    ok = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span>(op) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> Py_NE:</span><br><span class="line">    <span class="keyword">case</span> Py_EQ:</span><br><span class="line">        <span class="keyword">if</span> (len_self == len_other)</span><br><span class="line">            ok = all_contained_in(self, other);</span><br><span class="line">        <span class="keyword">if</span> (op == Py_NE &amp;&amp; ok &gt;= <span class="number">0</span>)</span><br><span class="line">            ok = !ok;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> Py_LT:</span><br><span class="line">        <span class="keyword">if</span> (len_self &lt; len_other)</span><br><span class="line">            ok = all_contained_in(self, other);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> Py_LE:</span><br><span class="line">          <span class="keyword">if</span> (len_self &lt;= len_other)</span><br><span class="line">              ok = all_contained_in(self, other);</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> Py_GT:</span><br><span class="line">        <span class="keyword">if</span> (len_self &gt; len_other)</span><br><span class="line">            ok = all_contained_in(other, self);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> Py_GE:</span><br><span class="line">        <span class="keyword">if</span> (len_self &gt;= len_other)</span><br><span class="line">            ok = all_contained_in(other, self);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (ok &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    result = ok ? Py_True : Py_False;</span><br><span class="line">    Py_INCREF(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœä¸¤ä¸ªdictçš„keysç›¸ç­‰ï¼Œåˆ™è¿™ä¸¤ç»„keyséœ€è¦é•¿åº¦ä¸€æ ·ï¼Œå¹¶ä¸”åŒ…å«ç›¸åŒçš„å…ƒç´ ï¼ˆç±»ä¼¼äºsetç›¸ç­‰ï¼‰<br>å¦‚æœæ˜¯æ¯”å¤§å°ï¼Œæ¯”å¦‚<code>a.keys()</code>è¦æ¯”<code>b.keys()</code>å¤§çš„è¯ï¼Œé™¤äº†<code>a.keys()</code>é•¿åº¦æ¯”<code>b.keys()</code>å¤§ä¹‹å¤–ï¼Œè¿˜éœ€è¦<code>a.keys()</code>åŒ…å«<code>b.keys()</code>æ‰€æœ‰çš„å…ƒç´ æ‰è¡Œã€‚æ‰€ä»¥å¤§å°äºå·ä¸»è¦ä½“ç°çš„æ˜¯åŒ…å«/è¢«åŒ…å«çš„å…³ç³»ã€‚</p>
<h2 id="Viewæ¦‚å¿µçš„å…¶å®ƒåº”ç”¨"><a href="#Viewæ¦‚å¿µçš„å…¶å®ƒåº”ç”¨" class="headerlink" title="Viewæ¦‚å¿µçš„å…¶å®ƒåº”ç”¨"></a>Viewæ¦‚å¿µçš„å…¶å®ƒåº”ç”¨</h2><p>åœ¨dicté‡Œï¼Œé™¤äº†<code>keys()</code>ä¹‹å¤–ï¼Œdictçš„<code>values()</code>ã€<code>items()</code>ï¼Œè¿”å›çš„å®é™…ä¸Šä¹Ÿæ˜¯<code>DictView</code>çš„è§†å›¾ç»“æ„ï¼Œå®šä¹‰çš„æ–¹å¼ä¹ŸåŸºæœ¬ä¸Šç›¸ä¼¼ï¼Œä½†ä¹Ÿæœ‰å°‘è®¸åŒºåˆ«ã€‚æ¯”å¦‚<code>values()</code>ï¼Œç”±äºæ²¡æœ‰æŒ‡å®š<code>tp_richcompare</code>ï¼Œæ‰€ä»¥æ— æ³•å°†ä¸¤ç»„<code>values</code>è¿›è¡Œå¤§å°æˆ–==çš„æ¯”è¾ƒï¼ˆéƒ½ä¼šè¿”å›falseï¼‰<br>â€‹</p>
<p>åœ¨pythoné‡Œæœ‰å¾ˆå¤šåœ°æ–¹åº”ç”¨äº†è§†å›¾çš„æ¦‚å¿µ/æ‰‹æ³•ã€‚å¦‚æœç¡¬è¦å¥—Viewè¿™ä¸ªå•è¯çš„è¯ï¼Œå°±è¿˜æœ‰è¿™ä¹ˆä¸€ä¸ªåœ°æ–¹åº”ç”¨åˆ°äº†ï¼Œå«åš<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9jLWFwaS9tZW1vcnl2aWV3Lmh0bWw=" title="https://docs.python.org/zh-cn/3/c-api/memoryview.html">memoryview<i class="fa fa-external-link"></i></span>ã€‚<code>memoryview</code>åœ¨ä¸šåŠ¡ä»£ç ä¸­ä¸å¸¸ç”¨ï¼Œä¸»è¦çš„ä½œç”¨æ˜¯æä¾›ä¸€å—å†…å­˜çš„â€œä»£ç†â€ï¼Œè®©è°ƒç”¨æ–¹å®‰å…¨åœ°å¯¹ä¸€ä¸ªæ•°æ®å®ä¾‹çš„å†…å­˜è¿›è¡Œä¿¡æ¯è¯»å–åŠç®¡ç†æ“ä½œã€‚æ¯”å¦‚æˆ‘ä»¬å¯¹å„ç§æ•°æ®åš<code>pickle.dumps</code>åºåˆ—åŒ–åï¼Œé€šè¿‡<code>memoryview</code>ï¼Œå°±èƒ½çœ‹åˆ°åºåˆ—åŒ–åçš„æ•°æ®åœ¨å†…å­˜é‡Œçš„ç»„æˆï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">memoryview_test</span><span class="params">()</span>:</span></span><br><span class="line">    s = <span class="string">'1234567890'</span></span><br><span class="line">    mem_view = memoryview(pickle.dumps(s))</span><br><span class="line">    print(len(mem_view))</span><br><span class="line">    print([chr(item) <span class="keyword">for</span> item <span class="keyword">in</span> mem_view])</span><br><span class="line">    s = [<span class="string">'1234'</span>, <span class="string">'56'</span>, <span class="string">'7890'</span>]</span><br><span class="line">    mem_view = memoryview(pickle.dumps(s))</span><br><span class="line">    print(len(mem_view))</span><br><span class="line">    print([chr(item) <span class="keyword">for</span> item <span class="keyword">in</span> mem_view])</span><br><span class="line">    s = [<span class="string">'12345'</span>, <span class="string">'67890'</span>]</span><br><span class="line">    mem_view = memoryview(pickle.dumps(s))</span><br><span class="line">    print(len(mem_view))</span><br><span class="line">    print([chr(item) <span class="keyword">for</span> item <span class="keyword">in</span> mem_view])</span><br><span class="line">    </span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">25</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    '\x80', '\x04', '\x95',</span></span><br><span class="line"><span class="string">    '\x0e', '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', '\x8c', '\n',</span></span><br><span class="line"><span class="string">    '1', '2', '3', '4', '5', '6', '7', '8', '9', '0', '\x94', '.'</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">20</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    '\x80', '\x04', '\x95',</span></span><br><span class="line"><span class="string">    '\t', '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', '\x8c', '\x05',</span></span><br><span class="line"><span class="string">    '5', '4', '3', '2', '1', '\x94', '.'</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">35</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    '\x80', '\x04', '\x95', '\x18', </span></span><br><span class="line"><span class="string">    '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', ']', '\x94', '(', </span></span><br><span class="line"><span class="string">    '\x8c', '\x04', '1', '2', '3', '4', </span></span><br><span class="line"><span class="string">    '\x94', '\x8c', '\x02', '5', '6', </span></span><br><span class="line"><span class="string">    '\x94', '\x8c', '\x04', '7', '8', '9', '0', </span></span><br><span class="line"><span class="string">    '\x94', 'e', '.'</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">32</span></span><br><span class="line"><span class="string">[</span></span><br><span class="line"><span class="string">    '\x80', '\x04', '\x95', '\x15', </span></span><br><span class="line"><span class="string">    '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', '\x00', ']', '\x94', '(', </span></span><br><span class="line"><span class="string">    '\x8c', '\x05', '1', '2', '3', '4', '5', </span></span><br><span class="line"><span class="string">    '\x94', '\x8c', '\x05', '6', '7', '8', '9', '0', </span></span><br><span class="line"><span class="string">    '\x94', 'e', '.'</span></span><br><span class="line"><span class="string">]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Medium Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>DictView</tag>
        <tag>dict</tag>
        <tag>C</tag>
        <tag>dict_keys</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘ä¸€ç§è§£å†³redisæºç ç¼–è¯‘æ—¶jemallocæŠ¥No such file or directoryé”™è¯¯çš„æ–¹æ³•</title>
    <url>/2021/10/19/geekdaily/redis_make_jemalloc_error/</url>
    <content><![CDATA[<p>åœ¨ç”¨æºç ç¼–è¯‘redisçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæŠ¥jemallocå‡ºé”™ï¼Œæç¤ºNo such file or directoryçš„é—®é¢˜ï¼Œå¯¼è‡´æ„å»ºä¸èƒ½ç»§ç»­ã€‚ä¸€ç§å¸¸è§çš„ï¼Œåœ¨ç½‘ä¸Šæµä¼ çš„æ–¹æ³•æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNDcwODgxNzEvZXJyb3ItamVtYWxsb2MtamVtYWxsb2MtaC1uby1zdWNoLWZpbGUtb3ItZGlyZWN0b3J5LXdoZW4tbWFraW5nLXJlZGlz" title="https://stackoverflow.com/questions/47088171/error-jemalloc-jemalloc-h-no-such-file-or-directory-when-making-redis">è°ƒæ•´MALLOCå‚æ•°ä¸ºlibc<i class="fa fa-external-link"></i></span>ï¼Œä½†è¿™å¹¶ä¸æ˜¯å”¯ä¸€è§£ï¼Œä¸èƒ½ä¸€æ¦‚è€Œè®ºã€‚</p>
<p>ä»¥ç¬”è€…çš„ä¾‹å­ï¼Œç¬”è€…é‡‡ç”¨windowsè£…CLionå¹¶ç”¨Remote Developmentè¿æ¥linuxè™šæ‹Ÿæœºçš„æ–¹å¼æ¥ç¼–è¯‘redisæºç ï¼Œç‰ˆæœ¬ä¸º6.2.6ï¼Œåœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­ä¹ŸæŠ¥äº†jemallocå‡ºNo such file or directoryçš„é—®é¢˜ã€‚åœ¨ç¬”è€…çš„åœºæ™¯ä¸‹ï¼Œä»”ç»†æŸ¥çœ‹æ—¥å¿—ï¼Œä¼šå‡ºç°è®¸å¤š<code>Permission Denied</code>çš„å­—æ ·ï¼Œè¿™è¯´æ˜æœ‰è®¸å¤šè„šæœ¬æ²¡æœ‰æ‰§è¡Œæƒé™ã€‚ç»è¿‡ä¸€ç•ªç ”ç©¶ï¼Œæ‰§è¡Œä¸‹é¢ä¿©æ“ä½œä¹‹åï¼Œ<code>distclean</code>ä¸€ä¸‹ï¼Œå°±èƒ½æˆåŠŸå†æ¬¡ç¼–è¯‘redisã€‚</p>
<ul>
<li>åœ¨<code>src</code>ç›®å½•ä¸‹ï¼Œ<code>chmod +x ./mkreleasehdr.sh</code>ï¼Œå¢åŠ è¿™ä¸ªè„šæœ¬çš„æ‰§è¡Œæƒé™</li>
<li>åœ¨<code>deps</code>ç›®å½•ä¸‹ï¼Œ<code>chmod -R 777 jemalloc</code>ï¼ŒæŠŠjemallocç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶æƒé™éƒ½æä¸Šæ¥</li>
</ul>
<p>æš‚æ—¶ç ”ç©¶åˆ°çš„æ˜¯è¿™äº›ï¼Œå¦‚æœçœŸæ˜¯å› ä¸ºæƒé™é—®é¢˜ï¼Œä¸”è¿˜æœ‰æ¼ç½‘ä¹‹é±¼çš„è¯ï¼Œæç«¯ä¸€ç‚¹å¯ä»¥æŠŠæ•´ä¸ªredisæºç ç›®å½•æƒé™éƒ½æä¸Šæ¥ã€‚åæ­£éƒ½å¯ä»¥è¯•è¯•çœ‹ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>linux</tag>
        <tag>redis</tag>
        <tag>ç¼–è¯‘</tag>
        <tag>jemalloc</tag>
        <tag>è¿œç¨‹å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Medium Pythonã€‘ç¬¬ä¸€è¯ï¼šä¸ºä»€ä¹ˆlistâ€œå¯å˜â€ï¼Œè€Œtupleâ€œä¸å¯å˜â€ï¼Ÿ</title>
    <url>/2021/10/17/mediumpython/i/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>pythoné¢è¯•æœ‰ä¸€é“å¾ˆåŸºç¡€çš„é—®é¢˜ï¼šlistï¼ˆåˆ—è¡¨ï¼‰å’Œtupleï¼ˆå…ƒç»„ï¼‰æœ‰ä»€ä¹ˆä¸åŒï¼ŸåŸºæœ¬ä¸Šåªè¦èƒŒè¿‡é¢˜åº“çš„åŒå­¦éƒ½çŸ¥é“ï¼Œlistï¼ˆé‡Œé¢çš„å…ƒç´ ï¼‰æ˜¯å¯å˜çš„ï¼Œtupleï¼ˆé‡Œé¢çš„å…ƒç´ ï¼‰æ˜¯ä¸å¯å˜çš„ã€‚</p>
<p>æˆ‘ä»¬å°è¯•åœ¨pythonè§£é‡Šå™¨ä¸­æ”¹å˜tupleçš„å…ƒç´ ï¼ˆèµ‹å¦ä¸€ä¸ªå€¼ï¼‰ï¼Œä¼šæœ‰ä»¥ä¸‹çš„è¡¨ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tuple_check</span><span class="params">()</span>:</span></span><br><span class="line">    tp = (<span class="string">'123'</span>, <span class="number">123</span>)</span><br><span class="line">    tp[<span class="number">1</span>] = <span class="number">13</span></span><br><span class="line">    </span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Traceback (most recent call last):</span></span><br><span class="line"><span class="string">  File "H:/Projects/Python/playground/main.py", line 20, in &lt;module&gt;</span></span><br><span class="line"><span class="string">    tuple_check()</span></span><br><span class="line"><span class="string">  File "H:/Projects/Python/playground/main.py", line 10, in tuple_check</span></span><br><span class="line"><span class="string">    tp[2] = 13</span></span><br><span class="line"><span class="string">TypeError: 'tuple' object does not support item assignment</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°èµ‹å€¼æ“ä½œæŠ¥é”™ï¼Œtupleä¸æ”¯æŒå†æ¬¡èµ‹å€¼ï¼Œä½“ç°äº†å…¶â€œä¸å¯å˜â€çš„ç‰¹æ€§ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸æ”¯æŒèµ‹å€¼/ä¸å¯å˜çš„åŸå› ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿä¸æ˜¯è¯´ä¸æ”¯æŒå°±ä¸æ”¯æŒå§ï¼éš¾é“ä¹Ÿæ²¡æœ‰æ”¯æŒçš„å¯èƒ½ï¼Ÿ</p>
<p>è¿™ä¸ªé—®é¢˜è¦ç»™å‡ºæ¸…æ™°çš„ç­”æ¡ˆå¯å¹¶ä¸å®¹æ˜“ï¼Œå¦‚æœä½ ç›´æ¥æ£€ç´¢ç½‘ä¸Šèµ„æ–™çš„è¯ï¼Œä¼šå‘ç°å¾ˆå¤šæ–‡ç« éƒ½åœ¨è¯´é‡å¤çš„è¯ï¼Œæ²¡æœ‰ä»€ä¹ˆæ·±å…¥çš„æŒ–æ˜ï¼Œå¯¼è‡´è¿™ä¸ªé—®é¢˜æ— ä»è§£é‡Šã€‚äºæ˜¯ï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œå°±ç»™å¤§å®¶æŠŠè¿™ä¸ªé—®é¢˜è®²çš„å¹²è„†ä¸€ç‚¹ã€‚</p>
<p>ä»¥åŠï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« ä¹‹åï¼Œç½‘ä¸Šé‚£äº›è½¦è½±è¾˜è¯å¤§å®¶ä¹Ÿå°±æ²¡æœ‰å¿…è¦å†çœ‹äº†ã€‚</p>
<a id="more"></a>
<h2 id="èµ‹å€¼æ“ä½œçš„æºç åˆ†æ"><a href="#èµ‹å€¼æ“ä½œçš„æºç åˆ†æ" class="headerlink" title="èµ‹å€¼æ“ä½œçš„æºç åˆ†æ"></a>èµ‹å€¼æ“ä½œçš„æºç åˆ†æ</h2><p>ä»å®˜ç½‘çš„<span class="exturl" data-url="aHR0cHM6Ly93d3cucHl0aG9uLm9yZy9kb3dubG9hZHMvc291cmNlLw==" title="https://www.python.org/downloads/source/">Python-Source-Release<i class="fa fa-external-link"></i></span>é¡µé¢ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿä¸‹è½½åˆ°Pythonå„ä¸ªç‰ˆæœ¬çš„æºä»£ç ï¼ˆç¬”è€…ä¸‹è½½äº†3.9.7ï¼‰ã€‚åœ¨æºç çš„<code>PCBuild</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œæœ‰Visual Studioä¸“å±çš„<code>pcbuild.sln</code>é¡¹ç›®æ–‡ä»¶ï¼Œæ‰“å¼€å®ƒå°±èƒ½çœ‹åˆ°pythonå„ä¸ªåº“çš„æºä»£ç çš„é›†åˆï¼Œä»¥åŠå„ç§æ–‡æ¡£å’Œç¼–è¯‘æ„å»ºè„šæœ¬ã€‚å‡†å¤‡å¥½äº†ç¯å¢ƒï¼Œå°±å¯ä»¥å¼€å§‹ç ”ç©¶äº†ã€‚</p>
<p>ä»¥ä¸Šè¿°çš„èµ‹å€¼æ“ä½œä¸ºä¾‹ï¼Œé€šè¿‡æ£€ç´¢<code>object does not support item assignment</code>å­—æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å®šä½åˆ°å¯¹åº”çš„å‡½æ•°ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Objects/abstract.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">PyObject_SetItem(PyObject *o, PyObject *key, PyObject *value)</span><br><span class="line">&#123;</span><br><span class="line">    PyMappingMethods *m;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (o == <span class="literal">NULL</span> || key == <span class="literal">NULL</span> || value == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        null_error();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    m = Py_TYPE(o)-&gt;tp_as_mapping;</span><br><span class="line">    <span class="keyword">if</span> (m &amp;&amp; m-&gt;mp_ass_subscript)</span><br><span class="line">        <span class="keyword">return</span> m-&gt;mp_ass_subscript(o, key, value);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Py_TYPE(o)-&gt;tp_as_sequence) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_PyIndex_Check(key)) &#123;</span><br><span class="line">            Py_ssize_t key_value;</span><br><span class="line">            key_value = PyNumber_AsSsize_t(key, PyExc_IndexError);</span><br><span class="line">            <span class="keyword">if</span> (key_value == <span class="number">-1</span> &amp;&amp; PyErr_Occurred())</span><br><span class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">return</span> PySequence_SetItem(o, key_value, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (Py_TYPE(o)-&gt;tp_as_sequence-&gt;sq_ass_item) &#123;</span><br><span class="line">            type_error(<span class="string">"sequence index must be "</span></span><br><span class="line">                       <span class="string">"integer, not '%.200s'"</span>, key);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    type_error(<span class="string">"'%.200s' object does not support item assignment"</span>, o);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>PyObject_SetItem</code>å‡½æ•°æ¶‰åŠåˆ°<code>PyObject *o</code>ã€<code>PyObject* key</code>ã€<code>PyObject *value</code>ä¸‰ä¸ªå…¥å‚ï¼Œåˆ†åˆ«å¯¹åº”æˆ‘ä»¬çš„tupleå®ä¾‹ã€ç´¢å¼•ä»¥åŠå¾…èµ‹çš„å€¼ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡½æ•°å†…é¦–å…ˆå°è¯•å°†å®ä¾‹oçœ‹ä½œä¸º<code>mapping</code>æˆ–è€…æ˜¯<code>sequence</code>ï¼ˆ<code>tp_as_mapping</code>ã€<code>tp_as_sequence</code>ï¼‰ã€‚å¦‚æœèƒ½ä½œä¸º<code>mapping</code>ï¼Œå°±çœ‹æ˜¯å¦èƒ½æ‰§è¡Œ<code>mp_ass_subscript</code>å›è°ƒå®ç°èµ‹å€¼ï¼›å¦‚æœä½œä¸º<code>sequence</code>ï¼Œä¼šæ£€æŸ¥<code>key</code>å¹¶å°è¯•æ‰§è¡Œ<code>PySequence_SetItem</code>å‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°é‡Œä¹Ÿä¼šå°è¯•æ‰§è¡Œ<code>Py_TYPE(o)-&gt;tp_as_sequence-&gt;sq_ass_item</code>å›è°ƒå®ç°èµ‹å€¼ã€‚<br>â€‹</p>
<p>åœ¨ç ”ç©¶tupleä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹listå®ä¾‹è¿›è¡Œæ–­ç‚¹è°ƒè¯•ï¼Œè¿½è¸ªlistèµ‹å€¼æ“ä½œçš„æ‰§è¡Œé“¾è·¯ã€‚æ–­ç‚¹ç›´æ¥æ–­åœ¨<code>PyObject_SetItem</code>é‡Œé¢å³å¯ï¼Œæµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">lst = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">lst[<span class="number">2</span>] = <span class="number">5</span></span><br></pre></td></tr></table></figure>
<p>ä¸å‡ºæ„å¤–çš„è¯æ‰§è¡Œåˆ°ç¬¬äºŒè¡Œå°±ä¼šåˆ‡åˆ°debugï¼Œä¸€è¡Œä¸€è¡Œä¸‹å»ï¼Œå¯ä»¥çœ‹åˆ°listå®ä¾‹èµ‹å€¼èƒ½å¤Ÿèµ°åˆ°è¿™é‡Œï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">m = Py_TYPE(o)-&gt;tp_as_mapping;</span><br><span class="line">if (m &amp;&amp; m-&gt;mp_ass_subscript)</span><br><span class="line">    return m-&gt;mp_ass_subscript(o, key, value);</span><br></pre></td></tr></table></figure>
<p>step intoè¿›å»ï¼Œå¯ä»¥çœ‹åˆ°listå®ä¾‹ä½œä¸º<code>mapping</code>çš„<code>mp_ass_subscript</code>å›è°ƒï¼Œå¯¹åº”çš„æ˜¯<code>list_ass_subscript</code>å‡½æ•°:</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Objects/listobject.c</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">list_ass_subscript(PyListObject* self, PyObject* item, PyObject* value)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_PyIndex_Check(item)) &#123;</span><br><span class="line">        Py_ssize_t i = PyNumber_AsSsize_t(item, PyExc_IndexError);</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">-1</span> &amp;&amp; PyErr_Occurred())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span>)</span><br><span class="line">            i += PyList_GET_SIZE(self);</span><br><span class="line">        <span class="keyword">return</span> list_ass_item(self, i, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (PySlice_Check(item)) &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæ˜¯å¯¹åˆ‡ç‰‡èµ‹å€¼ï¼Œ[a:b]è¿™ç§ã€‚å¤ªé•¿äº†å…ˆå¿½ç•¥æ‰= =</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        PyErr_Format(PyExc_TypeError,</span><br><span class="line">                     <span class="string">"list indices must be integers or slices, not %.200s"</span>,</span><br><span class="line">                     Py_TYPE(item)-&gt;tp_name);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">list_ass_item(PyListObject *a, Py_ssize_t i, PyObject *v)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!valid_index(i, Py_SIZE(a))) &#123;</span><br><span class="line">        PyErr_SetString(PyExc_IndexError,</span><br><span class="line">                        <span class="string">"list assignment index out of range"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (v == <span class="literal">NULL</span>)</span><br><span class="line">        <span class="keyword">return</span> list_ass_slice(a, i, i+<span class="number">1</span>, v);</span><br><span class="line">    Py_INCREF(v);</span><br><span class="line">    Py_SETREF(a-&gt;ob_item[i], v);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>list_ass_subscript</code>å‡½æ•°ä¼šåˆ¤æ–­ç´¢å¼•<code>key</code>çš„åˆæ³•æ€§å¹¶è½¬æ¢è´Ÿå€¼ç´¢å¼•ï¼Œç„¶åè°ƒç”¨<code>list_ass_item</code>å¤„ç†èµ‹å€¼æ“ä½œã€‚<code>list_ass_item</code>ä¹Ÿä¼šå†æ¬¡æ£€æŸ¥ç´¢å¼•è¾¹ç•Œï¼Œç„¶ååœ¨listå®ä¾‹å¯¹åº”ç´¢å¼•çš„ä½ç½®èµ‹æ–°å€¼ï¼Œå¹¶è°ƒæ•´å¼•ç”¨è®¡æ•°ã€‚è¿™æ ·ï¼Œlistèµ‹å€¼æ“ä½œå°±å®Œæˆäº†ã€‚</p>
<h2 id="tupleä¸ºä»€ä¹ˆä¸å¯å˜"><a href="#tupleä¸ºä»€ä¹ˆä¸å¯å˜" class="headerlink" title="tupleä¸ºä»€ä¹ˆä¸å¯å˜"></a>tupleä¸ºä»€ä¹ˆä¸å¯å˜</h2><p>listå¯ä»¥å¯¹å…¶ä¸­çš„å…ƒç´ èµ‹å€¼ï¼Œtupleä¸è¡Œã€‚ä»æºç çš„è§’åº¦ï¼Œlistèƒ½å¤Ÿä½œä¸º<code>mapping</code>ï¼Œæœ‰<code>list_ass_subscript</code>å‡½æ•°ç”¨äºå¯¹å…ƒç´ èµ‹å€¼ï¼Œé‚£tupleå‘¢ï¼Ÿæˆ‘ä»¬åŒæ ·å¯ä»¥æ–­tupleçš„èµ‹å€¼æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆè¿˜æ˜¯è½åˆ°<code>PyObject_SetItem</code>çš„â€œ<code>object does not support item assignment</code>â€ä¸€è¡Œ<br>â€‹</p>
<p>æ‰“å¼€listè¿™ä¸ªç±»åœ¨Cå±‚çš„æºä»£ç ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°listè¿™ä¸ªæ•°æ®ç±»å‹çš„å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Objects/listobject.c</span></span><br><span class="line"></span><br><span class="line">PyTypeObject PyList_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"list"</span>,</span><br><span class="line">    <span class="keyword">sizeof</span>(PyListObject),</span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    (destructor)list_dealloc,                   <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_vectorcall_offset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_async */</span></span><br><span class="line">    (reprfunc)list_repr,                        <span class="comment">/* tp_repr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_number */</span></span><br><span class="line">    &amp;list_as_sequence,                          <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    &amp;list_as_mapping,                           <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    PyObject_HashNotImplemented,                <span class="comment">/* tp_hash */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_call */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_str */</span></span><br><span class="line">    PyObject_GenericGetAttr,                    <span class="comment">/* tp_getattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_buffer */</span></span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC |</span><br><span class="line">        Py_TPFLAGS_BASETYPE | Py_TPFLAGS_LIST_SUBCLASS, <span class="comment">/* tp_flags */</span></span><br><span class="line">    list___init____doc__,                       <span class="comment">/* tp_doc */</span></span><br><span class="line">    (traverseproc)list_traverse,                <span class="comment">/* tp_traverse */</span></span><br><span class="line">    (inquiry)_list_clear,                       <span class="comment">/* tp_clear */</span></span><br><span class="line">    list_richcompare,                           <span class="comment">/* tp_richcompare */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_weaklistoffset */</span></span><br><span class="line">    list_iter,                                  <span class="comment">/* tp_iter */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iternext */</span></span><br><span class="line">    list_methods,                               <span class="comment">/* tp_methods */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_members */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_base */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dict */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_get */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_set */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dictoffset */</span></span><br><span class="line">    (initproc)list___init__,                    <span class="comment">/* tp_init */</span></span><br><span class="line">    PyType_GenericAlloc,                        <span class="comment">/* tp_alloc */</span></span><br><span class="line">    PyType_GenericNew,                          <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_GC_Del,                            <span class="comment">/* tp_free */</span></span><br><span class="line">    .tp_vectorcall = list_vectorcall,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyMappingMethods list_as_mapping = &#123;</span><br><span class="line">    (lenfunc)list_length,</span><br><span class="line">    (binaryfunc)list_subscript,</span><br><span class="line">    (objobjargproc)list_ass_subscript</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">    lenfunc mp_length;</span><br><span class="line">    binaryfunc mp_subscript;</span><br><span class="line">    objobjargproc mp_ass_subscript;</span><br><span class="line">&#125; PyMappingMethods;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨listç±»å‹å®šä¹‰ä¸­ï¼Œ<code>tp_as_mapping-&gt;list_as_mapping</code>å·²ç»åŒ…å«äº†<code>PyMappingMethods</code>æ‰€å®šä¹‰çš„<code>mp_length</code>ã€<code>mp_subscript</code>ä»¥åŠ<code>mp_ass_subscript</code>ä¸‰ä¸ªå›è°ƒï¼Œè€Œæœ€åä¸€ä¸ªå°±æ˜¯èµ‹å€¼æ“ä½œæ‰€å¯¹åº”çš„å›è°ƒã€‚åè§‚tupleçš„ç±»å‹å®šä¹‰ï¼Œè¿™ä¸€å—æ˜¯ç¼ºå¤±çš„ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Objects/tupleobject.c</span></span><br><span class="line"></span><br><span class="line">PyTypeObject PyTuple_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">"tuple"</span>,</span><br><span class="line">    <span class="keyword">sizeof</span>(PyTupleObject) - <span class="keyword">sizeof</span>(PyObject *),</span><br><span class="line">    <span class="keyword">sizeof</span>(PyObject *),</span><br><span class="line">    (destructor)tupledealloc,                   <span class="comment">/* tp_dealloc */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_vectorcall_offset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_async */</span></span><br><span class="line">    (reprfunc)tuplerepr,                        <span class="comment">/* tp_repr */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_number */</span></span><br><span class="line">    &amp;tuple_as_sequence,                         <span class="comment">/* tp_as_sequence */</span></span><br><span class="line">    &amp;tuple_as_mapping,                          <span class="comment">/* tp_as_mapping */</span></span><br><span class="line">    (hashfunc)tuplehash,                        <span class="comment">/* tp_hash */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_call */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_str */</span></span><br><span class="line">    PyObject_GenericGetAttr,                    <span class="comment">/* tp_getattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_setattro */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_as_buffer */</span></span><br><span class="line">    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC |</span><br><span class="line">        Py_TPFLAGS_BASETYPE | Py_TPFLAGS_TUPLE_SUBCLASS, <span class="comment">/* tp_flags */</span></span><br><span class="line">    tuple_new__doc__,                           <span class="comment">/* tp_doc */</span></span><br><span class="line">    (traverseproc)tupletraverse,                <span class="comment">/* tp_traverse */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_clear */</span></span><br><span class="line">    tuplerichcompare,                           <span class="comment">/* tp_richcompare */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_weaklistoffset */</span></span><br><span class="line">    tuple_iter,                                 <span class="comment">/* tp_iter */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_iternext */</span></span><br><span class="line">    tuple_methods,                              <span class="comment">/* tp_methods */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_members */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_getset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_base */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dict */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_get */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_descr_set */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_dictoffset */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_init */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* tp_alloc */</span></span><br><span class="line">    tuple_new,                                  <span class="comment">/* tp_new */</span></span><br><span class="line">    PyObject_GC_Del,                            <span class="comment">/* tp_free */</span></span><br><span class="line">    .tp_vectorcall = tuple_vectorcall,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PySequenceMethods tuple_as_sequence = &#123;</span><br><span class="line">    (lenfunc)tuplelength,                       <span class="comment">/* sq_length */</span></span><br><span class="line">    (binaryfunc)tupleconcat,                    <span class="comment">/* sq_concat */</span></span><br><span class="line">    (ssizeargfunc)tuplerepeat,                  <span class="comment">/* sq_repeat */</span></span><br><span class="line">    (ssizeargfunc)tupleitem,                    <span class="comment">/* sq_item */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* sq_slice */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* sq_ass_item */</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">/* sq_ass_slice */</span></span><br><span class="line">    (objobjproc)tuplecontains,                  <span class="comment">/* sq_contains */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyMappingMethods tuple_as_mapping = &#123;</span><br><span class="line">    (lenfunc)tuplelength,</span><br><span class="line">    (binaryfunc)tuplesubscript,</span><br><span class="line">    <span class="number">0</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>PyMappingMethods</code>ä¸­ï¼Œtupleä½œä¸º<code>mapping</code>æ²¡æœ‰æŒ‡å®š<code>mp_ass_subscript</code>ï¼Œä½œä¸º<code>sequence</code>ä¹Ÿæ²¡æœ‰æŒ‡å®š<code>sq_ass_item</code>ã€<code>sq_ass_slice</code>ã€‚æ‰€ä»¥è‡ªç„¶è€Œç„¶ï¼ŒåŸç”Ÿä¸æ”¯æŒèµ‹å€¼æ“ä½œ<br>â€‹</p>
<p>æ‰€ä»¥ï¼Œlistå…ƒç´ å¯å˜è€Œtupleå…ƒç´ ä¸å¯å˜ï¼Œè¦è§£é‡Šè¿™ä¸ªé—®é¢˜å¯ä»¥è¿™æ ·é˜è¿°ï¼š<strong>tupleä½œä¸º<code>mapping</code>æˆ–è€…<code>sequence</code>ï¼Œæ²¡æœ‰æŒ‡å®šèµ‹å€¼æ“ä½œçš„å›è°ƒå‡½æ•°ï¼Œæ‰€ä»¥å…¶å…ƒç´ ä¸å¯å˜ã€‚è€Œlistæœ‰å¯¹åº”çš„æ“ä½œå›è°ƒæ”¯æŒï¼Œæ‰€ä»¥å¯å˜ã€‚</strong><br>â€‹</p>
<h2 id="tupleçš„å…ƒç´ èƒ½å¤Ÿâ€œå¯å˜â€å—ï¼Ÿ"><a href="#tupleçš„å…ƒç´ èƒ½å¤Ÿâ€œå¯å˜â€å—ï¼Ÿ" class="headerlink" title="tupleçš„å…ƒç´ èƒ½å¤Ÿâ€œå¯å˜â€å—ï¼Ÿ"></a>tupleçš„å…ƒç´ èƒ½å¤Ÿâ€œå¯å˜â€å—ï¼Ÿ</h2><p>å½“ç„¶å¯ä»¥ï¼Œä½†æ˜¯éœ€è¦é­”æ”¹Pythonæºä»£ç ã€‚æˆ‘ä»¬å¯ä»¥ä»¿å†™<code>list_ass_subscript</code>å»å®ç°tupleçš„èµ‹å€¼æ“ä½œã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Objects/tupleobject.c</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// =========================== ä»¥ä¸‹æ˜¯é­”æ”¹ä»£ç  =============================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">tuple_ass_item(PyTupleObject* a, Py_ssize_t i, PyObject* v)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!((<span class="keyword">size_t</span>)i &lt; (<span class="keyword">size_t</span>)Py_SIZE(a)))</span><br><span class="line">    &#123;</span><br><span class="line">        PyErr_SetString(PyExc_IndexError,</span><br><span class="line">            <span class="string">"tuple assignment index out of range"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (v == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        PyErr_SetString(PyExc_IndexError,</span><br><span class="line">            <span class="string">"tuple assignment does not support null value"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Py_INCREF(v);</span><br><span class="line">    Py_SETREF(a-&gt;ob_item[i], v);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">tuple_ass_subscript(PyTupleObject* self, PyObject* item, PyObject* value)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_PyIndex_Check(item))</span><br><span class="line">    &#123;</span><br><span class="line">        Py_ssize_t i = PyNumber_AsSsize_t(item, PyExc_IndexError);</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">-1</span> &amp;&amp; PyErr_Occurred())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            i += PyTuple_GET_SIZE(self);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tuple_ass_item(self, i, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        PyErr_Format(PyExc_TypeError,</span><br><span class="line">            <span class="string">"tuple index must be integer! not %.200s"</span>,</span><br><span class="line">            Py_TYPE(item)-&gt;tp_name);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// =========================== ä»¥ä¸Šæ˜¯é­”æ”¹ä»£ç  =============================</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyMappingMethods tuple_as_mapping = &#123;</span><br><span class="line">    (lenfunc)tuplelength,</span><br><span class="line">    (binaryfunc)tuplesubscript,</span><br><span class="line">    <span class="comment">// 0</span></span><br><span class="line">    (objobjargproc)tuple_ass_subscript  <span class="comment">// è¿™é‡ŒåŸæ¥æ˜¯0ï¼Œç°åœ¨å¾—æ˜¯tuple_ass_subscript</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å°±åŠ ä¸Štupleä½œä¸º<code>mapping</code>æ—¶å€™çš„èµ‹å€¼æ“ä½œå³å¯ï¼Œä»£ç é€»è¾‘ä¹Ÿå’Œlistçš„åŸºæœ¬ä¸€æ ·ã€‚ç¼–è¯‘æ–°çš„pythonè¯•è¯•çœ‹å§</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">tp = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">tp[<span class="number">2</span>] = <span class="number">5</span></span><br><span class="line">print(tp)  <span class="comment"># (1, 2, 5)</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Medium Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>list</tag>
        <tag>tuple</tag>
        <tag>å…ƒç»„</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Medium Pythonã€‘å‰è¨€</title>
    <url>/2021/10/10/mediumpython/preface/</url>
    <content><![CDATA[<p>pythonä½œä¸ºæœ€æµè¡Œçš„è¯­è¨€ä¹‹ä¸€ï¼Œæˆ‘ä»¬å¯¹pythonçš„è®¤çŸ¥åˆ°åº•æœ‰å¤šå°‘å‘¢ï¼Ÿå¤§èƒ†çŒœæµ‹ï¼Œ95%çš„åŒå­¦å¯¹pythonçš„äº†è§£éƒ½ä¸è¶…è¿‡5%å§ï¼ä¸ç”¨è¯´pythonçš„cæºç äº†ï¼Œå°±ç®—æ˜¯pythonæ¯ä¸ªæ ‡å‡†åº“çš„.pyæºç ï¼Œéƒ½æœ‰å¾ˆå°‘äººå»å…³å¿ƒã€‚ç»“è®ºå°±æ˜¯ï¼Œæˆ‘ä»¬å¯¹pythonæœ¬èº«çš„ç†è§£æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œæ¯”æƒ³è±¡ä¸­è¿˜ä¸å¤Ÿï¼å½“ç„¶ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯pythonçš„è¯­è¨€ç‰¹æ€§å¯¼è‡´çš„å§ï¼Œåœ¨è®¾è®¡æ–¹é¢å°±ä¸éœ€è¦æˆ‘ä»¬å»å¤šæƒ³ã€‚</p>
<p>pythonçš„å²—ä½ä¼—å¤šï¼Œç½‘ä¸Šçš„æ•™æè·Ÿé¢è¯•é¢˜ä¹Ÿå¾ˆå¤šï¼Œç„¶è€Œå¾ˆå¤šéƒ½æ˜¯å…«è‚¡æ–‡ï¼Œæµ…å°è¾„æ­¢ï¼Œé²œæœ‰æ·±åº¦çš„æŒ–æ˜ï¼Œè®©äººçŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œå¤„å¤„é€éœ²ç€å¯¹æŠ€æœ¯çš„ä¸æ•¬ï¼æƒ³æƒ³çœ‹ï¼Œæ¸¸æˆç¨‹åºå‘˜å­¦luaï¼Œä¸€äº›C Libraryçš„å®ç°ã€Luaåº•å±‚æœºç†éƒ½éœ€è¦ç†Ÿæ‚‰ï¼Œpythonæ¯”luaåº”ç”¨ä¼šæ›´åŠ å¹¿æ³›ï¼Œä¸ºä»€ä¹ˆå°±ä¸å¯ä»¥å»ç†Ÿæ‚‰ç±»ä¼¼çš„ä¸œè¥¿å‘¢ï¼Ÿpythonçš„åº”ç”¨åœºæ™¯é‚£ä¹ˆå¤šï¼Œä¸å»æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€çš„å®ç°ï¼Œæ€ä¹ˆèƒ½å¤Ÿæ›´å¥½æŒæ§è¿™é—¨è¯­è¨€ï¼Ÿæ€ä¹ˆå¯èƒ½åšå‡ºæ›´åŠ ä¼˜ç§€çš„äº§å“ï¼Ÿ</p>
<p>å› æ­¤ç¬”è€…å†³å®šï¼Œä»ä¸€äº›æ‰€è°“çš„pythoné¢è¯•é¢˜å‡ºå‘ï¼Œé€šè¿‡æºç åˆ†æçš„æ–¹æ³•ï¼ŒæŒ–æ˜å…¶æ€è·¯ä¸å®ç°ï¼Œè®©æ›´å¤šäººå¯¹pythonæœ‰æ›´åŠ æ·±å…¥çš„äº†è§£ã€‚è¿™ä¸ªç³»åˆ—ï¼Œä¼šæŠŠä¸€äº›æœ¬è¯¥å±äºpythonæ•™ç¨‹é‡Œçš„ä¸œè¥¿ç»™å±•ç°å‡ºæ¥ï¼Œå–åå°±å«åšMedium Pythonâ€”â€”å› ä¸ºç¬”è€…åˆšå‡ºé“ï¼ˆè°ˆæ‹çˆ±ï¼‰æ—¶ï¼Œå·²ç»å†™è¿‡<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wL2NhdGVnb3JpZXMvRWFzeS1QeXRob24v" title="https://utmhikari.top/categories/Easy-Python/">Easy Python<i class="fa fa-external-link"></i></span>ï¼Œé‡Œé¢ç½—åˆ—äº†äº›pythonçš„ç®€å•çŸ¥è¯†ã€‚è‡³äºæœªæ¥æœ‰æ²¡æœ‰Hard Pythonï¼Œåˆ°æ—¶å€™å†è¯´å§ï¼</p>
<h2 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h2><ul>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMTAvMTcvbWVkaXVtcHl0aG9uL2kv" title="https://utmhikari.top/2021/10/17/mediumpython/i/">ã€Medium Pythonã€‘ç¬¬ä¸€è¯ï¼šä¸ºä»€ä¹ˆlistâ€œå¯å˜â€ï¼Œè€Œtupleâ€œä¸å¯å˜â€ï¼Ÿ<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMTAvMjMvbWVkaXVtcHl0aG9uL2lpLw==" title="https://utmhikari.top/2021/10/23/mediumpython/ii/">ã€Medium Pythonã€‘ç¬¬äºŒè¯ï¼šdictçš„keys()è¿”å›äº†ä»€ä¹ˆæ•°æ®ç±»å‹ï¼Ÿ<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMTAvMzAvbWVkaXVtcHl0aG9uL2lpaS8=" title="https://utmhikari.top/2021/10/30/mediumpython/iii/">ã€Medium Pythonã€‘ç¬¬ä¸‰è¯ï¼špythonå¤šçº¿ç¨‹ä¸ºä»€ä¹ˆä¸èƒ½å¹¶è¡Œï¼Ÿ<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMTEvMDYvbWVkaXVtcHl0aG9uL2l2Lw==" title="https://utmhikari.top/2021/11/06/mediumpython/iv/">ã€Medium Pythonã€‘ç¬¬å››è¯ï¼šç±»å±æ€§å’Œå®ä¾‹å±æ€§æ˜¯æ€æ ·çš„å…³ç³»ï¼Ÿ<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMTEvMTMvbWVkaXVtcHl0aG9uL3Yv" title="https://utmhikari.top/2021/11/13/mediumpython/v/">ã€Medium Pythonã€‘æœ€ç»ˆè¯ï¼šå¦‚ä½•å½»åº•ç†è§£withå…³é”®å­—çš„ç”¨æ³•ï¼Ÿ<i class="fa fa-external-link"></i></span></li>
</ul>
]]></content>
      <categories>
        <category>Medium Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>é¢è¯•</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>Easy Python</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘å¦‚ä½•è®¿é—®ç±»å®ä¾‹é‡Œå¸¦åŒä¸‹åˆ’çº¿çš„å±æ€§</title>
    <url>/2021/10/06/pythonnotes/attr_with_underscore/</url>
    <content><![CDATA[<p>å­¦è¿‡pythonçš„æˆ‘ä»¬éƒ½çŸ¥é“åœ¨pythonçš„ç±»å®ä¾‹instanceçš„<code>__init__</code>å‡½æ•°é‡Œï¼Œå¯ä»¥åˆå§‹åŒ–è¿™ä¸ªinstanceçš„å±æ€§ã€‚å±æ€§çš„å‘½åæœ‰è®¸å¤šç§ï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, gender, age)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self._gender = gender</span><br><span class="line">        self.__age = age</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸‰ç§å±æ€§ååˆ†åˆ«æ˜¯ï¼šä¸å¸¦ä¸‹åˆ’çº¿ã€å¸¦ä¸€ä¸ªä¸‹åˆ’çº¿ã€å¸¦ä¸¤ä¸ªä¸‹åˆ’çº¿</p>
<p>å‡è®¾æœ‰ä¸€ä¸ªç±»<code>Student</code>çš„å®ä¾‹<code>student</code>ï¼Œæˆ‘ä»¬é€šè¿‡è®¿é—®<code>student.name</code>ã€<code>student._gender</code>ï¼Œæ˜¯èƒ½å¤Ÿè·å¾—å¯¹åº”å±æ€§å€¼çš„ï¼Œä½†è®¿é—®<code>student.__age</code>å´æŠ¥äº†å¦‚ä¸‹é”™è¯¯ï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">AttributeError: &apos;Student&apos; object has no attribute &apos;__age&apos;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿéš¾é“åœ¨å¤–é¢å°±ä¸èƒ½è®¿é—®è¿™ä¸ª<code>__age</code>å±æ€§äº†å—ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œè¦åšåˆ°è®¿é—®<code>__age</code>å±æ€§ï¼Œæœ€ç¬¦åˆç¼–ç¨‹æ„å›¾çš„æ–¹æ³•å°±æ˜¯åŠ ä¸€ä¸ªä¸<code>age</code>å…³è”çš„<code>property</code>æ¥è®¿é—®ã€‚ä½†æœ¬æ–‡ä¸é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œæœ¬æ–‡æä¾›ä¸€ä¸ªç›´æ¥è®¿é—®<code>__age</code>å±æ€§çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æ‰“å°<code>student.__dict__</code>ï¼Œæ¥æŸ¥çœ‹<code>student</code>å®ä¾‹çš„å±æ€§è¡¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&apos;name&apos;: &apos;haha&apos;, &apos;_gender&apos;: &apos;male&apos;, &apos;_Student__age&apos;: 12&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œå±æ€§è¡¨é‡Œæ²¡æœ‰<code>__age</code>å±æ€§ï¼Œè€Œå¤šäº†ä¸€ä¸ª<code>_Student__age</code>å±æ€§ã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨ä»£ç ç¼–è¯‘å™¨æœŸæœ‰<code>name mangling</code>æœºåˆ¶ï¼Œç”¨ä¸­æ–‡ç¿»è¯‘å«åšâ€œå‘½åæ··æ·†â€æ¯”è¾ƒè´´åˆ‡ï¼Œpythonç¼–è¯‘å™¨è¯†åˆ«äº†å¸¦åŒä¸‹åˆ’çº¿çš„ç±»å®ä¾‹å±æ€§ï¼Œå°±ä¼šåœ¨å‰é¢åŠ ä¸€ä¸ªä¸‹åˆ’çº¿+ç±»åçš„å‰ç¼€ï¼Œäºæ˜¯å±æ€§åå°±å˜æˆäº†<code>_Student__age</code>ã€‚</p>
<p>é€šè¿‡è®¿é—®<code>student._Student__age</code>ï¼Œæˆ‘ä»¬å°±èƒ½å¾—åˆ°<code>__age</code>å±æ€§äº†ã€‚è¿™ä¾¿æ˜¯ç›´æ¥è®¿é—®åŒä¸‹åˆ’çº¿å±æ€§çš„æ–¹æ³•ã€‚</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>ç¼–è¯‘</tag>
        <tag>ç±»</tag>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>ä¸‹åˆ’çº¿</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘ç”¨C++ç¼–å†™Pythonçš„æ‰©å±•æ¨¡å—</title>
    <url>/2021/10/05/pythonnotes/python_c_extension/</url>
    <content><![CDATA[<p>è¿‘æœŸç¬”è€…åœ¨ç ”ç©¶pythonå†…éƒ¨éƒ¨åˆ†æ¨¡å—çš„å®ç°æœºç†ï¼Œç ”ç©¶ç€ç ”ç©¶ç€å°±å¼€å§‹ç¡¬åˆšCæºç äº†ã€‚æƒ³ç€å…ˆå‰å·¥ä½œæˆ–æ˜¯æ—¥å¸¸ä¹Ÿæ²¡æœ‰ä½“éªŒè¿‡ç”¨C++ç¼–å†™pythonåº“ï¼Œäºæ˜¯å°±åˆšå¥½å­¦ä¹ äº†ä¸€ä¸‹ã€‚</p>
<p>ç”¨Cæˆ–è€…C++ç¼–å†™pythonçš„æ‰©å±•åº“ï¼Œå»ºè®®ç”¨Visual Studioå®‡å®™ç¬¬ä¸€IDEï¼Œä¸€æ¥èƒ½å¤ŸåŒæ—¶æ”¯æŒpythonè·ŸCï¼ŒäºŒæ¥è°ƒè¯•åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚å…¥é—¨ä¸Šæ‰‹çš„è¯ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡æ¡£ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy9leHRlbmRpbmcvaW5kZXguaHRtbA==" title="https://docs.python.org/zh-cn/3/extending/index.html">å®˜ç½‘æ–‡æ¡£ï¼šæ‰©å±•å’ŒåµŒå…¥ Python è§£é‡Šå™¨<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvdmlzdWFsc3R1ZGlvL3B5dGhvbi93b3JraW5nLXdpdGgtYy1jcHAtcHl0aG9uLWluLXZpc3VhbC1zdHVkaW8/dmlldz12cy0yMDE5" title="https://docs.microsoft.com/en-us/visualstudio/python/working-with-c-cpp-python-in-visual-studio?view=vs-2019">VSæ–‡æ¡£ï¼šCreate a C++ extension for Python<i class="fa fa-external-link"></i></span></li>
</ul>
<p>ç¼–å†™çš„åº“å«åš<code>cplayground</code>ï¼ŒåªåŒ…å«ä¸€ä¸ªhackå‡½æ•°<code>tuple_setitem</code>â€”â€”å¼ºè¡Œè®¾ç½®tupleçš„å…ƒç´ ï¼ˆpythoné»˜è®¤æ˜¯ä¸æ”¯æŒçš„ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥æ¥çœ‹è¿™æ ·çš„pythonæ‰©å±•ç”¨C++è¯¥å¦‚ä½•å®ç°ï¼š</p>
<a id="more"></a>
<p>é¦–å…ˆå‚è€ƒä¸Šé¢çš„VSæ–‡æ¡£<code>Create a C++ extension for Python</code>ï¼Œéƒ¨ç½²åŸºç¡€ç¯å¢ƒï¼Œä¸€ä¸ªSolutioné‡Œéœ€è¦åŒ…å«ç”¨äºæµ‹è¯•çš„Python Projectä»¥åŠç”¨æ¥ç¼–å†™æ‰©å±•çš„C++ Projectã€‚ç¯å¢ƒéƒ¨ç½²æœ‰å‡ ä¸ªè¦ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>ç”±äºæ˜¯ç¼–å†™æ‰©å±•ï¼Œéœ€è¦ç¼–è¯‘ä¸ºdllï¼Œæ–‡ä»¶åç¼€åä¸º.pyd</li>
<li>ç¡®è®¤ä¸‹libsæœ‰æ²¡æœ‰debugåº“ï¼Œæ²¡æœ‰çš„è¯Preprocessorè·ŸCode Generationçš„è®¾ç½®éƒ½ä¸èƒ½å¸¦debug</li>
<li>pythoné¡¹ç›®çš„Debugè®¾ç½®é‡Œï¼Œè§£é‡Šå™¨å‚æ•°åŠ ä¸Š<code>-i</code>ï¼Œä¸”å¯ç”¨native code debuggingï¼Œè¿™æ ·æ‰èƒ½åœ¨pythonè·Ÿcä»£ç æ‰“æ–­ç‚¹è°ƒè¯•</li>
<li>å¯ä»¥å†™ä¸€ä¸ªæœ€ç®€çš„æ¡†æ¶å…ˆå°è¯•buildæˆåŠŸï¼Œå¹¶ä¸”èƒ½é¡ºåˆ©è£…åˆ°å¯¹åº”pythonçš„packagesé‡Œï¼Œè·‘é€šæ•´ä¸ªæµç¨‹å…ˆ<ul>
<li><code>setup.py</code>ä¸­æ³¨æ„æ¨¡å—åå­—è¦å…¨éƒ¨å¯¹åº”ä¸Š</li>
</ul>
</li>
</ul>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œå¦‚æœVSæ²¡æœ‰é¢„è£…pythonå‘è¡Œç‰ˆæœ¬ï¼ŒVSè‡ªå¸¦çš„pythonç¯å¢ƒç®¡ç†æ¨¡å—ä¹Ÿèƒ½æ£€æµ‹åˆ°ä½ ä»¥å‰å¦å¤–å®‰è£…çš„pythonï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒpythonç¯å¢ƒæ–¹é¢çš„é—®é¢˜ã€‚</p>
<p>æ­å¥½æ•´ä¸ªæ¡†æ¶æµç¨‹ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å®ç°<code>tuple_setitem</code>å…·ä½“çš„é€»è¾‘äº†ã€‚æ•´ä¸ªcppä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// cplayground.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PY_SSIZE_T_CLEAN</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Python.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* tuple_setitem: a hack method to set item of tuple */</span></span><br><span class="line">PyObject*</span><br><span class="line">tuple_setitem(PyObject* self, PyObject* args)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// parse args</span></span><br><span class="line">    PyObject *tuple, *value;</span><br><span class="line">    <span class="keyword">int</span> idx;</span><br><span class="line">    <span class="keyword">if</span> (!PyArg_ParseTuple(args, <span class="string">"OiO"</span>, &amp;tuple, &amp;idx, &amp;value))</span><br><span class="line">    &#123;</span><br><span class="line">        Py_RETURN_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// check tuple</span></span><br><span class="line">    <span class="keyword">if</span> (!PyTuple_Check(tuple))</span><br><span class="line">    &#123;</span><br><span class="line">        PyErr_Format(</span><br><span class="line">            PyExc_TypeError,</span><br><span class="line">            <span class="string">"invalid tuple, %.200s"</span>,</span><br><span class="line">            Py_TYPE(tuple)-&gt;tp_name</span><br><span class="line">        );</span><br><span class="line">        Py_RETURN_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line">    PyTupleObject* tp = (PyTupleObject*)tuple;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// handle index below zero</span></span><br><span class="line">    <span class="keyword">if</span> (idx &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        idx += PyTuple_GET_SIZE(tp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// check index range</span></span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">size_t</span>)idx &gt;= (<span class="keyword">size_t</span>)Py_SIZE(tp))</span><br><span class="line">    &#123;</span><br><span class="line">        PyErr_SetString(</span><br><span class="line">            PyExc_IndexError,</span><br><span class="line">            <span class="string">"tuple index out of range"</span></span><br><span class="line">        );</span><br><span class="line">        Py_RETURN_FALSE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set value by index</span></span><br><span class="line">    Py_INCREF(value);</span><br><span class="line">    Py_SETREF(tp-&gt;ob_item[idx], value);</span><br><span class="line">    Py_RETURN_TRUE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyMethodDef cplayground_methods[] = &#123;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"tuple_setitem"</span>,</span><br><span class="line">        (PyCFunction)tuple_setitem,</span><br><span class="line">        METH_VARARGS,</span><br><span class="line">        <span class="string">"a hack method to set value in tuple"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; <span class="literal">nullptr</span>, <span class="literal">nullptr</span>, <span class="number">0</span>, <span class="literal">nullptr</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> PyModuleDef cplayground_module = &#123;</span><br><span class="line">    PyModuleDef_HEAD_INIT,</span><br><span class="line">    <span class="string">"cplayground"</span>,  <span class="comment">// module name</span></span><br><span class="line">    <span class="string">"a c-python extension for testing"</span>,  <span class="comment">// module desc</span></span><br><span class="line">    <span class="number">0</span>,</span><br><span class="line">    cplayground_methods</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">PyMODINIT_FUNC</span><br><span class="line">PyInit_cplayground()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> PyModule_Create(&amp;cplayground_module);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¨¡å—çš„cppå®ç°ä¸­ï¼Œé¡¶å¤´å¿…é¡»è¦<code>#include &lt;Python.h&gt;</code>ï¼Œä¹‹åæˆ‘ä»¬å¯ä»¥æŠŠè‡ªå·±éœ€è¦æš´éœ²å‡ºå»çš„å‡½æ•°ç»™å®ç°äº†ï¼ˆè¿™é‡Œå¯ä»¥çœ‹åˆ°æ¨¡å—çš„ä¸»cppæ–‡ä»¶èƒ½å¤Ÿèµ·åˆ°èƒ¶æ°´å±‚çš„ä½œç”¨ï¼Œå¦‚æœæ­¤æ—¶æœ‰å…¶å®ƒå¤´æ–‡ä»¶é‡Œå®šä¹‰äº†ä¸€ç³»åˆ—æ¥å£ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶é‡ŒæŠŠè¿™äº›æ¥å£é€‚é…ä¸ºpythonå¯è¯†åˆ«çš„å‡½æ•°æ¨¡å¼ï¼‰ã€‚å®ç°å®Œæˆä¹‹åï¼Œé€šè¿‡<code>method def</code>è·Ÿ<code>module def</code>å®šä¹‰æ¥å£åˆ—è¡¨è·Ÿæ¨¡å—ï¼Œç„¶åå†åœ¨ä¸‹é¢å®šä¹‰æ¨¡å—å¯åŠ¨å‡½æ•°ï¼Œä¸€ä¸ªpythonçš„Cæ‰©å±•å°±è¯ç”Ÿäº†ã€‚</p>
<p>é‚£ä¹ˆæ€ä¹ˆå®ç°<code>tuple_setitem</code>çš„é€»è¾‘å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦é¢„æƒ³ä¸‹pythonç«¯å¦‚ä½•è°ƒç”¨ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> cplayground</span><br><span class="line"></span><br><span class="line">tp = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">cplayground.tuple_setitem(tp, <span class="number">0</span>, <span class="string">'haha'</span>)  <span class="comment"># è®¾ç½®ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå­—ç¬¦ä¸²'haha'</span></span><br></pre></td></tr></table></figure>
<p>åœ¨Cå±‚çš„å®ç°ä¸Šï¼Œ<code>tuple_setitem</code>çš„ç­¾åæ˜¯ä¸¤ä¸ªå‚æ•°ï¼š<strong>moduleè‡ªå·±çš„å¼•ç”¨ã€æ‰“åŒ…çš„å‚æ•°é›†åˆ</strong>ï¼Œéƒ½æ˜¯<code>PyObject*</code>ã€‚</p>
<p>é¦–å…ˆç¬¬ä¸€æ­¥æ˜¯é€šè¿‡<code>PyArg_ParseTuple</code>çœ‹æ˜¯å¦èƒ½ç”¨å¯¹åº”çš„æ¨¡å¼è§£åŒ…å‚æ•°ã€‚å…³äºå‚æ•°çš„æ¨¡å¼ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9jLWFwaS9hcmcuaHRtbA==" title="https://docs.python.org/3/c-api/arg.html">è¿™ä¸ªæ–‡æ¡£<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>ä¹‹åéœ€è¦å¯¹è§£åŒ…çš„å‚æ•°å†æ£€æŸ¥ï¼Œæ¯”å¦‚æ£€æŸ¥è§£å‡ºæ¥çš„<code>PyObject* tuple</code>æ˜¯å¦çœŸæ­£æ˜¯<code>tuple object</code>ï¼Œä»¥åŠè®¡ç®—ç´¢å¼•æ˜¯ä¸æ˜¯æœ‰æº¢å‡ºçš„æƒ…å†µã€‚</p>
<p>æœ€åé€šè¿‡<code>Py_SETREF</code>ï¼Œå°±èƒ½æŠŠä¼ è¿›æ¥çš„å…ƒç»„çš„å†…éƒ¨å…ƒç´ é‡ç½®ã€‚æ•´ä¸ªå®ç°è¿‡ç¨‹ï¼Œå…¶å®æ˜¯å‚è€ƒäº†<code>list object</code>çš„ç›¸å…³å®ç°ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥æ·±å…¥æ¢ç´¢ä¸€ä¸‹ï¼ˆé¢„å‘Šï¼šåœ¨åé¢çš„æ–‡ç« é‡Œä¹Ÿä¼šæåˆ°è¿™ä¸ªï¼‰ã€‚</p>
<p>æ•´ä¸ªå°é¡¹ç›®éƒ½æ”¾åˆ°äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9weWNleHRfcGxheWdyb3VuZA==" title="https://github.com/utmhikari/pycext_playground">github<i class="fa fa-external-link"></i></span>ä¸Šï¼Œæ˜¯ä¸€ä¸ªslnã€‚å¦‚æœè¦æµ‹è¯•çš„è¯ï¼Œcloneä¹‹åéœ€è¦æ³¨æ„é‡æ–°èµ°ä¸€éç¯å¢ƒé…ç½®çš„è¿‡ç¨‹ï¼Œç¡®è®¤é…ç½®æ— è¯¯ã€‚</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>C++</tag>
        <tag>pythonæ‰©å±•æ¨¡å—</tag>
        <tag>Visual Studio</tag>
        <tag>cplayground</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ã€Šæµ‹è¯•æ¶æ„å¸ˆä¿®ç‚¼ä¹‹é“ã€‹é˜…è¯»ç¬”è®°</title>
    <url>/2021/10/04/testlife/test_architect_notes/</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYW1hem9uLmNuL2RwL0IwMUVZOEo1QzI=" title="https://www.amazon.cn/dp/B01EY8J5C2">ã€Šæµ‹è¯•æ¶æ„å¸ˆä¿®ç‚¼ä¹‹é“ã€‹<i class="fa fa-external-link"></i></span>ä¸€ä¹¦ï¼Œç¬”è€…å…¥è¡Œä¸€å¹´å¤šçš„æ—¶å€™æ‹œè¯»è¿‡ã€‚è™½ç„¶è¿™æœ¬ä¹¦ä¸»è¦åå‘ä¸šåŠ¡æµ‹è¯•ã€è´¨é‡ç®¡ç†çš„æ–¹å‘ï¼Œè€Œå¹¶éæŠ€æœ¯æµ‹è¯•ã€æµ‹è¯•å¼€å‘çš„æ–¹å‘ï¼Œä½†åªè¦æ˜¯æµ‹è¯•è¡Œä¸šä»ä¸šè€…ï¼Œç¬”è€…è®¤ä¸ºéƒ½å€¼å¾—ä¸€çœ‹ã€‚</p>
<p>ä»ç¬”è€…æœ¬äººè§’åº¦ï¼Œå¯¹äºæµ‹è¯•äººå‘˜çš„èŒä¸šå‘å±•ï¼Œæ˜¯æç«¯æ¨å´‡æŠ€æœ¯æ–¹å‘çš„ã€‚ä½†å·¥ä½œæœ€ç»ˆæ€»ä¼šè½å®åˆ°äººï¼Œè¿‘å¹´æ¥æµ‹è¯•è¢«åˆ’åˆ†ä¸ºåå‘æŠ€æœ¯çš„å²—ä½ï¼Œé‚£ä¹ˆæŠ€æœ¯æœ¬èº«å°±ä¸€å®šè¦æèµ·æ¥ï¼Œè¿™æ ·æ‰èƒ½ä½¿å¾—è¿™ç±»èŒä¸šèƒ½å¤Ÿåœ¨å·¥ä½œæ¡†æ¶ä½“ç³»é‡Œå¤„äºä¸å±ˆä¹‹åœ°ã€‚</p>
<p>ä½†å³ä¾¿å¦‚æ­¤ï¼Œæµ‹è¯•æœ¬èº«ä¹Ÿæœ‰å¾ˆå¤šæŠ€æœ¯/ç®¡ç†æ–¹æ³•è®ºçš„ç§¯æ·€ï¼Œæœ‰å¾ˆå¤šold schoolçš„ä¸œè¥¿æ˜¯å€¼å¾—å°Šé‡çš„ã€‚ä¸è®ºæŠ€æœ¯åšæˆä»€ä¹ˆæ ·ï¼Œä»æµ‹è¯•å·¥ä½œçš„æœ€ç»ˆç›®æ ‡è€Œè¨€ï¼Œéƒ½éœ€è¦è´´åˆä¼ ç»Ÿæµ‹è¯•é—ç•™ä¸‹æ¥çš„çš„æ¦‚å¿µã€‚ã€Šæµ‹è¯•æ¶æ„å¸ˆä¿®ç‚¼ä¹‹é“ã€‹ä¸€ä¹¦ï¼Œå¯¹ä¼ ç»Ÿæµ‹è¯•ï¼Œå°¤å…¶è´¨é‡ç®¡ç†æ–¹å‘ç›¸å…³çš„çŸ¥è¯†ç‚¹ã€å·¥ä½œç›®æ ‡ã€å·¥ä½œæ–¹æ³•éƒ½æ¦‚æ‹¬çš„éå¸¸æ˜ç¡®ï¼Œæ˜¯æµ‹è¯•è¡Œä¸šä¸å¯å¤šå¾—çš„æ™ºæ…§ç§¯æ·€ï¼ˆå—¯ï¼Œæµ‹è¯•è¡Œä¸šç¡®å®ç¼ºä¹æ²‰æ·€ï¼ï¼‰ã€‚</p>
<p>æŠ€æœ¯æ–¹å‘çš„æµ‹è¯•åŒå­¦é˜…è¯»è¿™æœ¬ä¹¦ï¼Œèƒ½å¤Ÿæ›´å¥½åœ°æŠŠæ¡æŠ€æœ¯ç ”å‘çš„æ–¹å‘ï¼›ä¸šåŠ¡æ–¹å‘çš„æµ‹è¯•åŒå­¦é˜…è¯»è¿™æœ¬ä¹¦ï¼Œèƒ½å¤Ÿæ›´å…¨é¢åœ°è§„åˆ’è‡ªå·±çš„å‘å±•ã€‚</p>
<p>åœ¨é˜…è¯»çš„è¿‡ç¨‹ä¸­ï¼Œç¬”è€…ä¹Ÿåšäº†ç›¸å…³çš„è¯»ä¹¦ç¬”è®°ï¼Œæç‚¼äº†å…¶ä¸­çš„ç²¾è¦ã€‚æœ¬æ–‡ä¹Ÿå°†æŠŠç¬”è€…çš„è¯»ä¹¦ç¬”è®°å…¨éƒ¨åˆ†äº«å‡ºæ¥ï¼š</p>
<a id="more"></a>
<h2 id="ç¬¬ä¸€ç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„â€œä¸‰å¹´ä¹‹ç—’â€"><a href="#ç¬¬ä¸€ç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„â€œä¸‰å¹´ä¹‹ç—’â€" class="headerlink" title="ç¬¬ä¸€ç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„â€œä¸‰å¹´ä¹‹ç—’â€"></a>ç¬¬ä¸€ç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„â€œä¸‰å¹´ä¹‹ç—’â€</h2><p>ç¬¬ä¸‰å¹´çš„ç“¶é¢ˆï¼šåŸºæœ¬çš„æŠ€æœ¯ä¸ä¸šåŠ¡éƒ½å·²æŒæ¡ï¼Œä½†ä¸çŸ¥é“è¯¥å¦‚ä½•æ·±å…¥ï¼Œå·¥ä½œç¼ºä¹æŒ‘æˆ˜æ€§ä¸æˆå°±æ„Ÿ</p>
<p>è½¯ä»¶æµ‹è¯•çš„èƒ½åŠ›ï¼š</p>
<ul>
<li>å¯¹æ•´ä¸ªç³»ç»Ÿæœ‰æ•´ä½“æŠŠæ¡</li>
<li>ç«™åœ¨ç”¨æˆ·ï¼ˆç©å®¶ï¼‰è§’åº¦ç†è§£éœ€æ±‚</li>
<li>æŠ€æœ¯+äº§å“æŠ€èƒ½</li>
</ul>
<h2 id="ç¬¬äºŒç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„èŒä¸šè§„åˆ’"><a href="#ç¬¬äºŒç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„èŒä¸šè§„åˆ’" class="headerlink" title="ç¬¬äºŒç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„èŒä¸šè§„åˆ’"></a>ç¬¬äºŒç« ï¼šè½¯ä»¶æµ‹è¯•å·¥ç¨‹å¸ˆçš„èŒä¸šè§„åˆ’</h2><h3 id="èŒä¸šè§„åˆ’è·¯çº¿"><a href="#èŒä¸šè§„åˆ’è·¯çº¿" class="headerlink" title="èŒä¸šè§„åˆ’è·¯çº¿"></a>èŒä¸šè§„åˆ’è·¯çº¿</h3><p>æµ‹è¯•å·¥ç¨‹å¸ˆçš„ä¸¤æ¡è·¯ï¼š</p>
<ul>
<li>ç®¡ç†ï¼ˆæµ‹è¯•ä¸»ç®¡ã€PMï¼‰</li>
<li>æŠ€æœ¯ï¼ˆå·¥å…·ã€å¹³å°ã€ä¸“é¡¹ï¼‰</li>
</ul>
<h4 id="ç®¡ç†"><a href="#ç®¡ç†" class="headerlink" title="ç®¡ç†"></a>ç®¡ç†</h4><ul>
<li>åˆçº§ï¼ˆç»„é•¿ï¼‰ï¼šè´Ÿè´£äº§å“ä¸€ä¸ª/å¤šä¸ªç‰¹æ€§ï¼ˆP6ã€P7ï¼‰</li>
<li>ä¸­çº§ï¼ˆä¸»ç®¡ï¼‰ï¼šç®¡ç†10~20äººå›¢é˜Ÿï¼Œåˆ¶å®šã€è¯„ä¼°æµ‹è¯•è®¡åˆ’ï¼Œè¯„ä¼°äº§å“è´¨é‡ï¼ˆP7ã€P8ï¼‰</li>
<li>é«˜çº§ï¼ˆæ€»ç›‘ï¼‰ï¼šç†è§£äº§å“å•†ä¸šç›®æ ‡ï¼Œå›¢é˜Ÿäººæ‰ç®¡ç†ï¼Œè´¢åŠ¡èµ„æºè§„åˆ’ï¼Œæ”¹è¿›äº§å“æµ‹è¯•æ•ˆç‡ä¸è´¨é‡ï¼ˆP9+ï¼‰</li>
</ul>
<h4 id="æŠ€æœ¯"><a href="#æŠ€æœ¯" class="headerlink" title="æŠ€æœ¯"></a>æŠ€æœ¯</h4><ul>
<li>äº§å“æµ‹è¯•ä¸“å®¶<ul>
<li>ä¸šåŠ¡éœ€æ±‚å‘æµ‹è¯•è½¬æ¢è¿‡ç¨‹çš„æ¡¥æ¢ï¼Œè´Ÿè´£æµ‹è¯•æ¶æ„è®¾è®¡</li>
<li>å¯¹æµ‹è¯•é‡ç‚¹ä¸éš¾ç‚¹è¿›è¡Œæ”»å…³ï¼Œæä¾›æœ€ä¼˜æ–¹æ³•</li>
<li>ååŠ©æµ‹è¯•ç»ç†æŒ‡å®šæµ‹è¯•è®¡åˆ’ä¸è¿›åº¦</li>
<li>æˆ˜ç•¥è§„åˆ’ã€ä¸šåŠ¡å»ºæ¨¡ã€æ•°æ®åˆ†æã€äº§å“ç”Ÿå‘½å‘¨æœŸè´¨é‡ä¿è¯</li>
<li>æµ‹è¯•æŠ€æœ¯çš„æ¶‰çŒï¼ˆä¸ºäº§å“æœåŠ¡ï¼‰</li>
</ul>
</li>
<li>ä¸“é¡¹<ul>
<li>æ€§èƒ½ã€å¯é æ€§ã€å®‰å…¨æµ‹è¯•</li>
<li>æŠ€æœ¯å…±æ€§çš„ç ”ç©¶ï¼šæµ‹è¯•è®¾è®¡ã€ç¼ºé™·åˆ†æã€æ¢ç´¢æ€§&amp;è‡ªåŠ¨åŒ–ï¼ˆæµ‹è¯•æ‰§è¡Œï¼‰ã€æµ‹è¯•æµç¨‹ã€å®‰å…¨æ€§&amp;å…¼å®¹æ€§ï¼ˆåŠŸèƒ½æ€§ï¼‰ã€æ€§èƒ½ã€å¯é æ€§ã€å¯ç§»æ¤æ€§ï¼ˆå¯å®‰è£…æ€§ï¼‰ã€æ˜“ç”¨æ€§ã€å¯ç»´æŠ¤æ€§ï¼ˆç¨³å®š&amp;å¯æµ‹è¯•ï¼‰</li>
</ul>
</li>
</ul>
<h4 id="ä¹æ®µç§˜ä¹¦-amp-å…­æ®µæµ‹è¯•"><a href="#ä¹æ®µç§˜ä¹¦-amp-å…­æ®µæµ‹è¯•" class="headerlink" title="ä¹æ®µç§˜ä¹¦&amp;å…­æ®µæµ‹è¯•"></a>ä¹æ®µç§˜ä¹¦&amp;å…­æ®µæµ‹è¯•</h4><ul>
<li>å››æ®µâ€”â€”æ·±å…¥ç†è§£äº§å“è´¨é‡ï¼Œäº†è§£äº§å“æ€§èƒ½ã€å¯é æ€§ã€æ˜“ç”¨æ€§ç­‰éåŠŸèƒ½å±æ€§æµ‹è¯•ï¼Œèƒ½å¤Ÿè¿ç”¨æµ‹è¯•ç¼ºé™·åˆ†ææŠ€æœ¯è¯„ä¼°äº§å“è´¨é‡ã€‚</li>
<li>äº”æ®µâ€”â€”æ¨åŠ¨æµ‹è¯•æŠ€æœ¯è¿›æ­¥ï¼Œä¸æ–­è¿½æ±‚æœ€é€‚åˆäº§å“çš„æŠ€æœ¯ã€‚</li>
<li>å…­æ®µâ€”â€”ç¼ºé™·é¢„é˜²ï¼Œæµ‹è¯•æ–¹æ³•æ ‡å‡†åŒ–ï¼Œå›ºåŒ–ä¸ºæµ‹è¯•å·¥å…·å’Œæµç¨‹ã€‚</li>
</ul>
<h4 id="è´¨é‡ä¸æµ‹è¯•"><a href="#è´¨é‡ä¸æµ‹è¯•" class="headerlink" title="è´¨é‡ä¸æµ‹è¯•"></a>è´¨é‡ä¸æµ‹è¯•</h4><ul>
<li>è´¨é‡å…³æ³¨å¤§çš„äº§å“æµç¨‹</li>
<li>æµ‹è¯•å…³æ³¨äº§å“çš„å°è´¨é‡ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰äº¤ä»˜è´¨é‡ã€ç»è¥è´¨é‡ç­‰ç¯èŠ‚</li>
<li>è½¯ä»¶æµ‹è¯•åœ¨è´¨é‡é¢†åŸŸçš„å‘å±•<ul>
<li>äº§å“æµç¨‹è®¾è®¡</li>
<li>è´¨é‡ç®¡ç†è€…ï¼ˆç­–åˆ’ã€æ§åˆ¶ä¸æ”¹è¿›ï¼‰</li>
<li>å®¢æˆ·æ»¡æ„åº¦ç®¡ç†</li>
</ul>
</li>
</ul>
<h2 id="ç¬¬ä¸‰ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆåº”è¯¥åšå’Œä¸è¯¥åšçš„äº‹æƒ…"><a href="#ç¬¬ä¸‰ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆåº”è¯¥åšå’Œä¸è¯¥åšçš„äº‹æƒ…" class="headerlink" title="ç¬¬ä¸‰ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆåº”è¯¥åšå’Œä¸è¯¥åšçš„äº‹æƒ…"></a>ç¬¬ä¸‰ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆåº”è¯¥åšå’Œä¸è¯¥åšçš„äº‹æƒ…</h2><p>äº§å“æµ‹è¯•æ˜¯ç«¯åˆ°ç«¯çš„</p>
<h3 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h3><ul>
<li>ç†è§£éœ€æ±‚<ul>
<li>ç†è§£å•†ä¸šç›®æ ‡<ul>
<li>å®¢æˆ·/ç»†åˆ†å®¢æˆ·</li>
<li>å¸‚åœºè¶‹åŠ¿</li>
<li>ç«äº‰å¯¹æ‰‹</li>
<li>äº§å“æ˜¯å¦ä½“ç°å¸‚åœºä»·å€¼</li>
<li>æµ‹è¯•ç­–ç•¥æ˜¯å¦å’Œè¥é”€ç›®æ ‡ä¸€è‡´</li>
</ul>
</li>
<li>æ¢³ç†ç”¨æˆ·ä½¿ç”¨åœºæ™¯<ul>
<li>äº§å“æœ‰ä»€ä¹ˆç±»å‹çš„ç”¨æˆ·</li>
<li>ç”¨æˆ·çš„ä¸šåŠ¡æ˜¯ä»€ä¹ˆ</li>
<li>ç«äº‰å¯¹æ‰‹çš„è§£å†³æ–¹æ¡ˆ/å·®å¼‚</li>
<li>äº§å“çš„è§„èŒƒè¦æ±‚ã€è¡Œä¸šèƒŒæ™¯ã€ç”¨æˆ·ä¹ æƒ¯</li>
<li>åœºæ™¯çš„è¾“å…¥ä¸è¾“å‡º</li>
</ul>
</li>
</ul>
</li>
<li>æµ‹è¯•ç­–ç•¥<ul>
<li>æµ‹è¯•èŒƒå›´</li>
<li>æµ‹è¯•é‡ç‚¹ï¼šäº§å“ä»·å€¼ã€è´¨é‡ç›®æ ‡ã€ä»£ç å®ç°ã€å†å²æµ‹è¯•æƒ…å†µ</li>
<li>æµ‹è¯•ç›®æ ‡</li>
<li>æµ‹è¯•æ·±åº¦ï¼šæµ‹è¯•æ–¹æ³•å¤šæ ·æ€§ï¼ˆè¾¹ç•Œå€¼ã€å¼‚å¸¸å€¼ç­‰ï¼‰</li>
<li>æµ‹è¯•å¹¿åº¦ï¼šä¸šåŠ¡è¦†ç›–åº¦</li>
</ul>
</li>
</ul>
<h3 id="æµ‹è¯•åˆ†æå’Œè®¾è®¡"><a href="#æµ‹è¯•åˆ†æå’Œè®¾è®¡" class="headerlink" title="æµ‹è¯•åˆ†æå’Œè®¾è®¡"></a>æµ‹è¯•åˆ†æå’Œè®¾è®¡</h3><ul>
<li>é˜¶æ®µæµ‹è¯•ç­–ç•¥<ul>
<li>Væ¨¡å‹ï¼ˆéœ€æ±‚åˆ†æ-&gt;ç¼–ç ï¼Œå•å…ƒ/é›†æˆ/ç³»ç»Ÿ/éªŒæ”¶æµ‹è¯•ï¼‰</li>
<li>å‡ºå…¥å£å‡†åˆ™</li>
<li>åˆ†è§£æ€»ä½“æµ‹è¯•ç­–ç•¥</li>
</ul>
</li>
<li>æŒ‰ç…§è®¾è®¡æ–¹æ¡ˆè½å®</li>
</ul>
<h3 id="æµ‹è¯•æ‰§è¡Œ"><a href="#æµ‹è¯•æ‰§è¡Œ" class="headerlink" title="æµ‹è¯•æ‰§è¡Œ"></a>æµ‹è¯•æ‰§è¡Œ</h3><ul>
<li>ç‰ˆæœ¬æµ‹è¯•ç­–ç•¥<ul>
<li>æµ‹è¯•èŒƒå›´ä¸è®¡åˆ’çš„åå·®</li>
<li>æµ‹è¯•ç›®æ ‡ã€ç”¨ä¾‹</li>
<li>æµ‹è¯•é‡ç‚¹å…³æ³¨å†…å®¹ä¸æ‰§è¡Œé¡ºåº</li>
<li>å›å½’&amp;è‡ªåŠ¨åŒ–ç­‰æµ‹è¯•æ–¹æ³•</li>
</ul>
</li>
<li>è·Ÿè¸ªæµ‹è¯•æ‰§è¡Œ<ul>
<li>è·Ÿè¸ªç”¨ä¾‹æ‰§è¡Œæƒ…å†µ</li>
<li>ç¼ºé™·è·Ÿè¸ª</li>
<li>è°ƒæ•´æµ‹è¯•ç­–ç•¥</li>
<li>ä¸ä»…ä»…æ˜¯å‘ç°bugï¼Œè€Œæ˜¯è®°å½•ä¸è·Ÿè¿›</li>
</ul>
</li>
<li>å»ºç«‹ç‰ˆæœ¬è´¨é‡æ¡£æ¡ˆ<ul>
<li>è´¨é‡ç›®æ ‡ï¼šå•†ç”¨ã€demoç­‰</li>
<li>ç›®æ ‡åˆ†è§£ï¼šè¦†ç›–åº¦/æµ‹è¯•è¿‡ç¨‹/ç¼ºé™·æƒ…å†µ</li>
<li>åˆ†ç±»ï¼šè€ç‰¹æ€§å˜åŒ–/æ–°ç‰¹æ€§ç ”å‘</li>
<li>ä¼˜å…ˆçº§</li>
</ul>
</li>
</ul>
<h3 id="è´¨é‡è¯„ä¼°"><a href="#è´¨é‡è¯„ä¼°" class="headerlink" title="è´¨é‡è¯„ä¼°"></a>è´¨é‡è¯„ä¼°</h3><ul>
<li>èƒ½å¦è¿›å…¥ä¸‹ä¸€é˜¶æ®µæµ‹è¯•ï¼Ÿ<ul>
<li>è´¨é‡ç›®æ ‡æ˜¯å¦è¾¾åˆ°</li>
<li>æœªè¾¾åˆ°çš„ä¸€èˆ¬æ€§è´¨é‡ç›®æ ‡å¦‚ä½•åº”å¯¹</li>
<li>é—ç•™ç¼ºé™·åˆ†æ</li>
</ul>
</li>
</ul>
<h3 id="æµ‹è¯•ç»ç†ã€æµ‹è¯•æ¶æ„å¸ˆä¸ç³»ç»Ÿæ¶æ„å¸ˆ"><a href="#æµ‹è¯•ç»ç†ã€æµ‹è¯•æ¶æ„å¸ˆä¸ç³»ç»Ÿæ¶æ„å¸ˆ" class="headerlink" title="æµ‹è¯•ç»ç†ã€æµ‹è¯•æ¶æ„å¸ˆä¸ç³»ç»Ÿæ¶æ„å¸ˆ"></a>æµ‹è¯•ç»ç†ã€æµ‹è¯•æ¶æ„å¸ˆä¸ç³»ç»Ÿæ¶æ„å¸ˆ</h3><ul>
<li>æµ‹è¯•ç»ç†<ul>
<li>åˆ¶å®šæµ‹è¯•è®¡åˆ’ï¼ˆPMï¼‰</li>
<li>é€šè¿‡åè°ƒè°ƒåº¦ä¿è¯æµ‹è¯•é¡ºåˆ©è¿›è¡Œ</li>
</ul>
</li>
<li>æµ‹è¯•æ¶æ„å¸ˆ<ul>
<li>åˆ¶å®šæµ‹è¯•ç­–ç•¥</li>
<li>éªŒè¯äº§å“æ˜¯å¦å±•ç°åº”æœ‰çš„ä»·å€¼ï¼Œæ»¡è¶³ç”¨æˆ·éœ€æ±‚</li>
<li>ç†è§£æ¡†æ¶ï¼Œä½¿å¾—æµ‹è¯•è®¾è®¡ä¸æ‰§è¡Œæ›´åŠ æœ‰æ•ˆ</li>
</ul>
</li>
<li>ç³»ç»Ÿæ¶æ„å¸ˆ<ul>
<li>å¦‚ä½•åˆ›é€ äº§å“ï¼Œå®ç°äº§å“ä»·å€¼</li>
<li>å¦‚ä½•å®ç°ä»¥æ»¡è¶³ç”¨æˆ·éœ€æ±‚</li>
<li>éœ€è¦ä¸æµ‹è¯•æ¶æ„å¸ˆä¸€èµ·æ•´ç†user story</li>
</ul>
</li>
</ul>
<h2 id="ç¬¬å››ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„çŸ¥è¯†èƒ½åŠ›æ¨¡å‹"><a href="#ç¬¬å››ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„çŸ¥è¯†èƒ½åŠ›æ¨¡å‹" class="headerlink" title="ç¬¬å››ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„çŸ¥è¯†èƒ½åŠ›æ¨¡å‹"></a>ç¬¬å››ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„çŸ¥è¯†èƒ½åŠ›æ¨¡å‹</h2><h3 id="è½¯ä»¶äº§å“è´¨é‡æ¨¡å‹"><a href="#è½¯ä»¶äº§å“è´¨é‡æ¨¡å‹" class="headerlink" title="è½¯ä»¶äº§å“è´¨é‡æ¨¡å‹"></a>è½¯ä»¶äº§å“è´¨é‡æ¨¡å‹</h3><p>éªŒè¯æ˜¯å¦ç¬¦åˆéœ€æ±‚-&gt;éåŠŸèƒ½/éšæ€§éœ€æ±‚ï¼Ÿ</p>
<p>è´¨é‡å…­å±æ€§ï¼š</p>
<ul>
<li>åŠŸèƒ½æ€§</li>
<li>å¯é æ€§</li>
<li>æ˜“ç”¨æ€§</li>
<li>æ•ˆç‡</li>
<li>å¯ç»´æŠ¤æ€§</li>
<li>å¯ç§»æ¤æ€§</li>
</ul>
<h4 id="åŠŸèƒ½æ€§"><a href="#åŠŸèƒ½æ€§" class="headerlink" title="åŠŸèƒ½æ€§"></a>åŠŸèƒ½æ€§</h4><p>æŒ‡å®šæ¡ä»¶ä¸‹ä½¿ç”¨æ—¶ï¼Œæ»¡è¶³æ˜¾æ€§/éšæ€§åŠŸèƒ½çš„èƒ½åŠ›</p>
<ul>
<li>é€‚åˆæ€§ï¼šæ»¡è¶³ç”¨æˆ·åŸºæœ¬éœ€æ±‚</li>
<li>å‡†ç¡®æ€§ï¼šç»“æœä¸ç²¾åº¦æ­£ç¡®ï¼Œè¡¨è¾¾å†…å®¹æ— è¯¯</li>
<li>äº’æ“ä½œæ€§ï¼šå¤šç‰¹æ€§èƒ½å¤Ÿç›¸äº’é…åˆ</li>
<li>å®‰å…¨æ€§</li>
<li>åŠŸèƒ½é¡ºä»æ€§ï¼šç¬¦åˆåŠŸèƒ½ç›¸å…³æ ‡å‡†è§„èŒƒ</li>
</ul>
<h4 id="å¯é æ€§"><a href="#å¯é æ€§" class="headerlink" title="å¯é æ€§"></a>å¯é æ€§</h4><ul>
<li>æˆç†Ÿæ€§ï¼šé¿å…å› æ•…éšœè€Œå¤±æ•ˆ</li>
<li>å®¹é”™æ€§ï¼šå‘ç”Ÿæ•…éšœ/è¿åæ¥å£çº¦å®šï¼ˆå¼‚å¸¸å€¼ï¼‰æƒ…å†µä¸‹ï¼Œç»´æŒè§„å®šçš„æ€§èƒ½çº§åˆ«çš„èƒ½åŠ›</li>
<li>å¯æ¢å¤æ€§ï¼šè½¯ä»¶å¤±æ•ˆæƒ…å†µä¸‹ï¼Œé‡å»ºè§„å®šæ€§èƒ½çº§åˆ«å¹¶æ¢å¤å—ç›´æ¥æ•°æ®å½±å“çš„èƒ½åŠ›</li>
<li>å¯é æ€§é¡ºä»æ€§ï¼šç¬¦åˆå¯é æ€§è§„èŒƒ</li>
</ul>
<h4 id="æ˜“ç”¨æ€§"><a href="#æ˜“ç”¨æ€§" class="headerlink" title="æ˜“ç”¨æ€§"></a>æ˜“ç”¨æ€§</h4><p>ä»ç”¨æˆ·ä¹ æƒ¯çš„è§’åº¦</p>
<ul>
<li>æ˜“ç†è§£æ€§</li>
<li>æ˜“å­¦æ€§</li>
<li>æ˜“æ“ä½œæ€§</li>
<li>å¸å¼•æ€§</li>
<li>æ˜“ç”¨æ€§çš„ä¾ä»æ€§ï¼šéµå¾ªæ˜“ç”¨æ€§ç›¸å…³æ ‡å‡†ä¸é£æ ¼çš„ç¨‹åº¦</li>
</ul>
<h4 id="æ•ˆç‡"><a href="#æ•ˆç‡" class="headerlink" title="æ•ˆç‡"></a>æ•ˆç‡</h4><p>äº§å“æ€§èƒ½</p>
<ul>
<li>æ—¶é—´ç‰¹æ€§ï¼šæä¾›é€‚å½“å“åº”å’Œå¤„ç†æ—¶é—´ä»¥åŠæµé‡/ååé‡çš„èƒ½åŠ›</li>
<li>èµ„æºåˆ©ç”¨ç‡ï¼šæ‰§è¡ŒåŠŸèƒ½æ—¶ï¼Œä½¿ç”¨åˆé€‚æ•°é‡/ç±»åˆ«çš„èµ„æºçš„èƒ½åŠ›</li>
<li>æ•ˆç‡ä¾ä»æ€§ï¼šéµå¾ªç›¸å…³æ€§èƒ½æŒ‡æ ‡çš„ç¨‹åº¦</li>
</ul>
<h4 id="å¯ç»´æŠ¤æ€§"><a href="#å¯ç»´æŠ¤æ€§" class="headerlink" title="å¯ç»´æŠ¤æ€§"></a>å¯ç»´æŠ¤æ€§</h4><p>å¯è¢«ä¿®æ”¹çš„èƒ½åŠ›</p>
<ul>
<li>å¯åˆ†ææ€§ï¼šè¯Šæ–­è½¯ä»¶ç¼ºé™·/å¤±æ•ˆåŸå› /ä¿®æ”¹éƒ¨åˆ†è¯†åˆ«çš„èƒ½åŠ›</li>
<li>å¯ä¿®æ”¹æ€§ï¼šè½¯ä»¶äº§å“èƒ½å¤Ÿè¢«ä¿®æ”¹çš„èƒ½åŠ›</li>
<li>ç¨³å®šæ€§ï¼šè½¯ä»¶äº§å“ä¸ä¼šå› ä¸ºä¿®æ”¹è€Œé€ æˆæ„å¤–ç»“æœçš„èƒ½åŠ›ï¼ˆä½“ç°å¯ä¿®æ”¹çš„å®¹æ˜“ç¨‹åº¦ï¼‰</li>
<li>å¯æµ‹è¯•æ€§ï¼šè½¯ä»¶äº§å“å·²ä¿®æ”¹çš„éƒ¨åˆ†èƒ½å¤Ÿè¢«ç¡®è®¤ä¿®å¤çš„èƒ½åŠ›</li>
<li>å¯ç»´æŠ¤æ€§ä¾ä»æ€§ï¼šéµå¾ªç›¸å…³æ ‡å‡†/çº¦å®šçš„èƒ½åŠ›</li>
</ul>
<h4 id="å¯ç§»æ¤æ€§"><a href="#å¯ç§»æ¤æ€§" class="headerlink" title="å¯ç§»æ¤æ€§"></a>å¯ç§»æ¤æ€§</h4><p>ä»ä¸€ç§ç¯å¢ƒè¿ç§»åˆ°å¦å¤–ä¸€ç§ç¯å¢ƒçš„èƒ½åŠ›</p>
<ul>
<li>é€‚åº”æ€§ï¼šæ— éœ€é‡‡ç”¨é¢å¤–æ‰‹æ®µä¾¿å¯é€‚åº”ä¸åŒç¯å¢ƒçš„èƒ½åŠ›ï¼ˆå¤šOSå…¼å®¹ï¼‰</li>
<li>å¯å®‰è£…æ€§ï¼šåœ¨æŒ‡å®šç¯å¢ƒä¸­è¢«å®‰è£…çš„èƒ½åŠ›ï¼ˆæ˜¯å¦æ˜“å®‰è£…ï¼Ÿï¼‰</li>
<li>å…±å­˜æ€§ï¼šå’Œç¯å¢ƒä¸­å…¶å®ƒè½¯ä»¶å…±å­˜çš„èƒ½åŠ›ï¼ˆä¸æ•ˆç‡/æ€§èƒ½ç›¸å…³ï¼‰</li>
<li>æ˜“æ›¿æ¢æ€§ï¼šåœ¨åŒæ ·ç¯å¢ƒä¸‹æ›¿ä»£å¦ä¸€ä¸ªç›¸åŒç”¨é€”äº§å“çš„èƒ½åŠ›</li>
<li>å¯ç§»æ¤æ€§çš„ä¾ä»æ€§ï¼šéµå¾ªå¯ç§»æ¤çš„æ ‡å‡†/çº¦å®šçš„èƒ½åŠ›</li>
</ul>
<h3 id="æµ‹è¯•ç±»å‹"><a href="#æµ‹è¯•ç±»å‹" class="headerlink" title="æµ‹è¯•ç±»å‹"></a>æµ‹è¯•ç±»å‹</h3><ul>
<li>åŠŸèƒ½æµ‹è¯•ï¼šäº§å“èƒ½å¦æ»¡è¶³ç”¨æˆ·ç‰¹å®šåŠŸèƒ½è¦æ±‚å¹¶åšå‡ºæ­£ç¡®å“åº”</li>
<li>å®‰å…¨æ€§æµ‹è¯•ï¼šäº§å“æ˜¯å¦æœ‰ä¿æŠ¤æ•°æ®çš„èƒ½åŠ›ï¼Œèƒ½åœ¨åˆé€‚èŒƒå›´æ‰¿å—æ¶æ„æ”»å‡»</li>
<li>å…¼å®¹æ€§æµ‹è¯•ï¼šèƒ½å¤Ÿå’Œå…¶ä»–ç›¸å…³äº§å“/å¹³å°é¡ºåˆ©å¯¹æ¥ï¼ˆæ“ä½œç³»ç»Ÿï¼‰</li>
<li>é…ç½®æµ‹è¯•ï¼šæ˜¯å¦èƒ½åœ¨æ¨èé…ç½®ä¸Šæµç•…è¿è¡Œï¼Œæ˜¯å¦ä¼šå‡ºç°è¾“å…¥æ•…éšœ</li>
<li>å¯é æ€§æµ‹è¯•ï¼šåœ¨é•¿æ—¶é—´è¿è¡Œèƒ½å¦ä¿è¯ç³»ç»Ÿçš„æ€§èƒ½æ°´å¹³ï¼Œå­˜åœ¨å¼‚å¸¸æƒ…å†µä¸‹ç³»ç»Ÿæ˜¯å¦ä¾ç„¶å¯é </li>
<li>æ˜“ç”¨æ€§æµ‹è¯•ï¼šäº§å“æ˜¯å¦æ˜“äºç†è§£ã€å­¦ä¹ ä¸æ“ä½œ</li>
<li>æ€§èƒ½æµ‹è¯•ï¼šæ—¶é—´/èµ„æºçš„ä½¿ç”¨</li>
<li>å®‰è£…æµ‹è¯•ï¼šäº§å“æ˜¯å¦èƒ½è¢«å®‰è£…ä¸æ­£ç¡®è¿è¡Œ</li>
</ul>
<h3 id="æµ‹è¯•æ–¹æ³•"><a href="#æµ‹è¯•æ–¹æ³•" class="headerlink" title="æµ‹è¯•æ–¹æ³•"></a>æµ‹è¯•æ–¹æ³•</h3><p>è½¦è½®å›¾â€”â€”å›´ç»•äº§å“è´¨é‡æ¨¡å‹çš„ç›¸åº”æµ‹è¯•æ–¹æ³•</p>
<h4 id="åŠŸèƒ½æµ‹è¯•æ–¹æ³•"><a href="#åŠŸèƒ½æµ‹è¯•æ–¹æ³•" class="headerlink" title="åŠŸèƒ½æµ‹è¯•æ–¹æ³•"></a>åŠŸèƒ½æµ‹è¯•æ–¹æ³•</h4><ul>
<li>å•è¿è¡Œæ­£å¸¸å€¼è¾“å…¥æ³•<ul>
<li>æµ‹è¯•ç”¨æˆ·å‘é€emailï¼Œæ”¶ä»¶äººåœ°å€ã€å‘ä»¶äººåœ°å€ã€é‚®ä»¶å†…å®¹ã€æ ‡é¢˜ã€ä¼˜å…ˆçº§ç­‰ï¼Œéƒ½æ˜¯è¾“å…¥ã€‚æµ‹è¯•è¿™äº›çš„æ­£ç¡®æ€§ï¼Œå³ä¸ºå•è¿è¡Œæ­£å¸¸å€¼è¾“å…¥ã€‚</li>
<li>è¾“å…¥æœ‰é™ï¼ˆé‚®ä»¶ä¼˜å…ˆçº§ï¼‰ï¼šéå†</li>
<li>è¾“å…¥æ— é™ï¼ˆé‚®ä»¶å†…å®¹ï¼‰ï¼šç­‰ä»·ç±»</li>
</ul>
</li>
<li>å•è¿è¡Œè¾¹ç•Œå€¼è¾“å…¥æ³•<ul>
<li>è¾“å…¥è¾¹ç•Œå€¼ã€è¶…è¶Šè¾¹ç•Œçš„å€¼ã€ä¸åˆæ³•çš„å€¼ä¸è¾“å…¥æ­£å¸¸å€¼è¿›è¡Œå¯¹æ¯”</li>
</ul>
</li>
<li>å¤šè¿è¡Œé¡ºåºæ‰§è¡Œæ³•<ul>
<li>è€ƒè™‘ç”¨æˆ·ä¹ æƒ¯æ€§çš„æ“ä½œ</li>
<li>æ¯”å¦‚ç”¨æˆ·â€œæ”¶åˆ°ä¸€å°é‚®ä»¶â€ä¸â€œå‘é€ä¸€å°é‚®ä»¶â€ä¸¤ä¸ªäº‹ä»¶ç»„åˆä¸­ï¼Œåªæœ‰â€œç”¨æˆ·æ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œåˆå‘é€è¯¥å°é‚®ä»¶â€æ‰æ˜¯æµ‹è¯•ç‚¹ï¼Œå…·æœ‰é¡ºåºæ€§ã€‚è€Œâ€œç”¨æˆ·æ”¶åˆ°ä¸€å°é‚®ä»¶åå‘é€ä»»æ„ä¸€å°é‚®ä»¶â€ä¸â€œç”¨æˆ·å‘é€ä¸€å°é‚®ä»¶åå†æ”¶åˆ°ä¸€ä¸ªé‚®ä»¶â€å¹¶éæµ‹è¯•ç‚¹ï¼Œå¯ä»¥åˆ†å¼€æ¥æµ‹ã€‚</li>
</ul>
</li>
<li>å¤šè¿è¡Œç›¸äº’ä½œç”¨æ³•<ul>
<li>è€ƒè™‘ä¸¤ç§è¿è¡Œæœ‰ä¸šåŠ¡ä¸Šæˆ–è€…å†…åœ¨èµ„æºä¸Šçš„å…³è”</li>
<li>â€œç”¨æˆ·å‘é‚®ä»¶æ—¶ï¼Œåˆæ”¶åˆ°ä¸€å°é‚®ä»¶â€å°±æ˜¯ç›¸äº’ä½œç”¨çš„ä¾‹å­</li>
</ul>
</li>
</ul>
<p>å•/å¤šè¿è¡Œï¼šæµ‹è¯•äººå‘˜çš„ä¸€æ¬¡/å¤šæ¬¡æ“ä½œæˆ–è¡Œä¸º<br>ä»è®¾è®¡çš„è§’åº¦åˆ’åˆ†åŠŸèƒ½ï¼Œæ¯”å¦‚â€œç”¨æˆ·å’ŒæœåŠ¡å™¨å»ºç«‹äº†è¿æ¥â€è¿™ç§å™è¿°ï¼Œå¹¶ä¸ç®—æ˜¯è¿è¡Œ<br>è€Œâ€œç”¨æˆ·é€šè¿‡ç‚¹å‡»xxxâ€ -&gt; è¾“å‡ºç»“æœä¸ºå’ŒæœåŠ¡å™¨å»ºç«‹äº†è¿æ¥ï¼Œå‰è€…ç®—æ˜¯â€œè¿è¡Œâ€<br>é’ˆå¯¹ä¸€ä¸ªç”¨æˆ·æ‰§è¡Œæ“ä½œï¼ˆå¤šä¸ªç”¨æˆ·ï¼Œè€ƒè™‘å¯é æ€§æµ‹è¯•æ³•ï¼‰</p>
<h4 id="å¯é æ€§æµ‹è¯•æ–¹æ³•"><a href="#å¯é æ€§æµ‹è¯•æ–¹æ³•" class="headerlink" title="å¯é æ€§æµ‹è¯•æ–¹æ³•"></a>å¯é æ€§æµ‹è¯•æ–¹æ³•</h4><ul>
<li>å¼‚å¸¸å€¼è¾“å…¥æ³•ï¼šé‡‡ç”¨ç³»ç»Ÿä¸å…è®¸çš„è¾“å…¥å€¼è¿›è¡Œè¾“å…¥<ul>
<li>æ•…éšœæ¤å…¥æ³•ï¼šæŠŠç³»ç»Ÿæ”¾åœ¨æœ‰é—®é¢˜çš„ç¯å¢ƒä¸­è¿›è¡Œæµ‹è¯•ï¼Œè¾“å…¥ä»ç„¶ä¸ºæ­£å¸¸å€¼</li>
<li>å¼±ç½‘/æ–­çº¿é‡è¿</li>
<li>CPUã€å†…å­˜ä¸è¶³</li>
<li>è½¯ä»¶å†²çªã€é©±åŠ¨ä¸æ­£ç¡®</li>
<li>ç¡¬ä»¶é—®é¢˜</li>
</ul>
</li>
<li>ç¨³å®šæ€§æµ‹è¯•æ³•ï¼šåœ¨ä¸€æ®µæ—¶é—´é‡Œï¼Œé•¿æ—¶é—´å¤§å®¹é‡è¿è¡ŒæŸç§ä¸šåŠ¡çš„ä¸€å¥—æ–¹æ³•<ul>
<li>ä½äºæ€§èƒ½æµ‹è¯•çš„åŸºå‡†ï¼Œè€ƒè™‘å®é™…æƒ…å†µ</li>
<li>å¢åŠ æ“ä½œæ•°é‡</li>
<li>å¤šä¸ªç”¨æˆ·åŒæ—¶æ“ä½œæŸåŠŸèƒ½</li>
<li>ç”¨æˆ·åå¤è¿›è¡ŒæŸæ“ä½œ</li>
<li>ç”¨æˆ·åå¤è¿›è¡Œå¼‚å¸¸æ“ä½œ</li>
</ul>
</li>
<li>å‹åŠ›æµ‹è¯•æ³•ï¼šåœ¨ä¸€æ®µæ—¶é—´é‡Œï¼ŒæŒç»­ä½¿ç”¨è¶…è¿‡ç³»ç»Ÿè§„æ ¼çš„è´Ÿè½½è¿›è¡Œæµ‹è¯•çš„æ–¹æ³•<ul>
<li>åœ¨æ¯ä¸ªå‘¨æœŸçš„æŸä¸ªå°æ—¶æ®µå†…ï¼Œå¢å¤§è®¿é—®/æ“ä½œé‡ï¼ŒæŒç»­ä¸€æ®µæ—¶é—´</li>
<li>ä¸å…è®¸ä¸šåŠ¡å¤±è´¥</li>
</ul>
</li>
<li>æ¢å¤æµ‹è¯•æ³•ï¼šåœ¨æŒç»­è¶…è¿‡è´Ÿè½½è¿›è¡Œä¸€é•¿æ®µæ—¶é—´çš„æµ‹è¯•åï¼Œå†æ¢å¤åŸå…ˆçš„è´Ÿè½½è§„æ ¼æ‰§è¡Œæµ‹è¯•çš„æ–¹æ³•<ul>
<li>æŒç»­è¿›è¡Œè¶…è¿‡è§„æ ¼çš„è´Ÿè½½æ—¶ï¼Œè§„æ ¼å†…çš„ä¸šåŠ¡ä¸æ˜¯100%æ­£ç¡®ï¼Œå¯å®¹å¿å®•æœºï¼ˆè€ƒè™‘äº§å“å¯é æ€§çš„è¦æ±‚ï¼‰</li>
<li>å½“è´Ÿè½½é™åˆ°è§„æ ¼å€¼ä¹‹å†…åï¼Œä¸šåŠ¡å¿…é¡»100%æ­£ç¡®</li>
</ul>
</li>
</ul>
<h4 id="æ€§èƒ½æµ‹è¯•æ–¹æ³•"><a href="#æ€§èƒ½æµ‹è¯•æ–¹æ³•" class="headerlink" title="æ€§èƒ½æµ‹è¯•æ–¹æ³•"></a>æ€§èƒ½æµ‹è¯•æ–¹æ³•</h4><ul>
<li>ç³»ç»Ÿèƒ½å¤Ÿæ­£ç¡®å¤„ç†æ–°ä¸šåŠ¡çš„æœ€å¤§èƒ½åŠ›<ul>
<li>ä»åˆ†é…èµ„æºåˆ°å®Œæˆå¤„ç†æµç¨‹çš„é€Ÿåº¦</li>
<li>ä¾‹å­ï¼šæ¯ç§’å…è®¸ç™»å½•ç”¨æˆ·ï¼ˆå¼€æœPCUï¼‰ã€æ¯ç§’èƒ½å¤Ÿä¸»åŠ¨å‘èµ·å¤šå°‘æ¬¡è¿æ¥</li>
<li>è€ƒè™‘æ–°ä¸šåŠ¡çš„æ‹†é™¤ï¼ˆæ¯”å¦‚ç”¨æˆ·ä¸‹çº¿ï¼‰</li>
</ul>
</li>
<li>å¹¶å‘ï¼šç³»ç»Ÿèƒ½å¤ŸåŒæ—¶æ­£ç¡®å¤„ç†çš„æœ€å¤§ä¸šåŠ¡çš„èƒ½åŠ›<ul>
<li>åˆ«çš„æŒ‡æ ‡ä¸èƒ½å¯¹å¹¶å‘æŒ‡æ ‡é€ æˆå½±å“</li>
</ul>
</li>
</ul>
<p>åˆ†ææ€§èƒ½æµ‹è¯•çš„å½±å“å› ç´ ï¼šè€ƒè™‘ç”¨æˆ·å‘é‚®ä»¶ï¼Œå› å˜é‡ä¸ºé‚®ä»¶å¤§å°ï¼ˆ1bitï½10MBï¼‰ä¸é‚®ä»¶è¿‡æ»¤ç­–ç•¥ï¼ˆ1ï½1000æ¡ï¼‰ï¼Œé€šè¿‡æ‹Ÿåˆæ›²çº¿è§‚å¯Ÿè¶‹åŠ¿ã€‚æˆ–è€…é‡‡ç”¨æ··åˆå› å˜é‡çš„æ–¹æ³•ï¼Œæ¨¡æ‹ŸçœŸå®ä¸šåŠ¡æƒ…å†µã€‚</p>
<h4 id="æ˜“ç”¨æ€§æµ‹è¯•æ³•"><a href="#æ˜“ç”¨æ€§æµ‹è¯•æ³•" class="headerlink" title="æ˜“ç”¨æ€§æµ‹è¯•æ³•"></a>æ˜“ç”¨æ€§æµ‹è¯•æ³•</h4><ul>
<li>ä¸€è‡´æ€§ï¼šé£æ ¼å¸ƒå±€ç»Ÿä¸€ï¼Œæ“ä½œæç¤ºæ˜¯å¦ç¬¦åˆè®¾è®¡è§„èŒƒç­‰ã€‚æœ€å¥½æœ‰ä¸ªchecklistã€‚</li>
<li>å¯ç”¨æ€§ï¼šç”¨æˆ·è§†è§’â€”â€”åŠŸèƒ½æ˜¯å¦æ˜“ç”¨ï¼Ÿæœ€å¥½éœ€è¦ç†Ÿæ‚‰ç”¨æˆ·åˆç†Ÿæ‚‰æµ‹è¯•çš„äººï¼ˆææµ‹ï¼‰<ul>
<li>å®ŒæˆæŸä¸ªä¸šåŠ¡åœºæ™¯é…ç½®éœ€è¦çš„æ—¶é—´ï¼Ÿ</li>
<li>å®ŒæˆæŸä¸ªä¸šåŠ¡åœºæ™¯é…ç½®äº†å¤šå°‘æ­¥éª¤ï¼Ÿ</li>
<li>å®ŒæˆæŸä¸ªä¸šåŠ¡åœºæ™¯è·³è½¬äº†å¤šå°‘é…ç½®é¡µé¢ï¼Ÿ</li>
<li>å®ŒæˆæŸä¸ªä¸šåŠ¡åœºæ™¯æ±‚åŠ©äº†å‡ æ¬¡ï¼Ÿäº§å“èµ„æ–™æ˜¯å¦å®¹æ˜“è§£å†³é—®é¢˜ï¼Ÿ</li>
</ul>
</li>
</ul>
<h3 id="æµ‹è¯•è®¾è®¡æŠ€æœ¯"><a href="#æµ‹è¯•è®¾è®¡æŠ€æœ¯" class="headerlink" title="æµ‹è¯•è®¾è®¡æŠ€æœ¯"></a>æµ‹è¯•è®¾è®¡æŠ€æœ¯</h3><h4 id="æµ‹è¯•ç‚¹ä¸æµ‹è¯•ç”¨ä¾‹"><a href="#æµ‹è¯•ç‚¹ä¸æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="æµ‹è¯•ç‚¹ä¸æµ‹è¯•ç”¨ä¾‹"></a>æµ‹è¯•ç‚¹ä¸æµ‹è¯•ç”¨ä¾‹</h4><p>æµ‹è¯•ç”¨ä¾‹æ˜¯æµ‹è¯•ç‚¹çš„åŠ å·¥ï¼Œéœ€è¦å¯¹æµ‹è¯•ç‚¹è¿›è¡Œå»é‡ã€åˆå¹¶ã€ç»†åŒ–<br>éœ€è¦ä¿è¯ç”¨ä¾‹çš„å¯æ‰§è¡Œæ€§ï¼Œæ˜¯ä¸€ä»½çœŸæ­£èƒ½å¤Ÿç›´åˆ°æµ‹è¯•çš„è¯´æ˜ä¹¦</p>
<h4 id="å››æ­¥æµ‹è¯•è®¾è®¡æ³•"><a href="#å››æ­¥æµ‹è¯•è®¾è®¡æ³•" class="headerlink" title="å››æ­¥æµ‹è¯•è®¾è®¡æ³•"></a>å››æ­¥æµ‹è¯•è®¾è®¡æ³•</h4><ul>
<li>å»ºæ¨¡<ul>
<li>æµç¨‹ï¼ˆæµç¨‹å›¾ï¼‰</li>
<li>å‚æ•°ï¼ˆè¾“å…¥è¾“å‡ºè¡¨ï¼‰</li>
<li>æ•°æ®ï¼ˆç­‰ä»·ç±»åˆ†æè¡¨ï¼‰</li>
<li>ç»„åˆï¼ˆå› å­è¡¨ï¼‰</li>
</ul>
</li>
<li>è®¾è®¡åŸºç¡€æµ‹è¯•ç”¨ä¾‹ï¼šè¦†ç›–æµ‹è¯•æ¨¡å‹ï¼Œç¡®å®šæµ‹è¯•æ¡ä»¶</li>
<li>è¡¥å……æµ‹è¯•æ•°æ®</li>
<li>æ‰©å±•ï¼šé’ˆå¯¹å®¹æ˜“å‘ç”Ÿç¼ºé™·çš„åœ°æ–¹è¿›ä¸€æ­¥å¢åŠ ç”¨ä¾‹</li>
</ul>
<h4 id="æµ‹è¯•ç‚¹çš„åˆ†ç±»"><a href="#æµ‹è¯•ç‚¹çš„åˆ†ç±»" class="headerlink" title="æµ‹è¯•ç‚¹çš„åˆ†ç±»"></a>æµ‹è¯•ç‚¹çš„åˆ†ç±»</h4><ul>
<li>æµç¨‹ç±»æµ‹è¯•ç‚¹ï¼šé€šè¿‡ç»„åˆï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„æµç¨‹</li>
<li>å‚æ•°ç±»æµ‹è¯•ç‚¹ï¼šå‚æ•°ä¸ªæ•°æœ‰é™ï¼Œå¯ä»¥éå†è¦†ç›–ï¼Œç³»ç»Ÿä¼šå¯¹ä¸åŒå‚æ•°æœ‰ä¸åŒå“åº”</li>
<li>æ•°æ®ç±»æµ‹è¯•ç‚¹ï¼šæ˜¯ä¸€ä¸ªèŒƒå›´ï¼ŒèŒƒå›´å†…çš„å“åº”åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„</li>
<li>ç»„åˆç±»æµ‹è¯•ç‚¹ï¼šæµç¨‹ã€å‚æ•°ã€æ•°æ®çš„ç»„åˆ</li>
</ul>
<h4 id="æµç¨‹ç±»æµ‹è¯•è®¾è®¡ï¼šè·¯å¾„åˆ†ææ³•"><a href="#æµç¨‹ç±»æµ‹è¯•è®¾è®¡ï¼šè·¯å¾„åˆ†ææ³•" class="headerlink" title="æµç¨‹ç±»æµ‹è¯•è®¾è®¡ï¼šè·¯å¾„åˆ†ææ³•"></a>æµç¨‹ç±»æµ‹è¯•è®¾è®¡ï¼šè·¯å¾„åˆ†ææ³•</h4><ul>
<li>ç»˜åˆ¶ä¸šåŠ¡æµç¨‹å›¾è¿›è¡Œå»ºæ¨¡</li>
<li>å¯¹è¦†ç›–æµç¨‹çš„å„ä¸ªè·¯å¾„è¿›è¡Œåˆ†æï¼Œè¦†ç›–æ–¹æ³•æœ‰ï¼š<ul>
<li>è¯­å¥è¦†ç›–ï¼šæ‰€æœ‰åˆ¤å®šå’Œè¿‡ç¨‹çš„æœ€å°è·¯å¾„é›†åˆ</li>
<li>åˆ†æ”¯è¦†ç›–ï¼šè¦†ç›–ç³»ç»Ÿä¸­æ¯ä¸ªåˆ¤å®šçš„æ‰€æœ‰åˆ†æ”¯æ‰€éœ€çš„æœ€å°è·¯å¾„æ•°</li>
<li>å…¨è¦†ç›–ï¼š100%è¦†ç›–æ‰€æœ‰å¯èƒ½çš„è·¯å¾„</li>
<li>æœ€å°çº¿æ€§æ— å…³è¦†ç›–ï¼ˆå¸¸ç”¨ï¼‰ï¼šæ¯ä¸ªè·¯å¾„ç‰‡æ®µè‡³å°‘è¢«æ‰§è¡Œä¸€æ¬¡ã€‚<ul>
<li>çº¿æ€§æ— å…³è·¯å¾„ï¼ˆIPï¼‰ = è¾¹æ•° - èŠ‚ç‚¹æ•° + 2 = åˆ¤å®šæ•° + 1 = åŒºåŸŸæ•° + 1</li>
</ul>
</li>
</ul>
</li>
<li>ç¡®å®šä¸šåŠ¡æµç¨‹çš„æ‰€æœ‰å­æµç¨‹ã€‚å¯¹äºæ¯ä¸€ä¸ªå­æµç¨‹ï¼Œç¡®å®šæµ‹è¯•è¾“å…¥ã€‚</li>
</ul>
<h4 id="å‚æ•°ç±»æµ‹è¯•è®¾è®¡ï¼šè¾“å…¥â€”â€”è¾“å‡ºè¡¨åˆ†ææ³•"><a href="#å‚æ•°ç±»æµ‹è¯•è®¾è®¡ï¼šè¾“å…¥â€”â€”è¾“å‡ºè¡¨åˆ†ææ³•" class="headerlink" title="å‚æ•°ç±»æµ‹è¯•è®¾è®¡ï¼šè¾“å…¥â€”â€”è¾“å‡ºè¡¨åˆ†ææ³•"></a>å‚æ•°ç±»æµ‹è¯•è®¾è®¡ï¼šè¾“å…¥â€”â€”è¾“å‡ºè¡¨åˆ†ææ³•</h4><ul>
<li>åˆ—å‡ºç›¸å…³çš„å‚æ•°è¾“å…¥ä¸è¾“å‡º</li>
<li>æ­£å¸¸çš„è¾“å…¥å‚æ•°/å¼‚å¸¸ä¸æ­£å¸¸çš„ç»„åˆ</li>
<li>æ’åˆ—ç»„åˆåï¼Œæ ¹æ®ä¸šåŠ¡çš„çº¦æŸæ¡ä»¶ä¸æ§åˆ¶å˜é‡æ³•å»é‡ï¼Œå¾—åˆ°è¾“å…¥â€”â€”è¾“å‡ºè¡¨</li>
<li>è¦†ç›–è¾“å…¥è¾“å‡ºè¡¨ï¼Œå®Œæˆç”¨ä¾‹</li>
</ul>
<h4 id="æ•°æ®ç±»æµ‹è¯•è®¾è®¡ï¼šç­‰ä»·ç±»å’Œè¾¹ç•Œå€¼åˆ†ææ³•"><a href="#æ•°æ®ç±»æµ‹è¯•è®¾è®¡ï¼šç­‰ä»·ç±»å’Œè¾¹ç•Œå€¼åˆ†ææ³•" class="headerlink" title="æ•°æ®ç±»æµ‹è¯•è®¾è®¡ï¼šç­‰ä»·ç±»å’Œè¾¹ç•Œå€¼åˆ†ææ³•"></a>æ•°æ®ç±»æµ‹è¯•è®¾è®¡ï¼šç­‰ä»·ç±»å’Œè¾¹ç•Œå€¼åˆ†ææ³•</h4><ul>
<li>ç­‰ä»·ç±»ï¼šè¾“å…¥å€¼æŒ‰ç…§æµ‹è¯•æ•ˆæœåˆ’åˆ†ï¼Œç›¸åŒæ•ˆæœä¸ºä¸€ç±»</li>
<li>è¾¹ç•Œå€¼ï¼šå‚æ•°è¾“å…¥è¾¹ç•Œçš„å–å€¼</li>
<li>ç­‰ä»·ç±»åˆ†æè¡¨ï¼šåœ¨æŸä¸ªæ¡ä»¶ä¸‹ï¼Œæœ‰æ•ˆä¸æ— æ•ˆè¾“å…¥ç­‰ä»·ç±»çš„è¡¨<ul>
<li>æ— æ•ˆç­‰ä»·ç±»ä¸€èˆ¬é’ˆå¯¹å•ä¸ªå› ç´ </li>
<li>å¦‚æœéƒ¨åˆ†æ¡ä»¶çš„ç­‰ä»·ç±»ç›¸ä¼¼ï¼Œå¯è€ƒè™‘åˆå¹¶è¿™äº›æ¡ä»¶ã€‚è¿™æ ·çš„è¯ï¼ŒæŸä¸ªæ¡ä»¶ä¸‹å¯æµ‹ä¸€éƒ¨åˆ†æœ‰æ•ˆ/æ— æ•ˆç­‰ä»·ç±»ï¼Œè€Œå¦ä¸€ä¸ªæ¡ä»¶åˆ™æµ‹å¦ä¸€äº›æœ‰æ•ˆ/æ— æ•ˆç­‰ä»·ç±»ã€‚</li>
</ul>
</li>
</ul>
<h4 id="ç»„åˆç±»æµ‹è¯•è®¾è®¡ï¼šæ­£äº¤åˆ†ææ³•"><a href="#ç»„åˆç±»æµ‹è¯•è®¾è®¡ï¼šæ­£äº¤åˆ†ææ³•" class="headerlink" title="ç»„åˆç±»æµ‹è¯•è®¾è®¡ï¼šæ­£äº¤åˆ†ææ³•"></a>ç»„åˆç±»æµ‹è¯•è®¾è®¡ï¼šæ­£äº¤åˆ†ææ³•</h4><ul>
<li>é‡‡ç”¨å› å­è¡¨å»ºæ¨¡<ul>
<li>æœ‰çº¦æŸå…³ç³»ï¼Œè€ƒè™‘æ‹†è¡¨</li>
</ul>
</li>
<li>é‡‡ç”¨PICTå·¥å…·ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼ˆpairwise testingï¼‰</li>
<li>åˆå¹¶pairwiseè¡¨ï¼Œç”Ÿæˆç”¨ä¾‹</li>
</ul>
<h4 id="æ§åˆ¶ç”¨ä¾‹ç²’åº¦ï¼šæµ‹è¯•ç‚¹çš„ç»„åˆä¸æ‹†åˆ†"><a href="#æ§åˆ¶ç”¨ä¾‹ç²’åº¦ï¼šæµ‹è¯•ç‚¹çš„ç»„åˆä¸æ‹†åˆ†" class="headerlink" title="æ§åˆ¶ç”¨ä¾‹ç²’åº¦ï¼šæµ‹è¯•ç‚¹çš„ç»„åˆä¸æ‹†åˆ†"></a>æ§åˆ¶ç”¨ä¾‹ç²’åº¦ï¼šæµ‹è¯•ç‚¹çš„ç»„åˆä¸æ‹†åˆ†</h4><ul>
<li>ç»†ç²’åº¦èƒ½å¤Ÿæ›´åŠ ç²¾ç¡®å‘ç°é—®é¢˜ï¼Œä½†æ˜¯ç”¨ä¾‹æ•°é‡ä¼šè¿‡å¤šï¼›ç²—ç²’åº¦å¯ä»¥å‘ç°äº§å“è®¾è®¡ä¸Šã€åŸå‹ä¸Šçš„é—®é¢˜ï¼Œä½†æ˜¯å¯èƒ½æµ‹ä¸åˆ°ç»†èŠ‚</li>
<li>ä¸åŒé˜¶æ®µã€ä¸åŒä¸šåŠ¡åŠŸèƒ½ï¼Œé‡‡å–ä¸åŒçš„ç²’åº¦</li>
<li>ç­–ç•¥è¦†ç›–ï¼šæŸäº›å› å­/æ•°æ®ç±»æµ‹è¯•ç‚¹åœ¨å’Œå…¶ä»–æµ‹è¯•ç‚¹å…³ç³»è¾ƒå¼±çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨pairwiseæ­£äº¤ï¼Œå¯ä»¥è€ƒè™‘æŒ‰æ¯”ä¾‹åœ¨æµ‹è¯•ç”¨ä¾‹ä¸­è¿›è¡Œåˆ†é…</li>
<li>é”™è¯¯æ¨æ–­æ³•ï¼šæ ¹æ®ç»éªŒåˆ¤æ–­äº§å“åœ¨å“ªäº›åœ°æ–¹ä¼šå‡ºé—®é¢˜ï¼Œé’ˆå¯¹è¿™äº›é—®é¢˜è®¾è®¡æµ‹è¯•ç”¨ä¾‹</li>
</ul>
<h3 id="æ¢ç´¢å¼æµ‹è¯•"><a href="#æ¢ç´¢å¼æµ‹è¯•" class="headerlink" title="æ¢ç´¢å¼æµ‹è¯•"></a>æ¢ç´¢å¼æµ‹è¯•</h3><p>ä¸€è¾¹å­¦ä¹ ã€ä¸€è¾¹è®¾è®¡ã€ä¸€è¾¹æ‰§è¡Œ</p>
<h4 id="CPIE"><a href="#CPIE" class="headerlink" title="CPIE"></a>CPIE</h4><ul>
<li>æ”¶é›†ï¼ˆCollectionï¼‰ï¼šæ”¶é›†å¹¶ç†è§£å…³äºæµ‹è¯•å¯¹è±¡çš„ä¿¡æ¯</li>
<li>åˆ’åˆ†ä¼˜å…ˆçº§ï¼ˆPrioritizationï¼‰ï¼šå¯¹æ‰€æœ‰éœ€è¦æµ‹è¯•çš„ä»»åŠ¡è¿›è¡Œä¼˜å…ˆçº§åˆ’åˆ†</li>
<li>åˆ†æè°ƒç ”ï¼ˆInvestigation)ï¼šå¯¹æµ‹è¯•ä»»åŠ¡ä»”ç»†åˆ†æï¼Œé¢„æµ‹å¯èƒ½è¾“å‡ºçš„ç»“æœ</li>
<li>å®éªŒï¼ˆExperimentationï¼‰ï¼šè¿›è¡Œæµ‹è¯•å®éªŒï¼Œç¡®è®¤æµ‹è¯•ç»“æœå’Œé¢„æœŸæ˜¯å¦ç¬¦åˆï¼Œåˆ†ææ˜¯å¦æœ‰å¿…è¦æ”¹å˜æµ‹è¯•ç­–ç•¥ä¸æ–¹æ³•ã€‚è‹¥æœ‰å¿…è¦åˆ™é‡æ–°å›åˆ°æ”¶é›†é˜¶æ®µã€‚</li>
</ul>
<p>ä¼˜ç‚¹ï¼šæ›´å¿«æµ‹è¯•ï¼Œæ›´å¿«å¯»æ‰¾åˆ°æœ‰æ•ˆæµ‹è¯•ç‚¹ï¼Œæ›´é«˜æ•ˆå‘ç°ç¼ºé™·<br>ç¼ºç‚¹ï¼šåŸºæœ¬æµ‹è¯•è¦†ç›–æ˜“ä¸è¶³ï¼Œæµ‹è¯•ç‚¹ä¸æ˜“å¤ç”¨</p>
<h4 id="é€‰æ‹©åˆé€‚çš„æ¢ç´¢å¼æµ‹è¯•æ–¹æ³•"><a href="#é€‰æ‹©åˆé€‚çš„æ¢ç´¢å¼æµ‹è¯•æ–¹æ³•" class="headerlink" title="é€‰æ‹©åˆé€‚çš„æ¢ç´¢å¼æµ‹è¯•æ–¹æ³•"></a>é€‰æ‹©åˆé€‚çš„æ¢ç´¢å¼æµ‹è¯•æ–¹æ³•</h4><ul>
<li>äº§å“ç‰¹æ€§åˆ†åŒºã€‚æ ¹æ®ä¸åŒåˆ†åŒºï¼Œé€‰æ‹©ä¸åŒçš„æ¢ç´¢æµ‹è¯•æ–¹æ³•<ul>
<li>å†å²åŒºï¼šè€ä»£ç ä¸ç‰¹æ€§<ul>
<li>æ¶é‚»æµ‹è¯•æ³•ï¼šç¼ºé™·å¤šçš„ä»£ç æ®µï¼Œéœ€è¦å¤šèŠ±æ—¶é—´</li>
<li>åšç‰©é¦†æµ‹è¯•æ³•ï¼šè€çš„é—ç•™ä»£ç ä¸å¾ˆä¹…æ²¡æœ‰æ‰§è¡Œè¿‡çš„ç”¨ä¾‹éœ€è¦å’Œæ–°ä»£ç æœ‰ç›¸åŒçš„é‡è§†ç¨‹åº¦</li>
<li>ä¸Šä¸€ç‰ˆæœ¬æµ‹è¯•æ³•ï¼šæ£€æŸ¥æ–°ç‰ˆæœ¬æ— æ³•è¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿æ²¡æœ‰é—æ¼å¿…é¡»åŠŸèƒ½</li>
</ul>
</li>
<li>å•†ä¸šåŒºï¼šé”€å”®ç‰¹æ€§<ul>
<li>æŒ‡å—é’ˆæµ‹è¯•æ³•ï¼šé€šè¿‡é˜…è¯»ç”¨æˆ·æ‰‹å†Œã€åœºæ™¯ã€éœ€æ±‚ä»¥è¿›è¡Œæµ‹è¯•</li>
<li>å–ç‚¹æµ‹è¯•æ³•ï¼šå¯¹å¸å¼•ç”¨æˆ·çš„ç‰¹æ€§è¿›è¡Œæµ‹è¯•</li>
<li>åœ°æ ‡æµ‹è¯•æ³•ï¼šå¯»æ‰¾æµ‹è¯•ç‚¹ï¼Œæ˜ç¡®æµ‹è¯•é¡¹</li>
<li>æé™æµ‹è¯•æ³•ï¼šä»€ä¹ˆç‰¹æ€§èƒ½ä½¿è½¯ä»¶å‘æŒ¥æé™ï¼Ÿå“ªäº›è¾“å…¥ä¼šå½±å“è½¯ä»¶æ€§èƒ½ï¼Ÿ</li>
<li>å¿«é€’æµ‹è¯•æ³•ï¼šä¸“æ³¨äºæ•°æ®ä»è¾“å…¥åˆ°è¾“å‡ºçš„æ‰§è¡Œæµç¨‹</li>
<li>æ·±å¤œæµ‹è¯•æ³•ï¼šæµ‹è¯•å¯¹è±¡æ˜¯å¦èƒ½è‡ªåŠ¨å®Œæˆä»»åŠ¡ï¼Ÿå…¶ä¸­å¼‚å¸¸æ˜¯å¦è‡ªåŠ¨è®°å½•ï¼Ÿ</li>
<li>éå†æµ‹è¯•æ³•ï¼šé€‰å®šä¸€ä¸ªæµ‹è¯•ç›®æ ‡ï¼Œç”¨æœ€çŸ­è·¯å¾„è®¿é—®ç›®æ ‡åŒ…å«çš„æ‰€æœ‰å¯¹è±¡</li>
</ul>
</li>
<li>å¨±ä¹åŒºï¼šè¾…åŠ©ç‰¹æ€§<ul>
<li>é…è§’æµ‹è¯•æ³•ï¼šä¸“æ³¨äºç´§é‚»ä¸»è¦åŠŸèƒ½çš„è¾…åŠ©ç‰¹æ€§</li>
<li>æ·±å··æµ‹è¯•æ³•ï¼šæŠŠæœ€æµè¡Œä¸æœ€ä¸æµè¡Œçš„æ¨¡å—æ”¾åœ¨ä¸€èµ·æµ‹</li>
<li>é€šå®µæµ‹è¯•æ³•ï¼šæµ‹è¯•è½¯ä»¶é•¿æ—¶é—´è¿è¡Œåï¼Œå„æ¨¡å—æ˜¯å¦æ­£å¸¸</li>
</ul>
</li>
<li>ç ´æ—§åŒºï¼šé—®é¢˜é«˜å‘çš„ç‰¹æ€§<ul>
<li>ç ´åæµ‹è¯•æ³•ï¼šä¸“æ³¨ç¼ºé™·è¾ƒå¤šçš„ä»£ç æ®µ</li>
<li>åå›æµ‹è¯•æ³•ï¼šè¾“å…¥æœ€ä¸å¯èƒ½çš„æ•°æ®</li>
<li>å¼ºè¿«ç—‡æµ‹è¯•æ³•ï¼šå¼ºè¿«ä¸€éåˆä¸€éæ¥å—åŒæ ·çš„æ•°æ®</li>
</ul>
</li>
<li>æ—…é¦†åŒºï¼šå¹³å°æˆ–ç»´æŠ¤ç‰¹æ€§<ul>
<li>å–æ¶ˆæµ‹è¯•æ³•ï¼šå¯åŠ¨æŸäº›æ“ä½œï¼Œç„¶ååœæ­¢ï¼ŒæŸ¥çœ‹æµ‹è¯•å¯¹è±¡å¤„ç†æœºåˆ¶ä¸ååº”</li>
<li>æ‡’æ±‰æµ‹è¯•æ³•ï¼šè®©ç¨‹åºè‡ªè¡Œå¤„ç†ç©ºå­—æ®µ/è¿è¡Œé»˜è®¤å€¼</li>
</ul>
</li>
<li>æ—…æ¸¸åŒºï¼šå™±å¤´/ä¸€æ¬¡æ€§çš„ç‰¹æ€§â€”â€”å¿«é€Ÿè®¿é—®æ–‡ä»¶ä¹‹ç±»çš„å„ç§åŠŸèƒ½<ul>
<li>æ”¶è—å¤¹æµ‹è¯•æ³•ï¼šæŠŠè½¯ä»¶å¯è¾¾çš„è¾“å‡ºè¿›è¡Œéå†ä¸æ‰‹æœº</li>
<li>é•¿è·¯å¾„æµ‹è¯•æ³•ï¼šè®¿é—®ç¦»åº”ç”¨ç¨‹åºå¼€å§‹ç‚¹å°½é‡è¿œçš„ç‰¹æ€§ï¼Œåœ¨åˆ°è¾¾ç›®çš„åœ°å‰å°½å¯èƒ½åœ¨åº”ç”¨ç¨‹åºå†…ç©¿è¡Œ</li>
<li>è¶…æ¨¡æµ‹è¯•æ³•ï¼šå…³å¿ƒè¡¨é¢çš„ä¸œè¥¿ï¼ˆUIæ˜¾ç¤ºï¼‰</li>
<li>æµ‹ä¸€é€ä¸€æµ‹è¯•æ³•ï¼šæµ‹è¯•åŒä¸€ä¸ªç¨‹åºå¤šå¼€çš„æƒ…å†µ</li>
</ul>
</li>
<li>å…¶å®ƒåŒºï¼šä»£ç å˜åŠ¨ã€ç”¨æˆ·ä¸å…³å¿ƒä½†ç ”å‘å…³å¿ƒçš„å†…å®¹<ul>
<li>å†…éƒ¨æµ‹è¯•æ³•ï¼šæ”¶é›†è¿™ä¸ªåŠŸèƒ½å“ªäº›éƒ¨åˆ†å¯¹ç¡®è®¤æµ‹è¯•ç»“æœã€å®šä½é—®é¢˜æœ‰ç”¨çš„æµ‹è¯•è¾“å‡ºï¼Œç„¶åå…³å¿ƒå…¶æ•ˆæœ</li>
<li>å˜åŠ¨åŒºæµ‹è¯•æ³•ï¼šåˆ†æç‰ˆæœ¬å˜åŒ–ï¼Œåªé’ˆå¯¹å˜åŒ–å†…å®¹æµ‹è¯•</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="å¼€å±•æ¢ç´¢å¼æµ‹è¯•"><a href="#å¼€å±•æ¢ç´¢å¼æµ‹è¯•" class="headerlink" title="å¼€å±•æ¢ç´¢å¼æµ‹è¯•"></a>å¼€å±•æ¢ç´¢å¼æµ‹è¯•</h4><ul>
<li>ç¡®å®šä»»åŠ¡â€”â€”å…¨å±€åœºæ™¯ã€ç‰¹æ€§æ¼«æ¸¸ä¸å±€éƒ¨åŠŸèƒ½ç‚¹æ¢ç´¢</li>
<li>æ ¹æ®ä»»åŠ¡è®¾è®¡æ¢ç´¢åœ°å›¾<ul>
<li>ç°åœ¨æµ‹è¯•ä»€ä¹ˆï¼Œæ¥ä¸‹æ¥æµ‹è¯•ä»€ä¹ˆ</li>
<li>ç›´æ¥ä½¿ç”¨æµ‹è¯•ç‚¹æµ‹è¯•</li>
<li>æ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´æµ‹è¯•ç‚¹</li>
<li>è®¾å®šå®Œæˆæ—¶é—´</li>
</ul>
</li>
<li>æ¢ç´¢å¼æµ‹è¯•æ€»ç»“<ul>
<li>å“ªäº›æ–¹æ³•èƒ½å¤Ÿæœ‰æ•ˆå‘ç°äº§å“é—®é¢˜</li>
<li>æµ‹è¯•è¿‡ç¨‹å­˜åœ¨ä»€ä¹ˆä¸è¶³</li>
</ul>
</li>
</ul>
<h3 id="è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="è‡ªåŠ¨åŒ–æµ‹è¯•"></a>è‡ªåŠ¨åŒ–æµ‹è¯•</h3><h4 id="è‡ªåŠ¨åŒ–çš„ä¸è¶³"><a href="#è‡ªåŠ¨åŒ–çš„ä¸è¶³" class="headerlink" title="è‡ªåŠ¨åŒ–çš„ä¸è¶³"></a>è‡ªåŠ¨åŒ–çš„ä¸è¶³</h4><ul>
<li>æˆæœ¬é«˜ï¼ˆç»´æŠ¤ã€äººåŠ›ä¸æŠ€æœ¯ï¼‰</li>
<li>è„šæœ¬ä¸ä¸€å®šå¯é <ul>
<li>è„šæœ¬éš¾ä»¥æ•è·å¼‚å¸¸</li>
<li>å¤±è´¥çš„ç”¨ä¾‹ä¸ä¸€å®šæ˜¯é”™è¯¯</li>
</ul>
</li>
<li>ä¸èƒ½å•é æµ‹è¯•è§£å†³<ul>
<li>éœ€æ±‚ã€UIã€å‘½ä»¤è¡Œéœ€è¦ç¡®å®š</li>
</ul>
</li>
</ul>
<h4 id="è¯„ä¼°è‡ªåŠ¨åŒ–çš„æ”¶ç›Š"><a href="#è¯„ä¼°è‡ªåŠ¨åŒ–çš„æ”¶ç›Š" class="headerlink" title="è¯„ä¼°è‡ªåŠ¨åŒ–çš„æ”¶ç›Š"></a>è¯„ä¼°è‡ªåŠ¨åŒ–çš„æ”¶ç›Š</h4><p>æ€»æˆæœ¬ = å‰æœŸå¼€å‘ + åæœŸç»´æŠ¤æˆæœ¬</p>
<p>å‰æœŸå¼€å‘æˆæœ¬ï¼šäººåŠ›ã€æ—¶é—´ã€é‡‘é’±<br>åæœŸç»´æŠ¤æˆæœ¬ï¼šäº§å“å˜æ›´ã€å®šä½/ä¿®å¤è‡ªåŠ¨åŒ–è¿è¡Œç¯å¢ƒå¯é æ€§ä¸ä»£ç å¥å£®æ€§ï¼Œä»¥åŠå…¶å®ƒæ‚é¡¹å› ç´ </p>
<p>è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ”¶ç›Š = è‡ªåŠ¨åŒ–æµ‹è¯•çš„è¿è¡Œæ¬¡æ•°</p>
<p>å®æ–½æˆæœ¬è®¡ç®—æ–¹å¼ï¼šp = k * n / (c1 + c2)</p>
<ul>
<li>pï¼šæˆæœ¬</li>
<li>kï¼šæ‰‹å·¥æ‰§è¡Œè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰€èŠ±è´¹æ—¶é—´æˆæœ¬</li>
<li>nï¼šè‡ªåŠ¨åŒ–ç”¨ä¾‹æ‰§è¡Œæ¬¡æ•°</li>
<li>c1ï¼šå‰æœŸæˆæœ¬</li>
<li>c2ï¼šåæœŸç»´æŠ¤æˆæœ¬</li>
</ul>
<h2 id="ç¬¬äº”ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„è½¯èƒ½åŠ›ä¿®ç‚¼"><a href="#ç¬¬äº”ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„è½¯èƒ½åŠ›ä¿®ç‚¼" class="headerlink" title="ç¬¬äº”ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„è½¯èƒ½åŠ›ä¿®ç‚¼"></a>ç¬¬äº”ç« ï¼šè½¯ä»¶æµ‹è¯•æ¶æ„å¸ˆçš„è½¯èƒ½åŠ›ä¿®ç‚¼</h2><h3 id="æ²Ÿé€šå’Œåå•†"><a href="#æ²Ÿé€šå’Œåå•†" class="headerlink" title="æ²Ÿé€šå’Œåå•†"></a>æ²Ÿé€šå’Œåå•†</h3><p>åŸºæœ¬æ²Ÿé€šåŸåˆ™ï¼šå°½æ—©æ²Ÿé€šï¼Œæ—¢è¦å¯¹äº‹ï¼Œä¹Ÿè¦å¯¹äººâ€”â€”æ¢ä½æ€è€ƒï¼ˆäº†è§£é¡¹ç›®å„ç»„æˆå‘˜çš„ä¸šåŠ¡ä¸ç«‹åœºï¼‰</p>
<h3 id="å†™å¥½æµ‹è¯•ç”¨ä¾‹"><a href="#å†™å¥½æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="å†™å¥½æµ‹è¯•ç”¨ä¾‹"></a>å†™å¥½æµ‹è¯•ç”¨ä¾‹</h3><p>æµ‹è¯•ç”¨ä¾‹åŒ…å«ï¼š</p>
<ul>
<li>ç”¨ä¾‹æ ‡é¢˜ï¼ˆå®Œæ•´çš„å¥å­ï¼Œç”¨æ¡ä»¶æè¿°ï¼‰</li>
<li>å‰ç½®æ¡ä»¶</li>
<li>æµ‹è¯•æ•°æ®</li>
<li>æµ‹è¯•æ­¥éª¤</li>
<li>é¢„æœŸç»“æœï¼ˆä¸€ç§æ­¥éª¤ï¼Œå¯¹åº”ä¸€ç§ç»“æœï¼‰</li>
</ul>
<h2 id="ç¬¬å…­ç« ï¼šå¦‚ä½•æ‰èƒ½åˆ¶å®šå¥½æµ‹è¯•ç­–ç•¥"><a href="#ç¬¬å…­ç« ï¼šå¦‚ä½•æ‰èƒ½åˆ¶å®šå¥½æµ‹è¯•ç­–ç•¥" class="headerlink" title="ç¬¬å…­ç« ï¼šå¦‚ä½•æ‰èƒ½åˆ¶å®šå¥½æµ‹è¯•ç­–ç•¥"></a>ç¬¬å…­ç« ï¼šå¦‚ä½•æ‰èƒ½åˆ¶å®šå¥½æµ‹è¯•ç­–ç•¥</h2><h3 id="æµ‹è¯•ç­–ç•¥"><a href="#æµ‹è¯•ç­–ç•¥" class="headerlink" title="æµ‹è¯•ç­–ç•¥"></a>æµ‹è¯•ç­–ç•¥</h3><ul>
<li>æµ‹è¯•çš„å¯¹è±¡å’ŒèŒƒå›´</li>
<li>æµ‹è¯•çš„ç›®æ ‡</li>
<li>æµ‹è¯•çš„é‡ç‚¹å’Œéš¾ç‚¹</li>
<li>æµ‹è¯•çš„æ·±åº¦å’Œå¹¿åº¦</li>
<li>å¦‚ä½•å®‰æ’å„ç§æµ‹è¯•æ´»åŠ¨</li>
<li>å¦‚ä½•è¯„ä»·æµ‹è¯•çš„æ•ˆæœ</li>
</ul>
<p>ä¸å…¶å®ƒåè¯çš„ä¸åŒï¼š</p>
<ul>
<li>æµ‹è¯•æ–¹é’ˆï¼šäº§å“æµ‹è¯•é€šç”¨è¦æ±‚ã€åŸåˆ™ä¸åº•çº¿</li>
<li>æµ‹è¯•è®¡åˆ’ï¼šæµ‹è¯•ç­–ç•¥çš„æ‹†è§£ä¸æ—¶é—´èµ„æºçš„åˆ†é…</li>
<li>æµ‹è¯•æ–¹æ¡ˆï¼šè§£å†³åœ¨æµ‹è¯•è®¾è®¡å’Œæ‰§è¡Œæ–¹é¢çš„é—®é¢˜ï¼ˆä¸Šé¢6ä¸ªï¼‰</li>
</ul>
<h3 id="å››æ­¥æµ‹è¯•ç­–ç•¥åˆ¶å®šæ³•"><a href="#å››æ­¥æµ‹è¯•ç­–ç•¥åˆ¶å®šæ³•" class="headerlink" title="å››æ­¥æµ‹è¯•ç­–ç•¥åˆ¶å®šæ³•"></a>å››æ­¥æµ‹è¯•ç­–ç•¥åˆ¶å®šæ³•</h3><ul>
<li>æ˜ç¡®äº§å“è´¨é‡ç›®æ ‡<ul>
<li>æµ‹è¯•ç›®æ ‡ä¸ºæ»¡è¶³è´¨é‡ç›®æ ‡</li>
<li>å›´ç»•ç›®æ ‡è¿›è¡Œåˆšåˆšå¥½çš„æµ‹è¯•</li>
<li>å°†ç›®æ ‡â€”â€”è¡Œä¸ºâ€”â€”è¯„ä¼°å½¢æˆé—­ç¯</li>
</ul>
</li>
<li>é£é™©åˆ†æ<ul>
<li>æå‰è¯†åˆ«é˜»å¡æµ‹è¯•çš„é£é™©ï¼ŒåŸºäºé£é™©è°ƒæ•´æµ‹è¯•ç­–ç•¥</li>
<li>åŸºäºé£é™©åŠ å¼ºå’Œé™ä½æµ‹è¯•æŠ•å…¥</li>
</ul>
</li>
<li>é€‚é…äº§å“ç ”å‘æµç¨‹<ul>
<li>æŒ‰ç…§ç ”å‘æµç¨‹è®¾è®¡æµ‹è¯•ç­–ç•¥ç»“æ„<ul>
<li>æ¦‚å¿µé˜¶æ®µï¼ˆä¸‰æ–¹ï¼‰åˆ¶å®šæ€»ä½“æµ‹è¯•ç­–ç•¥</li>
<li>è®¡åˆ’é˜¶æ®µåˆ¶å®šé˜¶æ®µæ€§æµ‹è¯•ç­–ç•¥</li>
</ul>
</li>
<li>æ ¹æ®ç ”å‘æµç¨‹å®‰æ’æµ‹è¯•æ´»åŠ¨</li>
</ul>
</li>
<li>æµ‹è¯•åˆ†å±‚<ul>
<li>å°†å¤§çš„æµ‹è¯•ç›®æ ‡ï¼Œåˆ†åˆ°ä¸åŒå±‚æ¬¡ä¸­åˆ†é˜¶æ®µå®Œæˆ</li>
</ul>
</li>
</ul>
<h3 id="äº§å“è´¨é‡è¯„ä¼°æ¨¡å‹"><a href="#äº§å“è´¨é‡è¯„ä¼°æ¨¡å‹" class="headerlink" title="äº§å“è´¨é‡è¯„ä¼°æ¨¡å‹"></a>äº§å“è´¨é‡è¯„ä¼°æ¨¡å‹</h3><ul>
<li>å¤šç»´åº¦ï¼šè¦†ç›–è´¨é‡è¯„ä¼°å„ä¸ªç»´åº¦</li>
<li>å®šé‡+å®šæ€§ï¼šæŒ‡æ ‡ä¸åˆ†æç»“åˆ</li>
<li>è¿‡ç¨‹+ç»“æœï¼šé™¤äº†ç»“æœè¿˜è¦è¯„ä¼°æµ‹è¯•è¿‡ç¨‹</li>
</ul>
<p>è¯„ä¼°ç»´åº¦ï¼š</p>
<ul>
<li>æµ‹è¯•è¦†ç›–åº¦<ul>
<li>éœ€æ±‚è¦†ç›–åº¦è¯„ä¼°<ul>
<li>å·²ç»éªŒè¯æµ‹è¯•çš„äº§å“éœ€æ±‚æ•°ï¼šäº§å“éœ€æ±‚è§„æ ¼æ€»æ•°</li>
<li>ç›®æ ‡ä¸º100%</li>
<li>å»ºç«‹éœ€æ±‚è¡¨/ç”¨ä¾‹ä¸éœ€æ±‚çš„æ˜ å°„å…³ç³»</li>
</ul>
</li>
<li>è·¯å¾„è¦†ç›–åº¦åˆ†æ<ul>
<li>å·²ç»æµ‹è¯•çš„è¯­å¥æ•°é‡ï¼šç¨‹åºä¸­å¯æ‰§è¡Œè¯­å¥çš„æ€»æ•°</li>
<li>è¯­å¥ã€åˆ†æ”¯ã€å…¨ã€æœ€å°çº¿æ€§æ— å…³è¦†ç›–</li>
<li>ç¡®å®šè¦†ç›–ç­–ç•¥ï¼Œç”¨è·¯å¾„åˆ†ææ³•è®¾è®¡ç”¨ä¾‹å¹¶è·Ÿè¸ªæ‰§è¡Œ</li>
</ul>
</li>
</ul>
</li>
<li>æµ‹è¯•è¿‡ç¨‹<ul>
<li>æµ‹è¯•ç”¨ä¾‹åˆ†æ<ul>
<li>æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œç‡<ul>
<li>å·²ç»æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹æ•°ç›®ï¼šæµ‹è¯•ç”¨ä¾‹æ€»æ•°</li>
<li>æµ‹è¯•é˜»å¡/æœªæ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå½±å“æ‰§è¡Œç‡</li>
</ul>
</li>
<li>æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé€šè¿‡ç‡<ul>
<li>æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼šå·²ç»æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹æ•°ç›®</li>
</ul>
</li>
<li>æµ‹è¯•ç”¨ä¾‹å’Œéæµ‹è¯•ç”¨ä¾‹å‘ç°ç¼ºé™·æ¯”<ul>
<li>éæµ‹è¯•ç”¨ä¾‹ä¸ºå‘æ•£æ€§çš„æµ‹è¯•ï¼Œè¿™ä¸ªæ¯”å€¼ä¸èƒ½è¿‡ä½ï¼Œå¦åˆ™ç”¨ä¾‹è®¾è®¡æœ‰é—®é¢˜</li>
</ul>
</li>
</ul>
</li>
<li>æµ‹è¯•æ–¹æ³•åˆ†æ<ul>
<li>åˆ†ææµ‹è¯•è®¾è®¡å’Œæµ‹è¯•æ–¹æ³•æ˜¯å¦ç¬¦åˆ</li>
<li>åˆ†ææµ‹è¯•æ–¹æ³•å’Œæµ‹è¯•ç­–ç•¥æ˜¯å¦ç¬¦åˆ</li>
<li>é€šè¿‡ç¼ºé™·åˆ†æï¼Œåæ¨æµ‹è¯•æ–¹æ³•çš„å¯è¡Œæ€§</li>
</ul>
</li>
<li>æµ‹è¯•æŠ•å…¥åˆ†æ<ul>
<li>æµ‹è¯•äººå‘˜å®‰æ’ä¸æŠ•å…¥å·¥ä½œé‡</li>
</ul>
</li>
</ul>
</li>
<li>ç¼ºé™·<ul>
<li>ç¼ºé™·å¯†åº¦åˆ†æ<ul>
<li>æ¯åƒè¡Œä»£ç å‘ç°çš„bugæ•°</li>
<li>é¢„æµ‹äº§å“çš„ç¼ºé™·æ•°ï¼Œè¯„ä¼°å½“å‰å‘ç°çš„ç¼ºé™·æ˜¯å¦è¶³å¤Ÿå¤š</li>
</ul>
</li>
<li>ç¼ºé™·ä¿®å¤æƒ…å†µåˆ†æ<ul>
<li>ç¼ºé™·ä¿®å¤ç‡ï¼šå·²ç»ä¿®å¤ç¼ºé™·ï¼šå·²ç»å‘ç°ç¼ºé™·</li>
<li>åœ¨æ¯ä¸ªæµ‹è¯•åˆ†å±‚éƒ½è¦ç¡®å®šç¼ºé™·ä¿®å¤ç‡ç›®æ ‡</li>
<li>åœ¨æ¯ä¸ªåˆ†å±‚ç»“æŸåˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè¿›å…¥ä¸‹ä¸€é˜¶æ®µæµ‹è¯•</li>
<li>å¦‚æœæœ€ç»ˆç¼ºé™·ä¿®å¤ç‡ä¸èƒ½è¾¾åˆ°é¢„æœŸï¼Œç†è®ºä¸Šä¸èƒ½å‘å¸ƒäº§å“</li>
</ul>
</li>
<li>ç¼ºé™·è¶‹åŠ¿åˆ†æ<ul>
<li>åˆ¤æ–­å½“å‰ç³»ç»Ÿæ˜¯å¦èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°å‘å¸ƒç¼ºé™·</li>
<li>è§‚å¯Ÿå‡¹å‡¸æ€§å’Œæ‹ç‚¹ï¼Œåˆ†æåŸå› </li>
<li>å‘ç°ç¼ºé™·ä¸è§£å†³æ›²çº¿è¶‹åŠ¿æ”¶æ•›ï¼šå½“å‰æµ‹è¯•æ–¹æ³•å·²ç»æ— æ³•æœ‰æ•ˆå‘ä¿¡å•Šé—®é¢˜</li>
</ul>
</li>
<li>ç¼ºé™·å¹´é¾„åˆ†æ<ul>
<li>å®šä¹‰ï¼šç³»ç»Ÿäº§ç”Ÿ/å¼•å…¥ç¼ºé™·çš„æ—¶é—´<ul>
<li>ç»§æ‰¿/å†å²é—ç•™ï¼šå±äºå†å²ç‰ˆæœ¬ã€ç»§æ‰¿ç‰ˆæœ¬æˆ–ç§»æ¤ä»£ç å‡ºç°çš„é—®é¢˜</li>
<li>éœ€æ±‚é˜¶æ®µï¼šéœ€æ±‚ä¸æ¸…ã€éœ€æ±‚é”™è¯¯ã€ç³»ç»Ÿæ•´ä½“è®¾è®¡çš„é—®é¢˜</li>
<li>è®¾è®¡é˜¶æ®µï¼šåŠŸèƒ½æ¥å£/äº¤äº’ã€è¾¹ç•Œå€¼/æµç¨‹/ç®—æ³•è®¾è®¡çš„é—®é¢˜</li>
<li>ç¼–ç é˜¶æ®µï¼šæµç¨‹é€»è¾‘ã€ç®—æ³•ã€ç¼–ç¨‹è§„èŒƒï¼Œæ¥å£è§„èŒƒçš„é—®é¢˜</li>
<li>æ–°éœ€æ±‚/å˜æ›´ï¼šæ–°éœ€æ±‚æˆ–åŠŸèƒ½å®ç°å˜æ›´å¼•å‘</li>
<li>ç¼ºé™·ä¿®æ”¹ï¼šä¿®æ”¹ç¼ºé™·ï¼Œå¼•å…¥äº†æ–°çš„é—®é¢˜</li>
</ul>
</li>
<li>åˆ†ææ–¹æ³•<ul>
<li>ç¡®å®šç¼ºé™·å¹´é¾„ï¼ˆbugzillaï¼‰</li>
<li>ç»Ÿè®¡å„ç±»ç¼ºé™·å¹´é¾„çš„æ•°é‡ï¼Œç»˜åˆ¶ç¼ºé™·å¹´é¾„åˆ†æå›¾</li>
<li>è¿›è¡Œåˆ†æã€‚ç†æƒ³æƒ…å†µå¦‚ä¸‹ï¼š<ul>
<li>åœ¨ç¼ºé™·çš„å¼•å…¥é˜¶æ®µå°±èƒ½åŠæ—¶å‘ç°è¯¥ç±»ç¼ºé™·ï¼Œä¸ä¼šé€ƒé€¸åˆ°ä¸‹ä¸ªé˜¶æ®µ</li>
<li>åœ¨ç‰¹å®šçš„åˆ†å±‚å‘ç°è¯¥åˆ†å±‚çš„é—®é¢˜</li>
<li>æ²¡æœ‰ç»§æ‰¿/å†å²é—ç•™/æ–°éœ€æ±‚/ç¼ºé™·ä¿®æ”¹å¼•å…¥çš„ç¼ºé™·</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>ç¼ºé™·è§¦å‘å› ç´ åˆ†æ<ul>
<li>ç¼ºé™·è§¦å‘å› ç´ è¶Šå…¨é¢ï¼Œè¯´æ˜æµ‹è¯•æ–¹æ³•è¶Šå¤šï¼Œæµ‹è¯•ä¹Ÿä¼šè¶Šæ·±å…¥</li>
<li>ç¡®å®šç¼ºé™·çš„ç¡®å®æ–¹æ³•å’Œç±»å‹ï¼Œç»Ÿè®¡ç¼ºé™·æ•°ç›®ï¼Œç»˜åˆ¶ç¼ºé™·è§¦å‘å› ç´ æŸ±çŠ¶å›¾åˆ†æ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="é£é™©åˆ†ææŠ€æœ¯"><a href="#é£é™©åˆ†ææŠ€æœ¯" class="headerlink" title="é£é™©åˆ†ææŠ€æœ¯"></a>é£é™©åˆ†ææŠ€æœ¯</h3><ul>
<li>åˆ†æå¯¹è±¡ï¼šæµ‹è¯•ç­–ç•¥</li>
<li>åˆ†æç›®æ ‡ï¼šè¯†åˆ«å¯èƒ½é˜»å¡æµ‹è¯•ç­–ç•¥é¡ºåˆ©è¿›è¡Œçš„é—®é¢˜</li>
</ul>
<h4 id="é£é™©è¯†åˆ«"><a href="#é£é™©è¯†åˆ«" class="headerlink" title="é£é™©è¯†åˆ«"></a>é£é™©è¯†åˆ«</h4><ul>
<li>åˆ†ææµ‹è¯•è®¾è®¡å…³æ³¨å“ªäº›å†…å®¹ï¼Œæ¯”å¦‚é’ˆå¯¹æŸä¸ªç‰¹æ€§è¿›è¡Œæµ‹è¯•éœ€è¦é€šè¿‡è·¯å¾„åˆ†ææ³•è¦†ç›–ï¼Œç„¶åéœ€è¦è¿›è¡ŒåŠŸèƒ½äº¤äº’ã€å‹åŠ›æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ç­‰æµ‹è¯•æ‰‹æ®µ</li>
<li>åˆ†æä¸Šè¿°å†…å®¹ä¿è¯é¡ºåˆ©è¿›è¡Œï¼Œéœ€è¦å“ªäº›æ¡ä»¶ï¼Œæ¯”å¦‚æ–‡æ¡£/æ²Ÿé€šé¡ºåˆ©ã€æµ‹è¯•äººå‘˜å¯¹åœºæ™¯æœ‰æ·±åšç†è§£ã€èƒ½å¤ŸæŒæ¡æµ‹è¯•æ–¹æ³•ç­‰å› ç´ </li>
<li>æ ¹æ®ç¼ºå¤±çš„å› ç´ ï¼Œè¯†åˆ«é£é™©</li>
</ul>
<h4 id="é£é™©è¯„ä¼°"><a href="#é£é™©è¯„ä¼°" class="headerlink" title="é£é™©è¯„ä¼°"></a>é£é™©è¯„ä¼°</h4><ul>
<li>é£é™©ä¼˜å…ˆçº§æ­£äº¤è¡¨ï¼ˆé£é™©å½±å“ç¨‹åº¦ X é£é™©å‘ç”Ÿé¢‘ç‡ï¼‰</li>
<li>éœ€æ±‚ç±»é£é™©<ul>
<li>éœ€æ±‚è´¨é‡ä¸é«˜ï¼Œä¸è¶³ä»¥æ”¯æ’‘åç»­å¼€å‘æµ‹è¯•</li>
<li>å¼€å‘æµ‹è¯•éƒ½æœªèƒ½ç†è§£éœ€æ±‚</li>
</ul>
</li>
<li>è®¾è®¡ç±»é£é™©<ul>
<li>è®¾è®¡æ­£ç¡®æ€§ä¸å…¨é¢æ€§</li>
<li>æµ‹è¯•å®¹æ˜“å‘ç°ç¼ºé™·å—ï¼Ÿå¼€å‘ä¿®å¤æˆæœ¬å¤§å—ï¼Ÿæµ‹è¯•å›å½’æˆæœ¬å¤§å—ï¼Ÿå¯¹ç”¨æˆ·å½±å“å¤§å—ï¼Ÿ</li>
</ul>
</li>
<li>é£é™©åº”å¯¹<ul>
<li>å›é¿ã€è½¬ç§»ã€å‡è½»ã€æ”¹å˜</li>
</ul>
</li>
<li>è€åŠŸèƒ½åˆ†æ<ul>
<li>å·®å¼‚åˆ†æ</li>
<li>å†å²æµ‹è¯•æƒ…å†µåˆ†æ<ul>
<li>è€åŠŸèƒ½åœ¨æ–°ç‰ˆæœ¬è´¨é‡è¦æ±‚æ˜¯å¦æå‡</li>
<li>è€åŠŸèƒ½ç¼ºé™·ä¸æµ‹è¯•æ–¹æ³•åˆ†æ</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="åˆ†å±‚æµ‹è¯•æŠ€æœ¯"><a href="#åˆ†å±‚æµ‹è¯•æŠ€æœ¯" class="headerlink" title="åˆ†å±‚æµ‹è¯•æŠ€æœ¯"></a>åˆ†å±‚æµ‹è¯•æŠ€æœ¯</h3><h4 id="Væ¨¡å‹"><a href="#Væ¨¡å‹" class="headerlink" title="Væ¨¡å‹"></a>Væ¨¡å‹</h4><p><img src="/uploads/testlife/test_architect_notes/v_model.png" alt="væ¨¡å‹" title="&#39;væ¨¡å‹&#39;"></p>
<ul>
<li>å•å…ƒæµ‹è¯•ï¼šäº§å“å®ç°å‡½æ•°å•å…ƒ</li>
<li>é›†æˆæµ‹è¯•ï¼šäº§å“æ¨¡å—ä¸åŠŸèƒ½</li>
<li>ç³»ç»Ÿæµ‹è¯•ï¼šä»ç³»ç»Ÿè§’åº¦éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£ç¡®</li>
<li>éªŒæ”¶æµ‹è¯•ï¼šä»ç”¨æˆ·è§’åº¦ç¡®è®¤äº§å“æ˜¯å¦æ»¡è¶³ä¸šåŠ¡éœ€æ±‚</li>
</ul>
<p>é€šä¿¡å…¬å¸çš„åˆ†å±‚ï¼š</p>
<ul>
<li>è¯¦ç»†è®¾è®¡çº§<ul>
<li>æ¨¡å—çº§ç³»ç»Ÿæµ‹è¯•ï¼ˆMSTï¼‰</li>
<li>è”è°ƒï¼ˆBBITï¼‰</li>
</ul>
</li>
<li>æ¦‚è¦è®¾è®¡çº§<ul>
<li>ç³»ç»Ÿè®¾è®¡ç¡®è®¤ï¼ˆSDVï¼‰</li>
<li>ç³»ç»Ÿé›†æˆæµ‹è¯•ï¼ˆSITï¼‰</li>
<li>ç³»ç»ŸéªŒè¯æµ‹è¯•ï¼ˆSVTï¼‰</li>
</ul>
</li>
</ul>
<p>æ•æ·ç¯å¢ƒä¸‹çš„åˆ†å±‚ï¼š</p>
<ul>
<li>å•å…ƒæµ‹è¯•</li>
<li>åŠŸèƒ½æµ‹è¯•</li>
<li>éåŠŸèƒ½æµ‹è¯•</li>
<li>æ¢ç´¢æµ‹è¯•</li>
</ul>
<h2 id="ç¬¬ä¸ƒç« ï¼šæµ‹è¯•ç­–ç•¥å®æˆ˜æ”»ç•¥"><a href="#ç¬¬ä¸ƒç« ï¼šæµ‹è¯•ç­–ç•¥å®æˆ˜æ”»ç•¥" class="headerlink" title="ç¬¬ä¸ƒç« ï¼šæµ‹è¯•ç­–ç•¥å®æˆ˜æ”»ç•¥"></a>ç¬¬ä¸ƒç« ï¼šæµ‹è¯•ç­–ç•¥å®æˆ˜æ”»ç•¥</h2><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><p>åˆ¶å®šæµ‹è¯•ç­–ç•¥ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>é¡¹ç›®çš„èŒƒå›´</li>
<li>äººåŠ›æŠ•å…¥</li>
<li>å†å²æƒ…å†µ</li>
</ul>
<p>ç„¶åé‡‡ç”¨å››æ­¥æµ‹è¯•ç­–ç•¥åˆ¶å®šæ³•ï¼š</p>
<ul>
<li>æ˜ç¡®äº§å“è´¨é‡ç›®æ ‡</li>
<li>è¿›è¡Œé£é™©åˆ†æ</li>
<li>é€‚é…äº§å“å¼€å‘æµç¨‹</li>
<li>è¿›è¡Œæµ‹è¯•åˆ†å±‚</li>
</ul>
<p>äº§å“åˆ†ä¸º4ä¸ªç­‰çº§ï¼š</p>
<ul>
<li>å®Œå…¨å•†ç”¨ï¼šå®Œå…¨æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œå°‘é‡æˆ–è€…æ²¡æœ‰é—ç•™é—®é¢˜ï¼Œç”¨æˆ·ä½¿ç”¨æ— é™åˆ¶</li>
<li>å—é™å•†ç”¨ï¼šç‰¹æ€§æ— æ³•æ»¡è¶³ç”¨æˆ·ç‰¹å®šåœºæ™¯ï¼Œæœ‰æ™®é€šä»¥ä¸Šçš„é—ç•™é—®é¢˜ï¼Œä½†æœ‰è§„é¿æªæ–½</li>
<li>æµ‹è¯•ã€æ¼”ç¤ºæˆ–è€…å°èŒƒå›´è¯•ç”¨ï¼šç‰¹æ€§åªæ»¡è¶³ç”¨æˆ·éƒ¨åˆ†éœ€æ±‚ï¼Œæœ‰ä¸¥é‡ä»¥ä¸Šé—ç•™é—®é¢˜ï¼Œæ— è§„é¿æªæ–½ï¼ˆBetaï¼‰</li>
<li>ä¸èƒ½ä½¿ç”¨ï¼šç‰¹æ€§æ— æ³•æ»¡è¶³ç”¨æˆ·éœ€æ±‚ï¼Œå­˜åœ¨ä¸¥é‡ä»¥ä¸Šçš„é—ç•™é—®é¢˜</li>
</ul>
<p>å¯¹äº§å“æ¯ä¸ªç‰¹æ€§ï¼Œä¹Ÿæ ¹æ®å››ä¸ªè´¨é‡ç­‰çº§æ¥åˆ’åˆ†ã€‚å°†ç‰¹æ€§çš„è´¨é‡ç›®æ ‡ç¡®å®šåï¼Œå°±å¯ä»¥è¿›è¡Œé£é™©åˆ†æ<br>é£é™©åˆ†æåå°±èƒ½å¤Ÿç¡®å®šæµ‹è¯•ç­–ç•¥çš„ç»“æ„ï¼Œå¯ä»¥é‡‡ç”¨æ€»åˆ†å¼</p>
<ul>
<li>æ€»ä½“æµ‹è¯•ç­–ç•¥ï¼ˆæ¦‚å¿µä¸è®¡åˆ’é˜¶æ®µï¼‰</li>
<li>é˜¶æ®µæµ‹è¯•ç­–ç•¥ï¼ˆè®¡åˆ’ä¸å¼€å‘é˜¶æ®µï¼‰</li>
<li>æµ‹è¯•æ‰§è¡Œï¼ˆå¼€å‘ã€éªŒè¯ã€å‘å¸ƒï¼‰</li>
</ul>
<h3 id="æ€»ä½“æµ‹è¯•ç­–ç•¥"><a href="#æ€»ä½“æµ‹è¯•ç­–ç•¥" class="headerlink" title="æ€»ä½“æµ‹è¯•ç­–ç•¥"></a>æ€»ä½“æµ‹è¯•ç­–ç•¥</h3><p>å¯¹è´¨é‡ç›®æ ‡è¿›è¡Œåˆ†è§£ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>æµ‹è¯•è¦†ç›–åº¦<ul>
<li>éœ€æ±‚è¦†ç›–åº¦</li>
<li>è·¯å¾„è¦†ç›–åº¦</li>
</ul>
</li>
<li>æµ‹è¯•è¿‡ç¨‹<ul>
<li>ç”¨ä¾‹æ‰§è¡Œç‡</li>
<li>æµ‹è¯•ç”¨ä¾‹ä¸éæµ‹è¯•ç”¨ä¾‹å‘ç°ç¼ºé™·æ¯”</li>
</ul>
</li>
<li>ç¼ºé™·<ul>
<li>å¯†åº¦</li>
<li>ä¿®å¤ç‡</li>
</ul>
</li>
</ul>
<p>å¹¶ä¸ºæ¯ä¸€ä¸ªæµ‹è¯•åˆ†å±‚ç¡®å®šç›®æ ‡ï¼Œé‡‡ç”¨è€åŠŸèƒ½åˆ†ææ³•å¯¹ç‰¹æ€§è¿›è¡Œåˆ†ç±»ã€‚</p>
<ul>
<li>å“ªäº›ç‰¹æ€§æ˜¯æ–°å¼€å‘çš„</li>
<li>å“ªäº›æ˜¯ä»è€ç‰ˆæœ¬ç»§æ‰¿çš„</li>
<li>å“ªäº›ç‰¹æ€§çš„æ”¹åŠ¨æ¯”è¾ƒå¤§</li>
<li>ä»è€ç‰ˆæœ¬ç»§æ‰¿ç‰¹æ€§çš„å†å²æƒ…å†µ</li>
</ul>
<p>æ–°ç‰¹æ€§è¿›è¡Œå…¨é¢æµ‹è¯•ï¼Œè€ç‰¹æ€§å¯¹å˜åŒ–çš„éƒ¨åˆ†è¿›è¡Œå…¨é¢æµ‹è¯•ï¼Œæ²¡æœ‰å˜åŒ–çš„å¯ä»¥é€‚é‡å›å½’+æ¢ç´¢</p>
<h4 id="æµ‹è¯•æ·±åº¦å’Œå¹¿åº¦"><a href="#æµ‹è¯•æ·±åº¦å’Œå¹¿åº¦" class="headerlink" title="æµ‹è¯•æ·±åº¦å’Œå¹¿åº¦"></a>æµ‹è¯•æ·±åº¦å’Œå¹¿åº¦</h4><ul>
<li>æµ‹è¯•æ·±åº¦ï¼šæµ‹è¯•è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨çš„æµ‹è¯•æ–¹æ³•</li>
<li>æµ‹è¯•å¹¿åº¦ï¼šæµ‹è¯•çš„èŒƒå›´</li>
</ul>
<p>é€šè¿‡äº§å“è´¨é‡è¯„ä¼°æ¨¡å‹ä¸è€åŠŸèƒ½åˆ†æï¼Œå¯ä»¥åˆæ­¥ç¡®å®šæµ‹è¯•æ·±åº¦ï¼š</p>
<ul>
<li>åŠŸèƒ½æµ‹è¯•ï¼ˆdemoåªç”¨åŠŸèƒ½æµ‹è¯•å³å¯ï¼‰</li>
<li>æ€§èƒ½æµ‹è¯•</li>
<li>å¯é æ€§ã€æ˜“ç”¨æ€§æµ‹è¯•</li>
</ul>
<p>è€åŠŸèƒ½åˆ†æå¯ä»¥ç”¨æ¥ç¡®è®¤æµ‹è¯•å¹¿åº¦ï¼š</p>
<ul>
<li>æµ‹è¯•è¦†ç›–åº¦ã€æµ‹è¯•è¿‡ç¨‹ã€ç¼ºé™·ï¼Œæ˜¯å¦å…¨é¢æµ‹è¯•</li>
</ul>
<p>ä¹‹åæ ¹æ®è´¨é‡ç›®æ ‡ä¸åˆ†ç±»ï¼Œç¡®å®šæµ‹è¯•ä¼˜å…ˆçº§ä¸æ€»ä½“æ¡†æ¶ï¼š</p>
<ul>
<li>ç­–ç•¥å±‚ï¼šæ€»ä½“ã€é˜¶æ®µã€æµ‹è¯•æ‰§è¡Œç­–ç•¥</li>
<li>æ´»åŠ¨å±‚ï¼šæµ‹è¯•åˆ†æã€è®¾è®¡ï¼Œå•å…ƒã€é›†æˆã€ç³»ç»Ÿã€éªŒæ”¶æµ‹è¯•</li>
<li>ä¿è¯å±‚ï¼šéœ€æ±‚ã€å¼€å‘è®¾è®¡ã€æµ‹è¯•è®¾è®¡review</li>
</ul>
<h3 id="é˜¶æ®µæµ‹è¯•ç­–ç•¥"><a href="#é˜¶æ®µæµ‹è¯•ç­–ç•¥" class="headerlink" title="é˜¶æ®µæµ‹è¯•ç­–ç•¥"></a>é˜¶æ®µæµ‹è¯•ç­–ç•¥</h3><p>é‡‡ç”¨æµ‹è¯•åˆ†æè®¾è®¡è¡¨ä¿è¯æµ‹è¯•è®¾è®¡ç¬¦åˆç­–ç•¥</p>
<ul>
<li>æµ‹è¯•åˆ†æå‡†å¤‡è¡¨<ul>
<li>è¢«æµ‹å¯¹è±¡é…ç½®åœ¨æµ‹è¯•è®¾è®¡ä¸­éœ€è¦è€ƒè™‘å“ªäº›æµ‹è¯•æ–¹æ³•ä»¥åŠåŠŸèƒ½äº¤äº’</li>
<li>æµ‹è¯•ç‚¹çš„è€ƒè™‘ï¼šåŠŸèƒ½ã€å®‰å…¨ã€ä¸€è‡´æ€§ã€æ€§èƒ½ã€æ˜“ç”¨æ€§ç­‰</li>
<li>åŠŸèƒ½äº¤äº’ï¼šå®‰å…¨ç‰¹æ€§ã€VLAN</li>
</ul>
</li>
<li>æµ‹è¯•ç±»å‹åˆ†æè¡¨<ul>
<li>å¯¹å¾…åˆ†æçš„æ¯ä¸€æ¡éœ€æ±‚ï¼Œé€ä¸€åˆ†æå„æµ‹è¯•ç±»å‹ä¸‹æ˜¯å¦æœ‰æµ‹è¯•ç‚¹</li>
</ul>
</li>
<li>åŠŸèƒ½äº¤äº’åˆ†æè¡¨<ul>
<li>éœ€è¦è¿›è¡Œäº¤äº’åˆ†æçš„åŠŸèƒ½ä¸å¯¹åº”æµ‹è¯•ç‚¹çš„å…³ç³»</li>
</ul>
</li>
</ul>
<p>ä¹‹åå¯ä»¥å¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†çº§</p>
<h4 id="é›†æˆæµ‹è¯•"><a href="#é›†æˆæµ‹è¯•" class="headerlink" title="é›†æˆæµ‹è¯•"></a>é›†æˆæµ‹è¯•</h4><p>é›†æˆæµ‹è¯•ä½äºå¼€å‘é˜¶æ®µï¼Œç›¸å½“äºè”è°ƒã€‚é›†æˆæµ‹è¯•æ˜¯é»‘ç›’æ€§è´¨çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ é¡¹ï¼š</p>
<ul>
<li>æ–°åˆå…¥åŠŸèƒ½æ˜¯å¦æ­£ç¡®</li>
<li>éªŒè¯åŠŸèƒ½é›†æˆåç³»ç»ŸåŠŸèƒ½çš„æ­£ç¡®æ€§</li>
<li>ç¡®è®¤åŸæ¥çš„ç³»ç»ŸåŠŸèƒ½æ²¡æœ‰è¢«æ–°åˆå…¥çš„åŠŸèƒ½ç ´å</li>
</ul>
<p>é›†æˆæµ‹è¯•çš„æ¡ä»¶ï¼ˆå…¥å£å‡†åˆ™ï¼‰ï¼š</p>
<ul>
<li>è®¡åˆ’çš„åŠŸèƒ½å¼€å‘å®Œæˆï¼Œå®Œæˆäº†å•å…ƒæµ‹è¯•</li>
<li>åŠŸèƒ½é›†æˆå®Œæˆï¼Œå¯æµ‹ï¼Œæä¾›ç”¨æˆ·çš„è¾“å…¥è¾“å‡ºæ¥å£</li>
<li>æµ‹è¯•å›¢é˜Ÿåšå¥½å‡†å¤‡<ul>
<li>æµ‹è¯•ç”¨ä¾‹å·²ç»è¾“å‡ºï¼Œå¹¶é€šè¿‡è¯„å®¡</li>
<li>æµ‹è¯•èµ„æºå·²ç»åˆ°ä½</li>
<li>æµ‹è¯•ç¯å¢ƒå·²ç»å‡†å¤‡å¥½</li>
</ul>
</li>
</ul>
<p>é›†æˆæµ‹è¯•ç»“æŸæ¡ä»¶ï¼ˆå‡ºå£å‡†åˆ™ï¼‰ï¼š</p>
<ul>
<li>ç³»ç»Ÿéœ€è¦ç»§æ‰¿çš„åŠŸèƒ½å·²ç»å…¨éƒ¨å¼€æ”¾ï¼Œé›†æˆå®Œæˆ</li>
<li>è®¡åˆ’æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹å·²ç»å®Œæˆ</li>
<li>ç¼ºé™·åˆ†æçš„ç»“æœç¬¦åˆé¢„æœŸ</li>
<li>è¾¾åˆ°äº†é›†æˆæµ‹è¯•é˜¶æ®µçš„äº§å“è´¨é‡ç›®æ ‡</li>
</ul>
<h4 id="ç³»ç»Ÿæµ‹è¯•"><a href="#ç³»ç»Ÿæµ‹è¯•" class="headerlink" title="ç³»ç»Ÿæµ‹è¯•"></a>ç³»ç»Ÿæµ‹è¯•</h4><p>ç³»ç»Ÿæµ‹è¯•ä¸»è¦æ˜¯é’ˆå¯¹å…¨å±€ï¼Œè€Œéåƒé›†æˆæµ‹è¯•ä¸€æ ·é’ˆå¯¹å•ä¸ªåŠŸèƒ½</p>
<ul>
<li>ä»ç³»ç»Ÿè§’åº¦éªŒè¯æµ‹è¯•åŠŸèƒ½çš„æ­£ç¡®æ€§</li>
<li>ä»ç³»ç»Ÿè§’åº¦æ¥éªŒè¯å„ç§éåŠŸèƒ½çš„è´¨é‡çš„æ­£ç¡®æ€§</li>
</ul>
<p>å…¥å£å‡†åˆ™ï¼š</p>
<ul>
<li>é›†æˆæµ‹è¯•çš„å‡ºå£å‡†åˆ™</li>
<li>æµ‹è¯•å›¢é˜Ÿå·²ç»åšå¥½å‡†å¤‡</li>
</ul>
<p>ç³»ç»Ÿæµ‹è¯•ä¼šå¯¹åŠŸèƒ½ã€å¯é æ€§ã€æ€§èƒ½ã€æ˜“ç”¨æ€§ç­‰å„æ–¹é¢è¿›è¡Œæµ‹è¯•ï¼Œä¸è€ƒè™‘æµ‹è¯•æ‰§è¡Œé¡ºåºå®¹æ˜“é˜»å¡ï¼Œéœ€è¦è€ƒè™‘ä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>å…ˆè¿›è¡Œç¨³å®šæµ‹è¯•ï¼Œå†è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæœ€åè¿›è¡Œæ¢å¤æµ‹è¯•</li>
<li>å…ˆè¿›è¡Œå¤æ‚çš„ã€éš¾çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå†è¿›è¡Œç®€å•çš„</li>
<li>å°†åŠŸèƒ½æµ‹è¯•çš„æµ‹è¯•ç”¨ä¾‹å’Œæ»¡è§„æ ¼çš„æµ‹è¯•ç”¨ä¾‹æ”¾åœ¨ä¸€èµ·è¿›è¡Œ</li>
</ul>
<p>å‡ºå£å‡†åˆ™ï¼š</p>
<ul>
<li>è®¡åˆ’æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹éƒ½å·²ç»å®Œæˆ</li>
<li>ç¼ºé™·åˆ†æçš„ç»“æœç¬¦åˆé¢„æœŸ</li>
<li>è¾¾åˆ°äº†ç³»ç»Ÿæµ‹è¯•é˜¶æ®µäº§å“è´¨é‡ç›®æ ‡</li>
</ul>
<h4 id="éªŒæ”¶æµ‹è¯•"><a href="#éªŒæ”¶æµ‹è¯•" class="headerlink" title="éªŒæ”¶æµ‹è¯•"></a>éªŒæ”¶æµ‹è¯•</h4><p>äº§å“å‘å¸ƒå‰çš„æµ‹è¯•ï¼Œæ˜¯å¯¹ç”¨æˆ·éœ€æ±‚çš„ç¡®è®¤</p>
<ul>
<li>Alphaæµ‹è¯•<ul>
<li>ç”±æµ‹è¯•äººå‘˜æ¨¡æ‹Ÿç”¨æˆ·è¿›è¡Œçš„æµ‹è¯•ï¼Œåº”è¯¥æ˜¯ä¸å¤ªäº†è§£äº§å“ç»†èŠ‚ï¼Œä½†å¯¹ç”¨æˆ·éå¸¸äº†è§£çš„äººã€‚Alphaæµ‹è¯•éœ€è¦å…³æ³¨ä»¥ä¸‹çš„å†…å®¹ï¼š<ul>
<li>ç”¨æˆ·ä¼šå¦‚ä½•å­¦ä¹ äº§å“ï¼Ÿäº§å“æä¾›çš„å¸®åŠ©æ˜¯å¦åˆ‡å®ï¼Ÿ</li>
<li>ç”¨æˆ·å°†äº§å“å®‰è£…åœ¨æ€æ ·çš„ç¯å¢ƒä¸­ï¼Ÿå‡çº§å¯¹ç”¨æˆ·çš„å½±å“æ˜¯å¦åœ¨å®¹å¿èŒƒå›´å†…ï¼Ÿ</li>
<li>ç”¨æˆ·ç¯å¢ƒä¸­å“ªäº›ä¸šåŠ¡æ—¶éœ€è¦å…³æ³¨çš„ï¼Ÿä¸éœ€è¦å…³æ³¨çš„ä¸šåŠ¡æ€ä¹ˆå¤„ç†ï¼Ÿ</li>
<li>etc</li>
</ul>
</li>
</ul>
</li>
<li>Betaæµ‹è¯•<ul>
<li>ç”±ç”¨æˆ·å‚åŠ çš„æµ‹è¯•ï¼Œå¸¸è§æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š<ul>
<li>äº§å“æ­£å¼å‘å¸ƒå‰å°†äº§å“æå‰å‘ç»™ç”¨æˆ·ï¼Œæ”¶é›†åé¦ˆ</li>
<li>äº§å“å¼€å‘å®Œæˆåï¼Œäº¤ç”±ç”¨æˆ·å¯¹äº§å“è¿›è¡ŒéªŒæ”¶</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>éªŒæ”¶æµ‹è¯•çš„å…¥å£å‡†åˆ™ï¼š</p>
<ul>
<li>ç³»ç»Ÿæµ‹è¯•çš„å‡ºå£å‡†åˆ™</li>
<li>Alphaæµ‹è¯•äººå‘˜ã€æ–¹æ¡ˆå·²ç»é€‰å¥½</li>
<li>Betaæµ‹è¯•çš„ç”¨æˆ·å·²ç»ç¡®å®š</li>
</ul>
<p>å‡ºå£å‡†åˆ™ï¼š</p>
<ul>
<li>è¾¾åˆ°äº§å“è´¨é‡ç›®æ ‡</li>
</ul>
<h2 id="ç¬¬å…«ç« ï¼šç‰ˆæœ¬æµ‹è¯•ç­–ç•¥å’Œäº§å“è´¨é‡è¯„ä¼°"><a href="#ç¬¬å…«ç« ï¼šç‰ˆæœ¬æµ‹è¯•ç­–ç•¥å’Œäº§å“è´¨é‡è¯„ä¼°" class="headerlink" title="ç¬¬å…«ç« ï¼šç‰ˆæœ¬æµ‹è¯•ç­–ç•¥å’Œäº§å“è´¨é‡è¯„ä¼°"></a>ç¬¬å…«ç« ï¼šç‰ˆæœ¬æµ‹è¯•ç­–ç•¥å’Œäº§å“è´¨é‡è¯„ä¼°</h2><p>ç‰ˆæœ¬æµ‹è¯•æ—¶ï¼Œåº”å½“æœ‰ä¸€ä»½ç‰ˆæœ¬è®¡åˆ’ä¸ä¸€ä»½æµ‹è¯•è®¡åˆ’ï¼Œåˆ†åˆ«ç”±å¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜è¾“å‡º</p>
<ul>
<li>ç‰ˆæœ¬è®¡åˆ’<ul>
<li>å‡ ä¸ªbuildï¼Œæ¯ä¸ªbuildåˆæˆä»€ä¹ˆåŠŸèƒ½</li>
</ul>
</li>
<li>æµ‹è¯•è®¡åˆ’<ul>
<li>é›†æˆæµ‹è¯•ã€ç³»ç»Ÿæµ‹è¯•ä¸éªŒæ”¶æµ‹è¯•éœ€è¦æµ‹è¯•å¤šå°‘ä¸ªç‰ˆæœ¬</li>
<li>æ¯ä¸ªç‰ˆæœ¬çš„ä¸»è¦æµ‹è¯•ç›®æ ‡</li>
</ul>
</li>
</ul>
<p>ç‰ˆæœ¬æµ‹è¯•ä¸»è¦å·¥ä½œæ˜¯æŒ‡å®šç‰ˆæœ¬æµ‹è¯•ç­–ç•¥ï¼Œç„¶åè·Ÿè¿›æµ‹è¯•æ‰§è¡Œå¹¶è¿›è¡Œè¯„ä¼°ã€‚</p>
<h3 id="ç¬¬ä¸€ä¸ªç‰ˆæœ¬æµ‹è¯•ç­–ç•¥"><a href="#ç¬¬ä¸€ä¸ªç‰ˆæœ¬æµ‹è¯•ç­–ç•¥" class="headerlink" title="ç¬¬ä¸€ä¸ªç‰ˆæœ¬æµ‹è¯•ç­–ç•¥"></a>ç¬¬ä¸€ä¸ªç‰ˆæœ¬æµ‹è¯•ç­–ç•¥</h3><p>ç¬¬ä¸€ä¸ªç‰ˆæœ¬ç­–ç•¥çš„åˆ¶å®šæ–¹å¼ï¼Œä¹Ÿå¯ä»¥æŒ‰ç…§ç›®æ ‡â€”â€”é£é™©â€”â€”æµç¨‹â€”â€”é¡ºåºçš„æ€è·¯æ¥åˆ¶å®š<br>å½“æŸä¸€ä¸ªbuildçš„æäº¤å¹¶ä¸å®Œæ•´çš„æ—¶å€™ï¼Œå¯ä»¥æ ¹æ®å¯¹æµ‹è¯•äººå‘˜æ˜¯å¦å¯æµ‹ä¸ºåŸºå‡†ï¼Œè¿›è¡Œæµ‹è¯•<br>å¯¹äºæµ‹è¯•ç›®æ ‡ï¼Œæ¯”è¾ƒå¥½çš„æè¿°æ–¹å¼æ˜¯ï¼šå¯¹æŸä¸ªåŠŸèƒ½ï¼ˆæµ‹è¯•å¯¹è±¡ï¼‰ï¼Œè¿›è¡Œå“ªäº›æµ‹è¯•ï¼ˆæµ‹è¯•æ–¹æ³•ï¼‰ï¼Œå‘ç°äº§å“å“ªäº›æ–¹é¢çš„ç¼ºé™·ï¼ˆæµ‹è¯•ç»“æœï¼‰</p>
<p>æ¯ä¸ªç‰ˆæœ¬æµ‹è¯•ç­–ç•¥ä¸­ï¼Œéœ€è¦æ³¨æ˜å“ªäº›æ˜¯é‡ç‚¹å…³æ³¨çš„å†…å®¹ã€‚é¦–å…ˆè¦å¯¹æäº¤åŠŸèƒ½è¿›è¡Œåˆ†æï¼Œæå‡ºæµ‹è¯•å›¢é˜Ÿé‡ç‚¹å…³æ³¨å†…å®¹ï¼Œå…¶æ¬¡è¦ç¡®å®šç‰ˆæœ¬æµ‹è¯•åŠŸèƒ½ä¼˜å…ˆçº§è¡¨ã€‚å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸åŒåŠŸèƒ½å¯èƒ½åˆ†ä¸ºä¸åŒçš„æäº¤ï¼Œå› æ­¤æµ‹è¯•åŠŸèƒ½çš„ä¼˜å…ˆçº§éœ€è¦å®æ—¶å®šåˆ¶æ›´æ–°ï¼Œè€Œååœ¨ç‰ˆæœ¬ç­–ç•¥ä¸­å‘æµ‹è¯•å›¢é˜Ÿè¯´æ˜ã€‚åŒæ—¶å¯ä»¥å¯¹æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†çº§ï¼Œä»è€Œæ›´åŠ å®¹æ˜“é€‰æ‹©æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>åœ¨æµ‹è¯•æ‰§è¡Œé¡ºåºæ–¹é¢ï¼Œå¯ä»¥éµå¾ªå¦‚ä¸‹çš„åŸåˆ™ï¼š</p>
<ul>
<li>è´¨é‡æƒ…å†µè¶Šå¥½ï¼Œå°±å¯ä»¥è€ƒè™‘å°†æ›´å¤šçš„æµ‹è¯•æ–¹æ³•ç»„åˆèµ·æ¥æ‰§è¡Œ</li>
<li>å¯¹åˆšæäº¤çš„åŠŸèƒ½ï¼Œåœ¨è´¨é‡æƒ…å†µä¸æ˜çš„æƒ…å†µä¸‹ï¼Œä¸å»ºè®®ç”¨ç»„åˆæµ‹è¯•æ³•è¿›è¡Œæµ‹è¯•</li>
<li>å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§ç‰¹æ€§çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå…ˆè¿›æ€§å¤æ‚çš„ã€éš¾çš„æµ‹è¯•ç”¨ä¾‹</li>
</ul>
<p>æµ‹è¯•çš„æ—¶å€™ä¼šé‡åˆ°ä¸€äº›å…¨å±€å› ç´ ï¼Œæ¯”å¦‚æµè§ˆå™¨ã€æµ‹è¯•å·¥å…·ã€æ“ä½œç³»ç»Ÿç­‰è¿è¡Œç¯å¢ƒï¼Œéœ€è¦ç­–ç•¥æ€§åœ°è¿›è¡Œè¯•æ¢æµ‹è¯•ã€‚ä¹Ÿå¯åœ¨ä¸åŒé…ç½®ä¸‹ï¼Œå¯¹ç›¸åŒåŠŸèƒ½è¿›è¡Œæµ‹è¯•ã€‚<br>â€œæ¥æ”¶æµ‹è¯•â€æŒ‡å¼€å‘äººå‘˜å°†ç‰ˆæœ¬è½¬ç§»ç»™æµ‹è¯•äººå‘˜æ˜¯ï¼Œæµ‹è¯•äººå‘˜å¯¹è¿™ä¸ªç‰ˆæœ¬è¿›è¡Œä¸€æ¬¡æµ‹è¯•ï¼Œç¡®è®¤æ²¡æœ‰é˜»å¡é—®é¢˜èƒ½å¤ŸæŒ‰ç…§æµ‹è¯•ç­–ç•¥å®Œæˆæµ‹è¯•ã€‚æœ‰ä¸¤ç§ç»“æœâ€”â€”é€šè¿‡å’Œä¸é€šè¿‡ï¼Œåˆ¤æ–­æ ‡å‡†æ˜¯æ˜¯å¦æœ‰é˜»å¡é—®é¢˜ã€‚å¦‚æœä¸é€šè¿‡ï¼Œä½†æœ‰è§„é¿é˜»å¡åœ°æ–¹æ³•ï¼Œå¯ä»¥ç»§ç»­è¿›è¡Œæµ‹è¯•ã€‚æ¥æ”¶æµ‹è¯•é€‚åˆlevel1çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<h3 id="è·Ÿè¸ªæµ‹è¯•æ‰§è¡Œ"><a href="#è·Ÿè¸ªæµ‹è¯•æ‰§è¡Œ" class="headerlink" title="è·Ÿè¸ªæµ‹è¯•æ‰§è¡Œ"></a>è·Ÿè¸ªæµ‹è¯•æ‰§è¡Œ</h3><p>è·Ÿè¸ªæµ‹è¯•æ‰§è¡Œçš„ç›®çš„æœ‰3ä¸ªï¼š</p>
<ul>
<li>ç¡®ä¿æµ‹è¯•å›¢é˜ŸæŒ‰ç…§æµ‹è¯•ç­–ç•¥æ¥è¿›è¡Œæµ‹è¯•</li>
<li>å®æ—¶å…³æ³¨ç¼ºé™·ï¼Œé€šè¿‡ç¼ºé™·åˆ†ææ¥ç¡®è®¤æµ‹è¯•ç­–ç•¥æ˜¯å¦åˆé€‚ï¼Œæ˜¯å¦éœ€è¦è°ƒæ•´</li>
<li>å…³æ³¨é¡¹ç›®ä¸­çš„å®æ—¶é£é™©ï¼ŒåŸºäºé£é™©è°ƒæ•´æµ‹è¯•ç­–ç•¥</li>
</ul>
<p>è¦ä¿è¯æµ‹è¯•å›¢é˜ŸæŒ‰ç…§æµ‹è¯•ç­–ç•¥æ¥æ‰§è¡Œæµ‹è¯•ï¼Œéœ€è¦ä¿è¯ä»¥ä¸‹ä¸‰ç‚¹ï¼š</p>
<ul>
<li>æµ‹è¯•å†…å®¹å’Œæµ‹è¯•ç­–ç•¥ä¸­ç¡®å®šçš„èŒƒå›´ã€æ·±åº¦å’Œå¹¿åº¦ä¸€è‡´<ul>
<li>æµ‹è¯•ç”¨ä¾‹å’Œæµ‹è¯•ç­–ç•¥ä¸€è‡´</li>
</ul>
</li>
<li>æµ‹è¯•æ‰§è¡Œçš„é¡ºåºå’Œæµ‹è¯•ç­–ç•¥ä¸€è‡´<ul>
<li>æµ‹è¯•å›¢é˜Ÿæ˜¯å¦æŒ‰ç…§ç‰¹æ€§ä¼˜å…ˆçº§é¡ºåºæ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</li>
<li>æµ‹è¯•å›¢é˜Ÿæ˜¯å¦æŒ‰ç…§æµ‹è¯•ç­–ç•¥ä¸­çš„æµ‹è¯•æ–¹æ³•ã€æµ‹è¯•é¡ºåºæ¥æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹</li>
</ul>
</li>
<li>è®¡åˆ’æµ‹è¯•çš„å†…å®¹èƒ½å¤Ÿé¡ºåˆ©æ‰§è¡Œ<ul>
<li>åŸå› ï¼šäººåŠ›ä¸è¶³ï¼Œæ—¶é—´ä¸å¤Ÿï¼Œæµ‹è¯•ç¯å¢ƒä¸å…·å¤‡ï¼Œå…·æœ‰å…¶å®ƒç¼ºé™·</li>
<li>ç¼ºé™·è·Ÿè¸ª<ul>
<li>ç¼ºé™·è¶‹åŠ¿æ˜¯å¦æ­£å¸¸<ul>
<li>æ‹ç‚¹é¢„æµ‹ï¼šæµ‹è¯•æ–¹æ³•ä¸åŒæˆ–æµ‹è¯•æ–¹æ³•ä¸å˜æµ‹è¯•å¯¹è±¡ä¸åŒï¼Œä¸åº”è¯¥å‡ºç°æ‹ç‚¹</li>
<li>åˆ¤æ–­æ‹ç‚¹å‡ºç°æ˜¯å¦è¿‡æ—©æˆ–è€…è¿‡æ™š</li>
</ul>
</li>
<li>æ˜¯å¦å­˜åœ¨å› ä¿®æ”¹å¼•å…¥çš„ç¼ºé™·</li>
<li>æœ¬ç‰ˆæœ¬ä¸­å¿…é¡»è§£å†³å“ªä¸€äº›ç¼ºé™·ï¼šä¼šä¸ä¼šå¯¹åç»­æµ‹è¯•é€ æˆé˜»å¡ï¼Œéœ€è¦ä¿è¯æµ‹è¯•å®Œæ•´æ€§</li>
<li>æœ¬ç‰ˆæœ¬ä¸­éœ€è¦è§£å†³å“ªä¸€äº›ç¼ºé™·ï¼šé˜»å¡çš„ã€æ”¹åŠ¨å¤§çš„ã€æ¶‰åŠéœ€æ±‚æ–¹æ¡ˆè®¾è®¡çš„ã€è‡´å‘½å’Œä¸¥é‡çš„</li>
</ul>
</li>
<li>è°ƒæ•´æµ‹è¯•ç­–ç•¥<ul>
<li>è¢«é˜»å¡çš„åŠŸèƒ½è¾ƒå¤šçš„è¯ï¼Œéœ€è¦è€ƒè™‘æ˜¯å¦æå‰ç»“æŸæµ‹è¯•</li>
<li>å­˜åœ¨é˜»å¡çš„åŠŸèƒ½ï¼ŒåŸè®¡åˆ’ä¸åœ¨æœ¬ç‰ˆæœ¬çš„ç”¨ä¾‹ï¼Œè€ƒè™‘æ˜¯å¦å¯ä»¥è°ƒæ•´åˆ°æœ¬ç‰ˆæœ¬ä¸­æµ‹è¯•</li>
<li>æ²¡æœ‰é˜»å¡çš„åŠŸèƒ½ï¼ŒåŸè®¡åˆ’ä¸åœ¨æœ¬ç‰ˆæœ¬çš„ç”¨ä¾‹ï¼Œè€ƒè™‘æ˜¯å¦è°ƒæ•´åˆ°æœ¬ç‰ˆæœ¬æµ‹è¯•</li>
<li>æ‹ç‚¹å‡ºç°å¤ªæ—©ï¼Œè¯´æ˜å½“å‰æµ‹è¯•æ–¹æ³•ä¸èƒ½æœ‰æ•ˆå‘ç°ç¼ºé™·ï¼Œåˆ†ææ˜¯å¦å› æµ‹è¯•é˜»å¡é€ æˆ</li>
<li>ä¸€ç›´æœªå‡ºç°æ‹ç‚¹ï¼Œè¯´æ˜å½“å‰æµ‹è¯•æ–¹æ³•èƒ½å¤Ÿæœ‰æ•ˆå‘ç°ç¼ºé™·ï¼Œå¯ä»¥åœ¨ä¸‹ä¸€é˜¶æ®µå¼€å§‹çš„1~2ä¸ªç‰ˆæœ¬ä¸­ï¼Œå¢åŠ ä¸€äº›å’Œä¸Šä¸€é˜¶æ®µæµ‹è¯•ç›¸å…³çš„æ¢ç´¢æ€§æµ‹è¯•</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="ç‰ˆæœ¬è´¨é‡è¯„ä¼°"><a href="#ç‰ˆæœ¬è´¨é‡è¯„ä¼°" class="headerlink" title="ç‰ˆæœ¬è´¨é‡è¯„ä¼°"></a>ç‰ˆæœ¬è´¨é‡è¯„ä¼°</h3><p>åœ¨è¿›è¡Œä¸‹ä¸ªç‰ˆæœ¬æµ‹è¯•ä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œç‰ˆæœ¬è´¨é‡è¯„ä¼°<br>è´¨é‡è¯„ä¼°çš„æ–¹æ³•ï¼š</p>
<ul>
<li>è®°å½•éœ€æ±‚å’Œå®ç°çš„åå·®<ul>
<li>éœ€æ±‚ç†è§£æ–¹çš„é”™è¯¯å¯¼è‡´å®ç°ä¸Šçš„é”™è¯¯ï¼ˆå¼€å‘ä¸äº§å“ç†è§£åˆ†æ­§ï¼‰</li>
<li>éœ€æ±‚æ²¡æœ‰æäº¤å®Œ</li>
<li>è®°å½•ç›¸å…³çš„bugåˆ—è¡¨ï¼Œä¸‰æ–¹è®¨è®º</li>
</ul>
</li>
<li>è¿›è¡Œæµ‹è¯•è¿‡ç¨‹è¯„ä¼°<ul>
<li>æµ‹è¯•æ–¹æ³•ï¼šæ€»ç»“å“ªäº›æµ‹è¯•æ–¹æ³•æ¯”è¾ƒæœ‰æ•ˆ</li>
<li>æµ‹è¯•æŠ•å…¥</li>
<li>æµ‹è¯•ç”¨ä¾‹ï¼šæ˜¯å¦æ‰§è¡Œå®Œï¼Œé€šè¿‡ç‡æ˜¯å¤šå°‘ï¼ˆå…ˆè¯„ä¼°è´¨é‡æŒ‡æ ‡æ˜¯å¦æœ‰æ•ˆï¼‰ï¼Œå¤šä¸ªç‰ˆæœ¬ä¸­æ‰§è¡Œç»“æœæƒ…å†µå¦‚ä½•<ul>
<li>æŸåŠŸèƒ½é€šè¿‡ç‡ä¸é«˜ï¼Œè¯´æ˜è¯¥åŠŸèƒ½è´¨é‡å¯èƒ½ä¸é«˜ï¼Œéœ€è¦è°ƒæ•´æµ‹è¯•ç­–ç•¥</li>
<li>é¡¹ç›®åˆæœŸå…³æ³¨é¦–æ¬¡é€šè¿‡ç‡ï¼Œå…¶åå…³æ³¨ç´¯è®¡é€šè¿‡ç‡</li>
<li>æµ‹è¯•ç”¨ä¾‹åœ¨å¤šç‰ˆæœ¬æ‰§è¡Œç»“æœå‡ºç°åå¤ï¼Œæœ‰å¯èƒ½å› ä¸ºæ–°åŠŸèƒ½åˆå…¥å¯¹æ—§åŠŸèƒ½é€ æˆå½±å“ï¼Œæˆ–è€…å› ä¸ºç¼ºé™·ä¿®æ”¹å¼•å…¥äº†æ–°çš„ç»“æœ</li>
</ul>
</li>
</ul>
</li>
<li>ç¼ºé™·åˆ†æ<ul>
<li>åŠŸèƒ½ç‰¹æ€§çš„ç¼ºé™·å¯†åº¦æ˜¯å¦æ­£å¸¸</li>
<li>ç¼ºé™·å¹´é¾„åˆ†ææ˜¯å¦æ­£å¸¸<ul>
<li>ç¼ºé™·å¼•å…¥é˜¶æ®µå®æ—¶å‘ç°ï¼Œä¸èƒ½é—ç•™åˆ°ä¸‹ä¸ªé˜¶æ®µ</li>
<li>åœ¨ç‰¹å®šæµ‹è¯•åˆ†å±‚å‘ç°è¯¥å±‚é—®é¢˜</li>
<li>æ²¡æœ‰ç»§æ‰¿/å†å²é—ç•™/æ–°éœ€æ±‚å˜æ›´/ç¼ºé™·ä¿®æ”¹å¼•å…¥çš„ç¼ºé™·</li>
</ul>
</li>
<li>ç¼ºé™·è§¦å‘å› ç´ åˆ†ææ˜¯å¦æ­£å¸¸</li>
</ul>
</li>
<li>è°ƒæ•´æµ‹è¯•ç­–ç•¥ï¼šå¦‚æœäº§ç”Ÿå½±å“æœ€ç»ˆå‘å¸ƒè´¨é‡çš„é—®é¢˜ï¼Œå°±éœ€è¦é‡‡å–æªæ–½</li>
<li>å»ºç«‹ç‰¹æ€§ç‰ˆæœ¬è´¨é‡æ¡£æ¡ˆ<ul>
<li>å¯¹å½“å‰æµ‹è¯•è¦†ç›–åº¦æ–¹é¢çš„è®°å½•ï¼ŒåŒ…æ‹¬éœ€æ±‚ä¸å®ç°çš„åå·®</li>
<li>æµ‹è¯•è¿‡ç¨‹åˆ†æè®°å½•</li>
<li>ç¼ºé™·åˆ†æ</li>
</ul>
</li>
</ul>
<h3 id="åé¢ç‰ˆæœ¬æµ‹è¯•ç­–ç•¥"><a href="#åé¢ç‰ˆæœ¬æµ‹è¯•ç­–ç•¥" class="headerlink" title="åé¢ç‰ˆæœ¬æµ‹è¯•ç­–ç•¥"></a>åé¢ç‰ˆæœ¬æµ‹è¯•ç­–ç•¥</h3><ul>
<li>å›å½’æµ‹è¯•<ul>
<li>ç¼ºé™·å›å½’ï¼šéªŒè¯ç¼ºé™·æ˜¯å¦è¢«å¼€å‘äººå‘˜ä¿®å¤<ul>
<li>åŠŸèƒ½æ€§ç¼ºé™·ï¼šå¯¹ç¼ºé™·æœ¬èº«ä¸è¯¥åŠŸèƒ½ç›¸å…³äº¤äº’éªŒè¯</li>
<li>éåŠŸèƒ½æ€§ç¼ºé™·ï¼šå¯¹ç¼ºé™·éªŒè¯ï¼Œåˆ†æç¼ºé™·ä¿®æ”¹æ˜¯å¦å¯¹åŠŸèƒ½æœ‰å½±å“</li>
<li>åº•å±‚/ä¸­é—´å±‚ç¼ºé™·ï¼šæ§åˆ¶è¿™ç±»ç¼ºé™·åœ¨è®¾è®¡ä¿®æ”¹å’Œç¼–ç ä¸Šçš„è´¨é‡</li>
</ul>
</li>
<li>åŠŸèƒ½å›å½’ï¼šç¡®è®¤è€åŠŸèƒ½ä¸ä¼šå› æ–°åˆå…¥åŠŸèƒ½è€Œå¤±æ•ˆ<ul>
<li>æ–°å¼€å‘åŠŸèƒ½åˆå…¥ç‰ˆæœ¬åçš„å›å½’</li>
<li>è€åŠŸèƒ½å›å½’ï¼šè‡ªåŠ¨åŒ–æµ‹è¯•</li>
</ul>
</li>
<li>é˜¶æ®µå›å½’ï¼šç¡®è®¤äº§å“å½“å‰è´¨é‡è¾¾åˆ°è¯¥é˜¶æ®µçš„è´¨é‡ç›®æ ‡<ul>
<li>é›†æˆæµ‹è¯•é˜¶æ®µï¼šéªŒè¯åŠŸèƒ½é›†æˆåæ­£ç¡®æ€§ï¼Œæ»¡è¶³å‡ºå£æ¡ä»¶ï¼ˆlevel 1çº§æµ‹è¯•ç”¨ä¾‹ï¼‰</li>
<li>ç³»ç»Ÿæµ‹è¯•é˜¶æ®µï¼šå¯¹é‡ç‚¹åŠŸèƒ½è¿›è¡Œæµ‹è¯•</li>
<li>éªŒæ”¶æµ‹è¯•ï¼šå¯¹å…¸å‹åœºæ™¯è¿›è¡Œæµ‹è¯•</li>
</ul>
</li>
</ul>
</li>
<li>æ¢ç´¢å¼æµ‹è¯•<ul>
<li>é›†æˆé˜¶æ®µä¸­åæœŸé€æ¸è¿›è¡Œæ¢ç´¢å¼æµ‹è¯•ï¼Œå¯¹æ–°åˆå…¥åŠŸèƒ½è¿›è¡Œæ¢ç´¢</li>
<li>ç³»ç»Ÿæµ‹è¯•é˜¶æ®µï¼Œå¯¹æ•´ä¸ªç³»ç»Ÿé‡ç‚¹ç‰¹æ€§ä¸è¾…åŠ©ç‰¹æ€§è¿›è¡Œæ·±å…¥æµ‹è¯•</li>
</ul>
</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•<ul>
<li>å…ˆå¯¹éœ€è¦å¤šæ¬¡æ‰§è¡Œçš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œè‡ªåŠ¨åŒ–ï¼Œä¼˜å…ˆè‡ªåŠ¨åŒ–ç®€å•çš„ã€å¯é çš„åŠŸèƒ½</li>
</ul>
</li>
</ul>
<h3 id="é˜¶æ®µè´¨é‡è¯„ä¼°"><a href="#é˜¶æ®µè´¨é‡è¯„ä¼°" class="headerlink" title="é˜¶æ®µè´¨é‡è¯„ä¼°"></a>é˜¶æ®µè´¨é‡è¯„ä¼°</h3><p>åœ¨æ¯ä¸ªé˜¶æ®µå®Œæˆæ—¶å¯¹æ•´ä½“è´¨é‡è¿›è¡Œè¯„ä¼°ï¼Œåˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿè¾¾åˆ°å‡ºå£æ ‡å‡†ï¼Œè¿›å…¥ä¸‹ä¸€é˜¶æ®µè¯„ä¼°<br>è´¨é‡è¯„ä¼°å¯ä»¥æŒ‰ç…§è´¨é‡è¯„ä¼°æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œéœ€è¦æŒç»­è·Ÿè¸ªæµ‹è¯•æ‰§è¡Œã€è¯„ä¼°ç‰ˆæœ¬ä¸é˜¶æ®µè´¨é‡ã€‚å…·ä½“å·¥ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li>ç¡®è®¤æ€»ä½“ç­–ç•¥ä¸­çš„è´¨é‡ç›®æ ‡æ˜¯å¦å®Œæˆ<ul>
<li>å¯¹æ€»ä½“è´¨é‡ç›®æ ‡è¿›è¡Œåˆ†è§£ï¼Œä¸ºæ¯ä¸ªæµ‹è¯•åˆ†å±‚ç¡®å®šè´¨é‡ç›®æ ‡</li>
<li>å¦‚æœè´¨é‡çº¢çº¿ï¼ˆé‡è¦ç›®æ ‡ï¼‰æ²¡æœ‰è¾¾æˆï¼Œå°±ä¸èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µæµ‹è¯•æˆ–å‘å¸ƒ</li>
<li>å¦‚æœä¸€èˆ¬æ€§ç›®æ ‡æ²¡æœ‰è¾¾æˆï¼Œä¸”æ²¡æœ‰åº”å¯¹æªæ–½ï¼Œä¹Ÿä¸èƒ½è¿›å…¥ä¸‹ä¸€é˜¶æ®µæµ‹è¯•æˆ–å‘å¸ƒ</li>
</ul>
</li>
<li>é‡è¦çš„è´¨é‡ç›®æ ‡ï¼ˆè´¨é‡çº¢çº¿ï¼‰<ul>
<li>éœ€æ±‚è¦†ç›–åº¦ã€æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œç‡ã€æµ‹è¯•ç”¨ä¾‹ç´¯è®¡æ‰§è¡Œé€šè¿‡ç‡ã€ç¼ºé™·ä¿®å¤ç‡</li>
</ul>
</li>
<li>å¯¹æœªè¾¾åˆ°çš„ä¸€èˆ¬æ€§è´¨é‡ç›®æ ‡åˆ¶å®šåº”å¯¹æªæ–½<ul>
<li>éæµ‹è¯•ç”¨ä¾‹å‘ç°ç¼ºé™·ï¼šå¯»æ‰¾æµ‹è¯•è®¾è®¡ä¸­çš„é—®é¢˜ï¼Œæ”¹è¿›è®¾è®¡ï¼Œè¿›è¡Œæ¢ç´¢å¼æµ‹è¯•<ul>
<li>äº§å“å®ç°/åŠŸèƒ½äº¤äº’/è¾¹ç•Œå€¼å¼‚å¸¸åˆ†æ”¯æœªè€ƒè™‘/æµ‹è¯•åœºæ™¯æœªè€ƒè™‘</li>
</ul>
</li>
<li>ç»„åˆç¼ºé™·åˆ†æï¼šå°†ç¼ºé™·åˆ†ææ–¹æ³•è¿›è¡Œç»„åˆ<ul>
<li>ç¼ºé™·å¯†åº¦è¿‡é«˜ï¼Œå¯ä»¥åˆ†æç¼ºé™·è§¦å‘å› ç´ ã€‚æ˜¯å¦é‡‡ç”¨äº†æ›´å¤šçš„æµ‹è¯•æ–¹æ³•ï¼Ÿæ˜¯å¦æœ‰é—ç•™è¾ƒå¤šçš„ç¼ºé™·ï¼Ÿå¦‚æœç¼ºé™·è¶‹åŠ¿æ”¶æ•›ï¼Œä¿®å¤ç‡è¾¾æ ‡ï¼Œå¯ä»¥è¿›å…¥ä¸‹ä¸€é˜¶æ®µçš„æµ‹è¯•ã€‚</li>
</ul>
</li>
<li>é—ç•™ç¼ºé™·ï¼šåˆ¶å®šè§„é¿æªæ–½<ul>
<li>åœ¨ç‰ˆæœ¬è®¡åˆ’å‘å¸ƒå‰å‡ ä¸ªç‰ˆæœ¬å°±å¼€å§‹è¿›è¡Œï¼Œéœ€è¦è¯„ä¼°ç¼ºé™·å¯¹ç”¨æˆ·å½±å“ç¨‹åº¦ã€å‘ç”Ÿæ¦‚ç‡</li>
<li>è‡´å‘½ç¼ºé™·/æ²¡æœ‰è§„é¿æªæ–½ä¸¥é‡ç¼ºé™·ï¼Œä¸åº”è¯¥é—ç•™</li>
<li>éå¿…ç„¶é‡ç°bugï¼Œéœ€è¦æå•åšé—®é¢˜è®°å½•ï¼Œè·Ÿè¸ªå‘¨æœŸå¯ä»¥å»¶é•¿ï¼Œå¯ä»¥é€‚å½“é™ä½é—®é¢˜ä¼˜å…ˆçº§ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½æµ‹è¯•</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>ä¸šåŠ¡</tag>
        <tag>è½¯ä»¶æµ‹è¯•</tag>
        <tag>æµ‹è¯•ç®¡ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘ç†è§£javascript/pythonä¸­reduceæ“ä½œçš„å«ä¹‰</title>
    <url>/2021/10/01/geekdaily/reduce_function/</url>
    <content><![CDATA[<p>åœ¨å­¦ä¹ javascriptå’Œpythonçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ¥è§¦åˆ°<code>map</code>ã€<code>filter</code>ã€<code>reduce</code>ä¹‹ç±»çš„ä¸€ç­‰å…¬æ°‘é«˜é˜¶å‡½æ•°ã€‚ç†è§£<code>map</code>å’Œ<code>filter</code>æ˜¯ç›¸å¯¹ç®€å•çš„äº‹æƒ…ï¼Œä½†ç†è§£<code>reduce</code>çš„è¯è¿˜æ˜¯éœ€è¦ä¸€ç•ªæ¨æ•²ã€‚æ­£å€¼åä¸€å‡æœŸï¼Œä»Šå¤©è¿™ç¯‡æ–‡ç« å°±å¥½å¥½è®²è®²<code>reduce</code>è¿™ä¸ªä¸œè¥¿</p>
<p>æˆ‘ä»¬é¦–å…ˆä»¥pythonä¸ºä¾‹ï¼Œçœ‹ä¸€æ®µ<code>reduce</code>ç¨‹åºçš„æ“ä½œï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> dataclasses <span class="keyword">import</span> dataclass</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@dataclass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stats</span>:</span></span><br><span class="line">    product: int = <span class="number">1</span></span><br><span class="line">    sum: int = <span class="number">0</span></span><br><span class="line">    num: int = <span class="number">0</span></span><br><span class="line">    avg: float = <span class="number">0.0</span></span><br><span class="line">    max: int = <span class="number">-1e9</span></span><br><span class="line">    min: int = <span class="number">1e9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(cur_state, cur_element)</span>:</span></span><br><span class="line">    <span class="keyword">assert</span> isinstance(cur_state, Stats)</span><br><span class="line">    print(<span class="string">'processing element %d, current stats: %s'</span> % (cur_element, cur_state))</span><br><span class="line">    cur_state.num += <span class="number">1</span></span><br><span class="line">    cur_state.sum += cur_element</span><br><span class="line">    cur_state.product *= cur_element</span><br><span class="line">    cur_state.avg = float(cur_state.sum) / float(cur_state.num)</span><br><span class="line">    <span class="keyword">if</span> cur_element &gt; cur_state.max:</span><br><span class="line">        cur_state.max = cur_element</span><br><span class="line">    <span class="keyword">if</span> cur_element &lt; cur_state.min:</span><br><span class="line">        cur_state.min = cur_element</span><br><span class="line">    <span class="keyword">return</span> cur_state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    ints = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">    reduced_stats = reduce(reducer, ints, Stats())</span><br><span class="line">    print(reduced_stats)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>è¿™æ®µç¨‹åºé‡Œçš„æ“ä½œï¼Œè¾“å…¥æ˜¯ä¸€ç»„æ•´æ•°ï¼Œæœ€åè¾“å‡ºæ¥çš„æ˜¯è¿™ç»„æ•´æ•°çš„ç»Ÿè®¡æ•°æ®ï¼Œæ¯”å¦‚æ€»å’Œ<code>sum</code>ã€ç§¯<code>product</code>ã€æœ€å¤§æœ€å°å€¼ç­‰ç­‰ã€‚å®ç°è¿™ä¸ªç»Ÿè®¡æ“ä½œï¼Œå°±å¯ä»¥ç”¨<code>reduce</code>ã€‚åœ¨<code>functools</code>åº“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>reduce</code>çš„å®šä¹‰ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_initial_missing = object()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reduce</span><span class="params">(function, sequence, initial=_initial_missing)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    reduce(function, sequence[, initial]) -&gt; value</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Apply a function of two arguments cumulatively to the items of a sequence,</span></span><br><span class="line"><span class="string">    from left to right, so as to reduce the sequence to a single value.</span></span><br><span class="line"><span class="string">    For example, reduce(lambda x, y: x+y, [1, 2, 3, 4, 5]) calculates</span></span><br><span class="line"><span class="string">    ((((1+2)+3)+4)+5).  If initial is present, it is placed before the items</span></span><br><span class="line"><span class="string">    of the sequence in the calculation, and serves as a default when the</span></span><br><span class="line"><span class="string">    sequence is empty.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    it = iter(sequence)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> initial <span class="keyword">is</span> _initial_missing:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            value = next(it)</span><br><span class="line">        <span class="keyword">except</span> StopIteration:</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">"reduce() of empty sequence with no initial value"</span>) <span class="keyword">from</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        value = initial</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> it:</span><br><span class="line">        value = function(value, element)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> _functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ç®€å•æ˜“æ‡‚ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>reduce</code>å‡½æ•°éœ€è¦ä¸€ä¸ªåˆå§‹å€¼<code>initial</code>ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªä¼šå˜åŒ–çš„å½“å‰å€¼<code>value</code>ï¼Œç„¶åä¼šåœ¨éå†æˆ‘ä»¬å®šä¹‰çš„<code>sequence</code>åºåˆ—çš„è¿‡ç¨‹ä¸­ï¼Œä¸æ–­ç”¨<code>function</code>ï¼ˆå«æˆ<code>reducer</code>æ›´åŠ è´´åˆ‡ï¼‰ä¾æ®å½“å‰éå†åˆ°çš„å…ƒç´ <code>element</code>æ¥æ›´æ–°å½“å‰å€¼<code>value</code>ï¼ˆçš„å†…éƒ¨çŠ¶æ€ï¼‰ï¼Œå¹¶åœ¨æœ€åè¿”å›æœ€ç»ˆçš„<code>value</code>ã€‚</p>
<p>æ‰€ä»¥å¾ˆæ˜¾ç„¶ï¼Œ<code>reduce</code>è¿™ä¸ªå‡½æ•°ï¼Œé’ˆå¯¹ä¸€ä¸ªç‰¹å®šçš„<code>sequence</code>ï¼Œè¿”å›å€¼åº”å½“åæ˜ è¿™ä¸ª<code>sequence</code>çš„æŸæ ·ï¼ˆäº›ï¼‰å±æ€§ã€‚è¿™ä¾¿æ˜¯<code>reduce</code>çš„æ„ä¹‰æ‰€åœ¨äº†ã€‚</p>
<p>å­¦è¿‡javascriptçš„åŒå­¦ï¼Œä¼šç»å¸¸åœ¨ç½‘ä¸Šèµ„æ–™çœ‹åˆ°<code>reduce</code>çš„ç¿»è¯‘å«åš<code>å½’å¹¶</code>ï¼Œä¸ªäººè®¤ä¸º<code>å½’å¹¶</code>è¿™ä¸ªè¯å·²ç»ç¿»è¯‘çš„éå¸¸è´´åˆ‡äº†ï¼Œä¸€æ—¶é—´ä¹Ÿæ‰¾ä¸åˆ°æ›´å¥½çš„ä¿¡è¾¾é›…çš„è¡¨è¾¾ã€‚å½“ç„¶å¦‚æœæˆ‘ä»¬å»æ£€ç´¢è‹±æ–‡ç™¾ç§‘ï¼Œç”šè‡³è¿˜å¯ä»¥äº†è§£åˆ°æ›´å¤šçš„ä¿¡æ¯ã€‚</p>
<p><code>reduce</code>æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ä¸ªä»£è¡¨ã€‚æˆ‘ä»¬æ£€ç´¢<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRnVuY3Rpb25hbF9wcm9ncmFtbWluZw==" title="https://en.wikipedia.org/wiki/Functional_programming">å‡½æ•°å¼ç¼–ç¨‹çš„ç»´åŸºç™¾ç§‘<i class="fa fa-external-link"></i></span>ï¼Œé‡Œé¢å¯ä»¥è·³åˆ°<code>reduce</code>çš„ç™¾ç§‘ï¼Œæˆ‘ä»¬å‘ç°å…¶å®ä¼šè·³åˆ°<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRm9sZF8oaGlnaGVyLW9yZGVyX2Z1bmN0aW9u" title="https://en.wikipedia.org/wiki/Fold_(higher-order_function">å¦ä¸€ä¸ªå•è¯çš„ç™¾ç§‘<i class="fa fa-external-link"></i></span>)ï¼Œå«åš<code>fold</code></p>
<p>ä»<code>fold</code>ä»¥åŠè¡ç”Ÿè¯æ±‡<code>reduce</code>ã€<code>accumulate</code>ã€<code>aggregation</code>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç±»æ“ä½œå…¶å®ç”¨ä¸­æ–‡ç¿»è¯‘é™¤äº†å«<code>å½’å¹¶</code>ä»¥å¤–ï¼Œå«<code>ç´¯ç§¯</code>ã€<code>èšåˆ</code>ä¹Ÿä¸è¿‡åˆ†ï¼ˆå—¯è¿™é‡Œåˆå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„è€æœ‹å‹mongodbï¼Œ<code>aggregation</code>è·Ÿ<code>accumulate</code>å…³é”®è¯éƒ½ä¸Šæ¶äº†ï¼‰ï¼Œéƒ½æ˜¯ä»£è¡¨ç€ä¸€ç§<code>éå†æ‰€æœ‰å…ƒç´ å€¼ï¼Œä¸æ–­åˆå¹¶è®¡ç®—ï¼Œå¾—å‡ºæœ€ç»ˆç»“æœ</code>çš„è¿ç®—æ“ä½œã€‚<code>fold</code>åè¿‡æ¥å«åš<code>unfold</code>ï¼Œå¯¹åº”çš„ä¹Ÿæ˜¯<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQW5hbW9ycGhpc20=" title="https://en.wikipedia.org/wiki/Anamorphism">å¦ä¸€ä¸ªå•è¯çš„ç™¾ç§‘<i class="fa fa-external-link"></i></span>ï¼Œå«åš<code>Anamorphism</code>ã€‚<code>Anamorphism</code>æœ¬æ„æ˜¯<code>å²©çŸ³å˜æ€§</code>ã€<code>æ¸å˜</code>ï¼Œä½†åœ¨è®¡ç®—æœºé¢†åŸŸï¼Œä½œä¸ºå’Œ<code>fold</code>ç›¸åçš„è¿ç®—æ–¹å¼ï¼Œæ˜¯ä¸€ä¸ªä¼šä¸æ–­æ ¹æ®å½“å‰å€¼æ¥ç”Ÿæˆä¸‹ä¸€ä¸ªå€¼ï¼Œä»è€Œ<code>å±•å¼€</code>å‡ºæ¥ä¸€ä¸ª<code>sequence</code>çš„ç”Ÿæˆå™¨<code>generator</code>ï¼ˆæ‰€ä»¥è¿™ç§è¿ç®—é€šä¿—çš„è¯´ï¼Œå°±ç¿»è¯‘ä¸º<code>å±•å¼€</code>å³å¯ï¼Œè·Ÿ<code>unfold</code>ä¹Ÿå¾ˆæ­ï¼‰ã€‚æˆ‘ä»¬ç†Ÿæ‚‰çš„æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œå°±å¯ä»¥ç”¨<code>unfold</code>/<code>Anamorphism</code>ä»£è¡¨çš„è¿ç®—æ–¹å¼ç”Ÿæˆã€‚åˆå§‹å€¼ä¸ºï¼ˆ0ï¼Œ1ï¼‰ï¼Œæ ¹æ®ï¼ˆ0ï¼Œ1ï¼‰ç”Ÿæˆä¸‹ä¸€ä¸ªæ•°å­—1ï¼Œæ ¹æ®ï¼ˆ1ï¼Œ1ï¼‰ç”Ÿæˆä¸‹ä¸€ä¸ªæ•°å­—2ã€‚è¿™æ ·ä¸æ–­<code>å±•å¼€</code>ä¸‹å»ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ç‰¹å®šé•¿åº¦çš„æ–æ³¢é‚£å¥‘æ•°åˆ—äº†ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å‡½æ•°å¼ç¼–ç¨‹</tag>
        <tag>reduce</tag>
        <tag>å½’å¹¶</tag>
        <tag>fold</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘åœ¨Vueç”¨echartsç”»å¸¦ä¸åŒé¢œè‰²ç‚¹çš„æ•£ç‚¹å›¾</title>
    <url>/2021/09/16/geekdaily/echarts_scatter_color/</url>
    <content><![CDATA[<p>åœ¨vueæŠ€æœ¯æ ˆä¸‹åšå›¾è¡¨éœ€æ±‚ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9lY2hhcnRzLmFwYWNoZS5vcmcvemgvaW5kZXguaHRtbA==" title="https://echarts.apache.org/zh/index.html">echarts<i class="fa fa-external-link"></i></span>æ˜¯ä¸€ä¸ªéå¸¸æ£’çš„é€‰æ‹©ï¼Œæä¾›äº†éå¸¸å¤šç§å¤šæ ·çš„å›¾æ ‡ç¤ºä¾‹ä»¥åŠéå¸¸å¤æ‚å¼ºå¤§çš„APIã€‚ç”±äºç¬”è€…è¿‘æœŸå·¥ä½œå†…å®¹ä¸­éœ€è¦åˆ†æé‡‡æ ·ç‚¹çš„åˆ†å¸ƒæƒ…å†µï¼Œå› æ­¤è‡ªç„¶è€Œç„¶æ¥è§¦åˆ°äº†echartsçš„<span class="exturl" data-url="aHR0cHM6Ly9lY2hhcnRzLmFwYWNoZS5vcmcvZXhhbXBsZXMvemgvaW5kZXguaHRtbCNjaGFydC10eXBlLXNjYXR0ZXIzRA==" title="https://echarts.apache.org/examples/zh/index.html#chart-type-scatter3D">3Dæ•£ç‚¹å›¾<i class="fa fa-external-link"></i></span>ã€‚åœ¨ç¬”è€…çš„éœ€æ±‚ä¸­ï¼Œéœ€è¦å¯¹ä¸åŒç‚¹è¿›è¡Œåˆ†ç±»ï¼Œå¹¶æŒ‰ç‰¹å®šçš„é¢œè‰²æ˜¾ç¤ºå‡ºæ¥ã€‚ç»è¿‡ä¸€ç•ªè¸©å‘ï¼Œäº†è§£åˆ°äº†echartsåœ¨å®ç°è¿™æ–¹é¢çš„æœºåˆ¶ã€‚</p>
<p>echartsç»˜å›¾/åˆ·æ–°åªéœ€è¦é€šè¿‡<code>setOption</code>æ¥å£å³å¯å®ç°ã€‚åœ¨å„ç§optionsä¸­ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9lY2hhcnRzLmFwYWNoZS5vcmcvaGFuZGJvb2svemgvY29uY2VwdHMvdmlzdWFsLW1hcA==" title="https://echarts.apache.org/handbook/zh/concepts/visual-map">visualMapè§†è§‰æ˜ å°„ç»„ä»¶<i class="fa fa-external-link"></i></span>èƒ½å¤Ÿæ ¹æ®æ•°æ®åœ¨ç‰¹å®šç»´åº¦ä¸Šçš„å€¼ï¼ŒæŒ‡å®šå¯¹åº”ç‚¹çš„è§†è§‰å±æ€§ï¼ˆæ¯”å¦‚é¢œè‰²ã€é€æ˜åº¦ã€å›¾å…ƒå¤§å°ç­‰ç­‰ï¼‰ã€‚</p>
<p>è¦ç”¨åˆ°visualMapç‰¹æ€§ï¼Œéœ€è¦importç›¸å…³ç»„ä»¶ï¼š</p>
<a id="more"></a>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; VisualMapComponent &#125; <span class="keyword">from</span> <span class="string">'echarts/components'</span></span><br><span class="line">echarts.use(VisualMapComponent)</span><br></pre></td></tr></table></figure>
<p>è®°å¾—å¦‚æœè¦ç”¨åˆ°å…¶ä½™çš„ä¸€äº›tooltipä¹‹ç±»çš„ç»„ä»¶ï¼Œä¹Ÿå¾—åŠ ä¸Šè¿™äº›importå£°æ˜ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æ•°æ®æ¯é¡¹åŒ…å«Xã€Yã€Zåæ ‡ä»¥åŠä¸€ä¸ªè¡¨ç¤ºé¢œè‰²ç±»åˆ«çš„é¡¹ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆè®¾å®švisualMapå¦‚ä¸‹ï¼ˆä¹Ÿå¯ä»¥å‚è€ƒå®˜æ–¹çš„è¯¸å¤šä¾‹å­ï¼‰ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">option = &#123;</span><br><span class="line">  visualMap: [</span><br><span class="line">    &#123;</span><br><span class="line">      min: <span class="number">0</span>,</span><br><span class="line">      max: <span class="number">1000</span>,</span><br><span class="line">      dimension: <span class="number">4</span>,</span><br><span class="line">      inRange: &#123;</span><br><span class="line">        color: [<span class="string">'#000000'</span>, <span class="string">'#aabbcc'</span>, <span class="string">'#ffffff'</span>]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//    ...</span></span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™è¡¨ç¤ºä¸Šè‰²çš„æ—¶å€™ï¼Œä¼šè¯»å–æ•°æ®ç¬¬5ä¸ªç»´åº¦ï¼ˆindex/dimension = 4ï¼‰çš„å€¼ï¼Œç„¶åæ ¹æ®å€¼å¯»æ‰¾å¯¹åº”çš„é¢œè‰²ã€‚å€¼çš„èŒƒå›´æ˜¯0~1000ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ•°æ®é‡Œç¬¬5ä¸ªç»´åº¦å€¼ä¸º0çš„è¯ï¼Œå°±æ˜¯<code>#000000</code>ï¼Œå–1000å°±æ˜¯<code>#ffffff</code>ï¼Œç„¶åå–ä¸­é—´500çš„è¯å°±æ˜¯<code>#aabbcc</code>äº†</p>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥è½¬æ¢ä¸‹æ•°æ®ï¼Œæ·»åŠ é¢œè‰²å¯¹åº”çš„æ•´æ•°å€¼ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> colorTagToIntMap = &#123;</span><br><span class="line">    COLOR_A: <span class="number">0</span>,</span><br><span class="line">    COLOR_B: <span class="number">500</span>,</span><br><span class="line">    COLOR_C: <span class="number">1000</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> newData = data.map(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> colorInt = colorTagToIntMap[item.colorTag]</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        item.X,</span><br><span class="line">        item.Y,</span><br><span class="line">        item.Z,</span><br><span class="line">        item.colorTag,</span><br><span class="line">        colorTagToInt</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨å¯¹åº”<span class="exturl" data-url="aHR0cHM6Ly9lY2hhcnRzLmFwYWNoZS5vcmcvaGFuZGJvb2svemgvY29uY2VwdHMvZGF0YXNldA==" title="https://echarts.apache.org/handbook/zh/concepts/dataset">dataset<i class="fa fa-external-link"></i></span>ä¸­ï¼Œè®¾ç½®dimensionä¸ºè¡¨å¤´ï¼Œè®¾ç½®dataä¸ºä¸Šè¿°çš„newDataï¼Œå°±okäº†ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>vue</tag>
        <tag>echarts</tag>
        <tag>æ•£ç‚¹å›¾</tag>
        <tag>scatter3D</tag>
        <tag>visualMap</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘2021æ–°ç‰ˆæœ¬VSCodeè®¾ç½®git-bashä¸ºç»ˆç«¯çš„æ–¹æ³•</title>
    <url>/2021/09/11/geekdaily/vscode_git-bash/</url>
    <content><![CDATA[<p>æˆªè‡³2021.9ï¼Œä¸çŸ¥é“å“ªå¤©æ›´æ–°äº†vscodeï¼Œå‘ç°é»˜è®¤çš„ç»ˆç«¯ä»ä»¥å‰çš„git-bashå˜æˆäº†powershellï¼Œç¬”è€…ç”¨çš„windowsç”µè„‘ï¼Œäºæ˜¯ä¹è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒæŠŠpowershellå˜å›git-bashã€‚</p>
<p>æ‰“å¼€settingsï¼Œå‘ç°ä»¥å‰çš„<code>terminal.integrated.shell.windows</code>è®¾ç½®å·²ç»å¤±æ•ˆï¼Œä¸èƒ½å†ç”¨ã€‚åœ¨settingsçš„å›¾å½¢ç•Œé¢æŸ¥çœ‹shellè®¾ç½®ï¼Œé»˜è®¤çš„é€‰é¡¹å˜æˆäº†<code>PowerShell</code>ã€<code>Command Prompt</code>å’Œ<code>Javascript Debug Terminal</code>ï¼Œä¸èƒ½ç›´æ¥æŒ‡å®šgit-bashè·¯å¾„ã€‚</p>
<p>ç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œå‘ç°<span class="exturl" data-url="aHR0cHM6Ly9jb2RlLnZpc3VhbHN0dWRpby5jb20vZG9jcy9lZGl0b3IvaW50ZWdyYXRlZC10ZXJtaW5hbA==" title="https://code.visualstudio.com/docs/editor/integrated-terminal">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>å·²ç»è¯´æ˜å¯ä»¥é€šè¿‡è®¾ç½®<code>terminal.integrated.profiles.windows</code>çš„æ–¹æ³•ï¼Œå¢åŠ ä¸€ä¸ªshellé€‰é¡¹ï¼Œä»è€Œè¾¾åˆ°ç›®çš„ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨<code>settings</code>é‡Œæ·»åŠ ä¸€ä¸ª<code>git-bash</code>é€‰é¡¹ï¼š</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">"terminal.integrated.profiles.windows": &#123;</span><br><span class="line">    "git-bash": &#123;</span><br><span class="line">        "path": "X:\\GIT_ROOT\\bin\\bash.exe"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨shellé€‰é¡¹é‡Œå°±èƒ½é€‰æ‹©git-bashäº†ã€‚è¯•è¯•çœ‹å§~</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>git</tag>
        <tag>shell</tag>
        <tag>VSCode</tag>
        <tag>VSCodeè®¾ç½®</tag>
        <tag>git-bash</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¸¸æˆå¼€å‘ã€‘UE4ä¸‹åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ç‰¹å®šé•¿æ–¹ä½“å†…çš„è®¡ç®—æ–¹æ³•</title>
    <url>/2021/09/01/gamedev/ue4_point_in_cuboid/</url>
    <content><![CDATA[<p>è¿‘æœŸåœ¨ç ”ç©¶å¯»è·¯åŠŸèƒ½çš„æµ‹è¯•å·¥ä½œï¼Œéœ€è¦å¯¹ç©å®¶å¯»è·¯è¿‡ç¨‹ä¸­çš„è¡Œè¿›è½¨è¿¹è¿›è¡Œé‡‡æ ·ï¼Œåˆ¤æ–­é‡‡æ ·ç‚¹æ˜¯å¦åœ¨ç‰¹å®šçš„å¯»è·¯åŒºåŸŸå†…ã€‚UE4è‡ªå¸¦äº†<code>NavModifierVolume</code>çš„actorï¼Œå¯ä»¥æ”¾ç½®åˆ°åœºæ™¯é‡Œæ ‡è¯†æŸä¸ªåŒºåŸŸçš„å¯»è·¯æˆæœ¬ï¼ˆä¸äº†è§£å¯»è·¯ç›¸å…³èƒŒæ™¯çš„è¯å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDgvMDcvZ2FtZWRldi9yZWNhc3RkZW1vLw==" title="https://utmhikari.top/2021/08/07/gamedev/recastdemo/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬åšé‡‡æ ·çš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦åˆ¤æ–­æŸä¸ªç‚¹æ˜¯å¦åœ¨ç‰¹å®šçš„<code>NavModifierVolume</code>é‡Œã€‚ç”±äºè‡ªå·±æ‰€è´Ÿè´£çš„æ¸¸æˆæ˜¯ç½‘æ¸¸ï¼Œ<code>NavModifierVolume</code>æœ€åå¯¼å‡ºç»™æœåŠ¡å™¨ç”¨äº†ï¼Œå®é™…æ¸¸æˆé‡Œè·å–ä¸åˆ°è¿™äº›actorçš„æ•°æ®ï¼Œå› æ­¤å®é™…æµ‹è¯•æ—¶ï¼Œä¸€æ–¹é¢éœ€è¦ä¸‹è½½æœåŠ¡å™¨ä¸Šçš„<code>NavModifierVolume</code>æ•°æ®ï¼Œå¦ä¸€æ–¹é¢è¿˜è¦æ‰‹å†™ç›¸å…³çš„è®¡ç®—æ–¹æ³•ï¼Œæ¥è¾¾åˆ°æˆ‘ä»¬çš„å·¥ä½œç›®çš„ã€‚</p>
<p><code>NavModifierVolume</code>æ˜¯ä¸€ä¸ªç©ºçš„é•¿æ–¹ä½“ï¼Œå¯ä»¥æ—‹è½¬æˆä»»æ„å½¢å¼ã€‚å› æ­¤åˆ¤æ–­ç©å®¶å¯»è·¯é‡‡æ ·ç‚¹æ˜¯å¦åœ¨ç‰¹å®šå¯»è·¯åŒºåŸŸå†…ï¼Œä¹Ÿå°±å¿…é¡»è§£å†³è¿™ä¸ªæ•°å­¦é—®é¢˜â€”â€”3Dç©ºé—´ä¸‹åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ç‰¹å®šé•¿æ–¹ä½“å†…ã€‚</p>
<p>é€šå¸¸è€Œè¨€ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä»¥ä¸‹çš„è§£æ³•ï¼š</p>
<a id="more"></a>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hpdDE1MjQ0NjgvYXJ0aWNsZS9kZXRhaWxzLzc5ODU3NjY1" title="https://blog.csdn.net/hit1524468/article/details/79857665">åˆ¤æ–­æ˜¯å¦åœ¨3ç»„å¹³è¡Œå¹³é¢åŒä¸€ä¾§<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9HYW1lcy9UZWNobmlxdWVzLzNEX2NvbGxpc2lvbl9kZXRlY3Rpb24=" title="https://developer.mozilla.org/zh-CN/docs/Games/Techniques/3D_collision_detection">åˆ¤æ–­åæ ‡æ˜¯å¦åœ¨XYZèŒƒå›´å†…ï¼Œå¦‚æœæ˜¯AABBï¼ˆå¯¹é½åæ ‡è½´ï¼‰<i class="fa fa-external-link"></i></span></li>
</ul>
<p>é’ˆå¯¹UE4ç¯å¢ƒï¼Œä¸€ä¸ªé•¿æ–¹ä½“ä¼šåŒ…å«transformä»¥åŠå•ä½å¤§å°çš„ä¿¡æ¯ï¼š</p>
<ul>
<li>ä½ç½®Locationï¼šä¸­å¿ƒç‚¹</li>
<li>æ—‹è½¬Rotationï¼šPitchã€Yawã€Roll</li>
<li>å¤§å°æ¯”ä¾‹Scale</li>
</ul>
<p>å› æ­¤è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨è¿™æ ·çš„æ­¥éª¤è§£å†³ï¼ˆåº”è¯¥æ˜¯å¯¹çš„å§ï¼Œæ•°å­¦ä¸å¥½= =ï¼‰ï¼š</p>
<ul>
<li>è·å–ä¸­å¿ƒç‚¹åˆ°ç›®æ ‡ç‚¹Açš„å‘é‡ï¼Œå…¶ä¸­ç›®æ ‡ç‚¹Aæ˜¯æˆ‘ä»¬éœ€è¦åˆ¤æ–­æ˜¯å¦åœ¨é•¿æ–¹ä½“å†…çš„ç‚¹</li>
<li>å¯¹è¿™ä¸ªå‘é‡è¿›è¡ŒåŸºäºRotationçš„é€†è¿ç®—ï¼Œè¿™æ ·ç›®æ ‡ç‚¹çš„ä½ç½®ä¼šå˜åŒ–ï¼Œå¾—åˆ°æ–°çš„ç›®æ ‡ç‚¹B</li>
<li>åˆ¤æ–­ç›®æ ‡ç‚¹Bï¼Œæ˜¯å¦åœ¨ä¸€ä¸ªä»¥Locationä¸ºä¸­å¿ƒç‚¹ï¼ŒScale*å•ä½é•¿åº¦å¤§å°çš„AABBä¸­</li>
</ul>
<p>è¿™é‡Œé¢æœ€éœ€è¦è§£å†³çš„ï¼Œæ˜¯å¦‚ä½•æ±‚æ—‹è½¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡UEå†…éƒ¨çš„æºç æ¥å¯»æ‰¾æ€è·¯ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// UnrealMath.cpp</span></span><br><span class="line"></span><br><span class="line">FVector FRotator::UnrotateVector(<span class="keyword">const</span> FVector&amp; V) <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> FRotationMatrix(*<span class="keyword">this</span>).GetTransposed().TransformVector( V );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FVector FRotator::RotateVector(<span class="keyword">const</span> FVector&amp; V) <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> FRotationMatrix(*<span class="keyword">this</span>).TransformVector( V );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±ä¸€ä¸ªæ—‹è½¬<code>FRotator</code>ï¼ˆå¸¦Pitchã€Yawã€Rollå±æ€§ï¼‰ï¼Œä»¥åŠä¸€ä¸ªå‘é‡ï¼Œå¯ä»¥ç›´æ¥æ±‚å¾—æ—‹è½¬å/é€†æ—‹è½¬åçš„å‘é‡ã€‚æ—‹è½¬ä¸€ä¸ªå‘é‡éœ€è¦æ„å»ºç‰¹å®šçš„<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLWhhbnMvJUU2JTk3JThCJUU4JUJEJUFDJUU3JTlGJUE5JUU5JTk4JUI1" title="https://zh.wikipedia.org/zh-hans/%E6%97%8B%E8%BD%AC%E7%9F%A9%E9%98%B5">æ—‹è½¬çŸ©é˜µ<i class="fa fa-external-link"></i></span>ï¼Œé€šè¿‡çŸ©é˜µä¹˜æ³•å¾—åˆ°æ–°å‘é‡åˆ†é‡çš„å€¼ã€‚é€†æ—‹è½¬çš„çŸ©é˜µåˆ™æ˜¯æ—‹è½¬çŸ©é˜µçš„è½¬ç½®ï¼Œè€Œè½¬æ¢åŸå‘é‡çš„è®¡ç®—æ–¹å¼ä¹Ÿæ˜¯ç›¸åŒçš„ã€‚</p>
<p>é’ˆå¯¹ä¸åŒçš„åæ ‡ç³»è§„åˆ™ï¼Œæ—‹è½¬çŸ©é˜µçš„è®¡ç®—æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œè€Œå®æµ‹UE4ç”¨çš„æ—‹è½¬çŸ©é˜µä¹Ÿæ˜¯ç‹¬ç‰¹çš„ä¸€ç§ï¼ˆè¯•è¿‡ç½‘ä¸Šçš„ä¸€äº›æ—‹è½¬çŸ©é˜µè€æ˜¯æœ‰åˆ†é‡æ­£è´Ÿå·ä¸å¯¹= =ï¼‰ã€‚åœ¨<code>FRotationMatrix</code>ã€<code>FRotationTranslationMatrix</code>çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ—‹è½¬çŸ©é˜µçš„æ„é€ æ–¹æ³•ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// RotationTranslationMatrix.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Origin should be (0.0, 0.0, 0.0) if not defined</span></span><br><span class="line">FORCEINLINE FRotationTranslationMatrix::FRotationTranslationMatrix(<span class="keyword">const</span> FRotator&amp; Rot, <span class="keyword">const</span> FVector&amp; Origin)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> SP, SY, SR;</span><br><span class="line">    <span class="keyword">float</span> CP, CY, CR;</span><br><span class="line">    FMath::SinCos(&amp;SP, &amp;CP, FMath::DegreesToRadians(Rot.Pitch));</span><br><span class="line">    FMath::SinCos(&amp;SY, &amp;CY, FMath::DegreesToRadians(Rot.Yaw));</span><br><span class="line">    FMath::SinCos(&amp;SR, &amp;CR, FMath::DegreesToRadians(Rot.Roll));</span><br><span class="line"></span><br><span class="line">    M[<span class="number">0</span>][<span class="number">0</span>] = CP * CY;</span><br><span class="line">    M[<span class="number">0</span>][<span class="number">1</span>] = CP * SY;</span><br><span class="line">    M[<span class="number">0</span>][<span class="number">2</span>] = SP;</span><br><span class="line">    M[<span class="number">0</span>][<span class="number">3</span>] = <span class="number">0.f</span>;</span><br><span class="line"></span><br><span class="line">    M[<span class="number">1</span>][<span class="number">0</span>] = SR * SP * CY - CR * SY;</span><br><span class="line">    M[<span class="number">1</span>][<span class="number">1</span>] = SR * SP * SY + CR * CY;</span><br><span class="line">    M[<span class="number">1</span>][<span class="number">2</span>] = - SR * CP;</span><br><span class="line">    M[<span class="number">1</span>][<span class="number">3</span>] = <span class="number">0.f</span>;</span><br><span class="line"></span><br><span class="line">    M[<span class="number">2</span>][<span class="number">0</span>] = -( CR * SP * CY + SR * SY );</span><br><span class="line">    M[<span class="number">2</span>][<span class="number">1</span>] = CY * SR - CR * SP * SY;</span><br><span class="line">    M[<span class="number">2</span>][<span class="number">2</span>] = CR * CP;</span><br><span class="line">    M[<span class="number">2</span>][<span class="number">3</span>] = <span class="number">0.f</span>;</span><br><span class="line"></span><br><span class="line">    M[<span class="number">3</span>][<span class="number">0</span>] = Origin.X;</span><br><span class="line">    M[<span class="number">3</span>][<span class="number">1</span>] = Origin.Y;</span><br><span class="line">    M[<span class="number">3</span>][<span class="number">2</span>] = Origin.Z;</span><br><span class="line">    M[<span class="number">3</span>][<span class="number">3</span>] = <span class="number">1.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ—‹è½¬çŸ©é˜µæ˜¯ä¸€ä¸ª4x4çš„ç»“æ„ï¼ˆå› ä¸ºå¯èƒ½æœ‰è®¾å®šåŸç‚¹åæ ‡ï¼‰ã€‚è€Œä¹‹åï¼Œ<code>TransformVector</code>æ˜¯è¿™æ ·è®¡ç®—çš„ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Matrix.inl</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Transform vector</span></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * Transform a direction vector - will not take into account translation part of the FMatrix. </span></span><br><span class="line"><span class="comment"> * If you want to transform a surface normal (or plane) and correctly account for non-uniform scaling you should use TransformByUsingAdjointT.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">FORCEINLINE FVector4 FMatrix::TransformVector(<span class="keyword">const</span> FVector&amp; V) <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> TransformFVector4(FVector4(V.X,V.Y,V.Z,<span class="number">0.0f</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Homogeneous transform.</span></span><br><span class="line"></span><br><span class="line">FORCEINLINE FVector4 FMatrix::TransformFVector4(<span class="keyword">const</span> FVector4 &amp;P) <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    FVector4 Result;</span><br><span class="line">    VectorRegister VecP = VectorLoadAligned(&amp;P);</span><br><span class="line">    VectorRegister VecR = VectorTransformVector(VecP, <span class="keyword">this</span>);</span><br><span class="line">    VectorStoreAligned(VecR, &amp;Result);</span><br><span class="line">    <span class="keyword">return</span> Result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UnrealMathSSE.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calculate Homogeneous transform.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param VecP VectorRegister </span></span><br><span class="line"><span class="comment"> * @param MatrixM FMatrix pointer to the Matrix to apply transform</span></span><br><span class="line"><span class="comment"> * @return VectorRegister = VecP*MatrixM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">FORCEINLINE VectorRegister <span class="title">VectorTransformVector</span><span class="params">(<span class="keyword">const</span> VectorRegister&amp;  VecP,  <span class="keyword">const</span> <span class="keyword">void</span>* MatrixM )</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> VectorRegister *M = (<span class="keyword">const</span> VectorRegister *) MatrixM;</span><br><span class="line">    VectorRegister VTempX, VTempY, VTempZ, VTempW;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Splat x,y,z and w</span></span><br><span class="line">    VTempX = VectorReplicate(VecP, <span class="number">0</span>);</span><br><span class="line">    VTempY = VectorReplicate(VecP, <span class="number">1</span>);</span><br><span class="line">    VTempZ = VectorReplicate(VecP, <span class="number">2</span>);</span><br><span class="line">    VTempW = VectorReplicate(VecP, <span class="number">3</span>);</span><br><span class="line">    <span class="comment">// Mul by the matrix</span></span><br><span class="line">    VTempX = VectorMultiply(VTempX, M[<span class="number">0</span>]);</span><br><span class="line">    VTempY = VectorMultiply(VTempY, M[<span class="number">1</span>]);</span><br><span class="line">    VTempZ = VectorMultiply(VTempZ, M[<span class="number">2</span>]);</span><br><span class="line">    VTempW = VectorMultiply(VTempW, M[<span class="number">3</span>]);</span><br><span class="line">    <span class="comment">// Add them all together</span></span><br><span class="line">    VTempX = VectorAdd(VTempX, VTempY);</span><br><span class="line">    VTempZ = VectorAdd(VTempZ, VTempW);</span><br><span class="line">    VTempX = VectorAdd(VTempX, VTempZ);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> VTempX;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€ç»ˆå…¶å®å°±æ˜¯åŸå‘é‡<code>[[x, y, z, 0]]ï¼ˆ1x4ï¼‰</code>ä¹˜ä»¥<code>è½¬ç½®çŸ©é˜µï¼ˆ4x4ï¼‰</code>ï¼Œå¾—åˆ°æ–°çš„<code>1x4</code>çš„å‘é‡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ—‹è½¬åçš„å‘é‡ã€‚UE4å†…éƒ¨å¯¹è®¡ç®—è¿‡ç¨‹åšäº†ä¼˜åŒ–ï¼Œæ­¤å¤„æš‚ä¸å¤šåšåˆ†æã€‚</p>
<p>å¾—åˆ°äº†è®¡ç®—å‘é‡æ—‹è½¬çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å…¶è½¬ç½®çŸ©é˜µï¼Œè¿›è¡Œå‘é‡çš„æŸä¸ªæ—‹è½¬çš„é€†è¿ç®—ï¼Œè¿™æ ·ç›®æ ‡ç‚¹ç›¸å¯¹äºä¸­å¿ƒç‚¹çš„ä½ç½®æœ‰æ‰€æ”¹å˜ï¼Œä½†å¯¹åº”çš„é•¿æ–¹ä½“å°±æ˜¯å¯¹é½åæ ‡è½´çš„äº†ã€‚è¿™æ—¶å°±å¯ä»¥ç›´æ¥é€šè¿‡åˆ¤æ–­ç‚¹çš„ä¸‰ä¸ªåˆ†é‡æ˜¯ä¸æ˜¯åœ¨é•¿æ–¹ä½“Xã€Yã€ZèŒƒå›´å†…ï¼Œå°±èƒ½å¾—å‡ºç­”æ¡ˆã€‚</p>
]]></content>
      <categories>
        <category>æ¸¸æˆå¼€å‘</category>
      </categories>
      <tags>
        <tag>UE4</tag>
        <tag>æ•°å­¦</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>NavModifierVolume</tag>
        <tag>æ—‹è½¬çŸ©é˜µ</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¸¸æˆå¼€å‘ã€‘UE4ç”¨C++ç¼–å†™è¡Œä¸ºæ ‘çš„Taskã€Serviceã€DecoratorèŠ‚ç‚¹</title>
    <url>/2021/08/21/gamedev/ue4_cpp_btree_nodes/</url>
    <content><![CDATA[<p>åœ¨æ¸¸æˆé¢†åŸŸï¼Œè¡Œä¸ºæ ‘æ˜¯å¸¸ç”¨çš„AIè§£å†³æ–¹æ¡ˆï¼Œç”¨è¡Œä¸ºæ ‘å¯ä»¥å¿«é€Ÿæ˜äº†åœ°æè¿°AIçš„è¡Œä¸ºæ¨¡å‹ï¼Œè€ŒUE4æä¹Ÿä¾›äº†éå¸¸å®Œå–„çš„è¡Œä¸ºæ ‘è§£å†³æ–¹æ¡ˆï¼Œä¸ä»…æœ‰ç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œè€Œä¸”ä¹Ÿæœ‰å¤šæ ·åŒ–çš„åº•å±‚æ”¯æŒã€‚åœ¨å®˜ç½‘çš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9JbnRlcmFjdGl2ZUV4cGVyaWVuY2VzL0FydGlmaWNpYWxJbnRlbGxpZ2VuY2UvQmVoYXZpb3JUcmVlcy9CZWhhdmlvclRyZWVRdWlja1N0YXJ0Lw==" title="https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/ArtificialIntelligence/BehaviorTrees/BehaviorTreeQuickStart/">è¡Œä¸ºæ ‘å¿«é€Ÿå…¥é—¨æŒ‡å—<i class="fa fa-external-link"></i></span>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°UE4è¡Œä¸ºæ ‘ç¼–è¾‘å™¨çš„ä½¿ç”¨ä»¥åŠç”¨è“å›¾åˆ›é€ è¡Œä¸ºæ ‘èŠ‚ç‚¹çš„æ–¹å¼ï¼Œè€Œåœ¨ä¸€äº›ç‰¹å®šçš„éœ€æ±‚å½“ä¸­ï¼Œè“å›¾ç›¸å¯¹äºC++å¹¶ä¸ä¼šéå¸¸çµæ´»ã€‚å› æ­¤ï¼Œç¬”è€…ç¨å¾®ç ”ç©¶äº†ä¸‹è¡Œä¸ºæ ‘C++å±‚æ¬¡ä¸­çš„å†…å®¹ï¼Œç®€å•åˆ†äº«ä¸‹è¡Œä¸ºæ ‘é‡Œå„ç§èŠ‚ç‚¹çš„C++å†™æ³•</p>
<p>é¦–å…ˆä¸Šä¸€å¼ è¡Œä¸ºæ ‘å®Œæ•´å›¾ï¼Œæ˜¯åŸºäº<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9JbnRlcmFjdGl2ZUV4cGVyaWVuY2VzL0FydGlmaWNpYWxJbnRlbGxpZ2VuY2UvRVFTL0VRU1F1aWNrU3RhcnQv" title="https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/ArtificialIntelligence/EQS/EQSQuickStart/">åœºæ™¯æŸ¥è¯¢ç³»ç»Ÿï¼ˆEQSï¼‰å¿«é€Ÿå…¥é—¨<i class="fa fa-external-link"></i></span>åˆ¶ä½œçš„ï¼š</p>
<a id="more"></a>
<p><img src="/uploads/gamedev/ue4_cpp_btree_nodes/btree.png" alt="btree" title="&#39;btree&#39;"></p>
<p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9JbnRlcmFjdGl2ZUV4cGVyaWVuY2VzL0FydGlmaWNpYWxJbnRlbGxpZ2VuY2UvRVFTL0VRU1F1aWNrU3RhcnQv" title="https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/ArtificialIntelligence/EQS/EQSQuickStart/">å®˜ç½‘EQSå…¥é—¨<i class="fa fa-external-link"></i></span>çš„ä¾‹å­ä¸­ï¼ŒAIå¤§è‡´éµå¾ªè¿™æ ·çš„é€»è¾‘ï¼š</p>
<ul>
<li>æ²¡çœ‹åˆ°ç©å®¶ï¼Œç‰¹å®šèŒƒå›´éšæœºæŸä¸ªç‚¹å·¡é€»</li>
<li>è§†è§‰æ„ŸçŸ¥åˆ°ç©å®¶ï¼Œä¼šè½¬å‘çœ‹ç€ç©å®¶</li>
<li>ç©å®¶ç¦»å¼€è§†çº¿ï¼Œè°ƒç”¨EQSæ‰¾åˆ°å½“å‰æ—¶åˆ»æœ€å¥½çš„èƒ½çœ‹åˆ°ç©å®¶çš„ä½ç½®ï¼Œèµ°è¿‡å»</li>
<li>çœ‹ä¸åˆ°ç©å®¶ï¼Œå†å›åˆ°éšæœºå·¡é€»</li>
</ul>
<p>è€Œåœ¨ç¬”è€…çš„è¡Œä¸ºæ ‘å®Œæ•´å›¾ä¸­ï¼Œæ·»åŠ äº†ä»¥ä¸‹çš„èŠ‚ç‚¹ï¼š</p>
<ul>
<li>ä»»åŠ¡èŠ‚ç‚¹ï¼ˆTaskï¼‰ï¼šJumpForNTimes -&gt; è·³Næ¬¡</li>
<li>æœåŠ¡èŠ‚ç‚¹ï¼ˆServiceï¼‰ï¼šTraceDistance -&gt; ç›‘æ§AIåˆ°æŸä¸ªç‚¹çš„è·ç¦»</li>
<li>è£…é¥°å™¨èŠ‚ç‚¹ï¼ˆDecoratorï¼‰ï¼šCheckActorDistance -&gt; æ£€æŸ¥AIåˆ°æŸä¸ªActorçš„è·ç¦»</li>
</ul>
<p>æœ€ç»ˆæƒ³è¦è¾¾åˆ°çš„AIç›®çš„ï¼š</p>
<ul>
<li>æ²¡çœ‹åˆ°ç©å®¶ï¼Œç‰¹å®šèŒƒå›´éšæœºæŸä¸ªç‚¹å·¡é€»</li>
<li>è§†è§‰æ„ŸçŸ¥åˆ°ç©å®¶ï¼Œä¼šè½¬å‘çœ‹ç€ç©å®¶ï¼Œç„¶åè·³Næ¬¡ï¼ˆJumpForNTimesï¼‰ï¼Œå¹¶ä¸”ä¼šåœ¨å±å¹•å®æ—¶æ‰“å°AIè·Ÿç©å®¶çš„è·ç¦»ï¼ˆTraceDistanceï¼‰</li>
<li>ç©å®¶ç¦»å¼€è§†çº¿ï¼Œè°ƒç”¨EQSæ‰¾åˆ°å½“å‰æ—¶åˆ»æœ€å¥½çš„èƒ½çœ‹åˆ°ç©å®¶çš„ä½ç½®ï¼Œèµ°è¿‡å»</li>
<li>çœ‹ä¸åˆ°ç©å®¶ï¼Œå†å›åˆ°éšæœºå·¡é€»ã€‚ä½†å¦‚æœç©å®¶å†æ¬¡æ¥è¿‘åˆ°ä¸€å®šè·ç¦»ï¼ŒAIä¼šâ€œè­¦è§‰â€ï¼ˆCheckActorDistanceï¼‰ï¼Œæ‰§è¡Œè·³Næ¬¡çš„æ“ä½œ</li>
</ul>
<p>ä¸‹é¢å°±ä¸€èµ·æ¥çœ‹ä¸‹è¿™ä¸‰ä¸ªèŠ‚ç‚¹å…·ä½“çš„å†™æ³•ã€‚åœ¨å†™è¿™äº›è¡Œä¸ºæ ‘èŠ‚ç‚¹å…·ä½“é€»è¾‘ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦åœ¨<code>Build.cs</code>çš„<code>PublicDependencyModuleNames</code>åŠ ä¸Š<code>AIModule</code>è·Ÿ<code>GameplayTasks</code>ï¼Œä¿è¯ä¸‰ç§èŠ‚ç‚¹æ‰€éœ€è¦çš„æ–¹æ³•éƒ½èƒ½æ”¯æŒ</p>
<h2 id="TaskèŠ‚ç‚¹ï¼šJumpForNTimes"><a href="#TaskèŠ‚ç‚¹ï¼šJumpForNTimes" class="headerlink" title="TaskèŠ‚ç‚¹ï¼šJumpForNTimes"></a>TaskèŠ‚ç‚¹ï¼šJumpForNTimes</h2><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9JbnRlcmFjdGl2ZUV4cGVyaWVuY2VzL0FydGlmaWNpYWxJbnRlbGxpZ2VuY2UvQmVoYXZpb3JUcmVlcy9CZWhhdmlvclRyZWVOb2RlUmVmZXJlbmNlL0JlaGF2aW9yVHJlZU5vZGVSZWZlcmVuY2VUYXNrcy8=" title="https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/ArtificialIntelligence/BehaviorTrees/BehaviorTreeNodeReference/BehaviorTreeNodeReferenceTasks/">taskèŠ‚ç‚¹<i class="fa fa-external-link"></i></span>è¡¨ç¤ºAIå®é™…çš„ä¸€ç§æ“ä½œï¼Œæˆ‘ä»¬åœ¨UE4æºç çš„<code>Runtime/AIModule/Classes/BehaviorTree/Tasks</code>ä¸­èƒ½å¤Ÿçœ‹åˆ°é¢„è®¾çš„è®¸å¤štaskèŠ‚ç‚¹çš„å®šä¹‰ã€‚<code>JumpForNTimes</code>è¿™ç±»æ“ä½œå¹¶ä¸æ˜¯ç¬æ—¶çš„ï¼Œéœ€è¦è·³å®ŒNæ¬¡åæ‰ä¼šæ‰§è¡Œåé¢çš„åŠ¨ä½œï¼Œå› æ­¤åœ¨å†™æ³•ä¸Šï¼Œå¯ä»¥å‚è€ƒ<code>BTTask_Wait</code>çš„å®ç°ã€‚</p>
<p>é¦–å…ˆåˆ›å»º<code>BTTask_JumpForNTimes</code>ç±»ï¼Œç»§æ‰¿<code>UBTTaskNode</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BTTask_JumpForNTimes.h</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FBTJumpForNTimesTaskMemory</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    int32 JumpTimesInternal;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jump for n times btree task</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TESTEQS_API</span> <span class="title">UBTTask_JumpForNTimes</span> :</span> <span class="keyword">public</span> UBTTaskNode</span><br><span class="line">&#123;</span><br><span class="line">    GENERATED_UCLASS_BODY()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** jump times */</span></span><br><span class="line">    UPROPERTY(Category = Jump, EditAnywhere)</span><br><span class="line">    int32 JumpTimes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">virtual</span> EBTNodeResult::<span class="function">Type <span class="title">ExecuteTask</span><span class="params">(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory)</span> override</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> uint16 <span class="title">GetInstanceMemorySize</span><span class="params">()</span> <span class="keyword">const</span> override</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> FName <span class="title">GetNodeIconName</span><span class="params">()</span> <span class="keyword">const</span> override</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// WITH_EDITOR</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">TickTask</span><span class="params">(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory, <span class="keyword">float</span> DeltaSeconds)</span> override</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>UBTTask_JumpForNTimesï¼šJumpForNTimesä»»åŠ¡èŠ‚ç‚¹å®šä¹‰<ul>
<li>JumpTimesï¼šè·³è·ƒæ¬¡æ•°ï¼Œæ˜¯éœ€è¦æˆ‘ä»¬åœ¨ç¼–è¾‘å™¨é‡Œè®¾ç½®çš„å†…å®¹ï¼Œå› æ­¤éœ€è¦æ ‡æ³¨<code>UPROPERTY</code>+<code>EditAnywhere</code></li>
<li>ExecuteTaskï¼šä»»åŠ¡æ‰§è¡Œæ—¶çš„é€»è¾‘ã€‚<ul>
<li><code>EBTNodeResult</code>æ˜¯taskèŠ‚ç‚¹æ‰§è¡Œçš„ç»“æœè¡¨ç¤º</li>
<li>å¯¹äºéç¬æ—¶å®Œæˆçš„ä»»åŠ¡ï¼ˆæ¯”å¦‚Waitï¼‰ï¼Œå¯ä»¥åœ¨<code>ExecuteTask</code>æ¥å£ä¸­è¿”å›<code>EBTNodeResult::InProgress</code>ï¼ˆä»»åŠ¡è¿›è¡Œä¸­ï¼‰ï¼Œå¹¶åœ¨åé¢çš„<code>TickTask</code>ä¸­åˆ¤æ–­å®Œæˆæ¡ä»¶ï¼Œæ‰§è¡Œ<code>FinishLatentTask(OwnerComp, EBTNodeResult)</code>æ¥é€šçŸ¥ä»»åŠ¡çš„å®Œæˆç»“æœ</li>
</ul>
</li>
<li>TickTaskï¼šæ¯ä¸ªtickä¸­è¯¥ä»»åŠ¡æ‰§è¡Œçš„é€»è¾‘</li>
<li>GetInstanceMemorySizeï¼šè·å–èŠ‚ç‚¹å®ä¾‹è‡ªå·±çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œç”¨äºé¢„åˆ†é…å†…å­˜</li>
<li>GetNodeIconNameï¼šç¼–è¾‘å™¨é‡ŒèŠ‚ç‚¹icon</li>
</ul>
</li>
<li>FBTJumpForNTimesTaskMemoryï¼šæˆ‘ä»¬ä»»åŠ¡èŠ‚ç‚¹è‡ªå¸¦çš„å†…å­˜ç©ºé—´ï¼Œæ”¾ç€èŠ‚ç‚¹ç§æœ‰çš„å˜é‡<ul>
<li>JumpTimesInternalï¼šå®é™…ç”¨æ¥è®°å½•è·³è·ƒæ¬¡æ•°çš„è®¡æ•°å™¨</li>
<li>åœ¨GetInstanceMemorySizeè¿”å›sizeofç»“æ„ä½“ï¼Œè¿™æ ·å¼•æ“ä¼šé¢„åˆ†é…ç›¸åº”å¤§å°çš„å†…å­˜å—</li>
<li>åœ¨ExecuteTaskã€TickTaskå¯ä»¥é€šè¿‡è½¬æ¢uint8* NodeMemoryè·å¾—å†…å­˜å—å¯¹åº”ç»“æ„ä½“çš„å®ä¾‹</li>
</ul>
</li>
</ul>
<p>åœ¨cppé€»è¾‘é‡Œï¼Œ<code>JumpForNTimes</code>å¯ä»¥è¿™æ ·å®ç°ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BTTask_JumpForNTimes.cpp</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å‡½æ•°ï¼Œå¯ç”¨tick -&gt; bNotifyTick = true</span></span><br><span class="line">UBTTask_JumpForNTimes::UBTTask_JumpForNTimes(<span class="keyword">const</span> FObjectInitializer&amp; ObjectInitializer) : Super(ObjectInitializer)</span><br><span class="line">&#123;</span><br><span class="line">    NodeName = <span class="string">"JumpForNTimes"</span>;</span><br><span class="line">    JumpTimes = <span class="number">3</span>;</span><br><span class="line">    bNotifyTick = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼€å§‹æ‰§è¡Œä»»åŠ¡ï¼Œå…ˆé‡ç½®JumpTimesInternalï¼Œè¿”å›InProgress</span></span><br><span class="line">EBTNodeResult::Type UBTTask_JumpForNTimes::ExecuteTask(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (JumpTimes &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> EBTNodeResult::Failed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    FBTJumpForNTimesTaskMemory* MyMemory = (FBTJumpForNTimesTaskMemory*)NodeMemory;</span><br><span class="line">    MyMemory-&gt;JumpTimesInternal = JumpTimes;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> AController* Controller = Cast&lt;AController&gt;(OwnerComp.GetOwner());</span><br><span class="line">    ACharacter* Character = Controller ? Controller-&gt;GetCharacter() : <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (!Character)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> EBTNodeResult::Failed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EBTNodeResult::InProgress;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨tickä¸­ï¼Œæ£€æŸ¥ç©å®¶æ˜¯å¦åœ¨è·³è·ƒè¿‡ç¨‹</span></span><br><span class="line"><span class="comment">// å¦‚æœæ²¡æœ‰çš„è¯ï¼Œçœ‹ä¸‹è®¡æ•°æ˜¯å¦åˆ°0ï¼Œåˆ°0äº†å°±ä¸è·³ï¼Œè¿˜æ²¡æœ‰å°±ç»§ç»­è·³</span></span><br><span class="line"><span class="keyword">void</span> UBTTask_JumpForNTimes::TickTask(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory, <span class="keyword">float</span> DeltaSeconds)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> AController* Controller = Cast&lt;AController&gt;(OwnerComp.GetOwner());</span><br><span class="line">    ACharacter* Character = Controller ? Controller-&gt;GetCharacter() : <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (!Character) &#123;</span><br><span class="line">        FinishLatentTask(OwnerComp, EBTNodeResult::Failed);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!Character-&gt;GetMovementComponent()-&gt;IsFalling())</span><br><span class="line">    &#123;</span><br><span class="line">        FBTJumpForNTimesTaskMemory* MyMemory = (FBTJumpForNTimesTaskMemory*)NodeMemory;</span><br><span class="line">        <span class="keyword">if</span> (MyMemory-&gt;JumpTimesInternal &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            FinishLatentTask(OwnerComp, EBTNodeResult::Succeeded);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (!Character-&gt;bPressedJump)</span><br><span class="line">        &#123;</span><br><span class="line">            Character-&gt;Jump();</span><br><span class="line">            MyMemory-&gt;JumpTimesInternal--;</span><br><span class="line">            UE_LOG(LogTemp, Log, TEXT(<span class="string">"[BTTask_JumpForNTimes] JumpTimes--"</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›ç»“æ„ä½“å¤§å°</span></span><br><span class="line">uint16 UBTTask_JumpForNTimes::GetInstanceMemorySize() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">sizeof</span>(FBTJumpForNTimesTaskMemory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line"><span class="comment">// éšä¾¿è¿”å›ä¸ªiconåå­—å°±å¥½äº†</span></span><br><span class="line">FName UBTTask_JumpForNTimes::GetNodeIconName() <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// use MakeNoise icon for jump~</span></span><br><span class="line">    <span class="keyword">return</span> FName(<span class="string">"BTEditor.Graph.BTNode.Task.MakeNoise.Icon"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h2 id="ServiceèŠ‚ç‚¹ï¼šTraceDistance"><a href="#ServiceèŠ‚ç‚¹ï¼šTraceDistance" class="headerlink" title="ServiceèŠ‚ç‚¹ï¼šTraceDistance"></a>ServiceèŠ‚ç‚¹ï¼šTraceDistance</h2><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9JbnRlcmFjdGl2ZUV4cGVyaWVuY2VzL0FydGlmaWNpYWxJbnRlbGxpZ2VuY2UvQmVoYXZpb3JUcmVlcy9CZWhhdmlvclRyZWVOb2RlUmVmZXJlbmNlL0JlaGF2aW9yVHJlZU5vZGVSZWZlcmVuY2VTZXJ2aWNlcy8=" title="https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/ArtificialIntelligence/BehaviorTrees/BehaviorTreeNodeReference/BehaviorTreeNodeReferenceServices/">ServiceèŠ‚ç‚¹<i class="fa fa-external-link"></i></span>é€šå¸¸ç”¨äºåœ¨æŸä¸ªè¡Œä¸ºèŠ‚ç‚¹/åˆ†æ”¯æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰§è¡Œå“åº”çš„æ£€æŸ¥é€»è¾‘æ›´æ–°é»‘æ¿ï¼Œäº¦æˆ–æ˜¯ä½œä¸ºsidecarå¼çš„é€»è¾‘ç›‘æ§èŠ‚ç‚¹/åˆ†æ”¯çš„è¿è¡Œæƒ…å†µã€‚</p>
<p>TraceDistanceåªç”¨äºå®æ—¶ç›‘æ§AIåˆ°æŸä¸ªç‚¹çš„è·ç¦»ï¼Œå¹¶ä¸”åœ¨å±å¹•ä¸Šæ‰“å°æ•°æ®ã€‚åœ¨å®ç°ä¸Šå¯ä»¥å‚è€ƒå·²æœ‰çš„<code>BTService_DefaultFocus</code>è·Ÿ<code>BTService_RunEQS</code>æ¥å†™</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BTService_TraceDistance.h</span></span><br><span class="line"></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TESTEQS_API</span> <span class="title">UBTService_TraceDistance</span> :</span> <span class="keyword">public</span> UBTService_BlackboardBase</span><br><span class="line">&#123;</span><br><span class="line">    GENERATED_BODY()</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    UBTService_TraceDistance(<span class="keyword">const</span> FObjectInitializer&amp; ObjectInitializer = FObjectInitializer::Get());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">TickNode</span><span class="params">(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory, <span class="keyword">float</span> DeltaSeconds)</span> override</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnCeaseRelevant</span><span class="params">(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory)</span> override</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> WITH_EDITOR</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> FName <span class="title">GetNodeIconName</span><span class="params">()</span> <span class="keyword">const</span> override</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// WITH_EDITOR</span></span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">const</span> int32 LogKey = <span class="number">9527</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨å¤´æ–‡ä»¶é‡Œå®šä¹‰<code>UBTService_TraceDistance</code>ï¼Œç»§æ‰¿<code>UBTService_BlackboardBase</code>ã€‚<code>UBTService_BlackboardBase</code>é»˜è®¤æä¾›äº†ä¸€ä¸ªå¯é€‰é»‘æ¿Keyçš„å±æ€§ï¼Œåœ¨ç¼–è¾‘å™¨é‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªé€‰é¡¹çš„ã€‚å…¶ä»–å±æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>TickNode</code>æ˜¯è¿™ä¸ªServiceç”Ÿå‘½å‘¨æœŸé‡Œçš„ä¸€ä¸ªhookå‡½æ•°ï¼Œè¡¨ç¤ºæ¯Tickçš„è¡Œä¸º</li>
<li><code>OnCeaseRelevant</code>ä¹Ÿæ˜¯è¿™ä¸ªServiceç”Ÿå‘½å‘¨æœŸé‡Œçš„hookå‡½æ•°ï¼Œè¡¨ç¤ºå½“è¡Œä¸ºæ ‘è¿è¡Œåˆ°å’Œè¿™ä¸ªServiceä¸ç›¸å…³ï¼ˆServiceç»“æŸæœåŠ¡ï¼‰æ—¶å€™çš„é€»è¾‘æ“ä½œ</li>
<li>å½“ç„¶é™¤äº†è¿™ä¸¤è€…è¿˜æœ‰ä¸€ä¸ª<code>OnBecomeRelevant</code>é’©å­è¡¨ç¤ºå½“è¿è¡Œåˆ°å’ŒServiceç›¸å…³çš„èŠ‚ç‚¹/åˆ†æ”¯æ—¶å€™çš„é€»è¾‘æ“ä½œã€‚</li>
</ul>
<p>æˆ‘ä»¬æ‰“ç®—åœ¨æ¯ä¸ªtickæ—¶å€™åœ¨ç‰¹å®šçš„<code>LogKey</code>æ‰“å°AIä¸ç©å®¶çš„è·ç¦»ï¼Œè€Œåœ¨ç©å®¶æ²¡æ³•å†çœ‹åˆ°ï¼ˆTargetActorè¢«æ¸…ç©ºï¼‰æ—¶å€™æ‰“å°â€œè¿½è¸ªè·ç¦»ç»“æŸâ€çš„å­—æ ·ã€‚å› æ­¤cppé‡Œå¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BTService_TraceDistance.cpp</span></span><br><span class="line"></span><br><span class="line">UBTService_TraceDistance::UBTService_TraceDistance(<span class="keyword">const</span> FObjectInitializer&amp; ObjectInitializer)</span><br><span class="line">    : Super(ObjectInitializer)</span><br><span class="line">&#123;</span><br><span class="line">    NodeName = <span class="string">"Trace Distance"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ç”¨tickè·ŸCeaseRelevantï¼Œä¸å¯ç”¨BecomeRelevant</span></span><br><span class="line">    bNotifyTick = <span class="literal">true</span>;</span><br><span class="line">    bTickIntervals = <span class="literal">true</span>;</span><br><span class="line">    bNotifyBecomeRelevant = <span class="literal">false</span>;</span><br><span class="line">    bNotifyCeaseRelevant = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// accept only actors and vectorsï¼Œé™åˆ¶åªèƒ½é€‰æŸä¸ªç‰¹å®šä½ç½®ï¼Œæˆ–è€…actor</span></span><br><span class="line">    BlackboardKey.AddObjectFilter(<span class="keyword">this</span>, GET_MEMBER_NAME_CHECKED(UBTService_TraceDistance, BlackboardKey), AActor::StaticClass());</span><br><span class="line">    BlackboardKey.AddVectorFilter(<span class="keyword">this</span>, GET_MEMBER_NAME_CHECKED(UBTService_TraceDistance, BlackboardKey));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> UBTService_TraceDistance::TickNode(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory, <span class="keyword">float</span> DeltaSeconds)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!GEngine)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get controlled pawn location</span></span><br><span class="line">    <span class="keyword">const</span> AController* Controller = Cast&lt;AController&gt;(OwnerComp.GetOwner());</span><br><span class="line">    APawn* Pawn = Controller ? Controller-&gt;GetPawn() : <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (!Pawn)</span><br><span class="line">    &#123;</span><br><span class="line">        GEngine-&gt;AddOnScreenDebugMessage(LogKey, <span class="number">5.0f</span>, FColor::Red, TEXT(<span class="string">"cannot get controlled pawn"</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    FVector PawnLoc = Pawn-&gt;GetActorLocation();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// get target location</span></span><br><span class="line">    UBlackboardComponent* Blackboard = OwnerComp.GetBlackboardComponent();</span><br><span class="line">    <span class="keyword">if</span> (!Blackboard)</span><br><span class="line">    &#123;</span><br><span class="line">        GEngine-&gt;AddOnScreenDebugMessage(LogKey, <span class="number">5.0f</span>, FColor::Red, TEXT(<span class="string">"cannot get blackboard"</span>));</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">float</span> Distance = <span class="number">0.0f</span>;</span><br><span class="line">    <span class="keyword">if</span> (BlackboardKey.SelectedKeyType == UBlackboardKeyType_Object::StaticClass())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// object</span></span><br><span class="line">        UObject* KeyValue = Blackboard-&gt;GetValue&lt;UBlackboardKeyType_Object&gt;(BlackboardKey.GetSelectedKeyID());</span><br><span class="line">        AActor* TargetActor = Cast&lt;AActor&gt;(KeyValue);</span><br><span class="line">        <span class="keyword">if</span> (TargetActor)</span><br><span class="line">        &#123;</span><br><span class="line">            Distance = FVector::Distance(PawnLoc, TargetActor-&gt;GetActorLocation());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// vector</span></span><br><span class="line">        FVector DestLoc = Blackboard-&gt;GetValue&lt;UBlackboardKeyType_Vector&gt;(BlackboardKey.GetSelectedKeyID());</span><br><span class="line">        Distance = FVector::Distance(PawnLoc, DestLoc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// print log</span></span><br><span class="line">    FString Msg = FString::Printf(TEXT(<span class="string">"distance to destination: %.2f"</span>), Distance);</span><br><span class="line">    GEngine-&gt;AddOnScreenDebugMessage(LogKey, <span class="number">5.0f</span>, FColor::Yellow, Msg);</span><br><span class="line"></span><br><span class="line">    Super::TickNode(OwnerComp, NodeMemory, DeltaSeconds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> UBTService_TraceDistance::OnCeaseRelevant(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (GEngine)</span><br><span class="line">    &#123;</span><br><span class="line">        GEngine-&gt;AddOnScreenDebugMessage(LogKey, <span class="number">5.0f</span>, FColor::Yellow, TEXT(<span class="string">"trace distance finished"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="DecoratorèŠ‚ç‚¹ï¼šCheckActorDistance"><a href="#DecoratorèŠ‚ç‚¹ï¼šCheckActorDistance" class="headerlink" title="DecoratorèŠ‚ç‚¹ï¼šCheckActorDistance"></a>DecoratorèŠ‚ç‚¹ï¼šCheckActorDistance</h2><p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy96aC1DTi9JbnRlcmFjdGl2ZUV4cGVyaWVuY2VzL0FydGlmaWNpYWxJbnRlbGxpZ2VuY2UvQmVoYXZpb3JUcmVlcy9CZWhhdmlvclRyZWVOb2RlUmVmZXJlbmNlL0JlaGF2aW9yVHJlZU5vZGVSZWZlcmVuY2VEZWNvcmF0b3JzLw==" title="https://docs.unrealengine.com/4.27/zh-CN/InteractiveExperiences/ArtificialIntelligence/BehaviorTrees/BehaviorTreeNodeReference/BehaviorTreeNodeReferenceDecorators/">Decoratorè£…é¥°å™¨èŠ‚ç‚¹<i class="fa fa-external-link"></i></span>é€šå¸¸ç”¨æ¥è¡¨ç¤ºæŸç§æ¡ä»¶åˆ¤æ–­ã€‚æ¡ä»¶åˆ¤æ–­æˆç«‹åï¼ŒAIçš„æŸäº›è¡Œä¸ºæ˜¯å¦æ‰§è¡Œï¼Œæˆ–è€…æ‰§è¡Œä¼˜å…ˆçº§ï¼Œéƒ½ä¼šæœ‰æ‰€å˜åŒ–ã€‚</p>
<p>åœ¨CheckActorDistanceè£…é¥°å™¨é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›å®ç°åˆ¤æ–­AIè·ŸæŸä¸ªActorè·ç¦»åœ¨æŸä¸ªèŒƒå›´å†…ï¼Œå°±ä¼˜å…ˆæ‰§è¡Œè£…é¥°å™¨è£…é¥°åˆ°çš„èŠ‚ç‚¹/åˆ†æ”¯çš„è¡Œä¸ºã€‚æˆ‘ä»¬å¯ä»¥å‚ç…§å…¶å®ƒé¢„è®¾è£…é¥°å™¨çš„å®ç°ï¼Œæ¥ç¼–å†™CheckActorDistanceçš„é€»è¾‘</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BTDecorator_CheckActorDistance.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Check Actor Distance</span></span><br><span class="line"><span class="comment"> * activated if distance to specific actor is in specific radius</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TESTEQS_API</span> <span class="title">UBTDecorator_CheckActorDistance</span> :</span> <span class="keyword">public</span> UBTDecorator_BlackboardBase</span><br><span class="line">&#123;</span><br><span class="line">    GENERATED_BODY()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    UPROPERTY(EditAnywhere, Category = CheckActorDistance)</span><br><span class="line">        <span class="keyword">float</span> DistanceRadius;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">bool</span> <span class="title">CalculateRawConditionValue</span><span class="params">(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory)</span> <span class="keyword">const</span> override</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    UBTDecorator_CheckActorDistance(<span class="keyword">const</span> FObjectInitializer&amp; ObjectInitializer = FObjectInitializer::Get());</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>DistanceRadiusï¼šç¼–è¾‘å™¨é‡Œéœ€è¦è®¾ç½®çš„åŠå¾„èŒƒå›´</li>
<li>CalculateRawConditionValueï¼šç”¨æ¥è®¡ç®—è£…é¥°å™¨æ¡ä»¶æ˜¯å¦æˆç«‹çš„æ¥å£</li>
</ul>
<p>æˆ‘ä»¬åªéœ€è¦åœ¨<code>CalculateRawConditionValue</code>é‡Œåˆ¤æ–­è·ç¦»æ˜¯å¦åœ¨ç»™å®šèŒƒå›´å†…å°±å¥½ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// BTDecorator_CheckActorDistance.cpp</span></span><br><span class="line"></span><br><span class="line">BTDecorator_CheckActorDistance::UBTDecorator_CheckActorDistance(<span class="keyword">const</span> FObjectInitializer&amp; ObjectInitializer) : Super(ObjectInitializer)</span><br><span class="line">&#123;</span><br><span class="line">    NodeName = <span class="string">"Check Actor Distance"</span>;</span><br><span class="line"></span><br><span class="line">    BlackboardKey.AddObjectFilter(<span class="keyword">this</span>, GET_MEMBER_NAME_CHECKED(UBTDecorator_CheckActorDistance, BlackboardKey), AActor::StaticClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default to using Self Actor</span></span><br><span class="line">    BlackboardKey.SelectedKeyName = FBlackboard::KeySelf;</span><br><span class="line">    DistanceRadius = <span class="number">0.0f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­é»‘æ¿çš„æŸä¸ªactorè·Ÿaiæ§åˆ¶çš„pawnæ˜¯ä¸æ˜¯åœ¨ç»™å®šDistanceRadiuså†…</span></span><br><span class="line"><span class="keyword">bool</span> UBTDecorator_CheckActorDistance::CalculateRawConditionValue(UBehaviorTreeComponent&amp; OwnerComp, uint8* NodeMemory) <span class="keyword">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (UKismetMathLibrary::LessEqual_FloatFloat(DistanceRadius, <span class="number">0.0f</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> UBlackboardComponent* BlackboardComp = OwnerComp.GetBlackboardComponent();</span><br><span class="line">    <span class="keyword">if</span> (!BlackboardComp)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    AActor* TargetActor = Cast&lt;AActor&gt;(BlackboardComp-&gt;GetValue&lt;UBlackboardKeyType_Object&gt;(BlackboardKey.GetSelectedKeyID()));</span><br><span class="line">    <span class="keyword">if</span> (!TargetActor)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> AController* Controller = Cast&lt;AController&gt;(OwnerComp.GetOwner());</span><br><span class="line">    APawn* Pawn = Controller ? Controller-&gt;GetPawn() : <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="keyword">if</span> (!Pawn)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">float</span> Distance = FVector::Dist(TargetActor-&gt;GetActorLocation(), Pawn-&gt;GetActorLocation());</span><br><span class="line">    <span class="keyword">return</span> UKismetMathLibrary::LessEqual_FloatFloat(Distance, DistanceRadius);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨é»‘æ¿é‡Œæœ€å¥½åŠ ä¸ª<code>LastTargetActor</code>è¡¨ç¤ºä¸Šä¸€ä¸ªçœ‹åˆ°çš„<code>TargetActor</code>ï¼Œç„¶ååœ¨AIControlleré‡Œä¸¢å¤±è§†çº¿çš„é€»è¾‘ä¸­ï¼Œåœ¨æ¸…ç©º<code>TargetActor</code>ä¹‹å‰ï¼ŒæŠŠ<code>LastTargetActor</code>è®¾ç½®ä¸ºå½“å‰çš„<code>TargetActor</code>ï¼Œè¿™æ ·ä¸Šä¸€ä¸ª<code>TargetActor</code>åœ¨ä¸¢å¤±è§†çº¿åå›æ¥åˆ°ä¸€å®šèŒƒå›´ï¼ŒAIå°±ä¼šæœ‰â€œé¢„è­¦â€æ•ˆæœäº†</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>UEçš„AIModuleéå¸¸çš„å¤§ï¼Œè¡Œä¸ºæ ‘åªæ˜¯å†°å±±ä¸€è§’ï¼Œè¿˜æœ‰å¾ˆå¤šéœ€è¦ç»†ç»†ç ”ç©¶ã€‚</p>
]]></content>
      <categories>
        <category>æ¸¸æˆå¼€å‘</category>
      </categories>
      <tags>
        <tag>AI</tag>
        <tag>UE4</tag>
        <tag>C++</tag>
        <tag>è¡Œä¸ºæ ‘</tag>
        <tag>ä½ä»£ç </tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¸¸æˆå¼€å‘ã€‘åˆè¯†å¯»è·¯&amp;navmeshï¼Œæ¢ç´¢RecastDemo</title>
    <url>/2021/08/07/gamedev/recastdemo/</url>
    <content><![CDATA[<p>åœ¨æ‰‹æ¸¸æ—¶ä»£ï¼Œå°¤å…¶å¯¹äºå¤§ä¸–ç•Œæ¸¸æˆè€Œè¨€ï¼Œå¯»è·¯çš„å®ç°åŸºæœ¬åœ¨ä¸“é—¨çš„å¯»è·¯æœåŠ¡å™¨ä¸Šè¿›è¡Œã€‚åœ¨ä¼—å¤šå¯»è·¯çš„è§£å†³æ–¹æ¡ˆä¸­ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3JlY2FzdG5hdmlnYXRpb24vcmVjYXN0bmF2aWdhdGlvbg==" title="https://github.com/recastnavigation/recastnavigation">recastnavigation<i class="fa fa-external-link"></i></span>æ˜¯æœ€ä¸ºç»å…¸å®ç”¨çš„ä¸€ä¸ªï¼Œå¾ˆå¤šæ¸¸æˆç”šè‡³æ¸¸æˆå¼•æ“éƒ½é‡‡ç”¨ç±»ä¼¼çš„å®ç°ã€‚recastnavigationé¡¹ç›®è‡ªå¸¦äº†RecastDemoï¼Œç”¨å›¾å½¢åŒ–çš„ç•Œé¢å¸®åŠ©ç”¨æˆ·è®¤è¯†å¯»è·¯ç½‘æ ¼ï¼ˆnavmeshï¼‰çš„ç”Ÿæˆä»¥åŠå¯»è·¯çš„è¿‡ç¨‹ã€‚å› æ­¤ï¼Œä½œä¸ºåˆå­¦è€…çš„ç¬”è€…ï¼Œä¹Ÿå†³å®šé€šè¿‡RecastDemoå»åˆæ­¥è®¤è¯†å¯»è·¯çš„æœºç†å¥¥ç§˜ã€‚</p>
<h2 id="æ„å»ºRecastDemo"><a href="#æ„å»ºRecastDemo" class="headerlink" title="æ„å»ºRecastDemo"></a>æ„å»ºRecastDemo</h2><p>é¦–å…ˆå…‹éš†recastnavigationé¡¹ç›®ï¼Œä»æ–‡æ¡£ä¸­å¯ä»¥çœ‹åˆ°RecastDemoçš„æ„å»ºæ”¯æŒWindowsã€Linuxã€MacOSä¸‰ç«¯ã€‚ä»å®é™…æµ‹è¯•çš„æ•ˆæœæ¥çœ‹ï¼ŒMacOSå¯èƒ½å­˜åœ¨å­—ä½“æ— æ³•åŠ è½½çš„é—®é¢˜ï¼Œå»ºè®®æ˜¯ç”¨Windowsè·ŸLinuxè·‘ç€ç©ã€‚ä»¥Windowsä¸ºä¾‹ï¼Œé¦–å…ˆéœ€è¦ä¸‹è½½<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ByZW1ha2UvcHJlbWFrZS1jb3JlL3JlbGVhc2Vz" title="https://github.com/premake/premake-core/releases">premake5<i class="fa fa-external-link"></i></span>ä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly93d3cubGlic2RsLm9yZy9kb3dubG9hZC0yLjAucGhw" title="https://www.libsdl.org/download-2.0.php">SDLå¼€å‘åº“VC<i class="fa fa-external-link"></i></span>ã€‚premake5éœ€è¦æ”¾åˆ°<code>PATH</code>ä¸‹ï¼Œè€ŒSDLå¼€å‘åº“VCè§£å‹åéœ€è¦æŒ‰ç…§æ–‡æ¡£æè¿°ï¼Œæ”¾åˆ°recastnavigationé¡¹ç›®ç›®å½•çš„<code>RecastDemo/Contrib</code>ç›®å½•ä¸‹ï¼Œæ›´åä¸º<code>SDL</code>ã€‚</p>
<p>ä¹‹åï¼Œåœ¨<code>RecastDemo</code>ç›®å½•ä¸‹æ‰§è¡Œ<code>premake5 vs2019</code>ï¼Œå¯ä»¥åœ¨<code>RecastDemo/Build/vs2019</code>ä¸­çœ‹åˆ°<code>recastnavigation.sln</code>é¡¹ç›®æ–‡ä»¶ã€‚ç”¨VS2019æ‰“å¼€ï¼Œæ„å»ºRecastDemoï¼Œå°±ä¼šç”Ÿæˆexeåœ¨<code>RecastDemo/Bin</code>ç›®å½•ä¸‹ã€‚è¿›å…¥è¿™ä¸ªç›®å½•æ‰§è¡Œ<code>RecastDemo.exe</code>ï¼Œå°±èƒ½æ‰“å¼€å·¥å…·ç•Œé¢äº†ã€‚</p>
<h2 id="åŸºç¡€å¯»è·¯æ“ä½œ"><a href="#åŸºç¡€å¯»è·¯æ“ä½œ" class="headerlink" title="åŸºç¡€å¯»è·¯æ“ä½œ"></a>åŸºç¡€å¯»è·¯æ“ä½œ</h2><a id="more"></a>
<p>æ‰“å¼€è½¯ä»¶ï¼Œåœ¨å³ä¾§<code>Properties</code>é€‰ä¸­<code>Sample</code>ä¸º<code>Solo Mesh</code>ï¼Œ<code>Input Mesh</code>ä¸º<code>nav_test.obj</code>ï¼Œä¸‹æ‹‰ç‚¹å‡»<code>Build</code>ï¼Œå°±èƒ½çœ‹åˆ°ç”Ÿæˆnavmeshçš„ç»“æœ</p>
<p><img src="/uploads/gamedev/recastdemo/main_panel.png" alt="main_panel" title="&#39;main_panel&#39;"></p>
<p>åœ¨å·¦ä¾§çš„<code>Tools</code>æ ä¸‹ï¼Œç‚¹å‡»<code>Test NavMesh</code>ï¼Œç„¶ååœ¨åœ°è¡¨ä¸Šç”¨å³é”®ï¼ˆshift+å·¦é”®ï¼‰ä»¥åŠå·¦é”®åˆ†åˆ«æ ‡å®šèµ·å§‹ä½ç½®å’Œç»“æŸä½ç½®ï¼Œå°±èƒ½å¤Ÿç›´æ¥çœ‹åˆ°å¯»è·¯è·¯å¾„ç”Ÿæˆçš„ç»“æœ</p>
<p><img src="/uploads/gamedev/recastdemo/nav_result.png" alt="nav_result" title="&#39;nav_result&#39;"></p>
<p>å·¦ä¾§çš„<code>Tools</code>æ é‡Œé¢ï¼Œç‚¹é€‰<code>Pathfind Straight</code>ï¼Œå¯ä»¥çœ‹åˆ°å¯»è·¯è·¯å¾„çš„ç‚¹ä½è¿æ¥ï¼Œç‚¹é€‰<code>Pathfind Sliced</code>ï¼Œå¯ä»¥çœ‹åˆ°å¯»è·¯æŸ¥æ‰¾çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p>
<h2 id="å¯»è·¯å‚æ•°è°ƒæ•´"><a href="#å¯»è·¯å‚æ•°è°ƒæ•´" class="headerlink" title="å¯»è·¯å‚æ•°è°ƒæ•´"></a>å¯»è·¯å‚æ•°è°ƒæ•´</h2><p>ä»å…ˆå‰çš„navmeshç”Ÿæˆç»“æœå¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¥¼æ¢¯å¤„æ²¡æœ‰ç”Ÿæˆå¯»è·¯ç½‘æ ¼ï¼Œæ‰€ä»¥å¦‚æœç”¨è¿™ä¹ˆä¸€ä¸ªç»“æœæ”¾åˆ°æ¸¸æˆé‡Œçš„è¯ï¼Œç©å®¶æ˜¯ä¸å¯èƒ½è‡ªåŠ¨ä¸Šæ¥¼çš„ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨<code>Properties</code>ä¸­ï¼Œå¢åŠ <code>Agent</code>çš„<code>Max Climb</code>ï¼Œä½¿å¾—æ¥¼æ¢¯é«˜åº¦èƒ½å¤Ÿç¬¦åˆnavmeshç”Ÿæˆçš„æ ‡å‡†ã€‚ç¬¬äºŒç§æ˜¯è°ƒæ•´<code>Sample</code>ä¸º<code>Tile Mesh</code>ï¼Œä½¿å¾—navmeshèƒ½å¤Ÿä»¥ä¸€ä¸ªåœ°å—tileä¸ºå•ä½ç”Ÿæˆï¼Œåœ°å—ä¸ç›¸é‚»åœ°å—ä¹‹é—´ä¹Ÿä¼šè®¡ç®—è¿é€šæ€§ï¼Œä»è€Œä½¿å¾—å¯»è·¯ç½‘æ ¼å˜æˆä¸€ä¸ªæ•´ä½“ã€‚åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œnavmeshå°±ä¼šè¦†ç›–åˆ°æ¯ä¸ªå°é˜¶ã€‚ä¹‹åï¼Œå†ä½¿ç”¨è·³ç‚¹off-meshè¿æ¥æ¯ä¸ªå°é˜¶ï¼Œä½¿å¾—å°é˜¶ä¹‹é—´èƒ½å¤Ÿæˆä¸ºé€šè·¯ã€‚</p>
<p>æˆ‘ä»¬è°ƒæ•´<code>Sample</code>ä¸º<code>Tile Mesh</code>ï¼Œè°ƒå°<code>Cell Size</code>å’Œ<code>Tile Size</code>ï¼Œç‚¹å‡»<code>Build</code>ç”Ÿæˆï¼Œå†ç‚¹é€‰<code>NavMesh Portals</code>ï¼Œå°±å¯ä»¥çœ‹åˆ°ç°åœ¨navmeshè¦†ç›–çš„èŒƒå›´ä»¥åŠä¸åŒtileä¹‹é—´çš„äº¤ç•Œã€‚</p>
<p><img src="/uploads/gamedev/recastdemo/tile_mesh.png" alt="tile_mesh" title="&#39;tile_mesh&#39;"></p>
<p>åœ¨å°é˜¶ä¹‹é—´åŠ ä¸Šoff-meshï¼Œå¯ä»¥åœ¨å·¦è¾¹<code>Tools</code>é€‰æ‹©<code>Create Off-Mesh Links</code>å»åŠ åŒå‘çš„linkã€‚åŠ å®Œä¹‹åæµ‹è¯•å¯»è·¯ï¼Œå°±èƒ½çœ‹åˆ°ä¸Šæ¥¼çš„è·¯å¾„äº†ã€‚</p>
<p><img src="/uploads/gamedev/recastdemo/off_mesh.png" alt="off_mesh" title="&#39;off_mesh&#39;"></p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§å¸¸è§çš„éœ€è¦è°ƒæ•´çš„å‚æ•°ï¼Œæ˜¯åœ°å—çš„å¯»è·¯æˆæœ¬ï¼Œé€šå¸¸ä¸åœ°å½¢çš„ç±»å‹æœ‰å…³ï¼Œæ¯”å¦‚åœ¨æ°´é‡Œé¢ï¼Œå¯»è·¯çš„æˆæœ¬å°±é«˜ï¼Œåœ¨å¤§è·¯ä¸Šï¼Œå¯»è·¯çš„æˆæœ¬å°±ä½ï¼Œå¹¶ä¸”æœ‰äº›æ—¶å€™ï¼Œç­–åˆ’å°±å¸Œæœ›ç©å®¶è‡ªåŠ¨å¯»è·¯èƒ½å¤Ÿä¼˜å…ˆå»æ‰¾æœ‰å¤§è·¯çš„è·¯å¾„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥é€šè¿‡<code>Convex Volumes</code>åŒ…è£¹/æ ‡è¯†ä¸€äº›è·¯é¢ï¼Œåœ¨å¯»è·¯çš„æ—¶å€™ï¼Œè¿™äº›è·¯é¢ç›¸å¯¹äºä¸€èˆ¬çš„è·¯é¢ï¼Œä¼šæœ‰ä¸åŒçš„æˆæœ¬è®¡ç®—è§„åˆ™ã€‚</p>
<p>åœ¨å·¦ä¾§çš„<code>Create Convex Volumes</code>é€‰é¡¹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€äº›åŒ…å›´ç›’ï¼Œå°†ç‰¹å®šçš„è·¯é¢åŒ…è£¹ä½ï¼Œæ ‡è¯†è¿™äº›è·¯é¢çš„â€œåœ°å½¢â€ã€‚æ¯”å¦‚ä¸‹å›¾çš„ä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ä¸­é—´çš„å°è·¯æ ‡è¯†äº†â€œWaterâ€æ°´ä½“ï¼Œæœ€ç»ˆå¯»è·¯çš„ç»“æœï¼Œä¼šä»é™†åœ°ç»•é“è¿‡å»ã€‚</p>
<p><img src="/uploads/gamedev/recastdemo/convex_volume.png" alt="convex_volume" title="&#39;convex_volume&#39;"></p>
<p>åœ¨demoçš„<code>NavMeshTesterTool.cpp</code>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸åŒâ€œåœ°å½¢â€å¯¹åº”çš„å¯»è·¯æˆæœ¬å®šä¹‰ã€‚å®é™…æ¸¸æˆå¼€å‘æ—¶ï¼Œå¯»è·¯æˆæœ¬ä¹Ÿæœ‰è‡ªå®šä¹‰çš„å¿…è¦ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> NavMeshTesterTool::init(Sample* sample)</span><br><span class="line">&#123;</span><br><span class="line">    m_sample = sample;</span><br><span class="line">    m_navMesh = sample-&gt;getNavMesh();</span><br><span class="line">    m_navQuery = sample-&gt;getNavMeshQuery();</span><br><span class="line">    recalc();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (m_navQuery)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Change costs.</span></span><br><span class="line">        m_filter.setAreaCost(SAMPLE_POLYAREA_GROUND, <span class="number">1.0f</span>);</span><br><span class="line">        m_filter.setAreaCost(SAMPLE_POLYAREA_WATER, <span class="number">10.0f</span>);</span><br><span class="line">        m_filter.setAreaCost(SAMPLE_POLYAREA_ROAD, <span class="number">1.0f</span>);</span><br><span class="line">        m_filter.setAreaCost(SAMPLE_POLYAREA_DOOR, <span class="number">1.0f</span>);</span><br><span class="line">        m_filter.setAreaCost(SAMPLE_POLYAREA_GRASS, <span class="number">2.0f</span>);</span><br><span class="line">        m_filter.setAreaCost(SAMPLE_POLYAREA_JUMP, <span class="number">1.5f</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    m_neighbourhoodRadius = sample-&gt;getAgentRadius() * <span class="number">20.0f</span>;</span><br><span class="line">    m_randomRadius = sample-&gt;getAgentRadius() * <span class="number">30.0f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åˆè¯†RecastDemoï¼Œå¯ä»¥çœ‹åˆ°å¯»è·¯ç½‘æ ¼ç”Ÿæˆå’Œå¯»è·¯é€»è¾‘æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯ä¸€ä¸ªéœ€è¦é€æ¸ä¼˜åŒ–çš„è¿‡ç¨‹ã€‚å¯»è·¯ç½‘æ ¼ç”Ÿæˆï¼Œä¸ä»£è¡¨æœ€ç»ˆæ¸¸æˆé‡Œç©å®¶è‡ªåŠ¨å¯»è·¯å¯ä»¥æˆåŠŸï¼Œä¸ä»…å¯èƒ½å—åˆ°å´å²–åœ°å½¢çš„å›°æ‰°ï¼ŒåŠ¨æ€é˜»æŒ¡ã€ä¼˜å…ˆçº§ä½“éªŒç­‰æ–¹é¢ä¹Ÿæ˜¯éœ€è¦ç€é‡æ¢ç´¢å¯»è·¯é—®é¢˜çš„åœ°æ–¹ã€‚</p>
<p>recastå¯»è·¯ç›¸å…³çš„å‚è€ƒèµ„æ–™éå¸¸å¤šï¼Œå¯ä»¥ä¸€ä¸€å…³æ³¨ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC83NDUzNzIzNg==" title="https://zhuanlan.zhihu.com/p/74537236">RecaståŸºç¡€<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC83ODg3MzM3OQ==" title="https://zhuanlan.zhihu.com/p/78873379">Detourå¯»è·¯<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3lubm1ubS9hcnRpY2xlL2RldGFpbHMvNDQ4MzMwMDc=" title="https://blog.csdn.net/ynnmnm/article/details/44833007">Navå¯¼èˆªç½‘æ ¼å¯»è·¯<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL2RpZ2VzdGluZ2R1Y2suYmxvZ3Nwb3QuY29tLw==" title="http://digestingduck.blogspot.com/">recastnavigationå¼€å‘è€…åšå®¢<i class="fa fa-external-link"></i></span></li>
<li>etc</li>
</ul>
]]></content>
      <categories>
        <category>æ¸¸æˆå¼€å‘</category>
      </categories>
      <tags>
        <tag>å¯»è·¯</tag>
        <tag>recast</tag>
        <tag>RecastDemo</tag>
        <tag>navmesh</tag>
        <tag>recastnavigation</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘pythonçš„excelåº“â€”â€”openpyxlçš„ç”¨æ³•</title>
    <url>/2021/07/11/testlife/openpyxl/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨æµ‹è¯•å·¥å…·çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°éœ€è¦ç”Ÿæˆexcelæ–‡ä»¶çš„éœ€æ±‚ã€‚ç¬”è€…åœ¨è‡ªç ”excel-diffå·¥å…·çš„è¿‡ç¨‹ä¸­ï¼Œä¹ŸåŒæ ·æ¥åˆ°äº†éœ€è¦ç”Ÿæˆexcelæ–‡ä»¶æ¥å±•ç¤ºæ¯ä¸ªsheetçš„diffæ•°æ®ã€‚æ¯ä¸ªåŒ…å«diffçš„sheetéœ€è¦ç”Ÿæˆ1ä¸ªexcelæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶åˆ†æˆ3ä¸ªsheetï¼Œ2ä¸ªsheetç”¨äºå±•ç¤ºsheetåŸå…ˆçš„æ•°æ®ä¸ä¿®æ”¹åçš„æ•°æ®ï¼Œ1ä¸ªsheetç”¨äºæè¿°æ€§ç»Ÿè®¡å’Œè¶…é“¾æ¥æ¯ä¸ªdiffçš„æƒ…å†µã€‚è¦ç”Ÿæˆè¿™æ ·çš„excelæ–‡ä»¶ï¼Œä¸ç”¨ä¸“é—¨çš„excelåº“æ˜¯ä¸è¡Œçš„ã€‚åŸºäºpythonçš„æŠ€æœ¯æ ˆï¼Œç»è¿‡ä¸€ç•ªè°ƒç ”ï¼Œç¬”è€…é‡‡ç”¨openpyxlä½œä¸ºç”Ÿæˆexcelçš„åº“ï¼Œå¹¶ä¸”é¡ºåˆ©å®Œæˆäº†éœ€æ±‚ã€‚</p>
<p>å­¦ä¹ openpyxlå¯ä»¥ç›´æ¥ä»<span class="exturl" data-url="aHR0cHM6Ly9vcGVucHl4bC5yZWFkdGhlZG9jcy5pby9lbi9zdGFibGUv" title="https://openpyxl.readthedocs.io/en/stable/">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>å…¥æ‰‹ã€‚ä¸€äº›åŸºæœ¬æ“ä½œå¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<h2 id="åŸºç¡€workbookä¸sheetæ“ä½œ"><a href="#åŸºç¡€workbookä¸sheetæ“ä½œ" class="headerlink" title="åŸºç¡€workbookä¸sheetæ“ä½œ"></a>åŸºç¡€workbookä¸sheetæ“ä½œ</h2><p>å¯åŠ¨ä¸€ä¸ªexcelå®ä¾‹ï¼Œç›´æ¥æ„é€ <code>Workbook</code>å®ä¾‹å³å¯ï¼š<code>wb = Workbook</code></p>
<p><code>Workbook</code>å®ä¾‹é»˜è®¤ä¼šå¸¦ä¸€ä¸ªsheetï¼Œåç§°å³ä¸ºSheetï¼Œå¯ä»¥ç›´æ¥é€šè¿‡<code>ws = wb.worksheets[0]</code>è·å–åˆ°è¿™ä¸ªé»˜è®¤çš„sheetã€‚å¦‚æœè¦æ”¹æ ‡é¢˜ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>ws.title = &#39;xxx&#39;</code>æ¥æ‰§è¡Œã€‚</p>
<p>ä¸ºsheetæ·»åŠ æ•°æ®æœ‰å¤šç§æ–¹æ³•ï¼š</p>
<ul>
<li><code>ws.append(list_data)</code>ï¼Œæ·»åŠ ä¸€è¡Œæ•°æ®</li>
<li><code>ws.cell(row, col, value)</code>ï¼Œä¸ºæŸè¡ŒæŸåˆ—ï¼ˆéƒ½ä»1å¼€å§‹ç®—ï¼‰çš„å•å…ƒæ ¼èµ‹ä¸€ä¸ªå€¼</li>
</ul>
<p>åˆ›å»ºsheetï¼Œé€šè¿‡<code>wb.create_sheet(title=&#39;xxx&#39;)</code>æ¥å£å³å¯å®ç°ï¼›é€šè¿‡<code>ws = wb.active</code>ï¼Œå¯ä»¥è®¾ç½®æŸä¸ªsheetä¸ºé»˜è®¤æ‰“å¼€å±•ç¤ºçš„ã€‚</p>
<p>è·å–æŸè¡Œã€æŸåˆ—ä»¥åŠå•å…ƒæ ¼æ•°æ®ï¼Œå¯ä»¥é€šè¿‡<code>ws.iter_rows(row_idx, row_idx)</code>ã€<code>ws.iter_cols(col_idx, col_idx)</code>ã€<code>ws.cell(row_idx, col_idx)</code>è·å–ï¼Œå…¶ä¸­è¡Œã€åˆ—ç´¢å¼•å‡ä»1å¼€å§‹ç®—ã€‚ä½†å¦‚æœåªæ˜¯è¦è·å–è¡Œã€åˆ—å®ä¾‹ï¼Œæ¯”å¦‚è¦è°ƒè¡Œåˆ—æ ·å¼çš„è¯ï¼Œéœ€è¦é€šè¿‡<code>ws.row_dimensions[row_idx]</code>ã€<code>ws.col_dimensions[get_column_letter(col_idx)]</code>è·å–ï¼Œå…¶ä¸­<code>get_column_letter</code>æ˜¯<code>openpyxl.util</code>ä¸­ï¼Œé€šè¿‡åˆ—ç´¢å¼•è·å¾—å¯¹åº”å­—æ¯ï¼ˆA~Zï¼ŒAA~AZä¹‹ç±»ï¼‰çš„æ–¹æ³•</p>
<p>é€šè¿‡<code>load_workbook</code>ã€<code>save_workbook</code>æ¥å£ï¼Œå¯ä»¥è¯»å–æˆ–å­˜å‚¨ä¸ºexcelæ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªæ“ä½œåœ¨å¤§æ•°æ®é‡è¡¨çš„æƒ…å†µä¸‹ä¼šæœ‰æ—¶é—´å¼€é”€ã€‚</p>
<h2 id="æ ·å¼è®¾ç½®"><a href="#æ ·å¼è®¾ç½®" class="headerlink" title="æ ·å¼è®¾ç½®"></a>æ ·å¼è®¾ç½®</h2><p>è°ƒæ•´excelè¡¨æ ¼æ ·å¼ï¼Œå»ºè®®ç”¨<code>NamedStyle</code>å®šä¹‰å„ä¸ªä¸åŒçš„æ ·å¼ã€‚ä¸€ä¸ª<code>NamedStyle</code>å¯ä»¥åº”ç”¨å•ä¸ªå•å…ƒæ ¼å¯æ”¯æŒçš„æ‰€æœ‰æ ·å¼ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>fontï¼šå­—ä½“</li>
<li>fillï¼šèƒŒæ™¯é¢œè‰²</li>
<li>borderï¼šè¾¹æ¡†</li>
<li>alignmentï¼šæ’ç‰ˆï¼ˆæ°´å¹³å‚ç›´å±…ä¸­ä¹‹ç±»ï¼‰</li>
<li>etc</li>
</ul>
<p>å•å…ƒæ ¼æ ·å¼éœ€è¦éå†æ¯ä¸ªå•å…ƒæ ¼è®¾ç½®ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ns = NamedStyle(name=<span class="string">'test_style'</span>)</span><br><span class="line">ns.font = Font(bold=<span class="literal">True</span>)  <span class="comment"># ç²—ä½“</span></span><br><span class="line">ns.alignment = Alignment(wrapText=<span class="literal">True</span>)  <span class="comment"># è‡ªåŠ¨æ¢è¡Œ</span></span><br><span class="line">wb.add_named_style(ns)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row_idx <span class="keyword">in</span> range(<span class="number">2</span>, <span class="number">6</span>):</span><br><span class="line">    <span class="keyword">for</span> col_idx <span class="keyword">in</span> range(<span class="number">3</span>, <span class="number">7</span>):</span><br><span class="line">        ws.cell(row_idx, col_idx).style = <span class="string">'test_style'</span></span><br></pre></td></tr></table></figure>
<p>è¡Œã€åˆ—æ ·å¼ï¼Œé€šè¿‡ä¸Šè¿°ä»<code>row_dimensions</code>ã€<code>col_dimensions</code>è·å–çš„å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥èµ‹äºˆ<code>width</code>ã€<code>height</code>ä¹‹ç±»çš„è¡Œåˆ—æ ·å¼å±æ€§</p>
<p>å¦‚æœè¦å†»ç»“è¡Œåˆ—ï¼Œéœ€è¦é€šè¿‡è®¾ç½®<code>ws.freeze_panes</code>ä¸ºç‰¹å®šå€¼ï¼Œè¿™ä¸ªå€¼æ˜¯è¿™æ ·è§„å®šçš„ã€‚æ¯”å¦‚<code>ws.freeze_panes = &#39;D5&#39;</code>ï¼Œåˆ™è¡¨ç¤ºå†»ç»“Dåˆ—ä¹‹å‰çš„A~Cåˆ—ï¼ŒåŒæ—¶å†»ç»“5è¡Œä¹‹å‰çš„1~4è¡Œã€‚ä»¥æ­¤ç±»æ¨ï¼Œå¦‚æœ<code>ws.freeze_panes = &#39;A1&#39;</code>ï¼Œé‚£å°±æ˜¯æ²¡æœ‰å†»ç»“çš„è¡Œåˆ—äº†ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>openpyxlå†…éƒ¨æ¶µç›–çš„åŠŸèƒ½éå¸¸ä¸°å¯Œï¼Œç¬”è€…æ‰€è®²è¿°çš„åªæ˜¯å†°å±±ä¸€è§’ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å°½æƒ…æ¢ç´¢openpyxlçš„å®˜æ–¹æ–‡æ¡£ä»¥åŠæºä»£ç ï¼Œæœ‰é—®é¢˜ä¹Ÿå¯ç›´æ¥googleæŸ¥é˜…~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>openpyxl</tag>
        <tag>excel</tag>
        <tag>æµ‹è¯•å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘pythonè¿›ç¨‹æ± ProcessPoolExecutorçš„ç”¨æ³•ä¸å®ç°åˆ†æ</title>
    <url>/2021/06/08/pythonnotes/python_processpoolexecutor/</url>
    <content><![CDATA[<p>åœ¨pythonå¼€å‘æœŸé—´ï¼Œç”±äºGILçš„åŸå› ï¼Œä¸èƒ½ç›´æ¥é‡‡ç”¨å¹¶è¡Œçš„æ–¹å¼å¤„ç†ä»£ç é€»è¾‘ã€‚åœ¨multiprocessingåº“çš„æ”¯æŒä¸‹ï¼Œpythonç¨‹åºèƒ½å¤Ÿå¯åŠ¨å­è¿›ç¨‹æ‰§è¡Œç‰¹å®šçš„ä»»åŠ¡ï¼Œä½†å­è¿›ç¨‹çš„ç®¡ç†ä¹Ÿæˆä¸ºäº†é—®é¢˜ã€‚ä¸ºäº†ç®€åŒ–ç”¨æˆ·å¼€å‘æˆæœ¬ï¼Œpythonåœ¨concurrent.futuresä¸‹å†…ç½®äº†ProcessPoolExecutorè¿™ä¸€æ•°æ®ç»“æ„ï¼Œå®ç°äº†ç®€å•çš„è¿›ç¨‹ç®¡ç†åŠä»»åŠ¡è°ƒåº¦ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„éœ€æ±‚ï¼Œå¼€å‘è€…åªéœ€è¦ç”¨ProcessPoolExecutorå³å¯å®ç°å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ã€‚å› æ­¤ï¼Œæœ¬æ–‡ç®€å•å¯¹ProcessPoolExecutorçš„å®ç°è¿›è¡Œåˆ†æï¼Œå¸®åŠ©å¤§å®¶æ›´åŠ äº†è§£pythonå¼€å‘ä¸­è¿›ç¨‹/ä»»åŠ¡è°ƒåº¦çš„ä¸€ç§æ–¹å¼ã€‚</p>
<p>é¦–å…ˆæ¥çœ‹ProcessPoolExecutorçš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L2NvbmN1cnJlbnQuZnV0dXJlcy5odG1s" title="https://docs.python.org/3/library/concurrent.futures.html">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span></p>
<ul>
<li>constructorï¼šæ„é€ å™¨<ul>
<li>max_workersï¼šæœ€å¤§workeræ•°é‡</li>
<li>contextï¼šè¿›ç¨‹å¯åŠ¨æ–¹å¼ï¼Œæ¯”å¦‚spawnã€forkç­‰ã€‚å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNDM4MTg1MTkvd2hhdC1pcy10aGUtbWVhbmluZy1vZi1jb250ZXh0LWFyZ3VtZW50LWluLW11bHRpcHJvY2Vzc2luZy1wb29sLXBvb2wvNDM4MTg4Mjk=" title="https://stackoverflow.com/questions/43818519/what-is-the-meaning-of-context-argument-in-multiprocessing-pool-pool/43818829">è¿™ç¯‡æ–‡ç« <i class="fa fa-external-link"></i></span></li>
<li>initializerï¼šåˆå§‹åŒ–ç¯å¢ƒç”¨çš„å›è°ƒ/é’©å­ï¼Œä¼šåœ¨ä¼ è¿›å»çš„ä»»åŠ¡æ‰§è¡Œä¹‹å‰è°ƒç”¨ï¼ˆæ¯”å¦‚è¦importä»€ä¹ˆåº“ï¼Œè¯»å–ä»€ä¹ˆé…ç½®ä¹‹ç±»ï¼‰</li>
<li>initargsï¼šåˆå§‹åŒ–å›è°ƒçš„å‚æ•°</li>
</ul>
</li>
<li>submitï¼šæäº¤ç‰¹å®šä»»åŠ¡ï¼Œè¿”å›ä¸€ä¸ªfutureå®ä¾‹ï¼ˆç±»ä¼¼äºjsçš„promiseï¼‰</li>
<li>mapï¼šæ‰¹é‡submit</li>
<li>shutdownï¼šå…³é—­è¿›ç¨‹æ± å¹¶é”€æ¯èµ„æº</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ç”¨æ³•éå¸¸ç®€å•ï¼Œç”¨æˆ·ä¸€ä¾§åªéœ€è¦è¿™æ ·æ“ä½œå³å¯å¾—åˆ°ä»»åŠ¡æ‰§è¡Œç»“æœï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> concurrent.futures <span class="keyword">import</span> ProcessPoolExecutor</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(sleep_sec=<span class="number">10</span>, tag=<span class="string">'test'</span>)</span>:</span></span><br><span class="line">    print(<span class="string">'[%s] start sleep'</span> % tag)</span><br><span class="line">    time.sleep(sleep_sec)</span><br><span class="line">    print(<span class="string">'[%s] finish sleep'</span> % tag)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    process_pool = ProcessPoolExecutor(max_workers=<span class="number">3</span>)</span><br><span class="line">    future = process_pool.submit(task, <span class="number">3</span>, tag=<span class="string">'TEST'</span>)</span><br><span class="line">    ret = future.result()</span><br><span class="line">    print(<span class="string">'result is %s'</span> % str(ret))</span><br><span class="line">    process_pool.shutdown()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±å¯ä»¥æ‰“å°å‡ºä»¥ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[TEST] start sleep</span><br><span class="line">[TEST] finish sleep </span><br><span class="line">result is 100</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œfinish sleepåœ¨start sleepæ‰“å°çš„3ç§’åæ‰æ‰“å°å‡ºæ¥</p>
<p>ç®€å•çš„å…¥å£åé¢è‚¯å®šå­˜åœ¨ç²¾å·§çš„é€»è¾‘ã€‚åœ¨ProcessExecutorPoolæºç ä¸­ï¼Œæœ‰å¾ˆæ¸…æ™°çš„æ³¨é‡Šå»é˜è¿°è¿™ä¸€æ•°æ®ç»“æ„çš„å®ç°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥ç›´æ¥ç¿»è¶Šæºç ï¼Œdebugæºç æ¥æ¢ç´¢å…¶ä¸­çš„é€»è¾‘</p>
<p>ProcessPoolExecutorçš„åŸºç¡€ç»“æ„å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/geekdaily/python_processpoolexecutor/ProcessPoolExecutor.png" alt="python_processpoolexecutor"></p>
<p>å…¶ä¸­ï¼ŒQueue Management Threadï¼ˆé˜Ÿåˆ—ç®¡ç†çº¿ç¨‹ï¼‰æ˜¯æ•´ä¸ªProcessPoolExecutorçš„æ ¸å¿ƒï¼Œä¸ä»…æ§åˆ¶ä»»åŠ¡çš„æ”¶å‘ï¼Œè€Œä¸”è°ƒåº¦ä»»åŠ¡åœ¨ä¸åŒè¿›ç¨‹ä¸­çš„æ‰§è¡Œï¼Œå¹¶ä¸”å¤„ç†å› ä¸ºå„ç§åŸå› å¸¦æ¥çš„è¿›ç¨‹æ± çš„å¼‚å¸¸ã€‚</p>
<p>ä»¥ä¸Šé¢ä»£ç ä¸ºä¾‹ï¼ŒProcessPoolExecutorlæ•´ä¸ªæ‰§è¡Œæµç¨‹ï¼Œå¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ul>
<li>ç”¨æˆ·åˆå§‹åŒ–ProcessPoolExecutor<ul>
<li>æ£€æŸ¥workeræ•°é‡åˆæ³•æ€§ï¼Œè®¾ç½®è¿›ç¨‹å¯åŠ¨æ–¹å¼context</li>
<li>åˆå§‹åŒ–WorkIDé˜Ÿåˆ—ã€WorkID-&gt;WorkItemçš„ç¼“å­˜mapã€è°ƒç”¨é˜Ÿåˆ—Call Queueã€ç»“æœé˜Ÿåˆ—Result Queue</li>
<li>åˆå§‹åŒ–ç”¨æ¥æ¿€æ´»é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹çš„pipe<ul>
<li>é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹ä¼šå¯¹ä¸€ç³»åˆ—fd/pipeè¿›è¡Œç®¡ç†ã€‚pipeåŒ…æ‹¬æ¿€æ´»é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹çš„ä»¥åŠç»“æœé˜Ÿåˆ—çš„ï¼›fdåˆ™æ˜¯è¿›ç¨‹æ± æ¯ä¸ªè¿›ç¨‹çš„</li>
<li>é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹ä¼šselectè¿™äº›fd/pipeï¼Œæ ¹æ®å¯¹åº”äº‹ä»¶ä½œå‡ºè¡Œä¸º</li>
</ul>
</li>
</ul>
</li>
<li>ç”¨æˆ·submitä»»åŠ¡ï¼ˆå‡½æ•°+å‚æ•°ï¼‰åˆ°ProcessPoolExecutorå®ä¾‹<ul>
<li>è‡ªå¢WorkIDï¼Œå°†ä»»åŠ¡æ‰€éœ€çš„å‡½æ•°&amp;å‚æ•°æ”¾åˆ°WorkItemï¼Œç„¶åæŠŠè¿™äº›ä¿¡æ¯ç¼“å­˜åˆ°åˆ°WorkID-&gt;WorkItemçš„mapé‡Œ</li>
<li>è‹¥æ˜¯æœªå¯åŠ¨è¿›ç¨‹æ± ï¼Œå…ˆå¯åŠ¨è¿›ç¨‹æ± ã€‚ç„¶åå¯åŠ¨é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹</li>
<li>å”¤é†’é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹å·¥ä½œ<ul>
<li>å”¤é†’çš„æ–¹å¼ï¼šç»™ä¸»çº¿ç¨‹è¿åˆ°æ¿€æ´»é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹çš„pipeå‘äºŒè¿›åˆ¶ç©ºå­—ç¬¦ä¸²ï¼Œä¼šè¢«selectåˆ°</li>
</ul>
</li>
<li>åˆ‡åˆ°é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹ï¼Œçº¿ç¨‹å†…ä¸»å¾ªç¯å…ˆæ‹¿åˆ°WorkID&amp;WorkItemï¼ŒåŒæ—¶ä¾¦æµ‹åˆ°è¢«å”¤é†’çš„signalï¼Œäºæ˜¯å¼€å§‹æ‰§è¡Œæ­£å¸¸ä»»åŠ¡<ul>
<li>æŠŠWorkIDè·ŸWorkItemç»“åˆä¸ºCallItemæ”¾åˆ°Call Queueé‡Œ</li>
<li>è¿›ç¨‹æ± æ¯ä¸ªè¿›ç¨‹ä¼šä»Call Queueæå–ä»»åŠ¡æ‰§è¡Œï¼Œå°†ç»“æœResultItemæ”¾åˆ°Result Queueã€‚å¦‚æœè¿›ç¨‹å¼‚å¸¸ï¼Œä¼šç›´æ¥æŠŠpidæ”¾åˆ°Result Queue</li>
<li>é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹æœ‰ä¸ªis_brokenå˜é‡æ§åˆ¶æ˜¯å¦æ•´ä¸ªè¿›ç¨‹æ± /é˜Ÿåˆ—åäº†ï¼Œå¦‚æœåäº†å°±ä¸èƒ½æ­£å¸¸æ‰§è¡Œä»»åŠ¡ï¼Œæ•´ä¸ªexecutoréƒ½å¾—è¢«é”€æ¯</li>
</ul>
</li>
<li>é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹selectåˆ°Result Queueå¹¶è¯»å–å…¶ä¸­å†…å®¹ã€‚æå–å‡ºè¿è¡Œç»“æœåï¼Œå’Œç¼“å­˜çš„WorkID&amp;WorkItemå¯¹ä¸Šã€‚è¿™æ ·ç”¨æˆ·ä¾§ç”¨future.result()å°±å¯ä»¥å¾—åˆ°ç»“æœ</li>
</ul>
</li>
<li>ç”¨æˆ·é”€æ¯ProcessPoolExecutor<ul>
<li>å°†å…³é—­é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹çš„flagç½®ä¸ºtrue</li>
<li>é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹åœ¨ä¸»å¾ªç¯ä¸­å‘ç°flagç½®ä¸ºtrueï¼Œé»˜è®¤ä¼šç­‰å¾…æ‰€æœ‰WorkItemæ‰§è¡Œå®Œåæ‰§è¡Œé”€æ¯æ“ä½œ</li>
<li>å‘é€Noneç»™åˆ°è¿›ç¨‹æ± æ‰€æœ‰è¿›ç¨‹ï¼Œè¿™äº›è¿›ç¨‹æ”¶åˆ°Noneä¼šè¿”å›pidï¼Œé˜Ÿåˆ—ç®¡ç†çº¿ç¨‹å‘ç°pidä¼šè‡ªåŠ¨é™¤æ‰ç›¸åº”è¿›ç¨‹ç´¢å¼•è®°å½•ï¼Œå¹¶ç­‰å¾…è¿›ç¨‹join</li>
<li>å…³é—­Call Queueï¼Œèµ‹å€¼Result Queueä¸ºNone</li>
<li>è¿›ç¨‹ä¸Call Queueå…¨éƒ¨å…³é—­åï¼Œé˜Ÿåˆ—ç®¡ç†çº¿ç¨‹è·³å‡ºä¸»å¾ªç¯ï¼Œä¸»çº¿ç¨‹ç­‰å¾…é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹join</li>
<li>å…³é—­æ¿€æ´»é˜Ÿåˆ—ç®¡ç†çº¿ç¨‹çš„pipe</li>
</ul>
</li>
</ul>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>å¹¶å‘</tag>
        <tag>multiprocessing</tag>
        <tag>è¿›ç¨‹æ± </tag>
        <tag>ProcessPoolExecutor</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘Goè¯­è¨€stringã€intã€floatã€runeã€byteç­‰æ•°æ®ç±»å‹çš„è½¬æ¢æ–¹æ³•</title>
    <url>/2021/06/06/geekdaily/go_basic_data_types/</url>
    <content><![CDATA[<p>golangçš„æ•°æ®ç±»å‹è½¬æ¢æ˜¯å›°æƒ‘æ–°gopherçš„ä¸€å¤§é—®é¢˜ä¹‹ä¸€ã€‚ç›¸å¯¹äºpythonï¼Œgolangçš„æ•°æ®ç±»å‹è½¬æ¢å¯è¦éº»çƒ¦çš„å¤šï¼Œè€Œä¸”è¿˜ä¸èµ°å¯»å¸¸è·¯åœ°è¯ç”Ÿäº†äº›æ–°çš„æ–¹æ³•è·Ÿåè¯ã€‚å› æ­¤æœ¬æ–‡è®²è§£golangå¸¸è§æ•°æ®ç±»å‹stringã€intã€runeç­‰æ•°æ®ç±»å‹ç›¸äº’ä¹‹é—´çš„è½¬æ¢æ–¹æ³•ï¼Œç»™å¤§ä¼™å„¿é¿å‘ã€‚</p>
<p>åœ¨è®²è¿°æ–¹æ³•ä¹‹å‰ï¼Œé¦–å…ˆéå¸¸æœ‰å¿…è¦è®²ä¸‹goæºç å¯¹è¿™äº›æ•°æ®ç±»å‹çš„è¡¨è¿°ï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// string is the set of all strings of 8-bit bytes, conventionally but not</span></span><br><span class="line"><span class="comment">// necessarily representing UTF-8-encoded text. A string may be empty, but</span></span><br><span class="line"><span class="comment">// not nil. Values of string type are immutable.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">string</span> <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int is a signed integer type that is at least 32 bits in size. It is a</span></span><br><span class="line"><span class="comment">// distinct type, however, and not an alias for, say, int32.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">int</span> <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// int32 is the set of all signed 32-bit integers.</span></span><br><span class="line"><span class="comment">// Range: -2147483648 through 2147483647.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">int32</span> <span class="keyword">int32</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// uint64 is the set of all unsigned 64-bit integers.</span></span><br><span class="line"><span class="comment">// Range: 0 through 18446744073709551615.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">uint64</span> <span class="keyword">uint64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// float32 is the set of all IEEE-754 32-bit floating-point numbers.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">float32</span> <span class="keyword">float32</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// float64 is the set of all IEEE-754 64-bit floating-point numbers.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">float64</span> <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// byte is an alias for uint8 and is equivalent to uint8 in all ways. It is</span></span><br><span class="line"><span class="comment">// used, by convention, to distinguish byte values from 8-bit unsigned</span></span><br><span class="line"><span class="comment">// integer values.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">byte</span> = <span class="keyword">uint8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rune is an alias for int32 and is equivalent to int32 in all ways. It is</span></span><br><span class="line"><span class="comment">// used, by convention, to distinguish character values from integer values.</span></span><br><span class="line"><span class="keyword">type</span> <span class="keyword">rune</span> = <span class="keyword">int32</span></span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„æè¿°æˆ‘ä»¬å¯ä»¥è·å¾—ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
<ul>
<li><code>int</code>æœ‰ç¬¦å·ï¼Œè‡³å°‘32ä½ï¼Œä½†å¹¶ä¸æ˜¯<code>int32</code>çš„åˆ«ç§°ã€‚å¦‚æœæŠŠå¤§äº2147483647çš„æ•°èµ‹å€¼<code>int</code>ï¼Œ<code>int</code>æ‰“å‡ºæ¥ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œæ²¡æœ‰æŸå¤±ç²¾åº¦</li>
<li><code>rune</code>å°±æ˜¯<code>int32</code>ï¼Œå®é™…ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºå­—ç¬¦<code>char</code>çš„å€¼ã€‚å’Œä¸€èˆ¬çš„<code>char</code>ä¸ä¸€æ ·çš„æ˜¯runeçš„ç²¾åº¦æ¯”è¾ƒé«˜= =ï¼Œå¹¶ä¸”golangä¹Ÿæ²¡æœ‰<code>char</code>è¿™ä¸ªå†…ç½®å…³é”®å­—</li>
<li><code>byte</code>å°±æ˜¯<code>uint8</code>ï¼Œå®é™…ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®ä¸­æ¯”ç‰¹çš„å€¼</li>
</ul>
<p>å› æ­¤å¯¹äº<code>rune</code>ã€<code>byte</code>è¿™è¾¹ï¼Œå°±å¯ä»¥å½“ä½œuint8è·Ÿint32ç›¸å…³çš„è½¬æ¢äº†ï¼Œè¿™å—çš„ç†è§£å°±å®¹æ˜“å¾—å¤š</p>
<p>é¦–å…ˆçœ‹å­—ç¬¦ä¸²<code>string</code>åˆ°<code>int</code>ã€<code>float</code>ç­‰æ•°å€¼çš„è½¬æ¢ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testStringToDigit</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"=============== test string to digit =================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> s <span class="keyword">string</span> = <span class="string">"1234567"</span></span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">var</span> i32 <span class="keyword">int32</span></span><br><span class="line">    <span class="keyword">var</span> ui64 <span class="keyword">uint64</span></span><br><span class="line"></span><br><span class="line">    i, _ = strconv.Atoi(s)</span><br><span class="line">    i64, _ := strconv.ParseInt(s, <span class="number">10</span>, <span class="number">32</span>)</span><br><span class="line">    i32 = <span class="keyword">int32</span>(i64)</span><br><span class="line">    ui64, _ = strconv.ParseUint(s, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"string: %s, int: %d, int32:%d, uint64: %d\n"</span>,</span><br><span class="line">        s, i, i32, ui64)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> sf <span class="keyword">string</span> = <span class="string">"1234512345.12345678901234"</span></span><br><span class="line">    <span class="keyword">var</span> f32 <span class="keyword">float32</span></span><br><span class="line">    <span class="keyword">var</span> f64 <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line">    f64, _ = strconv.ParseFloat(sf, <span class="number">64</span>)</span><br><span class="line">    f32In64, _ := strconv.ParseFloat(sf, <span class="number">32</span>)</span><br><span class="line">    f32 = <span class="keyword">float32</span>(f32In64)</span><br><span class="line">    fmt.Printf(<span class="string">"string: %s, float32: %f, float64: %f\n"</span>,</span><br><span class="line">        sf, f32, f64)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"===================================================="</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>string</code>åˆ°<code>int</code>ç”¨<code>strconv.Atoi</code>æ–¹æ³•ï¼Œè€Œå¯¹äºå…¶å®ƒæœ‰bitSizeé™åˆ¶çš„æ•°æ®ï¼Œåˆ™ç”¨<code>strconv.ParseInt</code>æˆ–è€…<code>strconv.ParseFloat</code>å…ˆè½¬æ¢æˆ64ä½å†è°ƒç²¾åº¦å³å¯ã€‚</p>
<p>ç„¶åçœ‹æ•°å€¼åˆ°<code>string</code>çš„è½¬æ¢ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testDigitToString</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"=============== test digit to string =================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">int</span> = <span class="number">12345</span></span><br><span class="line">    <span class="keyword">var</span> i32 <span class="keyword">int32</span> = <span class="number">-678</span></span><br><span class="line">    <span class="keyword">var</span> ui64 <span class="keyword">uint64</span> = <span class="number">901234567890</span></span><br><span class="line">    <span class="keyword">var</span> strInt <span class="keyword">string</span> = fmt.Sprintf(<span class="string">"%d"</span>, i)</span><br><span class="line">    <span class="keyword">var</span> strInt32 <span class="keyword">string</span> = strconv.FormatInt(<span class="keyword">int64</span>(i32), <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">var</span> strUInt64 <span class="keyword">string</span> = strconv.FormatUint(ui64, <span class="number">10</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"strInt: %s, strInt32: %s, strUInt64: %s\n"</span>,</span><br><span class="line">        strInt, strInt32, strUInt64)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> f32 <span class="keyword">float32</span> = <span class="number">3.1415926</span></span><br><span class="line">    <span class="keyword">var</span> f64 <span class="keyword">float64</span> = <span class="number">-3.1415926535897</span></span><br><span class="line">    <span class="keyword">var</span> strFloat32 <span class="keyword">string</span> = fmt.Sprintf(<span class="string">"%.5f"</span>, f32)</span><br><span class="line">    <span class="keyword">var</span> strFloat64 <span class="keyword">string</span> = strconv.FormatFloat(f64, <span class="string">'f'</span>, <span class="number">10</span>, <span class="number">64</span>)</span><br><span class="line">    fmt.Printf(<span class="string">"strFloat32: %s, strFloat64: %s\n"</span>, strFloat32, strFloat64)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"===================================================="</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ•°å€¼åˆ°<code>string</code>ï¼Œæœ€ç®€å•ç²—æš´çš„æ–¹æ³•æ˜¯<code>fmt.Sprintf</code>æ ¼å¼åŒ–å­—ç¬¦ä¸²ã€‚å¦‚æœéœ€è¦ç²¾è°ƒï¼Œåˆ™å¾—ç”¨<code>strconv.ParseInt</code>ã€<code>strconv.ParseFloat</code>ç­‰æ–¹å¼ã€‚å€¼å¾—ä¸€æçš„æ˜¯<code>strconv.ParseFloat</code>æ³¨é‡Šäº†å¤šç§æ ¼å¼å¯ä¾›é€‰æ‹©ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥çœ‹æºç ã€‚</p>
<p><code>string</code>å’Œ<code>rune</code>ã€<code>byte</code>ä¹‹ç±»æ•°æ®çš„è½¬æ¢ï¼Œå¯ä»¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testStringAndRuneAndByte</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"=============== test string &amp; rune &amp; byte =================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> s <span class="keyword">string</span> = <span class="string">"helloworld"</span></span><br><span class="line">    <span class="keyword">var</span> runes []<span class="keyword">rune</span> = []<span class="keyword">rune</span>(s)</span><br><span class="line">    <span class="keyword">var</span> bytes []<span class="keyword">byte</span> = []<span class="keyword">byte</span>(s)</span><br><span class="line">    fmt.Printf(<span class="string">"string: %s, runes: %v, bytes: %v\n"</span>, s, runes, bytes)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, char := <span class="keyword">range</span> s &#123;</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="number">0</span> &#123;</span><br><span class="line">            fmt.Printf(<span class="string">"type of index: %T\n"</span>, i) <span class="comment">// int</span></span><br><span class="line">            fmt.Printf(<span class="string">"type of char: %T\n"</span>, char)  <span class="comment">// int32</span></span><br><span class="line">            fmt.Printf(<span class="string">"digit value of char: %d\n"</span>, char) <span class="comment">// 104</span></span><br><span class="line">            fmt.Printf(<span class="string">"output char: %c\n"</span>, char) <span class="comment">// h</span></span><br><span class="line">            fmt.Printf(<span class="string">"is equal with rune value: %v\n"</span>, <span class="string">'h'</span> == <span class="keyword">rune</span>(char)) <span class="comment">// true</span></span><br><span class="line">            fmt.Printf(<span class="string">"is equal with byte value: %v\n"</span>, <span class="string">'h'</span> == <span class="keyword">byte</span>(char)) <span class="comment">// true</span></span><br><span class="line">            <span class="comment">// invalid expression -&gt; rune: int32, byte: uint8</span></span><br><span class="line">            <span class="comment">// fmt.Printf("is rune &amp; byte equals: %v\n", rune(char) == byte(char))</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"===================================================="</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”¨<code>[]rune</code>ã€<code>[]byte</code>å¯ç›´æ¥å°†<code>string</code>å˜ä¸º<code>charArray</code>ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œéå†<code>string</code>æ—¶æ¯ä¸ª<code>char</code>å­—ç¬¦çš„ç±»å‹ä¸º<code>int32</code>ï¼Œå¯ç”¨<code>rune</code>è¡¨ç¤ºï¼›å­—ç¬¦è¡¨è¾¾å¼<code>&#39;h&#39;</code>å¯ä»¥ç›´æ¥å’Œ<code>rune</code>ã€<code>byte</code>ç±»å‹æ•°å­—ç”¨<code>==</code>æ¯”è¾ƒã€‚</p>
<p>ç„¶åï¼Œç”±äº<code>rune</code>ã€<code>byte</code>æœ¬èº«å°±æ˜¯<code>int</code>ç³»ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå’Œ<code>int</code>ç³»ç±»å‹é—´çš„è½¬æ¢ä¼šéå¸¸ç®€å•</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testIntAndRuneAndByte</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"=============== test int &amp; rune &amp; byte =================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">var</span> r <span class="keyword">rune</span></span><br><span class="line">    <span class="keyword">var</span> b <span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">var</span> ui8 <span class="keyword">uint8</span></span><br><span class="line"></span><br><span class="line">    i, r = <span class="number">123456</span>, <span class="number">123456</span></span><br><span class="line">    fmt.Printf(<span class="string">"int is equal with rune int: %v\n"</span>, <span class="keyword">int32</span>(i) == r) <span class="comment">// true</span></span><br><span class="line">    b, ui8 = <span class="string">'a'</span>, <span class="string">'a'</span></span><br><span class="line">    fmt.Printf(<span class="string">"byte char is equal with uint8 char: %v\n"</span>, b == ui8) <span class="comment">// true</span></span><br><span class="line">    i = <span class="keyword">int</span>(<span class="string">'a'</span>)</span><br><span class="line">    r, b, ui8 = <span class="keyword">rune</span>(i), <span class="keyword">byte</span>(i), <span class="keyword">uint8</span>(i)</span><br><span class="line">    fmt.Printf(<span class="string">"int: %c, rune: %c, byte: %c, uint8: %c\n"</span>, i, r, b, ui8) <span class="comment">// 4 * 'a'</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"===================================================="</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€ä¸ªtipsæ˜¯é€šç”¨æ•°æ®ç±»å‹<code>interface{}</code>è½¬ç‰¹å®šæ•°æ®æ ¼å¼çš„æ–¹æ³•ï¼Œå¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testInterfaceToInt</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">"=============== test interface to digit =================="</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> itf <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">    itf = <span class="number">1234567890123456789</span></span><br><span class="line">    i := itf.(<span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// cannot convert to int32/int64/float32/float64</span></span><br><span class="line"></span><br><span class="line">    fmt.Printf(<span class="string">"interface: %v, int: %d\n"</span>, itf, i)</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">"===================================================="</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„<code>interface{}</code>èµ‹å€¼äº†ä¸ª<code>int</code>ï¼Œå¦‚æœç›´æ¥å¸¦åç¼€<code>.(int32)</code>è¿™æ ·æŒ‡å®šå…¶å®ƒæ•°æ®ç±»å‹ï¼Œä¼šç›´æ¥æŠ¥é”™</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ç¼–ç¨‹</tag>
        <tag>Golang</tag>
        <tag>strconv</tag>
        <tag>æ•°æ®ç±»å‹è½¬æ¢</tag>
        <tag>rune</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ¸¸æˆç­–åˆ’è¡¨æ ¼æµ‹è¯•å·¥å…·çš„æŠ€æœ¯å®ç°</title>
    <url>/2021/06/01/testlife/table_test_tool/</url>
    <content><![CDATA[<p>åœ¨å…ˆå‰çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDMvMDYvdGVzdGxpZmUvdGFibGVfY2hlY2sv" title="https://utmhikari.top/2021/03/06/testlife/table_check/">ã€Šæ¸¸æˆç­–åˆ’è¡¨æ ¼æ£€æŸ¥å·¥å…·çš„ä¸€ç§è®¾è®¡ã€‹<i class="fa fa-external-link"></i></span>ä¸€æ–‡ä¸­ï¼Œç¬”è€…åˆ†äº«äº†åœ¨ä¸€èˆ¬æ¸¸æˆæµ‹è¯•ä¸šåŠ¡èƒŒæ™¯ä¸‹è®¾è®¡ç­–åˆ’è¡¨æ ¼æ£€æŸ¥å·¥å…·çš„ä¸€ç§æ–¹å¼ã€‚æœ¬æ–‡åŸºäºå…ˆå‰æ–‡ç« çš„å†…å®¹ï¼Œå°†åŸå…ˆçš„è¡¨æ ¼æ£€æŸ¥å·¥å…·å‡çº§ä¸ºè¡¨æ ¼æµ‹è¯•å·¥å…·ï¼Œæ¶µç›–æ›´å¤šçš„å†…å®¹ï¼Œå¹¶å¯¹å…¶ä¸­éƒ¨åˆ†æŠ€æœ¯å®ç°è¿›è¡Œåˆ†äº«ã€‚</p>
<h2 id="æµ‹è¯•å·¥å…·æ¶æ„è®¾è®¡"><a href="#æµ‹è¯•å·¥å…·æ¶æ„è®¾è®¡" class="headerlink" title="æµ‹è¯•å·¥å…·æ¶æ„è®¾è®¡"></a>æµ‹è¯•å·¥å…·æ¶æ„è®¾è®¡</h2><p>æ•´ä¸ªæµ‹è¯•å·¥å…·åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>ä»“åº“ç®¡ç†æœåŠ¡ï¼šè´Ÿè´£ç®¡ç†å¤šä¸ªç­–åˆ’è¡¨æ ¼çš„svn/gitä»“åº“ï¼Œå¹¶æ¶µç›–å¯¼å…¥è¡¨æ ¼æ•°æ®çš„åŠŸèƒ½</li>
<li>è¡¨æ ¼æµ‹è¯•æœåŠ¡ï¼šè´Ÿè´£æ¥æ”¶ç”¨æˆ·çš„æµ‹è¯•è¯·æ±‚ï¼Œå‘ä»“åº“ç®¡ç†æœåŠ¡è¯·æ±‚ç‰¹å®šç‰ˆæœ¬çš„æ•°æ®ï¼Œæ‰§è¡Œè¡¨æ ¼æµ‹è¯•ä»»åŠ¡</li>
</ul>
<p>æµ‹è¯•å·¥å…·çš„æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾ï¼š</p>
<a id="more"></a>
<p><img src="/uploads/testlife/table_test_tool/table_test_tool.png" alt="è¡¨æ ¼æµ‹è¯•å·¥å…·" title="&#39;è¡¨æ ¼æµ‹è¯•å·¥å…·&#39;"></p>
<p>ä»“åº“ç®¡ç†æœåŠ¡éœ€è¦æŒ‚è½½ä¸€ä¸ªå¤§ç©ºé—´çš„ç¡¬ç›˜ï¼Œç¡¬ç›˜é‡Œå­˜å‚¨å¤šä¸ªç­–åˆ’è¡¨æ ¼ä»“åº“ï¼Œè€Œç®¡ç†æœåŠ¡åˆ™ç¼“å­˜ä»“åº“ä¿¡æ¯åœ¨redisä¸­ã€‚åŒæ—¶ç”¨æˆ·å¯ä»¥åœ¨ä»“åº“ç®¡ç†æœåŠ¡çš„ç›®å½•ä¸‹è‡ªå®šä¹‰å¯¼å…¥æ•°æ®åˆ°redisçš„è„šæœ¬ï¼Œä»“åº“ç®¡ç†æœåŠ¡è¿è¡Œæ—¶åŠ¨æ€æ‰§è¡Œè„šæœ¬ä»£ç ï¼Œå°†è¡¨æ ¼æ•°æ®ä»¥åŠå…¶å…ƒæ•°æ®å¯¼å…¥åˆ°redis</p>
<p>ç­–åˆ’è¡¨æ ¼æµ‹è¯•æœåŠ¡è¿æ¥redisï¼Œä½†çº¦å®šä¸Šåªæœ‰è¯»çš„æƒé™ï¼Œæ²¡æœ‰å¢åˆ çš„æƒé™ï¼Œä¸”åªèƒ½è¯»å–redisä¸­ç¼“å­˜çš„è¡¨æ ¼æ•°æ®åŠå…ƒæ•°æ®ã€‚è¡¨æ ¼æµ‹è¯•æœåŠ¡å°†æµ‹è¯•ç›¸å…³çš„é…ç½®ä»¥åŠç»“æœåˆ™éƒ½å­˜å‚¨åœ¨mongodbä¸­ï¼Œæä¾›æœåŠ¡æ¥å£ç»™åˆ°webå‰ç«¯</p>
<p>è®¾è®¡ä»“åº“ç®¡ç†æœåŠ¡ï¼Œå¦‚æœç”¨pythonçš„è¯ï¼Œå¯ä»¥ç”¨<code>ProcessPoolExecutor</code>å…ˆå¼€ä¸€ç»„workerï¼Œæ¯ä¸ªworkeråœ¨æ¥æ”¶åˆ°ä»»åŠ¡æ—¶ï¼Œå†åœ¨å…¶ä¸­å¼€å¦å¤–çš„<code>ProcessPoolExecutor</code>æ‰§è¡Œä»»åŠ¡ï¼ˆåƒè¡¨æ ¼å¯¹æ¯”å°±éœ€è¦åŒæ—¶æ›´æ–°å¹¶ä¸Šä¼ ä¸¤ä¸ªè¡¨çš„æ•°æ®ï¼Œå› æ­¤å¾—å¦å¤–å¼€poolå»submitä»»åŠ¡ï¼‰ï¼Œåœ¨ä»»åŠ¡æ‰§è¡Œå®Œåé”€æ¯æ¯ä¸ªworkeré‡Œçš„poolã€‚è¿™æ ·èƒ½å¤Ÿæœ‰æ•ˆè§£å†³å†…å­˜æ³„éœ²çš„é—®é¢˜</p>
<h2 id="è¡¨æ ¼æ£€æŸ¥"><a href="#è¡¨æ ¼æ£€æŸ¥" class="headerlink" title="è¡¨æ ¼æ£€æŸ¥"></a>è¡¨æ ¼æ£€æŸ¥</h2><p>åœ¨å…ˆå‰çš„æ–‡ç« å½“ä¸­ï¼Œæåˆ°è¡¨æ ¼æ£€æŸ¥çš„æœ¬è´¨å…¶å®æ˜¯æ•°æ®å¯¼å‡ºï¼Œå¯ä»¥ç”¨mongodbèšåˆçš„æ–¹å¼å»å®ç°æ•°æ®å¯¼å‡ºã€‚</p>
<p>mongodbçš„èšåˆæ˜¯ç”±ä¸€ç³»åˆ—çš„stagesç»„åˆè€Œæˆçš„ï¼Œæ¯ä¸ªstageæœ‰å›ºå®šçš„è¯­æ³•æè¿°æ•°æ®å¤„ç†çš„æ–¹å¼ã€‚è€Œæ”¾åˆ°è¡¨æ ¼æ•°æ®å¯¼å‡ºè¿™ä¸ªéœ€æ±‚é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ‹Ÿå®šä¸€å¥—æ•°æ®å¤„ç†æµæ°´çº¿ï¼š</p>
<ul>
<li>æ•°æ®å®¹å™¨ï¼šä»redisä¸­è¯»å–æŸä¸ªç‰ˆæœ¬çš„è¡¨æ ¼æ•°æ®ï¼Œè½¬åŒ–æˆä¸€ä¸ªæ•°æ®å®¹å™¨<code>DataContainer</code>çš„ç»“æ„</li>
<li>åˆå§‹æ•°æ®ï¼šä»æ•°æ®å®¹å™¨ä¸­ï¼Œç­›é€‰éœ€è¦çš„æ•°æ®ä½œä¸ºåˆå§‹æ•°æ®ï¼Œåˆå¹¶ä¸ºä¸€ä¸ª<code>List[Dict[str, Any]]</code>å½¢å¼çš„æ•°æ®</li>
<li>æ•°æ®å¤„ç†æ­¥éª¤é›†ï¼šé€šè¿‡ä¸€ç³»åˆ—æ•°æ®å¤„ç†æ­¥éª¤ï¼Œå°†åˆå§‹æ•°æ®è½¬åŒ–æˆåŒ…å«æœ€ç»ˆéœ€è¦çš„æ•°æ®çš„é›†åˆ<ul>
<li>æ¯ä¸ªæ•°æ®å¤„ç†æ­¥éª¤çš„æ¥å£å®šä¹‰æ˜¯<code>process(data: List[Dict[str, Any]], container: DataContainer, tracer: PipelineStageTracer) -&gt; List[Dict[str, Any]]</code>ï¼Œå…¶ä¸­<code>data</code>æ˜¯ä¸Šä¸€ä¸ªå¤„ç†æ­¥éª¤ä¸‹æ¥çš„æ•°æ®ï¼Œ<code>container</code>æ˜¯æ•°æ®å®¹å™¨æºå¤´ï¼Œ<code>tracer</code>åˆ™ç”¨äºè·Ÿè¸ªå½“å‰å¤„ç†æ­¥éª¤çš„ä¿¡æ¯</li>
</ul>
</li>
<li>æ•°æ®æå–è§„åˆ™ï¼šæ ¹æ®æœ€ç»ˆå¤„ç†çš„æ•°æ®ï¼Œå†æ¬¡æå–éœ€è¦çš„æ•°æ®å‡ºæ¥ï¼Œæ ‡æ³¨æ¯ä¸ªå­—æ®µçš„å«ä¹‰ã€‚è¿™ä¸€æ­¥ä¸»è¦ç”¨äºäººæ€§åŒ–å±•ç¤ºæ•°æ®å¯¼å‡ºç»“æœ</li>
</ul>
<p>æ•°æ®å¤„ç†æ­¥éª¤éœ€è¦å®ç°jsoné…ç½®-&gt;å¤„ç†æ­¥éª¤æ•°æ®ç»“æ„çš„è½¬åŒ–ã€‚æ ¹æ®mongodbçš„å®šä¹‰ï¼Œé¦–å…ˆéœ€è¦æ‹†è§£è¿™äº›æ­¥éª¤åŒ…å«çš„å…ƒç´ ï¼š</p>
<p>ä¸€äº›åŸºç¡€çš„è¡¨è¾¾å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li>å®šä½ç¬¦<code>Locator</code>ï¼šxx.yy.zzï¼Œç”¨æ¥æ ‡è¯†æ•°æ®åœ¨æŸä¸ªobjectçš„ä½ç½®</li>
<li>è®¡ç®—ç¬¦<code>Calculator</code>ï¼šç”¨äºæ‰§è¡Œæ•°å­¦è®¡ç®—ï¼Œå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9tZXRhL2FnZ3JlZ2F0aW9uLXF1aWNrLXJlZmVyZW5jZS8jYWdncmVnYXRpb24tZXhwcmVzc2lvbnM=" title="https://docs.mongodb.com/manual/meta/aggregation-quick-reference/#aggregation-expressions">aggregation expressions<i class="fa fa-external-link"></i></span>ä¸­çš„<code>arithemtic expr operators</code>éƒ¨åˆ†</li>
<li>ç´¯ç§¯ç¬¦<code>Accumulator</code>ï¼šç”¨äºæå–æŸä¸ªåˆ—è¡¨æ•°æ®çš„å±æ€§ï¼Œå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvYWdncmVnYXRpb24vZ3JvdXAv" title="https://docs.mongodb.com/manual/reference/operator/aggregation/group/">mongodb group<i class="fa fa-external-link"></i></span>çš„å†…å®¹</li>
</ul>
<p>ä¸€äº›åŸºç¡€çš„å¤„ç†æ­¥éª¤åŒ…æ‹¬ï¼š</p>
<ul>
<li>è¿‡æ»¤<code>FilterStage</code>ï¼š å¯ä»¥å‚ç…§mongodbçš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvcXVlcnkv" title="https://docs.mongodb.com/manual/reference/operator/query/">æŸ¥è¯¢å®ç°<i class="fa fa-external-link"></i></span><ul>
<li>éœ€è¦çš„åŸºæœ¬æ•°æ®åŒ…æ‹¬ï¼šå®šä½ç¬¦<code>Locator</code>ã€è¿ç®—ç¬¦<code>Operator</code>ã€è®¡ç®—å€¼<code>Value</code>ã€‚æ ¹æ®ä¸åŒçš„<code>Operator</code>å»è§£æä¸åŒçš„<code>Value</code>ã€‚æ¯”å¦‚å¦‚æœéœ€è¦è¿›è¡Œé€»è¾‘è¿ç®—ï¼Œå¯ä»¥è®©<code>Value</code>å˜æˆå†…åµŒ<code>FilterStage</code>çš„åˆ—è¡¨</li>
</ul>
</li>
<li>è”è¡¨<code>LookupStage</code>ï¼šå¯ä»¥å‚ç…§mongodbçš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9yZWZlcmVuY2Uvb3BlcmF0b3IvYWdncmVnYXRpb24vbG9va3VwLw==" title="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/">lookupå®ç°<i class="fa fa-external-link"></i></span><ul>
<li>éœ€è¦çš„åŸºæœ¬æ•°æ®åŒ…æ‹¬ï¼šå¦ä¸€æ¡æµæ°´çº¿çš„å®šä¹‰<code>Pipeline</code>ã€è‡ªå·±æµæ°´çº¿å’Œå¦å¤–æµæ°´çº¿çš„<code>Locator</code>ä»¥åŠè¿ç®—ç¬¦<code>Operator</code>ã€æµæ°´çº¿è”å…¥åˆ°çš„å­—æ®µ<code>Alias</code></li>
<li>å¯ä»¥æ ¹æ®lookupçš„å®ç°è‡ªç”±æ·»åŠ stageçš„å±æ€§ï¼Œæ¯”å¦‚ä¿ç•™ä¸åŒ¹é…çš„ç»“æœï¼š<code>PreserveNullResults</code></li>
</ul>
</li>
<li>åˆ—è¡¨å±•å¼€<code>FlattenStage</code>ï¼šå±•å¼€ç‰¹å®šå®šä½ç¬¦ä¸‹çš„åˆ—è¡¨å€¼ï¼Œæ¯ä¸€è¡ŒåŒ…å«åˆ—è¡¨çš„ä¸€ä¸ªå…ƒç´ ï¼ˆ1-&gt;nï¼‰çš„è½¬æ¢<ul>
<li>ä¸»è¦ç”¨äºæœ€ç»ˆäººæ€§åŒ–åœ°åœ¨è¡¨æ ¼ä¸­å±•ç¤ºæ•°æ®</li>
</ul>
</li>
<li>å­—æ®µé´é€‰<code>PickStage</code>ï¼šåªä¿ç•™ç‰¹å®šçš„å­—æ®µå€¼åˆ°ä¸‹ä¸€è½®ï¼Œé€šå¸¸ç”¨äºå†…å­˜ä¼˜åŒ–</li>
</ul>
<p>æ¯ä¸ªstageéƒ½éœ€è¦å®ç°å‰é¢è¯´çš„æ•°æ®æ¥å£<code>process</code>ã€‚å¦‚æœæœ‰ç‰¹æ®Šçš„æ•°æ®æ£€æŸ¥éœ€æ±‚ï¼Œå¯ä»¥æ ¹æ®è¿™äº›åŸºç¡€stageçš„å®šä¹‰æ–¹å¼å»è‡ªåˆ›ä¸€äº›ï¼Œå®æµ‹ç”¨pythonåˆ›å»ºä¸€ä¸ªæ–°çš„stageï¼Œå¯èƒ½ä¸éœ€è¦100è¡Œã€‚</p>
<p>æœ‰äº†è¿™äº›åŸºç¡€ï¼Œå°±èƒ½å¤Ÿä»¥é…ç½®åŒ–çš„æ–¹å¼å»å®ç°æ•°æ®æ£€æŸ¥è§„åˆ™ã€‚</p>
<h2 id="è¡¨æ ¼å¯¹æ¯”"><a href="#è¡¨æ ¼å¯¹æ¯”" class="headerlink" title="è¡¨æ ¼å¯¹æ¯”"></a>è¡¨æ ¼å¯¹æ¯”</h2><p>åœ¨<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjAvMDEvMjMvdGVzdGxpZmUvZXhjZWxfZGlmZi8=" title="https://utmhikari.top/2020/01/23/testlife/excel_diff/">ã€Šä¸ºæ¸¸æˆç­–åˆ’ä¸QAé‡èº«å®šåˆ¶çš„excelè¡¨diffç®—æ³•ã€‹<i class="fa fa-external-link"></i></span>ä¸€æ–‡ä¸­å·²è¯¦å°½å™è¿°excel-diffçš„ç®—æ³•ï¼Œæœ¬æ–‡åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæå‡ºä¸€äº›tipsï¼š</p>
<ul>
<li>å¯¼å…¥æ•°æ®éœ€è¦å¯¹excelåšäºŒæ¬¡å¤„ç†ã€‚å»ºè®®å»æ‰ç©ºè¡¨å¤´çš„æ•°æ®ï¼Œå¦åˆ™ä¼šå†—ä½™è¾ƒå¤šå†…å®¹</li>
<li>excel-diffç®—æ³•æ–¹é¢ï¼Œå¯¹è¡Œè¿›è¡Œç›¸ä¼¼åº¦æ¯”è¾ƒæ˜¯è¾ƒä¸ºå…³é”®çš„ä¸€æ­¥ï¼Œèƒ½å¤Ÿæ˜¾è‘—å‡å°‘diffçš„æ—¶é—´ã€‚é€šå¸¸æ¥è®²ï¼Œæ¯è¡Œçš„å‰5åˆ—æ•°æ®ç›¸å¯¹è¾ƒä¸ºé‡è¦ï¼Œä»äººç±»è§’åº¦è€Œè¨€ä¹Ÿé€šå¸¸é€šè¿‡å‰å‡ åˆ—æ•°æ®å»åŒºåˆ†å“ªäº›è¡Œåšäº†æ”¹åŠ¨ã€‚å› æ­¤åœ¨ç›¸ä¼¼åº¦è®¡ç®—æ–¹é¢ï¼Œå‰5åˆ—éœ€è¦èµ‹äºˆé«˜æƒé‡ï¼Œå¦‚æœåŒ¹é…å°±åŠ æƒé‡ï¼Œä¸åŒ¹é…åˆ™åå‡æƒé‡ï¼›è€Œå…¶ä»–åˆ—åˆ™åŒ¹é…åŠ æƒé‡ï¼Œä¸åŒ¹é…ä¸åŠ æƒé‡ã€‚</li>
<li>å‰ç«¯å¦‚æœç”¨vueåšçš„è¯ï¼Œæœ‰äº›å‘å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjEvMDUvMDEvZ2Vla2RhaWx5L2V4Y2VsX2RpZmZfdnhlLXRhYmxlLw==" title="https://utmhikari.top/2021/05/01/geekdaily/excel_diff_vxe-table/">ã€Šç”¨vxe-tableå±•ç¤ºexcel-diffçš„ç»“æœã€‹<i class="fa fa-external-link"></i></span>ä¸€æ–‡</li>
</ul>
<h2 id="æŸ¥è¯¢åŠŸèƒ½"><a href="#æŸ¥è¯¢åŠŸèƒ½" class="headerlink" title="æŸ¥è¯¢åŠŸèƒ½"></a>æŸ¥è¯¢åŠŸèƒ½</h2><p>åŸºäºä¸Šé¢æ‰€æåˆ°çš„<code>DataContainer</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™ä¸ªæ•°æ®ç»“æ„çš„ç‰¹æ€§è®¾è®¡ä¸€ç³»åˆ—æŸ¥è¯¢æ¥å£ã€‚è¿™äº›éƒ½æ˜¯æ¯”è¾ƒç®€å•æ–¹ä¾¿å®ç°çš„å†…å®¹</p>
<ul>
<li>é€šè¿‡æŸä¸ªåå­—ï¼Œæœå¯¹åº”çš„ID</li>
<li>è¾“å…¥ä¸€ç³»åˆ—IDï¼Œè¾“å‡ºä¸€ç³»åˆ—åå­—</li>
<li>è¾“å…¥ä¸€ä¸ªå®ç®±IDï¼Œè¾“å‡ºå®ç®±æŠ½å–çš„Mindmap</li>
<li>etc</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>åœ¨æ•°æ®ç®¡ç†+æœåŠ¡çš„æ¶æ„è®¾è®¡åŸºç¡€ä¸Šï¼Œå¯ä»¥å®ç°å¤šç§å¤šæ ·çš„æµ‹è¯•éœ€æ±‚ã€‚å¹¶ä¸”ä»é€šç”¨æ€§è§’åº¦æ¥è®²ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½å¯ä»¥éµå¾ªä»¥è¿™ä¸ªæŠ€æœ¯è§„èŒƒå»æ‰©å±•è¡¨æ ¼æµ‹è¯•å·¥å…·çš„å®ç°ï¼ŒåˆæœŸçš„è¯åªéœ€è¦ä¿®æ”¹æ•°æ®å¯¼å…¥redisçš„è„šæœ¬å°±èƒ½å¤Ÿå¼€å§‹ç”¨ä¸Šå·¥å…·ã€‚æ¥å…¥ä¸Šç†åº”ä¸ä¼šæœ‰å¤ªå¤šéšœç¢ï¼ŒåŒæ—¶ä¹Ÿèƒ½æŠŠè¿™ä¸ªæŠ€æœ¯æ€è·¯åŠäº§å‡ºç»™æ²‰æ·€ä¸‹æ¥ã€‚</p>
<p>ç¾ä¸­ä¸è¶³çš„åœ°æ–¹ï¼Œå½“å‰çš„å·¥å…·å®ç°è¿˜æœªè€ƒè™‘git/svn hookåŠæ—¶è·å–è¡¨æ ¼å˜æ›´çš„diffï¼Œä»¥åŠç”¨git/svnçš„APIè·å–æ›´å¤šä»“åº“çš„ä¿¡æ¯ã€‚è¿™äº›éƒ½æ˜¯æœ‰æŒ–æ˜ä»·å€¼çš„å†…å®¹ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>ç³»ç»Ÿè®¾è®¡</tag>
        <tag>è¡¨æ ¼æ£€æŸ¥</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¸¸æˆå¼€å‘ã€‘UE4è”æœºæ¸²æŸ“swarm agenté…ç½®</title>
    <url>/2021/05/23/gamedev/ue4_swarm_build/</url>
    <content><![CDATA[<p>UE4åœ¨æ„å»ºåœºæ™¯å…‰ç…§æ—¶ï¼Œä¼šå¯åŠ¨<code>swarm agent</code>è¿›è¡Œæ„å»ºï¼Œä½†å¦‚æœåªç”¨ä¸€å°ç”µè„‘ä¼šå‡ºç°æ„å»ºé€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µã€‚ä¸ºäº†åŠ å¿«ç¼–è¯‘çš„æ•ˆç‡ï¼Œéœ€è¦é…ç½®è”æœºæ¸²æŸ“ã€‚</p>
<p>é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨UE4ä¸­è‡ªåŠ¨æ‰“å¼€<code>swarm agent</code>å’Œæ‰‹åŠ¨æ‰“å¼€<code>swarm agent</code>ä¼šç”¨åˆ°ä¸åŒçš„é…ç½®ã€‚å› æ­¤ï¼Œå»ºè®®çš„æ–¹æ³•æ˜¯æ‰‹åŠ¨æ‰“å¼€<code>swarm agent</code>è¿›è¡Œé…ç½®ï¼ˆå¯¹äºæ‰€æœ‰æœºå™¨ï¼‰ï¼Œç„¶åå†å¼€UE4ã€‚æ¯ä¸ª<code>swarm agent</code>ä»¥åŠè°ƒåº¦å™¨<code>swarm coordinator</code>çš„å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®ï¼Œéƒ½åœ¨å¼•æ“çš„<code>Engine\Binaries\DotNET</code>ä¸‹</p>
<p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæœ‰<code>Unreal Swarm</code>é…ç½®çš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vZW4tVVMvUmVuZGVyaW5nQW5kR3JhcGhpY3MvTGlnaHRtYXNzL1VucmVhbFN3YXJtT3ZlcnZpZXcvaW5kZXguaHRtbA==" title="https://docs.unrealengine.com/en-US/RenderingAndGraphics/Lightmass/UnrealSwarmOverview/index.html">ä¾‹å­<i class="fa fa-external-link"></i></span>å¯ä»¥å‚è€ƒã€‚å‡è®¾ä½ æœ‰ä¸€å°æ€§èƒ½å¼ºåŠ²çš„æœºå­ï¼Œå’Œä¸€å°ä½ æ—¥å¸¸å·¥ä½œä½†æ€§èƒ½ä¸€èˆ¬èˆ¬çš„æœºå­ã€‚è¿™æ ·å¯ä»¥å¦‚ä¸‹é…ç½®ï¼š</p>
<a id="more"></a>
<p>1ã€ä¸¤å°æœºå­éƒ½å¿…é¡»è£…UE4ï¼ˆæœ€å¥½åŒä¸€ç‰ˆæœ¬ï¼‰ï¼Œéƒ½ä¼šè‡ªå¸¦<code>swarm agent</code>ã€‚ä¸¤å°æœºå­å±€åŸŸç½‘äº’é€šï¼ˆWindowsçš„è¯ï¼Œå¼€å¯ç½‘ç»œå…±äº«ï¼‰ï¼Œç”¨ä¸»æœºåå°±å¯ä»¥è®¿é—®å¯¹æ–¹ã€‚</p>
<p>2ã€<strong>å°†æ€§èƒ½å¼ºåŠ²çš„æœºå­ä½œä¸ºä¸»æœº</strong>ã€‚åœ¨æ€§èƒ½å¼ºåŠ²çš„æœºå­ä¸Šï¼Œæ‰“å¼€è°ƒåº¦å™¨<code>swarm coordinator</code>ä»¥åŠ<code>swarm agent</code>ï¼Œç„¶ååœ¨<code>Settings -&gt; Distribution Settings</code>å¦‚ä¸‹é…ç½®ï¼š</p>
<p><img src="/uploads/gamedev/ue4_swarm_agent/master_agent.png" alt="ä¸»æœºAgent" title="&#39;ä¸»æœºAgent&#39;"></p>
<p>é…ç½®é¡¹æ„ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>AgentGroupName</code>ï¼šagentæ‰€å±çš„ç»„</li>
<li><code>AllowedRemoteAgentGroup</code>ï¼šå“ªäº›ç»„çš„agentå¯ä»¥æ¥æ”¶è‡ªå·±ä¸‹å‘çš„ä»»åŠ¡</li>
<li><code>AllowedRemoteAgentNames</code>ï¼šå“ªäº›åŒ¹é…åå­—çš„agentå¯ä»¥æ¥æ”¶è‡ªå·±ä¸‹å‘çš„ä»»åŠ¡</li>
<li><code>AvoidLocalExecution</code>ï¼šé¿å…æœ¬åœ°æ‰§è¡Œï¼Œä¼˜å…ˆåˆ†å‘ä»»åŠ¡åˆ°å…¶å®ƒAgentã€‚å¦‚æœä»»åŠ¡é‡ŒæŸäº›æ­¥éª¤åªèƒ½åªèƒ½æœ¬åœ°æ‰§è¡Œï¼Œå®æµ‹é€‰æ‹©<code>true</code>ä¸ä¼šè·‘æ»¡æ ¸ï¼Œè€Œé€‰æ‹©<code>false</code>ä¼šè·‘æ»¡ã€‚</li>
<li><code>CoordinatorRemotingHost</code>ï¼šè°ƒåº¦å™¨Hostï¼ˆä¸»æœºå/åŸŸå/IPï¼‰</li>
<li><code>EnableStandaloneMode</code>ï¼šå¯ç”¨ç‹¬ç«‹æ¨¡å¼ï¼ˆä¸ä¸‹å‘/æ¥æ”¶æ„å»ºä»»åŠ¡ï¼‰</li>
</ul>
<p>å¯¹äºä¸»æœºè€Œè¨€ï¼Œ<code>AgentGroupName</code>å’Œ<code>AllowedRemoteAgentGroup</code>å¯ä»¥è®¾ç½®æˆä¸€æ ·çš„å€¼<code>UE4Render</code>ï¼Œè¡¨ç¤ºä¸»æœºå±äº<code>UE4Render</code>ç»„ï¼Œå¹¶ä¸”ä»ä¸»æœºä¸‹å‘ä»»åŠ¡åˆ°è‡ªå·±ï¼›<code>AllowedRemoteAgentNames</code>å¡«å†™é€šé…ç¬¦<code>*</code>è¡¨ç¤ºå…è®¸æ‰€æœ‰æœºå­ï¼›<code>AvoidLocalExecution</code>å¡«å†™é»˜è®¤<code>false</code>å³å¯ï¼›<code>CoordinatorRemotingHost</code>å¡«å†™ä¸»æœºè‡ªå·±åœ¨å±€åŸŸç½‘ä¸Šçš„åå­—ï¼ˆä¿è¯ç¨³å®šè¿ä¸Šè‡ªå·±å³å¯ï¼‰ï¼›<code>EnableStandaloneMode</code>å¡«å†™<code>false</code></p>
<p>å¡«å†™å®Œæˆä¹‹åï¼Œåœ¨ä¸»æœºçš„<code>swarm agent</code>ä¸Šç‚¹å‡»<code>Network -&gt; Ping Coordinator</code>ï¼Œå¯ä»¥åœ¨è°ƒåº¦å™¨ä¸Šçœ‹åˆ°ä¸»æœºçš„<code>swarm agent</code></p>
<p>ä¹‹åéœ€è¦è®¾ç½®ä¸»æœº<code>swarm agent</code>çš„æ€§èƒ½å‚æ•°ã€‚åœ¨<code>Settings -&gt; Developer Settings</code>ä¸‹ï¼Œå°†<code>ShowDevelopMenu</code>é€‰æ‹©ä¸º<code>true</code>ï¼Œå°±èƒ½çœ‹åˆ°<code>DeveloperSettings</code>é¡µç­¾ã€‚é€‰ä¸­è¯¥é¡µç­¾ï¼Œåœ¨<code>Local Performance Settings</code>ä¸‹ï¼Œè®¾ç½®<code>LocalJobsDefaultProcessPriority</code>å’Œ<code>RemoteJobsDefaultProcessPriority</code>ä¸º<code>AboveNormal</code>ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ï¼Œç„¶åå°†<code>LocalJobsDefaultProcessorCount</code>å’Œ<code>RemoteJobsDefaultProcessorCount</code>è®¾ç½®ä¸º<code>&lt;=ä¸»æœºé€»è¾‘å¤„ç†å™¨æ•°-2</code>çš„å€¼ï¼ˆä¸ç„¶å¯èƒ½ç”¨ä¸»æœºçš„äººä¼šå¡æ­»ï¼‰ã€‚è¿™æ ·å°±èƒ½ä¿è¯å±€åŸŸç½‘å†…å…¶ä»–æœºå­å‘èµ·ä»»åŠ¡ï¼Œä¸»æœºå¯ä»¥å‡ºåŠ›äº†ã€‚</p>
<p>ç„¶åè®¾ç½®å·¥ä½œæœºçš„<code>swarm agent</code>ï¼Œé…ç½®æ ·ä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/gamedev/ue4_swarm_agent/worker_agent.png" alt="å·¥ä½œæœºAgent" title="&#39;å·¥ä½œæœºAgent&#39;"></p>
<p>å·¥ä½œæœºå’Œä¸»æœºçš„<code>swarm agent</code>é…ç½®åŸºæœ¬ç›¸åŒã€‚å·¥ä½œæœºä¸Šï¼Œ<code>AgentGroupName</code>å’Œ<code>AllowedRemoteAgentGroup</code>è®¾ç½®æˆä¸ºè·Ÿä¸»æœºä¸€æ ·çš„å€¼<code>UE4Render</code>ï¼›<code>AllowedRemoteAgentNames</code>å¡«å†™é€šé…ç¬¦ï¼Œå…è®¸ä»»åŠ¡ä¸‹å‘åˆ°æ‰€æœ‰æœºå­ï¼›<code>AvoidLocalExecution</code>å¯å¡«å†™<code>true</code>ï¼Œå¦‚æœæœºå­éå¸¸å·®çš„è¯ï¼Œå¦åˆ™æ„Ÿè§‰å·¥ä½œæœºå¯ä»¥å‡ºåŠ›çš„è¯ï¼Œå°±å¡«å†™<code>false</code>ï¼Œç„¶åæ‰“å¼€<code>DeveloperSettings</code>ï¼Œå°†<code>LocalJobsDefaultProcessorCount</code>å’Œ<code>RemoteJobsDefaultProcessorCount</code>è®¾ç½®ä¸º<code>&lt;=å·¥ä½œæœºé€»è¾‘å¤„ç†å™¨æ•°-2</code>çš„å€¼ï¼Œä¿è¯å·¥ä½œæœºåœ¨è·‘æ»¡ä¸€å®šæ ¸æ•°çš„æƒ…å†µä¸‹ï¼Œæœºå­ä¸ä¼šè´Ÿè½½å¤ªé«˜ï¼ˆè¿™ä¹Ÿæ˜¯è‡ªå·±ç°åœ¨çš„è®¾ç½®ï¼‰ï¼›<code>CoordinatorRemotingHost</code>å¡«å†™å±€åŸŸç½‘é‡Œä¸»æœºçš„åç§°ï¼ˆæœ€å¥½ä¸è¦å¡«å†™IPï¼Œå¦‚æœæ˜¯è‡ªåŠ¨åˆ†å‘çš„è¯ï¼‰ï¼›<code>EnableStandaloneMode</code>å¡«å†™<code>false</code>ã€‚å·¥ä½œæœºçš„<code>DeveloperSettings</code>ä¸‹ï¼Œå’Œæ‰§è¡Œä¼˜å…ˆçº§ç›¸å…³çš„é…ç½®é¡¹å¯ä»¥ä¿æŒå’Œé»˜è®¤ä¸€æ ·ã€‚</p>
<p>è¿™æ ·æ•´ä¸ªå°é›†ç¾¤å°±æ­å»ºå®Œæˆäº†ï¼Œå¯ä»¥åœ¨ä¸¤å°æœºå­çš„<code>swarm agent</code>é‡Œï¼Œé€šè¿‡<code>Network</code>é€‰é¡¹ä¸‹çš„<code>Ping Coordinator</code>å’Œ<code>Ping Remote Agents</code>æ£€æŸ¥agentå’Œè°ƒåº¦å™¨ä»¥åŠå…¶å®ƒagentçš„è¿é€šæ€§ï¼Œç›¸å…³ä¿¡æ¯ä¼šåœ¨<code>Log</code>æ—¥å¿—é¡µç­¾æ˜¾ç¤ºã€‚é…ç½®å®Œ<code>swarm agent</code>ï¼Œå·¥ä½œæœºæ‰“å¼€UE4ï¼Œç‚¹å‡»<code>Build</code>æ„å»ºå…‰ç…§ï¼Œå°±èƒ½å¤Ÿçœ‹åˆ°åˆ†å¸ƒå¼æ„å»ºçš„æ•ˆæœäº†ã€‚</p>
]]></content>
      <categories>
        <category>æ¸¸æˆå¼€å‘</category>
      </categories>
      <tags>
        <tag>æ¸²æŸ“</tag>
        <tag>UE4</tag>
        <tag>æ¸¸æˆå¼€å‘</tag>
        <tag>swarm agent</tag>
        <tag>åˆ†å¸ƒå¼æ„å»º</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘å‰¯æœ¬è‡ªåŠ¨åŒ–æµ‹è¯•</title>
    <url>/2021/05/20/testlife/dungeon_autotest/</url>
    <content><![CDATA[<p>è®¸å¤šæ¸¸æˆï¼Œå°¤å…¶æ˜¯MMOï¼Œä¼šåŒ…å«â€œå‰¯æœ¬â€è¿™ä¸ªæ¦‚å¿µï¼Œç©å®¶é€šè¿‡æ‰“å‰¯æœ¬ä»è€Œè·å¾—ç‰©å“å¥–åŠ±åŠå±æ€§æ”¶ç›Šã€‚é€šå¸¸æ¥è®²ï¼Œå•ä¸ªæ¸¸æˆæ‰€æ¶‰åŠçš„å‰¯æœ¬æ•°é‡/å“ç§è¾ƒå¤šï¼Œå› æ­¤åœ¨æ¸¸æˆæµ‹è¯•è¿‡ç¨‹å½“ä¸­ï¼Œå¾ˆéš¾ä¸€æ¬¡æ€§å…¨éƒ¨éå†å®Œæ‰€æœ‰å‰¯æœ¬çš„æµç¨‹ä¸ç©æ³•ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ–¹å¼å»å†’çƒŸå‰¯æœ¬ç©æ³•æµç¨‹ã€æ£€æŸ¥å¥–åŠ±ã€‚ä¸ºäº†è®©è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œæ›´åŠ ç¨³å®šä¸”æ˜“äºç»´æŠ¤ï¼Œéœ€è¦ä¸€å¥—é€šç”¨çš„é€»è¾‘æ¨¡ç‰ˆå»å®ç°å‰¯æœ¬ç©æ³•è‡ªåŠ¨åŒ–ã€‚è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹æ¶‰åŠå¤šä¸ªéƒ¨åˆ†ï¼ŒåŒ…æ‹¬ç©å®¶è´¦å·çš„å‡†å¤‡ã€å‰¯æœ¬çš„è¿›å…¥ã€å‰¯æœ¬æµç¨‹ã€å¥–åŠ±æ£€æŸ¥ï¼Œè€Œæœ¬æ–‡ä¸»è¦è€ƒè™‘â€œå‰¯æœ¬æµç¨‹â€çš„å®ç°ã€‚</p>
<p>å‰¯æœ¬ç©æ³•çš„æœºåˆ¶å¯ä»¥å¦‚ä¸‹æè¿°ï¼šç©å®¶åœ¨è¿›å…¥å‰¯æœ¬åï¼ŒæœåŠ¡å™¨ä¼šä¸ºç©å®¶åˆ›å»ºä¸€ä¸ªåˆ†çº¿å¹¶è®©ç©å®¶æ‰§è¡Œåˆ‡çº¿æ“ä½œåˆ‡å…¥å‰¯æœ¬å†…ï¼Œè€Œåä¸‹å‘å‰¯æœ¬ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åˆ™ç¼“å­˜ä¿¡æ¯ï¼Œä¸ºç©å®¶åˆ›å»ºåœºæ™¯åŠæŒ‡å¼•ï¼Œè€Œåç©å®¶æ ¹æ®æŒ‡å¼•æ¸¸ç©å‰¯æœ¬å†…çš„å†…å®¹ã€‚æ¯å½“ç©å®¶æ‰§è¡Œäº†ç‰¹å®šçš„è¡Œä¸ºï¼Œæ¯”å¦‚èµ°åˆ°æŒ‡å¼•çš„ä½ç½®/å¹²æ‰æŒ‡å¼•çš„æ€ªç‰©ï¼Œå°±ä¼šè§¦å‘è¿™äº›æŒ‡å¼•ç»‘å®šçš„è§¦å‘å™¨ï¼Œè§¦å‘å™¨ç”Ÿæ•ˆåï¼ŒæœåŠ¡å™¨å°±ä¼šåŒæ­¥è§¦å‘å‡ºæ¥çš„ä¸‹ä¸€é˜¶æ®µçš„ä¿¡æ¯ç»™åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ä¾¿å±•ç¤ºå‡ºä¸‹ä¸€é˜¶æ®µçš„æŒ‡å¼•ï¼Œç›´åˆ°å‰¯æœ¬ç»“æŸæˆ–è€…å‘ç”Ÿé”™è¯¯ã€æ„å¤–é€€å‡ºä¸ºæ­¢ã€‚ä»å‰¯æœ¬æœºåˆ¶å¯ä»¥çœ‹åˆ°ï¼Œå‰¯æœ¬ç©æ³•çš„æ¯ä¸€ä¸ªæ­¥éª¤ï¼Œåœ¨å®¢æˆ·ç«¯ä¸­éƒ½æœ‰ç¼“å­˜ç›¸å…³çš„ä¿¡æ¯ï¼Œåœ¨è‡ªåŠ¨åŒ–çš„å®ç°ä¸Šï¼Œåªéœ€è¦æ¯ä¸€ä¸ªè½®æ¬¡è¯»å–å‰¯æœ¬ä¿¡æ¯ï¼Œæ‰§è¡Œç›¸å…³çš„è¡Œä¸ºå³å¯ï¼ˆä»»åŠ¡ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å¦‚ä¸‹çš„è¡Œä¸ºæ¥è‡ªåŠ¨è·‘å‰¯æœ¬ï¼š</p>
<a id="more"></a>
<p>é¦–å…ˆéœ€è¦å®šä¹‰å‰¯æœ¬ä¿¡æ¯çŠ¶æ€<code>State</code>ï¼Œæ¯å½“çŠ¶æ€å‘ç”Ÿå˜æ›´ï¼Œå°±è¯´æ˜è‡ªåŠ¨åŒ–æ‰§è¡Œçš„è¡Œä¸ºå–åˆ°äº†ä¸€å®šè¿›å±•ã€‚é’ˆå¯¹çŠ¶æ€æ˜¯å¦å˜æ›´ï¼Œéœ€è¦å®šä¹‰ä¸¤ç±»è¡Œä¸ºï¼š<code>OnStateChanged</code>å’Œ<code>OnIdle</code>ï¼Œåˆ†åˆ«å¯¹åº”çŠ¶æ€å˜åŒ–ä¸çŠ¶æ€æœªå˜åŒ–ï¼ˆé—²ç½®ï¼‰çš„æƒ…å†µã€‚<code>OnStateChanged</code>é‡Œå¯ä»¥å®ç°ä¸€äº›å‰¯æœ¬ç©æ³•å¸¸è§çš„æ“ä½œï¼Œè€Œ<code>OnIdle</code>æ–¹æ³•å¯ä»¥é›†åˆæŸäº›å‰¯æœ¬é‡Œç‰¹æ®Šçš„æ“ä½œï¼Œè¿™æ ·å¯ä»¥ä¿è¯å‰¯æœ¬è¡Œä¸ºçš„é€šç”¨æ€§ã€‚å‰¯æœ¬è¡Œä¸ºç”¨ä¸€ä¸ªå¾ªç¯è¡¨ç¤ºï¼Œæ¯ä¸ªå¾ªç¯ä¼šæ›´æ–°å½“å‰å‰¯æœ¬ä¿¡æ¯çŠ¶æ€ï¼Œæ‰§è¡Œ<code>OnStateChanged</code>æˆ–<code>OnIdle</code>ã€‚å½“<code>OnStateChanged</code>æˆ–<code>OnIdle</code>æŠ¥é”™ï¼Œæˆ–è€…<code>OnIdle</code>æ‰§è¡Œåˆ°ä¸€å®šçš„æ¬¡æ•°æ—¶ï¼Œåˆ¤å®šå‰¯æœ¬æ‰§è¡Œå¤±è´¥ï¼›å½“æ‰§è¡Œå®Œä¸€è½®å¯¹åº”çš„åè¿˜éœ€åˆ¤æ–­å‰¯æœ¬ç©æ³•æ˜¯å¦å·²ä¸å¯ç©ï¼Œå¦‚æœè¿˜å¯ç©çš„è¯å°±è¦ç»§ç»­å¾ªç¯ï¼Œä¸å¯ç©å³æ£€æŸ¥å‰¯æœ¬æ˜¯å¦å·²ç»æˆåŠŸå®Œæˆã€‚</p>
<p>æ•´ä¸ªæµç¨‹è®¾è®¡å¯ä»¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/uploads/testlife/dungeon_autotest/dungeon_autotest.png" alt="å‰¯æœ¬è‡ªåŠ¨åŒ–" title="&#39;å‰¯æœ¬è‡ªåŠ¨åŒ–&#39;"></p>
<p>é’ˆå¯¹ä¸åŒçš„å‰¯æœ¬ç©æ³•ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ¨¡æ¿åŸºç¡€ä¸Šè¿›è¡Œä¸åŒçš„è¡Œä¸ºå®ç°ã€‚å¦‚æœå‰¯æœ¬æµç¨‹æ›´ä¸ºå¤æ‚ï¼Œå¯ä»¥åœ¨æµç¨‹çš„å„ä¸ªèŠ‚ç‚¹å¢åŠ é’©å­å‡½æ•°ï¼Œå¹¶ç”±å­ç±»å®ç°é’©å­å‡½æ•°ï¼Œä»è€Œåº”ä»˜ä¸€äº›ç‰¹åˆ«çš„éœ€æ±‚ã€‚å¦‚æœæœ‰è¡Œä¸ºæ ‘ç­‰UIæ¡†æ¶æ”¯æŒçš„è¯ï¼Œæè¿°å‰¯æœ¬è¡Œä¸ºå°†ä¼šå˜å¾—å®¹æ˜“å¾ˆå¤šï¼Œå¯ä»¥å¼€ä¸ªå¥½å¤´ï¼Œä½†ä»ä¸­çš„ç»†èŠ‚ï¼Œå„ä¸ªè¡Œä¸ºå…·ä½“çš„å®ç°ï¼Œè¿˜éœ€è¦æ ¹æ®å®é™…æƒ…å†µä»”ç»†è°ƒè¯•ï¼Œè¿™é‡Œä¹Ÿæ˜¯è€—è´¹å·¥ä½œé‡æœ€å¤§çš„åœ°æ–¹ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>æµ‹è¯•</tag>
        <tag>å‰¯æœ¬è‡ªåŠ¨åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘ç”¨vxe-tableå±•ç¤ºexcel-diffçš„ç»“æœ</title>
    <url>/2021/05/01/geekdaily/excel_diff_vxe-table/</url>
    <content><![CDATA[<p>excel-differæ˜¯æ¸¸æˆæµ‹è¯•å¸¸ç”¨çš„æµ‹è¯•å·¥å…·ã€‚åœ¨æœ‰äº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œexcel-diffçš„ç»“æœå¯èƒ½éœ€è¦é€šè¿‡webå±•ç¤ºã€‚VueæŠ€æœ¯æ ˆä¸‹çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRlZS5jb20veHVsaWFuZ3poYW5fYWRtaW4vdnhlLXRhYmxl" title="https://gitee.com/xuliangzhan_admin/vxe-table">vxe-table<i class="fa fa-external-link"></i></span>è¡¨æ ¼ç»„ä»¶èƒ½å¤Ÿæ”¯æŒå¤§é‡æ•°æ®çš„å±•ç¤ºï¼Œå› æ­¤å¯ä»¥ç”¨vxe-tableå±•ç¤ºexcel-diffçš„ç»“æœã€‚</p>
<p>excel-diffçš„ç®—æ³•æœ¬èº«ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMjAvMDEvMjMvdGVzdGxpZmUvZXhjZWxfZGlmZi8=" title="https://utmhikari.top/2020/01/23/testlife/excel_diff/">å…ˆå‰çš„æ–‡ç« <i class="fa fa-external-link"></i></span>å·²æœ‰è®²è§£ï¼Œåœ¨ç»“æœå±•ç¤ºä¸Šä¼šæŒ‰file-&gt;sheetæ¥åˆ†ã€‚ä¸ºäº†è®©ç»“æœå±•ç¤ºæ›´åŠ äººæ€§åŒ–ï¼Œéœ€è¦å¯¹è¡¨æ ¼çš„æ ·å¼è¿›è¡ŒåŒºåˆ†ã€‚åœ¨<span class="exturl" data-url="aHR0cHM6Ly94dWxpYW5nemhhbl9hZG1pbi5naXRlZS5pby92eGUtdGFibGUvdjQvdGFibGUvYXBp" title="https://xuliangzhan_admin.gitee.io/vxe-table/v4/table/api">vxe-tableçš„apiåˆ—è¡¨<i class="fa fa-external-link"></i></span>ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>cell-class-name</code>çš„å›è°ƒå‡½æ•°æŒ‡å®šæ¯ä¸ªå•å…ƒæ ¼çš„æ ·å¼ã€‚é’ˆå¯¹excel-diffçš„ç»“æœå¯ä»¥è¿™æ ·è®¾è®¡æ ·å¼ï¼š</p>
<a id="more"></a>
<ul>
<li>æ–°å¢è¡Œ/åˆ—ï¼šèƒŒæ™¯æµ…ç»¿è‰²</li>
<li>åˆ é™¤è¡Œ/åˆ—ï¼šèƒŒæ™¯æµ…çº¢è‰²</li>
<li>é‡å¤è¡Œ/åˆ—ï¼šèƒŒæ™¯æµ…ç°è‰²</li>
<li>ç§»åŠ¨è¡Œ/åˆ—ï¼šèƒŒæ™¯æµ…æ©™è‰²</li>
<li>ä¿®æ”¹å•å…ƒæ ¼ï¼šèƒŒæ™¯æµ…é»„è‰²ï¼Œå­—ä½“çº¢è‰²</li>
</ul>
<p>ç”¨æˆ·åœ¨å®é™…æŸ¥çœ‹excel-diffç»“æœæ—¶ï¼Œé€šå¸¸éœ€è¦è‡ªåŠ¨æ»šåŠ¨åˆ°å¯¹åº”çš„ä½ç½®ã€‚vxe-tableæä¾›äº†å¦‚ä¸‹apiæ”¯æŒæ»šåŠ¨ï¼š</p>
<ul>
<li><code>scrollToRow(row, fieldOrColumn)</code>ï¼šæ»šåŠ¨åˆ°å¯¹åº”çš„è¡Œæˆ–åˆ—ï¼ˆæ³¨æ„fieldä¸æ˜¯å±•ç¤ºå‡ºæ¥çš„è¡¨å¤´ï¼‰</li>
<li><code>scrollToColumn(fieldOrColumn)</code>ï¼šæ»šåŠ¨åˆ°å¯¹åº”çš„åˆ—</li>
</ul>
<p>è·å–è¡Œã€åˆ—çš„å®ä¾‹ï¼Œå¯ä»¥ç”¨è¿™äº›æ–¹æ³•ï¼š</p>
<ul>
<li><code>getRowById(rowid)</code>ï¼šæ ¹æ®è¡Œçš„å”¯ä¸€ä¸»é”®ï¼ˆstringï¼‰è·å–è¡Œ</li>
<li><code>getColumns()</code>ï¼šè·å–columnsåˆ—è¡¨</li>
<li><code>getColumnById(colid)</code>ï¼šæ ¹æ®åˆ—çš„å”¯ä¸€ä¸»é”®ï¼ˆstringï¼‰è·å–åˆ—</li>
<li><code>getColumnByField(field)</code>ï¼šæ ¹æ®åˆ—çš„å­—æ®µåè·å–åˆ—</li>
</ul>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ»šåŠ¨åï¼Œé»˜è®¤æ»šåŠ¨åˆ°çš„è¡Œä¼šç½®é¡¶ï¼Œåˆ—ä¼šæ”¾åˆ°æœ€å·¦è¾¹ï¼Œè§‚æ„Ÿä¸æ˜¯å¾ˆå¥½ã€‚å› æ­¤å¯ä»¥åšä»¥ä¸‹çš„ä¼˜åŒ–ï¼š</p>
<ul>
<li>å½“å¤„åœ¨è¾ƒä¸ºé å·¦çš„åˆ—ï¼Œç›´æ¥æ»šåŠ¨åˆ°æœ€å·¦è¾¹</li>
<li>å½“å¤„åœ¨è¾ƒä¸ºé å³çš„åˆ—ï¼Œç›´æ¥æ»šåŠ¨åˆ°æœ€å³è¾¹</li>
<li>å…¶ä»–æƒ…å†µä¸‹ï¼Œæ»šåŠ¨åˆ°å‰é¢éš”2ä¸ªçš„åˆ—</li>
<li>æ»šåŠ¨åˆ°çš„è¡Œä¹Ÿå¯åšç±»ä¼¼å¤„ç†ï¼Œè¿™æ ·å¤§éƒ¨åˆ†é€‰ä¸­æ•°æ®éƒ½ä¼šæ˜¾ç¤ºåœ¨ä¸Šé¢é å·¦çš„ä½ç½®ï¼ŒåŸºæœ¬æ»¡è¶³è§‚æ„Ÿéœ€æ±‚</li>
</ul>
<p>é’ˆå¯¹å¤§çš„è¡¨ï¼Œå¯èƒ½ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚æ€§èƒ½çš„ä¼˜åŒ–tipsæœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p>
<ul>
<li>é’ˆå¯¹excelæ•°æ®æœ¬èº«ï¼Œè¿‡æ»¤ç©ºè¡¨å¤´ã€ç©ºè¡Œç­‰æ— æ•ˆæ•°æ®ï¼Œä¿è¯åªæœ‰æœ‰æ•ˆæ•°æ®å‚ä¸diffè®¡ç®—</li>
<li>è¡¨æ ¼éœ€è¦è®¾å®š<code>scroll-x</code>ä¸<code>scroll-y</code>è™šæ‹Ÿæ»šåŠ¨è®¾ç½®ï¼Œå°½é‡ä¸€æ¬¡æ€§ä¸æ¸²æŸ“å¤ªå¤šå†…å®¹</li>
<li>ç”¨Object.freezeå†»ç»“excelæ•°æ®ã€diffç»“æœç›¸å…³çš„objectï¼Œå› ä¸ºè¿™äº›objectæœ¬èº«å°±åº”å½“æ˜¯immutableçš„ï¼Œç”¨Object.freezeå¯<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vZ29sb3ZpbmcvcC8xMzk2OTY4NS5odG1s" title="https://www.cnblogs.com/goloving/p/13969685.html">é¿å…vueåšåº•å±‚å„å±æ€§çš„getter/setterç»‘å®š<i class="fa fa-external-link"></i></span></li>
<li>å¯¹äºæ¯ä¸ªå•å…ƒæ ¼å–<code>cell-class-name</code>ï¼Œä¹Ÿéœ€è¦é¢„å…ˆcomputed + Object.freezeä¸€ä¸ªç¼“å­˜dataï¼Œä½¿å¾—å›è°ƒå‡½æ•°åˆ¤æ–­class-nameç›´æ¥å¯ä»¥åœ¨å…¶ä¸­å–å­—æ®µæ¥åˆ¤æ–­ï¼Œè¿™æ ·é€»è¾‘å¤æ‚åº¦ä¼šå°</li>
<li>æ•°æ®é¢„å¤„ç†ä¸­ï¼Œå¦‚æœè¦ç”¨åˆ°å¾ªç¯é€»è¾‘ï¼Œå¯è€ƒè™‘æ™®é€šçš„forå¾ªç¯ä»£æ›¿forEach</li>
</ul>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>å‰ç«¯å¼€å‘</tag>
        <tag>vue</tag>
        <tag>vxe-table</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘UE4æ¸¸æˆæªæ¢°è‡ªåŠ¨åŒ–æµ‹è¯•çš„ä¸€äº›è®¾è®¡</title>
    <url>/2021/04/17/testlife/ue4_weapon_autotest/</url>
    <content><![CDATA[<p>åœ¨å°„å‡»ç±»æ¸¸æˆä¸­ï¼Œä¸å¯é¿å…åœ°éœ€è¦å¯¹å„ç§æªæ¢°æ­¦å™¨è¿›è¡Œæµ‹è¯•ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæªæ¢°ç§ç±»ç¹å¤šï¼Œäººå·¥éå†æµ‹è¯•ä¼šèŠ±éå¸¸å¤šçš„æ—¶é—´ï¼Œå› æ­¤å¼•å…¥è‡ªåŠ¨åŒ–æµ‹è¯•æ›¿ä»£äººåŠ›æ‰§è¡Œéƒ¨åˆ†å†’çƒŸç”¨ä¾‹ï¼Œèƒ½å¤Ÿå¢åŠ ä¸¥é‡é—®é¢˜ææ—©å‘ç°çš„å¯èƒ½æ€§ã€‚æªæ¢°æµ‹è¯•åŒ…æ‹¬åŸºç¡€è¡Œä¸ºã€ä¼¤å®³ã€å¼¹é“ã€åååŠ›ç­‰æ–¹é¢ï¼Œä»åŠŸèƒ½å†’çƒŸçš„è§’åº¦è€ƒè™‘ï¼ŒåŸºç¡€è¡Œä¸ºå’Œä¼¤å®³æ˜¯éœ€è¦ä¼˜å…ˆè¦†ç›–çš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œæœ¬æ–‡ä»¥UE4å¼•æ“ä¸‹çš„æªæ¢°æµ‹è¯•ä¸ºä¾‹ï¼Œè®²è§£åŸºç¡€è¡Œä¸ºè·Ÿä¼¤å®³æµ‹è¯•çš„ä¸€äº›è®¾è®¡ã€‚</p>
<a id="more"></a>
<p>å¯¹äºæªæ¢°çš„åŸºç¡€è¡Œä¸ºæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§æµ‹è¯•åœºæ™¯ï¼š</p>
<ul>
<li>è£…å¤‡æ­¦å™¨<ul>
<li>åˆ‡æ¢åˆ°ç‰¹å®šIDçš„æ­¦å™¨ï¼Œèƒ½æ­£å¸¸å¸ä¸‹åŸæ¥çš„ï¼Œè£…å¤‡ä¸Šæ–°çš„</li>
</ul>
</li>
<li>å°„å‡»è¡Œä¸º<ul>
<li>æ­£å¸¸å¼€é•œå°„å‡»&amp;å…³é•œ</li>
<li>æ ¹æ®æªæ¢°ç±»å‹çš„ä¸åŒï¼Œèƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œå•å‘/ä¸‰å‘ç‚¹å°„/å…¨è‡ªåŠ¨å°„å‡»</li>
<li>è¹²ä¸‹ã€ç§»åŠ¨ã€è·³è·ƒå°„å‡»æ­£å¸¸</li>
<li>å­å¼¹æ­£å¸¸æ¶ˆè€—</li>
</ul>
</li>
<li>è£…å¡«å¼¹è¯<ul>
<li>æ‰‹åŠ¨è£…å¡«ï¼Œå­å¼¹æ•°é‡æ­£å¸¸</li>
<li>æ‰“å®Œå¼¹å¤¹çš„å­å¼¹è‡ªåŠ¨è£…å¡«ï¼Œå­å¼¹æ•°é‡æ­£å¸¸</li>
</ul>
</li>
<li>è¡¥å……å¼¹è¯<ul>
<li>åˆ©ç”¨é“å…·æˆ–è€…èµ°åˆ°ç‰¹å®šçš„åŒºåŸŸï¼Œè§¦å‘å¼¹è¯è¡¥å……æ•ˆæœï¼Œè¡¥å……æ•°é‡æ­£å¸¸</li>
</ul>
</li>
</ul>
<p>é’ˆå¯¹å°„å‡»ã€å¼€é•œã€ç§»åŠ¨ã€è£…å¡«å¼¹è¯ç­‰è¡Œä¸ºï¼Œå› ä¸ºåœ¨æ¸¸æˆä¸­ç†åº”ä¼šæœ‰ç‰¹å®šçš„å¿«æ·é”®ç»‘å®šï¼Œæ‰€ä»¥åœ¨UE4å¼•æ“ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨å¯¹åº”çš„inputé€»è¾‘æ¥è§¦å‘è¿™äº›è¡Œä¸ºã€‚</p>
<p>é’ˆå¯¹å­å¼¹æ•°é‡æ˜¯å¦æ­£å¸¸çš„æ ¡éªŒï¼Œéœ€è¦äº†è§£çš„æ˜¯ä¸åŒçš„æ­¦å™¨éœ€è¦å…±åŒæŠ½è±¡å‡ºä¸€äº›æ•°æ®modelé€»è¾‘ï¼ˆè¿™å—å¯ä»¥ç§°ä¹‹ä¸ºâ€è™šæ‹Ÿæ­¦å™¨å®ä¾‹â€œï¼‰ï¼Œå­å¼¹æ•°é‡çš„è®¡ç®—è‚¯å®šä¹Ÿä¼šæ”¾åœ¨å†…ï¼Œå› æ­¤å¯ä»¥é€šè¿‡è·å–è¿™é‡Œé¢çš„æ•°æ®æ¥æ£€æŸ¥æ‰§è¡Œè¡Œä¸ºçš„å‰åï¼Œå¼¹å¤¹å†…ä»¥åŠå¤‡å¼¹æ•°é‡æ˜¯å¦æ­£å¸¸æ¶ˆè€—æˆ–å¢åŠ ã€‚</p>
<p>ç±»ä¼¼è¡¥å……å¼¹è¯ç­‰å¯èƒ½å’Œå…¶å®ƒåŠŸèƒ½æ¨¡å—è€¦åˆçš„è¡Œä¸ºï¼Œå®ç°ä¸Šå°±éœ€è¦ç»“åˆå…¶ä»–ç³»ç»Ÿçš„å†…å®¹ï¼Œè‡ªå·±æŠ½è±¡ä¸€å¥—é€»è¾‘äº†</p>
<p>é’ˆå¯¹ä¼¤å®³æµ‹è¯•ï¼Œä¸»è¦çš„æµ‹è¯•åœºæ™¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¼¤å®³ç±»å‹<ul>
<li>æ™®é€šä¼¤å®³</li>
<li>æš´å‡»ä¼¤å®³</li>
</ul>
</li>
<li>ä¼¤å®³æ•ˆæœ<ul>
<li>è¡€é‡æ­£å¸¸å‡å°‘ï¼Œä¸é£˜å­—ç›¸ç¬¦</li>
<li>ç‰¹å®šçš„ä¼¤å®³ï¼Œä¼šäº§ç”Ÿç‰¹å®šçš„buff</li>
</ul>
</li>
</ul>
<p>é’ˆå¯¹ä¼¤å®³ç±»å‹ï¼Œä¸»è¦çœ‹çš„æ˜¯æ™®é€šä¼¤å®³å’Œæš´å‡»ä¼¤å®³ï¼Œæš´å‡»ä¼¤å®³çš„å€¼éœ€è¦æ¯”æ™®é€šä¼¤å®³çš„é«˜ã€‚æš´å‡»çš„å®ç°ï¼Œå‡è®¾æ˜¯çˆ†å¤´çš„è¯ï¼Œå¯ä»¥å°è¯•è·å–å°„å‡»å¯¹è±¡çš„SkeletalMeshç»„ä»¶ï¼Œç„¶åå¤´éƒ¨socketçš„å½“å‰ä½ç½®ï¼Œç„¶åé€šè¿‡rotateçš„æ¥å£ä½¿å¾—è§’è‰²èƒ½å¤Ÿæœå‘å¹¶ç„å‡†åˆ°å°„å‡»å¯¹è±¡çš„å¤´éƒ¨ã€‚</p>
<p>é’ˆå¯¹ä¼¤å®³æ•ˆæœï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœæ˜¯ç½‘æ¸¸çš„è¯ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯èƒ½ä¼šåˆ†å¼€ç‹¬ç«‹è®¡ç®—ä¼¤å®³ã€‚å®¢æˆ·ç«¯ä¼¤å®³æ•°å€¼çš„è¡¨ç°æ˜¯é£˜å­—ï¼Œå¯ä»¥é€šè¿‡hooké£˜å­—çš„æ¥å£æ¥è·å–ç‰¹å®šè®¾è®¡å¯¹è±¡çš„ä¼¤å®³æ•°æ®ï¼›æœåŠ¡ç«¯ä¼¤å®³æ•°å€¼çš„è¡¨ç°åˆ™æ˜¯å°„å‡»å‰åHPçš„å‡å°‘ã€‚æœ€åéœ€è¦æ£€æµ‹çš„å°±æ˜¯ï¼Œå®¢æˆ·ç«¯é£˜å­—å’ŒæœåŠ¡å™¨é‡ŒHPå‡å°‘çš„é‡ç›¸ç¬¦ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>UE4</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>æªæ¢°è‡ªåŠ¨åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»£ç è‰ºå»Šã€‘Protobuf+GRPCåº”ç”¨èŒƒä¾‹ï¼šprotobuf-grpc-starter</title>
    <url>/2021/04/02/codegallery/protobuf_grpc_starter/</url>
    <content><![CDATA[<p>åç«¯çš„æœåŠ¡é—´é€šå¸¸é‡‡ç”¨å›ºå®šçš„åè®®&amp;rpcæ¡†æ¶é€šä¿¡ï¼Œå½“å‰ä¸»æµçš„æ–¹æ¡ˆæ˜¯ä»¥<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvbGFuZy9wcm90b2J1Zg==" title="https://github.com/golang/protobuf">protobuf<i class="fa fa-external-link"></i></span>åè®®ä¸ºåŸºç¡€ï¼Œé‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly93d3cuZ3JwYy5pby8=" title="https://www.grpc.io/">grpc<i class="fa fa-external-link"></i></span>è¿›è¡Œé€šä¿¡ï¼Œè¿™ç§æ–¹å¼åœ¨Golangçš„å¼€å‘ä¸­å°¤å…¶çªå‡ºã€‚å› æ­¤ï¼Œç¬”è€…å†³å®šåšä¸€ä¸ªå°çš„golangåº”ç”¨æ¥è¸©å‘protobuf+grpcç¼–ç æ¨¡å¼ï¼Œä¸Šä¼ åˆ°githubåˆ†äº«â€”â€”è¿™ä¾¿æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9wcm90b2J1Zi1ncnBjLXN0YXJ0ZXI=" title="https://github.com/utmhikari/protobuf-grpc-starter">protobuf-grpc-starter<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>protobuf-grpc-starterä¸»è¦å—åˆ°äº†<span class="exturl" data-url="aHR0cHM6Ly9wYXN0ZWJpbi5jb20v" title="https://pastebin.com/">PasteBin<i class="fa fa-external-link"></i></span>çš„å¯å‘ï¼Œç”¨æˆ·postä¸€æ®µä»£ç åˆ°æœåŠ¡å™¨ï¼Œå¾—åˆ°ä¸€ä¸ªçŸ­é“¾æ¥ï¼ˆshortLinkï¼‰ï¼Œå…¶å®ƒç”¨æˆ·å¯ä»¥é€šè¿‡è¿™ä¸ªçŸ­é“¾æ¥å–æŸ¥çœ‹è¿™ä¸ªç”¨æˆ·æ‰€å‘é€çš„ä»£ç ï¼Œå®ç°ä»£ç æ–‡æœ¬åˆ†äº«ã€‚å½“å­˜å‚¨æ–‡æœ¬é‡è¾ƒå¤§ã€ä¸”ç”¨æˆ·è®¿é—®é‡è¾ƒå¤šæ—¶ï¼Œæ•°æ®åº“ä¸ä¸€å®šèƒ½å¤Ÿæ‰¿è½½çš„äº†æŸ¥è¯¢çš„å‹åŠ›ï¼Œè¿™æ ·å°±éœ€è¦ç¼“å­˜æ¥åˆ†æ‹…æŸ¥è¯¢çš„ä»»åŠ¡ã€‚å› æ­¤åœ¨protobuf-grpc-starterä¸­ï¼Œç¬”è€…ç¼–å†™äº†ä¸¤ä¸ªå°serverï¼šWebSvrå’ŒCacheSvrï¼Œå…¶ä¸­WebSvrç”¨äºå¤„ç†ç”¨æˆ·çš„æŸ¥è¯¢ä»¥åŠpostæ–‡æœ¬è¯·æ±‚ï¼Œpostçš„æ–‡æœ¬å­˜å‚¨åœ¨å•ç‹¬çš„æ–‡ä»¶ä¸­ï¼›CacheSvråˆ™åœ¨å†…éƒ¨å®ç°äº†ä¸€ä¸ªé©»ç•™å†…å­˜çš„LRUç¼“å­˜ï¼Œç”¨æ¥ç¼“å­˜çŸ­é“¾æ¥æŸ¥è¯¢çš„ç»“æœï¼ˆçŸ­é“¾æ¥onlyï¼Œä¿è¯å¼ºä¸€è‡´ï¼‰ã€‚WebSvrå’ŒCacheSvré—´åŸºäºprotobufåè®®é‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYy1nbw==" title="https://github.com/grpc/grpc-go">grpc-go<i class="fa fa-external-link"></i></span>æ¡†æ¶é€šä¿¡ï¼Œå¤„ç†è·å–/è®¾å®šæŸ¥è¯¢ç¼“å­˜çš„æ“ä½œã€‚ä¸ºäº†ä¿è¯æ–°æ¥è§¦protobuf+grpcçš„åŒå­¦èƒ½å¤Ÿä¸“æ³¨äºæ­¤ï¼Œè¿™ä¸ªé¡¹ç›®çš„prerequisitiesé‡Œä¹Ÿä¸ä¼šå¼•å…¥ç±»ä¼¼redisçš„ä¸­é—´ä»¶ï¼Œè€Œåªæœ‰goã€grpcã€protobufç­‰ç›¸å…³çš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>golang v1.16ï¼šæœ‰æœ€æ–°çš„åº“å’Œç‰¹æ€§</li>
<li>protocï¼šç”¨æ¥ç¼–è¯‘protobufåè®®æ–‡ä»¶ï¼Œéœ€è¦åœ¨<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vcHJvdG9jb2wtYnVmZmVycy9kb2NzL2Rvd25sb2Fkcw==" title="https://developers.google.com/protocol-buffers/docs/downloads">protocä¸‹è½½åœ°å€<i class="fa fa-external-link"></i></span>ä¸‹è½½è¾ƒæ–°çš„ç‰ˆæœ¬ï¼ˆprotobuf3ï¼‰</li>
<li>protoc-gen-goï¼šç”¨æ¥ç”Ÿæˆgolangçš„åè®®å®šä¹‰æ–‡ä»¶ï¼Œå¯ä»¥åœ¨<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vcHJvdG9jb2wtYnVmZmVycy9kb2NzL2dvdHV0b3JpYWw=" title="https://developers.google.com/protocol-buffers/docs/gotutorial">protobuf-goæ•™ç¨‹<i class="fa fa-external-link"></i></span>äº†è§£å¦‚ä½•ä¸‹è½½åŠç”Ÿæˆæ–‡ä»¶</li>
<li>protoc-gen-go-grpcï¼šç”¨æ¥ç”Ÿæˆgolangçš„åè®®grpcå®šä¹‰çš„æ–‡ä»¶ï¼Œå¯ä»¥åœ¨<span class="exturl" data-url="aHR0cHM6Ly9ncnBjLmlvL2RvY3MvbGFuZ3VhZ2VzL2dvL3F1aWNrc3RhcnQv" title="https://grpc.io/docs/languages/go/quickstart/">grpc-goæ•™ç¨‹<i class="fa fa-external-link"></i></span>äº†è§£å¦‚ä½•ä¸‹è½½åŠç”Ÿæˆæ–‡ä»¶</li>
<li>makeï¼šé¡¹ç›®é‡Œç”¨äº†Makefileï¼Œå› æ­¤éœ€è¦æ”¯æŒmakeã€‚Makefileé‡ŒåŒ…å«äº†æ–‡ä»¶ç”Ÿæˆï¼ˆprotoï¼‰ä»¥åŠæœåŠ¡å™¨äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆï¼ˆserverï¼‰çš„æŒ‡ä»¤</li>
</ul>
<p>æ•´ä¸ªé¡¹ç›®çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<p><img src="/uploads/codegallery/protobuf_grpc_starter/structure.png" alt="protobuf_grpc_starter"></p>
<p>è¦ä½“éªŒé¡¹ç›®ï¼Œå®‰è£…ç›¸å…³prerequisitiesä¹‹åï¼Œæ‰§è¡Œmakeç¼–è¯‘ç”Ÿæˆåè®®goæ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆwebsvrä¸cachesvrçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å…ˆæ‰§è¡Œcachesvrï¼Œå†æ‰§è¡Œwebsvrï¼Œè€Œåç”¨æˆ·å¯ä»¥é€šè¿‡http clientå‘websvrå‘é€è¯·æ±‚æ¥è§‚å¯Ÿä¸¤ä¸ªæœåŠ¡çš„æ—¥å¿—åŠçŠ¶æ€ã€‚websvrçš„httpæœåŠ¡å™¨é‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dpbi1nb25pYy9naW4=" title="https://github.com/gin-gonic/gin">gin<i class="fa fa-external-link"></i></span>æ¡†æ¶ï¼Œé€šè¿‡<code>main.go</code>æºç å¯ä»¥ç›´æ¥æŸ¥é˜…æ¯ä¸ªè·¯ç”±å¯¹åº”çš„handlerä»¥åŠå†…éƒ¨é€»è¾‘ã€‚åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œé’ˆå¯¹ç”¨æˆ·è§’åº¦çš„ç”¨ä¾‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>postæ–‡æœ¬ï¼ˆdocumentï¼‰ï¼šwebsvrä¼šç›´æ¥å°è¯•å°†æ–‡æœ¬å­˜å‚¨åˆ°DBï¼ˆè¿½åŠ åˆ°æ–‡ä»¶ï¼‰ä¸­ï¼Œå¦‚æœæˆåŠŸåˆ™è¿”å›ä¸€ä¸ªçŸ­é“¾æ¥shortLink</li>
<li>æŸ¥è¯¢document(s)ï¼šåˆ†ä¸¤ç§æƒ…å†µ<ul>
<li>ä¸åŒ…å«shortLinkï¼šå–å‡ºDBæ–‡ä»¶æ‰€æœ‰å†…å®¹ï¼Œéå†æŸ¥è¯¢æ‰€æœ‰ç¬¦åˆqueryçš„documentï¼Œè¿”å›ä¸€ä¸ªdocumentåˆ—è¡¨</li>
<li>åŒ…å«shortLink<ul>
<li>è°ƒç”¨CacheSvrçš„GetDocumentå‡½æ•°å°è¯•è·å–ç¼“å­˜çš„documentã€‚å¦‚æœæˆåŠŸï¼Œç›´æ¥è¿”å›è¿™ä¸ªdocument</li>
<li>å¦‚æœä¸æˆåŠŸï¼Œåˆ™å–å‡ºDBæ–‡ä»¶æ‰€æœ‰å†…å®¹ï¼Œéå†æŸ¥è¯¢ï¼Œç›´åˆ°æœ‰åŒ…å«è¯¥shortLinkçš„documentä¸ºæ­¢</li>
<li>å¦‚æœæ‰¾åˆ°äº†ï¼Œè°ƒç”¨CacheSvrçš„SetDocumentå°†è¿™ä¸ªdocumentè®¾ç½®åˆ°ç¼“å­˜é‡Œï¼Œç„¶åè¿”å›è¿™ä¸ªdocumentã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±è¿”å›é”™è¯¯</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>WebSvrå’ŒCacheSvrä¹‹é—´çš„grpcè¿æ¥ï¼Œå‚ç…§äº†grpc-goä¸­çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dycGMvZ3JwYy1nby9ibG9iL21hc3Rlci9leGFtcGxlcy9mZWF0dXJlcy9rZWVwYWxpdmU=" title="https://github.com/grpc/grpc-go/blob/master/examples/features/keepalive">èŒƒä¾‹<i class="fa fa-external-link"></i></span>ä¿æŒäº†é•¿è¿æ¥çŠ¶æ€ã€‚è°ƒç”¨CacheSvrå‡½æ•°çš„è¿‡ç¨‹ï¼Œä¹Ÿä¾¿æ˜¯protobuf+grpcé€šä¿¡çš„è¿‡ç¨‹ã€‚æ›´å¤šçš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9wcm90b2J1Zi1ncnBjLXN0YXJ0ZXI=" title="https://github.com/utmhikari/protobuf-grpc-starter">protobuf-grpc-starterçš„github<i class="fa fa-external-link"></i></span>æ·±å…¥æŒ–æ˜ã€‚</p>
<p>ç¬¬ä¸€æ¬¡è¸©å‘è¿™å—çš„å†…å®¹ï¼Œçº¯å±æŠ›ç –å¼•ç‰ï¼Œæœ‰ç–æ¼ä¹‹å¤„ï¼Œè¿˜éœ€è§è°…~</p>
]]></content>
      <categories>
        <category>ä»£ç è‰ºå»Š</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>protobuf</tag>
        <tag>grpc</tag>
        <tag>gin</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ¸¸æˆç­–åˆ’è¡¨æ ¼æ£€æŸ¥å·¥å…·çš„ä¸€ç§è§£å†³æ–¹æ¡ˆ</title>
    <url>/2021/03/06/testlife/table_check/</url>
    <content><![CDATA[<p>ç­–åˆ’è¡¨æ ¼æ•°æ®æ£€æŸ¥æ˜¯æ¸¸æˆæµ‹è¯•å·¥ä½œçš„åˆšæ€§éœ€æ±‚ã€‚åœ¨æ¸¸æˆå¼€å‘æœŸä¸­ï¼Œæœ‰å¤§é‡bugçš„èµ·å› æ˜¯ç­–åˆ’åŒå­¦åœ¨é…ç½®ä¸Šä¸å¤Ÿè§„èŒƒåˆ°ä½ã€‚å› æ­¤ä½œä¸ºæµ‹è¯•è§’åº¦è€Œè¨€ï¼Œéœ€è¦æ›´åŠ ä¾¿æ·ã€æ›´åŠ ç²¾å‡†çš„æ–¹æ³•å»å®šä½åˆ°ç­–åˆ’è¡¨æ ¼é…ç½®çš„é—®é¢˜ã€‚é™¤äº†ä¾é ä¸šåŠ¡äººå‘˜è‡ªèº«å¯¹ä¸šåŠ¡çš„ç†Ÿæ‚‰ç¨‹åº¦ä¹‹å¤–ï¼Œä¹Ÿæ›´åŠ ä¾èµ–äºä¸€ä¸ªå¼ºå¤§æœ‰åŠ›çš„å·¥å…·ï¼Œè¾…åŠ©è¡¨æ ¼æ•°æ®æ£€æŸ¥ã€‚</p>
<p>è¡¨æ ¼æ•°æ®æ£€æŸ¥çš„ç›®çš„æœ‰ä»¥ä¸‹ä¸€äº›ï¼šç»™å®šæŸä¸ªæ•°å€¼ç­–åˆ’æ¡ˆï¼Œæ£€æŸ¥å®é™…é…ç½®ä¸ç­–åˆ’æ¡ˆæ˜¯å¦æœ‰å‡ºå…¥ï¼›ç»™å®šæŸä¸ªé…ç½®è§„åˆ™ï¼Œæ£€æŸ¥å®é™…é…ç½®æ˜¯å¦æœ‰ä¸ç¬¦åˆè§„åˆ™ï¼Œé€ æˆé£é™©çš„åœ°æ–¹ï¼ˆé™¤å»ç¨‹åºå¯¼è¡¨æ£€æŸ¥çš„é‚£ä¸€éƒ¨åˆ†ï¼‰ã€‚é’ˆå¯¹è¿™äº›éœ€æ±‚ï¼Œç®€å•ç²—æš´çš„æ–¹æ³•å°±æ˜¯å¼ºè¡Œcodingçš„æ–¹å¼ï¼Œå°†è¯»å–è¡¨æ ¼ï¼ˆExcelï¼‰æ•°æ®å‡ºæ¥ï¼ˆæˆ–è€…å°†è¡¨æ ¼æ•°æ®è½¬åŒ–ä¸ºç¨‹åºæ–‡ä»¶ï¼‰ï¼Œç„¶åç”¨ç¼–ç çš„æ–¹å¼è”è¡¨ï¼Œç»§è€Œé€šè¿‡codingé€»è¾‘ï¼Œå»å¯¼å‡ºä¸ç¬¦åˆè§„åˆ™çš„æ•°æ®ã€‚è¿™ä¸€ç§æ–¹å¼è™½ç„¶çµæ´»ï¼Œä½†å¯¹äºä¸šåŠ¡ä¾§åŒå­¦ï¼Œè¿˜å­˜åœ¨å£å’ä»¥åŠéœ€è¦çªç ´çš„åœ°æ–¹ï¼š</p>
<ul>
<li>å£å’ï¼šä¸šåŠ¡ä¾§åŒå­¦çš„æŠ€æœ¯èƒ½åŠ›ï¼Œé€šå¸¸éš¾ä»¥holdä½codingçš„æŠ€å·§ã€‚ä»æŠ€æœ¯äººå‘˜è§’åº¦è€Œè¨€ï¼Œæ¶µç›–å¤§é‡ä»£ç çš„è‡ƒè‚¿çš„è¡¨æ ¼æ£€æŸ¥è§„åˆ™ï¼Œå¯è¯»æ€§å¾ˆå·®ä¸”éš¾ä»¥ç»´æŠ¤ã€‚</li>
<li>çªç ´ï¼šç›¸è¾ƒäºäººè‚‰æ£€æŸ¥è¡¨æ ¼æ•°æ®è€Œè¨€ï¼Œæ—¶é—´çš„æ¶ˆè€—ä¸»è¦åœ¨â€œè”è¡¨â€è¿™ä¸€æ“ä½œä¸Šé¢ã€‚æ¸¸æˆå†…éƒ¨é€»è¾‘ç›¸å¯¹å¤æ‚ï¼Œç­–åˆ’è¡¨ä¹‹é—´çš„æ•°æ®ä¹Ÿæ˜¯ç´§å¯†è€¦åˆï¼Œæ¯”å¦‚ä¸€ä¸ªå®ç®±æŠ½å–ï¼Œå°±æœ‰å¯èƒ½æ¶‰åŠ4~5ä¸ªè¡¨çš„ç›¸äº’å…³ç³»ã€‚å¦‚æœä¸èƒ½å¤Ÿè§£å†³è”è¡¨è€—æ—¶çš„é—®é¢˜ï¼Œè¡¨æ ¼æ•°æ®æ£€æŸ¥çš„æ•ˆç‡ä¼šå¤§æ‰“æŠ˜æ‰£ã€‚</li>
</ul>
<p>å› æ­¤æ€»ä½“æ¥çœ‹ï¼Œé™¤äº†é‡‡ç”¨codingè¿™ä¸€å¤‡é€‰æ–¹æ¡ˆä¹‹å¤–ï¼Œå¦å¤–ä¸€ä¸ªè¾ƒå¥½çš„æ–¹æ³•æ˜¯é‡‡ç”¨å£°æ˜å¼ã€é…ç½®åŒ–çš„æ–¹å¼æè¿°è¡¨æ ¼æ£€æŸ¥è§„åˆ™ï¼Œé€šè¿‡ä¸€ç³»åˆ—æ•°æ®å¤„ç†è§„åˆ™çš„ä¸²è”ï¼Œå¯¼å‡ºæ¥ä¸€ä»½æœ€ç»ˆæ•°æ®ã€‚è¿™æ ·ä¸€æ¥ç›¸å¯¹å‡å°‘äº†å­¦ä¹ æˆæœ¬ï¼Œä»ä¸šåŠ¡ä¾§è§’åº¦è€Œè¨€ï¼Œä»â€œå­¦ä¹ codingâ€å˜æˆäº†â€œç†è§£é…ç½®â€ï¼›äºŒæ¥è§£å†³äº†è”è¡¨æ•ˆç‡çš„é—®é¢˜ï¼Œä¸šåŠ¡ä¾§åªéœ€è¦æè¿°ä¸€ä¸ªè”è¡¨çš„æ•°æ®å¤„ç†è§„åˆ™ï¼Œåå°å°±å¯ä»¥è‡ªåŠ¨æŒ‰ç…§è§„åˆ™æè¿°çš„æ–¹å¼å¯¹æ•°æ®å¤„ç†ï¼Œæœ€ç»ˆå‘ˆç°åˆ°ä¸šåŠ¡çš„ï¼Œç›´æˆªäº†å½“ï¼Œå°±æ˜¯æœ€ç»ˆçš„ç»“æœï¼›ä¸‰æ¥è§£å†³äº†æ ¹æœ¬ç›®çš„ï¼Œä¸è®ºæ˜¯ç­–åˆ’æ¡ˆæ¯”å¯¹ï¼ˆé€šå¸¸æ˜¯å¦å¤–çš„æ–‡æ¡£ï¼Œä¸èƒ½æŒ‰ç‰ˆæœ¬diffï¼‰è¿˜æ˜¯æ£€ç´¢ä¸åˆè§„çš„æ•°æ®ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯æ•°æ®å¯¼å‡ºï¼Œå› æ­¤ç”¨æ•°æ®å¤„ç†è§„åˆ™çš„ä¸²è”ï¼Œå°±èƒ½è§£å†³å¤§éƒ¨åˆ†çš„éœ€æ±‚ã€‚</p>
<a id="more"></a>
<p>äº†è§£mongodbçš„åŒå­¦ï¼Œå¤šå¤šå°‘å°‘éƒ½ä¼šå¬è¯´åˆ°<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9jb3JlL2FnZ3JlZ2F0aW9uLXBpcGVsaW5lLw==" title="https://docs.mongodb.com/manual/core/aggregation-pipeline/">mongodbèšåˆ<i class="fa fa-external-link"></i></span>ï¼Œäº¦å³æ•°æ®å¤„ç†æµæ°´çº¿ã€‚åœ¨mongodbä¸­ï¼Œå¦‚æœéœ€è¦å®ç°å¤æ‚çš„æ•°æ®æŸ¥è¯¢éœ€æ±‚ï¼Œå°±éœ€è¦ç”¨åˆ°èšåˆçš„æ–¹å¼ï¼Œå®šä¹‰å¤šä¸ªæµæ°´çº¿è§„åˆ™ï¼Œæ¯”å¦‚è¿‡æ»¤æŸ¥è¯¢ã€æ’åºã€groupã€lookupã€å­—æ®µå€¼è½¬åŒ–ã€å­—æ®µå€¼è®¡ç®—ç­‰ï¼Œå»å‘ˆç°æœ€ç»ˆçš„æ•°æ®å½¢å¼ã€‚è¿™ç§æ•°æ®æŸ¥è¯¢çš„å®ç°æ–¹å¼ï¼Œä¸è¡¨æ ¼æ£€æŸ¥çš„éœ€æ±‚ä¸è°‹è€Œåˆï¼Œå› æ­¤ç¬”è€…åœ¨å®è·µä¸­ï¼Œä¹Ÿæœæ–­å€Ÿé‰´mongodbçš„æ€è·¯ï¼Œå®ç°äº†å¯¼è¡¨ã€è”è¡¨ã€è½¬åŒ–å­—æ®µã€åˆ—è¡¨å±•å¼€ç­‰å¤šç§æ•°æ®å¤„ç†è§„åˆ™ï¼Œå¹¶ä¸”ç ”å‘äº†Webå‰ç«¯ç•Œé¢æ–¹ä¾¿å®ç°ç®€å•çš„é…ç½®ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸šåŠ¡æµ‹è¯•åŒå­¦ä¹Ÿåªéœ€è¦æŒ‰ç…§ç»™å®šçš„è§„åˆ™é…ç½®æ–¹æ³•ï¼Œé…ç½®æµæ°´çº¿è§„åˆ™ï¼Œå°±èƒ½è·å¾—æœ€ç»ˆæƒ³è¦çš„æ•°æ®ã€‚</p>
<p>ç°åœ¨å‰©ä¸‹çš„é—®é¢˜æ˜¯ï¼ŒåŸç”Ÿçš„è¡¨æ ¼æ•°æ®ä»ä½•è€Œæ¥ï¼Ÿå¦‚ä½•ç®¡ç†ï¼Ÿé’ˆå¯¹è¿™ç‚¹è¿˜æ˜¯éœ€è¦ä»ç”¨æˆ·çš„è§’åº¦å‡ºå‘ã€‚ç”¨æˆ·ä¾§æ‰€å…³å¿ƒçš„å†…å®¹æ— éåªæœ‰è¿™ä¹ˆå‡ ä¸ªï¼šæˆ‘ç”¨ä»€ä¹ˆæ ·çš„å¯¼è¡¨è§„åˆ™ï¼Œéœ€è¦åœ¨ä»€ä¹ˆç‰ˆæœ¬çš„ç­–åˆ’è¡¨ï¼Œå¯¼å‡ºä»€ä¹ˆæ ·çš„æ•°æ®ã€‚å› æ­¤ï¼Œå½“ç”¨æˆ·æäº¤åˆ°è¡¨è§„åˆ™ä¸ç­–åˆ’è¡¨ç‰ˆæœ¬çš„ä¹‹åï¼Œç¨‹åºåå°å°±éœ€è¦è‡ªåŠ¨æ‰§è¡Œç›¸åº”çš„è¡Œä¸ºï¼šæ›´æ–°è¡¨æ ¼åˆ°å¯¹åº”çš„ç‰ˆæœ¬-&gt;é€šè¿‡è„šæœ¬å»Archiveè¡¨æ ¼æ•°æ®ä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„-&gt;é€šè¿‡ä¸€ç³»åˆ—æ•°æ®å¤„ç†è§„åˆ™åŠ å·¥æ•°æ®-&gt;å°†æ•°æ®è½¬åŒ–ä¸ºç”¨æˆ·å‹å¥½çš„å½¢å¼å‘ˆç°ã€‚åœ¨ç¬”è€…çš„æ–¹æ¡ˆä¸­ï¼Œåšäº†è¿™ä¹ˆå‡ ä»¶äº‹æƒ…å»è§£å†³è¿™äº›é—®é¢˜ï¼š</p>
<ul>
<li>å®ç°ä¸€å¥—ç­–åˆ’æ•°æ®ä»“åº“ç®¡ç†ç³»ç»Ÿï¼Œç®¡ç†åŒæ—¶å­˜åœ¨çš„å¤šä¸ªç­–åˆ’è¡¨ä»“åº“ï¼Œå…·ä½“å½¢å¼å’Œç¬”è€…å®ç°çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9yZXBvbWFzdGVy" title="https://github.com/utmhikari/repomaster">repomaster<i class="fa fa-external-link"></i></span>ç±»ä¼¼ï¼Œä»“åº“çš„å…ƒæ•°æ®å­˜åœ¨å†…å­˜/ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”æ”¯æŒåŠ è½½è‡ªå®šä¹‰å¯¼å‡ºæ•°æ®è„šæœ¬çš„æ–¹å¼å¯¼å‡ºç­–åˆ’é…ç½®æ•°æ®ã€‚æ•°æ®ä»“åº“ç®¡ç†æ¨¡å—éœ€è¦ä¸æ•°æ®å¤„ç†æ¨¡å—åˆ†ç¦»ï¼Œå°¤å…¶æ˜¯ä»“åº“è¿‡å¤§ï¼Œæ¯æ¬¡æ›´æ–°ä»“åº“ä¼šå ç”¨è¾ƒå¤šèµ„æºï¼Œä¸åˆ†ç¦»çš„è¯ä¼šå½±å“æ•°æ®å¤„ç†çš„è¿›ç¨‹ã€‚æ•°æ®ä»“åº“ç®¡ç†ä¸æ•°æ®å¤„ç†æ¨¡å—ï¼Œé€šè¿‡å…±äº«ä»£ç /åè®®çš„æ–¹å¼ï¼Œå‡å°‘ä»£ç ç®¡ç†çš„æˆæœ¬ã€‚</li>
<li>åœ¨ç­–åˆ’æ•°æ®å¤„ç†å’Œæ•°æ®ä»“åº“ç®¡ç†ç³»ç»Ÿä¸­ï¼Œåˆ†åˆ«å®ç°ä¸€å¥—ç®€æ˜“çš„äº‹åŠ¡ç®¡ç†ç³»ç»Ÿã€‚é’ˆå¯¹æ¯ä¸€ä¸ªç”¨æˆ·çš„å¯¼è¡¨è¯·æ±‚ï¼Œæ•°æ®å¤„ç†æ¨¡å—ç”Ÿæˆä¸€ä¸ªåå°äº‹åŠ¡å•ç‹¬å¤„ç†ã€‚å¦‚æœéœ€è¦æ›´æ–°æ•°æ®ï¼Œå°±å‘é€è¯·æ±‚æ•°æ®ä»“åº“ç®¡ç†æ¨¡å—æ›´æ–°æ•°æ®ï¼Œæ•°æ®ä»“åº“ç®¡ç†æ¨¡å—ä¹Ÿç›¸åº”åœ°ç”Ÿæˆä¸€ä¸ªåå°äº‹åŠ¡ï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªä»“åº“æ›´æ–°/å¯¼å‡ºæ•°æ®ï¼Œå¹¶é€šçŸ¥æ•°æ®å¤„ç†ä¾§æ‹¿å–å¯¼å‡ºçš„æ•°æ®æ¥å¤„ç†ã€‚è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œå°±ç®—å‡ºç°å•ç‚¹æ•…éšœ/æ•°æ®æœªæˆåŠŸè·å–ç­‰æ„å¤–æƒ…å†µï¼Œä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚ä»ç»éªŒä¸Šçœ‹ï¼Œå¤§é‡çš„æ—¶é—´ç“¶é¢ˆä¸»è¦é›†ä¸­åœ¨æ›´æ–°ä»“åº“è¿™ä¸€è¿‡ç¨‹ä¸Šã€‚</li>
</ul>
<p>å®ç°äº†è¿™äº›ï¼ŒåŸºæœ¬ä¸Šä¸€ä¸ªè¡¨æ ¼æ£€æŸ¥å·¥å…·å°±æˆå‹äº†ã€‚å½“ç„¶ï¼Œè¡¨æ ¼æ£€æŸ¥é™¤äº†è¿™äº›éœ€æ±‚ä¹‹å¤–ï¼Œè¿˜æœ‰ç±»ä¼¼ä¸åŒç‰ˆæœ¬è¡¨æ ¼diffã€gitlogè¿½è¸ªä¸€ç±»çš„éœ€æ±‚ã€‚å› æ­¤è¿™ä¸€å—çš„ä¸šåŠ¡ï¼Œå¾…æŒ–æ˜çš„ç©ºé—´æ˜¯éå¸¸ä¸°å¯Œçš„ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>è¡¨æ ¼æ£€æŸ¥</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¸¸æˆå¼€å‘ã€‘ç”¨UE4çš„Subsystemæ¥ç®¡ç†DataTableè¡¨æ ¼æ•°æ®</title>
    <url>/2021/02/16/gamedev/ue4_datatable_subsystem/</url>
    <content><![CDATA[<p>åœ¨UE4æ¸¸æˆå¼€å‘ä¸­ï¼Œå®˜æ–¹æ–‡æ¡£æ¨èäº†2å¥—åŠŸèƒ½ï¼š<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vZW4tVVMvSW50ZXJhY3RpdmVFeHBlcmllbmNlcy9EYXRhRHJpdmVuL2luZGV4Lmh0bWw=" title="https://docs.unrealengine.com/en-US/InteractiveExperiences/DataDriven/index.html">Data Driven Gameplay Elements<i class="fa fa-external-link"></i></span>ä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vZW4tVVMvUHJvZ3JhbW1pbmdBbmRTY3JpcHRpbmcvU3Vic3lzdGVtcy9pbmRleC5odG1s" title="https://docs.unrealengine.com/en-US/ProgrammingAndScripting/Subsystems/index.html">Programming Subsystems<i class="fa fa-external-link"></i></span>ã€‚æˆ‘ä»¬å¯ä»¥ç»“åˆè¿™ä¸¤è€…çš„åŠŸæ•ˆï¼Œå®ç°ä¸€ä¸ªç®€å•çš„è¡¨æ ¼é…ç½®æ•°æ®ç®¡ç†æ¨¡å—ã€‚</p>
<p>Data Driven Gameplay Elementsè®²è¿°äº†ä¸€å¥—é€šè¿‡DataTableæ•°æ®è¡¨çš„asseté©±åŠ¨gameplayçš„æ–¹å¼ã€‚åœ¨C++ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é¢„å…ˆå®šä¹‰å¥½è¡¨ç»“æ„æ‰€å¯¹åº”çš„USTRUCTï¼Œç„¶åé€šè¿‡å¯¼å…¥CSVæ–‡ä»¶çš„æ–¹å¼ï¼Œå»åˆ›å»ºä»¥è¯¥USTRUCTä¸ºç»“æ„åŸºç¡€çš„DataTableã€‚è¿™æ ·åœ¨æ¸¸æˆé‡Œï¼Œå¦‚æœéœ€è¦è¯»å–é…ç½®æ•°æ®çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥åœ¨è“å›¾ä¸­æ·»åŠ è·å–DataTableä»¥åŠè·å–è¡Œæ•°æ®çš„èŠ‚ç‚¹ï¼Œå¡«å†™å¯¹åº”çš„assetè·¯å¾„ä¸rownameï¼ˆè¡¨æ ¼ä¸»é”®ï¼Œä»¥<code>---</code>ä¸ºæ ‡é¢˜çš„åˆ—ï¼‰ï¼Œå°±èƒ½å¤Ÿè·å¾—å¯¹åº”è¡Œçš„æ•°æ®äº†ã€‚æ³¨æ„è¿™ç§æ–¹å¼å¦‚æœåœ¨éœ€è¦çƒ­æ›´çš„æ‰‹æ¸¸ä¸­æ˜¯ä¸é€‚ç”¨çš„ï¼Œéœ€è¦ç”¨å…¶ä»–çš„æ–¹å¼ï¼ˆæ¯”å¦‚å°†è¡¨æ ¼é…ç½®è½¬åŒ–ä¸ºluaï¼‰</p>
<p>Programming Subsystemsè®²è¿°äº†UEçš„Subsystemç¼–ç¨‹æ¨¡å¼ã€‚Subsystemé‡ç‚¹è§£å†³äº†å•ä¾‹Manageråœ¨æ¸¸æˆä¸­ç”Ÿå‘½å‘¨æœŸçš„é—®é¢˜ï¼Œå¹¶ä¸”èƒ½å¤Ÿç›´æ¥å¯¼å‡ºæ–¹æ³•åˆ°è“å›¾ä¸­ï¼Œä¾›è“å›¾ä¾§è°ƒç”¨ã€‚å› æ­¤ï¼ŒSubsystemä¸€ä¸ªå¾ˆæ£’çš„ç”¨é€”ï¼Œå°±æ˜¯åˆ†æ‹…BlueprintFunctionLibraryçš„å·¥ä½œã€‚</p>
<p>ä»¥ä¸‹ï¼Œæˆ‘ä»¬è§‚å¯Ÿä¸€ä¸ªåˆ©ç”¨Subsystemæ¨¡å¼åœ¨C++ä¾§åˆ›å»ºä¸€ä¸ªDataTable Managerçš„åŠŸèƒ½å®ä¾‹ï¼š</p>
<a id="more"></a>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªTableSubsystemï¼Œä¾é™„äºGameInstanceçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä½œå‡ºå¦‚ä¸‹çº¦å®šï¼š</p>
<ul>
<li>åœ¨æ¸¸æˆå¼€å§‹æ—¶ï¼ŒåŠ è½½æ‰€æœ‰è¡¨æ ¼çš„æ•°æ®</li>
<li>è¡¨æ ¼æ•°æ®ç»Ÿä¸€å­˜å‚¨åœ¨<code>Content/Table</code>ä¸‹ï¼Œç”±UTF8-BOMçš„csvå¯¼å…¥ä¸ºDataTableï¼Œå‘½åæ ¼å¼ä¸º<code>TB_è¡¨å</code></li>
</ul>
<p>å› æ­¤å¯ä»¥ç®€å•å†™ä¸€ä¸ªç±»ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TableSubsystem.h</span></span><br><span class="line">UCLASS()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FOUNDERBOY_API</span> <span class="title">UTableSubsystem</span> :</span> <span class="keyword">public</span> UGameInstanceSubsystem</span><br><span class="line">&#123;</span><br><span class="line">    GENERATED_BODY()</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    TArray&lt;FString&gt; TableNames;</span><br><span class="line">    TMap&lt;FString, UDataTable*&gt; DB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Initialize</span><span class="params">(FSubsystemCollectionBase&amp; Collection)</span> override</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Deinitialize</span><span class="params">()</span> override</span>;</span><br><span class="line"></span><br><span class="line">    UFUNCTION(BlueprintCallable)</span><br><span class="line">        <span class="function">UDataTable* <span class="title">GetDataTable</span><span class="params">(<span class="keyword">const</span> FString&amp; TableName)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">FORCEINLINE FString <span class="title">GetTableAssetPath</span><span class="params">(<span class="keyword">const</span> FString&amp; TableName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> FString::Printf(TEXT(<span class="string">"DataTable'/Game/Table/TB_%s.TB_%s'"</span>), *TableName, *TableName);</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="function">UDataTable* <span class="title">LoadDataTableObj</span><span class="params">(<span class="keyword">const</span> FString&amp; TableName)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TableSubsystem.cpp</span></span><br><span class="line"><span class="keyword">void</span> UTableSubsystem::Initialize(FSubsystemCollectionBase&amp; Collection)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// init table data</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> load table data by cfg, not in hardcode stype</span></span><br><span class="line">    TableNames.Add(TEXT(<span class="string">"Monster"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> TableName : TableNames)</span><br><span class="line">    &#123;</span><br><span class="line">        UDataTable* DT = LoadDataTableObj(TableName);</span><br><span class="line">        <span class="keyword">if</span> (DT != <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            DB.Add(TableName, DT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> UTableSubsystem::Deinitialize()</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">UDataTable* UTableSubsystem::GetDataTable(<span class="keyword">const</span> FString&amp; TableName)</span><br><span class="line">&#123;</span><br><span class="line">    UDataTable** DT = DB.Find(TableName);</span><br><span class="line">    <span class="keyword">if</span> (DT == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *DT;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">UDataTable* UTableSubsystem::LoadDataTableObj(<span class="keyword">const</span> FString&amp; TableName)</span><br><span class="line">&#123;</span><br><span class="line">    FString AssetPath = GetTableAssetPath(TableName);</span><br><span class="line">    <span class="keyword">return</span> LoadObject&lt;UDataTable&gt;(<span class="literal">nullptr</span>, *AssetPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å‡è®¾å·²ç»å¯¼å…¥äº†ä¸€ä¸ªMonsterè¡¨ï¼Œå¹¶ä¸”å®šä¹‰äº†å¯¹åº”çš„USTRUCTã€‚ç¼–è¯‘å®Œæˆä¹‹åï¼Œå°±å¯ä»¥åœ¨è“å›¾ä¸­ä½¿ç”¨<code>GetDataTable</code>èŠ‚ç‚¹è·å–å·²ç»åŠ è½½çš„è¡¨æ ¼æ•°æ®äº†ï¼š</p>
<p><img src="/uploads/gamedev/ue4_datatable_subsystem/bp.png" alt="è·å–è¡¨æ ¼æ•°æ®" title="&#39;è·å–è¡¨æ ¼æ•°æ®&#39;"></p>
<p>å¼€å‘çš„æ—¶å€™ï¼Œæ‰€æœ‰ç³»ç»Ÿçš„è¡¨æ ¼æ•°æ®æ£€ç´¢æ¥å£éƒ½å¯ä»¥å†™åœ¨TableSubsystemé‡Œã€‚åœ¨è“å›¾ä¸­å¦‚æœéœ€è¦æ£€ç´¢å„ä¸ªè¡¨æ ¼çš„æ•°æ®ï¼Œå°±å¯ä»¥ç»Ÿä¸€è°ƒç”¨TableSubsystemçš„æ¥å£äº†ã€‚</p>
]]></content>
      <categories>
        <category>æ¸¸æˆå¼€å‘</category>
      </categories>
      <tags>
        <tag>UE4</tag>
        <tag>C++</tag>
        <tag>DataTable</tag>
        <tag>Subsystem</tag>
        <tag>æ¸¸æˆå¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»£ç è‰ºå»Šã€‘start-fastapiå‡çº§ï¼Œå¯¹FastAPIåº”ç”¨å¼€å‘çš„å…¨æ–°ç†è§£</title>
    <url>/2021/01/24/codegallery/start_fastapi/</url>
    <content><![CDATA[<p>2021ï¼Œæ–°çš„å¼€å§‹ï¼Œæ›¾ç»ç²¾å¿ƒåˆ¶ä½œçš„è½»é‡çº§webåç«¯æ¡†æ¶<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9zdGFydC1mYXN0YXBp" title="https://github.com/utmhikari/start-fastapi">start-fastapi<i class="fa fa-external-link"></i></span>ä¹Ÿç»å†äº†ä¸€æ¬¡å‡çº§ã€‚è¿™æ¬¡å‡çº§ï¼Œæ˜¯åŸºäºè¿™ä¸€å¹´æ¥ä½¿ç”¨start-fastapiå¼€å‘ä»¥åŠåº”ç”¨ä¸ä¸šåŠ¡å·¥ä½œçš„ç»éªŒï¼Œå¯¹å·²æœ‰æ¡†æ¶è¿›è¡Œçš„ç»“æ„æ€§çš„ä¼˜åŒ–ã€‚</p>
<p>start-fastapiï¼Œç”šè‡³æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9mYXN0YXBpLnRpYW5nb2xvLmNvbS8=" title="https://fastapi.tiangolo.com/">FastAPI<i class="fa fa-external-link"></i></span>æœ¬èº«ï¼Œå…¶ä¸“æ³¨çš„æ–¹é¢éƒ½æ˜¯åœ¨å¿«é€Ÿå®ç°è½»é‡çº§åº”ç”¨å½“ä¸­ã€‚åœ¨å‡çº§å2021ç‰ˆçš„ç»“æ„ä¸­ï¼Œé’ˆå¯¹å¦‚ä½•æ›´åŠ æ•ˆç‡åœ°ç»„æˆFastAPIåº”ç”¨ï¼Œä¸‹äº†å¾ˆå¤šæ‰‹ç¬”ã€‚æˆ‘ä»¬å¯ä»¥ä¸€æ¢ç©¶ç«Ÿï¼š</p>
<a id="more"></a>
<p>å‡çº§ç‰ˆstart-fastapiç¬¬ä¸€å±‚åªä¿ç•™äº†4ä¸ªç›®å½•ï¼šappã€cfgã€coreã€miscã€‚appç›®å½•å’Œcoreç›®å½•ï¼Œéƒ½åŒ…å«controller/handlerã€modelå’Œserviceï¼Œä½†åŒºåˆ«åœ¨äºï¼Œç”¨æˆ·éœ€è¦æŠŠé¡¹ç›®ä¸“æœ‰çš„é€»è¾‘æ”¾åˆ°appç›®å½•ä¸‹ï¼Œè€Œåœ¨coreä¸­ç¼–å†™åº•å±‚é€»è¾‘ï¼Œè¿™æ ·å¦‚æœè¦ç”¨start-fastapiç¼–å†™å¦å¤–ä¸€ä¸ªé¡¹ç›®ï¼Œé‚£ä¹ˆpythonä»£ç æ–¹é¢ï¼Œcoreæ•´ä¸ªéƒ½å¯ä»¥copyè¿‡å»ï¼Œå‡å°‘äº†é¡¹ç›®è¿ç§»çš„æˆæœ¬ã€‚<br>cfgä¸ºé…ç½®ç›®å½•ï¼Œå…¶äºŒå±‚ç›®å½•åç§°ä»£è¡¨ç€ä¸åŒçš„è¿è¡Œç¯å¢ƒï¼Œæ¯ä¸ªè¿è¡Œç¯å¢ƒä¸‹åŒ…å«ä¸€ç»„ç›¸åŒæ–‡ä»¶åçš„é…ç½®é›†ï¼Œè¿™æ ·èƒ½å¤Ÿæ˜“äºç®¡ç†å„ä¸ªç¯å¢ƒçš„é…ç½®ã€‚æ‰€æœ‰éƒ¨ç½²ã€æ–‡æ¡£ã€å¼€å‘èµ„æºç­‰å†…å®¹ï¼Œç»Ÿä¸€æ”¾åˆ°miscç›®å½•ä¸‹ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è®©å¼€å‘è€…æ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„ç¼–å†™ä¸Šã€‚</p>
<p>é™¤äº†ç›®å½•æ–¹é¢çš„æ”¹åŠ¨ä¹‹å¤–ï¼Œä¹Ÿå¢åŠ äº†å¦‚ä¸‹å†…å®¹ï¼Œè®©ç”¨æˆ·æ›´åŠ æ–¹ä¾¿åœ°ç»„æˆå„ç±»é€»è¾‘ï¼š</p>
<ul>
<li>å¢åŠ responseçš„åŸºç±»ã€å†…éƒ¨é€šç”¨è¿”å›å€¼çš„ç±»å‹å®šä¹‰ï¼ˆsuccess, message, dataï¼‰ã€‚å®ç°æŸäº›é€šç”¨æ¥å£çš„æ—¶å€™ï¼Œè¿™äº›æ•°æ®ç»“æ„å°±èƒ½æ´¾ä¸Šç”¨åœº</li>
<li>æŠ½è±¡ä¸æ¡†æ¶ç›¸å…³çš„ï¼Œå’Œä¸€äº›ç»å¸¸ç”¨åˆ°çš„å·¥å…·å‡½æ•°ï¼Œç»Ÿä¸€æ”¾åˆ°coreçš„libä¸­ï¼Œè¿™æ ·ç¼–å†™ä¸šåŠ¡é€»è¾‘ï¼Œå°±æ²¡æœ‰å¿…è¦importä¸€å †ä¸œè¥¿äº†</li>
<li>å¢åŠ ä¸€ä¸ªäº‹åŠ¡æœåŠ¡çš„æ¨¡æ¿ï¼ˆtrans serviceï¼‰ï¼Œç”¨æ¥ç®¡ç†/ç›‘æ§å„ç±»éœ€è¦é€šè¿‡fastapiçš„background taskè¿è¡Œçš„ä»»åŠ¡ã€‚</li>
<li>å¢åŠ ä¸€ä¸ªç”Ÿæˆhandlerã€modelã€serviceä»£ç æ¨¡æ¿çš„è„šæœ¬ï¼Œå®ç°å¿«é€Ÿç¼–ç¨‹</li>
<li>etc</li>
</ul>
<p>æ›´å¤šçš„ç»†èŠ‚ï¼Œclone/forkæºç ï¼Œç»†ç»†æŒ–æ˜å§~</p>
]]></content>
      <categories>
        <category>ä»£ç è‰ºå»Š</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>python</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>fastapi</tag>
        <tag>start-fastapi</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»£ç è‰ºå»Šã€‘ä»£ç ä»“åº“ç®¡ç†å°å·¥å…·repomaster</title>
    <url>/2021/01/01/codegallery/repomaster/</url>
    <content><![CDATA[<p>å‘¼å¸ä¸åœï¼Œcodingä¸æ­¢ã€‚ä»£ç è‰ºå»Šæ–°ç³»åˆ—ï¼Œå°†è¦ç”¨æ¥é™ˆåˆ—è‡ªå·±çš„å¤§å°ä½œå“ï¼›æå®¢æ—¥å¸¸ç³»åˆ—ï¼Œåˆ™ä¸“é—¨ç”¨äºåˆ†äº«æ–°çš„æŠ€æœ¯å¿ƒå¾—ã€‚å¼€å¹´ç¬¬ä¸€ä½œï¼Œä»‹ç»ä¸€ä¸ªè‡ªåˆ¶ç”¨äºç®¡ç†ä»£ç ä»“åº“çš„å°å·¥å…·<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9yZXBvbWFzdGVy" title="https://github.com/utmhikari/repomaster">repomaster<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>ä»£ç ä»“åº“ç®¡ç†åœ¨è®¸å¤šåœºæ™¯èƒ½å¤Ÿç”¨åˆ°ï¼Œæ¯”å¦‚ç”¨ä½œæ„å»ºé›†ç¾¤çš„æ–‡ä»¶ç¼“å­˜ã€æ„å»ºé…ç½®çš„ä»£ç ä»“åº“æœåŠ¡ã€é…ç½®å¯¼å‡ºä¸æ£€æŸ¥ç­‰ç­‰ï¼Œå…¶ä¸­æœ€åä¸€ç§éœ€æ±‚åœ¨æ¸¸æˆQAçš„å·¥ä½œåœºæ™¯ï¼ˆå¯¼è¡¨æ£€æŸ¥ï¼‰ä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„éœ€æ±‚ï¼Œè€Œrepomasterçš„è®¾è®¡æ–¹å¼ä¹Ÿä¼šæ›´åŠ è´´åˆç®¡ç†å¤§é‡åŒä¸€ä¸ªrepoä¸åŒcheckoutå‰¯æœ¬çš„æƒ…å†µã€‚ä½œä¸ºä¸€ä¸ªçº¯é å†…å­˜ä½œä¸ºç¼“å­˜ï¼Œæ— éœ€æŒä¹…åŒ–æ•°æ®çš„åº”ç”¨ï¼Œrepomasteråœ¨æŠ€æœ¯é€‰å‹ä¸Šï¼ŒGolangä¸€å®šæ˜¯æœ€åˆé€‚çš„è¯­è¨€ï¼ˆå…±äº«å†…å­˜+æ–¹ä¾¿çš„å¹¶å‘æ§åˆ¶ï¼‰ã€‚åªéœ€è¦å°‘é‡çš„ä»£ç ï¼Œå°±èƒ½å¤Ÿæ­èµ·æ¥æ¶å­ã€‚</p>
<p>å½“å‰çš„repomasterå·²ç»å…·å¤‡å¦‚ä¸‹çš„åŠŸèƒ½ï¼š</p>
<a id="more"></a>
<ul>
<li>ä»£ç ä»“åº“ç¼“å­˜ä¸åˆ·æ–°ï¼šç”¨<span class="exturl" data-url="aHR0cHM6Ly9nb2xhbmcub3JnL3NyYy9zeW5jL21hcC5nbw==" title="https://golang.org/src/sync/map.go">sync.Map<i class="fa fa-external-link"></i></span>å°±èƒ½å¤Ÿç®€å•å¤„ç†ã€‚æ¯ä¸€ä¸ªä»“åº“éƒ½cloneåˆ°ç‰¹å®šæ•°å­—æ–‡ä»¶å¤¹å½“ä¸­ï¼Œä»¥æ–‡ä»¶å¤¹åçš„æ•°å­—ä½œä¸ºkeyæ¥å­˜å‚¨æ¯ä¸€ä¸ªrepoä¿¡æ¯</li>
<li>ä»£ç ä»“åº“çš„æ‹‰å–ã€æ›´æ–°ã€å®¹é”™å¤„ç†ï¼šå½“å‰æ”¯æŒgitï¼Œä»¥<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvLWdpdC9nby1naXQ=" title="https://github.com/go-git/go-git">go-git<i class="fa fa-external-link"></i></span>ä½œä¸ºä¸»è¦ç±»åº“å®ç°ã€‚ç”±äºgo-gitçš„å†…éƒ¨æ¥å£è¾ƒå¤æ‚ï¼Œå»ºè®®äºŒæ¬¡å¼€å‘å¢åŠ é‡‡ç”¨æ‰§è¡Œshell cmdçš„æ–¹å¼å…œåº•ã€‚</li>
<li>ä»£ç ä»“åº“æ–‡ä»¶ä¿¡æ¯å¯¼å‡º</li>
<li>é‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dpbi1nb25pYy9naW4=" title="https://github.com/gin-gonic/gin">gin<i class="fa fa-external-link"></i></span>ä½œä¸ºç½‘ç»œæ¡†æ¶ï¼Œç¨³å®šå¯¹å¤–æä¾›HTTPæœåŠ¡</li>
</ul>
<p>å½“å‰repomasterå·²ç»å®ç°äº†ç¼“å­˜ç®¡ç†åŠgitçš„æ”¯æŒï¼Œå¦‚æœæœ‰éœ€è¦é€‚é…ç‰¹å®šä¸šåŠ¡çš„éœ€æ±‚ï¼Œå¯ä»¥ç›´æ¥åœ¨repomasterçš„serviceä¸handleræ¨¡å—ä¸Šè¿›è¡Œæ‰©å±•ã€‚å½“å‰çš„å®ç°ä¹Ÿæœ‰å¾ˆå¤šä¼˜åŒ–æ‰©å±•çš„ç©ºé—´ï¼Œæœªæ¥çš„ç»´æŠ¤è®¡åˆ’ï¼Œä¹Ÿå¸Œæœ›æŠŠæ›´å¤šçš„Golangç‰¹æ€§åº”ç”¨åˆ°repomasterå½“ä¸­ã€‚</p>
]]></content>
      <categories>
        <category>ä»£ç è‰ºå»Š</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>å·¥å…·å¼€å‘</tag>
        <tag>gin</tag>
        <tag>git</tag>
        <tag>go-git</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘åœ¨UE4æ’ä»¶ä¸­å¯ç”¨Automationè‡ªåŠ¨åŒ–æµ‹è¯•åŠŸèƒ½</title>
    <url>/2020/12/20/testlife/ue4_automation/</url>
    <content><![CDATA[<p>UE4æœ¬èº«æ”¯æŒåœ¨å‰ç«¯ä¼šè¯ä¸­æ‰§è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•åŠŸèƒ½ã€‚æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨C++ç¼–å†™å¯¹åº”çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œåœ¨ç¼–è¾‘å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸­éšæ—¶éšåœ°è¿è¡Œï¼Œæµ‹è¯•æ•´ä¸ªç ”å‘ç³»ç»Ÿçš„å­åŠŸèƒ½ã€‚</p>
<p><img src="/uploads/testlife/ue4_automation/session_frontend.png" alt="ä¼šè¯å‰ç«¯" title="&#39;ä¼šè¯å‰ç«¯&#39;"></p>
<p>è¦æ·±å…¥äº†è§£UE4è‡ªå¸¦çš„è‡ªåŠ¨åŒ–æµ‹è¯•åŠŸèƒ½ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vemgtQ04vVGVzdGluZ0FuZE9wdGltaXphdGlvbi9BdXRvbWF0aW9uL2luZGV4Lmh0bWw=" title="https://docs.unrealengine.com/zh-CN/TestingAndOptimization/Automation/index.html">è‡ªåŠ¨åŒ–ç³»ç»Ÿæ¦‚è¿°<i class="fa fa-external-link"></i></span>æ–‡ç« ç³»åˆ—ã€‚è€Œæœ¬æ–‡åˆ™ä»‹ç»æœ€ç®€å•çš„æ¥å…¥UE4è‡ªå¸¦Automationè‡ªåŠ¨åŒ–æµ‹è¯•çš„æ–¹æ³•ï¼Œä»¥<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9VbnJlYWxBdXRvbWF0b3I=" title="https://github.com/utmhikari/UnrealAutomator">UnrealAutomator<i class="fa fa-external-link"></i></span>æ’ä»¶ä¸ºä¾‹ï¼Œæä¾›ä¸€ä¸ªæœ€å°çš„æ’ä»¶+Automationçš„èŒƒä¾‹</p>
<a id="more"></a>
<p>æŒ‰ç…§çº¦å®šï¼Œæ¯ä¸ªæ’ä»¶éœ€è¦åœ¨<code>Private/Tests</code>æ–‡ä»¶å¤¹ä¸‹ï¼Œå»ºç«‹<code>æ’ä»¶åRunTests.cpp</code>ï¼Œä½œä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•çš„å…¥å£ã€‚</p>
<p>ç„¶åï¼Œé€šè¿‡å®æ³¨å†Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç±»ï¼Œå¹¶å®ç°å…¶<code>RunTest</code>å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">IMPLEMENT_SIMPLE_AUTOMATION_TEST(FUnrealAutomatorWidgetTest, <span class="string">"UnrealAutomator.Widget"</span>, EAutomationTestFlags::EditorContext | EAutomationTestFlags::EngineFilter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> FUnrealAutomatorWidgetTest::RunTest(<span class="keyword">const</span> FString&amp; Parameters)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æŸ¥çœ‹å½“å‰æ˜¯å¦å­˜åœ¨UWidget</span></span><br><span class="line">    UE_LOG(LogUnrealAutomator, Log, TEXT(<span class="string">"Start UA Widget Test..."</span>));</span><br><span class="line">    <span class="keyword">auto</span> WidgetJson = FUIService::GetWidgetTreeJson();</span><br><span class="line">    <span class="keyword">auto</span> WidgetJsonString = FCommonUtil::JsonStringify(WidgetJson);</span><br><span class="line">    UE_LOG(LogUnrealAutomator, Log, TEXT(<span class="string">"Current widget: %s"</span>), *WidgetJsonString);</span><br><span class="line">    TSharedPtr&lt;FJsonObject&gt; DefaultJsonObj = MakeShareable(<span class="keyword">new</span> FJsonObject());</span><br><span class="line">    <span class="keyword">return</span> !WidgetJsonString.IsEmpty() &amp;&amp;</span><br><span class="line">        !WidgetJsonString.Equals(FCommonUtil::JsonStringify(DefaultJsonObj));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼–è¯‘ï¼Œé‡å¯ç¼–è¾‘å™¨ï¼Œæ‰“å¼€ä¼šè¯å‰ç«¯çš„è‡ªåŠ¨åŒ–æµ‹è¯•é¡µç­¾ï¼Œå°±èƒ½å¤Ÿçœ‹åˆ°è¯¥æµ‹è¯•ç”¨ä¾‹äº†ï¼š<code>UnrealAutomator.Widget</code>ã€‚</p>
<p>åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€æ¸¸æˆï¼Œæ‰§è¡Œè¯¥æµ‹è¯•ç”¨ä¾‹ï¼Œå°±èƒ½å¤Ÿåˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨UWidgetäº†ã€‚</p>
<p>è¿™æ˜¯æœ€ç®€å•çš„ä¸€ç§è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ›´ä¸ºå¤æ‚çš„é€»è¾‘ä¸æµ‹è¯•æœºåˆ¶å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vemgtQ04vVGVzdGluZ0FuZE9wdGltaXphdGlvbi9BdXRvbWF0aW9uL1RlY2huaWNhbEd1aWRlL2luZGV4Lmh0bWw=" title="https://docs.unrealengine.com/zh-CN/TestingAndOptimization/Automation/TechnicalGuide/index.html">è‡ªåŠ¨åŒ–æŠ€æœ¯æŒ‡å—<i class="fa fa-external-link"></i></span>ä»¥åŠå‘¨è¾¹æ–‡ç« ã€‚åç»­çš„æµ‹è¯•æ–¹å¼ï¼Œè¿˜è¦æ…¢æ…¢ç ”ç©¶~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>UE4</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>UE4æ’ä»¶</tag>
        <tag>UE4 Automation</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘pythonè½»é‡çº§æ¶ˆæ¯é˜Ÿåˆ—åº“celeryçš„åº”ç”¨</title>
    <url>/2020/11/29/pythonnotes/celery/</url>
    <content><![CDATA[<p>pythonè¯­è¨€ï¼Œä¸€èˆ¬é€‚ç”¨äºå¿«é€Ÿå®ç°ä¸šåŠ¡éœ€æ±‚çš„ç”¨é€”ï¼Œåœ¨å¤§å‹æ¶æ„æ–¹é¢å…¶åº”ç”¨èŒƒå›´å¹¶æ²¡æœ‰Javaã€Golangä»¥åŠC++é‚£ä¹ˆä¸°å¯Œï¼Œå› æ­¤ç›¸å¯¹æ¥è®²è¿˜æ²¡æœ‰å½¢æˆéå¸¸ç»Ÿä¸€çš„æŠ€æœ¯ä½“ç³»ã€‚åœ¨æŸäº›éœ€æ±‚ä¸­å¯èƒ½éœ€è¦å¼€å‘å¤šä¸ªæœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´éœ€è¦å®ç°å¼‚æ­¥é€šä¿¡ï¼Œç”šè‡³æ˜¯è°ƒç”¨å¯¹æ–¹çš„å‡½æ•°ã€‚<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmNlbGVyeXByb2plY3Qub3JnL2VuL3N0YWJsZS8=" title="https://docs.celeryproject.org/en/stable/">celery<i class="fa fa-external-link"></i></span>å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä¾‹å­ï¼Œå®ƒæä¾›äº†ä»¥å°†pythonå‡½æ•°æ³¨å†Œåˆ°æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼æš´éœ²æœåŠ¡çš„æ–¹æ³•ï¼Œå¹¶ä¸”æ”¯æŒRabbitMQã€Redisç­‰å¤šç§Brokerä¸­é—´ä»£ç†å½¢å¼ã€‚</p>
<p>celeryåŒæ—¶ä¹Ÿæ”¯æŒå¤šä¸ªpythonçš„webæ¡†æ¶ï¼Œåœ¨å…¶<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmNlbGVyeXByb2plY3Qub3JnL2VuL3N0YWJsZS9nZXR0aW5nLXN0YXJ0ZWQvaW50cm9kdWN0aW9uLmh0bWw=" title="https://docs.celeryproject.org/en/stable/getting-started/introduction.html">ä»‹ç»é¡µ<i class="fa fa-external-link"></i></span>ä¸­ï¼Œä¹Ÿæ˜ç¡®è¯´æ˜äº†Tornadoã€Djangoã€web2pyç­‰æ¡†æ¶éƒ½æœ‰è‡ªå·±çš„celeryå®ç°æ–¹æ³•ï¼Œå½“ç„¶è¦çŸ¥é“å…¶ä»–æ¡†æ¶çš„å®è·µï¼Œå¯ä»¥ä¸Šgithubä¸Šæ¢æŸ¥ä¸€ç•ªã€‚</p>
<p>celeryç®€ä¾¿æ˜“ç”¨ï¼Œæœ¬æ–‡ç¬”è€…ä»¥è‡ªå·±æ•´ç†çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9zdGFydC1mYXN0YXBp" title="https://github.com/utmhikari/start-fastapi">start-fastapi<i class="fa fa-external-link"></i></span>ä¸ºä¾‹ï¼Œè®²è¿°æ¥å…¥celeryçš„æ–¹æ³•ã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆå…‹éš†start-fastapiï¼Œæ˜¯ç¬”è€…ç¨å¾®åŠ æ–™çš„ä¸€ä¸ªfastapiç‰ˆæœ¬ï¼Œä¸»è¦åœ¨fastapiåŸæœ¬åŸºç¡€ä¸Šå¯¹é…ç½®ä»¥åŠç›®å½•è¿›è¡Œäº†æ•´ç†ï¼Œå½¢æˆäº†ä¸€ä¸ªå¼€ç®±å³ç”¨çš„Webåç«¯æ¡†æ¶ã€‚ä»¥Redisä½œä¸ºbrokerä¸ºä¾‹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦<code>pip install celery[redis]</code>ï¼Œç„¶åå¯ä»¥åœ¨<code>service.celery</code>ä¸­æ–°å»ºä¸€ä¸ª<code>app.py</code>æ–‡ä»¶ï¼Œä½œä¸ºceleryçš„appå®ä¾‹ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> celery <span class="keyword">import</span> Celery</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">celery_app = Celery(<span class="string">'celery_tester'</span>,</span><br><span class="line">                    broker=<span class="string">'redis://:helloword@localhost:6379/0'</span>,</span><br><span class="line">                    backend=<span class="string">'redis://:helloword@localhost:6379/1'</span>)</span><br><span class="line"></span><br><span class="line">celery_app.conf.update(task_track_started=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>å¯¹äºæ•´ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œbrokerä»£ç†çš„ä¿¡æ¯ç¼“å­˜åœ¨DB0ä¸­ï¼Œè€Œbackendå­˜å‚¨æ¯ä¸€ä¸ªæ¶ˆæ¯trace infoï¼Œç¼“å­˜åœ¨DB1ä¸­ã€‚</p>
<p>ä¹‹ååœ¨<code>service.celery</code>æ–°å»º<code>worker.py</code>æ–‡ä»¶ï¼Œé‡Œé¢import appåï¼Œæ³¨å†Œå¾…æš´éœ²çš„å‡½æ•°ã€‚è¿™é‡Œçš„ä¾‹å­æ˜¯é€šè¿‡item_idå»¶è¿Ÿ3sè·å–itemçš„priceï¼Œ<code>get_item</code>æ–¹æ³•è·å–äº†item basemodelçš„å®ä¾‹ï¼Œé€šè¿‡è¿™ä¸ªå®ä¾‹å¯ä»¥æ‹¿åˆ°price</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> .app <span class="keyword">import</span> celery_app</span><br><span class="line"><span class="keyword">from</span> service <span class="keyword">import</span> item <span class="keyword">as</span> item_service</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@celery_app.task(acks_late=True)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_item_price</span><span class="params">(item_id: int)</span> -&gt; float:</span></span><br><span class="line">    item = item_service.get_item(item_id)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> item:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1.0</span></span><br><span class="line">    <span class="keyword">return</span> item.price</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†è®©è¿™ä¸ªå‡½æ•°èƒ½æš´éœ²å‡ºå»ï¼Œæˆ‘ä»¬éœ€è¦åº”ç”¨è¿™ä¸ªworkeræ–‡ä»¶çš„å†…å®¹ã€‚è¿›å…¥åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œå¦‚æœç”¨venvçš„è¯ï¼Œå…ˆ<code>source ./venv/bin/activate</code>ï¼Œç„¶åæ‰§è¡Œ<code>celery -A service.celery.worker worker -l info</code>ï¼Œå°±èƒ½å¤Ÿå¯åŠ¨celeryçš„workerï¼Œå¹¶ä¸”å¯ä»¥çœ‹åˆ°tasksä¸­æœ‰äº†<code>service.celery.worker.get_item_price</code></p>
<p>é€šè¿‡<code>ps -ef | grep python</code>ï¼Œæˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°fastapiåº”ç”¨è·Ÿcelery workerå¤„åœ¨ä¸åŒçš„è¿›ç¨‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">root         786       1  0 20:01 ?        00:00:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers</span><br><span class="line">root         874       1  0 20:01 ?        00:00:00 /usr/bin/python3 /usr/share/unattended-upgrades/unattended-upgrade-shutdown --wait-for-signal</span><br><span class="line">hikari      3934    3067  1 20:28 pts/0    00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/venv/bin/celery -A service.celery.worker worker -l info</span><br><span class="line">hikari      3936    3934  0 20:28 pts/0    00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/venv/bin/celery -A service.celery.worker worker -l info</span><br><span class="line">hikari      3937    3934  0 20:28 pts/0    00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/venv/bin/celery -A service.celery.worker worker -l info</span><br><span class="line">hikari      3938    3934  0 20:28 pts/0    00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/venv/bin/celery -A service.celery.worker worker -l info</span><br><span class="line">hikari      3939    3934  0 20:28 pts/0    00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/venv/bin/celery -A service.celery.worker worker -l info</span><br><span class="line">hikari      3940    3934  0 20:28 pts/0    00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/venv/bin/celery -A service.celery.worker worker -l info</span><br><span class="line">hikari      3941    3934  0 20:28 pts/0    00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/venv/bin/celery -A service.celery.worker worker -l info</span><br><span class="line">hikari      3954    2728 12 20:28 ?        00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python /home/hikari/PycharmProjects/celery_test/main.py</span><br><span class="line">hikari      3955    3954  0 20:28 ?        00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python -c from multiprocessing.resource_tracker import main;main(4)</span><br><span class="line">hikari      3956    3954  4 20:28 ?        00:00:00 /home/hikari/PycharmProjects/celery_test/venv/bin/python -c from multiprocessing.spawn import spawn_main; spawn_main(tracker_fd=5, pipe_handle=7) --multiprocessing-fork</span><br><span class="line">hikari      3968    3086  0 20:28 pts/1    00:00:00 grep --color=auto python</span><br></pre></td></tr></table></figure>
<p>äºæ˜¯ä¹ï¼Œæˆ‘ä»¬å¢åŠ ä¸€ä¸ªcontrollerï¼Œç”¨æ¥æµ‹è¯•celery workeræ˜¯å¦ç”Ÿæ•ˆã€‚controllerä¹Ÿå¼•ç”¨<code>service.celery.app</code>ï¼Œé€šè¿‡<code>send_task</code>æ‰§è¡Œ<code>service.celery.worker.get_item_price</code>ä»»åŠ¡ï¼Œä¼ å‚ä¸º1ï¼Œç„¶åå†æ‰“å°è¿”å›å€¼ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@router.get('/v1/test/celery')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_celery</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    test celery example</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    task = celery_app.send_task(<span class="string">'service.celery.worker.get_item_price'</span>, args=[<span class="number">1</span>])</span><br><span class="line">    LOGGER.info(<span class="string">'triggered celery task: %s'</span> % task)</span><br><span class="line">    print(task.get())</span><br><span class="line">    <span class="comment"># background_tasks.add_task(on_celery_message, task)</span></span><br><span class="line">    <span class="keyword">return</span> success(msg=<span class="string">'triggered celery test!'</span>)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡<code>curl http://127.0.0.1:8000/v1/test/celery</code>æ¥æµ‹è¯•è¿™ä¸ªæ¥å£ã€‚ç»“æœä¹Ÿå¾ˆæ˜¾ç„¶ï¼Œçº¦3sä¹‹åï¼Œfastapiç«¯æ‰“å°äº†è¿”å›å€¼åˆ°stdoutä¸­ï¼Œç„¶åcurlæ¥å£è¿”å›äº†successã€‚</p>
<p>ä¾‹å­å·²ç»ä¸Šä¼ åˆ°<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9mYXN0YXBpLWNlbGVyeS10ZXN0" title="https://github.com/utmhikari/fastapi-celery-test">fastapi-celery-test<i class="fa fa-external-link"></i></span>ä¸Šï¼ŒåŸºæœ¬æ“ä½œå°±ç³»ä»‹æ ·ï¼Œåé¢å†æ…¢æ…¢æ¢ç´¢æŠŠ~</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>start-fastapi</tag>
        <tag>webå¼€å‘</tag>
        <tag>celery</tag>
        <tag>æ¶ˆæ¯é˜Ÿåˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Pythonéšç¬”ã€‘pythonçš„os.walkæ–¹æ³•æºç åˆ†æ</title>
    <url>/2020/11/15/pythonnotes/python_os_walk/</url>
    <content><![CDATA[<p>åœ¨æ—¥å¸¸pythonç¼–ç¨‹ä¸­ï¼Œæœ‰å¾ˆå¤šéå†æ–‡ä»¶å¤¹å†…æ–‡ä»¶çš„éœ€æ±‚ï¼Œè€Œos.walkæ–¹æ³•å°±æ˜¯ä¸€ä¸ªæ»¡è¶³è¯¥éœ€æ±‚çš„ä¾‹å­ã€‚ä¸ç†Ÿæ‚‰è¿™ä¸ªæ–¹æ³•çš„åŒå­¦ï¼Œåˆšå¼€å§‹ç”¨os.walkçš„æ—¶å€™éš¾å…è¸©å‘ã€‚å› æ­¤æœ¬æ–‡é‡‡ç”¨æºç åˆ†æçš„æ–¹å¼ï¼Œè®²è¿°os.walkçš„æœºç†ï¼Œè®©å¤§å®¶å¯¹äºè¿™ä¸ªæ–¹æ³•æœ‰æ›´åŠ æ·±å…¥çš„ç†è§£ã€‚</p>
<p>ä»¥python3ä¸ºä¾‹ï¼Œos.walkæ–¹æ³•çš„æºç å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(top, topdown=True, onerror=None, followlinks=False)</span>:</span></span><br><span class="line">    <span class="string">"""Directory tree generator.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    For each directory in the directory tree rooted at top (including top</span></span><br><span class="line"><span class="string">    itself, but excluding '.' and '..'), yields a 3-tuple</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        dirpath, dirnames, filenames</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    dirpath is a string, the path to the directory.  dirnames is a list of</span></span><br><span class="line"><span class="string">    the names of the subdirectories in dirpath (excluding '.' and '..').</span></span><br><span class="line"><span class="string">    filenames is a list of the names of the non-directory files in dirpath.</span></span><br><span class="line"><span class="string">    Note that the names in the lists are just names, with no path components.</span></span><br><span class="line"><span class="string">    To get a full path (which begins with top) to a file or directory in</span></span><br><span class="line"><span class="string">    dirpath, do os.path.join(dirpath, name).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    If optional arg 'topdown' is true or not specified, the triple for a</span></span><br><span class="line"><span class="string">    directory is generated before the triples for any of its subdirectories</span></span><br><span class="line"><span class="string">    (directories are generated top down).  If topdown is false, the triple</span></span><br><span class="line"><span class="string">    for a directory is generated after the triples for all of its</span></span><br><span class="line"><span class="string">    subdirectories (directories are generated bottom up).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    When topdown is true, the caller can modify the dirnames list in-place</span></span><br><span class="line"><span class="string">    (e.g., via del or slice assignment), and walk will only recurse into the</span></span><br><span class="line"><span class="string">    subdirectories whose names remain in dirnames; this can be used to prune the</span></span><br><span class="line"><span class="string">    search, or to impose a specific order of visiting.  Modifying dirnames when</span></span><br><span class="line"><span class="string">    topdown is false has no effect on the behavior of os.walk(), since the</span></span><br><span class="line"><span class="string">    directories in dirnames have already been generated by the time dirnames</span></span><br><span class="line"><span class="string">    itself is generated. No matter the value of topdown, the list of</span></span><br><span class="line"><span class="string">    subdirectories is retrieved before the tuples for the directory and its</span></span><br><span class="line"><span class="string">    subdirectories are generated.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    By default errors from the os.scandir() call are ignored.  If</span></span><br><span class="line"><span class="string">    optional arg 'onerror' is specified, it should be a function; it</span></span><br><span class="line"><span class="string">    will be called with one argument, an OSError instance.  It can</span></span><br><span class="line"><span class="string">    report the error to continue with the walk, or raise the exception</span></span><br><span class="line"><span class="string">    to abort the walk.  Note that the filename is available as the</span></span><br><span class="line"><span class="string">    filename attribute of the exception object.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    By default, os.walk does not follow symbolic links to subdirectories on</span></span><br><span class="line"><span class="string">    systems that support them.  In order to get this functionality, set the</span></span><br><span class="line"><span class="string">    optional argument 'followlinks' to true.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Caution:  if you pass a relative pathname for top, don't change the</span></span><br><span class="line"><span class="string">    current working directory between resumptions of walk.  walk never</span></span><br><span class="line"><span class="string">    changes the current directory, and assumes that the client doesn't</span></span><br><span class="line"><span class="string">    either.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Example:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    import os</span></span><br><span class="line"><span class="string">    from os.path import join, getsize</span></span><br><span class="line"><span class="string">    for root, dirs, files in os.walk('python/Lib/email'):</span></span><br><span class="line"><span class="string">        print(root, "consumes", end="")</span></span><br><span class="line"><span class="string">        print(sum(getsize(join(root, name)) for name in files), end="")</span></span><br><span class="line"><span class="string">        print("bytes in", len(files), "non-directory files")</span></span><br><span class="line"><span class="string">        if 'CVS' in dirs:</span></span><br><span class="line"><span class="string">            dirs.remove('CVS')  # don't visit CVS directories</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    top = fspath(top)</span><br><span class="line">    dirs = []</span><br><span class="line">    nondirs = []</span><br><span class="line">    walk_dirs = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># We may not have read permission for top, in which case we can't</span></span><br><span class="line">    <span class="comment"># get a list of the files the directory contains.  os.walk</span></span><br><span class="line">    <span class="comment"># always suppressed the exception then, rather than blow up for a</span></span><br><span class="line">    <span class="comment"># minor reason when (say) a thousand readable directories are still</span></span><br><span class="line">    <span class="comment"># left to visit.  That logic is copied here.</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># Note that scandir is global in this module due</span></span><br><span class="line">        <span class="comment"># to earlier import-*.</span></span><br><span class="line">        scandir_it = scandir(top)</span><br><span class="line">    <span class="keyword">except</span> OSError <span class="keyword">as</span> error:</span><br><span class="line">        <span class="keyword">if</span> onerror <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            onerror(error)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> scandir_it:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    entry = next(scandir_it)</span><br><span class="line">                <span class="keyword">except</span> StopIteration:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">except</span> OSError <span class="keyword">as</span> error:</span><br><span class="line">                <span class="keyword">if</span> onerror <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                    onerror(error)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                is_dir = entry.is_dir()</span><br><span class="line">            <span class="keyword">except</span> OSError:</span><br><span class="line">                <span class="comment"># If is_dir() raises an OSError, consider that the entry is not</span></span><br><span class="line">                <span class="comment"># a directory, same behaviour than os.path.isdir().</span></span><br><span class="line">                is_dir = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> is_dir:</span><br><span class="line">                dirs.append(entry.name)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                nondirs.append(entry.name)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> topdown <span class="keyword">and</span> is_dir:</span><br><span class="line">                <span class="comment"># Bottom-up: recurse into sub-directory, but exclude symlinks to</span></span><br><span class="line">                <span class="comment"># directories if followlinks is False</span></span><br><span class="line">                <span class="keyword">if</span> followlinks:</span><br><span class="line">                    walk_into = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        is_symlink = entry.is_symlink()</span><br><span class="line">                    <span class="keyword">except</span> OSError:</span><br><span class="line">                        <span class="comment"># If is_symlink() raises an OSError, consider that the</span></span><br><span class="line">                        <span class="comment"># entry is not a symbolic link, same behaviour than</span></span><br><span class="line">                        <span class="comment"># os.path.islink().</span></span><br><span class="line">                        is_symlink = <span class="literal">False</span></span><br><span class="line">                    walk_into = <span class="keyword">not</span> is_symlink</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> walk_into:</span><br><span class="line">                    walk_dirs.append(entry.path)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Yield before recursion if going top down</span></span><br><span class="line">    <span class="keyword">if</span> topdown:</span><br><span class="line">        <span class="keyword">yield</span> top, dirs, nondirs</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Recurse into sub-directories</span></span><br><span class="line">        islink, join = path.islink, path.join</span><br><span class="line">        <span class="keyword">for</span> dirname <span class="keyword">in</span> dirs:</span><br><span class="line">            new_path = join(top, dirname)</span><br><span class="line">            <span class="comment"># Issue #23605: os.path.islink() is used instead of caching</span></span><br><span class="line">            <span class="comment"># entry.is_symlink() result during the loop on os.scandir() because</span></span><br><span class="line">            <span class="comment"># the caller can replace the directory entry during the "yield"</span></span><br><span class="line">            <span class="comment"># above.</span></span><br><span class="line">            <span class="keyword">if</span> followlinks <span class="keyword">or</span> <span class="keyword">not</span> islink(new_path):</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">from</span> walk(new_path, topdown, onerror, followlinks)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># Recurse into sub-directories</span></span><br><span class="line">        <span class="keyword">for</span> new_path <span class="keyword">in</span> walk_dirs:</span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">from</span> walk(new_path, topdown, onerror, followlinks)</span><br><span class="line">        <span class="comment"># Yield after recursion if going bottom up</span></span><br><span class="line">        <span class="keyword">yield</span> top, dirs, nondirs</span><br></pre></td></tr></table></figure>
<p>os.walkåŒ…å«äº†4ä¸ªå‚æ•°ï¼štopã€topdownã€onerrorä»¥åŠfollowlinksã€‚topæŒ‡ä»£éœ€è¦éå†çš„æ ¹ç›®å½•ï¼›topdownæŒ‡ä»£æ˜¯å¦è‡ªé¡¶å‘ä¸‹è¿›è¡Œéå†ï¼›onerrorä¸ºè¿‡ç¨‹ä¸­æŠ›å¼‚å¸¸çš„å›è°ƒï¼›followlinksæŒ‡ä»£æ˜¯å¦éœ€è¦è·Ÿè¸ªç¬¦å·é“¾æ¥ã€‚</p>
<p>ä»æºç å’Œæ³¨é‡Šä¸­å¯ä»¥çœ‹åˆ°ï¼Œos.walkæœ¬èº«è¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨generatorã€‚ç”Ÿæˆå™¨ä¼šæ ¹æ®ä¸Šä¸€æ¬¡çš„çŠ¶æ€ï¼Œä¸æ–­åœ°ç”Ÿäº§ä¸‹ä¸€ä¸ªå€¼ï¼Œå› æ­¤ç”Ÿæˆå™¨ç”Ÿæˆçš„å€¼å¯èƒ½ä¼šæ˜¯æ— ç©·æ— å°½çš„ï¼Œä½†å› ä¸ºåªä¿ç•™å°‘é‡çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸å¤ªè€—è´¹èµ„æºã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœéå†ä¸€ä¸ªåŒ…å«å¤§é‡æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œä¸ç”¨ç”Ÿæˆå™¨ç›´æ¥æŠŠéå†æ‰€æœ‰çš„ç»“æœæ•´åˆèµ·æ¥ç»™åˆ°è°ƒç”¨è€…ï¼Œé‚£åŠ¿å¿…éœ€è¦èŠ±è´¹ç›¸å½“å¤šçš„èµ„æºå»å­˜å‚¨æ‰€æœ‰ç»“æœçš„ä¿¡æ¯ã€‚æ¯å½“éå†åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹æ—¶ï¼Œos.walkä¼šé‡‡å–å¦‚ä¸‹æ“ä½œï¼š</p>
<ul>
<li>å°è¯•è·å¾—os.scandirçš„iteratorè¿­ä»£å™¨ã€‚scandiræ–¹æ³•ï¼Œè¿”å›çš„ä¹Ÿæ˜¯generatorï¼Œå’Œlistdirä¸åŒã€‚</li>
<li>åœ¨scandir_iteratorä½œç”¨åŸŸé‡Œï¼Œä¸æ–­è°ƒç”¨nextè·å–æ–‡ä»¶å¤¹ä¸‹å‰©ä½™çš„entry</li>
<li>åˆ¤æ–­entryæ˜¯æ–‡ä»¶å¤¹è¿˜æ˜¯æ–‡ä»¶ï¼Œåˆ†åˆ«æ”¾åˆ°dirsä¸nondirsåˆ—è¡¨ä¸­</li>
<li>å¦‚æœä¸æ˜¯topdownè‡ªé¡¶å‘ä¸‹ï¼Œè€Œæ˜¯bottomupè‡ªåº•å‘ä¸Šï¼Œéœ€è¦å°†æœåˆ°çš„å­æ–‡ä»¶å¤¹/ç¬¦å·é“¾æ¥çš„æ–‡ä»¶å¤¹æ”¾åˆ°walk_dirsä¸­ï¼Œåç»­å…ˆéå†å®ƒä»¬</li>
<li>ç¡®å®šdirsè·Ÿnondirsåˆ—è¡¨åï¼Œæ ¹æ®æ˜¯å¦è‡ªé¡¶å‘ä¸‹éå†æ¥æ‰§è¡Œè¡Œä¸º<ul>
<li>å¦‚æœè®¾ç½®äº†è‡ªé¡¶å‘ä¸‹éå†ï¼Œå°±yield <code>(å½“å‰ç›®å½•, å­ä¸€å±‚çš„æ–‡ä»¶å¤¹åˆ—è¡¨, å­ä¸€å±‚çš„éæ–‡ä»¶å¤¹åˆ—è¡¨)</code>ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹å­ä¸€å±‚æ–‡ä»¶å¤¹åˆ—è¡¨é‡Œé¢çš„å€¼ï¼Œæ¥å®ç°æ¯”å¦‚å‰ªæçš„éœ€æ±‚</li>
<li>å¦‚æœè®¾ç½®è‡ªåº•å‘ä¸Šï¼Œå°±å…ˆyield from walk_dirsé‡Œçš„å„ä¸ªæ–‡ä»¶å¤¹åŠå­ä¸€å±‚æ–‡ä»¶å¤¹/éæ–‡ä»¶å¤¹åˆ—è¡¨ï¼Œç„¶åå†yieldå½“å‰ç›®å½•/å­ä¸€å±‚ä¿¡æ¯</li>
</ul>
</li>
</ul>
<p>os.walkçš„åŸç†å¤§è‡´å¦‚æ­¤ã€‚ä¸æ­¤åŒæ—¶ï¼Œos.walkæ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„ä½¿ç”¨generatorçš„ä¾‹å­ï¼Œå€¼å¾—æˆ‘ä»¬åœ¨åº”ç”¨pythonçš„æ—¶å€™å­¦ä¹ ä¸å›é¡¾</p>
]]></content>
      <categories>
        <category>Pythonéšç¬”</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>éå†æ–‡ä»¶</tag>
        <tag>os.walk</tag>
        <tag>generator</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘UE4æ’ä»¶é€šè¿‡C++å¯¼å‡ºLLMæ•°æ®çš„æ–¹æ³•</title>
    <url>/2020/11/08/geekdaily/ue4_llm_dump_cpp/</url>
    <content><![CDATA[<p>è¿‘æœŸä¸ºäº†ä¸°å¯ŒUE4æ’ä»¶<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9VbnJlYWxBdXRvbWF0b3I=" title="https://github.com/utmhikari/UnrealAutomator">UnrealAutomator<i class="fa fa-external-link"></i></span>çš„åŸºç¡€åŠŸèƒ½ï¼Œåœ¨ProfileServiceä¸­å¢åŠ äº†<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vZW4tVVMvUHJvZ3JhbW1pbmcvRGV2ZWxvcG1lbnQvVG9vbHMvTG93TGV2ZWxNZW1vcnlUcmFja2VyL2luZGV4Lmh0bWw=" title="https://docs.unrealengine.com/en-US/Programming/Development/Tools/LowLevelMemoryTracker/index.html">LLM<i class="fa fa-external-link"></i></span>æ•°æ®è·å–çš„æ–¹æ³•ã€‚LLMæ‹¥æœ‰æŠ“å–UE4åº•å±‚æ¨¡å—å†…å­˜ä½¿ç”¨æƒ…å†µçš„åŠŸèƒ½ï¼Œå„ç§ModulesæŒ‰ç…§LLMçš„è§„èŒƒå®ç°ç›¸åº”å®å³å¯å°†å†…å­˜ä½¿ç”¨æ•°æ®å®æ—¶æ›´æ–°åˆ°LLMç³»ç»Ÿä¸­ã€‚å¦‚æœä»äº§å“å¤–éƒ¨ï¼Œæ˜¯éš¾ä»¥ç›´æ¥è®¿é—®è¿™äº›ä¿¡æ¯çš„ã€‚</p>
<p>ä»¥UE4.24ä¸ºä¾‹ï¼Œç”¨C++åœ¨UE4æ’ä»¶å®ç°LLMæ•°æ®è·å–çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * See HAL/LowLevelMemTracker.h</span></span><br><span class="line"><span class="comment"> * If detailed info is needed, a proper solution is to make vars/functions explicitly in LLM.h/.cpp</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">TSharedPtr&lt;FJsonObject&gt; FProfileService::GetLLMStats()</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> ENABLE_LOW_LEVEL_MEM_TRACKER &amp;&amp; STATS</span></span><br><span class="line">    FLowLevelMemTracker&amp; LLM = FLowLevelMemTracker::Get();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// get all tags</span></span><br><span class="line">    TArray&lt;<span class="keyword">const</span> TCHAR*&gt; LLMTagNames;</span><br><span class="line">    TArray&lt;ELLMTag&gt; LLMTags;</span><br><span class="line">    TArray&lt;FName&gt; LLMTagStatNames;</span><br><span class="line">    TArray&lt;FName&gt; LLMTagStatGroupNames;</span><br><span class="line">    <span class="keyword">for</span> (uint64 i = <span class="number">0</span>; i &lt; (int32)ELLMTag::GenericTagCount; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">const</span> TCHAR* TagName = LLM.FindTagName(i);</span><br><span class="line">        <span class="keyword">if</span> (TagName != <span class="literal">nullptr</span> &amp;&amp; !FString(TagName).Equals(TEXT(<span class="string">"?"</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            ELLMTag Tag = <span class="keyword">static_cast</span>&lt;ELLMTag&gt;(i);</span><br><span class="line">            LLMTags.Push(Tag);</span><br><span class="line">            LLMTagNames.Push(TagName);</span><br><span class="line">            <span class="comment">/*LLMTagStatNames.Push(LLMGetTagStat(Tag));</span></span><br><span class="line"><span class="comment">            LLMTagStatGroupNames.Push(LLMGetTagStatGroup(Tag));*/</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (uint64 i = LLM_CUSTOM_TAG_START; i &lt;= LLM_CUSTOM_TAG_END; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">const</span> TCHAR* TagName = LLM.FindTagName(i);</span><br><span class="line">        <span class="keyword">if</span> (TagName != <span class="literal">nullptr</span> &amp;&amp; !FString(TagName).Equals(TEXT(<span class="string">"?"</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            ELLMTag Tag = <span class="keyword">static_cast</span>&lt;ELLMTag&gt;(i);</span><br><span class="line">            LLMTags.Push(Tag);</span><br><span class="line">            LLMTagNames.Push(TagName);</span><br><span class="line">            <span class="comment">/*LLMTagStatNames.Push(LLMGetTagStat(Tag));</span></span><br><span class="line"><span class="comment">            LLMTagStatGroupNames.Push(LLMGetTagStatGroup(Tag));*/</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    int32 NumTags = LLMTags.Num();</span><br><span class="line">    UE_LOG(LogUnrealAutomator, Log, TEXT(<span class="string">"Found %d LLM Tags!"</span>), NumTags);</span><br><span class="line">    <span class="keyword">if</span> (NumTags == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// update stats</span></span><br><span class="line">    LLM.UpdateStatsPerFrame();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// gather amount</span></span><br><span class="line">    TArray&lt;TSharedPtr&lt;FJsonValue&gt;&gt; LLMStatsArray;</span><br><span class="line">    <span class="keyword">for</span> (int32 i = <span class="number">0</span>; i &lt; LLMTags.Num(); i++)</span><br><span class="line">    &#123;</span><br><span class="line">        TSharedPtr&lt;FJsonObject&gt; TagAmountJson = MakeShareable(<span class="keyword">new</span> FJsonObject());</span><br><span class="line">        TagAmountJson-&gt;SetNumberField(TEXT(<span class="string">"Amount"</span>), LLM.GetTagAmountForTracker(ELLMTracker::Default, LLMTags[i]));</span><br><span class="line">        TagAmountJson-&gt;SetStringField(TEXT(<span class="string">"TagName"</span>), LLMTagNames[i]);</span><br><span class="line">        TagAmountJson-&gt;SetNumberField(TEXT(<span class="string">"TagNum"</span>), <span class="keyword">static_cast</span>&lt;uint64&gt;(LLMTags[i]));</span><br><span class="line">        <span class="comment">/*TagAmountJson-&gt;SetStringField(TEXT("StatName"), LLMTagStatNames[i].ToString());</span></span><br><span class="line"><span class="comment">        TagAmountJson-&gt;SetStringField(TEXT("StatGroupName"), LLMTagStatGroupNames[i].ToString());*/</span></span><br><span class="line">        LLMStatsArray.Push(MakeShareable(<span class="keyword">new</span> FJsonValueObject(TagAmountJson)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// make json</span></span><br><span class="line">    TSharedPtr&lt;FJsonObject&gt; LLMStats = MakeShareable(<span class="keyword">new</span> FJsonObject());</span><br><span class="line">    LLMStats-&gt;SetArrayField(TEXT(<span class="string">"Data"</span>), LLMStatsArray);</span><br><span class="line">    LLMStats-&gt;SetNumberField(TEXT(<span class="string">"Count"</span>), LLMStatsArray.Num());</span><br><span class="line">    <span class="keyword">return</span> LLMStats;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    UE_LOG(LogUnrealAutomator, WARNING, TEXT(<span class="string">"Cannot get LLM stats! STATS or ENABLE_LOW_LEVEL_MEM_TRACKER macro not enabled!"</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>LLMè¿½è¸ªå†…å­˜ï¼Œé»˜è®¤ç»™äº†70å¤šä¸ªtagï¼Œå¦‚æœç”¨æˆ·éœ€è¦æŠŠè‡ªå·±çš„æ¨¡å—åŠ è¿›å»å¯ä»¥åŠ åˆ°custom tagé‡Œã€‚ç”¨è¿™ä¸ªå®ç°åŸºæœ¬èƒ½å¯¼å‡ºè¿™äº›tagçš„å®æ—¶å ç”¨æ•°æ®ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨å¼•æ“é»˜è®¤LLMçš„å®ç°å½“ä¸­ï¼ˆ<code>Core/HAL/Public/LowLevelMemTracker.h</code>ä¸<code>Core/HAL/Private/LowLevelMemTracker.cpp</code>ï¼‰ï¼Œé»˜è®¤å±è”½äº†å†…éƒ¨çš„ä¸€äº›ç±»ä»¥åŠexternå‡½æ•°çš„å®ç°ï¼Œä½¿å¾—ç”¨æˆ·æ— æ³•é€šè¿‡<code>MODULE_API</code>çš„æ–¹å¼ç›´æ¥è®¿é—®ç›¸åº”çš„æ•°æ®ç»“æ„åŠåŠŸèƒ½ã€‚å¦‚æœå®åœ¨æœ‰æ·±å…¥æŒ–æ˜çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´åŒºåˆ†<code>stat LLMFULL</code>ä¸<code>LLM summary</code>ï¼Œéœ€è¦è€ƒè™‘æ›´æ”¹å¼•æ“çš„ä»£ç ï¼Œå…¬å¼€ä¸€éƒ¨åˆ†æ¨¡å—å†…å®¹ï¼Œä¿®æ”¹<code>LLMGetTagStat</code>ä¸<code>LLMGetTagStatGroup</code>å®ç°å»æ”¯æŒcustom tagï¼Œä»è€Œæ›´åŠ æ–¹ä¾¿å®ç°éœ€æ±‚ã€‚</p>
<p>å†æä¸€å˜´ï¼Œé™¤äº†LLMä¹‹å¤–ï¼Œå¦‚æœè¦è·å¾—å…¶å®ƒçš„statæ•°æ®ï¼Œå¯ä»¥é‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9hbnN3ZXJzLnVucmVhbGVuZ2luZS5jb20vcXVlc3Rpb25zLzU1MDI3MS9zYXZpbmctc3RhdHMtdG8tZmlsZS5odG1sP3NvcnQ9b2xkZXN0" title="https://answers.unrealengine.com/questions/550271/saving-stats-to-file.html?sort=oldest">Hook Stats<i class="fa fa-external-link"></i></span>çš„æ–¹å¼è¿›è¡Œã€‚è¿™å—ä»¥åæœ‰ç©ºå†æ…¢æ…¢ç ”ç©¶~</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>UE4</tag>
        <tag>C++</tag>
        <tag>LLM</tag>
        <tag>UE4æ’ä»¶</tag>
        <tag>UnrealAutomator</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘UE4æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ’ä»¶â€”â€”UnrealAutomator</title>
    <url>/2020/10/24/testlife/unreal_automator/</url>
    <content><![CDATA[<p>UE4æ¸¸æˆ/æ‰‹æ¸¸è‡ªåŠ¨åŒ–æµ‹è¯•æœ‰å¾ˆå¤šæ–¹æ¡ˆå¯ä»¥æ‰§è¡Œï¼Œä¸è®ºæ˜¯ä¼ ç»Ÿçš„UIæµ‹è¯•æ–¹æ³•è¿˜æ˜¯å…·å¤‡å‰ç»æ€§è´¨çš„ä»¥å›¾åƒè¯†åˆ«+æœºå™¨å­¦ä¹ æŠ€æœ¯ä¸ºä¸»çš„æ–¹æ³•ï¼Œéƒ½èƒ½å¤Ÿæ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚é€‚é€¢1024èŠ‚æ—¥ï¼Œå—åˆ°<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvR0F1dG9tYXRvcg==" title="https://github.com/Tencent/GAutomator">GAutomator<i class="fa fa-external-link"></i></span>å’Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FpcnRlc3RQcm9qZWN0L1BvY28tU0RL" title="https://github.com/AirtestProject/Poco-SDK">PocoSDK<i class="fa fa-external-link"></i></span>çš„å¯å‘ï¼Œç¬”è€…è¿‘æœŸå†³å®šå¼€å§‹UE4ä¸“å±è‡ªåŠ¨åŒ–æµ‹è¯•æ’ä»¶<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9VbnJlYWxBdXRvbWF0b3I=" title="https://github.com/utmhikari/UnrealAutomator">UnrealAutomator<i class="fa fa-external-link"></i></span>çš„ç ”å‘ã€‚å½“å‰å·²ç»é›†æˆå¹¶æ‰©å±•äº†GAutomatorçš„UIä¿¡æ¯æ£€ç´¢åŠŸèƒ½ï¼Œå·²ç»èƒ½å¤Ÿæ»¡è¶³UIæµ‹è¯•æœåŠ¡ç«¯çš„åŸºæœ¬éœ€æ±‚ã€‚</p>
<p>UnrealAutomatorçš„æ ¸å¿ƒæ„¿æ™¯ï¼Œæ˜¯å¸Œæœ›é›†æˆæ¸¸æˆQAåŒå­¦æ—¥å¸¸æµ‹è¯•éœ€æ±‚ç›¸å…³çš„åŠŸèƒ½åˆ°ç»Ÿä¸€çš„æ’ä»¶å½“ä¸­ï¼Œå¹¶åœ¨ç¨³å®šçš„é€šä¿¡åè®®åŸºç¡€ä¸Šè®¾è®¡æ˜“äºæ‰©å±•/äºŒæ¬¡å¼€å‘çš„SDKï¼Œè®©å„ä¸ªUE4æ‰‹æ¸¸æµ‹è¯•ç»„èƒ½å¤Ÿæ¯”è¾ƒå®¹æ˜“åœ°æ ¹æ®è‡ªå·±çš„éœ€æ±‚å»è¿›è¡Œå®šåˆ¶ã€‚ç›¸æ¯”è¾ƒåŸæœ‰åœ¨UE4ä¸Šçš„è§£å†³æ–¹æ¡ˆï¼ŒPocoSDKçš„UE4æ’ä»¶å¹¶ä¸èƒ½å¤ŸåƒGAä¸€æ ·ï¼Œé€šè¿‡AndroidWindowè·å¾—å®‰å“æ‰‹æ¸¸çš„æ§ä»¶çš„ç²¾ç¡®ä½ç½®ï¼›è€ŒGAutomatorçš„UE4ä»…ä»…æ˜¯é›†æˆäº†UIæ£€ç´¢çš„åŠŸèƒ½ï¼Œå‰©ä½™çš„åŠŸèƒ½éƒ½éœ€è¦GAutomator Python Client Moduleå®ç°ï¼Œä¸”ç”±äºGA Client Moduleç›´æ¥åœ¨ä»£ç å®ç°ä¸­è€¦åˆäº†UIAutomatorè·ŸWeTestçš„ç›¸å…³åŠŸèƒ½ï¼ŒäºŒæ¬¡å¼€å‘æå…¶ä¸æ–¹ä¾¿ã€‚å› æ­¤ï¼ŒUnrealAutomatorå°†é‡‡å–å¦‚ä¸‹çš„æ–¹æ¡ˆè§£å†³è¿™äº›é—®é¢˜ï¼š</p>
<a id="more"></a>
<ul>
<li>é‡‡ç”¨HTTPåè®®ï¼Œä»¥<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9VbnJlYWxIdHRwU2VydmVy" title="https://github.com/utmhikari/UnrealHttpServer">UnrealHttpServer<i class="fa fa-external-link"></i></span>ä¸ºåŸºç¡€æ‰©å±•æ’ä»¶ã€‚å…¶å¸¦æ¥çš„æ”¶ç›Šæ˜¯æä¾›äº†ç¨³å®šçš„é€šä¿¡åè®®ï¼Œå¹¶ä¸”èƒ½æœ‰æ‰©å±•åˆ°å¾ˆå¤šé›†æˆå¹³å°çš„æœºä¼šï¼Œå¹¶ä¸”ä»ä»£ç reviewçš„è§’åº¦ä¸Šæ¥è€ƒè™‘çš„è¯ï¼Œé‡‡ç”¨Handler/Service/Modelçš„æœºåˆ¶ï¼Œå„ä¸ªåŠŸèƒ½æ¨¡å—å‘æŒ¥çš„ä½œç”¨ä¹Ÿä¼šéå¸¸æ¸…æ™°ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒå®¹æ˜“è¯»æ‡‚ã€‚</li>
<li>ä¸°å¯Œæ£€ç´¢åŠŸèƒ½ä¸è¿”å›çš„æ£€ç´¢ä¿¡æ¯ï¼Œå¹¶å¢åŠ äº†invoke eventçš„åŠŸèƒ½ï¼Œä½¿å¾—æŸäº›æ§ä»¶çš„äº‹ä»¶ï¼ˆæ¯”å¦‚Buttonçš„OnClickï¼‰èƒ½å¤Ÿç›´æ¥æ‰§è¡Œï¼Œå‡å°‘ä¸€äº›æ“ä½œä¸Šçš„ä¸ä¾¿ã€‚</li>
<li>ä¸°å¯ŒAPIçš„åŠŸèƒ½ä¸å®ç°ï¼Œå°½é‡ä½¿å¾—å¤–éƒ¨çš„Client Moduleä¸éœ€è¦è€ƒè™‘åº•å±‚çš„åŸºç¡€ï¼Œåªéœ€è¦è€ƒè™‘ä¸šåŠ¡ä¸Šçš„æ¨¡å—ï¼š<ul>
<li>UnrealHttpServerçš„API Clientï¼Œåªè´Ÿè´£ä¸æ’ä»¶çš„å¯¹æ¥</li>
<li>ç§»åŠ¨ç«¯æ“ä½œæ¨¡å—ï¼šadb clientï¼ŒUIAutomator</li>
<li>ç¬¬ä¸‰æ–¹å¹³å°çš„agent</li>
<li>è‡ªåŠ¨åŒ–ä¸šåŠ¡å±‚é€»è¾‘æŠ½è±¡ï¼Œæ¯”å¦‚ç™»å½•ã€èƒŒåŒ…ã€ç»„é˜Ÿç­‰ç­‰æ¸¸æˆç³»ç»Ÿæ¨¡å—ï¼ŒæŠ½è±¡ç›¸å…³æ“ä½œä¸ºhttp request</li>
<li>è‡ªåŠ¨åŒ–æµç¨‹é€»è¾‘</li>
</ul>
</li>
</ul>
<p>UnrealAutomatoré™¤äº†UIç›¸å…³åŠŸèƒ½ä¹‹å¤–ï¼Œåœ¨ç°åœ¨çš„è®¡åˆ’ï¼ˆè„‘è¡¥ï¼‰å½“ä¸­ï¼Œä¹Ÿå¸Œæœ›é›†æˆæ›´å¤šçš„åŠŸèƒ½ï¼Œä½¿å¾—èƒ½ä»æ¸¸æˆçš„åº•å±‚æŒ–æ˜æ›´å¤šæ·±å±‚æ¬¡çš„ä¿¡æ¯ï¼Œåˆ©äºæµ‹è¯•å·¥ä½œçš„éªŒæ”¶ä¸æ£€æŸ¥ã€‚</p>
<ul>
<li>è„šæœ¬è¯­è¨€æ¡†æ¶æ”¯æŒï¼Œå¦‚Unluaã€slua-unrealç­‰</li>
<li>è“å›¾ï¼ˆç‰©ä»¶æ¨¡æ¿ï¼‰ä¸æ¸¸æˆåœºæ™¯ç›¸å…³çš„åŠŸèƒ½æŒ–æ˜</li>
<li>åœ°å›¾/GameplayåŸºæœ¬ä¿¡æ¯çš„æ”¯æŒ</li>
<li>Profilingç›¸å…³çš„æ•°æ®å¯¼å‡º</li>
<li>æŠ½è±¡inputsã€axisä¸è¡Œä¸ºæ ‘ç›¸å…³åŠŸèƒ½ï¼Œå®ç°è§’è‰²æ“ä½œä¸æ‰˜ç®¡</li>
<li>etc</li>
</ul>
<p>å…ˆå‰ä¸æ˜¯C++/UE4ç¨‹åºå‘˜ï¼Œå€Ÿç€UnrealAutomatorè¿™ä¸ªæœºä¼šï¼Œä¹Ÿå¸Œæœ›é”¤ç‚¼ä¸€ä¸‹è¿™å—çš„æŠ€æœ¯ã€‚ä¸€æ–¹é¢å¸Œæœ›èƒ½å¤Ÿå¯¹æ‰‹æ¸¸æŠ€æœ¯æ ˆæœ‰æ›´åŠ æ·±å…¥çš„ç†è§£ï¼Œä»è€Œåˆ©äºæµ‹è¯•å·¥ä½œï¼›å¦ä¸€æ–¹é¢ä¹Ÿå¸Œæœ›æŠ›ç –å¼•ç‰ï¼Œä¸ºæ‰‹æ¸¸QAå·¥ä½œè¾“å‡ºä¸€ç‚¹å¾®è–„çš„è´¡çŒ®ï¼›å†ä¸€æ–¹é¢ä¹Ÿå¸Œæœ›è‡ªå·±åœ¨ä¸šåŠ¡ç™¾å¿™ä¹‹ä¸­ï¼Œèƒ½å¤ŸåšæŒä¸‹æ¥ä½œå“çš„åˆ›é€ ï¼Œå¾—åˆ°æ›´ä¸ºé•¿è¶³çš„æˆé•¿~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>UE4</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>UE4æ’ä»¶</tag>
        <tag>UnrealAutomator</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘è§£å†³UE4ä¸­FJsonObjectè½¬USTRUCTçš„å‘</title>
    <url>/2020/10/18/geekdaily/fjsonobject_to_ustruct/</url>
    <content><![CDATA[<p>å‰äº›å¤©åœ¨å†™<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9VbnJlYWxBdXRvbWF0b3I=" title="https://github.com/utmhikari/UnrealAutomator">UnrealAutomator<i class="fa fa-external-link"></i></span>çš„Webè§£ææ¨¡å—çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€äº›USTRUCTæ–¹é¢çš„é—®é¢˜ï¼Œç”±äºç¬”è€…ä»¥å‰å¹¶éUE4ç¨‹åºå‘˜ï¼Œå› æ­¤è¸©äº†ä¸€äº›å‘ï¼Œæœæ–­åˆ†äº«ä¸€ä¸‹è¸©å‘å†ç¨‹ã€‚</p>
<p>é¦–å…ˆèŠä¸€ä¸‹USTRUCTçš„ç”Ÿæˆã€‚USTRUCTæ˜¯UE4çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œä»éC++/UE4ç¨‹åºå‘˜çš„è§’åº¦æ¥è®²ï¼ŒUSTRUCTã€UPROPERTYã€GENERATED_BODYä¹‹ç±»çš„æ¦‚å¿µç±»ä¼¼äºæ³¨é‡Šå’Œè£…é¥°å™¨çš„ä½œç”¨ï¼Œå¯ä»¥åœ¨ç¼–è¯‘ç­‰æ—¶æœŸå°†ä»£ç æ ‡è¯†çš„å†…æ¶µçº³å…¥è‡ªå·±çš„Runtimeã€‚ä¸¾ä¸€ä¸ªä¾‹å­ï¼ŒUnrealAutomatorä¸­çš„UIModel.hï¼š</p>
<a id="more"></a>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"CoreMinimal.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Components/Widget.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¿…é¡»è¦æœ‰è¿™ä¸ªï¼Œincludeä¹‹åé€šè¿‡UE4åˆ·æ–°é¡¹ç›®ç”Ÿæˆç›¸å…³ä»£ç ï¼Œç”¨äºæ”¯æŒUSTRUCTç­‰å®çš„è¯†åˆ«</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"UIModel.generated.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Query template for ui widget</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">USTRUCT()</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">FUIWidgetQuery</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    GENERATED_BODY()</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    UPROPERTY()</span><br><span class="line">        int32 ID = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    UPROPERTY()</span><br><span class="line">        FString Name = TEXT(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    UPROPERTY()</span><br><span class="line">        FString Text = TEXT(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// properties below are relatively no need to be modified</span></span><br><span class="line"></span><br><span class="line">    UPROPERTY()</span><br><span class="line">        FString ClassName = TEXT(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    UPROPERTY()</span><br><span class="line">        <span class="keyword">bool</span> bIsNameAsKeyword = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    UPROPERTY()</span><br><span class="line">        <span class="keyword">bool</span> bIsTextAsKeyword = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    FUIWidgetQuery()</span><br><span class="line">        : ID(<span class="number">0</span>)</span><br><span class="line">        , Name(TEXT(<span class="string">""</span>))</span><br><span class="line">        , Text(TEXT(<span class="string">""</span>))</span><br><span class="line">        , ClassName(TEXT(<span class="string">""</span>))</span><br><span class="line">        , bIsNameAsKeyword(<span class="literal">false</span>)</span><br><span class="line">        , bIsTextAsKeyword(<span class="literal">false</span>)</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    FUIWidgetQuery(int32 InID,</span><br><span class="line">        FString InName,</span><br><span class="line">        FString InText,</span><br><span class="line">        FString InClassName,</span><br><span class="line">        <span class="keyword">bool</span> bInIsNameAsKeyword,</span><br><span class="line">        <span class="keyword">bool</span> bInIsTextAsKeyword)</span><br><span class="line">        : ID(InID)</span><br><span class="line">        , Name(InName)</span><br><span class="line">        , Text(InText)</span><br><span class="line">        , ClassName(InClassName)</span><br><span class="line">        , bIsNameAsKeyword(bInIsNameAsKeyword)</span><br><span class="line">        , bIsTextAsKeyword(bInIsTextAsKeyword)</span><br><span class="line">    &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å¾—è¦æœ‰cppæ–‡ä»¶å®ç°å®ƒï¼Œå½“ç„¶ä¸ç®¡æœ‰æ²¡æœ‰è¿™ä¸ªå‡½æ•°ï¼Œéƒ½å¾—åŠ ä¸€ä¸ªcppæ–‡ä»¶</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">IsMatch</span><span class="params">(UWidget* Widget,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">bool</span> bIsDisabledIncluded = <span class="literal">false</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">bool</span> bIsInvisibleIncluded = <span class="literal">false</span>)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªä»¥jsonå­—ç¬¦ä¸²ä¸ºbodyçš„http requestè§£ææˆè¿™ä¸ªUSTRUCTï¼Œè‡ªç„¶è€Œç„¶ä¼šéœ€è¦FJsonObjectç›¸å…³çš„åŠŸèƒ½ã€‚http requestçš„bodyåŸç”Ÿä¸º<code>TArray&lt;uint8&gt;</code>çš„æ ¼å¼ï¼Œå¾—å…ˆè½¬ä¸º<code>FString</code>ï¼Œç„¶åè½¬ä¸º<code>FJsonObject</code>ï¼Œä¹‹åå†è½¬ä¸º<code>USTRUCT</code></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// TArray&lt;uint8&gt; to FString</span></span><br><span class="line">FString FWebUtil::GetRequestStringBody(<span class="keyword">const</span> FHttpServerRequest&amp; Request)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Body to utf8 string, should be called after CheckRequestContent(Request, bIsCheckUTF8 = true)</span></span><br><span class="line">    TArray&lt;uint8&gt; RequestBodyBytes = Request.Body;</span><br><span class="line">    FString RequestBodyString = FString(UTF8_TO_TCHAR(RequestBodyBytes.GetData()));</span><br><span class="line">    UE_LOG(UALog, Log, TEXT(<span class="string">"Request string body: %s"</span>), *RequestBodyString);</span><br><span class="line">    <span class="keyword">return</span> RequestBodyString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FString to TSharedPtr&lt;FJsonObject&gt;</span></span><br><span class="line">TSharedPtr&lt;FJsonObject&gt; FCommonUtil::JsonParse(FString Str)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// string to json</span></span><br><span class="line">    TSharedRef&lt;TJsonReader&lt;&gt;&gt; JsonReader = TJsonReaderFactory&lt;&gt;::Create(Str);</span><br><span class="line">    TSharedPtr&lt;FJsonObject&gt; JsonObject;</span><br><span class="line">    <span class="keyword">bool</span> bSuccess = FJsonSerializer::Deserialize(JsonReader, JsonObject);</span><br><span class="line">    <span class="keyword">if</span> (!bSuccess)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> JsonObject;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TSharedPtr&lt;FJsonObject&gt; to USTRUCT</span></span><br><span class="line"><span class="comment">// å°±ç®—ç”¨FJsonObjectConverter::JsonObjectStringToUStructï¼Œä¹Ÿéœ€è¦ç»å†å…ˆè½¬åˆ°Jsonå†è½¬åˆ°USTRUCTçš„è¿‡ç¨‹</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> UStructType&gt;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">GetRequestUStructBody</span><span class="params">(<span class="keyword">const</span> FHttpServerRequest&amp; Request, UStructType* StructBody)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    verifyf(StructBody != <span class="literal">nullptr</span>, TEXT(<span class="string">"USTRUCT to be converted should not be null~"</span>));</span><br><span class="line"></span><br><span class="line">    TSharedPtr&lt;FJsonObject&gt; JsonBody = GetRequestJsonBody(Request);</span><br><span class="line">    <span class="keyword">if</span> (JsonBody == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// extend/update struct with json values</span></span><br><span class="line">    <span class="comment">// å¦‚æœåŸæ¥structæœ‰é¢„è®¾å€¼ï¼Œåœ¨json convertä¸­ï¼Œä¼šè¦†ç›–åŸæ¥çš„å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (!FJsonObjectConverter::JsonObjectToUStruct&lt;UStructType&gt;(JsonBody.ToSharedRef(), StructBody, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        UE_LOG(UALog, Warning, TEXT(<span class="string">"failed to parse json body to ustruct!"</span>))</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (StructBody == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        UE_LOG(UALog, Warning, TEXT(<span class="string">"cast to USTRUCT failed! struct ptr is still null!"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    UE_LOG(UALog, Log, TEXT(<span class="string">"convert to USTRUCT successfully!"</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œjsonè½¬USTRUCTçš„è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½é€šè¿‡ä¼ ç©ºæŒ‡é’ˆUSTRUCTçš„æ–¹å¼ä¼å›¾å¸Œæœ›<code>FJsonObjectConverter::JsonObjectToUStruct</code>èƒ½å¤Ÿå¯¹USTRUCTè¿›è¡Œé‡èµ‹å€¼ã€‚ä¸€æ–¹é¢æ˜¯C++å·¦å³å€¼çš„ç‰¹æ€§å¼•èµ·çš„ï¼Œå¦ä¸€æ–¹é¢åœ¨è½¬å±æ€§çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿéœ€è¦è¯»å–åŸæ¥USTRUCTçš„å±æ€§å€¼ç›¸å…³ä¿¡æ¯ï¼Œå¦‚æœä¼ è¿›å»çš„æ˜¯ç©ºæŒ‡é’ˆå°±ä¼šcrashã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¨¡æ¿jsonè½¬ustructå‡½æ•°</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> OutStructType&gt;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">JsonObjectToUStruct</span><span class="params">(<span class="keyword">const</span> TSharedRef&lt;FJsonObject&gt;&amp; JsonObject, OutStructType* OutStruct, int64 CheckFlags = <span class="number">0</span>, int64 SkipFlags = <span class="number">0</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> JsonObjectToUStruct(JsonObject, OutStructType::StaticStruct(), OutStruct, CheckFlags, SkipFlags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·³åˆ°JsonAttributesToUStruct</span></span><br><span class="line"><span class="keyword">bool</span> FJsonObjectConverter::JsonObjectToUStruct(<span class="keyword">const</span> TSharedRef&lt;FJsonObject&gt;&amp; JsonObject, <span class="keyword">const</span> UStruct* StructDefinition, <span class="keyword">void</span>* OutStruct, int64 CheckFlags, int64 SkipFlags)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> JsonAttributesToUStruct(JsonObject-&gt;Values, StructDefinition, OutStruct, CheckFlags, SkipFlags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·³åˆ°JsonAttributesToUStructWithContainer</span></span><br><span class="line"><span class="keyword">bool</span> FJsonObjectConverter::JsonAttributesToUStruct(<span class="keyword">const</span> TMap&lt; FString, TSharedPtr&lt;FJsonValue&gt; &gt;&amp; JsonAttributes, <span class="keyword">const</span> UStruct* StructDefinition, <span class="keyword">void</span>* OutStruct, int64 CheckFlags, int64 SkipFlags)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> JsonAttributesToUStructWithContainer(JsonAttributes, StructDefinition, OutStruct, StructDefinition, OutStruct, CheckFlags, SkipFlags);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">JsonAttributesToUStructWithContainer</span><span class="params">(<span class="keyword">const</span> TMap&lt; FString, TSharedPtr&lt;FJsonValue&gt; &gt;&amp; JsonAttributes, <span class="keyword">const</span> UStruct* StructDefinition, <span class="keyword">void</span>* OutStruct, <span class="keyword">const</span> UStruct* ContainerStruct, <span class="keyword">void</span>* Container, int64 CheckFlags, int64 SkipFlags)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ˜¯FJsonObjectWrapperï¼Œå¯ä»¥ç›´æ¥è½¬æ¢</span></span><br><span class="line">    <span class="keyword">if</span> (StructDefinition == FJsonObjectWrapper::StaticStruct())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Just copy it into the object</span></span><br><span class="line">        FJsonObjectWrapper* ProxyObject = (FJsonObjectWrapper *)OutStruct;</span><br><span class="line">        ProxyObject-&gt;JsonObject = MakeShared&lt;FJsonObject&gt;();</span><br><span class="line">        ProxyObject-&gt;JsonObject-&gt;Values = JsonAttributes;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæœªå£°æ˜propertiesï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    int32 NumUnclaimedProperties = JsonAttributes.Num();</span><br><span class="line">    <span class="keyword">if</span> (NumUnclaimedProperties &lt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// iterate over the struct properties</span></span><br><span class="line">    <span class="keyword">for</span> (TFieldIterator&lt;UProperty&gt; PropIt(StructDefinition); PropIt; ++PropIt)</span><br><span class="line">    &#123;</span><br><span class="line">        UProperty* Property = *PropIt;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if we should ignore this property</span></span><br><span class="line">        <span class="keyword">if</span> (CheckFlags != <span class="number">0</span> &amp;&amp; !Property-&gt;HasAnyPropertyFlags(CheckFlags))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (Property-&gt;HasAnyPropertyFlags(SkipFlags))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// find a json value matching this property name</span></span><br><span class="line">        <span class="keyword">const</span> TSharedPtr&lt;FJsonValue&gt;* JsonValue = JsonAttributes.Find(Property-&gt;GetName());</span><br><span class="line">        <span class="keyword">if</span> (!JsonValue)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// we allow values to not be found since this mirrors the typical UObject mantra that all the fields are optional when deserializing</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (JsonValue-&gt;IsValid() &amp;&amp; !(*JsonValue)-&gt;IsNull())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è¿™é‡Œå°±éœ€è¦å–åˆ°OutStructçš„å±æ€§çš„Valueå€¼äº†ï¼Œå¦‚æœæ˜¯OutStructæ˜¯ç©ºæŒ‡é’ˆï¼Œå°±ä¼šcrashæ‰</span></span><br><span class="line">            <span class="keyword">void</span>* Value = Property-&gt;ContainerPtrToValuePtr&lt;uint8&gt;(OutStruct);</span><br><span class="line">            <span class="keyword">if</span> (!JsonValueToUPropertyWithContainer(*JsonValue, Property, Value, ContainerStruct, Container, CheckFlags, SkipFlags))</span><br><span class="line">            &#123;</span><br><span class="line">                UE_LOG(LogJson, Error, TEXT(<span class="string">"JsonObjectToUStruct - Unable to parse %s.%s from JSON"</span>), *StructDefinition-&gt;GetName(), *Property-&gt;GetName());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (--NumUnclaimedProperties &lt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// If we found all properties that were in the JsonAttributes map, there is no reason to keep looking for more.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§„é¿äº†è¿™äº›å‘ï¼ŒFJsonObjectè½¬USTRUCTå°±é¡ºåˆ©äº†</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>UE4</tag>
        <tag>C++</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>FJsonObject</tag>
        <tag>USTRUCT</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘Win10æ›´æ”¹IDEAï¼ˆJetbrainså…¨å®¶æ¡¶ï¼‰çš„æ’ä»¶å’Œé…ç½®è·¯å¾„</title>
    <url>/2020/10/06/geekdaily/idea_change_config_path/</url>
    <content><![CDATA[<p>Jetbrainså®¶çš„IDEï¼Œé»˜è®¤å®‰è£…ä¹‹åï¼Œé…ç½®å’Œæ’ä»¶éƒ½å­˜å‚¨åœ¨ç³»ç»Ÿç‰¹å®šçš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¦‚æœæ˜¯Windowsç³»ç»Ÿçš„è¯ï¼Œå°±ä¼šåœ¨ç”¨æˆ·æ–‡ä»¶å¤¹å­˜å‚¨ã€‚è¿™æ ·å°±æ»‹ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼šéšç€æ’ä»¶ç­‰å®‰è£…çš„è¶Šæ¥è¶Šå¤šï¼Œç³»ç»Ÿç›˜ä¹Ÿä¼šå æ‰ä¸€äº›ç©ºé—´ï¼Œè¿™ä¸ªæ—¶å€™å°±æœ‰äº†è½¬ç§»é»˜è®¤æ’ä»¶ä¸é…ç½®è·¯å¾„çš„éœ€æ±‚ã€‚ä»Šå¤©å°±ä»¥IDEAä¸ºä¾‹è®²è¿°ä¸€ä¸‹å¦‚ä½•æ“ä½œã€‚</p>
<a id="more"></a>
<p>é¦–å…ˆäº†è§£ä¸‹é»˜è®¤å­˜å‚¨çš„ä½ç½®ã€‚Win10çš„è¯ï¼ŒIDEAå¯èƒ½åœ¨è¿™é‡Œï¼š<code>C:\Users\ç”¨æˆ·å\AppData\Roaming\JetBrains</code>ã€‚å¦‚æœæ˜¯AndroidStudioï¼Œåˆ™å¯èƒ½åœ¨è¿™é‡Œï¼š<code>C:\Users\ç”¨æˆ·å\.AndroidStudio4.0</code>ã€‚åœ¨è¿™ä¸ªç›®å½•é‡Œé¢æ·±åº¦æµè§ˆï¼Œåº”è¯¥èƒ½å¤Ÿçœ‹åˆ°æœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹å­˜å‚¨äº†<code>config</code>ä»¥åŠ<code>system</code>æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œä¾¿å­˜å‚¨äº†æ’ä»¶ã€IDEé…ç½®ç­‰å†…å®¹ã€‚</p>
<p>è€Œåé€€å‡ºideaï¼Œå…ˆåœ¨æŸä¸ªåœ°æ–¹æ–°å»ºæ–‡ä»¶å¤¹ï¼Œå°†<code>config</code>ä¸<code>system</code>ç›®å½•å‰ªåˆ‡è¿›å»ï¼ˆæœ¬æ–‡æ–°å»º<code>D:\.IDEA</code>æ–‡ä»¶å¤¹ä¸ºä¾‹ï¼‰ã€‚ç„¶åè¿›å…¥IDEAçš„å®‰è£…ç›®å½•ï¼Œåœ¨å…¶<code>bin</code>ç›®å½•ä¸‹æœ‰ä¸€ä¸ª<code>idea.properties</code>æ–‡ä»¶ï¼Œç”¨è®°äº‹æœ¬ã€notepad++ä¹‹ç±»çš„è½¯ä»¶æ‰“å¼€ï¼Œä¿®æ”¹å…¶ä¸­å†…å®¹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Uncomment this option if you want to customize path to IDE config folder. Make sure you&apos;re using forward slashes.</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># é»˜è®¤ä¸‹é¢è¿™è¡Œæ˜¯ä¼šæ³¨é‡Šæ‰çš„ï¼Œç°åœ¨å–æ¶ˆæ³¨é‡Šï¼Œé…ç½®ä¸ºæ–°çš„configç›®å½•ã€‚æ³¨æ„è·¯å¾„åˆ†éš”ç¬¦æ˜¯æ­£æ–œæ ï¼Œä¸æ˜¯åæ–œæ </span><br><span class="line">idea.config.path=D:/.IDEA/config</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Uncomment this option if you want to customize path to IDE system folder. Make sure you&apos;re using forward slashes.</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># åŒæ ·ï¼Œå–æ¶ˆä¸‹é¢ä¸€è¡Œçš„æ³¨é‡Šï¼Œé…ç½®ä¸ºæ–°çš„systemç›®å½•</span><br><span class="line">idea.system.path=D:/.IDEA/system</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ä¸‹é¢ä¸¤ä¸ªæ’ä»¶ã€æ—¥å¿—çš„é…ç½®ä¸ç”¨å»æ‰æ³¨é‡Šï¼Œæ˜¯è·Ÿéšconfigå’Œsystemé…ç½®èµ°çš„</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Uncomment this option if you want to customize path to user installed plugins folder. Make sure you&apos;re using forward slashes.</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># idea.plugins.path=$&#123;idea.config.path&#125;/plugins</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Uncomment this option if you want to customize path to IDE logs folder. Make sure you&apos;re using forward slashes.</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># idea.log.path=$&#123;idea.system.path&#125;/log</span><br></pre></td></tr></table></figure>
<p>ä¹‹åå†é‡æ–°æ‰“å¼€IDEAï¼Œåº”è¯¥æ–°çš„é…ç½®éƒ½ç”Ÿæ•ˆäº†ã€‚å¯ä»¥è£…ä¸€ä¸ªæ’ä»¶è¯•è¯•çœ‹ï¼Ÿåº”è¯¥ä¸ä¼šåœ¨ç³»ç»Ÿç›˜é‡Œè£…äº†ã€‚è¿™ä¸ªæ–¹æ³•ï¼Œç†è®ºä¸ŠJå®¶æ¡¶çš„IDEéƒ½å¯ä»¥ç”¨ä¸Šï¼Œè¯•è¯•çœ‹å§~</p>
<p>å¦‚æœIDEAæœ‰å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œæ³¨æ„åœ¨æ›´æ–°çš„æ—¶å€™ï¼Œä¸è¦é€‰æ‹©replaceæ‰åŸæ¥çš„<code>idea.properties</code>æ–‡ä»¶ï¼Œè€Œæ˜¯ignoreã€‚ä¸ç„¶åˆè¦é‡æ–°æ¥ä¸€éäº†ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Win10</tag>
        <tag>Jetbrains</tag>
        <tag>IDE</tag>
        <tag>Intellij IDEA</tag>
        <tag>idea.properties</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æˆ‘å¿ƒç›®ä¸­çš„æµ‹è¯•</title>
    <url>/2020/09/06/testlife/be_a_tester/</url>
    <content><![CDATA[<p>å¾ˆä¹…ä»¥å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« ï¼š<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMTkvMTIvMjIvdGVzdGxpZmUvYXJlX3Rlc3RlcnNfY29udHJvbGxpbmdfcXVhbGl0eS8=" title="https://utmhikari.top/2019/12/22/testlife/are_testers_controlling_quality/">ã€Šæµ‹è¯•ã€ç­–åˆ’ä¸å¼€å‘ï¼Œè°æ¥æŠŠæ§æ¸¸æˆçš„è´¨é‡ã€‹<i class="fa fa-external-link"></i></span>ï¼ŒèŠäº†ä¸€ä¸‹æµ‹è¯•ã€ç­–åˆ’å’Œå¼€å‘ä¸‰è€…çš„å…³ç³»ã€‚æ—¶è‡³ä»Šæ—¥å›å¤´æ¥çœ‹ï¼Œå¤§æ–¹å‘è¿˜æ˜¯å·®ä¸å¤šçš„ã€‚åœ¨æŸäº›åœ°æ–¹ï¼Œæµ‹è¯•åœ°ä½ä½ï¼Œè¢«ç­–åˆ’è·Ÿå¼€å‘å†·çœ¼ç›¸çœ‹ï¼Œæ‰€ä»¥è®©ä»–ä»¬å¼€å¿ƒå°±å¥½ï¼›åœ¨æŸäº›åœ°æ–¹ï¼Œæµ‹è¯•ã€ç­–åˆ’å’Œå¼€å‘ä¹Ÿå¯ä»¥åœ¨åŒä¸€å±‚æ¬¡ä¸Šè®¨è®ºéœ€æ±‚ä¸ç ”å‘è¿‡ç¨‹çš„å¥½åã€‚è¯´ç™½äº†ï¼ŒæŠŠæ§æ¸¸æˆè´¨é‡ï¼Œæ˜¯ä¸‰ä¸ªéƒ¨é—¨ä¸€èµ·çš„è´£ä»»ï¼Œè€Œä¸”æµ‹è¯•å¹¶ä¸æ˜¯å¿…é¡»è¦ä¸ºç­–åˆ’å’Œç¨‹åºæ”¶çƒ‚æ‘Šå­ã€‚</p>
<a id="more"></a>
<p>è¨€å½’æ­£ä¼ ã€‚å†™ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæ¥æºäºå›å¿†åˆ°æ¯•ä¸šå·¥ä½œçš„å‰ä¸¤å¹´å¾ˆå¤šè´Ÿé¢çš„äº‹æƒ…ã€‚ä¸€æ¥æ˜¯æƒ³åˆ°å½“æ—¶åœ¨é¡¹ç›®ç»„é‡Œåšæµ‹è¯•è¢«å…¶ä»–éƒ¨é—¨ä»¥å†·çœ¼ç›¸å¾…çš„äº‹å®ï¼›å¦ä¸€æ¥æ˜¯æƒ³åˆ°ç”±äºè‡ªå·±å·¥ä½œå¹´é™è¾ƒä½ï¼ˆè¯´ç™½äº†å°±æ˜¯å®˜åƒšæƒåŠ›æ–—äº‰ï¼‰çš„åŸå› ï¼Œè‡ªå·±åšæŒçš„æŠ€æœ¯ç†å¿µæ²¡æœ‰å¾—åˆ°è®¤åŒï¼Œå¯¼è‡´è¢«æ‰€è°“çš„é«˜çº§æŠ€æœ¯ç –å®¶æ’æŒ¤çš„äº‹å®ã€‚ä½œä¸ºçƒ­çˆ±æŠ€æœ¯çš„äººï¼Œæˆ‘å¿ƒç›®ä¸­çš„æµ‹è¯•ï¼Œç‰¹æŒ‡è‡ªå·±æƒ³æˆä¸ºçš„æŠ€æœ¯å‘çš„æµ‹è¯•ï¼Œä¸ä»…éœ€è¦æœ‰è¿‡ç¡¬çš„ç¼–ç èƒ½åŠ›ï¼Œè€Œä¸”è¿˜éœ€è¦æœ‰é¡¹ç›®è§„åˆ’ã€äººå‘˜ç®¡ç†ä»¥åŠæ¶æ„è®¾è®¡çš„èƒ½åŠ›ï¼Œå°±å¦‚åŒå¼ è‰ºå…´ä¸€æ ·ï¼ˆç€å®ç‰›é€¼= =ï¼‰ï¼Œç¼–æ›²ã€èˆæŠ€ã€å”±æ­Œæ ·æ ·å…¨èƒ½ã€‚æµ‹è¯•çš„ç›®çš„æ˜¯å®Œæˆå„ç§è´¨ï¼ˆé»‘ï¼‰é‡ï¼ˆç§‘ï¼‰ä¿ï¼ˆæŠ€ï¼‰éšœéœ€æ±‚ï¼ŒæŠ€æœ¯é€‰å‹æ¥è®²ç›¸å¯¹æ›´åŠ å¤šå…ƒåŒ–ï¼Œå› æ­¤æ›´åŠ éœ€è¦ä¸€ä¸ªå¼€æ”¾åŒ…å®¹çš„ç¯å¢ƒé¼“åŠ±æŠ€æœ¯åˆ›æ–°ä¸ä¸šåŠ¡äº¤æµã€‚ä¸€ä¸ªè¢«ç­–åˆ’å¼€å‘å†·çœ¼ç›¸å¾…ï¼ŒæŠ€æœ¯ä¸Šä¸å…è®¸ç™¾èŠ±é½æ”¾çš„å·¥ä½œç¯å¢ƒï¼Œå¯¹äºæµ‹è¯•æŠ€æœ¯çš„å‘å±•æ¥è¯´å°±æ˜¯å™©æ¢¦ã€‚å› æ­¤æˆ‘å½“æ—¶ä¹Ÿå†³æ„ç¦»å¼€æ¯•ä¸šä¹‹åçš„ç¬¬ä¸€å®¶å…¬å¸ï¼Œè¿œèµ°é«˜é£ï¼Œä¸å†æ²¾æŸ“å¯¹æŠ€æœ¯æ¯«æ— å°Šé‡çš„â€œé˜¿é‡Œå‘³â€ã€‚</p>
<p>åœ¨å…ˆå‰çš„<span class="exturl" data-url="aHR0cHM6Ly91dG1oaWthcmkudG9wLzIwMTkvMDcvMTMvdGVzdGxpZmUvYW5kcm9pZF9mcHMv" title="https://utmhikari.top/2019/07/13/testlife/android_fps/">ã€Šå®‰å“FPSæµ‹è¯•è¯¦è§£ã€‹<i class="fa fa-external-link"></i></span>ä¸€æ–‡ä¸­ï¼Œæœ‰èŠåˆ°è‡ªå·±æ˜¯å› ä¸ºåšfpsä¸“é¡¹æµ‹è¯•è€Œå¯¹æµ‹è¯•å²—ä½äº§ç”Ÿäº†å…´è¶£ã€‚è¿™å¹¶ä¸æ˜¯å¼€å§‹ï¼Œå…¶å®æ—©åœ¨åˆä¸­çš„æ—¶å€™ï¼Œè‡ªå·±å°±å¯¹åç—…æ¯’ç›¸å…³çš„çŸ¥è¯†æ„Ÿå…´è¶£äº†ï¼Œä½†ç¢äºæ²¡æœ‰å½¢æˆè‡ªæˆ‘çš„è®¤çŸ¥ï¼Œè¿™ä»½å…´è¶£æ²¡èƒ½å¤ŸåšæŒå¹¶æ·±å…¥ä¸‹å»ï¼Œç€å®æ˜¯ä¸€ä»¶é—æ†¾çš„äº‹æƒ…ã€‚è¿™ä¹Ÿæ˜¯æˆ‘å¿ƒç›®ä¸­æµ‹è¯•çš„ç‰¹ç‚¹ä¹‹ä¸€ï¼Œä¸æ‹˜æ³¥äºä¸€ç‚¹ï¼Œå–„äºåˆ›é€ å˜åŒ–ã€‚åœ¨æˆ‘ä»¥å‰å‘†è¿‡çš„åœ°æ–¹ï¼Œæå€¡æ‹¥æŠ±å˜åŒ–ï¼Œè€ŒæŠ€æœ¯æµ‹è¯•çš„å·¥ä½œä¹‹ä¸€ï¼Œä¹Ÿæ˜¯ä»å·²æœ‰çš„ã€å†…åœ¨çš„å·¥ä½œæµç¨‹ä¸­ï¼Œå‘ç°ã€å®šä½ä¼˜åŒ–ç‚¹å¹¶åŠ ä»¥æ”¹å–„ï¼Œåˆ›é€ å˜åŒ–ï¼Œè®©å¤§å®¶ä¸€èµ·æ‹¥æŠ±ã€‚è¿™ä¸€ç‚¹ï¼Œå’Œå¼€å‘å¯¹äºå·²æœ‰çš„ä»£ç è¿›è¡Œé‡æ„ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ„æ€â€”â€”è¿½æ±‚æè‡´ï¼Œè¿½æ±‚100åˆ†ã€‚</p>
<p>æŠ€æœ¯æ˜¯æ— ç©·æ— å°½çš„ï¼Œäººä¸€è¾ˆå­ä¹Ÿä¸èƒ½ç†Ÿç»ƒæŒæ¡æ‰€æœ‰çš„æŠ€æœ¯ï¼Œè€Œä¸”æŠ€æœ¯ç²¾é€šçš„å†å¤šï¼Œåšçš„ä¸œè¥¿æ²¡äººç”¨çš„ä¸Šï¼Œä¹Ÿæ— æµäºäº‹ã€‚åœ¨æµ‹è¯•å·¥ä½œæœŸé—´ï¼Œè‡ªå·±ä¹Ÿäº†è§£åˆ°ä½œä¸ºä¸€ä¸ªæŠ€æœ¯æµ‹è¯•ï¼Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯ç²¾å‡†æ‰“å‡»ï¼šé€‰åˆé€‚çš„æŠ€æœ¯ï¼Œé€ åˆé€‚çš„è½®å­ã€‚ä½œä¸ºæµ‹è¯•ï¼Œå¾€æŠ€æœ¯çš„åº•å±‚éœ€è¦æœ‰é’»ç ”ç²¾ç¥ï¼Œå¾€æµ‹è¯•å·¥ä½œå®è§‚å±‚é¢ä¹Ÿè¦æœ‰ç¼œå¯†çš„æ€è€ƒã€‚ä¸èƒ½å±€é™è‡ªå·±ï¼Œè¦å‹‡äºçªç ´ï¼Œç»†å¿ƒä¸”å¤§èƒ†ã€‚</p>
<p>è‡³äºè‡ªå·±ï¼Œæœ€è¿‘æ‰“ç®—å¼€å§‹å­¦ä¹ UE4æ¸¸æˆå¼€å‘ï¼Œåˆ¶ä½œä¸€æ¬¾å•æœºå°æ¸¸æˆã€‚å°±åƒä¸Šé¢è¯´çš„ï¼Œä½œä¸ºæµ‹è¯•ï¼Œå°¤å…¶æ˜¯ä¸€ä¸ªæ¸¸æˆæµ‹è¯•ï¼Œä¸èƒ½å±€é™è‡ªå·±ï¼Œå¾—å¤šäº†è§£ä¸‹æ¸¸æˆå¼€å‘æŠ€æœ¯ï¼Œå¦åˆ™å°±æ²¡æœ‰åŠæ³•å»çªç ´æ¸¸æˆæµ‹è¯•çš„ç•Œé™ã€‚å·¥ä½œä¹‹ä½™ï¼Œè¯¥æƒ³åšçš„ä¸œè¥¿ï¼Œè¯¥æƒ³å­¦çš„æŠ€æœ¯ï¼Œè¿˜æ˜¯å¾—å¹²ã€‚ç‹¬æœ¨éš¾ä»¥æ”¹å˜ç¯å¢ƒï¼Œä½†å¯ä»¥æ”¹å˜è‡ªå·±ï¼Œç»™è‡ªå·±å¢å€¼ï¼Œå»è·å¾—æ›´å¤šçš„é€‰æ‹©æƒã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªæœ‰è‡ªæˆ‘é€»è¾‘ä½“ç³»çš„äººï¼Œåœ¨æ–°ç”Ÿæ€æƒ³å’Œäº‹ç‰©çš„æ¥å—ä¸Šæå…¶æ…¢çƒ­ä¿å®ˆï¼Œä½†ç»è¿‡æ¶ˆåŒ–åä¾¿èƒ½æˆç²¾ï¼ŒåŠ ä»¥æ²‰æ·€ã€‚æ„Ÿè°¢è¿™ä¸¤å¹´çš„ç»å†ï¼Œè®©æˆ‘å½¢æˆäº†è‡ªå·±ç‹¬ç‰¹çš„è§‚ç‚¹ï¼Œå¹¶å¯¹æ­¤æ›´åŠ åšæŒã€‚ä»Šå¤©æ™šäº†ï¼Œè¯¥ç¡äº†ï¼Œæ‰€ä»¥å°±å…ˆå†™åˆ°è¿™é‡Œï¼Œåé¢å†è¯´ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>æµ‹è¯•</tag>
        <tag>åŠŸèƒ½æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ¸¸æˆè‡ªåŠ¨åŒ–è¯¥æ€ä¹ˆåšï¼Ÿ</title>
    <url>/2020/09/06/testlife/game_autotest/</url>
    <content><![CDATA[<p>æ¸¸æˆè‡ªåŠ¨åŒ–è¯¥æ€ä¹ˆåšï¼Ÿè¿™æ˜¯ä¸€ä¸ªå€¼å¾—æ¢è®¨çš„é—®é¢˜ã€‚åœ¨ä¸­å›½ï¼Œç”¨æ‰‹æ¸¸è‡ªåŠ¨åŒ–æ¥æè¿°ï¼Œå¯èƒ½æ›´ä¸ºè´´åˆ‡ã€‚æ¸¸æˆè‡ªåŠ¨åŒ–æŠ€æœ¯å¹¶ä¸éš¾ä»¥ä¸Šæ‰‹ï¼Œæœ‰è®¸å¤šç°æˆçš„å·¥å…·æä¾›ä½¿ç”¨ã€‚ä½†æ˜¯ï¼Œè¦æƒ³åšå¥½æ¸¸æˆè‡ªåŠ¨åŒ–ï¼Œè®©å…¶çœŸæ­£æœåŠ¡äºæ¸¸æˆç ”å‘/è¿è¥æœŸä¸šåŠ¡ï¼Œå¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ã€‚</p>
<a id="more"></a>
<p>è‡ªåŠ¨åŒ–æµ‹è¯•æŠ€æœ¯ä¸Šçš„å®è´¨æ˜¯é€šè¿‡ä»£ç æ¨¡æ‹Ÿç©å®¶çš„è¡Œä¸ºï¼Œæœ¬æ„æ˜¯ç”¨æ¥è¡¥è¶³çœŸäººæµ‹è¯•å·¥ä½œã€‚æ¸¸æˆæµ‹è¯•é€šå¸¸åˆ†ä¸ºåŠŸèƒ½æµ‹è¯•ä¸ä¸“é¡¹æµ‹è¯•ï¼Œæ¸¸æˆè‡ªåŠ¨åŒ–åŒæ ·ä¹Ÿéœ€è¦é€‚åº”è¿™ä¸¤ç§åœºæ™¯ã€‚ä¸“é¡¹æµ‹è¯•åˆ†å¾ˆå¤šç§ï¼Œæ™®éæ¥è®²å®¢æˆ·ç«¯æ€§èƒ½æµ‹è¯•ã€åå°å‹åŠ›æµ‹è¯•ç­‰ç­‰ã€‚åå°å‹åŠ›æµ‹è¯•å¯ä»¥é‡‡ç”¨æœºå™¨äººçš„æ–¹å¼è¿æ¥åå°ä¸“ç”¨çš„æµ‹è¯•æ¥å£ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨åå°çš„é€»è¾‘æ‰§è¡Œå·²ç»é¢„å®šä¹‰çš„GMï¼›å®¢æˆ·ç«¯æ€§èƒ½æµ‹è¯•ä¸€èˆ¬é‡‡ç”¨ç›´æ¥æ“ä½œæ¸¸æˆå®¢æˆ·ç«¯çš„æ–¹å¼ï¼Œæ¯”å¦‚åˆ©ç”¨Airtestçš„UIè‡ªåŠ¨åŒ–ï¼Œæˆ–è€…æ˜¯ä»¥GAutomatorï¼ˆUnityï¼‰ä¸ºä»£è¡¨çš„æ¥å£è‡ªåŠ¨åŒ–æ–¹æ³•ã€‚å¦‚æœæ˜¯ä¸šåŠ¡ä¸“é¡¹ï¼Œæ¯”å¦‚æ•°å€¼æµ‹è¯•ã€PVPå¹³è¡¡æ€§ã€å¼‚å¸¸å›¾åƒæ£€æµ‹æ–¹é¢ï¼Œå¯ä»¥é‡‡ç”¨AIè‡ªåŠ¨åŒ–çš„æ–¹æ³•ã€‚è€Œè‡ªåŠ¨åŒ–ä½œä¸ºåŠŸèƒ½æµ‹è¯•çš„ç”¨é€”ï¼Œåˆ™ä¸€èˆ¬é‡‡ç”¨UIè‡ªåŠ¨åŒ–ã€æ¥å£è‡ªåŠ¨åŒ–çš„æ–¹æ³•ï¼Œè¾ƒä¸ºæ–¹ä¾¿ï¼Œèƒ½å¤Ÿæ§åˆ¶é€»è¾‘ã€‚</p>
<p>æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œçš„æœ‰æ•ˆæ—¶é—´ï¼ˆé™¤å»ç”¨ä¾‹çš„ä¸ç¨³å®šä¸ç¯å¢ƒå› ç´ ï¼‰ï¼Œå†³å®šäº†å…¶è´¨é‡çš„ä¸‹é™ã€‚æ¯”å¦‚ç”¨äºåŠŸèƒ½æµ‹è¯•çš„åœºæ™¯ï¼Œæ¸¸æˆè‡ªåŠ¨åŒ–ä¸å¯èƒ½ä»£æ›¿é»‘ç›’æµ‹è¯•äººå‘˜å»å°†æ‰€æœ‰çš„ç”¨ä¾‹è¦†ç›–ä¸€è¾¹ï¼Œä½†èƒ½å¤Ÿä½œä¸ºå†’çƒŸçš„ä½œç”¨å»è·‘é»‘ç›’æµ‹è¯•äººå‘˜æ²¡æœ‰ç©ºä½™æ—¶é—´å»éå†çš„åœºæ™¯ï¼Œä»è€Œç¡®ä¿å°½å¯èƒ½æ›´å¤šçš„åŠŸèƒ½æ˜¯æ­£å¸¸çš„ã€‚åŠŸèƒ½è‡ªåŠ¨åŒ–å¾ˆéš¾è·‘å‡ºç¼ºé™·ï¼Œä½†ä¸€æ—¦è·‘å‡ºæ¥çš„ç¼ºé™·åŸºæœ¬æ€§è´¨éƒ½è¾ƒä¸ºä¸¥é‡ï¼Œå› æ­¤å¦‚æœä¸å……åˆ†è¦†ç›–æ›´å¤šçš„åŠŸèƒ½ç©æ³•ï¼Œä¸åœ¨æ›´å¤šçš„æœºå™¨ä¸Šè¿è¡Œï¼ŒåŠŸèƒ½è‡ªåŠ¨åŒ–æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚åŒç†ï¼Œä¸šåŠ¡/æ€§èƒ½ä¸“é¡¹ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œæ²¡æœ‰åœ¨æ›´å¤šçš„æœºå™¨ä¸Šå»è¿è¡Œï¼Œé‚£è¿˜ä¸å¦‚å¢åŠ äººåŠ›å»è¦†ç›–ç›¸åº”çš„åœºæ™¯ã€‚</p>
<p>çº¯ç²¹çš„UIè‡ªåŠ¨åŒ–ä¸é€‚åˆåšå¤§è§„æ¨¡çš„æ¸¸æˆè‡ªåŠ¨åŒ–ï¼Œå› ä¸ºUIè‡ªåŠ¨åŒ–æœ¬è´¨ä¸Šæ˜¯å°†æ¸¸æˆæ§ä»¶viewportåæ ‡æ˜ å°„åˆ°æ‰‹æœºä¸Šçš„ç»å¯¹åæ ‡å»æ‰§è¡Œçš„ï¼Œä¸€å®šä¼šå­˜åœ¨é€‚é…çš„é—®é¢˜ï¼Œè€Œä¸”å¾ˆå¤šæ¸¸æˆå†…éƒ¨çš„åˆ¤æ–­é€»è¾‘ï¼Œç”¨UIè‡ªåŠ¨åŒ–æ˜¯æ— æ³•å®ç°çš„ã€‚å› æ­¤ï¼ŒUIè‡ªåŠ¨åŒ–å¿…é¡»æœ‰æ¥å£è‡ªåŠ¨åŒ–æˆ–è€…AIè®­ç»ƒè¾“å…¥çš„æ–¹å¼ï¼Œä½¿å¾—æµ‹è¯•ç”¨ä¾‹æ›´åŠ ç¨³å®šã€‚æ¥å£è‡ªåŠ¨åŒ–ç›¸å¯¹äºAIè®­ç»ƒè¾“å…¥ï¼Œé€»è¾‘ä¸Šä¼šæ›´åŠ ç¨³å®šä¸€äº›ï¼Œç†è®ºä¸Šä¹Ÿä¼šé€‚ç”¨äºæ›´å¤šçš„åœºæ™¯ï¼ˆå°¤å…¶æ˜¯è·‘æµç¨‹çš„ç±»å‹ï¼‰ï¼Œä½†ä¼šå¯¹ä»£ç æœ‰ä¸€å®šçš„ä¾µå…¥ï¼Œå› æ­¤æ¥å£è‡ªåŠ¨åŒ–å¯¹ä»£ç è®¾è®¡æ¨¡å¼æœ‰ä¸€å®šçš„è¦æ±‚ã€‚ä»ç¬”è€…çš„ç»éªŒä¸Šæ¥çœ‹ï¼Œæ¥å£è‡ªåŠ¨åŒ–éœ€è¦åšå¦‚ä¸‹å‡ ä¸ªäº‹æƒ…ï¼š</p>
<ul>
<li>ç¡®ä¿ä¸»æœºï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸æ‰‹æ¸¸ï¼ˆæœåŠ¡ç«¯ï¼‰ä¹‹é—´çš„é€šä¿¡</li>
<li>æ¸¸æˆä»£ç ä¾µå…¥ï¼šå®šä¹‰è‡ªåŠ¨åŒ–å…³å¿ƒçš„æ¥å£ï¼Œæ¨¡å—ä¸ä¸ä¸šåŠ¡ä»£ç è€¦åˆ</li>
<li>åœ¨å®¢æˆ·ç«¯ä¸Šï¼ŒæŠ½è±¡ä¸€å±‚è‡ªåŠ¨åŒ–å…³å¿ƒçš„æ¥å£</li>
<li>å¯¹äºæ¯ä¸ªè‡ªåŠ¨åŒ–ç”¨ä¾‹ï¼Œå°½å¯èƒ½ç”¨æŠ½è±¡å‡ºæ¥çš„ä¸€å±‚è‡ªåŠ¨åŒ–å…³å¿ƒçš„æ¥å£å®ç°</li>
</ul>
<p>å…¶ä¸­ï¼Œå®šä¹‰è‡ªåŠ¨åŒ–å…³å¿ƒçš„æ¥å£æ˜¯å¾ˆé‡è¦çš„ä¸€ç¯ï¼Œå®ƒä¸ä»…å†³å®šäº†è‡ªåŠ¨åŒ–ç”¨ä¾‹æ˜¯å¦èƒ½å¤Ÿæ–¹ä¾¿åœ°å®ç°ä»¥åŠç»´æŠ¤ï¼Œè€Œä¸”å†³å®šäº†è€…ä¸€å¥—æ¡†æ¶èƒ½å¦æ–¹ä¾¿å¤ç”¨åˆ°å…¶å®ƒæ¸¸æˆé¡¹ç›®ä¸­ã€‚è¿™æ˜¯ä»è‡ªåŠ¨åŒ–ä¸šåŠ¡æœ¬èº«ç‰¹æ€§å‡ºå‘ï¼Œæ‰€å¿…é¡»çš„ä¸€ä¸ªç¯èŠ‚ã€‚</p>
<p>AIè‡ªåŠ¨åŒ–ç›¸å¯¹äºæ¥å£è‡ªåŠ¨åŒ–ï¼Œä¾µå…¥çš„ç¨‹åº¦ä¼šæ›´åŠ å°‘ï¼Œä½†éœ€è¦æ›´ä¸ºä¼˜åšçš„åŸºç¡€æ¡ä»¶ï¼ˆä¸è®ºæ˜¯æ¸¸æˆåŸæœ¬çš„ä»£ç å®ç°æ”¯æŒï¼Œè¿˜æ˜¯ç”¨äºè®­ç»ƒAIçš„åŸºç¡€è®¾æ–½ï¼‰ã€‚è¡Œä¸ºæ ‘æ˜¯æœ€åŸºç¡€çš„AIï¼Œä½†æ”¯æ’‘è¡Œä¸ºæ ‘çš„å†…éƒ¨é€»è¾‘ä»ç„¶å±äºæ¥å£è‡ªåŠ¨åŒ–çš„èŒƒç•´ï¼Œå› æ­¤è¿™é‡Œçš„AIè‡ªåŠ¨åŒ–åå‘äºâ€œæ¨¡æ‹Ÿç©å®¶è¾“å…¥â€çš„AIã€‚è¿™ä¸€å—ç¬”è€…äº†è§£ä¸æ·±ï¼Œä½†ä»AIæœ¬èº«çš„ç‰¹æ€§ï¼ˆå‘ä¸€ä¸ªæ•°å­¦ç›®æ ‡é€¼è¿‘ï¼‰ä¸Šæ¥è®²ï¼Œæœ€é€‚ç”¨äºç«æŠ€å‹ä»¥åŠå›¾åƒè¯†åˆ«ç›¸å…³çš„åœºæ™¯ã€‚è¿™äº›éƒ½æ˜¯å…‰é æ¥å£è‡ªåŠ¨åŒ–éš¾ä»¥åšåˆ°çš„ä¸œè¥¿ã€‚</p>
<p>å½“ç„¶ï¼Œä¸è®ºæ˜¯AIã€UIè¿˜æ˜¯é æ¥å£ï¼Œé™¤äº†è·‘è‡ªåŠ¨åŒ–ç”¨ä¾‹ä¹‹å¤–ï¼Œéƒ½éœ€è¦å¯¹æ—¥å¿—ã€æˆªå›¾ã€å½•å±ç­‰ä¿¡æ¯è¿›è¡Œæ”¶é›†ï¼Œå½¢æˆå¯¹ç”¨ä¾‹æµç¨‹çš„é—­ç¯ï¼Œä¿ç•™æ›´ä¸ºä¸°å¯Œçš„ä¿¡æ¯ç”¨äºåç»­å®šä½é—®é¢˜ã€‚</p>
<p>å¦‚ä½•æ”¯æŒè‡ªåŠ¨åŒ–å¤§è§„æ¨¡çš„ä½¿ç”¨ï¼Œæ˜¯é™¤è‡ªåŠ¨åŒ–å®ç°æœ¬èº«ä¹‹å¤–çš„å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯åœ¨åšä¸€ä¸ªäº‘çœŸæœºå¹³å°çš„åŸºç¡€ä¸Šï¼Œèµ‹äºˆè‡ªåŠ¨åŒ–æµ‹è¯•æ‰€ç‰¹æ®Šéœ€æ±‚çš„åŠŸèƒ½ã€‚äº‘çœŸæœºå¹³å°çš„å®ç°ç½‘ä¸Šæœ‰å¾ˆå¤šç±»ä¼¼çš„è¯´æ˜ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼Œä½†è¦æ”¯æŒå¤šæ ·è‡ªåŠ¨åŒ–ç”¨ä¾‹çš„è¿è¡Œï¼Œè¿˜éœ€è¦ä¸€å®šçš„è§„èŒƒã€‚æœ€ç†æƒ³ã€æ ‡å‡†çš„æ–¹æ¡ˆæ˜¯<code>docker image + configmap</code>çš„å½¢å¼ï¼Œæ¯é•œåƒæ˜¯ç”¨æˆ·çš„è‡ªåŠ¨åŒ–ç”¨ä¾‹æ¡†æ¶ï¼Œ<code>configmap</code>æ˜ å°„ç”¨æˆ·åœ¨è¿™ä¸ªæ¡†æ¶ä¹‹ä¸‹çš„ç”¨ä¾‹é…ç½®ã€‚è¿™æ ·é™¤å»æ¸¸æˆæœ¬èº«çš„çº¦æŸä¹‹å¤–ï¼Œåœ¨ä¸»æœºï¼ˆå®¢æˆ·ç«¯ï¼‰å±‚é¢ï¼Œå°±èƒ½å¤Ÿè®©ç”¨æˆ·é‡‡ç”¨è‡ªå·±çš„æ–¹æ¡ˆå»å®ç°äº†ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œæ¸¸æˆè‡ªåŠ¨åŒ–åšåˆ°60åˆ†å¾ˆå®¹æ˜“ï¼Œè¦å¾€100åˆ†å†²åˆºï¼Œè¿˜éœ€è¦ä¸€ç•ªç²¾å¿ƒçš„è®¾è®¡ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆè‡ªåŠ¨åŒ–</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æ‰‹æ¸¸è‡ªåŠ¨åŒ–</tag>
        <tag>UIè‡ªåŠ¨åŒ–</tag>
        <tag>æ¥å£è‡ªåŠ¨åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æ¸¸æˆå¼€å‘ã€‘ç”¨Luaç¼–å†™UE4æ¸¸æˆé€»è¾‘â€”â€”UnLuaä¸Šæ‰‹</title>
    <url>/2020/08/02/gamedev/unlua_try/</url>
    <content><![CDATA[<p>å¤§å‹çš„æ¸¸æˆé¡¹ç›®åŒ…å«è®¸å¤šé”™ç»¼å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œé’ˆå¯¹UE4æ¸¸æˆè€Œè¨€ï¼Œå¦‚æœçº¯ç²¹é‡‡ç”¨C++ç¼–å†™çš„è¯ï¼Œä¸€æ–¹é¢ä¼šå¢åŠ å¤§é‡çš„åŠ³åŠ¨æˆæœ¬ï¼Œå½±å“æ•ˆç‡ï¼Œå¦ä¸€æ–¹é¢éš¾ä»¥è§£å†³æ¸¸æˆçƒ­æ›´çš„é—®é¢˜ã€‚luaä½œä¸ºèƒ¶æ°´è¯­è¨€ï¼Œèƒ½å¤Ÿä¸C/C++/C#ç­‰è¯­è¨€äº’é€šï¼Œç®€åŒ–ä¸šåŠ¡é€»è¾‘ç¼–å†™ï¼Œå¹¶ä¸”æ”¯æŒçƒ­æ›´ã€‚é’ˆå¯¹UE4çš„æ¸¸æˆå¼€å‘ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvVW5MdWE=" title="https://github.com/Tencent/UnLua">UnLua<i class="fa fa-external-link"></i></span>ä»¥åŠ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvc2x1YXVucmVhbA==" title="https://github.com/Tencent/sluaunreal">sluaunreal<i class="fa fa-external-link"></i></span>éƒ½æ˜¯é‡‡ç”¨luaç¼–å†™é€»è¾‘çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªæ²¡æœ‰æ€ä¹ˆæ¥è§¦è¿‡æ¸¸æˆå¼€å‘æŠ€æœ¯æ ˆçš„å°ç™½ï¼Œæœ¬æ–‡ä¸»è¦ä¸Šæ‰‹UnLuaçš„ä½¿ç”¨ã€‚</p>
<a id="more"></a>
<p>ä»githubä¸Šï¼Œæˆ‘ä»¬å¯ä»¥cloneä¸‹æ¥ç¤ºä¾‹çš„projectï¼Œç¼–è¯‘åå³å¯è¿è¡Œã€‚æ•´ä¸ªdemoçš„é€»è¾‘æ˜¯åœ¨ä¸€ä¸ªç©ºé—´ä¸­è‡ªåŠ¨ç”ŸæˆAIæ•Œäººï¼Œç©å®¶éœ€è¦å°„å‡»AIä»¥ä¿å…¨è‡ªèº«ï¼Œå¦‚æœç¢°åˆ°AIå³æ¸¸æˆå¤±è´¥ã€‚æ•´ä¸ªæ¸¸æˆçš„é€»è¾‘åŸºæœ¬åœ¨<code>Content/Script</code>ä¸‹çš„luaæ–‡ä»¶ä¸­ï¼Œå¯¹äºå¼€å‘è€…è€Œè¨€ï¼Œåªéœ€è¦<code>åˆ›å»ºè“å›¾â€”â€”å¯¼å‡ºLuaè„šæœ¬â€”â€”ç¼–å†™é€»è¾‘</code>ï¼Œå°±èƒ½å¤Ÿå®Œæˆéœ€æ±‚ã€‚</p>
<p>ç¼–è¾‘å™¨é‡‡ç”¨VSCode + Emmylua + C/C++çš„æ­é…å³å¯ï¼Œå¦‚æœæœ‰debugéœ€æ±‚å¯ä»¥VSæ­é…Codeã€‚è¦å¯¼å‡ºUnLuaè§£æçš„UE4çš„luaæ¥å£ï¼Œåœ¨<code>UnLuaIntelliSense.Build.cs</code>ä¸­ä¿®æ”¹è‡³<code>ENABLE_INTELLISENSE=1</code>ï¼Œç„¶åé‡æ–°æ„å»ºï¼Œå³å¯å¯¼å‡ºluaå®šä¹‰åˆ°<code>Plugins/UnLua/Intermediate/IntelliSense</code>ï¼Œä¹‹åè°ƒæ•´workspaceçš„é…ç½®å³å¯ï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"settings"</span>: &#123;</span><br><span class="line">        <span class="attr">"emmylua.source.roots"</span>: [<span class="string">"./Plugins/UnLua/Intermediate/IntelliSense"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å¯¹ç¤ºä¾‹æ•™ç¨‹ä¸­çš„å­å¼¹è¿›è¡Œæ”¹è£…ã€‚æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ª<code>CustomProjectile</code>ï¼Œå…¶è“å›¾å®ä¾‹ä¸º<code>BP_CustomProjectile</code>ï¼Œå¹¶å®ç°UnLuaçš„æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å…¶Static Meshçš„å½¢çŠ¶ä»¥åŠæè´¨ã€‚ä¹‹åï¼Œé€šè¿‡è“å›¾çª—å£çš„<code>lua template</code>å¯ä»¥åœ¨é¡¹ç›®ä¸­å¯¼å‡ºè“å›¾æ¥å£<code>BP_CustomProjectile_C.lua</code>ï¼Œè€Œä¸éœ€è¦è‡ªå·±ç¼–å†™è“å›¾é€»è¾‘ã€‚ç„¶ååœ¨è“å›¾çš„<code>Interfaces</code>ä¸­é€‰ä¸­<code>Get Module Name</code>ï¼Œè¿”å›<code>BP_CustomProjectile_C</code>æ‰€åœ¨ä½ç½®å³å¯ã€‚</p>
<p>é¦–å…ˆå¯¹äºCustomProjectileï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ª<code>ProjectileInitializer.lua</code>ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span> <span class="string">"UnLua"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">_G</span>.ProjectileInitializer = ProjectileInitializer <span class="keyword">or</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProjectileInitializer:GetRandomColor</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> R = UE4.UKismetMathLibrary.RandomFloat()</span><br><span class="line">    <span class="keyword">local</span> G = UE4.UKismetMathLibrary.RandomFloat()</span><br><span class="line">    <span class="keyword">local</span> B = UE4.UKismetMathLibrary.RandomFloat()</span><br><span class="line">    <span class="keyword">return</span> UE4.FLinearColor(R, G, B, <span class="number">1.0</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProjectileInitializer:GetInitializer</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> color = self:GetRandomColor()</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        Color = color,</span><br><span class="line">        Ratio = (color.R + color.G + color.B) / <span class="number">3</span>,</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> ProjectileInitializer</span><br></pre></td></tr></table></figure>
<p>ä¹‹åå¯ä»¥ç¼–å†™<code>BP_CustomProjectile_C</code>çš„ä»£ç ï¼Œå’Œ<code>BP_DefaultProjectile_C</code>åŸºæœ¬ç›¸åŒï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span> <span class="string">"UnLua"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> BP_CustomProjectile_C = Class(<span class="string">"Weapon.BP_ProjectileBase_C"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BP_CustomProjectile_C:Initialize</span><span class="params">(Initializer)</span></span></span><br><span class="line">    self.BaseColor = Initializer.Color</span><br><span class="line">    self.DamageRatio = Initializer.Ratio <span class="keyword">or</span> <span class="number">0.1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BP_CustomProjectile_C:UserConstructionScript</span><span class="params">()</span></span></span><br><span class="line">    self.Super.UserConstructionScript(self)</span><br><span class="line">    self.Damage = self.Damage * self.DamageRatio</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Projectile Damage: "</span> .. <span class="built_in">tostring</span>(self.Damage));</span><br><span class="line">    self.DamageType = UE4.UClass.Load(<span class="string">"/Game/Core/Blueprints/BP_DamageType.BP_DamageType_C"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BP_CustomProjectile_C:ReceiveBeginPlay</span><span class="params">()</span></span></span><br><span class="line">    self.Super.ReceiveBeginPlay(self)</span><br><span class="line">    <span class="keyword">local</span> MID = self.StaticMesh:CreateDynamicMaterialInstance(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> MID <span class="keyword">then</span></span><br><span class="line">        MID:SetVectorParameterValue(<span class="string">"BaseColor"</span>, self.BaseColor)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> BP_CustomProjectile_C</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å³å¯æ ¹æ®é¢œè‰²æ·±åº¦æ¥åˆ¤æ–­projectileçš„ä¼¤å®³ï¼Œå®ç°ä¼¤å®³éšæœºçš„æ•ˆæœã€‚</p>
<p>å¯¹äºUMGè€Œè¨€ï¼Œä¹Ÿå¯ä»¥åœ¨UMGè“å›¾ä¸­å…ˆè®¾ç½®å„ä¸ªæ§ä»¶ä¸ºå˜é‡ï¼Œç„¶åè°ƒç”¨å„ä¸ªå˜é‡çš„åå°„æ¥å£ä»¥è®¾ç½®æ§ä»¶å±æ€§ã€‚</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">require</span> <span class="string">"UnLua"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> UMG_Main_C = Class()</span><br><span class="line"></span><br><span class="line">UMG_Main_C.ExitBtnText = <span class="string">"Hello World"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UMG_Main_C:Construct</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self.ExitButtonTextBlock <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"exit button text is nil!"</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"bind exit button text..."</span>)</span><br><span class="line">        self.ExitButtonTextBlock:SetText(UMG_Main_C.ExitBtnText)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    self.ExitButton.OnClicked:Add(self, UMG_Main_C.OnClicked_ExitButton)	</span><br><span class="line">    <span class="comment">--self.ExitButton.OnClicked:Add(self, function(Widget) UE4.UKismetSystemLibrary.ExecuteConsoleCommand(Widget, "exit") end )</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">UMG_Main_C:OnClicked_ExitButton</span><span class="params">()</span></span></span><br><span class="line">    UE4.UKismetSystemLibrary.ExecuteConsoleCommand(self, <span class="string">"exit"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> UMG_Main_C</span><br></pre></td></tr></table></figure>
<p>ä»ä¸€ä¸ªUE4åˆå­¦è€…è§’åº¦è€Œè¨€ï¼ŒUnLuaçš„ç†Ÿæ‚‰ä¼šæœ‰ä¸€å®šå£å’ï¼Œéœ€è¦å»ºç«‹åœ¨å¯¹UE4çš„C++å˜æˆè¾ƒä¸ºç†Ÿæ‚‰çš„åŸºç¡€ä¸Šï¼Œæ‰èƒ½ç†Ÿç»ƒåº”ç”¨ã€‚UnLua/sluaunrealç›¸å¯¹äºè“å›¾è§£å†³äº†ä¸€ä¸ªæœ€å¤§çš„é—®é¢˜æ˜¯é€»è¾‘çš„å¯ç»´æŠ¤æ€§ä»¥åŠå¯çƒ­æ›´çš„èƒ½åŠ›ï¼Œä»¥ä¾¿æ”¯æŒä¸šåŠ¡é€»è¾‘çš„å¿«é€Ÿè¿­ä»£ã€‚luaæœ¬èº«æ˜¯æ²¡æœ‰å¼ºåˆ¶é™æ€ç±»å‹çš„ï¼Œè™½ç„¶æœ€è¿‘å·²æœ‰äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RlYWwtbGFuZ3VhZ2UvdGw=" title="https://github.com/teal-language/tl">teal<i class="fa fa-external-link"></i></span>çš„äº§ç”Ÿï¼Œä½†æ•´ä¸ªç”Ÿæ€è¿˜æ²¡æœ‰å®Œå…¨å…´èµ·ã€‚å› æ­¤å¦‚æœä½¿ç”¨luaä½œä¸ºèƒ¶æ°´è¯­è¨€ï¼Œä¸åœ¨luaå±‚å…ˆåšä¸€ä¸¤å±‚ä¸šåŠ¡æŠ½è±¡å†å†™é€»è¾‘çš„è¯ï¼Œè¿˜ä¸å¦‚ç›´æ¥å†™C++æ¥çš„ç¨³å®šã€‚å› æ­¤ï¼Œé’ˆå¯¹åˆå­¦è€…æˆ–è€…æ˜¯ç‹¬ç«‹å¼€å‘è€…ï¼Œç”¨C++åŠ ä¸Šè“å›¾æ˜¯æ›´åŠ å¦¥å½“çš„é€‰æ‹©ã€‚</p>
<p>Thatâ€™s itï¼Œæ¸¸æˆå¼€å‘æ˜¯ä¸€é—¨å¾ˆç‹¬ç‰¹çš„æŠ€æœ¯æ ˆï¼Œè¿˜æœ‰è®¸å¤šå€¼å¾—æ¢ç´¢çš„ä¸œè¥¿ã€‚è‡ªå·±è™½ç„¶æ²¡æœ‰ä»äº‹æ¸¸æˆå¼€å‘å·¥ä½œï¼Œä½†è¯´ä¸å®šæœ‰ä¸€å¤©ï¼Œèƒ½å¤Ÿè‡ªå·±å†™ä¸€ä¸ªè‡ªå·±çš„æ¸¸æˆå‘¢ã€‚</p>
]]></content>
      <categories>
        <category>æ¸¸æˆå¼€å‘</category>
      </categories>
      <tags>
        <tag>UE4</tag>
        <tag>C++</tag>
        <tag>æ¸¸æˆå¼€å‘</tag>
        <tag>UnLua</tag>
        <tag>lua</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘å®‰å“æ¸¸æˆæŠ•å±/å½•å±åˆ©å™¨â€”â€”scrcpy</title>
    <url>/2020/07/18/testlife/scrcpy/</url>
    <content><![CDATA[<p>æ‰‹æœºæŠ•å±/å½•å±åœ¨æµ‹è¯•é¢†åŸŸçš„ç”¨é€”æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>ä½œä¸ºï¼ˆè‡ªåŠ¨åŒ–ï¼‰æµ‹è¯•æŠ¥å‘Šçš„ä¸€éƒ¨åˆ†ï¼Œè®°å½•æµ‹è¯•çš„å®æ—¶åœºæ™¯</li>
<li>æŠ•å±åˆ°ç”µè„‘ï¼Œç”¨äºUIè‡ªåŠ¨åŒ–æµ‹è¯•</li>
<li>ä½œä¸ºæ—¥å¸¸æµ‹è¯•å·¥ä½œä½¿ç”¨</li>
</ul>
<p>å½“å‰æ‰‹æœºæŠ•å±/å½•å±çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ªï¼šSTFçš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL29wZW5zdGYvbWluaWNhcA==" title="https://github.com/openstf/minicap">minicap<i class="fa fa-external-link"></i></span>ä»¥åŠGenymobileçš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlbnltb2JpbGUvc2NyY3B5" title="https://github.com/Genymobile/scrcpy">scrcpy<i class="fa fa-external-link"></i></span>ã€‚ä»Šå¤©åˆ™ç¨å¾®ä»‹ç»ä¸€ä¸‹scrcpyï¼Œèƒ½å¤Ÿå…¼å®¹å„ç±»å®‰å“æ‰‹æœºï¼Œå¹¶ä¸”åœ¨æŠ•å±æ–¹é¢ï¼Œä½å»¶è¿Ÿä¸é«˜æ¸…æ™°åº¦å…¼å…·ã€‚</p>
<a id="more"></a>
<p>scrcpyï¼Œåˆåscreen copyï¼Œåˆ†ä¸º<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlbnltb2JpbGUvc2NyY3B5L3RyZWUvbWFzdGVyL3NlcnZlcg==" title="https://github.com/Genymobile/scrcpy/tree/master/server">scrcpy-server<i class="fa fa-external-link"></i></span>ä»¥åŠscrcpy-clientï¼Œserverè°ƒç”¨å®‰å“å†…éƒ¨çš„æ¥å£çš„è·å–å±å¹•ä¿¡æ¯ï¼Œç„¶åå‘é€ç»™clientï¼Œclientè§£ç å±å¹•ä¿¡æ¯ï¼Œå®Œæˆå½•åˆ¶/æŠ•å±ç­‰åŠŸèƒ½ã€‚åŒæ—¶ï¼Œclientä¹Ÿå¯ä»¥æ¥æ”¶è¾“å…¥ã€ç‚¹å‡»ã€æ‹–æ‹½ä¿¡æ¯ï¼Œé€šè¿‡swipeã€inputç­‰æ“ä½œä¼ è¾¾ç»™æ‰‹æœºï¼Œæˆ–æ˜¯å‘é€ç»™scrcpy-serverè®©serverè¿›è¡Œæ“ä½œã€‚å› æ­¤å¯¹äºæ‰‹æœºæ‰‹æ®‹å…šæ¥è¯´ï¼Œé‡‡ç”¨scrcpyæŠ•å±æ—¥å¸¸ç©æ‰‹æœºæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>scrcpyçš„clientå®ç°å› äººè€Œå¼‚ï¼Œä¸»è¦ç”¨äºè§£ç è§†é¢‘ä»¥åŠè§£æç”¨æˆ·æ“ä½œã€‚å½“å‰ä¹Ÿæœ‰è®¸å¤šå‡ºè‰²çš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>é»˜è®¤<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0dlbnltb2JpbGUvc2NyY3B5L3RyZWUvbWFzdGVyL2FwcA==" title="https://github.com/Genymobile/scrcpy/tree/master/app">client<i class="fa fa-external-link"></i></span>ï¼Œé‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly93d3cubGlic2RsLm9yZy9pbmRleC5waHA=" title="https://www.libsdl.org/index.php">SDL2<i class="fa fa-external-link"></i></span>åˆ¶ä½œ</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2JhcnJ5LXJhbi9RdFNjcmNweQ==" title="https://github.com/barry-ran/QtScrcpy">QtScrcpy<i class="fa fa-external-link"></i></span>ï¼Œé‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly93d3cucXQuaW8vY24=" title="https://www.qt.io/cn">Qt<i class="fa fa-external-link"></i></span>åˆ¶ä½œ</li>
<li><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3NyZXZpbnNhanUvZ3Vpc2NyY3B5" title="https://github.com/srevinsaju/guiscrcpy">guiscrcpy<i class="fa fa-external-link"></i></span>ï¼Œé‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9weXBpLm9yZy9wcm9qZWN0L1B5UXQ1Lw==" title="https://pypi.org/project/PyQt5/">PyQt5<i class="fa fa-external-link"></i></span>åˆ¶ä½œ</li>
</ul>
<p>å…¶ä¸­å®ç°ç›¸å¯¹æ¯”è¾ƒå®Œå–„çš„æ–¹æ¡ˆæ˜¯QtScrcpyï¼Œé™¤äº†æŠ•å±ã€æ‰‹æœºæ“ä½œå‘¨è¾¹æ¯”è¾ƒå®Œå–„ä¹‹å¤–ï¼Œè¿˜æä¾›è‡ªå®šä¹‰å±å¹•æŒ‰é”®/æ‹–æ‹½é…ç½®ã€‚å¦‚æœæœ‰æ—¥å¸¸ä½¿ç”¨åè€…æ˜¯è‡ªåŠ¨åŒ–ç”¨ä¾‹å½•åˆ¶çš„éœ€æ±‚ï¼Œå¯¹QtScrcpyè¿›è¡ŒäºŒæ¬¡å¼€å‘æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
<p>åœ¨åŸç†æ–¹é¢ï¼Œscrcpyè°ƒç”¨äº†<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2FuZHJvaWQvbWVkaWEvTWVkaWFDb2RlYy5odG1s" title="https://developer.android.com/reference/android/media/MediaCodec.html">MediaCodec<i class="fa fa-external-link"></i></span>æ¥å£ã€‚ç¼–ç å™¨ä¼šä¸æ–­ä»<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2FuZHJvaWQvdmlldy9TdXJmYWNl" title="https://developer.android.com/reference/android/view/Surface">Input Surface<i class="fa fa-external-link"></i></span>ä¸­è·å–å±å¹•æ•°æ®ï¼Œç„¶åè¿›è¡Œç¼–ç é€šè¿‡socketå‘é€åˆ°clientä¸­ã€‚ä»å®˜æ–¹æ–‡æ¡£ä¹Ÿå¯ä»¥è·çŸ¥ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vcmVmZXJlbmNlL2FuZHJvaWQvdmlldy9TdXJmYWNl" title="https://developer.android.com/reference/android/view/Surface">Surface<i class="fa fa-external-link"></i></span>å­˜å‚¨äº†å±å¹•æ•°æ®ï¼Œé‡‡ç”¨Surfaceä¸ºç¼–ç å™¨ä¼ é€’æ•°æ®ä¼šæ˜¯æ›´åŠ é€‚å®œçš„é€‰æ‹©ã€‚scrcpyç¼–ç å±å¹•æ•°æ®çš„ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">internalStreamScreen</span><span class="params">(Device device, FileDescriptor fd)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    MediaFormat format = createFormat(bitRate, maxFps, codecOptions);</span><br><span class="line">    device.setRotationListener(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">boolean</span> alive;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            MediaCodec codec = createCodec();</span><br><span class="line">            IBinder display = createDisplay();</span><br><span class="line">            ScreenInfo screenInfo = device.getScreenInfo();</span><br><span class="line">            Rect contentRect = screenInfo.getContentRect();</span><br><span class="line">            <span class="comment">// include the locked video orientation</span></span><br><span class="line">            Rect videoRect = screenInfo.getVideoSize().toRect();</span><br><span class="line">            <span class="comment">// does not include the locked video orientation</span></span><br><span class="line">            Rect unlockedVideoRect = screenInfo.getUnlockedVideoSize().toRect();</span><br><span class="line">            <span class="keyword">int</span> videoRotation = screenInfo.getVideoRotation();</span><br><span class="line">            <span class="keyword">int</span> layerStack = device.getLayerStack();</span><br><span class="line"></span><br><span class="line">            setSize(format, videoRect.width(), videoRect.height());</span><br><span class="line">            configure(codec, format);</span><br><span class="line">            Surface surface = codec.createInputSurface();</span><br><span class="line">            setDisplaySurface(display, surface, videoRotation, contentRect, unlockedVideoRect, layerStack);</span><br><span class="line">            codec.start();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                alive = encode(codec, fd);</span><br><span class="line">                <span class="comment">// do not call stop() on exception, it would trigger an IllegalStateException</span></span><br><span class="line">                codec.stop();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                destroyDisplay(display);</span><br><span class="line">                codec.release();</span><br><span class="line">                surface.release();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">while</span> (alive);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        device.setRotationListener(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">encode</span><span class="params">(MediaCodec codec, FileDescriptor fd)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> eof = <span class="keyword">false</span>;</span><br><span class="line">    MediaCodec.BufferInfo bufferInfo = <span class="keyword">new</span> MediaCodec.BufferInfo();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (!consumeRotationChange() &amp;&amp; !eof) &#123;</span><br><span class="line">        <span class="keyword">int</span> outputBufferId = codec.dequeueOutputBuffer(bufferInfo, -<span class="number">1</span>);</span><br><span class="line">        eof = (bufferInfo.flags &amp; MediaCodec.BUFFER_FLAG_END_OF_STREAM) != <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (consumeRotationChange()) &#123;</span><br><span class="line">                <span class="comment">// must restart encoding with new size</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (outputBufferId &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                ByteBuffer codecBuffer = codec.getOutputBuffer(outputBufferId);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (sendFrameMeta) &#123;</span><br><span class="line">                    <span class="comment">// å°†ç¼–ç æ•°æ®+é•¿åº¦å†™åˆ°socketï¼Œå‘ç»™scrcpyçš„client</span></span><br><span class="line">                    writeFrameMeta(fd, bufferInfo, codecBuffer.remaining());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                IO.writeFully(fd, codecBuffer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (outputBufferId &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                codec.releaseOutputBuffer(outputBufferId, <span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> !eof;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåªéœ€è¦å•çº¯å®ç°å½•å±ï¼Œé‡‡ç”¨åŸç”Ÿscrcpy-clientçš„no displayé€‰é¡¹å°±èƒ½å¤Ÿå®ç°ã€‚å¦‚æœç”¨ç¨‹åºæ§åˆ¶scrcpyçš„å½•å±ï¼Œå»ºè®®é€‰æ‹©mkvæ ¼å¼å½•åˆ¶ï¼Œå¹¶é€šè¿‡<code>adb shell pkill app_process</code>æ€æ­»scrcpy-serveræ¥è¾¾åˆ°ç»ˆæ­¢å½•å±çš„æ•ˆæœã€‚å¦åˆ™å¯èƒ½é€ æˆè§†é¢‘æŸåã€‚å¦‚æœé‡‡ç”¨ç³»ç»Ÿçš„screenrecordæ–¹æ¡ˆï¼Œéƒ¨åˆ†æ‰‹æœºå¯èƒ½ä¼šä¸æ”¯æŒï¼Œå› æ­¤å¯ä»¥è€ƒè™‘ä¸¤è€…ç›¸è¾…ç›¸æˆã€‚</p>
<p>æ€»ä¹‹ï¼Œscrcpyæœ‰å¾ˆå¤šç”¨é€”å€¼å¾—æŒ–æ˜ï¼Œå°¤å…¶åœ¨ç§»åŠ¨/æ¸¸æˆæµ‹è¯•é¢†åŸŸï¼Œscrcpyæœªæ¥ä¸Šåº”æœ‰å’Œminicapç›¸æå¹¶è®ºçš„ç©ºé—´ã€‚</p>
<p>æœ€è¿‘å¿™ç¢Œï¼Œéš¾ä»¥æŠ½æ—¶é—´æ·±å…¥ç ”ç©¶æŠ€æœ¯ï¼Œå†åŠ ä¸Šå®‰å“åº•å±‚/è§†é¢‘æŠ€æœ¯æ–¹é¢ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ï¼Œä¾¿çº¯å½“æŠ›ç –å¼•ç‰ã€‚æœ‰å™è¿°ä¸å¦¥ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>Android</tag>
        <tag>scrcpy</tag>
        <tag>æ‰‹æœºæŠ•å±</tag>
        <tag>æ¸¸æˆå½•å±</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ä»£ç è¦†ç›–ç‡æµ‹è¯•ä¹‹ä»£ç æŸ“è‰²ä¼˜åŒ–â€”â€”ä»¥luaä»£ç è¦†ç›–ä¸ºä¾‹</title>
    <url>/2020/06/13/testlife/coverage_beautify/</url>
    <content><![CDATA[<p>åœ¨ç ”å‘ä»£ç è¦†ç›–ç‡æµ‹è¯•å·¥å…·çš„æ—¶å€™ï¼Œé€šå¸¸é™¤äº†ä»£ç è¦†ç›–æ•°æ®æ”¶é›†æ¨¡å—ä¹‹å¤–ï¼Œä¸€èˆ¬è¿˜è¦ç ”å‘å‰ç«¯å±•ç¤ºçš„éƒ¨åˆ†ä»¥å±•ç°ä»£ç è¦†ç›–åˆ†ææŠ¥å‘Šï¼Œé€šå¸¸ä¼šä¸ºæ¯ä¸€ä¸ªæ–‡ä»¶å¢åŠ è¡ŒæŸ“è‰²ï¼Œç±»ä¼¼äº<span class="exturl" data-url="aHR0cHM6Ly93d3cuamFjb2NvLm9yZy9qYWNvY28vdHJ1bmsvY292ZXJhZ2Uvb3JnLmphY29jby5jb3JlL29yZy5qYWNvY28uY29yZS5pbnRlcm5hbC5hbmFseXNpcy5maWx0ZXIvVHJ5V2l0aFJlc291cmNlc0phdmFjRmlsdGVyLmphdmEuaHRtbCNMMTg0" title="https://www.jacoco.org/jacoco/trunk/coverage/org.jacoco.core/org.jacoco.core.internal.analysis.filter/TryWithResourcesJavacFilter.java.html#L184">jacoco<i class="fa fa-external-link"></i></span>è¿™ç§å½¢å¼ã€‚</p>
<p>ç„¶è€Œä»£ç è¦†ç›–æŠ¥å‘Šå®é™…å‡ºæ¥çš„è¡ŒæŸ“è‰²ï¼Œä¼šå‡ºç°è®¸å¤šæ­£å¸¸ä»£ç è¡Œæ²¡æœ‰ç€è‰²çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸ºç¼–ç¨‹è¯­è¨€è®¤ä¸ºçš„â€œè¡Œâ€å’Œæœ¬èº«æˆ‘ä»¬åœ¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å‡ºçš„â€è¡Œâ€œæ˜¯ä¸ä¸€æ ·çš„ã€‚ç¼–è¯‘å‡ºæ¥çš„â€œè¡Œâ€å®é™…ä¸Šæ˜¯ä¸€æ®µæ“ä½œï¼Œæ¯”å¦‚æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨è®¤ä¸ºæˆ‘ä»¬æ‰§è¡Œçš„æ“ä½œæœ‰åŒ…æ‹¬function xxxé‚£ä¸€è¡Œï¼Œäºæ˜¯å°±æœ‰ä¸€ç§æƒ…å†µâ€”â€”æˆ‘ä»¬å®é™…æ²¡æœ‰è¿è¡Œè¿‡è¿™ä¸ªå‡½æ•°ï¼Œä½†ç”±äºå®šä¹‰è¢«è¦†ç›–ï¼Œå› æ­¤å‡ºç°function xxxæŸ“ç»¿ï¼Œè€Œå‡½æ•°ä½“æŸ“çº¢çš„ç°è±¡ã€‚ä»ç”¨æˆ·çš„è§’åº¦è€Œè¨€ï¼Œç”¨æˆ·å¦‚æœå¯¹ä»£ç ç¼–è¯‘è¿™å—å¹¶ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå°±ä¼šé€ æˆç†è§£ä¸Šçš„åå·®ã€‚</p>
<p>å› æ­¤è€ƒè™‘å·¥ä½œæˆæœ¬ï¼Œå¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œéœ€è¦å¯¹ä»£ç è¦†ç›–æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œä»è€Œå±•ç°æ›´å¥½çš„ä»£ç è¡ŒæŸ“è‰²æ•ˆæœã€‚ä»¥luaä¸ºä¾‹ï¼Œå¯ä»¥é‡‡ç”¨è¿™æ ·çš„æ–¹æ³•ï¼š</p>
<a id="more"></a>
<p>luaä»£ç æ”¶é›†å·²ç»åœ¨<span class="exturl" data-url="aHR0cDovL3V0bWhpa2FyaS50b3AvMjAxOS8wMy8xMC9sdWF0YWxrL2x1YWNvdi8=" title="http://utmhikari.top/2019/03/10/luatalk/luacov/">luacovæºç åˆ†æ<i class="fa fa-external-link"></i></span>æœ‰ç›¸å…³è§£è¯»ï¼Œè¿™å—ä¸èµ˜è¿°ã€‚åœ¨ä»£ç ç¼–è¯‘çš„è¯­æ³•åˆ†ææ–¹é¢æœ‰ä¸€ä¸ªç»å…¸çš„æ–¹æ³•å«åš<span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8zMTI3MTg3OQ==" title="https://zhuanlan.zhihu.com/p/31271879">é€’å½’ä¸‹é™æ³•<i class="fa fa-external-link"></i></span>ï¼Œå¦‚æœéœ€è¦æµ‹å®šè¦†ç›–ç‡çš„è¯­è¨€æ˜¯åƒluaè¿™æ ·ç®€å•çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥åº”ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»luaæ–‡ä»¶åŸå§‹çš„è¦†ç›–æ•°æ®ï¼Œæ¨æ–­è¿‘ä¹çœŸå®çš„è¦†ç›–æ•°æ®ã€‚é¦–å…ˆæŠŠä¸€ä¸ªæ–‡ä»¶æ‰€æœ‰çš„ä»£ç åˆ†ä¸ºä¸åŒçš„chunkï¼š</p>
<ul>
<li>main chunk</li>
<li>loop end chunk</li>
<li>do end chunk</li>
<li>(local) function end chunk</li>
<li>if elseif else end chunk</li>
</ul>
<p>è€Œåè‡ªé¡¶å‘ä¸‹é€’å½’ä¸‹é™éå†ä»£ç è¡Œã€‚æˆ‘ä»¬èµ·å§‹å°±å·²ç»åœ¨main chunkï¼Œå› æ­¤ç†è®ºä¸Šæ¥è¯´ï¼Œmain chunkä¸­æ‰€æœ‰ä¸æ˜¯å…¶å®ƒå­chunkçš„ä»£ç éƒ½èƒ½è¢«è¦†ç›–åˆ°ï¼ˆå½“ç„¶ä¹ŸåŒ…æ‹¬do endï¼‰ã€‚è€Œåé’ˆå¯¹loopã€if/elseif/elseã€functionï¼Œåˆ™é‡‡ç”¨å¦‚ä¸‹çš„åˆ¤æ–­æœºåˆ¶ï¼š</p>
<ul>
<li>loopå†…åŠloopè¯­å¥æœ¬èº«çš„ä»£ç è¡Œè¦†ç›–å¤šå°‘æ¬¡ç®—å¤šå°‘æ¬¡</li>
<li>functionå†…å¦‚æœä¸€è¡Œéƒ½æ²¡æœ‰è¦†ç›–ï¼Œé‚£ä¹ˆfunctionä¸endå£°æ˜ä¹Ÿç®—æ²¡æœ‰è¦†ç›–ã€‚å°±ç®—æ˜¯return function() endä¹Ÿä¸€æ ·ï¼Œå› ä¸ºç”¨æˆ·æ¯”è¾ƒå…³å¿ƒè¿™ä¸ªfunctionå®é™…æ˜¯å¦æœ‰è¿è¡Œ</li>
<li>ifæ–¹é¢ï¼Œç»Ÿè®¡æ¯ä¸ªifã€elseifã€elseå—çš„ä»£ç è¦†ç›–ï¼Œåˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼šå…¨éƒ¨è¦†ç›–ã€éƒ¨åˆ†æœªè¦†ç›–ã€å…¨éƒ¨æœªè¦†ç›–ã€‚</li>
</ul>
<p>luaæœ¬èº«æ˜¯ä¸æ”¯æŒæ£€æµ‹ifäº‹ä»¶çš„ï¼Œä½†å®é™…é€šè¿‡è¯­æ³•åˆ†æï¼Œå¯ä»¥æ£€æµ‹åˆ°ifä»£ç å—ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åƒjacocoä¸€æ ·ï¼Œä¸ºifä»£ç è¡ŒæŸ“ä¸€ä¸ªä¸åŒçš„é¢œè‰²ã€‚è‡³äºä»£ç æŸ“è‰²å¦‚ä½•æ ‡è®°ï¼Œå…¶å®å¯ä»¥ç”¨int32çš„é«˜å‡ ä½æ¥æ ‡è®°å¯¹åº”è¡Œçš„é¢œè‰²å°±å¥½äº†ï¼Œè¿™ç§æ–¹æ³•åœ¨åšå¢é‡è¦†ç›–çš„æƒ…å†µä¸‹ä¹Ÿé€‚ç”¨ã€‚</p>
<p>å¦‚æœå‡ºç°xxx endåœ¨åŒä¸€è¡Œçš„æƒ…å†µï¼Œé‚£å°±æ›´å¥½åŠäº†ï¼Œè¯¥è¦†ç›–å‡ æ¬¡æ˜¯å‡ æ¬¡ã€‚</p>
<p>å‡å®šç¨‹åºå‘˜å†™ä»£ç å†™çš„æ¯”è¾ƒè§„èŒƒçš„è¯ï¼Œç”¨è¿™ç§æ–¹æ³•è¿›è¡Œè¡ŒæŸ“è‰²å±•ç°ä»£ç è¦†ç›–æŠ¥å‘Šï¼Œæ•ˆæœå¯æ˜¯çœŸçš„æ æ çš„ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>lua</tag>
        <tag>ä»£ç è¦†ç›–ç‡</tag>
        <tag>ä»£ç æŸ“è‰²</tag>
        <tag>è¯­æ³•åˆ†æ</tag>
        <tag>é€’å½’ä¸‹é™æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘åœ¨UE4æ’ä»¶ä¸­ç¼–å†™ä¸€ä¸ªHTTP Web Server</title>
    <url>/2020/05/23/geekdaily/ue4_http_server/</url>
    <content><![CDATA[<p>åœ¨æŸäº›æ¸¸æˆç ”å‘oræµ‹è¯•çš„éœ€æ±‚ä¸­ï¼Œéœ€è¦åœ¨Unrealå¢åŠ ä¸€ä¸ªæ’ä»¶æˆ–è€…æ¨¡å—ï¼Œé‡Œé¢å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ä½œä¸ºSDKï¼Œç„¶åå¤–éƒ¨é€šè¿‡ç›´è¿æˆ–è€…adb forwardå¯ä»¥è¿æ¥åˆ°å®¢æˆ·ç«¯ä¸­ï¼Œè·å–å®¢æˆ·ç«¯å®æ—¶çš„åœºæ™¯ã€actorä¿¡æ¯ç­‰ç­‰ã€‚UE4æœ¬èº«é™¤äº†socket serveræ”¯æŒä¹‹å¤–ï¼Œä¹Ÿæ”¯æŒç®€å•çš„HTTP Web Serverã€‚ç”±äºç½‘ä¸Šæ²¡æœ‰æ¯”è¾ƒå¥½çš„èŒƒä¾‹ï¼Œå› æ­¤è¿™é‡Œç»™å‡ºä¸€ä¸ªä¾‹å­ã€‚</p>
<p>æœ¬æ–‡ä»¥Unreal 4.24ä¸ºä¾‹ã€‚æ­å»ºHTTP Serverï¼Œéœ€è¦åœ¨<code>.Build.cs</code>ä¸­å¼•å…¥å¦‚ä¸‹æ¨¡å—ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">PrivateDependencyModuleNames.AddRange(</span><br><span class="line">    <span class="keyword">new</span> <span class="keyword">string</span>[]</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"CoreUObject"</span>,</span><br><span class="line">        <span class="string">"Engine"</span>,</span><br><span class="line">        <span class="string">"Slate"</span>,</span><br><span class="line">        <span class="string">"SlateCore"</span>,</span><br><span class="line">        <span class="comment">// ... add private dependencies that you statically link with here ...</span></span><br><span class="line">        <span class="string">"HTTP"</span>,</span><br><span class="line">        <span class="string">"HttpServer"</span>,</span><br><span class="line">        <span class="string">"JsonUtilities"</span>,</span><br><span class="line">        <span class="string">"Json"</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡<code>FHttpServerModule::Get()</code>æ–¹æ³•ï¼Œå¯ä»¥è·å¾—å†…ç½®çš„HTTP Serveræ¨¡å—çš„ä¸€ä¸ªå•ä¾‹ï¼Œè¯¥instanceè´Ÿè´£ç®¡ç†å†…ç½®privateçš„socket listenersã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥å•ä¾‹è·å–<code>HTTPRouter</code>ï¼Œç„¶åç»‘å®šè·¯ç”±è·Ÿhandlerï¼Œç„¶åè°ƒç”¨<code>StartAllListeners</code>ï¼Œå°±èƒ½å¤Ÿå¯åŠ¨WebæœåŠ¡å™¨ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Online/HTTPServer/Public/HttpServerModule.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Runtime/Online/HTTPServer/Public/HttpPath.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¦‚æœæ’ä»¶module typeä¸ºruntimeä¹‹ç±»ï¼Œåªè¦åŒ…æ‹¬ç¼–è¾‘å™¨çš„ï¼Œå°±åŠ è¿™ä¸ªåˆ¤æ–­ï¼Œè¿™æ ·ç¼–è¾‘å™¨é‡Œä¸ä¼šç›´æ¥å¯åŠ¨serverï¼Œè€Œstandaloneæ—¶å€™å¯ä»¥å¯åŠ¨</span></span><br><span class="line">    <span class="comment">// å¦‚æœç¼–è¾‘å™¨é‡Œç›´æ¥å¯åŠ¨äº†ï¼Œé‚£ä¹ˆæ”¹ä»£ç é‡æ–°ç¼–è¯‘ä¼šå¡ä½</span></span><br><span class="line">    <span class="keyword">if</span> (!GIsEditor)</span><br><span class="line">    &#123;</span><br><span class="line">        StartServer(Port);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">StartServer</span><span class="params">(uint32 Port)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> HttpServerModule = &amp;FHttpServerModule::Get();</span><br><span class="line">    TSharedPtr&lt;IHttpRouter&gt; HttpRouter = HttpServerModule-&gt;GetHttpRouter(Port);</span><br><span class="line">    <span class="comment">// è¿™é‡Œæ³¨æ„ä¸€ä¸ªç‚¹ï¼Œå°±æ˜¯åº•å±‚ä¸æ”¯æŒç›¸åŒhttp pathé…ç½®ä¸åŒçš„request method</span></span><br><span class="line">    HttpRouter-&gt;BindRoute(FHttpPath(TEXT(<span class="string">"/health"</span>)), EHttpServerRequestVerbs::VERB_GET, HEALTH_CHECK_HANDLER);</span><br><span class="line">    HttpServerModule-&gt;StartAllListeners();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼ŒHEALTH_CHECK_HANDLERéœ€è¦ä¼ è¿›æ¥ä¸€ä¸ªTFunctionï¼Œå¯ä»¥é€šè¿‡ç›¸å…³ä»£ç æŸ¥é˜…åˆ°ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Runtime\Online\HTTPServer\Private\HttpRouter.cpp</span></span><br><span class="line"></span><br><span class="line">FHttpRouteHandle FHttpRouter::BindRoute(<span class="keyword">const</span> FHttpPath&amp; HttpPath,  <span class="keyword">const</span> EHttpServerRequestVerbs&amp; HttpVerbs,  <span class="keyword">const</span> FHttpRequestHandler&amp; Handler)</span><br><span class="line">&#123;</span><br><span class="line">    check(HttpPath.IsValidPath());</span><br><span class="line">    check(EHttpServerRequestVerbs::VERB_NONE != HttpVerbs);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (RequestHandlerRegistrar-&gt;Contains(HttpPath.GetPath()))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> RouteHandle = MakeShared&lt;FHttpRouteHandleInternal&gt;(HttpPath.GetPath(), HttpVerbs, Handler);</span><br><span class="line">    RequestHandlerRegistrar-&gt;Add(HttpPath.GetPath(), RouteHandle);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> RouteHandle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Runtime\Online\HTTPServer\Public\HttpRequestHandler.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * FHttpRequestHandler</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  NOTE - Returning true implies that the delegate will eventually invoke OnComplete</span></span><br><span class="line"><span class="comment"> *  NOTE - Returning false implies that the delegate will never invoke OnComplete</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param Request The incoming http request to be handled</span></span><br><span class="line"><span class="comment"> * @param OnComplete The callback to invoke to write an http response</span></span><br><span class="line"><span class="comment"> * @return True if the request has been handled, false otherwise</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">typedef</span> TFunction&lt;<span class="keyword">bool</span>(<span class="keyword">const</span> FHttpServerRequest&amp; Request, <span class="keyword">const</span> FHttpResultCallback&amp; OnComplete)&gt; FHttpRequestHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Runtime\Online\HTTPServer\Public\HttpResultCallback.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* FHttpResultCallback</span></span><br><span class="line"><span class="comment">* This callback is intended to be invoked exclusively by FHttpRequestHandler delegates</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* @param Response The response to write</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> TFunction&lt;<span class="keyword">void</span>(TUniquePtr&lt;FHttpServerResponse&gt;&amp;&amp; Response)&gt; FHttpResultCallback;</span><br></pre></td></tr></table></figure>
<p>åœ¨FHttpRequestHandlerå‡½æ•°å†…éƒ¨ä¸­ï¼Œå¦‚æœè°ƒç”¨äº†<code>OnComplete(Response)</code>ä½†<code>return false</code>çš„è¯ï¼Œä¼š<code>CHECK</code>ä¸è¿‡é€ æˆç¨‹åºcrashã€‚å› æ­¤ï¼Œå¯ä»¥å°è£…ä¸€ä¸ªç”Ÿæˆ<code>FHttpRequestHandler</code>çš„å‡½æ•°ï¼Œä½¿å¾—å®é™…åªéœ€è¦æ ¹æ®Requestè¿”å›ä¸€ä¸ªResponseå°±å¯ä»¥ã€‚æˆ‘ä»¬æŠŠè¿™ç§å‡½æ•°è‡ªå®šä¹‰ä¸º<code>FHttpResponser</code>ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> TFunction&lt;TUniquePtr&lt;FHttpServerResponse&gt;(<span class="keyword">const</span> FHttpServerRequest&amp; Request)&gt; FHttpResponser;</span><br><span class="line"></span><br><span class="line"><span class="function">FHttpRequestHandler <span class="title">CreateHandler</span><span class="params">(<span class="keyword">const</span> FHttpResponser&amp; HttpResponser)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> [HttpResponser](<span class="keyword">const</span> FHttpServerRequest&amp; Request, <span class="keyword">const</span> FHttpResultCallback&amp; OnComplete)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> Response = HttpResponser(Request);</span><br><span class="line">        <span class="keyword">if</span> (Response == <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        OnComplete(MoveTemp(Response));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬å®é™…åªéœ€è¦ç¼–å†™<code>FHttpResponser</code>å°±å¯ä»¥äº†ã€‚æ¯”å¦‚ä¸Šé¢çš„HEALTH_CHECK_HANDLERä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">TUniquePtr&lt;FHttpServerResponse&gt; HealthCheck(<span class="keyword">const</span> FHttpServerRequest&amp; Request)</span><br><span class="line">&#123;</span><br><span class="line">    UE_LOG(UALog, Log, TEXT(<span class="string">"Health Check"</span>));</span><br><span class="line">    <span class="keyword">if</span> (GEngine != <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        GEngine-&gt;AddOnScreenDebugMessage(<span class="number">-1</span>, <span class="number">10.0f</span>, FColor::Green, TEXT(<span class="string">"Health Check Successfully!"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> SuccessResponse(<span class="string">"Health Check Successfully!"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HttpRouter-&gt;BindRoute(</span></span><br><span class="line"><span class="comment">//     FHttpPath(TEXT("/health")),</span></span><br><span class="line"><span class="comment">//     EHttpServerRequestVerbs::VERB_GET,</span></span><br><span class="line"><span class="comment">//     CreateHandler(&amp;FBaseHandler::HealthCheck));</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">TUniquePtr&lt;FHttpServerResponse&gt; SuccessResponse(TSharedPtr&lt;FJsonObject&gt; Data, FString Message)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> JsonResponse(Data, Message, <span class="literal">true</span>, SUCCESS_CODE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">TUniquePtr&lt;FHttpServerResponse&gt; JsonResponse(TSharedPtr&lt;FJsonObject&gt; Data, FString Message, <span class="keyword">bool</span> Success, int32 Code)</span><br><span class="line">&#123;</span><br><span class="line">    TSharedPtr&lt;FJsonObject&gt; JsonObject = MakeShareable(<span class="keyword">new</span> FJsonObject());</span><br><span class="line">    JsonObject-&gt;SetObjectField(TEXT(<span class="string">"data"</span>), Data);</span><br><span class="line">    JsonObject-&gt;SetStringField(TEXT(<span class="string">"message"</span>), Message);</span><br><span class="line">    JsonObject-&gt;SetBoolField(TEXT(<span class="string">"success"</span>), Success);</span><br><span class="line">    JsonObject-&gt;SetNumberField(TEXT(<span class="string">"code"</span>), (<span class="keyword">double</span>)Code);</span><br><span class="line">    FString JsonString;</span><br><span class="line">    TSharedRef&lt;TJsonWriter&lt;&gt;&gt; Writer = TJsonWriterFactory&lt;&gt;::Create(&amp;JsonString);</span><br><span class="line">    FJsonSerializer::Serialize(JsonObject.ToSharedRef(), Writer);</span><br><span class="line">    <span class="keyword">return</span> FHttpServerResponse::Create(JsonString, TEXT(<span class="string">"application/json"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºä¸€èˆ¬HTTPè¿”å›çš„bodyæ˜¯jsonï¼Œå› æ­¤å¯ä»¥åƒä¸Šè¿°ä¸€æ ·å¦å¤–å°è£…ä½œä¸ºæ¨¡æ¿response bodyçš„å‡½æ•°ã€‚å¯¹äºrequest bodyï¼Œè¦è½¬æ¢ä¸ºjsonï¼Œå¯ä»¥å¦å¤–åŠ å‡½æ•°å»è·å–<code>TSharedPtr&lt;FJsonObject&gt;</code>çš„request json bodyå®ä¾‹ã€‚é¦–å…ˆæ£€æŸ¥headeræ˜¯å¦ä¸ºjsonæ ¼å¼ï¼Œç„¶åè½¬åŒ–ä¸ºjsonã€‚é‡‡ç”¨<code>UTF8_TO_TCHAR</code>æ–¹æ³•å¯ä»¥æ”¯æŒè½¬æ¢ä¸­æ–‡ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">TSharedPtr&lt;FJsonObject&gt; GetRequestJsonBody(<span class="keyword">const</span> FHttpServerRequest&amp; Request)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// check if content type is application/json</span></span><br><span class="line">    <span class="keyword">bool</span> IsUTF8JsonContent = IsUTF8JsonRequestContent(Request);</span><br><span class="line">    <span class="keyword">if</span> (!IsUTF8JsonContent)</span><br><span class="line">    &#123;</span><br><span class="line">        UE_LOG(UALog, Warning, TEXT(<span class="string">"caught request not in utf-8 application/json body content!"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// body to utf8 string</span></span><br><span class="line">    TArray&lt;uint8&gt; RequestBodyBytes = Request.Body;</span><br><span class="line">    FString RequestBodyString = FString(UTF8_TO_TCHAR(RequestBodyBytes.GetData()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// string to json</span></span><br><span class="line">    TSharedRef&lt;TJsonReader&lt;&gt;&gt; JsonReader = TJsonReaderFactory&lt;&gt;::Create(RequestBodyString);</span><br><span class="line">    TSharedPtr&lt;FJsonObject&gt; RequestBody;</span><br><span class="line">    <span class="keyword">if</span> (!FJsonSerializer::Deserialize(JsonReader, RequestBody))</span><br><span class="line">    &#123;</span><br><span class="line">        UE_LOG(UALog, Warning, TEXT(<span class="string">"failed to parse request string to json: %s"</span>), *RequestBodyString);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> RequestBody;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IsUTF8JsonRequestContent</span><span class="params">(<span class="keyword">const</span> FHttpServerRequest&amp; Request)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> bIsUTF8JsonContent = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; HeaderElem : Request.Headers)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (HeaderElem.Key == TEXT(<span class="string">"Content-type"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; Value : HeaderElem.Value)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">auto</span> LowerValue = Value.ToLower();</span><br><span class="line">                <span class="keyword">if</span> (LowerValue.StartsWith(TEXT(<span class="string">"charset="</span>)) &amp;&amp; LowerValue != TEXT(<span class="string">"charset=utf-8"</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (LowerValue == TEXT(<span class="string">"application/json"</span>) || LowerValue == TEXT(<span class="string">"text/json"</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    bIsUTF8JsonContent = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bIsUTF8JsonContent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼ŒUE4çš„ä¸€ä¸ªåŸºæœ¬çš„C++ HTTP Web Serverå°±æˆå‹äº†ã€‚ç¬”è€…å› ä¹‹åšäº†ä¸€ä¸ªç®€å•çš„æ¨¡æ¿ï¼Œä¼ é€é—¨åœ¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9VbnJlYWxIdHRwU2VydmVy" title="https://github.com/utmhikari/UnrealHttpServer">UnrealHttpAutomator<i class="fa fa-external-link"></i></span>~</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>UE4</tag>
        <tag>C++</tag>
        <tag>webå¼€å‘</tag>
        <tag>UE4æ’ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·GAutomatorä¸Šæ‰‹</title>
    <url>/2020/05/05/testlife/try_gautomator/</url>
    <content><![CDATA[<p>æœ€è¿‘å¼€å§‹ç ”ç©¶ä¸€äº›æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹é¢çš„å†…å®¹ã€‚æ¸¸æˆè‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯æ¸¸æˆæµ‹è¯•ç ”ç©¶é¢†åŸŸçš„éš¾ç‚¹ä¹‹ä¸€ï¼Œå½“å‰ä¸»æµçš„æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é‡‡ç”¨çº¯ç²¹çš„UIè¯†åˆ«æ–¹æ³•è¿›è¡Œï¼Œå…¸å‹çš„ä¾‹å­æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0FpcnRlc3RQcm9qZWN0L0FpcnRlc3Q=" title="https://github.com/AirtestProject/Airtest">Airtest<i class="fa fa-external-link"></i></span>ï¼Œå¦ä¸€ç§æ˜¯ç›´æ¥åµŒå…¥åˆ°æ¸¸æˆå¼•æ“ä¸­è·å–èŠ‚ç‚¹æ ‘ç­‰å…ƒç´ ä»è€Œå¯¹å®ä½“è¿›è¡Œæ“ä½œï¼Œå…¸å‹çš„ä¾‹å­æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvR0F1dG9tYXRvcg==" title="https://github.com/Tencent/GAutomator">GAutomator<i class="fa fa-external-link"></i></span>ã€‚ç”±äºç¬”è€…å…ˆå‰ç•¥å¾®æ¥è§¦è¿‡Airtestæ–¹é¢çš„å†…å®¹ï¼Œå› æ­¤æœ¬æ¬¡å†³å®šä¸Šæ‰‹GAutomatorå°è¯•æ¸¸æˆè‡ªåŠ¨åŒ–ã€‚</p>
<p>æœ¬æ¬¡ä¸Šæ‰‹è¿‡ç¨‹å…·ä½“åˆ™ç”¨GAutomatorå¯¹Unreal4.24ç¤ºä¾‹mobileé¡¹ç›®ä¸­çš„å…ƒç´ è¿›è¡Œæ“ä½œï¼Œåˆ©ç”¨å®‰å“æ‰‹æœºè¿›è¡Œè°ƒè¯•ã€‚åŸºæœ¬åŸç†ä¸Šï¼ŒGAutomatorä¼šä½œä¸ºæ’ä»¶åµŒå…¥åˆ°Unrealé¡¹ç›®ä¸­ï¼Œè‡ªå·±åŒ…å«ä¸€äº›è·å–Worldä¸­ä¿¡æ¯çš„åŠŸèƒ½ï¼Œè€Œålistenä¸€ä¸ªç«¯å£ï¼Œä»è€Œå¤–éƒ¨è¯·æ±‚è¯¥æ’ä»¶å¯ä»¥è·å–Worldä¸­çš„ä¿¡æ¯ã€‚é€šè¿‡adbè¿›è¡Œæ­æ¡¥ï¼Œåœ¨å¤–éƒ¨ï¼Œç”¨æˆ·å¯ä»¥åŸºäº<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvR0F1dG9tYXRvci90cmVlL21hc3Rlci9HQXV0b21hdG9yQW5kcm9pZA==" title="https://github.com/Tencent/GAutomator/tree/master/GAutomatorAndroid">GAutomatorAndroid<i class="fa fa-external-link"></i></span>ç¼–å†™ï¼Œä»è€Œä¸ä»…å¯ä»¥ä¸GAutomatorçš„Unrealæ’ä»¶æ‰“é€šï¼Œè€Œä¸”ä¹Ÿå¯ä»¥é€šè¿‡é¢„å…ˆé›†æˆçš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3hpYW9jb25nL3VpYXV0b21hdG9y" title="https://github.com/xiaocong/uiautomator">UIAutomator<i class="fa fa-external-link"></i></span>è¿™æ ·çš„å·¥å…·ç›´æ¥æ¨¡æ‹Ÿå±å¹•æ“ä½œã€‚</p>
<a id="more"></a>
<p>ç”±äºGAutomatoråŸå…ˆå¯¹äºUnityçš„æ”¯æŒè¾ƒå¥½ï¼Œä½†ç¬”è€…æš‚æ—¶æ²¡è¸©Unityçš„å‘ï¼Œå› æ­¤ä»…é’ˆå¯¹Unrealè€Œè¨€ï¼Œä»ç¬¬ä¸€æ¬¡ä¸Šæ‰‹çš„ä½“éªŒæ¥çœ‹ï¼ŒGAutomatorè¿˜æœ‰è®¸å¤šä¼˜åŒ–ç‚¹ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>GAutomatorçš„è®¾å®šæ›´ç±»ä¼¼å®¢æˆ·ç«¯ä¸­çš„ä¸€ä¸ªå†…åµŒçš„GMæŒ‡ä»¤æœåŠ¡ç«¯ï¼Œä½†å½“å‰çš„â€œå®¢æˆ·ç«¯â€æ˜¯çº¯ç²¹çš„Pythonåº“ï¼Œå› æ­¤éœ€è¦å› GAutomatoræ’ä»¶å®ç°çš„åŠŸèƒ½è€Œè¿›è¡Œç»´æŠ¤æ›´æ–°ã€‚ç†æƒ³çš„æ–¹å¼æ˜¯é‡‡ç”¨GUI+è“å›¾çš„ç”¨æˆ·ä½“éªŒå®ç°ï¼Œé€šè¿‡æäº¤ä»»åŠ¡çš„æ–¹å¼äº¤ä»˜ç»™GAutomator Unrealæ’ä»¶ï¼Œåœ¨æ’ä»¶å†…éƒ¨æ‰§è¡Œå¯¹åº”çš„è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</li>
<li>é’ˆå¯¹æ¸¸æˆç”¨ä¾‹çš„å¤šæ ·æ€§ï¼Œéœ€è¦æ›´å¤šå¯¹ä¸–ç•Œå®ä¾‹è¿›è¡Œæ“ä½œçš„åº•å±‚åŠŸèƒ½æ”¯æŒã€‚ä¸šåŠ¡ç”¨ä¾‹çš„ç»´æŠ¤ä¸èƒ½å¯¹è¿™äº›åº•å±‚åŠŸèƒ½é€ æˆå½±å“ï¼Œå·²ç»å†™å¥½çš„åº•å±‚åŠŸèƒ½ä»…å› å¼•æ“å®ç°ä»¥åŠå®ä½“æ“ä½œéœ€æ±‚çš„æ”¹å˜è€Œæ”¹å˜ã€‚</li>
<li>å¤§æ‰¹é‡ã€å¤šæ¬¡æ¸¸æˆç”¨ä¾‹éœ€è¦è€ƒè™‘å‰ç½®æ¡ä»¶ç”Ÿæˆ/çŠ¶æ€ä¿å­˜ç­‰éœ€æ±‚ï¼Œè¿™äº›éœ€æ±‚å¯èƒ½éœ€è¦åœ¨è‡ªåŠ¨åŒ–æŒ‡ä»¤çš„åŸºç¡€ä¸Šå»ç»“åˆé¢„é…ç½®çš„GMæŒ‡ä»¤ã€‚å› æ­¤å¦‚ä½•è§£è€¦è¿™äº›ä¸åŒçš„ä¸šåŠ¡æ¨¡å—ï¼Œä¹Ÿæ˜¯éœ€è¦è€ƒé‡çš„é—®é¢˜ã€‚</li>
</ul>
<p>æ€»çš„æ¥çœ‹è¿™å—è¿˜æœ‰å¾ˆå¤šæœ‰å¾…æŒ–æ˜çš„åœ°æ–¹ã€‚å¦‚æœæœ‰æœºä¼šå®æˆ˜çš„è¯ï¼Œå†çœ‹çœ‹å§~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>UE4</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>GAutomator</tag>
        <tag>æ‰‹æ¸¸è‡ªåŠ¨åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘åœ¨hugoåšå®¢ä¸­åˆ©ç”¨shortcodeåµŒå…¥bilibiliè§†é¢‘</title>
    <url>/2020/04/21/geekdaily/bilibili_in_hugo/</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly9nb2h1Z28uaW8v" title="https://gohugo.io/">hugo<i class="fa fa-external-link"></i></span>æ˜¯å½“å‰çƒ­é—¨çš„ä¸ªäººåšå®¢æ¡†æ¶ä¹‹ä¸€ï¼Œå’ŒhexoåŒæ ·æ˜¯markdownæ–‡ä»¶è·Ÿåšå®¢å¸–å­ä¸€ä¸€å¯¹åº”ã€‚æœ‰äº›åŒå­¦æƒ³åˆ©ç”¨hugoåˆ¶ä½œä¸ªäººè§†é¢‘åšå®¢ï¼Œä½†å‘ç°åœ¨hugoåšå®¢ä¸­ä¸æ”¯æŒç›´æ¥åœ¨markdowné‡Œè¾“å…¥iframeæ ‡ç­¾ï¼Œä»è€Œæ²¡æœ‰åŠæ³•å°†å…¶å®ƒç½‘ç«™çš„è§†é¢‘ï¼ˆæ¯”å¦‚bç«™ï¼‰åµŒè¿›æ¥ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨hugoå†…ç½®çš„<span class="exturl" data-url="aHR0cHM6Ly9nb2h1Z28uaW8vY29udGVudC1tYW5hZ2VtZW50L3Nob3J0Y29kZXMv" title="https://gohugo.io/content-management/shortcodes/">shortcode<i class="fa fa-external-link"></i></span>æœºåˆ¶å®Œæˆè¿™ä¸ªéœ€æ±‚ã€‚</p>
<p>æˆ‘ä»¬å‚è€ƒçš„æ–‡ç« æ˜¯<span class="exturl" data-url="aHR0cHM6Ly9nb2h1Z28uaW8vdGVtcGxhdGVzL3Nob3J0Y29kZS10ZW1wbGF0ZXMv" title="https://gohugo.io/templates/shortcode-templates/">create your own shortcodes<i class="fa fa-external-link"></i></span>ï¼Œåœ¨è¿™ä¸ªæ–‡æ¡£ä¸­ä»‹ç»äº†è‡ªå®šä¹‰shortcodeä»è€Œå¿«é€Ÿæ¸²æŸ“ç½‘é¡µçš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸¾äº†youtubeä»¥åŠvimeoçš„ä¾‹å­ã€‚ç…§è‘«èŠ¦ç”»ç“¢ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰bç«™çš„shortcodeã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆåœ¨<code>layouts/shortcodes</code>ç›®å½•ä¸‹åˆ›å»º<code>bilibili.html</code>ï¼Œç„¶åå¡«å……å†…å®¹å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span></span></span><br><span class="line"><span class="tag">    <span class="attr">src</span>=<span class="string">"//player.bilibili.com/player.html?bvid=&#123;&#123;.Get 0 &#125;&#125;&amp;page=&#123;&#123; if .Get 1 &#125;&#125;&#123;&#123;.Get 1&#125;&#125;&#123;&#123; else &#125;&#125;1&#123;&#123;end&#125;&#125;"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">scrolling</span>=<span class="string">"no"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">height</span>=<span class="string">"768px"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">width</span>=<span class="string">"1024px"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">frameborder</span>=<span class="string">"no"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">framespacing</span>=<span class="string">"0"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">allowfullscreen</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ•´ä¸ªiframeæ˜¯åŸºäºbç«™åˆ†äº«é“¾æ¥æ¨¡æ¿çš„ã€‚å¯¹äºç”¨æˆ·è€Œè¨€ï¼Œä¸»è¦å…³å¿ƒbvå·è·Ÿpageï¼ˆä¸€ä¸ªbvå¯èƒ½æ˜¯ä¸ªè§†é¢‘åˆ—è¡¨ï¼Œæœ‰å¥½å‡ partï¼‰ã€‚åœ¨<code>bilibili.html</code>ä¸­ï¼Œå®šä¹‰äº†å”¯ä¸€çš„bvå·ä½œä¸ºqueryï¼Œè€Œåpageé»˜è®¤ä¸º1ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡ŒæŒ‡å®šã€‚</p>
<p>å†™å¥½äº†<code>bilibili.html</code>ä¸­ï¼Œåœ¨markdowné‡ŒåµŒå…¥è§†é¢‘çš„è¯ï¼Œç”¨ä»¥ä¸‹å½¢å¼å†™å°±okäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&lt; bilibili BV1RE411b71v &gt;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœéœ€è¦æŒ‡å®špartï¼Œæ¯”å¦‚è¦çœ‹å¤§é€ƒè„±ç¬¬ä¸€å­£ç¬¬3å›ï¼Œè¿™æ ·å†™å°±okäº†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;&lt; bilibili BV18t41187Bx 3 &gt;&#125;&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ä¸ªäººåšå®¢</tag>
        <tag>å‰ç«¯å¼€å‘</tag>
        <tag>hugo</tag>
        <tag>bilibili</tag>
        <tag>shortcode</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘Eclipse Theia &amp; Gitpodâ€”â€”äº‘ç«¯IDEå°é²œ</title>
    <url>/2020/04/13/githubdiscovery/theia_and_gitpod/</url>
    <content><![CDATA[<p>æœ¬æœˆï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VjbGlwc2UtdGhlaWEvdGhlaWE=" title="https://github.com/eclipse-theia/theia">eclipse theia<i class="fa fa-external-link"></i></span>å‘å¸ƒäº†1.0ç‰ˆæœ¬ã€‚ä½œä¸ºä¸€ä¸ªäº‘ç«¯/æ¡Œé¢IDEæ¡†æ¶ï¼Œå¹¶ä¸”é¡¶ç€eclipse foundationçš„åå£°ï¼Œtheiaåœ¨githubä¸Šå—åˆ°ä¸‡ä¼—ç©ç›®ã€‚å› æ­¤ç¬”è€…å†³å®šä¸Šæ‰‹eclipse theiaï¼Œæå‰å“å°ä¸€ä¸‹äº‘ç«¯IDEçš„æ»‹å‘³ã€‚</p>
<p>ç¬”è€…é€‰æ‹©äº†<span class="exturl" data-url="aHR0cHM6Ly93d3cuZ2l0cG9kLmlvLw==" title="https://www.gitpod.io/">gitpod<i class="fa fa-external-link"></i></span>è€Œéæœ¬åœ°dockerä½œä¸ºtheiaçš„å®éªŒå¯¹è±¡ï¼Œè¿™æ˜¯å› ä¸ºgitpodæœ¬èº«å°±æ˜¯theiaçš„æ‰©å±•ç‰ˆï¼Œå¹¶ä¸”æ”¯æŒgithub/gitlabä¸Šçš„é¡¹ç›®å¯¼å…¥ï¼Œç›¸å½“äºäº‘ç«¯github/gitlabé¡¹ç›®çš„IDEï¼Œè¿™æ ·å°±å¯ä»¥å®ç°åœ¨theiaä¸­å¯åŠ¨ä¸€ä¸ªtheiaé¡¹ç›®ï¼Œä¸€æ¢å…¶ä¸­ç©¶ç«Ÿã€‚</p>
<p>ç™»å½•gitpodï¼Œé€‰æ‹©theiaé¡¹ç›®ã€‚é¡¹ç›®çš„é¢„è®¾ä¸­ä¼šè‡ªåŠ¨æ„å»ºå¹¶åœ¨å®¹å™¨çš„3000ç«¯å£å¯åŠ¨theiaã€‚ç‚¹å‡»å³ä¾§çš„previewï¼Œå°±å¯ä»¥åœ¨gitpodçš„theiaä¸­æ‰“å¼€åŸç”Ÿçš„theiaç½‘é¡µã€‚å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨gitpodçš„open in browseræ–¹æ³•ï¼Œåœ¨è‡ªå·±æµè§ˆå™¨çš„æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€åŸç”Ÿçš„theiaã€‚</p>
<a id="more"></a>
<p><img src="/uploads/githubdiscovery/theia_and_gitpod/gitpod.png" alt="Gitpodä¸­æ‰“å¼€theia"></p>
<p>theiaæ˜¯ä»¥vscodeä¸ºåŸºç¡€åˆ¶ä½œçš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŸç”Ÿçš„theiaæ˜¯ä¸åŒ…å«æ’ä»¶å®‰è£…ç­‰åŠŸèƒ½çš„ï¼Œè€Œåœ¨gitpodä¸­ï¼ŒåˆåŸºäºtheiaï¼Œæ”¯æŒäº†vsixæ’ä»¶çš„å®‰è£…ã€é¡¹ç›®ç½‘ç«™æ„å»ºpreviewä»¥åŠæ”¯æŒç”¨æˆ·ä¸»æœºä¸å®¹å™¨äº¤äº’ç­‰ä¸€ç³»åˆ—çš„é¢å¤–åŠŸèƒ½ã€‚æ’ä»¶å®‰è£…æ˜¯IDEçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä¸€å®šç¨‹åº¦ä¸Šå†³å®šäº†æ•´ä¸ªäº§å“çš„ç”Ÿæ€ã€‚ä»¥ä¹‹ä¸ºä¾‹ï¼Œå®‰è£…æµç¨‹èƒ½å¤Ÿè·‘é€šï¼Œä¸”æ’ä»¶å¯ä»¥æŒä¹…åŒ–ï¼ˆé’ˆå¯¹å•ç”¨æˆ·ï¼‰ï¼Œä½†ä¹Ÿæœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œæ¯”å¦‚æ‹¬å·æŸ“è‰²æ’ä»¶ï¼Œbracket pair colorizerå®‰è£…ä¸èƒ½ç”Ÿæ•ˆï¼Œè€Œrainbow bracketså¯ä»¥ç”Ÿæ•ˆã€‚å¯ä»¥è¯´è¿™ä¸€partè¿˜éœ€è¦ç»§ç»­è§‚æœ›ã€‚</p>
<p><img src="/uploads/githubdiscovery/theia_and_gitpod/rainbow_brackets.png" alt="rainbow_brackets"></p>
<p>å¦‚æœæƒ³ä¸´æ—¶å°†è‡ªå·±çš„githubé¡¹ç›®è¿›è¡Œæ›´æ”¹ï¼Œå¯ä»¥å°†ä¹‹æ”¾åœ¨gitpodä¸Šè¿›è¡Œã€‚å…·ä½“çš„æ–¹æ³•æ˜¯ï¼Œåœ¨chromeä¸­å®‰è£…<span class="exturl" data-url="aHR0cHM6Ly9jaHJvbWUuZ29vZ2xlLmNvbS93ZWJzdG9yZS9kZXRhaWwvZ2l0cG9kLW9ubGluZS1pZGUvZG9kbW1vb2Vva2xhZWpvYmdsZWlvZWxsYWRhY2Jla2k=" title="https://chrome.google.com/webstore/detail/gitpod-online-ide/dodmmooeoklaejobgleioelladacbeki">gitpodæ’ä»¶<i class="fa fa-external-link"></i></span>ï¼Œè¿™æ ·åœ¨githubç½‘é¡µé‡Œï¼Œå°±ä¼šé¢å¤–å¤šå‡ºæ¥ä¸€ä¸ªgitpodæŒ‰é’®äº†ã€‚</p>
<p><img src="/uploads/githubdiscovery/theia_and_gitpod/gitpod_button.png" alt="gitpod_button"></p>
<p>ç™»å½•gitpodåï¼Œç‚¹å‡»githubé¡¹ç›®é‡Œçš„gitpodæŒ‰é’®ï¼Œgitpodå°±ä¼šç”Ÿæˆä¸€ä¸ªåŒ…å«è¯¥githubé¡¹ç›®çš„å®¹å™¨ï¼Œå¹¶å¯åŠ¨theiaå°†è¯¥é¡¹ç›®æ”¾åˆ°workspaceä¸­ã€‚ç”¨æˆ·ä¿®æ”¹äº†é¡¹ç›®ä»£ç åå¯ä»¥ç›´æ¥git pushï¼ˆç¬¬ä¸€æ¬¡pushæ—¶ä¼šæç¤ºéœ€è¦æˆæƒï¼‰ï¼Œä»è€Œå¯¹githubé¡¹ç›®è¿›è¡Œæ›´æ–°ã€‚</p>
<p>ç”±äºgitpodä½œä¸ºä¸€é¡¹æœåŠ¡ï¼Œå­˜åœ¨æ”¶è´¹å†…å®¹ï¼Œå¹¶ä¸”æ²¡æœ‰å®¹å™¨è§„æ ¼ç”³è¯·çš„åŠŸèƒ½ä¸šåŠ¡ï¼ŒIDEå‘¨è¾¹æ”¯æŒæš‚ä¸å®Œå–„ï¼Œå› æ­¤ä»ç„¶ä¸èƒ½å–ä»£åŸºäºæœ¬åœ°ä¸»æœºIDEçš„å¼€å‘æµç¨‹ã€‚ä½†æ˜¯cloud IDEç»ˆç©¶è¿˜æ˜¯ç›´æ¥æä¾›äº†ç¯å¢ƒä¸éƒ¨ç½²æµç¨‹ï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºä¸šåŠ¡ä»£ç çš„ç¼–å†™ï¼Œè¿™å—å¯¹äºå¼€å‘æ•ˆç‡çš„æ”¶ç›Šè¿˜æ˜¯éå¸¸å¯è§‚çš„ï¼Œå› æ­¤æ‹­ç›®ä»¥å¾…ã€‚å¦å¤–ï¼Œå¯¹äºtheiaï¼Œå¦‚æœä¸šåŠ¡ä¸­æœ‰åœ¨ç½‘é¡µè¿›è¡Œç¼–ç çš„éœ€æ±‚ï¼Œé‡‡ç”¨theiaæ¡†æ¶æ‰©å±•å¼€å‘ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>ç ”å‘æ•ˆèƒ½</tag>
        <tag>eclipse theia</tag>
        <tag>gitpod</tag>
        <tag>cloud IDE</tag>
        <tag>VSCode</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘è®°ä¸€æ¬¡å¯¼è¡¨æ£€æŸ¥æµç¨‹ä¸­å¯¼è‡´JVMçš„OOMé—®é¢˜</title>
    <url>/2020/03/14/testlife/table_check_oom/</url>
    <content><![CDATA[<p>æœ€è¿‘åœ¨é¡¹ç›®ç»„æµ‹è¯•æœ‰å¼€å‘ä¸€ä¸ªå¯¼è¡¨æ£€æŸ¥çš„éœ€æ±‚ï¼Œå¤§è‡´æ˜¯åœ¨ç­–åˆ’æäº¤è¡¨æ›´æ–°åˆ°svnä¹‹åï¼Œsvnå‘é€post-commitåˆ°ç­–åˆ’è¡¨æ•°æ®æœåŠ¡ï¼Œè€Œåç­–åˆ’è¡¨æ•°æ®æœåŠ¡ä¸‹è½½excelæ–‡ä»¶ï¼Œæ›´æ–°æ•°æ®ä¹‹åï¼Œå°†å¯¼è¡¨æ£€æŸ¥ä¸‹æ¸¸æœåŠ¡æ‰€éœ€çš„æ£€æŸ¥æ•°æ®è¿›è¡Œæ•´åˆï¼Œç„¶åpoståˆ°å¯¼è¡¨æ£€æŸ¥æœåŠ¡ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”±äºåšçš„ä»“ä¿ƒæ²¡æœ‰è€ƒè™‘è®¾è®¡ï¼Œæœ€åç­–åˆ’è¡¨æ•°æ®æœåŠ¡çš„JVMå‘ç”Ÿäº†OOMé—®é¢˜ã€‚ç»è¿‡ä¸€ç•ªæ’æŸ¥æ”¹è¿›äº†è®¾è®¡ï¼Œè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>JVMçš„å†…å­˜ç»“æ„è·ŸGCæµç¨‹æ˜¯è€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ã€‚Java8å»æ‰äº†æ°¸ä¹…åŒºçš„è®¾å®šï¼Œæ›´æ”¹ä¸ºäº†Metaspaceå­˜å‚¨ç±»çš„å…ƒä¿¡æ¯ã€å¸¸é‡ç­‰å†…å®¹ï¼Œè€Œå‰©ä¸‹æ¥ä¾ç„¶æ˜¯æ–°åŒºedenå’Œè€åŒºoldã€‚å½“edenåŒºç©ºé—´æ»¡çš„æ—¶å€™è§¦å‘young gcï¼Œå°†edenåŒºæ ¹èŠ‚ç‚¹ä¸å¯è¾¾çš„å¯¹è±¡æ¸…é™¤ï¼Œå­˜æ´»çš„å¯¹è±¡è½¬åˆ°survivoråŒºã€‚survivoråŒºçš„å¯¹è±¡å¦‚æœç»å†äº†æŸä¸€ä¸ªæ•°ï¼ˆå¯é…ç½®ï¼Œæœ€é«˜15ï¼‰çš„young gcåä»ç„¶å­˜æ´»ï¼Œå°±ä¼šè½¬åˆ°oldåŒºã€‚å¦‚æœçŸ­æ—¶é—´å†…åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œä¸”edenåŒºæ”¾ä¸ä¸‹ï¼Œyoung gcæ²¡æœ‰æ¸…é™¤è¿‡å¤šæ•°æ®çš„æƒ…å†µä¸‹ï¼Œå¤šä½™çš„æ•°æ®ä¼šè½¬åˆ°oldåŒºã€‚å¦‚æœoldåŒºä¹Ÿæ”¾ä¸ä¸‹ï¼Œå°±å‡ºç°OOMï¼ˆOut Of Memoryï¼‰ã€‚ä¸€èˆ¬ä¸šåŠ¡å±‚é¢å¯¼è‡´OOMçš„åŸå› åŸºæœ¬ä¸Šæ˜¯ä¸€æ¬¡äº§ç”Ÿå¤§é‡å¯¹è±¡ï¼Œæˆ–è€…æ˜¯å†…å­˜æ³„éœ²ï¼Œæ²¡æœ‰åŠæ—¶æ¸…é™¤ä¸éœ€è¦çš„æ•°æ®å¼•ç”¨ã€‚</p>
<p>ç­–åˆ’è¡¨æ•°æ®çš„ä¸šåŠ¡é€»è¾‘ä¸Šæ˜¯ä¸‹è½½æ•°æ®-&gt;æ›´æ–°æ•°æ®-&gt;è¿›è¡Œå¯¼è¡¨æ£€æŸ¥çš„ä¸€ä¸ªæµç¨‹ï¼Œå…¶ä¸­ä¸‹è½½ã€æ›´æ–°æ•°æ®è¿™ä¸€ç¯èŠ‚ä¼šäº§ç”Ÿå¤§é‡çš„å¯¹è±¡ï¼Œè€ŒåŒæ ·è¿›è¡Œå¯¼è¡¨æ£€æŸ¥æ—¶ä¸ºäº†å‘å¯¼è¡¨æ£€æŸ¥æ‰€éœ€çš„æ•°æ®ï¼Œä¹Ÿä¼šäº§ç”Ÿå¤§å¯¹è±¡â€”â€”éœ€è¦å°†æ•°æ®åºåˆ—åŒ–ä¸ºjsonå­—ç¬¦ä¸²ã€‚åœ¨è¿™ä¸ªæµç¨‹é‡Œè‡ªå·±çŠ¯äº†å‡ ä¸ªé”™è¯¯å¯¼è‡´OOMçš„é—®é¢˜ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<ul>
<li>å¯¼è¡¨æ£€æŸ¥çš„è®¾è®¡ç›´æ¥é‡‡ç”¨requestæ•°æ®ç„¶ååœ¨responseé‡Œè·å–å¯¼è¡¨æ£€æŸ¥ç»“æœçš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰å¢åŠ å›è°ƒæ¥å£ï¼Œä½¿å¾—å¦‚æœå¯¼è¡¨æ£€æŸ¥æ–¹å‡ºç°é€»è¾‘é—®é¢˜ä¸èƒ½åŠæ—¶è¿”å›ç»“æœçš„è¯ï¼Œå‘é€çš„å¯¼è¡¨æ•°æ®jsonä»¥åŠåºåˆ—åŒ–åçš„ç»“æœå°†ä¸èƒ½è¢«gcï¼Œå¯¼è‡´å†…å­˜æ³„æ¼ã€‚å› æ­¤å¢åŠ äº†ä¸€ä¸ªå›è°ƒæ¥å£ä¾›å¯¼è¡¨æ£€æŸ¥ä¸‹æ¸¸è°ƒç”¨ï¼Œä½¿å¾—httpclientå¯¹è±¡èƒ½å¤Ÿé‡Šæ”¾ï¼Œä»è€Œrequestçš„jsonæ•°æ®å¯ä»¥è¢«young gcç»™æ¶ˆé™¤æ‰ã€‚</li>
<li>requestæ¥å£é‡‡ç”¨ç¬¬ä¸‰æ–¹çš„åº“ï¼Œä¼ å‚æ˜¯json stringï¼Œä½†æ˜¯åœ¨å®é™…postæ—¶å€™ä¼šè°ƒç”¨getBytesï¼Œæ— å½¢ä¸­å¢åŠ äº†å†…å­˜å¼€é”€ã€‚å› æ­¤ç›´æ¥æŠŠç¬¬ä¸‰æ–¹åº“ä»£ç æ‰£ä¸‹æ¥ï¼Œå¹¶ä¸”ç›´æ¥åºåˆ—åŒ–jsonä¸ºbytesï¼Œå‡å°‘å†…å­˜å¼€é”€ã€‚</li>
<li>å¯¼è¡¨æ£€æŸ¥å‰ä¼šå¯¼å…¥æ•°æ®ï¼Œå¯¼å…¥æ•°æ®ä¼šä¸æ–­ä¸‹è½½excelæ–‡ä»¶å¹¶æå–å…¶ä¸­å†…å®¹ï¼Œè¿™ä¸ªæ­¥éª¤æœ‰è§¦å‘young gcçš„å¯èƒ½ã€‚å¦‚æœæŸæ¬¡å¯¼å…¥æ•°æ®ä¹‹åéœ€è¦å¯¼è¡¨æ£€æŸ¥ï¼Œå°±æ‰‹åŠ¨ç”³è¯·ä¸€æ¬¡gc()ï¼Œé¿å…æ½œåœ¨çš„é—®é¢˜ã€‚</li>
<li>å¯¼è¡¨æ£€æŸ¥æ‰€åœ¨çš„å®¹å™¨è§„æ ¼å‡çº§ä¸º8Gå†…å­˜ï¼Œå¹¶åœ¨jvmå¯åŠ¨é€‰é¡¹ä¸­è®¾å®šedenåŒºè·Ÿè€åŒºå„ä¸€åŠï¼ŒsurvivoråŒºæœ€å¤§æ€»å…±å 1/4çš„edenåŒºã€‚</li>
</ul>
<p>æœ€ç»ˆæš‚æ—¶è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå¦‚æœåç»­æœ‰å…¶å®ƒçš„ä¼˜åŒ–ç­–ç•¥ï¼Œè¿˜è¦ç»§ç»­è¡¥å……ã€‚</p>
<hr>
<p>æ›´æ–°ï¼šåç»­æ‰¾åˆ°äº†å†…å­˜æ³„éœ²çš„åŸå› ï¼Œæ˜¯å¯¼è¡¨è¿‡ç¨‹ä¸­ç¼“å­˜å¤§é‡æ•°æ®æ‰€è‡´ï¼Œæœ€ç»ˆä¿®å¤äº†è¿™ä¸ªç¼ºé™·ã€‚è‡³äºJVMæ–¹é¢ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒåŸºæœ¬ä¸Šä¹Ÿä¸éœ€è¦è°ƒå‚çš„å•¦~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>gc</tag>
        <tag>Java</tag>
        <tag>OOM</tag>
        <tag>å†…å­˜æ³„æ¼</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘å†åº¦ä¸Šæ‰‹start-fastapi</title>
    <url>/2020/02/26/geekdaily/start_fastapi_reborn/</url>
    <content><![CDATA[<p>è¿‘æœŸé¡¹ç›®ç»„å‡†å¤‡åšä¸€ä¸ªæ–°çš„å·¥å…·ï¼Œå› æ­¤è‡ªä¸ªå„¿åšçš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9zdGFydC1mYXN0YXBp" title="https://github.com/utmhikari/start-fastapi">start-fastapi<i class="fa fa-external-link"></i></span>æ¡†æ¶æ­£å¥½èƒ½æ´¾ä¸Šç”¨åœºè¯•è¯•æ°´ã€‚åœ¨èµ·è‰éœ€æ±‚æ­å»ºæœ€åˆæ¡†æ¶çš„æ—¶å€™ä¹Ÿé€æ­¥å‘ç°åŸå…ˆçš„start-fastapiæœ‰ä¸€äº›ä¸è¶³çš„åœ°æ–¹ï¼Œå› æ­¤åšäº†ä¸€äº›é’ˆå¯¹æ€§çš„ä¼˜åŒ–ã€‚</p>
<p>é¦–å…ˆå¿…é¡»é‡æ–°ä»‹ç»ä¸€ä¸‹start-fastapiï¼Œå…¶æœ¬èº«æ˜¯è½»é‡çº§webæ¡†æ¶<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RpYW5nb2xvL2Zhc3RhcGk=" title="https://github.com/tiangolo/fastapi">fastapi<i class="fa fa-external-link"></i></span>çš„å»¶ä¼¸ï¼Œä½†æ˜¯ç”±äºfastapiç»™çš„ä¾‹å­è¿‡äºç®€å•ï¼Œå› æ­¤å°±åŸºäºæ­¤åšäº†ä¸€ä¸ªç®€å•çš„webåç«¯è„šæ‰‹æ¶ï¼Œå€Ÿé‰´äº†<span class="exturl" data-url="aHR0cHM6Ly9lZ2dqcy5vcmcvemgtY24vaW50cm8vcXVpY2tzdGFydC5odG1s" title="https://eggjs.org/zh-cn/intro/quickstart.html">eggjs<i class="fa fa-external-link"></i></span>çš„ç›®å½•ç»„ç»‡æ¨¡å‹ï¼Œä½¿å¾—æ•´ä¸ªæ¡†æ¶æ›´åŠ æ˜“äºæŠ•äº§ã€‚å¦‚æœç¨å¾®çœ‹è¿‡start-fastapiå…¶ä¸­çš„ä»£ç çš„è¯å°±èƒ½å¤Ÿå‘ç°å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªOOPçš„æ¡†æ¶ï¼Œè¿™æ˜¯å› ä¸ºä¸€æ–¹é¢pythonæœ¬èº«ä¸æ˜¯å‘javaä¸€èˆ¬ä¸OOè®¾è®¡ç†å¿µå¼ºè€¦åˆï¼Œä¸”å…¶moduleéš”ç¦»ä¸åŠ¨æ€åŠ è½½æœºåˆ¶å·²ç»è¶³å¤ŸåŒºåˆ†æ¯ä¸€ä¸ªåŠŸèƒ½æ¨¡å—äº†ï¼›å¦ä¸€æ–¹é¢è½»é‡çš„HTTP Web Serveræœ¬èº«ä½œä¸ºæ— çŠ¶æ€çš„æœåŠ¡ï¼Œå„ä¸ªåŠŸèƒ½æ¨¡å—åº”è¯¥æ˜¯é™æ€å¼ã€å•ä¾‹å¼çš„å­˜åœ¨ã€‚åœ¨start-fastapiä¸Šä¹Ÿå¯ä»¥ç»§ç»­æ‰©å±•åº•å±‚ã€‚ä»èµ·è‰å·¥å…·çš„æ•ˆæœæ¥çœ‹ï¼Œå¤šäººååŒå¼€å‘æ—¶ï¼Œæ¯ä¸ªäººè´Ÿè´£çš„æ¨¡å—åº”å½“ä¹Ÿä¸ä¼šæœ‰å¤ªå¤§å†²çªçš„æ¦‚ç‡ã€‚</p>
<p>æ¥ä¸‹æ¥æ˜¯è¿‘æœŸä¼˜åŒ–çš„ä¸€äº›ç‚¹ï¼Œé¦–å…ˆæ˜¯applicationç›®å½•ä¸‹çš„ä¼˜åŒ–ã€‚åŸå…ˆapplicationåˆ†ä¸ºäº†serviceã€middlewareã€configç­‰å¤šä¸ªæ¨¡å—ï¼Œä½†ç°åœ¨ç›´æ¥ç¼©å‡ä¸ºcontrollerã€loggerè·Ÿrouterï¼Œè¿™æ˜¯å› ä¸ºserviceè·Ÿmiddlewareé‡Œå…¨å±€æ€§çš„åŠŸèƒ½æ¨¡å—ä¸€èˆ¬éƒ½æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œè€Œcontrollerçš„responseå¯ä»¥çº¦å®šï¼Œlogger factoryä¹Ÿå¯ä»¥ç»Ÿä¸€æä¾›ã€‚è€Œrouterä½œä¸ºåç«¯appçš„å›ºæœ‰åŠŸèƒ½ï¼Œè¿™å—å°±å¿…ä¸å¯å°‘äº†ã€‚</p>
<a id="more"></a>
<p>ç„¶åæ˜¯controllerçš„ä¼˜åŒ–ï¼Œåœ¨å‚è€ƒäº†å®˜ç½‘çš„<span class="exturl" data-url="aHR0cHM6Ly9mYXN0YXBpLnRpYW5nb2xvLmNvbS90dXRvcmlhbC9iaWdnZXItYXBwbGljYXRpb25zLw==" title="https://fastapi.tiangolo.com/tutorial/bigger-applications/">Bigger Applications<i class="fa fa-external-link"></i></span>æ–‡æ¡£ä¹‹åï¼Œæœæ–­æŠŠcontrollerå†™æˆäº†ç»å…¸çš„è£…é¥°å™¨æ¨¡å¼ã€‚è£…é¥°å™¨æ¨¡å¼å¯¹äºä¸šåŠ¡è€Œè¨€æ˜¯å¾ˆå¤§çš„åˆ©å¥½ï¼Œå¦‚æœä¸€ä¸ªæ–°æˆå‘˜ååŒç ”å‘çš„è¯å°±ä¸å¿…åœ¨routerä¸controllersä¹‹é—´åˆ‡æ¥åˆ‡å»ã€‚</p>
<p>æœ€åæ˜¯å¯åŠ¨çš„ä¼˜åŒ–ã€‚åœ¨start-fastapiçš„å…¥å£ä¸­é‡‡ç”¨uvicornå»å¯åŠ¨appç¨‹åºï¼Œä½†è¿™é‡Œç–å¿½äº†ä¸€ä¸ªç‚¹æ˜¯uvicornç›¸å½“äºé‡æ–°loadfileå»è½½å…¥è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„pythonå†…å®¹ï¼Œå› æ­¤å¦‚æœä¸æŠŠfastapi appçš„åˆå§‹åŒ–é€»è¾‘åˆ†ç¦»å‡ºå»ç›¸å½“äºåŠ è½½äº†ä¸¤æ¬¡ã€‚åˆ†ç¦»åˆ°æ ¹ç›®å½•<code>app.py</code>ä¹‹åï¼Œè¿™ä¸ªé—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚</p>
<p>å…³äºuvicornã€starletteã€asgiç›¸å…³çš„ä¸œè¥¿ï¼Œè¿˜æœ‰è®¸å¤šå‘æš‚æ—¶æ²¡æ—¶é—´è¸©ï¼Œè¦æœ‰ç©ºå†æ…¢æ…¢ç§ç§äº†ã€‚</p>
<hr>
<p>æ›´æ–°ï¼šå¦å¤–è§£å†³äº†ä¸€ä¸ªåˆ†ç¦»configé…ç½®çš„é—®é¢˜ï¼Œç°åœ¨uvicorn applicationçš„é…ç½®è¢«åˆ†ç¦»åˆ°<code>config/app</code>ä¸­ï¼Œè€Œ<code>config/dev.cfg</code>ä¸<code>config/prod.cfg</code>åˆ™æ˜¯ç”¨æˆ·å®šä¹‰çš„é…ç½®ï¼Œé‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RoZXNrdW1hci9weXRob24tZG90ZW52" title="https://github.com/theskumar/python-dotenv">python-dotenv<i class="fa fa-external-link"></i></span>çš„æ ¼å¼ã€‚éå¸¸æ–¹ä¾¿ï¼Œç”¨<code>os.getenv</code>å°±èƒ½è·å–åˆ°ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>python</tag>
        <tag>fastapi</tag>
        <tag>start-fastapi</tag>
        <tag>è£…é¥°å™¨æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘å†™ä¸€ä¸ªåŸºäºvuetifyçš„v-autocompleteçš„è‡ªå®šä¹‰ç»„ä»¶</title>
    <url>/2020/02/16/geekdaily/v_autocomplete/</url>
    <content><![CDATA[<p><span class="exturl" data-url="aHR0cHM6Ly92dWV0aWZ5anMuY29tL3poLUhhbnMv" title="https://vuetifyjs.com/zh-Hans/">Vuetify<i class="fa fa-external-link"></i></span>æ˜¯Vueçš„ä¸€å¥—å‰ç«¯ç»„ä»¶æ¡†æ¶ï¼ŒåŸºäºMaterial Designè®¾è®¡ï¼Œç•Œé¢è¾ƒä¸ºæ•´æ´ã€‚æœ€è¿‘ç”±äºé¡¹ç›®éœ€è¦å¼€å§‹å…¥æ‰‹ï¼Œä½†åœ¨å†™è‡ªå®šä¹‰<code>v-autocomplete</code>ç»„ä»¶çš„æ—¶å€™å´è¸©äº†è®¸å¤šå‘ã€‚å› æ­¤æœ¬æ–‡æœæ–­è®°å½•ä¸€ä¸‹è¸©å‘çš„è¿‡ç¨‹ã€‚</p>
<p>é¦–å…ˆæ–°ä¸Šæ‰‹vueçš„è¯è‚¯å®šè€³è¾¹éƒ½ä¼šè¦ç»•ç€â€œåŒå‘ç»‘å®šâ€ä¸€è¯ï¼Œç”¨çš„æœ€å¤šçš„å±æ€§å°±æ˜¯<code>v-model</code>äº†ã€‚ä½†æ˜¯æˆ‘ä»¬å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9jbi52dWVqcy5vcmcvdjIvZ3VpZGUvZm9ybXMuaHRtbA==" title="https://cn.vuejs.org/v2/guide/forms.html">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>å¯ä»¥å‘ç°<code>v-model</code>åªæ˜¯è¯­æ³•ç³–ï¼Œé™¤äº†ç»‘å®šé»˜è®¤ç»„ä»¶çš„å€¼ï¼ˆæ¯”å¦‚<code>select</code>å…ƒç´ æ˜¯<code>value</code>ï¼Œè€Œ<code>checkbox</code>å…ƒç´ æ˜¯<code>checked</code>ï¼‰ä¹‹å¤–ï¼Œè¿˜ä¼šç»‘å®šç›‘å¬ç”¨æˆ·è¾“å…¥äº‹ä»¶ï¼ˆæ¯”å¦‚<code>text</code>å…ƒç´ æ˜¯<code>input</code>ï¼Œè€Œ<code>radio</code>å…ƒç´ æ˜¯<code>change</code>ï¼‰ã€‚å› æ­¤è¦ç”¨<code>v-model</code>çš„è¯éœ€è¦å…³æ³¨ç›¸åº”çš„å…ƒç´ æ˜¯å¦æœ¬èº«å°±æ”¯æŒè¯­æ³•ç³–ã€‚æˆ‘ä»¬åœ¨<span class="exturl" data-url="aHR0cHM6Ly92dWV0aWZ5anMuY29tL3poLUhhbnMvY29tcG9uZW50cy9hdXRvY29tcGxldGVz" title="https://vuetifyjs.com/zh-Hans/components/autocompletes">v-autocompleteå®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>ä¸­å¯ä»¥å‘ç°ï¼Œå…¶æ‰©å±•äº†<code>v-select</code>ç»„ä»¶ï¼Œå› æ­¤å¦‚æœç”¨è‡ªå®šä¹‰ç»„ä»¶åŒ…ä¸€å±‚çš„è¯ï¼Œä¸€èˆ¬ä¸»è¦å…³å¿ƒçš„æ˜¯æ€æ ·ä¼ é€’æœ€ç»ˆé€‰æ‹©çš„valueï¼Œå°±å¯ä»¥äº†ã€‚</p>
<p>æ¯”å¦‚è¦åšä¸€ä¸ªå¼‚æ­¥æ£€ç´¢itemsçš„<code>v-autocomplete</code>ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹çš„æ–¹å¼è‡ªå®šä¹‰ï¼š</p>
<p>å…¶ä¸­templateå¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">v-autocomplete</span>&gt;</span></span><br><span class="line">        :v-model="select"</span><br><span class="line">        :items="items"</span><br><span class="line">        :loading="loading"</span><br><span class="line">        :search-input.sync="search"</span><br><span class="line">        item-text="text"</span><br><span class="line">        item-value="value"</span><br><span class="line">    <span class="tag">&lt;/<span class="name">v-autocomplete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åscriptå¦‚ä¸‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡å…¶å®ƒå±æ€§</span></span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            items: [],</span><br><span class="line">            loading: <span class="literal">false</span>,</span><br><span class="line">            currentSearchValue: <span class="string">''</span>,</span><br><span class="line">            search: <span class="literal">null</span>,</span><br><span class="line">            select: <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">        select(val) &#123;</span><br><span class="line">            <span class="comment">// è§¦å‘changeValäº‹ä»¶ï¼Œæ›´æ”¹selectåˆ°çš„itemçš„value</span></span><br><span class="line">            <span class="keyword">this</span>.$emit(<span class="string">'changeVal'</span>, val)</span><br><span class="line">        &#125;,</span><br><span class="line">        search(val) &#123;</span><br><span class="line">            <span class="keyword">this</span>.currentValue = val</span><br><span class="line">            <span class="comment">// æ³¨æ„ä¿æŒç¼“å­˜çš„itemsï¼Œä¸è¦åŠ æ¸…ç©ºitemsçš„é€»è¾‘ï¼Œå¦åˆ™å…ˆå‰ä¼ å‡ºå»çš„itemçš„valueï¼ˆselectï¼‰ä¹Ÿæ²¡äº†</span></span><br><span class="line">            <span class="keyword">this</span>.handleSearch(val)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleSearch(v) &#123;</span><br><span class="line">            <span class="keyword">var</span> _this = <span class="keyword">this</span></span><br><span class="line">            setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (!_this.currentValue === v) &#123;</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">                &#125;</span><br><span class="line">                _this.loading = <span class="literal">true</span></span><br><span class="line">                <span class="comment">// ä¸‹é¢æ˜¯è‡ªå®šä¹‰çš„æ£€ç´¢itemsçš„é€»è¾‘</span></span><br><span class="line">                asyncSearch().then(<span class="function">(<span class="params">resp</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (resp.code === <span class="number">200</span> &amp;&amp; _this.currentValue === v) &#123;</span><br><span class="line">                        _this.items = resp.data.map(<span class="function"><span class="params">d</span> =&gt;</span> (&#123;</span><br><span class="line">                            ...d,</span><br><span class="line">                            text: d.textPart,  <span class="comment">// æ˜¾ç¤ºçš„æ–‡æœ¬</span></span><br><span class="line">                            value: d.valuePart,  <span class="comment">// çœŸæ­£è¦ä¼ å‡ºå»çš„å€¼</span></span><br><span class="line">                        &#125;))</span><br><span class="line">                    &#125;</span><br><span class="line">                    _this.loading = <span class="literal">false</span></span><br><span class="line">                &#125;).catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    _this.loading = <span class="literal">false</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;, <span class="number">200</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨æ¥å—ç»„ä»¶å€¼çš„é‚£ä¸€ç«¯ï¼Œå‡è®¾æˆ‘ä»¬è‡ªå®šä¹‰ç»„ä»¶å«<code>CustomVAutoComplete</code>çš„è¯ã€‚åªéœ€è¦å†™ï¼š</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CustomVAutoComplete</span> @<span class="attr">changeVal</span>=<span class="string">"handleValChange"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡å…¶å®ƒå±æ€§</span></span><br><span class="line">    data() &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            autoCompleteVal: <span class="string">''</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleValChange(v) &#123;</span><br><span class="line">            <span class="keyword">this</span>.autoCompleteVal = v</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥äº†</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>å‰ç«¯å¼€å‘</tag>
        <tag>vue</tag>
        <tag>vuetify</tag>
        <tag>v-autocomplete</tag>
        <tag>v-model</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘FastAPIâ€”â€”æ–°ä¸€ä»£å®ç”¨pythonè½»é‡çº§Webåç«¯æ¡†æ¶</title>
    <url>/2020/02/01/githubdiscovery/fastapi/</url>
    <content><![CDATA[<p>æœ¬æœˆï¼Œä¸€æ¬¾åä¸º<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3RpYW5nb2xvL2Zhc3RhcGk=" title="https://github.com/tiangolo/fastapi">FastAPI<i class="fa fa-external-link"></i></span>çš„è½»é‡çº§Webæ¡†æ¶åœ¨trendingæ¦œä¸Šæœ‰åã€‚æœ¬ç€è¸©å‘çš„å¿ƒæ€è¯•ç”¨äº†fastapiï¼Œå‘ç°å…¶å‘å¹¶æ²¡æœ‰è®¸å¤šç›¸åŒé‡çº§webæ¡†æ¶ï¼ˆæ¯”å¦‚flaskï¼‰æ¥çš„å¤šï¼Œä¸Šæ‰‹æå…¶å®¹æ˜“ã€‚å› æ­¤æœæ–­æ•´ç†äº†ä¸€ä¸‹fastapiçš„ä¸Šæ‰‹è¿‡ç¨‹ã€‚</p>
<p>FastAPIåŸºäº<span class="exturl" data-url="aHR0cHM6Ly93d3cuc3RhcmxldHRlLmlvLw==" title="https://www.starlette.io/">Starlette<i class="fa fa-external-link"></i></span>ç½‘ç»œæ¡†æ¶è¿›è¡Œå°è£…ï¼Œä¸ä»…æ€§èƒ½ä¼˜å¼‚ï¼Œå¹¶ä¸”è§£å†³äº†è®¸å¤šç”¨pythonå¼€å‘æ•ˆç‡å·¥å…·æˆ–æ˜¯è½»é‡çº§åº”ç”¨çš„åç«¯åŒå­¦çš„ç—›ç‚¹ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>ç»“åˆ<span class="exturl" data-url="aHR0cHM6Ly9weWRhbnRpYy1kb2NzLmhlbHBtYW51YWwuaW8v" title="https://pydantic-docs.helpmanual.io/">pydantic<i class="fa fa-external-link"></i></span>ï¼Œå®ç°paramä¸bodyçš„é™æ€ç±»å‹æ£€æŸ¥</li>
<li>ç”¨å¦¥å½“çš„æ–¹å¼æ¥æ”¶/è¿”å›json body</li>
<li>ç»“åˆStarletteï¼Œä»è€Œè‡ªå¸¦restful apiä»¥åŠmiddlewareçš„æ”¯æŒ</li>
<li>è‡ªå¸¦è°ƒè¯•routerï¼ŒåŸºæœ¬é¡¶æ›¿postmançš„å·¥ä½œ</li>
<li>etc</li>
</ul>
<p>å®‰è£…fastapiéœ€è¦python3.6ä»¥ä¸Šï¼Œé¢„å…ˆ<code>pip3 install fastapi uvicorn</code>ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹FastAPIçš„ä¾‹å­ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># example.py</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel</span><br><span class="line"><span class="keyword">import</span> uvicorn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app = FastAPI()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span><span class="params">(BaseModel)</span>:</span></span><br><span class="line">    name: str</span><br><span class="line">    price: float</span><br><span class="line">    is_offer: bool = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get("/")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_root</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">"Hello"</span>: <span class="string">"World"</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get("/items/&#123;item_id&#125;")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_item</span><span class="params">(item_id: int, q: str = None)</span>:</span>  <span class="comment"># æ­¤å¤„qä¸ºqueryçš„å­—æ®µ</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">"item_id"</span>: item_id, <span class="string">"q"</span>: q&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.put("/items/&#123;item_id&#125;")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">update_item</span><span class="params">(item_id: int, item: Item)</span>:</span>  <span class="comment"># æ­¤å¤„Itemä¸ºbodyçš„schema</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">"item_name"</span>: item.name, <span class="string">"item_id"</span>: item_id&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    uvicorn.run(<span class="string">'example:app'</span>)</span><br></pre></td></tr></table></figure>
<p>é‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly93d3cudXZpY29ybi5vcmcv" title="https://www.uvicorn.org/">Uvicorn<i class="fa fa-external-link"></i></span>æ‰“å¼€<code>app</code>ï¼Œæˆ‘ä»¬çš„åç«¯ä¾¿èƒ½å¤Ÿèµ·èµ·æ¥ã€‚è¿›å…¥<code>http://localhost:8000/docs</code>ï¼Œå°±èƒ½å¤Ÿè¿›å…¥è·¯ç”±çš„æè¿°ä¸è°ƒè¯•ç•Œé¢ã€‚<br>åœ¨è°ƒè¯•ç•Œé¢ä¸­æˆ‘ä»¬å¯ä»¥è‡ªå·±è¾“å…¥params/query/bodyï¼Œå¦‚æœè¾“å…¥å€¼çš„ç±»å‹ä¸å¯¹æˆ–è€…æ˜¯ç¼ºå°‘ç›¸åº”çš„bodyå­—æ®µï¼Œresponseä¼šè‡ªåŠ¨å¸¦é”™è¯¯ç ä»¥åŠdetailä¿¡æ¯ã€‚æ¯”å¦‚åœ¨<code>put /items/{item_id}</code>ä¸­ï¼Œæˆ‘ä»¬è¾“å…¥bodyä¸ºï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"named"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="attr">"price"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">"is_offer"</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®Item modelå®šä¹‰ç¼ºå°‘äº†nameå­—æ®µï¼Œæ•…è¿”å›422é”™è¯¯ç ä»¥åŠjson bodyï¼š</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"detail"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"loc"</span>: [</span><br><span class="line">        <span class="string">"body"</span>,</span><br><span class="line">        <span class="string">"item"</span>,</span><br><span class="line">        <span class="string">"name"</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">"msg"</span>: <span class="string">"field required"</span>,</span><br><span class="line">      <span class="attr">"type"</span>: <span class="string">"value_error.missing"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥è¯´å¯¹äºå¼€å‘äººå‘˜è€Œè¨€æ˜¯éå¸¸æ–¹ä¾¿äº†ã€‚</p>
<p>å®é™…é‡‡ç”¨fastapi + uvicornå¼€å‘æ—¶ä¼šé‡åˆ°éƒ¨åˆ†customizationçš„é—®é¢˜ï¼Œæ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRUUC9BY2Nlc3NfY29udHJvbF9DT1JT" title="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Access_control_CORS">è·¨åŸŸcors<i class="fa fa-external-link"></i></span>çš„headerå¤„ç†ä»¥åŠloggeré…ç½®ä¹‹ç±»ã€‚é’ˆå¯¹è¿™äº›ï¼Œç¬”è€…æŠŠfastapiå¯èƒ½ç”¨åˆ°çš„ä¸€äº›åŸºæœ¬çš„åç«¯é…ç½®ä¸ç›®å½•ç»“æ„è¿›è¡Œäº†æ•´ç†ï¼Œæ”¾åˆ°äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9zdGFydC1mYXN0YXBp" title="https://github.com/utmhikari/start-fastapi">start-fastapi<i class="fa fa-external-link"></i></span>é¡¹ç›®ä¸­ï¼Œç›¸å½“äºä¸€ä¸ªæ¨¡æ¿ã€‚é’ˆå¯¹ä¸Šè¿°çš„ä¾‹å­ï¼Œè·¨åŸŸå¤„ç†ä¸€èˆ¬æ”¾åˆ°middlewareä¸­ï¼Œå¯ä»¥æ·»åŠ Starletteæ‰€å¸¦çš„CORSMiddlewareè¿›è¡Œå¤„ç†ï¼›è€Œç”¨uvicornå¯åŠ¨çš„è¯ï¼Œloggingæ—¥å¿—æ¨¡å—ä¼šè¢«uvicorné‡å†™ï¼Œå› æ­¤è‹¥è¦è‡ªå®šä¹‰æ—¥å¿—ï¼Œéœ€è¦å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VuY29kZS91dmljb3JuL2Jsb2IvbWFzdGVyL3V2aWNvcm4vY29uZmlnLnB5" title="https://github.com/encode/uvicorn/blob/master/uvicorn/config.py">uvicorn config<i class="fa fa-external-link"></i></span>ä¸­çš„<code>LOGGING_CONFIG</code>æ¥è‡ªå·±é‡å†™ï¼ŒåŠ è½½åˆ°uvicornçš„<code>log_config</code>é…ç½®ä¸­ã€‚å¦‚æœè¿˜æœ‰é¢å¤–çš„è‡ªå®šä¹‰éœ€æ±‚ï¼Œå¯å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9mYXN0YXBpLnRpYW5nb2xvLmNvbS9wcm9qZWN0LWdlbmVyYXRpb24v" title="https://fastapi.tiangolo.com/project-generation/">fastapié¡¹ç›®ç”Ÿæˆæ¨¡æ¿<i class="fa fa-external-link"></i></span>ä»¥åŠè¯¥å®˜ç½‘ä¸­å…¶å®ƒçš„æ–‡æ¡£è‡ªè¡Œå®šåˆ¶ã€‚</p>
<p>FastAPIçš„ç”Ÿäº§ç¯å¢ƒæš‚æ—¶æ²¡æœ‰è¸©å‘ã€‚ä½†ä»FastAPIçš„å®šä½ä»¥åŠç ”å‘ç¯å¢ƒæä¾›çš„åŠŸèƒ½ä¸APIæ¥çœ‹ï¼Œå·²ç»èƒ½å¤Ÿæå¤§æå‡ç ”å‘æ•ˆèƒ½ã€‚åç»­æœ‰ç©ºå†å°è£…ä¸‹ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æµç¨‹ï¼Œä»¥åè¦å¼€å‘åç«¯å°å·¥å…·å°±åŸºæœ¬ä¸Šç”¨è¿™ä¸ªè·Ÿstart-fastapiä¸Šäº†ã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>python</tag>
        <tag>fastapi</tag>
        <tag>æ•ˆç‡å·¥å…·</tag>
        <tag>webå¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ä¸ºæ¸¸æˆç­–åˆ’ä¸QAé‡èº«å®šåˆ¶çš„excelè¡¨diffç®—æ³•</title>
    <url>/2020/01/23/testlife/excel_diff/</url>
    <content><![CDATA[<p>å›½å†…çš„æ¸¸æˆç ”å‘å›¢é˜Ÿé‡Œè®¸å¤šç­–åˆ’åŒå­¦éƒ½ä¹ æƒ¯é‡‡ç”¨excelä½œä¸ºé…è¡¨å·¥å…·ã€‚å› æ­¤å¯¹ç­–åˆ’åŒå­¦æ ¡å¯¹ä¸QAåŒå­¦éªŒæ”¶å·¥ä½œæ¥è¯´ï¼Œéœ€è¦ç›¸åº”çš„diffå·¥å…·å»æ£€æµ‹excelæ–‡ä»¶çš„å˜æ›´ï¼Œä»è€Œèƒ½å¤Ÿå°½æ—©å‘ç°é…è¡¨çš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œåœ¨ç¬”è€…å¯åŠ¨çš„æ¸¸æˆæ•ˆç‡å·¥å…·é›†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nYW1lZmYtdG9vbHNldA==" title="https://github.com/utmhikari/gameff-toolset">gameff-toolset<i class="fa fa-external-link"></i></span>å°é¡¹ç›®ä¸­ï¼Œé¦–ä¸ªå°è„šæœ¬ä¾¿åšäº†excel diffã€‚</p>
<p>diffçš„ç®—æ³•æœ‰éå¸¸å¤šï¼Œä½†æ˜¯å¦‚ä½•ä½“ç°ç­–åˆ’è¡¨ä¸ç­–åˆ’å·¥ä½œçš„ç‰¹æ€§ï¼Œè¿™æ‰æ˜¯æœ€éœ€è¦æ³¨æ„çš„ã€‚è®¸å¤šé¡¹ç›®çš„ç­–åˆ’è¡¨éƒ½é€šè¿‡SVNè¿›è¡Œå­˜å‚¨ï¼Œå› æ­¤ä»SVNçš„commitä¿¡æ¯ä¸­å°±å¯ä»¥çŸ¥é“å“ªäº›ç­–åˆ’è¡¨å‘ç”Ÿäº†å˜æ›´/å¢åŠ ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åªéœ€å…³å¿ƒæ¯ä¸ªexcelæ–‡ä»¶å¦‚ä½•è¿›è¡Œdiffè¿ç®—å°±å¯ä»¥äº†ã€‚</p>
<p>ç­–åˆ’çš„excelé…è¡¨æœ‰å¦‚ä¸‹çš„ç‰¹ç‚¹ï¼š</p>
<a id="more"></a>
<ul>
<li>æ¯ä¸ªsheetæœ‰è¡¨å¤´headerï¼Œä¸€èˆ¬ä¸ºè¡Œè¡¨å¤´header</li>
<li>headerä¸€èˆ¬å®šä¸‹åä¸ä¼šå†å˜åŒ–</li>
<li>ä¸åŒçš„sheetï¼Œè¡¨ç»“æ„åŸºæœ¬ä¸åŒ</li>
<li>rowä¸ä¸€å®šæœ‰ä¸»é”®ï¼Œç”šè‡³åŒsheetæœ‰é‡å¤çš„id</li>
<li>æ¯æ¬¡å˜æ›´æ—¶ï¼Œå˜æ›´çš„è¡Œæ•°ç›¸å¯¹ä¸å˜çš„è¡Œæ•°è¾ƒå°‘</li>
<li>å¯èƒ½å­˜åœ¨å°†æŸäº›è¡Œç§»åŠ¨åˆ°å…¶å®ƒä½ç½®çš„æƒ…å†µ</li>
<li>ç­–åˆ’åŒå­¦åœ¨excelæŸäº›ç©ºç™½åŒºåŸŸå¯èƒ½ä¼šåŠ ä¸Šæ³¨é‡Š</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ä»sheetçš„ç²’åº¦æ¥çœ‹ï¼Œdiffæ¨¡å—å¯ä»¥è¿™æ ·è®¾è®¡ï¼š</p>
<ul>
<li>å®šä¹‰è¡¨å¤´è¡Œindexï¼Œæ•°æ®èµ·å§‹è¡Œindexï¼Œæ•°æ®èµ·å§‹åˆ—index</li>
<li>ç»Ÿè®¡å¢åŠ ä¸å»é™¤çš„è¡¨å¤´ã€‚å¦‚æœå•çº¯è¡¨å¤´åç§°æ”¹äº†ï¼Œä¸‹é¢çš„æ•°æ®æ”¹åŠ¨åŸºæœ¬æ²¡æœ‰ï¼Œä¹Ÿç®—æ•´ä¸ªåˆ—éƒ½æ”¹äº†ã€‚è¿™æ ·ï¼Œåˆ—çš„é•¿åº¦å°±å˜å¾—ä¸€æ ·äº†ã€‚</li>
<li>å¯¹äºå…±æœ‰çš„è¡¨å¤´ï¼Œç»Ÿè®¡ä¸‹é¢çš„è¡Œæ•°æ®ï¼Œå»é™¤ä¸åˆæ³•çš„è¡Œã€‚å¦‚æœè¡Œä¸­èµ·å§‹åˆ—ä¸Šæ²¡æœ‰æ•°æ®ï¼Œå°±ç®—ä¸åˆæ³•ã€‚</li>
<li>é€šè¿‡æ±‚è¡Œçš„hashï¼Œæ¥è·å¾—å˜æ›´å‰excelä¸å˜æ›´åexcelä¸­è¡Œçš„æ˜ å°„ï¼Œä»è€ŒçŸ¥é“å“ªäº›è¡Œæ²¡æœ‰å˜åŠ¨ï¼Œå“ªäº›è¡Œå˜åŠ¨äº†ã€‚</li>
<li>é’ˆå¯¹æ²¡æœ‰å˜åŠ¨çš„è¡Œï¼Œæ±‚å˜æ›´åexcelä¸­è¿™äº›è¡Œçš„ç´¢å¼•çš„<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTG9uZ2VzdF9pbmNyZWFzaW5nX3N1YnNlcXVlbmNl" title="https://en.wikipedia.org/wiki/Longest_increasing_subsequence">LIS<i class="fa fa-external-link"></i></span>ã€‚å…·ä½“çš„æ±‚æ³•å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzk5MjY5Ny9sb25nZXN0LWluY3JlYXNpbmctc3Vic2VxdWVuY2U=" title="https://stackoverflow.com/questions/3992697/longest-increasing-subsequence">stackoverflow<i class="fa fa-external-link"></i></span>ä¸Šçš„ä¸€ä¸ªå¸–å­ï¼Œä¸»è¦æ€æƒ³æ˜¯ç”¨ä¸¤ä¸ªæ•°ç»„åˆ†åˆ«ç»´æŠ¤é•¿ä¸ºxçš„lisçš„æœ€åä¸€ä¸ªæ•°çš„æœ€å°ç´¢å¼•ä»¥åŠæŸç´¢å¼•çš„æ•°ä½œä¸ºlisæœ€åä¸€ä¸ªæ•°æ—¶å‰ä¸€ä¸ªæ•°çš„ç´¢å¼•ï¼Œç„¶åé€šè¿‡å›æº¯åä¸€ä¸ªæ•°ç»„ï¼Œä»è€Œè·å¾—lisä¸²ã€‚é€šè¿‡lisä¸²ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å“ªäº›è¡Œåªæ˜¯å•çº¯åœ°è¢«ç§»åŠ¨ä½ç½®ï¼Œè€Œå…¶ä¸­å†…å®¹å¹¶æ²¡æœ‰è¢«æ”¹åŠ¨è¿‡ã€‚</li>
<li>é’ˆå¯¹â€œå˜åŠ¨â€çš„è¡Œï¼Œä¹Ÿåˆ†ä¸‰ç§æƒ…å†µï¼šå¢åŠ è¡Œï¼Œåˆ å‡è¡Œä¸ä¿®æ”¹è¡Œã€‚ç”±äºæ¯æ¬¡å˜æ›´æ‰€æ¶‰åŠçš„è¡Œä¸€èˆ¬ä¸å¤šï¼Œå› æ­¤å¯ä»¥é‡‡ç”¨o(næ–¹)å¤æ‚åº¦çš„æ–¹æ³•æ¯è¡Œé€æ ¼æ¯”è¾ƒã€‚é€šè¿‡é€æ ¼æ¯”è¾ƒï¼Œå¯ä»¥æ±‚å‡ºè¡Œé—´ç›¸ä¼¼åº¦ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç›¸ä¼¼åº¦é˜ˆå€¼æ¥åˆ¤æ–­ä¸¤è¡Œæ˜¯å¦ç›¸ä¼¼ã€‚å¦‚æœæŸä¸ªè¡Œè·ŸåŸæ¥çš„è¡Œçš„ç›¸ä¼¼åº¦å¤§äºé˜ˆå€¼ï¼Œå°±è¯´æ˜è¿™ä¸¤è¡Œç›¸å¯¹åº”ï¼Œæ˜¯ä¸€ä¸ªâ€œä¿®æ”¹è¡Œâ€çš„è¡Œä¸ºï¼Œæ•…æˆ‘ä»¬åªéœ€è®°å½•å…¶ä¸­å•å…ƒæ ¼çš„å˜åŒ–ï¼›å¦‚æœä»å˜æ›´å‰çš„æŸè¡Œæ‰¾ä¸åˆ°ç›¸ä¼¼çš„å˜æ›´åçš„æŸè¡Œï¼Œå°±æ˜¯ä¸€ä¸ªâ€œåˆ å‡è¡Œâ€çš„è¡Œä¸ºï¼›å¦‚æœæœ‰äº›å˜æ›´åçš„è¡Œæ²¡æœ‰å˜æ›´å‰çš„è¡Œå¯¹åº”ï¼Œå°±æ˜¯ä¸€ä¸ªâ€œå¢åŠ è¡Œâ€çš„è¡Œä¸ºã€‚</li>
</ul>
<p>è¿™ä¸ªæ¨¡å—è¯¦ç»†çš„ä»£ç å·²ç»å†™åœ¨äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nYW1lZmYtdG9vbHNldC9ibG9iL21hc3Rlci9saWIvZXhjZWxfZGlmZmVyLnB5" title="https://github.com/utmhikari/gameff-toolset/blob/master/lib/excel_differ.py">excel_differ.py<i class="fa fa-external-link"></i></span>ä¸­ï¼Œè™½ç„¶æ²¡æœ‰è¿‡äºç»†è‡´çš„æ•´ç†ï¼Œå¯èƒ½æœ‰è®¸å¤šä¼˜åŒ–ç©ºé—´ï¼Œä½†æ¨¡å—å·²ç»æ‹†åˆ†çš„è¶³å¤Ÿæ˜ç¡®ï¼Œå¹¶ä¸”æ€§èƒ½è¡¨ç°ä¹Ÿè¶³å¤ŸOKäº†ã€‚å¦‚æœæ‹¿ä¸¤ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„excelæ–‡ä»¶ä½œä¸ºå¯¹æ¯”çš„è¯ï¼Œå¯ä»¥è¾“å‡ºä¸€ä¸ªç±»ä¼¼äº<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nYW1lZmYtdG9vbHNldC9ibG9iL21hc3Rlci90ZXN0L2V4Y2VsX2RpZmZlci9yZXBvcnQuanNvbg==" title="https://github.com/utmhikari/gameff-toolset/blob/master/test/excel_differ/report.json">è¿™æ ·<i class="fa fa-external-link"></i></span>çš„jsonæŠ¥å‘Šã€‚å› æ­¤è‹¥è¦æŠ•äº§ï¼Œä¸è®ºæ˜¯å•çº¯copypasteè„šæœ¬ï¼Œè¿˜æ˜¯æ¥åˆ°web serverï¼Œéƒ½ç»°ç»°æœ‰ä½™äº†ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ¸¸æˆç­–åˆ’</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>excel-diff</tag>
        <tag>diffç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘è§£å†³ä½¿ç”¨mongodbæ—¶åŒæ—¶updateå¤šæ¡æ•°æ®çš„é—®é¢˜</title>
    <url>/2020/01/12/geekdaily/mongo_multi_updatemany/</url>
    <content><![CDATA[<p>åœ¨å®é™…ä½¿ç”¨mongodbçš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°å¤šä¸ªè¯·æ±‚åŒæ—¶åœ¨æŸä¸ªcollectioné‡Œupdateå¤šæ¡documentçš„éœ€æ±‚ã€‚è¿™ä¸ªéœ€æ±‚çœ‹ä¼¼æœ‰è®¸å¤šç§è§£æ³•ï¼Œä½†æ˜¯å…·ä½“å“ªç§å¥½ä¹Ÿè¯´ä¸å‡†ã€‚ç°åœ¨ä¾¿è®©æˆ‘ä»¬ä¸€æ¢ç©¶ç«Ÿå§~</p>
<p>é¦–å…ˆæˆ‘ä»¬åˆ©ç”¨pymongoæ·»åŠ 1000000æ¡æ•°æ®ï¼Œnameå­—æ®µä¸ºhelloï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line">client = MongoClient()</span><br><span class="line">db = client[<span class="string">'test'</span>]</span><br><span class="line">coll = db[<span class="string">'concurrency'</span>]</span><br><span class="line"></span><br><span class="line">coll.insert_many([</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"hello"</span>,</span><br><span class="line">        <span class="string">"num"</span>: i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000000</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬å¦å¤–åŠ ä¸€ä¸ªè¿›ç¨‹ï¼Œå¯åŠ¨ä»»åŠ¡ä¸ºå°†numå­—æ®µä¸ºå¶æ•°çš„documentsçš„nameå­—æ®µç»™updateæˆaaï¼Œè€Œä¸»çº¿ç¨‹åˆ™updateæ‰€æœ‰documentsçš„nameå­—æ®µä¸ºbbã€‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, Process</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">client = MongoClient()</span><br><span class="line">db = client[<span class="string">'test'</span>]</span><br><span class="line">coll = db[<span class="string">'concurrency'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span><span class="params">(name, m)</span>:</span></span><br><span class="line">    coll.update_many(</span><br><span class="line">        &#123;<span class="string">"num"</span>: &#123;<span class="string">"$mod"</span>: [m, <span class="number">0</span>]&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">"$set"</span>: &#123;<span class="string">"name"</span>: str(name)&#125;&#125;,</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    p = Process(target=f, args=(<span class="string">'aa'</span>, <span class="number">2</span>))</span><br><span class="line">    p.start()</span><br><span class="line">    coll.update_many(&#123;&#125;, &#123;<span class="string">"$set"</span>: &#123;<span class="string">"name"</span>: <span class="string">'bb'</span>&#125;&#125;)</span><br><span class="line">    p.join()</span><br><span class="line">    docs = coll.find()</span><br><span class="line">    d = dict()</span><br><span class="line">    <span class="keyword">for</span> doc <span class="keyword">in</span> docs:</span><br><span class="line">        n = doc[<span class="string">'name'</span>]</span><br><span class="line">        <span class="keyword">if</span> n <span class="keyword">not</span> <span class="keyword">in</span> d.keys():s</span><br><span class="line">            d[n] = <span class="number">0</span></span><br><span class="line">        d[n] += <span class="number">1</span></span><br><span class="line">    pprint.pprint(d)</span><br></pre></td></tr></table></figure>
<p>æœ€åç»“æœæ˜¯ï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&apos;aa&apos;: 9809, &apos;bb&apos;: 990191&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸¤ä¸ªconnæäº¤çš„update_manyè¯·æ±‚ï¼Œåœ¨mongoå†…éƒ¨å¹¶ä¸æ˜¯åŸå­çš„ä»»åŠ¡ã€‚è¿›ç¨‹æ¯”ä¸»çº¿ç¨‹åèµ·ï¼Œå› æ­¤è¿›ç¨‹åœ¨updateæ—¶ï¼Œä¸»çº¿ç¨‹å·²ç»æ‰§è¡Œäº†éƒ¨åˆ†updateä»»åŠ¡äº†ã€‚ä½†æ˜¯ç”±äºè¿›ç¨‹updateçš„documentsæ•°é‡è¾ƒå°‘ï¼Œå› æ­¤å¾ˆå¿«å°±è¿½ä¸Šäº†ä¸»çº¿ç¨‹çš„è¿›åº¦ï¼Œä»è€Œåªæœ‰çº¦10000ä¸ªrecordæœ€åæ˜¯è¢«è¿›ç¨‹ç»™updateçš„ã€‚</p>
<p>åœ¨mongoå®˜æ–¹çš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9jb3JlL3dyaXRlLW9wZXJhdGlvbnMtYXRvbWljaXR5Lw==" title="https://docs.mongodb.com/manual/core/write-operations-atomicity/">å†™æ“ä½œåŸå­æ€§<i class="fa fa-external-link"></i></span>æ–‡æ¡£ä¸­æåˆ°ï¼Œmongodbå¯¹äºå•ä¸ªdocumentçš„å†™æ“ä½œæ˜¯åŸå­çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨updateManyé‡Œï¼Œå¯¹æ¯ä¸€ä¸ªç¬¦åˆfilterçš„documentçš„ä¿®æ”¹æ“ä½œæ˜¯åŸå­çš„ï¼Œä½†æ˜¯æ•´ä¸ªupdateManyï¼Œä¸ä¼šé˜»å¡å…¶å®ƒclientçš„updateæ“ä½œã€‚</p>
<p>å¦‚æœè¦å¤šä¸ªupdateManyä»»åŠ¡ä¸å‘ç”Ÿå¹¶å‘ï¼Œæœ€ç®€ä¾¿çš„ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åœ¨ä¸šåŠ¡é€»è¾‘ä¸­åŠ é”ï¼Œæˆ–è€…ç”¨ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—è¿›è¡Œç®¡ç†ã€‚è¿™ç§æ–¹æ³•ä¸ä»…é€‚åˆupdateManyåœºæ™¯ï¼ŒåŒæ ·ä¹Ÿé€‚åˆåœ¨updateçš„æ—¶å€™ï¼Œéœ€è¦ä¿®æ”¹è¡¨ç»“æ„çš„åœºæ™¯ï¼ˆdocumentå…¨é‡updateï¼Œå¯èƒ½éœ€è¦å…ˆdeleteåinsertï¼‰ã€‚</p>
<p>ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ©ç”¨mongodbæä¾›çš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm1vbmdvZGIuY29tL21hbnVhbC9jb3JlL3RyYW5zYWN0aW9ucy8=" title="https://docs.mongodb.com/manual/core/transactions/">äº‹åŠ¡<i class="fa fa-external-link"></i></span>åŠŸèƒ½ï¼Œä½¿å¾—åœ¨å•ä¸ªsessionä¸Šè¿™äº›updateManyæ“ä½œèƒ½å¤Ÿæœ‰åºè¿›è¡Œã€‚äº‹åŠ¡åŠŸèƒ½å¯ç”¨éœ€è¦mongoä¸ºå‰¯æœ¬é›†æ¨¡å¼ï¼Œç‰ˆæœ¬è‡³å°‘4.0ï¼Œè‹¥æœ‰åˆ†å¸ƒå¼äº‹åŠ¡çš„éœ€æ±‚éœ€è¦è‡³å°‘4.2çš„ç‰ˆæœ¬ã€‚</p>
<p>ç¬¬ä¸‰ç§æ–¹æ³•åˆ™æ˜¯åœ¨æ¯ä¸€ä¸ªdocumentsä¸­åŠ å…¥versionå­—æ®µï¼Œåœ¨updateçš„filterä¸­å»å¦å¤–å¯¹æ¯”versionç‰ˆæœ¬å·ï¼Œä»è€Œä¿è¯æœ€æ–°ç‰ˆæœ¬çš„documentsèƒ½å¤Ÿå­˜å…¥æ•°æ®åº“ã€‚åœ¨è¿™ä¸ªæ€è·¯ä¸‹ï¼Œä¹Ÿå¯ä»¥å¦å¤–å†åŠ ä¸€ä¸ªmetaè¡¨å­˜å‚¨æœ€æ–°versionçš„ä¿¡æ¯ï¼ˆæ¯ä¸€ä¸ªdocé‡Œè¿˜æ˜¯è¦versionå­—æ®µï¼‰ã€‚åªæœ‰æˆåŠŸæ›´æ–°äº†metaè¡¨çš„versionï¼Œæ‰èƒ½updateManyæ•°æ®è¡¨ä¸­çš„documentsï¼Œå¦åˆ™é˜»æ­¢è¿™ä¸ªæ„å‘ã€‚</p>
<p>ç¬¬ä¸‰ç§æ–¹æ³•ç›¸å¯¹å‰ä¸¤ç§æ–¹æ³•å¯æ§æ€§è¾ƒä½ï¼Œå› æ­¤å®é™…åœºæ™¯ä¸­ï¼Œæš‚æ¨èç¬¬ä¸€ç§ä»¥åŠç¬¬äºŒç§æ–¹æ³•ã€‚ï¼ˆå¦‚æœæœ‰å…¶å®ƒæ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œæ¬¢è¿æŒ‡æ­£orzï¼‰</p>
<hr>
<p>åœ¨ç¬¬ä¸€ç§æ–¹æ³•çš„åŸºç¡€ä¸Šå»¶ä¼¸ï¼Œå¯ä»¥è®¾ç½®ä¸€å®šé‡çš„lockï¼Œè€Œåå°†è¯·æ±‚ä¿¡æ¯hashæ‰ï¼Œmodè¿›ç‰¹å®šidxçš„lockã€‚è¿™æ ·åªéœ€è¦æ§åˆ¶lockçš„é‡ï¼Œå°±èƒ½æ§åˆ¶å¤šä¸ªupdateManyçš„éœ€æ±‚äº†ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>å¹¶å‘</tag>
        <tag>mongodb</tag>
        <tag>pymongo</tag>
        <tag>äº‹åŠ¡</tag>
        <tag>åŸå­æ€§</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æµ‹è¯•ã€ç­–åˆ’ä¸å¼€å‘ï¼Œè°æ¥æŠŠæ§æ¸¸æˆçš„è´¨é‡ï¼Ÿ</title>
    <url>/2019/12/22/testlife/are_testers_controlling_quality/</url>
    <content><![CDATA[<p>è¿‘æœŸè¿›å…¥äº†å¦å¤–ä¸€ä¸ªé¡¹ç›®ç»„ï¼Œå·¥ä½œæ²Ÿé€šçš„æ—¶å€™é‡åˆ°äº†ä¸€äº›ç¢°æ’ã€‚åœ¨å’Œé¡¹ç›®ç»„å…¶å®ƒä¼™ä¼´äº¤æ¢æ„è§çš„åŒæ—¶ï¼Œè‡ªå·±ä¹Ÿå¼€å§‹æ€è€ƒè¿™ä¸ªé—®é¢˜ï¼šæµ‹è¯•ã€ç­–åˆ’ä¸å¼€å‘ï¼Œè¿™ä¸‰ä¸ªä¸»å¯¼æ¸¸æˆç ”å‘çš„éƒ¨é—¨ï¼Œè°æ‰æ˜¯çœŸæ­£æŠŠæ§ç€æ¸¸æˆçš„è´¨é‡ï¼Ÿ</p>
<p>ä»è‡ªå·±çš„èŒä¸šç«‹åœºä¸å²—ä½çš„é…ç½®ä¸Šæ¥çœ‹ï¼Œæµ‹è¯•ç†æ‰€åº”å½“çœŸæ­£ç®¡æ§æ¸¸æˆçš„è´¨é‡ï¼Œä½†æ˜¯å®é™…ä¸Šåˆä¸å°½ç„¶ã€‚ä»ç­–åˆ’å’Œå¼€å‘çš„ç«‹åœºä¸Šæ¥çœ‹ï¼Œä¸€ä¸ªå…³å¿ƒæ¸¸æˆå‘ˆç°çš„æ•ˆæœï¼Œä¸€ä¸ªå…³å¿ƒæ¸¸æˆçš„ç¨³å®šæ€§ï¼Œéƒ½æ˜¯å¹¿ä¹‰ä¸Šçš„â€œè´¨é‡ç®¡ç†â€ã€‚ä½†å®é™…æƒ…å†µä¸‹ï¼Œè®¸å¤šç ”å‘ä¸ç­–åˆ’åŒå­¦ä¼šå¸Œæœ›æµ‹è¯•èƒ½ä¸“æ³¨äºæbugï¼Œè¿™æ–¹é¢æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œè€Œå¸Œæœ›æµ‹è¯•åŒå­¦åªæå‡ºç»è¿‡è‡ªå·±ç¡®è®¤åçš„æ‰€è°“çš„bugï¼Œè¿™ç§è§‚ç‚¹å€’æ˜¯æœ‰ç‚¹ä¸é è°±ã€‚</p>
<a id="more"></a>
<p>ç„¶è€Œç°å®å¹¶éå¦‚æ­¤ç†æƒ³ï¼Œé€ æˆè¿™ç§æƒ…å†µæœ‰å¾ˆå¤šåŸå› ï¼š</p>
<ul>
<li>ç­–åˆ’ä¸å¼€å‘ç­‰å…¶å®ƒå²—ä½çš„åŒå­¦ï¼Œå¹¶éè´¨é‡ç®¡ç†èŒä¸šï¼Œå¯¹æµ‹è¯•ä¸è´¨é‡ç®¡ç†ç¼ºä¹äº†è§£ã€‚</li>
<li>æµ‹è¯•çš„å­—çœ¼ä»¥åŠç‚¹ç‚¹ç‚¹çš„æ³›æ»¥ï¼Œä¼šæ‹›è‡´éƒ¨åˆ†æŠ€æœ¯ä¸“ç²¾è€…å…ˆå…¥ä¸ºä¸»çš„åè§ã€‚</li>
<li>ç­–åˆ’ä¸å¼€å‘ç›¸å¯¹äºæ¸¸æˆäº§å“ï¼Œæ˜¯ä¸€çº¿äº§å‡ºè€…ï¼Œæœ‰æå«è‡ªå·±æˆæœçš„æƒåˆ©ã€‚</li>
<li>etc</li>
</ul>
<p>å³ä¾¿å¦‚æ­¤ï¼Œç­–åˆ’ä¸å¼€å‘å¹¶æ²¡æœ‰ç®¡æ§ç¼ºé™·æµç¨‹çš„æƒåˆ©ï¼Œå› æ­¤ç¦æ­¢æµ‹è¯•äººå‘˜â€œéšæ„â€æå‡ºç¼ºé™·ï¼Œæ˜¯ä¸€ç§è¶Šç•Œè¡Œä¸ºã€‚åœ¨æ•´ä¸ªç ”å‘æµç¨‹ä¸­å®šä¹‰ç¼ºé™·çš„äººï¼Œåº”å½“æ˜¯æµ‹è¯•ï¼ˆè´¨é‡ç®¡ç†ï¼‰äººå‘˜ï¼Œè€Œä¸æ˜¯å…¶å®ƒå²—ä½çš„åŒè¡Œã€‚å¦‚æœä¸€è‡´è®¤ä¸ºæŸäº›ç¼ºé™·å®šä¹‰ä¸å½“ï¼Œé‚£ä¹ˆåªèƒ½å°†å…¶å®šä¹‰ä¸ºâ€œä¸äºˆä¿®å¤çš„ç¼ºé™·â€ï¼Œè€Œä¸æ˜¯å°†å…¶å¦è®¤ä¸æ˜¯ä¸€ä¸ªç¼ºé™·ã€‚</p>
<p>ç¼ºé™·çš„äº§ç”Ÿï¼Œç©¶å…¶æœ¬å› ï¼Œå¯èƒ½æ˜¯ç¼ºé™·æ²¡æœ‰å¯¹äº§å“çš„æ•´ä½“æ•ˆæœé€ æˆå®è´¨å½±å“ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ–‡æ¡£æ²¡æœ‰åŠæ—¶ç»´æŠ¤å¯¼è‡´ç”¨ä¾‹æ»åï¼Œè¿˜æœ‰å¯èƒ½æ˜¯æµ‹è¯•äººå‘˜è‡ªèº«æ²¡æœ‰åšå¥½å¯¹äº§å“çš„æŠŠæ§é€ æˆè¯¯æŠ¥ã€‚ä½†ä¸è®ºæ€æ ·ï¼Œåœ¨ç¼ºé™·äº§ç”Ÿä¹‹åï¼Œéƒ½éœ€è¦å……åˆ†æ²Ÿé€šä¸äº¤æ¢ä¿¡æ¯ï¼Œæ‰èƒ½å¤Ÿå®Œæ•´è§£å†³æ¯ä¸€ä¸ªç¼ºé™·é—®é¢˜ã€‚å› æ­¤ï¼Œæ¯ä¸€ä¸ªç¼ºé™·è®°å½•ï¼Œä¸ä»…ä»…æ˜¯å¯¹bugçš„åæ˜ ï¼Œæ›´æ˜¯è®°è½½äº†ç ”å‘æµç¨‹ä¸­æ¯ä¸€ä¸ªé—®é¢˜çš„è§£å†³è¿‡ç¨‹ï¼Œæ˜¯æœ‰å®é™…æ„ä¹‰çš„ã€‚</p>
<p>åœ¨å¤§é¡¹ç›®é‡Œï¼Œæˆ‘ä»¬éœ€è¦ä»¥äº§å“åˆ©ç›Šä¸ºè€ƒé‡ï¼Œæ‹©å…¶é‡è€…è€Œè¡Œä¹‹ã€‚å›¢é˜Ÿçš„ç¨³å®šä¼šæ¯”ä¸ªäººçš„ç†æƒ³ä¼˜å…ˆçº§é«˜ï¼Œå› æ­¤å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå„å²—ä½çš„å°ä¼™ä¼´åœ¨ä¸å¤Ÿç†Ÿæ‚‰åœ°åŸºç¡€ä¸Šï¼Œéœ€è¦ä¸æ–­ç£¨åˆå¦¥åï¼Œå¯»æ‰¾å¾®å¦™çš„å…³ç³»ï¼Œæ‰èƒ½è¾¾åˆ°ç¨³å®šå…±èµ¢ã€‚ä½†ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä¹Ÿå¸Œæœ›æ¸¸æˆè¡Œä¸šè´¨é‡ç®¡ç†å·¥ä½œåœ¨å®è·µä¸Šæ›´åŠ å®Œå–„å’Œè§„èŒƒï¼Œåœ¨ä¸šåŠ¡èƒ½åŠ›ä¸Šæ›´åŠ ç²¾è¿›ã€‚è¿™æ ·ï¼Œæ‰èƒ½æ‹¥æœ‰èµ„æœ¬å»äº‰å–æ›´å¤šåŸæœ¬å±äºè¿™ä¸ªå²—ä½çš„æƒåˆ©ã€‚</p>
<p>å¸Œæœ›nå¹´ä¹‹åï¼Œå›é¡¾è¿™ç¯‡æ–‡ç« ï¼Œæœ‰æ›´åŠ å…¨é¢çš„è§£è¯»ã€‚letâ€™s see</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆç­–åˆ’</tag>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æ¸¸æˆå¼€å‘</tag>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘å°è°ˆæ¸¸æˆæµ‹è¯•ç”¨ä¾‹ä¸ä»£ç é—´çš„è”ç³»</title>
    <url>/2019/12/06/testlife/game_testcase_with_code/</url>
    <content><![CDATA[<p>è¿‘å‡ å‘¨ä¸€ç›´åœ¨æŸSLGé¡¹ç›®å†…è´Ÿè´£åŠŸèƒ½æ¨¡å—æµ‹è¯•ä¸å‘¨è¾¹å·¥å…·æ¨è¿›çš„å·¥ä½œï¼Œæ¸æ¸æ„Ÿæ‚Ÿåˆ°äº†äº›ç”¨ä¾‹è®¾è®¡ä¸ä¸šåŠ¡ä»£ç çš„è”ç³»ã€‚</p>
<p>æ¸¸æˆçš„ä¸šåŠ¡é€»è¾‘æ˜¯æ¯”ä¸€èˆ¬åº”ç”¨å¤æ‚çš„ã€‚è€Œä¸”å¯¹äºè‡ªå·±é¡¹ç›®è¿™ç§å¼ºç©æ³•çš„æ¸¸æˆè€Œè¨€ï¼Œç”šè‡³è¿˜ä¼šå‡ºç°ä»¥ä¸‹çš„ç°è±¡â€”â€”<strong>QAé©±åŠ¨ç­–åˆ’ï¼Œç­–åˆ’é©±åŠ¨å¼€å‘</strong>ã€‚</p>
<p>ç­–åˆ’æ¡ˆèƒ½å¤Ÿå¤§æ¦‚é˜è¿°æ¸¸æˆçš„ç•Œé¢ã€é€»è¾‘ä¸æ•°å€¼ï¼Œä½†æ˜¯å¦‚æœæœ‰å¤æ‚çš„ç‰¹ä¾‹ï¼Œè¿˜éœ€è¦QAåœ¨å®é™…æµ‹è¯•ä¸­å»æŒ–æ˜ã€‚æ¸¸æˆæµ‹è¯•ç”¨ä¾‹çš„è®¾è®¡è¿‡ç¨‹ï¼Œä¸ä»…å¯ä»¥çœ‹æˆæ˜¯ç­–åˆ’æ¡ˆçš„å»¶ä¼¸ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä»½ä¸šåŠ¡ä»£ç çš„å‚è€ƒæ–‡æ¡£ã€‚å¦‚æœäº†è§£æ¸¸æˆæœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯æœºåˆ¶ï¼Œè·Ÿè¿›è¿‡ä»£ç çš„è¯ï¼Œç”šè‡³å¯ä»¥æ ¹æ®å®ƒä»¬è®¾è®¡ä¸€äº›æç«¯çš„ç”¨ä¾‹ã€‚</p>
<p>å¥½æ¯”è¯´ï¼ŒæŸä¸€ä¸ªå»ºç­‘ï¼Œå åœ°æ˜¯5x5ï¼Œä½†æ˜¯å®ƒæ¨ªè·¨å›½ç•Œï¼Œä¸€éƒ¨åˆ†åœ¨Aå›½ï¼Œä¸€éƒ¨åˆ†åœ¨Bå›½ã€‚é‚£ä¹ˆè¿™ä¸ªå»ºç­‘ï¼Œæ˜¯å±äºAå›½ï¼Œè¿˜æ˜¯Bå›½å‘¢ï¼Ÿ</p>
<a id="more"></a>
<p>å¦‚æœä½ æ˜¯å¼€å‘çš„è¯ï¼Œä¼šè€ƒè™‘ä¸€ä¸ªç®€å•çš„è®¾è®¡ï¼šè¿™ä¸€ä¸ªå»ºç­‘ä¸­å¿ƒç‚¹åœ¨å“ªé‡Œï¼Œå°±å±äºå“ªä¸ªå›½å®¶ã€‚</p>
<p>è§£å†³æ‰€å±å›½å®¶å¾ˆç®€å•ï¼Œä½†æ˜¯ä¸šåŠ¡æ˜¯å¤šå˜çš„ï¼Œç­–åˆ’çš„å¤§è„‘æ˜¯è¢«äºŒæŸ±å­æ…å¾—å¾ˆæ·±çš„ã€‚å¦‚æœæ¸¸æˆæœºåˆ¶å…è®¸ç©å®¶å é¢†äº†è¯¥å»ºç­‘ï¼Œå¹¶åˆ©ç”¨è¿™ä¸ªå»ºç­‘çš„åœ°å—åšä¸€äº›æ“ä½œï¼Œé‚£ä¹ˆæ ¹æ®ä¸­å¿ƒç‚¹åˆ¤æ–­æ‰€å±å›½å®¶çš„é€»è¾‘ï¼Œå¹¶è¶³ä»¥æ»¡è¶³ä¸šåŠ¡ï¼Œè¿˜éœ€è¦åŠ ä¸Šåœ°å—çš„åˆ¤å®šã€‚</p>
<p>å› æ­¤æµ‹è¯•ç‚¹å°±æ¥äº†ï¼š</p>
<ul>
<li>å»ºç­‘åœ¨å›½ç•Œï¼Œä¸­å¿ƒç‚¹åœ¨Aå›½ â€”â€”&gt; æ˜¾ç¤ºæ‰€å±Aå›½</li>
<li>å»ºç­‘åœ¨å›½ç•Œï¼Œæ‰€å±Aå›½ï¼Œä½†ä¹Ÿæ‹¥æœ‰Bå›½çš„åœ° â€”â€”&gt; èƒ½åˆ©ç”¨Bå›½åœ°å—ï¼Œåšxxxæ“ä½œ</li>
</ul>
<p>è‡³äºçœŸå®èƒ½ä¸èƒ½ç”¨Bå›½çš„åœ°å—åšxxxæ“ä½œï¼Œè¿™å°±éœ€è¦ä¸ç­–åˆ’æ²Ÿé€šäº†ã€‚ä½†é‡è¦çš„æ˜¯ï¼Œè¿™ä¸€ç±»åœ°æ–¹ï¼Œå¾€å¾€æ˜¯å®¹æ˜“å‡ºç°ç¼ºé™·çš„åœ°æ–¹ã€‚</p>
<p>åˆæ¯”å¦‚è¯´ï¼Œä½ æœ¬æ¥æœ‰ä¸€ä¸ª5x5çš„å»ºç­‘ï¼Œä½†æ˜¯ç­‰ä½ æ¢äº†é˜µè¥ä¹‹åï¼Œå»ºç­‘ç¼©æ°´æˆ3x3çš„äº†ï¼Œä½†â€œè¿›å…¥â€å»ºç­‘åçš„æ¸¸æˆåŠŸèƒ½åŸºæœ¬æ²¡æœ‰å˜åŒ–ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸ä»…éœ€è¦å›å½’å»ºç­‘ç›¸å…³åŠŸèƒ½ï¼Œè€Œä¸”ä¹Ÿéœ€è¦å…³æ³¨å»ºç­‘ä½“ç§¯å˜åŒ–å¸¦æ¥çš„å½±å“ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä¸ºè¿™ä¸ªå»ºç­‘æ·»åŠ äº†ä¸€ä¸ªæ ‡è®°ï¼Œé‚£ä¹ˆç‚¹å‡»åŸæ¥5x5çš„èŒƒå›´ï¼Œæ˜¯ä¸æ˜¯è¿˜èƒ½æ¿€æ´»è¿™ä¸ªæ ‡è®°ï¼Ÿ</p>
<p>å¦‚æœæ²¡æœ‰é…è¡¨æ”¯æŒçš„è¯ï¼Œå¯èƒ½åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒåŸå…ˆå°±ä¼šå†™æ­»å»ºç­‘çš„å¤§å°ã€‚è¿™æ ·ï¼Œç‚¹å‡»3x3å¤–å›´çš„ç©ºåœ°ï¼Œå°±æœ‰å¯èƒ½æ¿€æ´»æ ‡è®°ï¼Œå¯¼è‡´bugã€‚</p>
<p>æ€»ä¹‹ï¼ŒQAæ˜¯æœ€äº†è§£äº§å“ï¼ˆæ¸¸æˆï¼‰çš„äººã€‚è®¾è®¡æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œä¹Ÿè¦æƒ³åˆ°å¦‚æœæ˜¯è‡ªå·±å†™è¿™ä¸ªä¸šåŠ¡é€»è¾‘ï¼Œä¼šæ€æ ·è®¾è®¡ä»£ç ï¼Œè¿™æ ·åæ¨è¿‡æ¥ï¼Œå°±å½¢æˆäº†ä¸€ç§ä»£ç æ’æŸ¥æ–¹æ¡ˆã€‚ä½œä¸ºQAï¼Œä½ æ°¸è¿œä¸çŸ¥é“ç ”å‘ä¼šåœ¨ä»€ä¹ˆæ ·çš„åœ°æ–¹çŠ¯é”™ï¼Œä½†æ˜¯å¸¸code reviewï¼Œå…»æˆè·Ÿè¿›ä»£ç å¹¶æ€è€ƒçš„ä¹ æƒ¯ï¼Œå°±èƒ½å¤Ÿå¯¹æ¸¸æˆä»£ç è®¾è®¡å¢åŠ ä¸€ä»½äº†è§£ï¼Œä»è€Œæ›´å®¹æ˜“å‘ç°æ¸¸æˆè®¾è®¡ä¸­ä¸å®¹æ˜“è¢«äººæ³¨æ„ï¼Œå´åˆå®¹æ˜“å¼•å‘ç¼ºé™·çš„ç»†èŠ‚ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æµ‹è¯•</tag>
        <tag>åŠŸèƒ½æµ‹è¯•</tag>
        <tag>code review</tag>
        <tag>æµ‹è¯•ç”¨ä¾‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬äº”è¯ï¼šç”¨è‡ªå¸¦netåŒ…å†™ä¸€ä¸ªç®€å•çš„è´Ÿè½½å‡è¡¡</title>
    <url>/2019/11/24/gofromzero/05_load_balancer/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nb2Zyb216ZXJv" title="https://github.com/utmhikari/gofromzero">Githubä¼ é€é—¨<i class="fa fa-external-link"></i></span></p>
<p>golangåœ¨å·¥ä¸šä¸­ç”¨é€”æœ€å¤šçš„æ–¹é¢å°±æ˜¯ç¼–å†™ä¸­é—´ä»¶ä»¥åŠä¸Šæ¸¸è®¾æ–½ï¼Œå› æ­¤åˆ‡å…¥golangçš„è¯ï¼Œäº†è§£å…¶ç½‘ç»œåº“æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å› æ­¤ï¼Œç¬”è€…ä¸Šæ‰‹äº†è‡ªå¸¦çš„netåŒ…ï¼ŒèŠ±äº†ä¸€å¤©å·¦å³çš„æ—¶é—´å†™äº†ä¸ªç®€å•çš„<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU4JUI0JTlGJUU4JUJEJUJEJUU1JTlEJTg3JUU4JUExJUEx" title="https://zh.wikipedia.org/wiki/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1">è´Ÿè½½å‡è¡¡ï¼ˆLoad Balancerï¼‰<i class="fa fa-external-link"></i></span>ï¼Œä¹Ÿç®—æ˜¯èƒ½ç”¨å•¦= =</p>
<h2 id="ç”¨netåŒ…å†™è´Ÿè½½å‡è¡¡"><a href="#ç”¨netåŒ…å†™è´Ÿè½½å‡è¡¡" class="headerlink" title="ç”¨netåŒ…å†™è´Ÿè½½å‡è¡¡"></a>ç”¨netåŒ…å†™è´Ÿè½½å‡è¡¡</h2><p>æˆ‘ä»¬åœ¨æµè§ˆç½‘é¡µæ—¶ï¼Œé€šå¸¸ä¼šé‡åˆ°æœåŠ¡æ–¹æ•…éšœçš„æƒ…å†µï¼Œæç¤ºæˆ‘ä»¬nginxã€apacheä¹‹ç±»çš„å­—çœ¼ã€‚è¿™äº›ï¼Œä¾¿éƒ½æ˜¯è´Ÿè½½å‡è¡¡çš„å·¥ä½œäº†ã€‚</p>
<p>ä¸€ä¸ªè´Ÿè½½å‡è¡¡å¯èƒ½ä¼šåŒ…å«ä»¥ä¸‹çš„åŠŸèƒ½ï¼š</p>
<ul>
<li>è´Ÿè½½è°ƒèŠ‚<ul>
<li>ä¸Šæ¸¸è¿æ¥åˆ†é…ï¼ˆç­–ç•¥ï¼šè½®æµï¼ˆroundrobinï¼‰ã€æœ€å°‘è¿æ¥ç­‰ï¼‰</li>
<li>æƒé‡ç®¡ç†</li>
</ul>
</li>
<li>å¥åº·æ£€æŸ¥ï¼ˆä¸šåŠ¡æ˜¯å¦OKï¼‰</li>
<li>åè®®æ”¯æŒ<ul>
<li>tcpã€udp</li>
<li>httpã€https</li>
<li>è·¯ç”±ä»£ç†</li>
<li>æ•°æ®ç¼“å­˜ä¸å‹ç¼©</li>
</ul>
</li>
<li>å®‰å…¨<ul>
<li>é™æµï¼ŒDDOSé˜²æŠ¤</li>
<li>å¤‡ç”¨è´Ÿè½½å‡è¡¡</li>
</ul>
</li>
</ul>
<p>ä¸ºäº†å®è·µä¸€ä¸‹ï¼ˆåŸ¹å…»æ‰‹æ„Ÿï¼‰ï¼Œç¬”è€…ç”¨netåŒ…å¼„äº†ä¸€ä¸ªåŸºäºtcpçš„ç®€æ˜“è´Ÿè½½å‡è¡¡ï¼Œå®ç°äº†ä¸Šè¿°æœ€åŸºç¡€çš„è´Ÿè½½è°ƒèŠ‚ä¸å¥åº·æ£€æŸ¥åŠŸèƒ½ã€‚</p>
<p>é¦–å…ˆè®¾è®¡ä¸€ä¸ªstructï¼š</p>
<a id="more"></a>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> loadBalancer <span class="keyword">struct</span> &#123;</span><br><span class="line">    Port <span class="keyword">uint</span></span><br><span class="line">    Listener net.Listener</span><br><span class="line">    ServerMap <span class="keyword">map</span>[<span class="keyword">uint</span>]*Server</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™¤äº†ç”¨äºlistençš„ç«¯å£ä¸listenerå®ä¾‹ä¹‹å¤–ï¼Œç”¨ä¸€ä¸ªmapå‚¨å­˜æ¯ä¸€ä¸ªæœåŠ¡çš„ä¿¡æ¯ä¸çŠ¶æ€ã€‚è™½ç„¶ç²’åº¦æœ‰ç‚¹å¤§ï¼Œä½†å‡‘åˆèƒ½ç”¨ã€‚</p>
<p>æ¯ä¸€ä¸ªæœåŠ¡åŒ…å«äº†åœ°å€ã€æƒé‡ã€æ˜¯å¦æ´»è·ƒç­‰ä¿¡æ¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID <span class="keyword">uint</span></span><br><span class="line">    Active <span class="keyword">bool</span></span><br><span class="line">    Host <span class="keyword">string</span> <span class="string">`json:"host"`</span></span><br><span class="line">    Port <span class="keyword">uint</span> <span class="string">`json:"port"`</span></span><br><span class="line">    Weight <span class="keyword">float64</span> <span class="string">`json:"weight"`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªä¸acceptä½†listençš„è´Ÿè½½å‡è¡¡å®ä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–è´Ÿè½½å‡è¡¡å®ä¾‹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLoadBalancerOnConfig</span><span class="params">(configPath <span class="keyword">string</span>)</span> <span class="params">(*loadBalancer, error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// load config</span></span><br><span class="line">    lb, err := initLoadBalancer(configPath)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// listen but not accept</span></span><br><span class="line">    addr := fmt.Sprintf(<span class="string">"0.0.0.0:%d"</span>, lb.Port)</span><br><span class="line">    server, err := net.Listen(network, addr)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> lb, err</span><br><span class="line">    &#125;</span><br><span class="line">    lb.Listener = server</span><br><span class="line">    log.Printf(<span class="string">"Load balancer is ready at %s...\n"</span>, addr)</span><br><span class="line">    <span class="keyword">go</span> lb.healthCheck()</span><br><span class="line">    <span class="keyword">return</span> lb, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­æ³¨æ„åˆ°ï¼Œå¯åŠ¨å®ä¾‹åï¼Œä¼šç›´æ¥å¼€å¯å¥åº·æ£€æŸ¥ä»»åŠ¡ï¼Œè¿™æ ·å°±èƒ½å®ç°ä¸Šæ¸¸æœåŠ¡ä¿¡æ¯çš„åˆå§‹åŒ–ï¼Œè®©æˆ‘ä»¬ä¸€å¼€å§‹å°±èƒ½å¤Ÿäº†è§£å“ªäº›ä¸Šæ¸¸æœåŠ¡å¯ç”¨ï¼ˆactiveï¼‰ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¥åº·æ£€æŸ¥â€”â€”è½®è¯¢æ¯ä¸ªæœåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lb *loadBalancer)</span> <span class="title">healthCheck</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">        wg.Add(<span class="built_in">len</span>(lb.ServerMap))</span><br><span class="line">        <span class="keyword">for</span> id, server := <span class="keyword">range</span> lb.ServerMap &#123;</span><br><span class="line">            tmpID := id</span><br><span class="line">            tmpServer := server</span><br><span class="line">            <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">                <span class="keyword">defer</span> wg.Done()</span><br><span class="line">                addr := tmpServer.GetAddr()</span><br><span class="line">                conn, err := net.DialTimeout(network, addr, dialTimeout)</span><br><span class="line">                mtx.Lock()</span><br><span class="line">                <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">                    log.Printf(<span class="string">"Health check failed at server %d (%s): %s\n"</span>,</span><br><span class="line">                        tmpID, addr, err.Error())</span><br><span class="line">                    lb.setInactive(tmpID)</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    log.Printf(<span class="string">"Health check success at server %d (%s)!"</span>,</span><br><span class="line">                        tmpID, addr)</span><br><span class="line">                    lb.setActive(tmpID)</span><br><span class="line">                    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">                        _ = conn.Close()</span><br><span class="line">                    &#125;()</span><br><span class="line">                &#125;</span><br><span class="line">                mtx.Unlock()</span><br><span class="line">            &#125;()</span><br><span class="line">        &#125;</span><br><span class="line">        wg.Wait()</span><br><span class="line">        time.Sleep(healthCheckInterval)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åï¼Œç”¨æˆ·éœ€è¦è°ƒç”¨<code>Run()</code>ï¼Œæ‰èƒ½çœŸæ­£æ¥å—å¤–ç•Œè¿æ¥ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¯åŠ¨è´Ÿè½½å‡è¡¡æœåŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lb *loadBalancer)</span> <span class="title">Run</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> err := lb.Listener.Close(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Printf(<span class="string">"Error while closing load balancer! %s\n"</span>, err.Error())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    log.Printf(<span class="string">"Load balancer will be launched after 3 seconds..."</span>)</span><br><span class="line">    time.Sleep(<span class="number">3</span> * time.Second)</span><br><span class="line">    runtime.GOMAXPROCS(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">var</span> clientID <span class="keyword">uint</span></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        conn, err := lb.Listener.Accept()</span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            log.Printf(<span class="string">"Error while accepting connection! %s\n"</span>, err.Error())</span><br><span class="line">        &#125;</span><br><span class="line">        clientID++</span><br><span class="line">        <span class="keyword">go</span> handler(conn, clientID, lb)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ¯ä¸€ä¸ªè¿æ¥çš„handlerä¸­ï¼Œä¼šæ–°å¢ä¸€ä¸ªè½¬å‘å™¨forwarderï¼Œé‡‡å–æœ€å°‘è¿æ¥æ•°ç­–ç•¥è¿æ¥ä¸Šæ¸¸æœåŠ¡ï¼Œåœ¨ç¨‹åºä¸­æ˜¯é€‰ä¸­æƒé‡æœ€ä½çš„ï¼Œå°½å¯èƒ½activeçš„é‚£ä¸€ä¸ªã€‚ç”±äºâ€œè¿æ¥â€æ˜¯ä¸€ä¸ªé˜»å¡æ“ä½œï¼Œå› æ­¤æˆ‘ä»¬ä¹è§‚åœ°è®¤ä¸ºæ‰€æœ‰è¿æ¥éƒ½è¶‹å‘äºæˆåŠŸï¼Œåœ¨è¿æ¥ä¹‹å‰å¢åŠ æƒé‡ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤„ç†å®¢æˆ·ç«¯è¿æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handler</span><span class="params">(conn net.Conn, clientID <span class="keyword">uint</span>, lb *loadBalancer)</span></span> &#123;</span><br><span class="line">    addrString := getAddrString(conn)</span><br><span class="line">    <span class="comment">// allocate a server for forwarding data</span></span><br><span class="line">    <span class="keyword">var</span> forwarder net.Conn</span><br><span class="line">    mtx.Lock()</span><br><span class="line">    serverID := lb.SelectServerID()</span><br><span class="line">    serverAddr := lb.ServerMap[serverID].GetAddr()</span><br><span class="line">    lb.weighConnect(serverID)</span><br><span class="line">    mtx.Unlock()</span><br><span class="line">    <span class="comment">// ä»¥ä¸‹ç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœè¿æ¥æˆåŠŸåˆ™ä¿æŒï¼Œè¿æ¥å¤±è´¥åˆ™å‡å»æƒé‡ã€‚æˆåŠŸåï¼Œé€šè¿‡forwardæ–¹æ³•ï¼ŒæŠŠç”¨æˆ·è¿æ¥çš„æ•°æ®è½¬å‘ç»™ç›¸åº”çš„æœåŠ¡ï¼Œå¹¶ä¸”ä¹Ÿä¼šæŠŠæœåŠ¡å™¨writeçš„æ•°æ®è½¬å‘ç»™ç”¨æˆ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è½¬å‘å®¢æˆ·ç«¯æ•°æ®</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">forward</span><span class="params">(conn net.Conn, forwarder net.Conn, clientID <span class="keyword">uint</span>, serverID <span class="keyword">uint</span>, lb *loadBalancer)</span></span> &#123;</span><br><span class="line">    clientAddr := getAddrString(conn)</span><br><span class="line">    serverAddr := lb.ServerMap[serverID].GetAddr()</span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        log.Printf(<span class="string">"[%d] %s disconnected from %s\n"</span>,</span><br><span class="line">            clientID, clientAddr, serverAddr)</span><br><span class="line">        mtx.Lock()</span><br><span class="line">        lb.weighDisconnect(serverID)</span><br><span class="line">        mtx.Unlock()</span><br><span class="line">        lb.PrintServers()</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">    <span class="keyword">var</span> errCode <span class="keyword">int32</span> = <span class="number">0</span></span><br><span class="line">    callback := <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        _ = conn.Close()</span><br><span class="line">        _ = forwarder.Close()</span><br><span class="line">        wg.Done()</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    <span class="comment">// request</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> callback()</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">make</span>([]<span class="keyword">byte</span>, bufferSize)</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            n, readErr := conn.Read(b)</span><br><span class="line">            <span class="keyword">if</span> readErr != <span class="literal">nil</span> &#123;</span><br><span class="line">                atomic.CompareAndSwapInt32(&amp;errCode, <span class="number">0</span>, ReadC2FError)</span><br><span class="line">                log.Printf(<span class="string">"[%d] Read c2f error from %s: %s"</span>,</span><br><span class="line">                    clientID, clientAddr, readErr.Error())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            _, writeErr := forwarder.Write(b[:n])</span><br><span class="line">            <span class="keyword">if</span> writeErr != <span class="literal">nil</span> &#123;</span><br><span class="line">                atomic.CompareAndSwapInt32(&amp;errCode, <span class="number">0</span>, WriteF2SError)</span><br><span class="line">                log.Printf(<span class="string">"[%d] Write f2s error to %s: %s"</span>,</span><br><span class="line">                    clientID, serverAddr, writeErr.Error())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="comment">// response</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> callback()</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">make</span>([]<span class="keyword">byte</span>, bufferSize)</span><br><span class="line">        <span class="keyword">for</span> &#123;</span><br><span class="line">            n, readErr := forwarder.Read(b)</span><br><span class="line">            <span class="keyword">if</span> readErr != <span class="literal">nil</span> &#123;</span><br><span class="line">                atomic.CompareAndSwapInt32(&amp;errCode, <span class="number">0</span>, ReadS2FError)</span><br><span class="line">                log.Printf(<span class="string">"[%d] Read s2f error from %s: %s"</span>,</span><br><span class="line">                    clientID, serverAddr, readErr.Error())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">            _, writeErr := conn.Write(b[:n])</span><br><span class="line">            <span class="keyword">if</span> writeErr != <span class="literal">nil</span> &#123;</span><br><span class="line">                atomic.CompareAndSwapInt32(&amp;errCode, <span class="number">0</span>, WriteF2CError)</span><br><span class="line">                log.Printf(<span class="string">"[%d] Write f2c error to %s: %s"</span>,</span><br><span class="line">                    clientID, clientAddr, writeErr.Error())</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line">    wg.Wait()</span><br><span class="line">    fmt.Printf(<span class="string">"[%d] Closed on signal: %d\n"</span>, clientID, errCode)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œä¸€ä¸ªç®€æ˜“çš„è´Ÿè½½å‡è¡¡å°±å®Œæˆäº†ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸Šè¿°çš„è´Ÿè½½å‡è¡¡è¿˜å­˜åœ¨è®¸å¤šé—®é¢˜ï¼Œä»è¯­è¨€ä¸Šæ¥è®²ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>å¹¶è¡Œ/å¹¶å‘é”ç²’åº¦å¤ªå¤§</li>
<li>å¯ä»¥ç”¨ä¸€äº›ç›¸å¯¹å°è£…è¾ƒå¥½çš„å®ä¾‹ï¼Œå¦‚net.Dialer</li>
<li>å¯ä»¥åˆ©ç”¨golangè‡ªå¸¦channelã€contextç­‰æœºåˆ¶</li>
</ul>
<p>è€Œä»ä¸šåŠ¡ä¸Šæ¥è®²ï¼Œæ¨¡å—è€¦åˆè¾ƒå¤šï¼Œæ‰©å±•æ€§ä¼šå·®ä¸€ç‚¹ã€‚å¹¶ä¸”çœŸæ­£å®Œå¤‡çš„è´Ÿè½½å‡è¡¡è®¾æ–½ï¼Œè¿˜éœ€è¦è€ƒè™‘å¾ˆå¤æ‚çš„åŠŸèƒ½ï¼Œè¿™äº›éƒ½éœ€è¦ä¸€ä¸ªä¸ªæ¨¡å—å¥½å¥½è®¾è®¡æ¥å®ç°çš„ã€‚</p>
<p>ä¸è®ºæ˜¯è¯­è¨€å±‚é¢è¿˜æ˜¯ä¸šåŠ¡å±‚é¢éƒ½æœ‰å¾ˆå¤šçš„æå‡ç©ºé—´ã€‚åŠ æ²¹å§~</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>å¹¶å‘</tag>
        <tag>tcp</tag>
        <tag>è´Ÿè½½å‡è¡¡</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘vè¯­è¨€ä¸Šæ‰‹ï¼Œç”¨vlangå†™ä¸€ä¸ªèŠå¤©åº”ç”¨</title>
    <url>/2019/11/16/githubdiscovery/vlang/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>vlangï¼ˆvè¯­è¨€ï¼‰è‡ªä»6æœˆä»½çªç„¶ç‚’çƒ­èµ·æ¥ï¼Œä¸çŸ¥ä¸è§‰åˆ°äº†11æœˆï¼Œæ­£å¼ç‰ˆå°±è¦å‡ºæ¥äº†ï¼Œåœ¨11æœˆçš„GitHub Trendingæ¦œä¸­ä¾ç„¶æ’åœ¨å‰10ã€‚è¿™ç€å®ä»¤äººå¥½å¥‡ï¼Œå› æ­¤ç¬”è€…å†³å®šè¯•ç”¨ä¸€ä¸‹vlangï¼Œå†™ä¸€ä¸ªå°åº”ç”¨ï¼Œä½“éªŒä¸€ä¸‹æ„Ÿå—ã€‚</p>
<h2 id="vè¯­è¨€ä¸Šæ‰‹"><a href="#vè¯­è¨€ä¸Šæ‰‹" class="headerlink" title="vè¯­è¨€ä¸Šæ‰‹"></a>vè¯­è¨€ä¸Šæ‰‹</h2><p>vè¯­è¨€å¯ä»¥åœ¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3ZsYW5nL3Y=" title="https://github.com/vlang/v">GitHubä¼ é€é—¨<i class="fa fa-external-link"></i></span>ä¸­cloneä¸‹è½½ï¼Œæ”¯æŒå¤šæ“ä½œç³»ç»Ÿï¼Œæœ‰ä»¥ä¸‹çš„ç‰¹æ€§ï¼š</p>
<ul>
<li>å¿«é€Ÿç¼–è¯‘</li>
<li>å¿«é€Ÿè½¬è¯‘</li>
<li>çƒ­æ›´</li>
</ul>
<p>å…¶ä½™çš„ï¼Œè¿˜æœ‰è‡ªå¸¦çš„GUIåº“ã€ç»“åˆGoä¸Rustçš„è¯­è¨€ç‰¹æ€§ä¹‹ç±»ï¼Œä¹Ÿå¯ä»¥ç®—ä½œæ‰€è°“çš„å–ç‚¹ã€‚</p>
<p>å®‰è£…vè¯­è¨€ä¹Ÿå¾ˆç®€å•ï¼Œæ¯”å¦‚åœ¨windowsä¸Šï¼Œé¦–å…ˆéœ€è¦å®‰è£…Visual Studioæä¾›çš„MSVCç¯å¢ƒï¼Œç„¶ååªéœ€è¦ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/vlang/v.git</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">./make.bat</span><br></pre></td></tr></table></figure>
<p>å†è®¾ç½®ç¯å¢ƒå˜é‡åˆ°PATHï¼Œå°±èƒ½å¤Ÿéšæ—¶éšåœ°æ‰§è¡Œvlangäº†ã€‚</p>
<a id="more"></a>
<p>å¦‚æœè¦æ›´æ–°vlangï¼Œåˆ™åªéœ€è¦ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">v up</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥è‡ªåŠ¨æ›´æ–°å¹¶ç¼–è¯‘äº†ã€‚</p>
<h2 id="å†™ä¸€ä¸ªèŠå¤©åº”ç”¨"><a href="#å†™ä¸€ä¸ªèŠå¤©åº”ç”¨" class="headerlink" title="å†™ä¸€ä¸ªèŠå¤©åº”ç”¨"></a>å†™ä¸€ä¸ªèŠå¤©åº”ç”¨</h2><p>ä¸ºäº†è¯•ç”¨vlangï¼Œç¬”è€…ç®€å•å†™äº†ä¸ªèŠå¤©åº”ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9zaGluZ2VraW5vdg==" title="https://github.com/utmhikari/shingekinov">shingekinov<i class="fa fa-external-link"></i></span>ï¼Œè®¾è®¡ä¸Šæš‚æ—¶ç”¨äº†å…¨å±€é”è€Œéæ¶ˆæ¯é˜Ÿåˆ—ï¼Œç„¶åä¹Ÿé¡ºå¸¦æŠŠvlangçš„è‡ªå¸¦ç½‘ç»œåº“ç†Ÿæ‚‰äº†ä¸€ä¸‹ã€‚</p>
<p>vlangå¹¶æ²¡æœ‰å…¨å±€å˜é‡çš„è¯´æ³•ï¼Œå› æ­¤éœ€è¦é€šè¿‡åœ¨mainå‡½æ•°é‡Œä¿ç®¡æŒ‡é’ˆå¯åŠ¨å®ä¾‹ã€‚å¯¹äºä¸€ä¸ªç®€å•çš„èŠå¤©æœåŠ¡å™¨å®ä¾‹å¯ä»¥å¦‚ä¸‹è®¾è®¡ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Server</span></span> &#123;</span><br><span class="line">    instance net.Socket</span><br><span class="line"><span class="keyword">mut</span>:</span><br><span class="line">    clients map[string]net.Socket</span><br><span class="line">    pairs map[string]string</span><br><span class="line">    mtx sync.Mutex</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>clients</code>å­˜å‚¨å®¢æˆ·ç«¯socketï¼Œè€Œ<code>pairs</code>å­˜å‚¨èŠå¤©çš„ä¸€å¯¹ã€‚æ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥éƒ½é‡‡ç”¨<code>go</code>å…³é”®å­—ï¼ˆorzï¼‰åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹è¿›è¡Œhandleã€‚è¦æ³¨å†Œå®¢æˆ·æˆ–è€…å¤„ç†æ¶ˆæ¯æ—¶ï¼Œåˆ™ä¸Šå…¨å±€é”ã€‚å…¨å±€é”lockæ–¹æ³•ä¼šè‡ªåŠ¨ç­‰å¾…ï¼Œæ‰€ä»¥æš‚æ—¶ä¸ä¼šé€ æˆæ­»é”ã€‚handleæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">handle</span></span>(s net.Socket, server <span class="keyword">mut</span> Server) &#123;</span><br><span class="line">    fdint := s.sockfd</span><br><span class="line">    fd := fdint.<span class="built_in">str</span>()</span><br><span class="line">    logger.info('$fd connected!!!')</span><br><span class="line">    s.write('$fd: Welcome to ShinGeKiNoV Chat Platform~')</span><br><span class="line">    server.mtx.lock()</span><br><span class="line">    server.register(fd, s)</span><br><span class="line">    server.mtx.unlock()</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        msg := s.read_line().replace('\r\n', '').replace(<span class="string">'\n'</span>, '')</span><br><span class="line">        <span class="keyword">if</span> msg.len &gt; <span class="number">0</span> &#123;</span><br><span class="line">            logger.info(<span class="symbol">'Received</span> message size $&#123;msg.len&#125; from $fd: $msg')</span><br><span class="line">        &#125;</span><br><span class="line">        server.mtx.lock()</span><br><span class="line">        <span class="keyword">if</span> server.is_chatting(fd) &#123;</span><br><span class="line">            <span class="keyword">match</span> msg &#123;</span><br><span class="line">                '' &#123;</span><br><span class="line">                    logger.warn('$fd itself disconnected...')</span><br><span class="line">                    server.leave_chat(fd)</span><br><span class="line">                    server.unregister(fd)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="symbol">'exit</span>' &#123;</span><br><span class="line">                    logger.warn('$fd is going to leave chat...')</span><br><span class="line">                    server.leave_chat(fd)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    server.handle_chat(fd, msg)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">match</span> msg &#123;</span><br><span class="line">                '' &#123;</span><br><span class="line">                    logger.warn('$fd itself disconnected...')</span><br><span class="line">                    server.leave_chat(fd)</span><br><span class="line">                    server.unregister(fd)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="symbol">'exit</span>' &#123;</span><br><span class="line">                    logger.warn('$fd is requesting to disconnect...')</span><br><span class="line">                    s.write(<span class="symbol">'Disconnecting</span>...')</span><br><span class="line">                    server.leave_chat(fd)</span><br><span class="line">                    server.unregister(fd)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="symbol">'help</span>' &#123;</span><br><span class="line">                    s.write(server.help())</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="symbol">'list</span>' &#123;</span><br><span class="line">                    s.write(server.list())</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="symbol">'chat</span>' &#123;</span><br><span class="line">                    server.join_chat(fd)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    s.write(<span class="symbol">'Invalid</span> command: $msg! Type <span class="string">"help"</span> <span class="keyword">for</span> options~')</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        server.mtx.unlock()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨åšè¿™ä¸ªç®€å•èŠå¤©æœåŠ¡å™¨çš„åŒæ—¶ï¼Œç¬”è€…ä¹Ÿå‘ç°vlangå½“å‰çš„ç‰ˆæœ¬è™½ç„¶çœ‹ä¼¼åŠŸèƒ½éå¸¸å¤šï¼Œä½†æ˜¯æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½è¿˜æ˜¯éå¸¸ç¨šå«©ï¼Œå¯ä»¥è¯´æ˜¯æŒ–äº†ä¸€ä¸ªå¾ˆå¤§çš„å‘ã€‚æ¯”å¦‚å½“å‰ç‰ˆæœ¬çš„mapé‡‡ç”¨æ™®é€šäºŒå‰æ ‘å­˜å‚¨keyï¼ˆorzï¼‰ï¼Œå¹¶ä¸”åœ¨insertä¸deleteä¸Šéƒ½æ˜¯æœ‰bugçš„ï¼›å†æ¯”å¦‚socketå®¢æˆ·ç«¯æ–­å¼€æ—¶ï¼Œæ²¡æœ‰EOFçš„æ”¯æŒâ€¦vè¯­è¨€ï¼Œä¹Ÿæˆä¸ºäº†ç¬”è€…ç ä»£ç ä»¥æ¥ç¬¬ä¸€ä¸ªéœ€è¦æ”¹æ ‡å‡†åº“æºç æ‰èƒ½è¿è¡ŒæˆåŠŸçš„ç¼–ç¨‹è¯­è¨€ï¼ˆorzï¼‰ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>vè¯­è¨€ï¼Œé¦–å…ˆæ˜¯åº“çš„æ”¯æŒï¼Œè¿˜æ˜¯å¤ªç¬¼ç»Ÿäº†ï¼Œç¦»çœŸæ­£å¯ç”¨è¿˜å·®ä¸€æ®µè·ç¦»ï¼Œå¹¶ä¸”æ²¡æœ‰å®Œå–„GCçš„æ”¯æŒï¼Œåœ¨çº¿ä¸Šç¯å¢ƒè¿™ä¸€partæ˜¯å¾ˆè‡´å‘½çš„ã€‚</p>
<p>æŒ‰vè¯­è¨€çš„ç‰¹æ€§æ¥çœ‹ï¼Œç®—æ˜¯ä¸€ç§â€œç¿»è¯‘è¯­è¨€â€ï¼Œå¯ä»¥ç¿»è¯‘ä¸ºCè¯­è¨€ï¼Œä¼¼ä¹ä¹Ÿèƒ½ç¿»è¯‘æˆjavascriptï¼Œå› æ­¤æŒºé€‚åˆåšçƒ­æ›´çš„éœ€æ±‚ï¼Œå¯¹äºæ¸¸æˆå¼€å‘ä¼¼ä¹å¾ˆæœ‰ç”¨å–”ã€‚</p>
<p>æ€»çš„æ¥è®²ï¼Œè¿™äº›ç»†èŠ‚è¿˜æ˜¯å¾—æ…¢æ…¢ç£¨ï¼ŒæœŸå¾…åç»­å§~</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>vè¯­è¨€</tag>
        <tag>èŠå¤©æœåŠ¡å™¨</tag>
        <tag>ç¿»è¯‘è¯­è¨€</tag>
        <tag>shingekinov</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘æ¸¸æˆä¸šåŠ¡ç”¨ä¾‹æµ‹è¯•ä½“éªŒæ„Ÿæ‚Ÿ</title>
    <url>/2019/11/03/testlife/start_game_test/</url>
    <content><![CDATA[<p>è¿‘æœŸç¨å¾®åœæ­‡äº†ä¸‹å¼€å‘çš„ä»»åŠ¡ï¼Œè½¬ä¸ºè¿›å…¥æ¸¸æˆé¡¹ç›®ç»„å»æ¢ç©¶çœŸæ­£çš„æ¸¸æˆæµ‹è¯•ä¸šåŠ¡æ˜¯å¦‚ä½•è¿›è¡Œã€‚åœ¨æ­¤å‰åšæµ‹è¯•å·¥å…·ä¸å¹³å°æ—¶ä¼šå¸¸å¸¸é‡åˆ°ä¸šåŠ¡éœ€æ±‚ä¸èƒ½å‡†ç¡®å‡»ä¸­çš„ç“¶é¢ˆï¼Œå› æ­¤çœŸå®æŠ•å…¥ä½“éªŒï¼Œè°ƒç ”é¡¹ç›®ç»„çš„æµ‹è¯•ç—›ç‚¹ï¼Œèƒ½å¤Ÿå¯¹åç»­çš„æŠ€æœ¯æ”¯æŒå·¥ä½œå¤§æœ‰è£¨ç›Šã€‚</p>
<p>æ¸¸æˆï¼Œå°¤å…¶æ˜¯ç½‘æ¸¸ï¼Œæ˜¯ä¸€ç±»éå¸¸ç‰¹æ®Šçš„è½¯ä»¶äº§å“ï¼Œå¯èƒ½ä¼šæœ‰ä»¥ä¸‹çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯å¼ºè€¦åˆ</li>
<li>å„ä¸ªç³»ç»Ÿæ¨¡å—é—´å­˜åœ¨å¤æ‚çš„è”ç³»ï¼Œä¸šåŠ¡å¤æ‚åº¦ç›¸å¯¹äºä¸€èˆ¬çš„äº§å“é«˜</li>
<li>å•ä½“çŠ¶æ€çš„å˜åŒ–ï¼Œå¯èƒ½å½±å“åˆ°å¤šä¸ªå®ä½“çš„çŠ¶æ€åŠå±æ€§</li>
<li>ç­–åˆ’é…è¡¨æ•°å€¼å˜åŠ¨å¤šï¼Œè¿­ä»£é¢‘ç‡é«˜</li>
<li>æ¸¸æˆçš„æ–°åŠŸèƒ½ç‰¹æ€§ç ”å‘ï¼Œéœ€è¦ç‰µæ‰¯åˆ°å¾ˆå¤šåŸæœ‰çš„è®¾å®š</li>
<li>etcâ€¦</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼Œæ¸¸æˆæ˜¯ä¸€ä¸ªé«˜å†…èšã€ä½“é‡è¾ƒå¤§ã€å˜åŒ–éœ€æ±‚å¤šçš„è½¯ä»¶ç³»ç»Ÿï¼Œå› æ­¤æ¸¸æˆä¸šåŠ¡æµ‹è¯•æœ¬èº«å°±æ˜¯ä¸å°çš„æŒ‘æˆ˜ã€‚</p>
<p>é¡¹ç›®ç»„ç°å¤„äºåˆšä¸Šçº¿çš„é˜¶æ®µï¼Œä¸»è¦ä¸šåŠ¡æ˜¯å¤–ç½‘ç¼ºé™·ä¿®å¤çš„éªŒæ”¶ä»¥åŠæ–°åŠŸèƒ½çš„æµ‹è¯•åŠå›å½’ã€‚å…¶ä¸­ï¼Œæ–°åŠŸèƒ½çš„å›å½’æµ‹è¯•åœ¨ç¬”è€…è®¤ä¸ºæ˜¯æ›´ä¸ºè‰°å·¨çš„ä»»åŠ¡ã€‚æˆ‘ä»¬é¦–å…ˆå¯ä»¥çœ‹ä¸€ä¸‹ä¸€ä¸ªåŸºæœ¬çš„æµ‹è¯•ç”¨ä¾‹æ˜¯æ€æ ·çš„:</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ç”¨ä¾‹ = å‰ç½®æ¡ä»¶ï¼ˆåœ¨Xæ¡ä»¶ä¸‹ï¼‰ + æ“ä½œï¼ˆæ‰§è¡ŒYï¼‰ + é¢„æœŸç»“æœï¼ˆæ¯ä¸ªå…³è”å®ä½“çš„çŠ¶æ€å˜åŒ–ï¼‰</span><br></pre></td></tr></table></figure>
<p>åœ¨å›å½’æµ‹è¯•é‡Œï¼Œä¸è¯´å…³è”å®ä½“çš„æ•°é‡ï¼Œå•è¯´å‰ç½®æ¡ä»¶ï¼Œä¸€æ–¹é¢ç”±äºæ–°åŠŸèƒ½å…³è”çš„æ—§æ¨¡å—å¯èƒ½è¾ƒå¤šï¼Œè¿™æ ·å°±å¯¼è‡´å‰ç½®æ¡ä»¶çš„å¯èƒ½æ€§ä¹Ÿä¼šå¾ˆå¤šï¼Œæ’åˆ—ç»„åˆåå‘ˆæŒ‡æ•°çº§å¢é•¿ï¼›å¦ä¸€æ–¹é¢åœ¨å®é™…æ¸¸æˆä½“éªŒä¸­ï¼Œè¾¾æˆå‰ç½®æ¡ä»¶æ‰€éœ€è¦çš„æ­¥éª¤ä¹Ÿè¾ƒç¹çã€‚é’ˆå¯¹è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæœ€ç¨³å¦¥çš„çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š</p>
<ul>
<li>æµ‹è¯•æ–¹å¼ï¼šæœ€ç¨³å¦¥çš„æ˜¯é»‘ç›’æµ‹è¯•ã€‚é»‘ç›’æµ‹è¯•èƒ½å¤Ÿç›´æ¥è§‚å¯Ÿå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è¡¨ç°ï¼Œå¹¶ä¸”å½“ä¸‹ä¹Ÿåªæœ‰äººç±»èƒ½å¤Ÿåˆ¤æ–­å“ªäº›è¡¨ç°å±äºç¼ºé™·ï¼ˆæŸäº›ç»†èŠ‚è¦è€ƒè™‘åˆ°ç­–åˆ’çš„è®¾å®šï¼‰ã€‚AIè·‘æ¸¸æˆå³ä½¿å¯èƒ½å®ç°ï¼Œä½†ä¹Ÿä¸èƒ½ç›´æ¥ä¸æµ‹è¯•ä¸šåŠ¡äº¤äº’ï¼›UIè‡ªåŠ¨åŒ–èƒ½å¤Ÿä¿è¯æ“ä½œçš„æˆåŠŸï¼Œä½†éš¾ä»¥è§‚æµ‹æ“ä½œæ‰€äº§ç”Ÿçš„å¯¹å…¶å®ƒå®ä½“çš„å½±å“æ˜¯å¦æ­£ç¡®ã€‚</li>
<li>ç”¨ä¾‹è®¾è®¡ï¼šå…ˆè®¾è®¡å‡ºæ‰€æœ‰å¯èƒ½çš„ç”¨ä¾‹å•å…ƒï¼Œå†åœ¨å®é™…æ¸¸æˆä¸­è¿›è¡Œè¦†ç›–ã€‚ä¸€æ¬¡æ­£å¸¸çš„æ¸¸æˆæµç¨‹ä¸­ï¼Œå°½å¯èƒ½è¿‡æ»¤æ‰é‚£äº›ç°å®æ¸¸æˆè¿è¡Œä¸­éš¾ä»¥å‘ç”Ÿçš„çŠ¶æ€å˜åŒ–ï¼Œå¹¶ä¸”å°½å¯èƒ½è¦†ç›–ä¸åŒåˆ†æ”¯çš„ç”¨ä¾‹å•å…ƒï¼Œä»è€ŒçœŸå®æå‡</li>
<li>GMæŒ‡ä»¤ï¼šé€šå¸¸æ˜¯å®¢æˆ·ç«¯å‘ç»™æœåŠ¡ç«¯çš„å¿«é€Ÿè¾¾æˆæŸäº›æ¡ä»¶çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚ä¸€é”®99çº§ã€æ”¹ç³»ç»Ÿæ—¶é—´é‚£ç§ã€‚ç†Ÿæ‚‰GMæŒ‡ä»¤ä¸æ¸¸æˆè®¾è®¡ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æµ‹è¯•æ•ˆç‡ã€‚</li>
</ul>
<p>å› æ­¤è„‘æµ·ä¸­è¡ç”Ÿäº†ä»¥ä¸‹çš„æŠ€æœ¯æ”¯æ’‘æ€è·¯ï¼š</p>
<ul>
<li>ä¸Šæ¸¸&amp;èµ„æºç®¡ç†ï¼šåœ¨å®é™…æµ‹è¯•ä¸­æœ€æ€•é‡åˆ°åè®®å¯¹ä¸ä¸Šã€é…è¡¨å¯¹ä¸ä¸Šä¹‹ç±»çš„å¤–åœ¨é—®é¢˜ï¼Œå› æ­¤éœ€è¦ä¸€å¥—ç¨³å®šçš„ä¸Šæ¸¸&amp;èµ„æºç®¡ç†æœºåˆ¶ï¼Œæä¾›ç¨³å®šçš„æµ‹è¯•ç¯å¢ƒï¼Œå¹¶ç›‘æ§èµ„æºä¸ä»£ç çš„å˜æ›´ã€‚</li>
<li>ç”¨ä¾‹å·¥å…·ï¼šé€šå¸¸ä¸šåŠ¡æµ‹è¯•ä¸­ç”¨ä¾‹è®¾è®¡ä¼šåˆ†æ¨¡å—ï¼Œé‡‡ç”¨æ€ç»´å¯¼å›¾è½¯ä»¶åˆ’åˆ†æ”¯ã€‚ä½†è¿™æ˜¯æœ‰å±€é™æ€§çš„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå·¨å¤§çš„å›¾èƒ½å¤Ÿè¡¨ç°æ•´ä¸ªæ¸¸æˆç³»ç»Ÿï¼Œèƒ½å¤Ÿå¯¹åŠŸèƒ½ç”¨ä¾‹çš„è®¾è®¡ç»„åˆèµ·åˆ°æ›´å¥½çš„æŒ‡å¯¼ä½œç”¨ã€‚å› æ­¤é’ˆå¯¹æ¸¸æˆçš„ç”¨ä¾‹è®¾è®¡&amp;ç®¡ç†å·¥å…·ï¼Œä¹Ÿæ˜¯é•¿çº¿è°ƒç ”çš„æ–¹å‘ã€‚</li>
</ul>
<p>è¯¸å¤šæƒ³æ³•éƒ½ä¹Ÿåªæ˜¯èŒèŠ½ï¼Œå¸Œæœ›åé¢ç»§ç»­æ·±å…¥çš„è¯ï¼Œèƒ½å‘æ˜æ›´å¤šçš„ä¸œè¥¿å§~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ¸¸æˆæµ‹è¯•</tag>
        <tag>æµ‹è¯•</tag>
        <tag>ä¸šåŠ¡</tag>
        <tag>ç”¨ä¾‹è®¾è®¡</tag>
        <tag>å›å½’æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘è§£å†³æŠ€å˜‰Z390 AORUS PROä¸è¯†åˆ«SSD/æœºæ¢°ç¡¬ç›˜çš„é—®é¢˜</title>
    <url>/2019/10/29/diymemo/gigabyte_z390/</url>
    <content><![CDATA[<p>ç¬”è€…è¿‘æœŸç”¨æŠ€å˜‰ï¼ˆGIGABYTEï¼‰Z390è£…æœºæ—¶é‡åˆ°äº†è£…ä¸Šä¸€ä¸ªSSDè·Ÿä¸€ä¸ªæœºæ¢°ç¡¬ç›˜åï¼Œæœºæ¢°ç¡¬ç›˜æ— æ³•è¢«ä¸»æ¿/æ“ä½œç³»ç»Ÿè¯†åˆ«çš„é—®é¢˜ï¼Œç»è¿‡ä¸€ç•ªç ”ç©¶åå‘ç°äº†è§£å†³æ–¹æ¡ˆï¼Œç‰¹åœ°åˆ†äº«ï¼š</p>
<p>é¦–å…ˆæœ¬ç»éªŒç†è®ºä¸Šåº”å½“é€‚ç”¨äºä¸åŒå‚å®¶çš„Z390ä¸»æ¿ä¸Šï¼ˆæ¯”å¦‚åç¡•ä¹‹ç±»ï¼‰</p>
<p>SSDæˆ–æœºæ¢°ç¡¬ç›˜æ— æ³•è¯†åˆ«å¯èƒ½æ˜¯ä¸»æ¿èŠ¯ç‰‡å…±äº«é¢‘å®½çš„é—®é¢˜ã€‚ä»¥æŠ€å˜‰ä¸ºä¾‹ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦çŸ¥é“SSDæˆ–æœºæ¢°ç¡¬ç›˜æ’åœ¨äº†å“ªé‡Œï¼Œä»¥åŠç¡¬ç›˜æœ‰å“ªäº›æ¥å£ã€‚åœ¨æŠ€å˜‰Z390ä¸Šï¼Œæœ‰ä»¥ä¸‹çš„ç¡¬ç›˜æ¥å£ï¼š</p>
<ul>
<li>M.2ï¼ˆM2A/M2Mï¼‰</li>
<li>SATA</li>
</ul>
<p>åœ¨è¯´æ˜ä¹¦ä¸­åº”å½“ä¼šæœ‰è¿™äº›æ’å£æ‰€æ’åˆ°çš„ä½ç½®å›¾ç¤ºã€‚</p>
<p>å¦‚æœä¸äº†è§£ç¡¬ç›˜åŸæ¥æ’åˆ°äº†å“ªä¸ªæ¥å£ï¼Œå¯ä»¥å¼€æœºè¿›å…¥BIOSï¼ŒBIOSä¸­ä¹Ÿä¼šæ˜¾ç¤ºè¿™äº›æ¥å£æ’äº†å“ªäº›ç¡¬ç›˜ã€‚å¦‚æœæ’è¿‡çš„ç¡¬ç›˜æ²¡æ˜¾ç¤ºï¼Œé‚£å°±æ˜¯æ²¡è¯†åˆ«åˆ°äº†ã€‚</p>
<p>æ¥ä¸‹æ¥ä¹Ÿå¾—ç¿»è¯´æ˜ä¹¦æ‰¾ç¡¬ç›˜æ¥å£ç›¸å…³çš„å†…å®¹ï¼Œä»¥æŠ€å˜‰Z390ä¸ºä¾‹ï¼Œåœ¨è¯´æ˜ä¹¦çš„<code>æ’åº§åŠè·³çº¿ä»‹ç»â€”â€”M.2åŠSATAæ’åº§å®‰è£…æ³¨æ„äº‹é¡¹</code>ä¸­ï¼Œä¼šæœ‰<strong>è¡¨æ ¼åŠæ–‡å­—</strong>æ˜¾ç¤ºM.2çš„å“ªä¸ªæ¥å£å®‰è£…äº†å“ªç§SSDï¼Œä¼šä¸å“ªä¸ªSATAæ¥å£å…±äº«é¢‘å®½ï¼Œä»è€Œä¸å…¼å®¹ã€‚å€ŸåŠ©è¿™ä¸ªè¡¨æ ¼æ‰¾åˆ°å…¼å®¹çš„æ¥å£ï¼ŒæŠŠåŸå…ˆæ’åœ¨SATAçš„ç¡¬ç›˜æ¢ä¸€ä¸ªå…¼å®¹å·ç çš„æ’åº§ï¼Œå°±å¥½äº†ã€‚æŠ€å˜‰çš„è¯ï¼ŒSATAæ’åˆ°3ã€4å·ï¼ˆä¸­é—´ä¸¤ä¸ªï¼‰ï¼Œæ˜¯æ²¡é—®é¢˜çš„ã€‚</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>ä¸»æ¿</tag>
        <tag>Z390</tag>
        <tag>æŠ€å˜‰</tag>
        <tag>è£…æœº</tag>
        <tag>BIOS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘æœåŠ¡ç«¯æ¶æ„skynetç®€æ˜“å…¥é—¨é¡¹ç›®â€”â€”create-skynet</title>
    <url>/2019/10/26/luatalk/create_skynet/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨<a href="https://utmhikari.github.io/2019/10/20/luatalk/skynet/">skyneté€šä¿¡åŸç†ä¸æºç åˆ†æ</a>ä¸€æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»è¯¦å°½åœ°å¼„æ¸…æ¥šäº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc2t5bmV0" title="https://github.com/cloudwu/skynet">skynet<i class="fa fa-external-link"></i></span>åœ°é€šä¿¡æ¶æ„ï¼Œä¸ºæˆ‘ä»¬ä¸Šæ‰‹skynetæä¾›äº†æå¤§çš„å¸®åŠ©ã€‚å› æ­¤æœ¬ç¯‡æ–‡ç« æ¥ç»­ä¸Šæ–‡ï¼Œæ­£å¼ä¸Šæ‰‹ä½¿ç”¨skynetã€‚</p>
<h2 id="skynetå…¥é—¨é¡¹ç›®ï¼šcreate-skynet"><a href="#skynetå…¥é—¨é¡¹ç›®ï¼šcreate-skynet" class="headerlink" title="skynetå…¥é—¨é¡¹ç›®ï¼šcreate-skynet"></a>skynetå…¥é—¨é¡¹ç›®ï¼šcreate-skynet</h2><p>è¦åšä¸€ä¸ªåŸºäºskynetçš„é¡¹ç›®ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªå¥½çš„æ¨¡æ¿ã€‚skynetçš„æœ€ä½³å®è·µå¹¶éå°†æœåŠ¡å¸è½½skynetæ¨¡å—ä¸­ï¼Œè€Œæ˜¯å°†skynetå½“ä½œä¸€ä¸ªå•ç‹¬çš„åº“/SDKçœ‹å¾…ï¼Œè‡ªå·±ç‹¬ç«‹åœ¨å¦å¤–çš„ç›®å½•å†™ä¸šåŠ¡é€»è¾‘ã€‚å› æ­¤ï¼Œç¬”è€…åœ¨æ•°æœˆå‰ç®€å•åœ°æ•´åˆäº†ä¸€ä¸‹skynetçš„boilerplateé¡¹ç›®â€”â€”<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9jcmVhdGUtc2t5bmV0" title="https://github.com/utmhikari/create-skynet">create-skynet<i class="fa fa-external-link"></i></span>ï¼Œé‡‡ç”¨è¿™ä¸ªé¡¹ç›®æ­å»ºskynetæœåŠ¡ç«¯ç»“æ„ä¼šè¾ƒä¸ºæ¸…æ™°ã€‚</p>
<h3 id="æœåŠ¡-amp-åº“çš„çº¦å®š"><a href="#æœåŠ¡-amp-åº“çš„çº¦å®š" class="headerlink" title="æœåŠ¡&amp;åº“çš„çº¦å®š"></a>æœåŠ¡&amp;åº“çš„çº¦å®š</h3><p>åœ¨create-skynetçš„é…ç½®ä¸­ï¼Œæ¯ä¸ªæœåŠ¡çš„luaæ–‡ä»¶å…¥å£ä»¥configä¸­<code>luaservice</code>é¡¹ä¸ºå‡†ï¼š</p>
<ul>
<li>service/æœåŠ¡å.lua</li>
<li>service/æœåŠ¡å/main.lua</li>
<li>skynet/service/æœåŠ¡å.luaï¼ˆé»˜è®¤çš„æœåŠ¡ï¼‰</li>
</ul>
<p>skynetå¯åŠ¨æ—¶ä¼šæ ¹æ®æœåŠ¡åæ³¨å†Œç›¸åº”æœåŠ¡ï¼Œå› æ­¤è‡ªå·±åœ¨serviceä¸‹å®šä¹‰çš„æœåŠ¡åæœ€å¥½ä¸è¦ä¸skynetåŸæœ‰æœåŠ¡é‡åã€‚</p>
<p>skynetåœ¨ä¸ºæ¯ä¸€ä¸ªæœåŠ¡è¯»å–luaåº“çš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¿è¡Œskynetè„šæœ¬çš„å·¥ä½œç›®å½•ä»¥åŠconfigé‡Œçš„è®¾ç½®å»è¯»å–ï¼Œè¿™æ˜¯ç”±configçš„<code>lua_path</code>ä¸<code>lua_cpath</code>ä¸ºå‡†çš„ã€‚åœ¨create-skyneté‡Œï¼Œlualibçš„ä½ç½®æœ‰ï¼š</p>
<a id="more"></a>
<ul>
<li>service/æœåŠ¡å/?.lua</li>
<li>lualib/?.lua</li>
<li>luaclib/?.so</li>
<li>skynet/lualib/?.luaï¼ˆé»˜è®¤ï¼‰</li>
<li>skynet/luaclib/?.soï¼ˆé»˜è®¤ï¼‰</li>
</ul>
<p>å› æ­¤åç»­åœ¨æœåŠ¡é€»è¾‘ä¸­requireæ—¶ï¼Œéœ€è¦æ³¨æ„lualibæ–‡ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚</p>
<p>skynetæ›´å¤šå…·ä½“çš„configè®¾ç½®ï¼Œå¯å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc2t5bmV0L3dpa2kvQ29uZmln" title="https://github.com/cloudwu/skynet/wiki/Config">å®˜æ–¹wiki<i class="fa fa-external-link"></i></span></p>
<h3 id="å¯åŠ¨skynetæœåŠ¡"><a href="#å¯åŠ¨skynetæœåŠ¡" class="headerlink" title="å¯åŠ¨skynetæœåŠ¡"></a>å¯åŠ¨skynetæœåŠ¡</h3><p>create-skynetå®ç°äº†skynetæœ€ç®€å•çš„sprotoæœåŠ¡çš„ä¾‹å­ã€‚å¦‚æœæ‚¨å¯¹sprotoä¸äº†è§£ï¼Œå¯ä»¥å‚é˜…ç¬”è€…çš„<a href="https://utmhikari.github.io/2019/09/12/luatalk/sproto/">luaä¸“ç”¨rpcåè®®sproto</a>ä¸€æ–‡ã€‚</p>
<p>åœ¨create-skyneté‡Œï¼Œconfigçš„starté¡¹æŒ‡å®šäº†åˆå§‹çš„æœåŠ¡å…¥å£â€”â€”<code>main</code>ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€åœ¨<code>service/main.lua</code>é‡Œå†™å†…å®¹ï¼Œskynetå°±ä¼šè‡ªåŠ¨è¯»åˆ°ã€‚</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- service/main.lua</span></span><br><span class="line"><span class="keyword">local</span> skynet = <span class="built_in">require</span> <span class="string">"skynet"</span></span><br><span class="line"></span><br><span class="line">skynet.start(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    skynet.<span class="built_in">error</span>(<span class="string">"create-skynet start server~"</span>)</span><br><span class="line">    skynet.uniqueservice(<span class="string">"proto"</span>)</span><br><span class="line">    <span class="keyword">local</span> debug_console_port = skynet.<span class="built_in">getenv</span>(<span class="string">"debug_console_port"</span>)</span><br><span class="line">    <span class="keyword">if</span> debug_console_port <span class="keyword">then</span></span><br><span class="line">        skynet.newservice(<span class="string">"debug_console"</span>, debug_console_port)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    skynet.newservice(<span class="string">"db"</span>)</span><br><span class="line">    <span class="keyword">local</span> watchdog = skynet.newservice(<span class="string">"watchdog"</span>)</span><br><span class="line">    <span class="keyword">local</span> watchdog_port = skynet.<span class="built_in">getenv</span>(<span class="string">"watchdog_port"</span>)</span><br><span class="line">    skynet.call(watchdog, <span class="string">"lua"</span>, <span class="string">"start"</span>, &#123;</span><br><span class="line">        port = watchdog_port,</span><br><span class="line">        nodelay = <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">    skynet.<span class="built_in">error</span>(<span class="string">"Watchdog listening on"</span>, watchdog_port)</span><br><span class="line">    skynet.<span class="built_in">exit</span>()</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸»å…¥å£<code>service/main.lua</code>ä¸­ï¼Œé€šè¿‡<code>skynet.start(callback)</code>çš„å½¢å¼ï¼Œå°±å¯ä»¥å®šä¹‰è¯¥æœåŠ¡å¯åŠ¨æ—¶çš„é€»è¾‘ã€‚é¦–å…ˆå¯åŠ¨äº†åè®®æœåŠ¡<code>proto</code>ï¼›å…¶æ¬¡é€šè¿‡<code>skynet.getenv</code>è¯»å–<code>debug_console_port</code>é…ç½®é¡¹ï¼Œå¦‚æœæœ‰åˆ™å¯åŠ¨skynetå†…ç½®<code>debug_console</code>æœåŠ¡ï¼›è€Œåå¯åŠ¨<code>db</code>æœåŠ¡ï¼Œæ˜¯ä¸€ä¸ªæ„æ€æ„æ€çš„å†…å­˜kvæ•°æ®åº“ï¼›ä¹‹åå¯åŠ¨<code>watchdog</code>ï¼Œç›‘å¬é…ç½®çš„<code>watchdog_port</code>æ‰€å¯¹åº”çš„ç«¯å£ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è§£æ„<code>watchdog</code>æœåŠ¡ï¼Œä»è€Œäº†è§£skynetæœåŠ¡çš„åŸºæœ¬æ ·å¼ã€‚</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- service/watchdog/main.lua</span></span><br><span class="line"><span class="keyword">local</span> skynet = <span class="built_in">require</span> <span class="string">"skynet"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> CMD = &#123;&#125;</span><br><span class="line"><span class="keyword">local</span> SOCKET = &#123;&#125;</span><br><span class="line"><span class="keyword">local</span> gate</span><br><span class="line"><span class="keyword">local</span> agent = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SOCKET.open</span><span class="params">(fd, addr)</span></span></span><br><span class="line">    skynet.<span class="built_in">error</span>(<span class="string">"New client from : "</span> .. addr)</span><br><span class="line">    agent[fd] = skynet.newservice(<span class="string">"agent"</span>)</span><br><span class="line">    skynet.call(agent[fd], <span class="string">"lua"</span>, <span class="string">"start"</span>, &#123;</span><br><span class="line">        gate = gate, client = fd, watchdog = skynet.self()</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">close_agent</span><span class="params">(fd)</span></span></span><br><span class="line">    <span class="keyword">local</span> a = agent[fd]</span><br><span class="line">    agent[fd] = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">if</span> a <span class="keyword">then</span></span><br><span class="line">        skynet.call(gate, <span class="string">"lua"</span>, <span class="string">"kick"</span>, fd)</span><br><span class="line">        <span class="comment">-- disconnect never return</span></span><br><span class="line">        skynet.send(a, <span class="string">"lua"</span>, <span class="string">"disconnect"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SOCKET.close</span><span class="params">(fd)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"socket close"</span>,fd)</span><br><span class="line">    close_agent(fd)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SOCKET.error</span><span class="params">(fd, msg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"socket error"</span>,fd, msg)</span><br><span class="line">    close_agent(fd)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SOCKET.warning</span><span class="params">(fd, size)</span></span></span><br><span class="line">    <span class="comment">-- size K bytes havn't send out in fd</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"socket warning"</span>, fd, size)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SOCKET.data</span><span class="params">(fd, msg)</span></span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CMD.start</span><span class="params">(conf)</span></span></span><br><span class="line">    skynet.call(gate, <span class="string">"lua"</span>, <span class="string">"open"</span> , conf)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CMD.close</span><span class="params">(fd)</span></span></span><br><span class="line">    close_agent(fd)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">skynet.start(<span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">    skynet.dispatch(<span class="string">"lua"</span>, <span class="function"><span class="keyword">function</span><span class="params">(session, source, cmd, subcmd, ...)</span></span></span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">"socket"</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> f = SOCKET[subcmd]</span><br><span class="line">            f(...)</span><br><span class="line">            <span class="comment">-- socket api don't need return</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">local</span> f = <span class="built_in">assert</span>(CMD[cmd])</span><br><span class="line">            skynet.ret(skynet.pack(f(subcmd, ...)))</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line">    gate = skynet.newservice(<span class="string">"gate"</span>)</span><br><span class="line"><span class="keyword">end</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨<code>watchdog</code>æœåŠ¡ä¸»å…¥å£çš„ä»£ç ä¸­ï¼Œå‡ºç°äº†<code>skynet.dispatch</code>ï¼Œå®ƒä¼šä¸ºæŸä¸ªç±»å‹çš„æ¶ˆæ¯æ³¨å†Œå›è°ƒå‡½æ•°ä»è€Œè¿›è¡Œå¤„ç†ã€‚å¦‚æœå“ªä¸ªæœåŠ¡è°ƒç”¨äº†<code>skynet.send/call(watchdogåœ°å€, &quot;lua&quot;, ...)</code>ï¼Œé‚£ä¹ˆ<code>watchdog</code>å°±ä¼šæ‹¿å›è°ƒå‡½æ•°è·Ÿåè¾¹<code>...</code>çš„å‚æ•°å‡‘ä¸Šå»ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘äº†ã€‚</p>
<p>åœ¨skynetæ¶æ„ä¸­ï¼Œ<code>watchdog</code>ä¸å†…ç½®çš„ç½‘å…³æœåŠ¡<code>gate</code>æ˜¯å¼ºè€¦åˆçš„ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>watchdog</code>åœ¨åˆšå¯åŠ¨æ—¶ä¹Ÿä¼šæ–°å¢<code>gate</code>æœåŠ¡ï¼Œç„¶å<code>service/main.lua</code>è°ƒç”¨<code>skynet.call(watchdog, &quot;lua&quot;, &quot;start&quot;, é…ç½®)</code>æ—¶ï¼Œ<code>watchdog</code>ä¸»å…¥å£ä¸­å¯¹åº”çš„<code>CMD.start</code>å°±ä¼šè¢«æ‰§è¡Œï¼Œç„¶ååœ¨<code>gate</code>è°ƒç”¨çš„<code>gateserver.lua</code>ä¸­ï¼Œ<code>CMD.open</code>çš„å¼€å¯ç«¯å£ç›‘å¬çš„é€»è¾‘è¢«æ‰§è¡Œäº†ã€‚ä¹‹åï¼Œå¦‚æœæœ‰æ–°çš„è¿æ¥ï¼Œ<code>gate</code>ä¼šé€šçŸ¥<code>watchdog</code>æ–°è¿æ¥çš„fdè·Ÿåœ°å€ï¼Œå¹¶ä¸”è€Œ<code>watchdog</code>åªéœ€è¦è´Ÿè´£æ–°å¢<code>agent</code>æœåŠ¡ï¼Œæ ¹æ®socketçš„ä¸åŒæƒ…å†µæ‰§è¡Œç›¸åº”å›è°ƒç®¡ç†<code>agent</code>å°±å¥½äº†ã€‚</p>
<p>åœ¨<code>agent</code>æœåŠ¡é‡Œï¼Œåªéœ€è¦æ ¹æ®è¿æ¥çš„fdï¼Œè¯»å–æˆ–å‘é€æ•°æ®å°±å¥½ï¼Œç½‘å…³æœåŠ¡<code>gate</code>ä¼šå¸®ä½ åˆ†åŒ…ã€‚è¿™é‡Œ<code>agent</code>ä¸»å…¥å£ä¹Ÿé‡‡ç”¨å®˜æ–¹ä¾‹å­ä¸­çš„ä»£ç ï¼ŒåŸºæœ¬çš„å¥—è·¯ä¹Ÿæ˜¯ä¸€æ–¹é¢ä¸æ–­readè¿™ä¸ªfdå‡ºæ¥çš„æ•°æ®ï¼Œè¯†åˆ«sprotoï¼Œç„¶åè°ƒç”¨<code>db</code>æœåŠ¡å­˜å–æ•°æ®ï¼›å¦ä¸€æ–¹é¢ä¼šéš”ä¸€æ®µæ—¶é—´å‘fdå†™å…¥å¿ƒè·³åŒ…ï¼Œå®ç°åŒå·¥é•¿è¿æ¥tcpã€‚æ­¤å¤„ä¾¿ä¸å†èµ˜è¿°å•¦~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>skynetçš„åŸºæœ¬ç”¨æ³•ä¾¿æ˜¯å¦‚æ­¤ï¼Œåé¢è¿˜æœ‰å¾ˆå¤šæŒ–æ˜ç‚¹ï¼Œå¯ä»¥æŸ¥çœ‹wikiç­‰èµ„æ–™æ·±å…¥æ¢ç´¢~</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>lua</tag>
        <tag>skynet</tag>
        <tag>create-skynet</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘electron+react+antdæ·±è‰²ä¸»é¢˜æ‰“é€ æ¡Œé¢åº”ç”¨</title>
    <url>/2019/10/20/geekdaily/electron_react/</url>
    <content><![CDATA[<p>æ¡Œé¢åº”ç”¨çš„å®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œä½†è°ˆåˆ°å¤šæ“ä½œç³»ç»Ÿå¹³å°å…¼å®¹çš„è¯ï¼Œå°±ä¸å¾—ä¸æåˆ°<span class="exturl" data-url="aHR0cHM6Ly9lbGVjdHJvbmpzLm9yZy8=" title="https://electronjs.org/">electron<i class="fa fa-external-link"></i></span>ã€‚electronæ˜¯å‰ç«¯å¼€å‘çš„åˆ©å¥½ï¼Œåšè¿‡webå‰ç«¯çš„åŒå­¦åªè¦ç¨å¾®è¿ç§»ä¸‹è‡ªå·±çš„é¡¹ç›®ï¼Œå°±èƒ½å¤Ÿå°†åŸæœ¬çš„webå‰ç«¯å˜æˆæ¡Œé¢åº”ç”¨ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬æ–‡ä»¥reactä¸ºä¾‹ï¼Œä»¥antdä¸ºUIåº“æ”¯æŒï¼Œè®²è§£åŸºäºreactçš„electronåº”ç”¨è¯¥å¦‚ä½•æ­å»ºã€‚</p>
<p>é¦–å…ˆï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2VsZWN0cm9uLXJlYWN0LWJvaWxlcnBsYXRlL2VsZWN0cm9uLXJlYWN0LWJvaWxlcnBsYXRl" title="https://github.com/electron-react-boilerplate/electron-react-boilerplate">electron-react-boilerplate<i class="fa fa-external-link"></i></span>é¡¹ç›®ï¼Œå°±å¸®åŠ©æˆ‘ä»¬åˆå§‹åŒ–äº†åŸºäºreactçš„electronåº”ç”¨ã€‚electron-react-boilerplateå†…ç½®äº†flowé™æ€ç±»å‹æ£€æŸ¥æœºåˆ¶ã€åŸºäºwebpackçš„electronåº”ç”¨æ‰“åŒ…æ”¯æŒä»¥åŠwith reduxçš„å‰ç«¯æ¶æ„ã€‚æ•…åœ¨æ­¤åŸºç¡€ä¸Šå†å¼•å…¥å…¶å®ƒçš„libï¼Œä¹Ÿä¸ä¼šè¿‡äºå›°éš¾ã€‚æœ¬æ–‡é‡‡ç”¨çš„electron-react-boilerplateç‰ˆæœ¬ä¸º0.17.1ã€‚</p>
<p>é€šè¿‡<code>yarn add antd</code>ï¼Œå°±å¯ä»¥å®‰è£…ä¸Šantdåº“ã€‚è¦åœ¨å†…ç½®çš„ä¾‹å­é‡Œä»¥antdä¸ºlayoutçš„è¯ï¼Œé¦–å…ˆéœ€è¦åœ¨<code>app</code>æ–‡ä»¶å¤¹ä¸‹æ–°å»º<code>app.global.less</code>æ–‡ä»¶ï¼Œå¡«å……å†…å®¹ï¼š<code>@import &#39;../node_modules/antd/dist/antd.less&#39;;</code>ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å†è§‚å¯Ÿåˆ°ï¼Œ<code>app/containers/Root.js</code>æ˜¯redux storeçš„æŠ½è±¡å±‚ï¼Œwrapäº†è·¯ç”±ï¼›è·¯ç”±æ‰€åœ¨çš„æ–‡ä»¶ä¸º<code>app/Route.js</code>ï¼Œæ˜¯ä»¥<code>&lt;App&gt;</code>æ ‡ç­¾ä¸ºæ ¹çš„è·¯ç”±é›†åˆï¼›<code>&lt;App&gt;</code>ä¸»ç•Œé¢æ‰€åœ¨çš„æ–‡ä»¶ä¸º<code>app/containers/App.js</code>ï¼Œæˆ‘ä»¬é€šè¿‡æ›´æ”¹å…¶ä¸­çš„å†…å®¹ï¼Œå°±å¯ä»¥å˜æ¢ä¸»ç•Œé¢çš„æ ·å¼äº†ã€‚æˆ‘ä»¬å°±ä»¥antdçš„layoutä¸ºä¾‹ï¼Œå†™ä¸€ä¸ªAppä¸»ç•Œé¢ï¼š</p>
<a id="more"></a>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">'prop-types'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; withRouter &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Layout, Card, Icon, Menu, Button &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; shell &#125; <span class="keyword">from</span> <span class="string">'electron'</span>;</span><br><span class="line"><span class="keyword">import</span> routes <span class="keyword">from</span> <span class="string">'../constants/routes'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Sider, Content &#125; = Layout;</span><br><span class="line"></span><br><span class="line">type Props = &#123;</span><br><span class="line">  children: React.Node</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type State = &#123;</span><br><span class="line">  menuKey: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> menuList = [</span><br><span class="line">  &#123; <span class="attr">key</span>: <span class="string">'note'</span>, <span class="attr">text</span>: <span class="string">'ç¬”è®°'</span>, <span class="attr">icon</span>: <span class="string">'book'</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">key</span>: <span class="string">'setting'</span>, <span class="attr">text</span>: <span class="string">'è®¾ç½®'</span>, <span class="attr">icon</span>: <span class="string">'setting'</span> &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span>&lt;<span class="title">Props</span>, <span class="title">State</span>&gt; </span>&#123;</span><br><span class="line">  props: Props;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> propTypes = &#123;</span><br><span class="line">    history: PropTypes.object.isRequired</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  state = &#123;</span><br><span class="line">    menuKey: <span class="string">'note'</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleMenuClick = <span class="function">(<span class="params">e: Event</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">menuKey</span>: e.key &#125;);</span><br><span class="line">    <span class="keyword">const</span> &#123; history &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    history.push(routes[e.key]);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; children &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; menuKey &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout style=&#123;&#123; <span class="attr">minHeight</span>: <span class="string">'100vh'</span> &#125;&#125;&gt;</span><br><span class="line">        &lt;Sider collapsible=&#123;<span class="literal">false</span>&#125;&gt;</span><br><span class="line">          &lt;Menu</span><br><span class="line">            style=&#123;&#123; <span class="attr">height</span>: <span class="string">'100%'</span> &#125;&#125;</span><br><span class="line">            theme=<span class="string">"dark"</span></span><br><span class="line">            onClick=&#123;<span class="keyword">this</span>.handleMenuClick&#125;</span><br><span class="line">            selectedKeys=&#123;[menuKey]&#125;</span><br><span class="line">            mode=<span class="string">"inline"</span></span><br><span class="line">          &gt;</span><br><span class="line">            &#123;menuList.map(<span class="function"><span class="params">item</span> =&gt;</span> (</span><br><span class="line">              &lt;Menu.Item key=&#123;item.key&#125;&gt;</span><br><span class="line">                &lt;span&gt;</span><br><span class="line">                  &lt;Icon type=&#123;item.icon&#125; /&gt;</span><br><span class="line">                  &#123;<span class="string">`\t<span class="subst">$&#123;item.text&#125;</span>`</span>&#125;</span><br><span class="line">                &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Menu.Item&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;<span class="regexp">/Menu&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Sider&gt;</span><br><span class="line">        &lt;Content&gt;</span><br><span class="line">          &lt;Card</span><br><span class="line">            title=&#123;menuList.find(<span class="function"><span class="params">i</span> =&gt;</span> i.key === menuKey).text&#125;</span><br><span class="line">            style=&#123;&#123; <span class="attr">height</span>: <span class="string">'100%'</span> &#125;&#125;</span><br><span class="line">            extra=&#123;</span><br><span class="line">              &lt;Button</span><br><span class="line">                shape=<span class="string">"circle"</span></span><br><span class="line">                onClick=&#123;() =&gt;shell.openExternal(<span class="string">'https://github.com'</span>)&#125;</span><br><span class="line">                icon=<span class="string">"github"</span></span><br><span class="line">              /&gt;</span><br><span class="line">            &#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;children&#125;</span><br><span class="line">          &lt;<span class="regexp">/Card&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Content&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default withRouter(App);</span></span><br></pre></td></tr></table></figure>
<p>å†™Appä¸»ç•Œé¢åï¼Œè®°å¾—ä¹Ÿå¾—å®æ—¶æ›´æ–°<code>app/Route.js</code>ä»¥åŠå…¶å…³è”çš„<code>app/constants/routes.json</code>æ•°æ®å–”~</p>
<p>åœ¨<code>app/containers</code>ä¸­å…¶å®ƒä»¥<code>Page</code>ç»“å°¾çš„æ–‡ä»¶ï¼Œçº¦å®šä¿—æˆæ˜¯å„ä¸ªå­è·¯ç”±ç»‘å®šreduxçš„å±‚æ¬¡ã€‚æ¯”å¦‚åœ¨ä¸Šé¢æˆ‘ä»¬è®¾ç½®äº†ç¬”è®°çš„menuï¼Œé‚£ä¹ˆåœ¨<code>app/containers/NotePage.js</code>ä¸­ï¼Œå°±å¯ä»¥å®šä¹‰è·Ÿreduxçš„ç»‘å®šï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; bindActionCreators &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> Note <span class="keyword">from</span> <span class="string">'../components/note/index'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> NoteActions <span class="keyword">from</span> <span class="string">'../actions/note'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapStateToProps</span>(<span class="params">state</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...state.note &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mapDispatchToProps</span>(<span class="params">dispatch</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> bindActionCreators(NoteActions, dispatch);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps</span><br><span class="line">)(Note);</span><br></pre></td></tr></table></figure>
<p>ä¹‹ååœ¨<code>app/components/note/index.js</code>ä¸­ï¼Œå°±å¯ä»¥ç¼–å†™ç¬”è®°é¡µé¢çš„æ ·å¼äº†ã€‚</p>
<p>è‡³äºreduxè¿™å—ï¼Œç”±äºflowå¢åŠ äº†é™æ€æ£€æŸ¥ï¼Œå› æ­¤ä¼šç¨å¾®éº»çƒ¦ä¸€ç‚¹ã€‚è™½ç„¶åœ¨<code>app/reducers/index.js</code>ä¸­å·²ç»å¸®æˆ‘ä»¬å®Œæˆäº†reducerçš„ç»‘å®šï¼Œä½†åœ¨<code>app/reducers/types.js</code>ä¸­ï¼Œè¿˜éœ€è¦åˆå§‹åŒ–å„ä¸ªstateçš„ç±»å‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> type &#123; Dispatch <span class="keyword">as</span> ReduxDispatch, Store <span class="keyword">as</span> ReduxStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// action</span></span><br><span class="line"><span class="keyword">export</span> type Action = &#123;</span><br><span class="line">  +type: string</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// note state</span></span><br><span class="line"><span class="keyword">export</span> type NoteState = &#123;</span><br><span class="line">  notes: <span class="built_in">Array</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// state type</span></span><br><span class="line"><span class="keyword">export</span> type StateType = &#123;</span><br><span class="line">  note: NoteState</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type GetState = <span class="function"><span class="params">()</span> =&gt;</span> StateType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type Dispatch = ReduxDispatch&lt;Action&gt;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type Store = ReduxStore&lt;GetState, Action&gt;;</span><br></pre></td></tr></table></figure>
<p>ä¹‹åæ ¹æ®é¢„å®šä¹‰çš„ç±»å‹ï¼Œå†å†™actionè·Ÿreducerã€‚æ‹¿noteç¬”è®°æ¨¡å—ä¸ºä¾‹ï¼Œactionè·Ÿreducerå¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app/actions/note.js</span></span><br><span class="line"><span class="keyword">import</span> type &#123; Dispatch &#125; <span class="keyword">from</span> <span class="string">'../reducers/types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch: Dispatch</span>) =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">'ADD_NOTE'</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span>(<span class="params">index: number</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch: Dispatch</span>) =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">'EDIT_NOTE'</span>, index &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch: Dispatch</span>) =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">'REMOVE_NOTE'</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">clear</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch: Dispatch</span>) =&gt;</span> dispatch(&#123; <span class="attr">type</span>: <span class="string">'CLEAR_NOTE'</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// app/reducers/note.js</span></span><br><span class="line"><span class="keyword">import</span> type &#123; Action, NoteState &#125; <span class="keyword">from</span> <span class="string">'./types'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> defaultState: NoteState = &#123;</span><br><span class="line">  notes: []</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addNote = <span class="function"><span class="params">state</span> =&gt;</span> (&#123;</span><br><span class="line">  ...state,</span><br><span class="line">  notes: [...state.notes, state.notes.length + <span class="number">1</span>]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> editNote = <span class="function">(<span class="params">state, payload</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; notes &#125; = state;</span><br><span class="line">  <span class="keyword">const</span> &#123; index &#125; = payload;</span><br><span class="line">  <span class="built_in">console</span>.log(payload);</span><br><span class="line">  <span class="keyword">if</span> (index &gt;= notes.length || index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> newNotes = [...notes];</span><br><span class="line">  newNotes[index] *= <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123; ...state, <span class="attr">notes</span>: newNotes &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> removeNote = <span class="function"><span class="params">state</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; notes &#125; = state;</span><br><span class="line">  <span class="keyword">if</span> (notes.length === <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> newNotes = [...notes];</span><br><span class="line">  newNotes.splice(newNotes.length - <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span> &#123; ...state, <span class="attr">notes</span>: newNotes &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clearNote = <span class="function"><span class="params">state</span> =&gt;</span> (&#123; ...state, <span class="attr">notes</span>: [] &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">note</span>(<span class="params">state: NoteState = defaultState, action: Action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; type, ...payload &#125; = action;</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'ADD_NOTE'</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> addNote(state);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'EDIT_NOTE'</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> editNote(state, payload);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'REMOVE_NOTE'</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> removeNote(state);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'CLEAR_NOTE'</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> clearNote(state);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">default</span>: &#123;</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ä¾¿åˆå§‹åŒ–å¥½äº†åŸºæœ¬çš„ç¬”è®°å¢åˆ æ”¹æŸ¥æ“ä½œï¼Œæ•´ä¸ªæ¡Œé¢åº”ç”¨å°±æœ‰é›å½¢äº†ã€‚</p>
<p>æ¡Œé¢è½¯ä»¶ä¸€èˆ¬ä¼šæœ‰æ ‡é¢˜ä¸èœå•æ ï¼Œæ ‡é¢˜çš„ä¿®æ”¹æ˜¯åœ¨<code>app/app.html</code>çš„<code>title</code>æ ‡ç­¾ï¼Œè€Œèœå•çš„ä¿®æ”¹åœ¨<code>app/menu.js</code>ä¸­ã€‚</p>
<p>antdçš„æ·±è‰²ä¸»é¢˜åœ¨æ¡Œé¢åº”ç”¨ä¸­æ˜¾ç¤ºä¼šä¸é”™ï¼Œå› æ­¤æˆ‘ä»¬æƒ³è¦æœ€ç»ˆäº§å“ä¸ºæ·±è‰²ä¸»é¢˜ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºæˆ‘ä»¬åˆšå¼€å§‹å¼•å…¥antdæ–°å»ºäº†lessæ–‡ä»¶ï¼Œä½†electron-react-boilerplateé»˜è®¤ä¸æ”¯æŒlessï¼Œå› æ­¤éœ€è¦æˆ‘ä»¬åœ¨å¼€å‘ä¸ç”Ÿäº§ç¯å¢ƒçš„webpacké…ç½®ä¸­ï¼ˆ<code>configs/webpack.config.renderer.dev.babel.js</code>ä¸<code>configs/webpack.config.renderer.prod.babel.js</code>ï¼‰å…ˆå°†antdçš„æ·±è‰²ä¸»é¢˜importè¿›æ¥ï¼Œç„¶åè‡ªè¡Œ<code>yarn add less-loader</code>ï¼Œå†åœ¨é…ç½®ä¸­çš„<code>module.rules</code>åˆ—è¡¨ä¸­ï¼Œè¿½åŠ ä¸€æ®µå°±å¥½ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> antdTheme <span class="keyword">from</span> <span class="string">'@ant-design/dark-theme'</span>;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">  use: [</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'style-loader'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'css-loader'</span> <span class="comment">// translates CSS into CommonJS</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      loader: <span class="string">'less-loader'</span>, <span class="comment">// compiles Less to CSS</span></span><br><span class="line">      options: &#123;</span><br><span class="line">        modifyVars: antdTheme,</span><br><span class="line">        javascriptEnabled: <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œelectron+react+antdæ·±è‰²ä¸»é¢˜æ¡Œé¢åº”ç”¨çš„åŸºç¡€æµç¨‹å°±æ‰“é€šäº†ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>æ¡Œé¢åº”ç”¨</tag>
        <tag>react</tag>
        <tag>å‰ç«¯å¼€å‘</tag>
        <tag>electron</tag>
        <tag>antd</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘åŸºäºluaçš„æœåŠ¡ç«¯æ¶æ„â€”â€”skyneté€šä¿¡åŸç†ä¸æºç åˆ†æ</title>
    <url>/2019/10/20/luatalk/skynet/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æèµ·ä¸­å›½çš„luaäº§å“ï¼Œå°±ä¸å¾—ä¸æƒ³åˆ°<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc2t5bmV0" title="https://github.com/cloudwu/skynet">skynet<i class="fa fa-external-link"></i></span>ï¼Œä¸€æ¬¾é’ˆå¯¹æ¸¸æˆï¼Œä½†åˆä¸ä»…é™äºæ¸¸æˆçš„æœåŠ¡ç«¯æ¶æ„ã€‚skynetå……åˆ†åˆ©ç”¨äº†luaçš„ç‰¹æ€§ï¼Œå¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šæ˜“æ‰©å±•HTTPã€HTTPSã€WebSocketç­‰æ¨¡å—ï¼Œå› æ­¤ç”±skynetå…¥æ‰‹ç†è§£luaåŸç†ä»¥åŠæœåŠ¡ç«¯æ¶æ„æ˜¯ä¸€ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>é€šè¿‡skynetï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºè®¸å¤šå°å·§è€Œé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„åº”ç”¨ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥æ¢ç´¢skynetæ¶æ„å§~</p>
<h2 id="skyneté€šä¿¡åŸç†ä¸æºç åˆ†æ"><a href="#skyneté€šä¿¡åŸç†ä¸æºç åˆ†æ" class="headerlink" title="skyneté€šä¿¡åŸç†ä¸æºç åˆ†æ"></a>skyneté€šä¿¡åŸç†ä¸æºç åˆ†æ</h2><p>æœåŠ¡ç«¯æ¶æ„ä¸­ï¼Œä¸åŒå­æœåŠ¡çš„é€šä¿¡è°ƒåº¦æ˜¯æ ¸å¿ƒåŠŸèƒ½ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ä»¥å•ç‚¹ï¼ˆstandaloneï¼‰çš„skynetå®ä¾‹ä¸ºä¾‹ï¼Œç”±å¤–è€Œå†…ï¼Œé€æ­¥å‰–æã€‚</p>
<p>è¦ä»‹ç»skynetçš„é€šä¿¡åŸç†ï¼Œé¦–å…ˆè¦æåˆ°luaä¸­çš„ä¸€ä¸ªæ¦‚å¿µâ€”â€”lua_Stateã€‚lua_Stateæ˜¯luaçš„è¿è¡Œæ—¶ï¼ˆruntimeï¼‰ï¼Œæ˜¯ä¸€ä¸ªåŸç”Ÿéš”ç¦»çš„ã€é«˜æ€§èƒ½çš„è¿è¡Œç¯å¢ƒï¼Œè‹¥åœ¨å¤šæ ¸å¹¶è¡Œè¿è¡Œlua_Stateï¼Œå…¶æ€§èƒ½ä¸€å®šä¸ä¼šå·®ã€‚luaä½œä¸ºåµŒå…¥å¼è¯­è¨€ï¼Œä»¥Cä¸ºåŸºç¡€ï¼Œå¯ä»¥å®ç°æ“ä½œç³»ç»Ÿç²’åº¦çº§çš„lua_Stateè°ƒåº¦ï¼Œå› æ­¤skynetä¹Ÿå°±å¦‚åŒlua_Stateç®¡ç†å™¨ä¸€æ ·äº†ã€‚</p>
<p>æ¯ä¸€ç§ä¸šåŠ¡å¯ä»¥çœ‹ä½œä¸€ä¸ªserviceï¼Œè€Œæ¯ä¸€ä¸ªserviceä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªlua_Stateå……å½“æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„ç¯å¢ƒã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨å®é™…å¼€å‘å½“ä¸­ï¼Œæ¯”å¦‚åšä¸€ä¸ªHTTPæœåŠ¡çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±é¢„å…ˆé…ç½®å¥½çš„skynet serviceä¸»å…¥å£luaæ–‡ä»¶ä¸­ï¼Œå†™ä¸Š<code>skynet.uniqueservice(&quot;app&quot;)</code>å¯åŠ¨ä¸€ä¸ªç‹¬ç‰¹çš„åä¸º<code>app</code>çš„æœåŠ¡ï¼Œè€Œååœ¨å…¶ä¸­çš„é€»è¾‘ä¸­ï¼Œæ ¹æ®æ¯ä¸€ä¸ªHTTPè¿æ¥ï¼Œè§£æå…¶ä¸­çš„æ•°æ®åŒ…ã€‚å¹¶è°ƒç”¨<code>skynet.newservice</code>åŠ¨æ€åˆ›å»ºå•ç‹¬çš„ä¸Šä¸‹æ–‡æœåŠ¡<code>ctx</code>æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚<code>ctx</code>æœåŠ¡è¿˜æœ‰å¯èƒ½éœ€è¦æŸ¥è¯¢æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œå¹¶è¿”å›ç»“æœï¼Œå› æ­¤æˆ‘ä»¬å¯èƒ½è¿˜éœ€è¦é€šè¿‡<code>skynet.uniqueservice(&quot;db&quot;)</code>é¢„å…ˆåˆ›å»ºæ•°æ®åº“æœåŠ¡<code>db</code>äºŒæ¬¡å°è£…skynetå†…ç½®mongoã€mysqlåº“çš„åŠŸèƒ½ï¼Œç„¶åå†é€šè¿‡<code>skynet.call</code>æ¥ä¸<code>db</code>æœåŠ¡é€šä¿¡ï¼Œè·å¾—<code>db</code>æœåŠ¡æŸä¸ªå‡½æ•°æ‰§è¡Œçš„è¿”å›ç»“æœï¼Œå†åœ¨<code>ctx</code>æœåŠ¡çš„å¤„ç†é€»è¾‘ä¸­å†™å…¥HTTP Responseï¼Œä»è€Œå®Œæˆæ•´ä¸ªå¤„ç†è¿‡ç¨‹ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œå…·ä½“ä¸šåŠ¡é€»è¾‘çš„å¤„ç†éƒ½ä¼šåœ¨å„ä¸ªserviceæ‰€æ‹¥æœ‰çš„lua_Stateä¸­è¿è¡Œï¼Œä½†è°ƒåº¦é€šä¿¡çš„é€»è¾‘ï¼Œåˆ™å°±æ˜¯åº•å±‚çš„æ´»äº†ã€‚</p>
<p>å› æ­¤åœ¨skynetåº•å±‚ä¸­ï¼Œä¸ä»…éœ€è¦æ”¯æŒå¤šä¸ªlua_Stateçš„è¿è½¬ï¼Œè€Œä¸”ç›¸å¯¹æ›´æœ‰æŒ‘æˆ˜æ€§çš„æ˜¯ï¼Œå¦‚ä½•è®©serviceä¹‹é—´èƒ½å¤Ÿç›¸äº’äº¤æµã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨åº•å±‚ä¸­ï¼Œæ¯ä¸€ä¸ªserviceéƒ½å±äº<code>snlua</code>ç±»å‹ã€‚<code>snlua</code>é™¤äº†åŒ…æ‹¬è‡ªå·±çš„lua_Stateä¹‹å¤–ï¼Œè¿˜ç»´æŠ¤äº†ä¸€ä¸ªç§°ä¹‹ä¸ºcontextçš„è¿è¡ŒçŠ¶æ€ï¼š</p>
<a id="more"></a>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lua-skynet.c</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">snlua</span> &#123;</span></span><br><span class="line">    lua_State * L;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_context</span> * <span class="title">ctx</span>;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * preload;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// skynet_server.c</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">skynet_context</span> &#123;</span></span><br><span class="line">    <span class="keyword">void</span> * instance;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_module</span> * <span class="title">mod</span>;</span></span><br><span class="line">    <span class="keyword">void</span> * cb_ud;</span><br><span class="line">    skynet_cb cb; <span class="comment">// ç”¨äºå¤„ç†æ¯ä¸€ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> *<span class="title">queue</span>;</span> <span class="comment">// contextä¸“å±çš„message_queue</span></span><br><span class="line">    FILE * logfile;</span><br><span class="line">    <span class="keyword">uint64_t</span> cpu_cost; <span class="comment">// in microsec</span></span><br><span class="line">    <span class="keyword">uint64_t</span> cpu_start; <span class="comment">// in microsec</span></span><br><span class="line">    <span class="keyword">char</span> result[<span class="number">32</span>];</span><br><span class="line">    <span class="keyword">uint32_t</span> handle; <span class="comment">// ç»´æŠ¤ä¸€ä¸ªhandleï¼Œå¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿçš„URL</span></span><br><span class="line">    <span class="keyword">int</span> session_id;</span><br><span class="line">    <span class="keyword">int</span> ref;</span><br><span class="line">    <span class="keyword">int</span> message_count;</span><br><span class="line">    <span class="keyword">bool</span> init;</span><br><span class="line">    <span class="keyword">bool</span> endless;</span><br><span class="line">    <span class="keyword">bool</span> profile;</span><br><span class="line"></span><br><span class="line">    CHECKCALLING_DECL</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨luaä¸šåŠ¡é€»è¾‘ä¸­æ‰§è¡Œ<code>skynet.newservice</code>æˆ–<code>skynet.uniqueservice</code>ï¼Œskynetæ¡†æ¶å°±ä¼šæ ¹æ®æœåŠ¡åç§°è¯»å–å¯¹åº”å…¥å£çš„ä»£ç æ‰§è¡Œã€‚è¦è®©è¿™ä¸ªæœåŠ¡å¯åŠ¨ï¼Œå…¥å£æ–‡ä»¶çš„ä»£ç è¿˜éœ€è¦æ·»åŠ <code>skynet.start</code>å‡½æ•°ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- skynet.lua</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skynet.start</span><span class="params">(start_func)</span></span></span><br><span class="line">    c.callback(skynet.dispatch_message)</span><br><span class="line">    init_thread = skynet.timeout(<span class="number">0</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span></span></span><br><span class="line">        skynet.init_service(start_func)</span><br><span class="line">        init_thread = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">end</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°åœ¨å¯åŠ¨ä¹‹æ—¶ï¼Œä¼šé€šè¿‡<code>c.callback</code>æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ç”¨äºåˆ†å‘æ¶ˆæ¯ï¼Œå…¶é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lua-skynet.c</span></span><br><span class="line"><span class="comment">// å¯¹åº”c.callback</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">lcallback(lua_State *L) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_context</span> * <span class="title">context</span> = <span class="title">lua_touserdata</span>(<span class="title">L</span>, <span class="title">lua_upvalueindex</span>(1));</span></span><br><span class="line">    <span class="keyword">int</span> forward = lua_toboolean(L, <span class="number">2</span>);</span><br><span class="line">    luaL_checktype(L,<span class="number">1</span>,LUA_TFUNCTION);</span><br><span class="line">    lua_settop(L,<span class="number">1</span>);</span><br><span class="line">    lua_rawsetp(L, LUA_REGISTRYINDEX, _cb);</span><br><span class="line">    lua_rawgeti(L, LUA_REGISTRYINDEX, LUA_RIDX_MAINTHREAD);</span><br><span class="line">    lua_State *gL = lua_tothread(L,<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">if</span> (forward) &#123;</span><br><span class="line">        skynet_callback(context, gL, forward_cb);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        skynet_callback(context, gL, _cb); <span class="comment">// è°ƒç”¨skynet_callbackæ³¨å†Œå›è°ƒå‡½æ•°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">forward_cb(struct skynet_context * context, <span class="keyword">void</span> * ud, <span class="keyword">int</span> type, <span class="keyword">int</span> session, <span class="keyword">uint32_t</span> source, <span class="keyword">const</span> <span class="keyword">void</span> * msg, <span class="keyword">size_t</span> sz) &#123;</span><br><span class="line">    _cb(context, ud, type, session, source, msg, sz);</span><br><span class="line">    <span class="comment">// don't delete msg in forward mode.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">_cb(struct skynet_context * context, <span class="keyword">void</span> * ud, <span class="keyword">int</span> type, <span class="keyword">int</span> session, <span class="keyword">uint32_t</span> source, <span class="keyword">const</span> <span class="keyword">void</span> * msg, <span class="keyword">size_t</span> sz) &#123;</span><br><span class="line">    <span class="comment">// å¤ªé•¿ç•¥è¿‡ï¼Œå°±æ˜¯åœ¨è¿™ä¸ªsnlua serviceçš„lua_Stateä¸Šæ‰§è¡Œé€»è¾‘å•¦</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// skynet_server.c</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">skynet_callback(struct skynet_context * context, <span class="keyword">void</span> *ud, skynet_cb cb) &#123;</span><br><span class="line">    context-&gt;cb = cb; <span class="comment">// æ³¨å†Œå›è°ƒå‡½æ•°</span></span><br><span class="line">    context-&gt;cb_ud = ud;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ€ç»ˆå¤„ç†æ¶ˆæ¯çš„é€»è¾‘ï¼Œå°±ä¼šæ³¨å†Œåˆ°contextçš„cbä¸Šã€‚contextä¼šç»´æŠ¤è¿™ä¸ªserviceä¸“å±çš„æ¶ˆæ¯é˜Ÿåˆ—<code>message_queue</code>ï¼Œå¤šä¸ªserviceçš„æ¶ˆæ¯é˜Ÿåˆ—åœ¨skyneté‡Œå°±è¢«å­˜æ”¾åœ¨ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„é˜Ÿåˆ—<code>global_queue</code>ä¸­ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// skynet_mq.c</span></span><br><span class="line"><span class="comment">// æ¯ä¸ªserviceçš„contextçš„æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">spinlock</span> <span class="title">lock</span>;</span></span><br><span class="line">    <span class="keyword">uint32_t</span> handle; <span class="comment">// ä¹Ÿç»´æŠ¤ä¸€ä¸ªhandleï¼Œé€šè¿‡è¿™ä¸ªhandleï¼Œèƒ½åè¿‡æ¥æ‰¾åˆ°å¯¹åº”çš„context</span></span><br><span class="line">    <span class="keyword">int</span> cap;</span><br><span class="line">    <span class="keyword">int</span> head;</span><br><span class="line">    <span class="keyword">int</span> tail;</span><br><span class="line">    <span class="keyword">int</span> release;</span><br><span class="line">    <span class="keyword">int</span> in_global;</span><br><span class="line">    <span class="keyword">int</span> overload;</span><br><span class="line">    <span class="keyword">int</span> overload_threshold;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_message</span> *<span class="title">queue</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> *<span class="title">next</span>;</span> <span class="comment">// å…¨å±€é˜Ÿåˆ—é‡Œçš„ä¸‹ä¸€ä¸ª</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€é˜Ÿåˆ—ï¼šåŒç«¯message_queueé˜Ÿåˆ—</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">global_queue</span> &#123;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> *<span class="title">head</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> *<span class="title">tail</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">spinlock</span> <span class="title">lock</span>;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨skynetæ¶æ„å¯åŠ¨ä¹‹é™…ï¼Œä¼šæ ¹æ®ç”¨æˆ·é…ç½®åˆ›å»ºå…¨å±€æ¶ˆæ¯é˜Ÿåˆ—ä»¥å¤–ï¼Œè¿˜ä¼šåˆå§‹åŒ–å®šæ—¶å™¨ã€æ—¥å¿—ã€socketã€é›†ç¾¤ç­‰åŸºç¡€æ¨¡å—åŠæœåŠ¡ã€‚å½“ç„¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šåˆ›å»ºå‡ ä¸ªworkerï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// skynet_start.c</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">skynet_start(struct skynet_config * config) &#123;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡ä¸Šé¢</span></span><br><span class="line">    skynet_mq_init();</span><br><span class="line">    <span class="comment">// ç•¥è¿‡ä¸­é—´</span></span><br><span class="line">    start(config-&gt;thread); <span class="comment">// configä¸­çš„threadé…ç½®é¡¹å³ä¸ºworkeræ•°</span></span><br><span class="line">    <span class="comment">// ç•¥è¿‡ä¸‹é¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">start(<span class="keyword">int</span> thread) &#123;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡ä¸Šé¢</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> weight[] = &#123;</span><br><span class="line">        <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">        <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>,</span><br><span class="line">        <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, &#125;; <span class="comment">// æ¯ä¸ªworkerçš„è´Ÿè½½</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">worker_parm</span> <span class="title">wp</span>[<span class="title">thread</span>];</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;thread;i++) &#123;</span><br><span class="line">        wp[i].m = m;</span><br><span class="line">        wp[i].id = i;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="keyword">sizeof</span>(weight)/<span class="keyword">sizeof</span>(weight[<span class="number">0</span>])) &#123;</span><br><span class="line">            wp[i].weight= weight[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            wp[i].weight = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        create_thread(&amp;pid[i+<span class="number">3</span>], thread_worker, &amp;wp[i]); <span class="comment">// åˆ›å»ºworkerçº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡ä¸‹é¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// skynet_mq.c</span></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">skynet_mq_init() &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">global_queue</span> *<span class="title">q</span> = <span class="title">skynet_malloc</span>(<span class="title">sizeof</span>(*<span class="title">q</span>));</span></span><br><span class="line">    <span class="built_in">memset</span>(q,<span class="number">0</span>,<span class="keyword">sizeof</span>(*q));</span><br><span class="line">    SPIN_INIT(q);</span><br><span class="line">    Q=q; <span class="comment">// åˆ›å»ºå…¨å±€å”¯ä¸€global_queue</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œè¿™äº›workerä¼šåšä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æŸ¥çœ‹workerçº¿ç¨‹ä»»åŠ¡çš„å‡½æ•°å®šä¹‰å³å¯çŸ¥æ™“ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// skynet_start.c</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> *</span><br><span class="line">thread_worker(<span class="keyword">void</span> *p) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">worker_parm</span> *<span class="title">wp</span> = <span class="title">p</span>;</span></span><br><span class="line">    <span class="keyword">int</span> id = wp-&gt;id;</span><br><span class="line">    <span class="keyword">int</span> weight = wp-&gt;weight;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">monitor</span> *<span class="title">m</span> = <span class="title">wp</span>-&gt;<span class="title">m</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_monitor</span> *<span class="title">sm</span> = <span class="title">m</span>-&gt;<span class="title">m</span>[<span class="title">id</span>];</span></span><br><span class="line">    skynet_initthread(THREAD_WORKER);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> * <span class="title">q</span> = <span class="title">NULL</span>;</span></span><br><span class="line">    <span class="keyword">while</span> (!m-&gt;quit) &#123;</span><br><span class="line">        <span class="comment">// å½“workerçš„ç›‘æ§monitoræœªé€€å‡ºæ—¶ï¼Œå¾ªç¯è¿è¡Œï¼Œåˆ†å‘æ¶ˆæ¯</span></span><br><span class="line">        q = skynet_context_message_dispatch(sm, q, weight);</span><br><span class="line">        <span class="comment">// ç•¥è¿‡ä¸‹é¢</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// skynet_server.c</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> *</span></span><br><span class="line"><span class="class"><span class="title">skynet_context_message_dispatch</span>(<span class="title">struct</span> <span class="title">skynet_monitor</span> *<span class="title">sm</span>, <span class="title">struct</span> <span class="title">message_queue</span> *<span class="title">q</span>, <span class="title">int</span> <span class="title">weight</span>) &#123;</span></span><br><span class="line">    <span class="keyword">if</span> (q == <span class="literal">NULL</span>) &#123; <span class="comment">// å¦‚æœæ˜¯ä¸€å¼€å§‹ï¼Œæˆ–ä¸Šä¸€æ¬¡é¢„å…ˆå–å¾—æ¶ˆæ¯é˜Ÿåˆ—ä¸ºNULL</span></span><br><span class="line">        q = skynet_globalmq_pop(); <span class="comment">// é‚£ä¹ˆå°±å°è¯•ä»å…¨å±€é˜Ÿåˆ—ä¸­popä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">if</span> (q==<span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">uint32_t</span> handle = skynet_mq_handle(q);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_context</span> * <span class="title">ctx</span> = <span class="title">skynet_handle_grab</span>(<span class="title">handle</span>);</span> <span class="comment">// æ‰¾åˆ°å¯¹åº”çš„context</span></span><br><span class="line">    <span class="keyword">if</span> (ctx == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">drop_t</span> <span class="title">d</span> = &#123;</span> handle &#125;;</span><br><span class="line">        skynet_mq_release(q, drop_message, &amp;d);</span><br><span class="line">        <span class="keyword">return</span> skynet_globalmq_pop(); <span class="comment">// é¢„å…ˆå–ä¸‹ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> i,n=<span class="number">1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_message</span> <span class="title">msg</span>;</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;n;i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (skynet_mq_pop(q,&amp;msg)) &#123; <span class="comment">// è¿”å›å€¼ä¸º0è¡¨ç¤ºæ¶ˆæ¯é˜Ÿåˆ—ä¸ä¸ºç©º</span></span><br><span class="line">            skynet_context_release(ctx);</span><br><span class="line">            <span class="keyword">return</span> skynet_globalmq_pop();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i==<span class="number">0</span> &amp;&amp; weight &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            n = skynet_mq_length(q);</span><br><span class="line">            n &gt;&gt;= weight;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> overload = skynet_mq_overload(q);</span><br><span class="line">        <span class="keyword">if</span> (overload) &#123;</span><br><span class="line">            skynet_error(ctx, <span class="string">"May overload, message queue length = %d"</span>, overload);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// skynet_monitorç›‘æ§äº†æ¯ä¸ªworkerï¼Œé€šè¿‡versionæ ‡è¯†åˆ†å‘æ¶ˆæ¯çš„æ¬¡æ•°</span></span><br><span class="line">        <span class="comment">// é€šè¿‡skynet_monitor_triggerï¼Œå¯ä»¥++versionæ ‡è¯†</span></span><br><span class="line">        <span class="comment">// workeræ˜¯ä¸€ç›´ä¸æ–­è¿è¡Œçš„ã€‚å¦‚æœversionä¸€ç›´æ²¡æ¶¨</span></span><br><span class="line">        <span class="comment">// å°±è¯´æ˜æŸä¸€ä¸ªæ¶ˆæ¯åœ¨åˆ†å‘å¤„ç†æ—¶æ­»å¾ªç¯äº†</span></span><br><span class="line">        skynet_monitor_trigger(sm, msg.source , handle);</span><br><span class="line">        <span class="keyword">if</span> (ctx-&gt;cb == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            skynet_free(msg.data);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dispatch_message(ctx, &amp;msg); <span class="comment">// åˆ†å‘æ¶ˆæ¯ç»™å¯¹åº”çš„context</span></span><br><span class="line">        &#125;</span><br><span class="line">        skynet_monitor_trigger(sm, <span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    assert(q == ctx-&gt;<span class="built_in">queue</span>);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">message_queue</span> *<span class="title">nq</span> = <span class="title">skynet_globalmq_pop</span>();</span></span><br><span class="line">    <span class="keyword">if</span> (nq) &#123;</span><br><span class="line">        <span class="comment">// If global mq is not empty , push q back, and return next queue (nq)</span></span><br><span class="line">        <span class="comment">// Else (global mq is empty or block, don't push q back, and return q again (for next dispatch)</span></span><br><span class="line">        skynet_globalmq_push(q);</span><br><span class="line">        q = nq;</span><br><span class="line">    &#125;</span><br><span class="line">    skynet_context_release(ctx);</span><br><span class="line">    <span class="keyword">return</span> q;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span></span><br><span class="line">dispatch_message(struct skynet_context *ctx, struct skynet_message *msg) &#123;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡å‰ç½®æ£€æŸ¥é€»è¾‘</span></span><br><span class="line">    <span class="keyword">int</span> reserve_msg; <span class="comment">// æ˜¯å¦åœ¨å†…å­˜ä¸­ä¿ç•™æ¶ˆæ¯æ•°æ®ï¼Ÿ</span></span><br><span class="line">    <span class="keyword">if</span> (ctx-&gt;profile) &#123; <span class="comment">// å¦‚æœåœ¨æ€§èƒ½æµ‹è¯•ï¼Œè®°å½•cpuæ—¶é—´</span></span><br><span class="line">        ctx-&gt;cpu_start = skynet_thread_time();</span><br><span class="line">        reserve_msg = ctx-&gt;cb(ctx, ctx-&gt;cb_ud, type, msg-&gt;session, msg-&gt;source, msg-&gt;data, sz);</span><br><span class="line">        <span class="keyword">uint64_t</span> cost_time = skynet_thread_time() - ctx-&gt;cpu_start;</span><br><span class="line">        ctx-&gt;cpu_cost += cost_time;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸ç®¡æ€ä¹ˆæ ·éƒ½è¦è°ƒç”¨contextçš„æ¶ˆæ¯å¤„ç†å›è°ƒå‡½æ•°å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">        reserve_msg = ctx-&gt;cb(ctx, ctx-&gt;cb_ud, type, msg-&gt;session, msg-&gt;source, msg-&gt;data, sz);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!reserve_msg) &#123;</span><br><span class="line">        skynet_free(msg-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">    CHECKCALLING_END(ctx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›workerä¼šä¸æ–­åœ°ä»å…¨å±€é˜Ÿåˆ—ä¸­å–å‡ºå•ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œåè®©è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—æ‰€å¯¹åº”çš„serviceé€šè¿‡å…¶contextä¸Šæ³¨å†Œçš„å›è°ƒå‡½æ•°cbï¼Œå¤„ç†ç›¸åº”çš„æ¶ˆæ¯ã€‚</p>
<p>å› æ­¤åˆ°è¿™é‡Œï¼Œæ¶ˆæ¯å¤„ç†è¿™ä¸€å—çš„é€»è¾‘å·²ç»å¼„æ¸…äº†ã€‚å¦‚æœè¦å®Œæˆé€šä¿¡çš„é—­ç¯ï¼Œè¿˜éœ€è¦è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>å‘é€æ–¹serviceå¦‚ä½•æ¨é€æ¶ˆæ¯åˆ°ç›®æ ‡serviceï¼Ÿï¼ˆ<code>skynet.send</code>ï¼Œéé˜»å¡å‘é€æ¶ˆæ¯ï¼‰</li>
<li>å‘é€æ–¹å¦‚ä½•è·å¾—ç›®æ ‡serviceå¤„ç†çš„è¿”å›å€¼ï¼Ÿï¼ˆ<code>skynet.call</code>ï¼Œé˜»å¡ç­‰å¾…æ¶ˆæ¯å¤„ç†ç»“æœï¼‰</li>
</ul>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹<code>skynet.send</code>ã€‚è¿™ä¸ªå‡½æ•°è°ƒç”¨äº†åº•å±‚æ³¨å†Œçš„<code>send</code>å‡½æ•°ï¼Œå¯¹åº”äº†<code>lua-skynet.c</code>ä¸­çš„<code>lsend</code>å‡½æ•°ã€‚æˆ‘ä»¬ä»¥æ­¤ä¸ºèµ·ç‚¹ï¼Œè§‚å¯Ÿæ¶ˆæ¯æ¨é€çš„è¿‡ç¨‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lua-skynet.c</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    uint32 address</span></span><br><span class="line"><span class="comment">     string address</span></span><br><span class="line"><span class="comment">    integer type</span></span><br><span class="line"><span class="comment">    integer session</span></span><br><span class="line"><span class="comment">    string message</span></span><br><span class="line"><span class="comment">     lightuserdata message_ptr</span></span><br><span class="line"><span class="comment">     integer len</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">lsend(lua_State *L) &#123;</span><br><span class="line">    <span class="keyword">return</span> send_message(L, <span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span></span><br><span class="line">send_message(lua_State *L, <span class="keyword">int</span> source, <span class="keyword">int</span> idx_type) &#123;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡ä¸Šé¢</span></span><br><span class="line">    <span class="comment">// æ¶ˆæ¯ç±»å‹ï¼Œä¸€èˆ¬åœ¨luaå±‚å†™ä¸šåŠ¡é€»è¾‘çš„è¯ï¼Œéƒ½çº¦å®šç”¨stringå°±å¥½äº†</span></span><br><span class="line">    <span class="keyword">int</span> mtype = lua_type(L,idx_type+<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">switch</span> (mtype) &#123;</span><br><span class="line">    <span class="keyword">case</span> LUA_TSTRING: &#123;</span><br><span class="line">        <span class="keyword">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">void</span> * msg = (<span class="keyword">void</span> *)lua_tolstring(L,idx_type+<span class="number">2</span>,&amp;len);</span><br><span class="line">        <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">            msg = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æˆ‘ä»¬å¯ä»¥æŒ‡å®šæŸä¸ªæœåŠ¡çš„åç§°ï¼ˆstringï¼‰ï¼Œæˆ–è€…åœ°å€ï¼ˆuintï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (dest_string) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæŒ‡å®šåç§°ï¼Œèµ°skynet_sendnameé€»è¾‘ï¼Œå½“ç„¶æœ€åä¹Ÿä¼šå¯»å€ï¼Œå†å»èµ°skynet_sendé€»è¾‘ã€‚</span></span><br><span class="line">            session = skynet_sendname(context, source, dest_string, type, session , msg, len);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            session = skynet_send(context, source, dest, type, session , msg, len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡ä¸‹é¢</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// skynet-server.c</span></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">skynet_send(struct skynet_context * context, <span class="keyword">uint32_t</span> source, <span class="keyword">uint32_t</span> destination , <span class="keyword">int</span> type, <span class="keyword">int</span> session, <span class="keyword">void</span> * data, <span class="keyword">size_t</span> sz) &#123;</span><br><span class="line">    <span class="comment">// ç•¥è¿‡å‚æ•°æ£€éªŒéƒ¨åˆ†</span></span><br><span class="line">    <span class="keyword">if</span> (skynet_harbor_message_isremote(destination)) &#123;</span><br><span class="line">        <span class="comment">// æš‚æ—¶ç•¥è¿‡harborï¼ˆé›†ç¾¤ï¼‰çš„éƒ¨åˆ†</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        struct skynet_message smsg;  <span class="comment">// æŠŠæ¶ˆæ¯æ•°æ®æ‰“åŒ…åˆ°skynet_messageç»“æ„ä½“</span></span><br><span class="line">        smsg.source = source;</span><br><span class="line">        smsg.session = session;</span><br><span class="line">        smsg.data = data;</span><br><span class="line">        smsg.sz = sz;</span><br><span class="line">        <span class="keyword">if</span> (skynet_context_push(destination, &amp;smsg)) &#123;  <span class="comment">// æ¨é€åˆ°ç›®æ ‡çš„context</span></span><br><span class="line">            skynet_free(data);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> session;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">skynet_context_push(<span class="keyword">uint32_t</span> handle, struct skynet_message *message) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">skynet_context</span> * <span class="title">ctx</span> = <span class="title">skynet_handle_grab</span>(<span class="title">handle</span>);</span></span><br><span class="line">    <span class="keyword">if</span> (ctx == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    skynet_mq_push(ctx-&gt;<span class="built_in">queue</span>, message);  <span class="comment">// æŠŠæ¶ˆæ¯æ¨å…¥æ¶ˆæ¯é˜Ÿåˆ—å½“ä¸­</span></span><br><span class="line">    skynet_context_release(ctx);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ ·çš„ä¸€é¡¿æ“ä½œï¼Œå°±å¯ä»¥æŠŠæ¶ˆæ¯å‘é€åˆ°æŒ‡å®šserviceçš„æ¶ˆæ¯é˜Ÿåˆ—é‡Œäº†ï¼Œç„¶åå°±ç­‰workeræ¥å–æ¶ˆæ¯å›è°ƒå¤„ç†å•¦~</p>
<p>é‚£ä¹ˆç¬¬äºŒä¸ªï¼Œå¦‚ä½•å®ç°è·å–å¤„ç†ç»“æœçš„éœ€æ±‚å‘¢ï¼Ÿè¿™ä¸ªæ˜¯åœ¨luaå±‚å®ç°çš„ï¼Œé€šè¿‡ç›®æ ‡æœåŠ¡è°ƒç”¨<code>skynet.ret</code>é€»è¾‘ï¼Œ<code>skynet.call</code>å°±å¯ä»¥è·å–è¿”å›å€¼ã€‚æˆ‘ä»¬æ¥è§‚å¯Ÿä¸¤è¾¹çš„é€»è¾‘ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- skynet.lua</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">yield_call</span><span class="params">(service, session)</span></span></span><br><span class="line">    watching_session[session] = service <span class="comment">-- ç›‘æ§æ˜¯å¦æœ‰æ”¶åˆ°ç›¸åº”sessionçš„è¿”å›æ•°æ®</span></span><br><span class="line">    session_id_coroutine[session] = running_thread</span><br><span class="line">    <span class="keyword">local</span> succ, msg, sz = coroutine_yield <span class="string">"SUSPEND"</span> <span class="comment">-- æŒ‚èµ·ï¼Œç›´åˆ°è¯¥sessionæœ‰è¿”å›ä¸ºæ­¢</span></span><br><span class="line">    watching_session[session] = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> succ <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">error</span> <span class="string">"call failed"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> msg,sz</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skynet.call</span><span class="params">(addr, typename, ...)</span></span></span><br><span class="line">    <span class="keyword">local</span> tag = session_coroutine_tracetag[running_thread]</span><br><span class="line">    <span class="keyword">if</span> tag <span class="keyword">then</span></span><br><span class="line">        c.trace(tag, <span class="string">"call"</span>, <span class="number">2</span>)</span><br><span class="line">        c.send(addr, skynet.PTYPE_TRACE, <span class="number">0</span>, tag)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">local</span> p = proto[typename]</span><br><span class="line">    <span class="keyword">local</span> session = c.send(addr, p.id , <span class="literal">nil</span> , p.pack(...)) <span class="comment">-- è·å–æœ¬æ¬¡æ¶ˆæ¯çš„session</span></span><br><span class="line">    <span class="keyword">if</span> session == <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">error</span>(<span class="string">"call to invalid address "</span> .. skynet.address(addr))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> p.<span class="built_in">unpack</span>(yield_call(addr, session))</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">skynet.ret</span><span class="params">(msg, sz)</span></span></span><br><span class="line">    <span class="comment">-- åœ¨æ­¤é€»è¾‘ä¹‹å‰ï¼Œä¼šé€šè¿‡dispatch_messageåˆ†å‘æ¶ˆæ¯ï¼Œç¼“å­˜æ¶ˆæ¯çš„å‘é€æ–¹ã€sessionç­‰ä¿¡æ¯</span></span><br><span class="line">    msg = msg <span class="keyword">or</span> <span class="string">""</span></span><br><span class="line">    <span class="keyword">local</span> tag = session_coroutine_tracetag[running_thread]</span><br><span class="line">    <span class="keyword">if</span> tag <span class="keyword">then</span> c.trace(tag, <span class="string">"response"</span>) <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- è·å–ç¼“å­˜çš„sessionä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">local</span> co_session = session_coroutine_id[running_thread]</span><br><span class="line">    session_coroutine_id[running_thread] = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">if</span> co_session == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> sz ~= <span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">            c.trash(msg, sz)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">-- send don't need ret</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- è·å–ç¼“å­˜çš„å‘é€æ–¹ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">local</span> co_address = session_coroutine_address[running_thread]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> co_session <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">error</span> <span class="string">"No session"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- ç›®æ ‡æœåŠ¡è¿”å›æ•°æ®ç»™å‘é€æ–¹ï¼Œå¸¦ä¸Šsessionæ ‡è¯†ï¼Œè¡¨ç¤ºè¿™æ˜¯è¯¥sessionæ¶ˆæ¯çš„è¿”å›</span></span><br><span class="line">    <span class="keyword">local</span> ret = c.send(co_address, skynet.PTYPE_RESPONSE, co_session, msg, sz)</span><br><span class="line">    <span class="keyword">if</span> ret <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    <span class="keyword">elseif</span> ret == <span class="literal">false</span> <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- If the package is too large, returns false. so we should report error back</span></span><br><span class="line">        c.send(co_address, skynet.PTYPE_ERROR, co_session, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡æä¾›å‘é€æ–¹ä¸sessionæ ‡è¯†ä¿¡æ¯ï¼Œå‘é€æ–¹å°±èƒ½å¤ŸçŸ¥é“å“ªäº›æ¶ˆæ¯æ˜¯è¯¥sessionçš„è¿”å›å€¼äº†ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œskynetå†…éƒ¨çš„é€šä¿¡æœºåˆ¶ï¼Œå°±å…¨éƒ¨ä¸²ä¸Šäº†ï¼</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸€ä¸å°å¿ƒå†™å¤šäº†ç‚¹ï¼Œå¸Œæœ›èƒ½æœ‰åŠ©äºå„ä½å°ä¼™ä¼´åŠ æ·±å¯¹æœåŠ¡ç«¯ä»¥åŠskynetæ¶æ„çš„ç†è§£ã€‚å¦‚æœæœ‰å™è¿°ä¸å½“çš„åœ°æ–¹ï¼Œæ³è¯·æŒ‡æ­£~~~</p>
<p>é‚£ä¹ˆskynetå…·ä½“è¦æ€ä¹ˆç”¨å‘¢ï¼Ÿè¿™ä¸€partæš‚æ—¶å†³å®šåœ¨åé¢çš„ç³»åˆ—çŒ®ä¸Š~</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>lua</tag>
        <tag>skynet</tag>
        <tag>lua_State</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘å¦ç±»å®ç”¨Pythonæ•™ç¨‹â€”â€”Easy Pythonç²¾ç¼–ç‰ˆä¸Šçº¿</title>
    <url>/2019/10/08/easypython/pdf/</url>
    <content><![CDATA[<p>æœ€è¿‘å°åŒ…è£…äº†ä¸€ä¸‹<a href="https://utmhikari.github.io/categories/Easy-Python/">Easy Pythonç³»åˆ—</a>ï¼Œæ”¾åˆ°<span class="exturl" data-url="aHR0cHM6Ly93d3cueXVxdWUuY29tL2hpa2FyaS16eTVjMC9lYXN5LXB5dGhvbg==" title="https://www.yuque.com/hikari-zy5c0/easy-python">è¯­é›€<i class="fa fa-external-link"></i></span>ä¸Šæ•´åˆç²¾ç¼–äº†ä¸ªpdfæŠ•æ”¾ï¼Œå®ŒæˆEasy Pythonç³»åˆ—çš„æœ€åä¸€é¡¹ä»»åŠ¡ã€‚</p>
<p>ç¬¬ä¸€æ¬¡ç¼–æ’°ä¸€ä¸ªçŸ­ç¯‡æŠ€æœ¯ç³»åˆ—ï¼Œå°æœ‰æˆå°±ï¼Œå€¼å¾—é¼“åŠ±ã€‚ä½†è·¯è¿˜æœ‰å¾ˆè¿œï¼Œæ…¢æ…¢æ¥å§~</p>
<p>ä¼ é€é—¨å¦‚ä¸‹ï¼š</p>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMVJ6OTlpWXFzRGxIYkZNbWJhNlVKZkE=" title="https://pan.baidu.com/s/1Rz99iYqsDlHbFMmba6UJfA">ç™¾åº¦ç½‘ç›˜<i class="fa fa-external-link"></i></span></li>
</ul>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>æ•°æ®æŒ–æ˜</tag>
        <tag>pdf</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘hexo+NexTåšå®¢è‡ªå®šä¹‰ä»£ç é«˜äº®ä¸»é¢˜é…è‰²CSS</title>
    <url>/2019/10/07/geekdaily/next_code_theme/</url>
    <content><![CDATA[<p>ç”¨hexo+NexTæ­å»ºåšå®¢çš„åŒå­¦æˆ–è®¸ä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šé»˜è®¤çš„ä»£ç é…è‰²åªæœ‰<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nocmlza2VtcHNvbi90b21vcnJvdy10aGVtZQ==" title="https://github.com/chriskempson/tomorrow-theme">Tomorrow Theme<i class="fa fa-external-link"></i></span>äº”ç§ï¼Œå¦‚æœæƒ³è¦è‡ªå·±çš„ä»£ç é…è‰²ï¼Œåº”å½“å¦‚ä½•è‡ªå®šä¹‰å‘¢ï¼Ÿ</p>
<p>å…¶å®ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åœ¨NexTçš„<code>source/css/highlight/theme.styl</code>ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å‡ ç§ä¸»é¢˜çš„å…·ä½“é…è‰²ï¼š</p>
<figure class="highlight styl"><table><tr><td class="code"><pre><span class="line"><span class="variable">$highlight_theme</span> = hexo-config(<span class="string">"highlight_theme"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">$highlight_theme</span> == <span class="string">"normal"</span></span><br><span class="line">  <span class="variable">$highlight</span>-<span class="attribute">background</span>   = <span class="number">#f7f7f7</span></span><br><span class="line">  <span class="variable">$highlight</span>-current-line = <span class="number">#efefef</span></span><br><span class="line">  <span class="variable">$highlight</span>-selection    = <span class="number">#d6d6d6</span></span><br><span class="line">  <span class="variable">$highlight</span>-foreground   = <span class="number">#4d4d4c</span></span><br><span class="line">  <span class="variable">$highlight</span>-comment      = <span class="number">#8e908c</span></span><br><span class="line">  <span class="variable">$highlight</span>-red          = <span class="number">#c82829</span></span><br><span class="line">  <span class="variable">$highlight</span>-orange       = <span class="number">#f5871f</span></span><br><span class="line">  <span class="variable">$highlight</span>-yellow       = <span class="number">#eab700</span></span><br><span class="line">  <span class="variable">$highlight</span>-green        = <span class="number">#718c00</span></span><br><span class="line">  <span class="variable">$highlight</span>-aqua         = <span class="number">#3e999f</span></span><br><span class="line">  <span class="variable">$highlight</span>-blue         = <span class="number">#4271ae</span></span><br><span class="line">  <span class="variable">$highlight</span>-purple       = <span class="number">#8959a8</span></span><br><span class="line">  <span class="variable">$highlight</span>-gutter       = &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#869194</span>,</span><br><span class="line">    bg-<span class="attribute">color</span>: <span class="number">#eff2f3</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="variable">$highlight_theme</span> == <span class="string">"night"</span></span><br><span class="line">  <span class="variable">$highlight</span>-<span class="attribute">background</span>   = <span class="number">#1d1f21</span></span><br><span class="line">  <span class="variable">$highlight</span>-current-line = <span class="number">#282a2e</span></span><br><span class="line">  <span class="variable">$highlight</span>-selection    = <span class="number">#373b41</span></span><br><span class="line">  <span class="variable">$highlight</span>-foreground   = <span class="number">#c5c8c6</span></span><br><span class="line">  <span class="variable">$highlight</span>-comment      = <span class="number">#969896</span></span><br><span class="line">  <span class="variable">$highlight</span>-red          = <span class="number">#cc6666</span></span><br><span class="line">  <span class="variable">$highlight</span>-orange       = <span class="number">#de935f</span></span><br><span class="line">  <span class="variable">$highlight</span>-yellow       = <span class="number">#f0c674</span></span><br><span class="line">  <span class="variable">$highlight</span>-green        = <span class="number">#b5bd68</span></span><br><span class="line">  <span class="variable">$highlight</span>-aqua         = <span class="number">#8abeb7</span></span><br><span class="line">  <span class="variable">$highlight</span>-blue         = <span class="number">#81a2be</span></span><br><span class="line">  <span class="variable">$highlight</span>-purple       = <span class="number">#b294bb</span></span><br><span class="line">  <span class="variable">$highlight</span>-gutter       = &#123;</span><br><span class="line">    <span class="attribute">color</span>: lighten(<span class="variable">$highlight</span>-background, <span class="number">50%</span>),</span><br><span class="line">    bg-<span class="attribute">color</span>: darken(<span class="variable">$highlight</span>-background, <span class="number">100%</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶å®å¦‚æœè¦å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰ä¸»é¢˜çš„è¯ï¼Œå…¶å®åŠ ä¸€æ®µifè·Ÿå…¶é…è‰²ï¼Œç„¶ååœ¨é…ç½®é‡Œé…ç½®themeçš„å…³é”®è¯å°±å¥½äº†ã€‚é‚£ä¹ˆè‡ªå·±é…è‰²çš„è¯åº”è¯¥æ€æ ·å‚è€ƒå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨<code>source/css/highlight/highlight.styl</code>ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼š</p>
<a id="more"></a>
<figure class="highlight styl"><table><tr><td class="code"><pre><span class="line">pre &#123;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.comment</span> &#123; <span class="attribute">color</span>: <span class="variable">$highlight</span>-comment; &#125;</span><br><span class="line"></span><br><span class="line">  .variable</span><br><span class="line">  .attribute</span><br><span class="line">  .constant</span><br><span class="line">  .tag</span><br><span class="line">  .name</span><br><span class="line">  .regexp</span><br><span class="line">  .ruby</span><br><span class="line">  <span class="selector-class">.xml</span> <span class="selector-class">.tag</span> .title</span><br><span class="line">  <span class="selector-class">.xml</span> .pi</span><br><span class="line">  <span class="selector-class">.xml</span> .doctype</span><br><span class="line">  <span class="selector-class">.html</span> .doctype</span><br><span class="line">  <span class="selector-class">.css</span> .id</span><br><span class="line">  <span class="selector-class">.css</span> .class</span><br><span class="line">  <span class="selector-class">.css</span> <span class="selector-class">.pseudo</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$highlight</span>-red;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .number</span><br><span class="line">  .preprocessor</span><br><span class="line">  .built_in</span><br><span class="line">  .builtin-name</span><br><span class="line">  .literal</span><br><span class="line">  .params</span><br><span class="line">  .constant</span><br><span class="line">  <span class="selector-class">.command</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$highlight</span>-orange;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.constant</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$highlight</span>-constant;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="selector-class">.ruby</span> <span class="selector-class">.class</span> .title</span><br><span class="line">  <span class="selector-class">.css</span> <span class="selector-class">.rules</span> .attribute</span><br><span class="line">  .string</span><br><span class="line">  .symbol</span><br><span class="line">  .value</span><br><span class="line">  .inheritance</span><br><span class="line">  .header</span><br><span class="line">  <span class="selector-class">.ruby</span> .symbol</span><br><span class="line">  <span class="selector-class">.xml</span> .cdata</span><br><span class="line">  .special</span><br><span class="line">  <span class="selector-class">.formula</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$highlight</span>-green;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .title</span><br><span class="line">  <span class="selector-class">.css</span> <span class="selector-class">.hexcolor</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$highlight</span>-aqua;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .function</span><br><span class="line">  <span class="selector-class">.python</span> .decorator</span><br><span class="line">  <span class="selector-class">.python</span> .title</span><br><span class="line">  <span class="selector-class">.ruby</span> <span class="selector-class">.function</span> .title</span><br><span class="line">  <span class="selector-class">.ruby</span> <span class="selector-class">.title</span> .keyword</span><br><span class="line">  <span class="selector-class">.perl</span> .sub</span><br><span class="line">  <span class="selector-class">.javascript</span> .title</span><br><span class="line">  <span class="selector-class">.coffeescript</span> <span class="selector-class">.title</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$highlight</span>-blue;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  .keyword</span><br><span class="line">  <span class="selector-class">.javascript</span> <span class="selector-class">.function</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="variable">$highlight</span>-purple;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åœ¨è¿™æ®µcssä¸­å¯ä»¥çœ‹åˆ°ä¸åŒçš„ä»£ç å—çš„ä¸åŒé…è‰²ï¼Œå¯¹ç…§è¯¥cssæ‰€ç¤ºé…ç½®é¢œè‰²å³å¯ã€‚å½“ç„¶è‹¥æœ‰ç»†èŠ‚éœ€æ±‚ï¼Œæ›´æ”¹ä¸Šé¢ä»£ç å—çš„cssä¹Ÿæ˜¯okçš„ã€‚</p>
<p>æ¯”å¦‚ç¬”è€…é‡‡ç”¨ç»å…¸çš„<code>solarized light</code>é…è‰²ï¼Œå°±å¯ä»¥åœ¨<code>source/css/highlight/theme.styl</code>åŠ ä¸Šä¸€æ®µï¼š</p>
<figure class="highlight styl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="variable">$highlight_theme</span> == <span class="string">"solarized light"</span></span><br><span class="line">  <span class="variable">$highlight</span>-<span class="attribute">background</span>   = <span class="number">#FDF6E3</span></span><br><span class="line">  <span class="variable">$highlight</span>-constant     = <span class="number">#00FF00</span></span><br><span class="line">  <span class="variable">$highlight</span>-current-line = <span class="number">#FDF6E3</span></span><br><span class="line">  <span class="variable">$highlight</span>-selection    = <span class="number">#ECE7D5</span></span><br><span class="line">  <span class="variable">$highlight</span>-foreground   = <span class="number">#657A81</span></span><br><span class="line">  <span class="variable">$highlight</span>-comment      = <span class="number">#93A1A1</span></span><br><span class="line">  <span class="variable">$highlight</span>-red          = <span class="number">#D30102</span></span><br><span class="line">  <span class="variable">$highlight</span>-orange       = <span class="number">#657A81</span></span><br><span class="line">  <span class="variable">$highlight</span>-yellow       = <span class="number">#657A81</span></span><br><span class="line">  <span class="variable">$highlight</span>-green        = <span class="number">#2AA198</span></span><br><span class="line">  <span class="variable">$highlight</span>-aqua         = <span class="number">#657A81</span></span><br><span class="line">  <span class="variable">$highlight</span>-blue         = <span class="number">#657A81</span></span><br><span class="line">  <span class="variable">$highlight</span>-purple       = <span class="number">#B58900</span></span><br><span class="line">  <span class="variable">$highlight</span>-gutter       = &#123;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#586E75</span></span><br><span class="line">    bg-<span class="attribute">color</span>: <span class="number">#FDF6E3</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨NexTçš„<code>_config.yml</code>ä¸­åº”ç”¨è¯¥é…ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Code Highlight theme</span></span><br><span class="line"><span class="comment"># Available values: normal | night | night eighties | night blue | night bright</span></span><br><span class="line"><span class="comment"># https://github.com/chriskempson/tomorrow-theme</span></span><br><span class="line"><span class="attr">highlight_theme:</span> <span class="string">solarized</span> <span class="string">light</span></span><br></pre></td></tr></table></figure>
<p>å°±okäº†</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>ä»£ç é«˜äº®</tag>
        <tag>hexo</tag>
        <tag>NexT</tag>
        <tag>styl</tag>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æå®¢æ—¥å¸¸ã€‘è§£å†³å›½å†…go1.13çš„go modæ— æ³•å®‰è£…ä¾èµ–çš„é—®é¢˜</title>
    <url>/2019/10/07/geekdaily/go113_proxy/</url>
    <content><![CDATA[<p>åœ¨<a href="https://utmhikari.github.io/2019/07/20/gofromzero/01_first_code/">ä»é›¶å•æ’Golangç¬¬ä¸€è¯</a>ä¸­è®²åˆ°äº†Golangçš„åŸºç¡€å¼€å‘ç¯å¢ƒé…ç½®ï¼Œå…¶ä¸­è®²åˆ°äº†Goçš„ä¾èµ–ç®¡ç†æ–¹é¢ï¼ŒæåŠäº†ä»¥åçš„è¶‹åŠ¿ä¼šé‡‡ç”¨å®˜æ–¹çš„go modè¿›è¡Œç®¡ç†ã€‚å…³äºè¿™ä¸€å—ï¼Œç°åœ¨æœ‰äº†æ›´åŠ ç®€å•çš„æ–¹æ³•ã€‚</p>
<p>æœ€æ–°çš„Go1.13ä¸­å·²ç»å°†go modåˆ—ä¸ºé»˜è®¤çš„åŒ…ç®¡ç†æ–¹æ³•ï¼Œä½†å›½å†…ç”¨æˆ·go mod vendoræ—¶è¿˜æ˜¯æœ‰å¯èƒ½ä¼šå‡ºé”™ï¼Œè¿™æ˜¯å› ä¸ºåœ¨go getæ—¶ä¼šæ£€æŸ¥å“ˆå¸Œå€¼ï¼Œéœ€è¦è®¿é—®å®˜æ–¹çš„sumdbã€‚ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ä¸å¯æŠ—å› ç´ ï¼Œsumdbæ²¡æ³•ç›´æ¥è®¿é—®ï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸‹è½½ä¾èµ–å¤±è´¥ã€‚è§£å†³çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ä¸€è¡Œç»ˆç«¯å‘½ä»¤å³å¯ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>
<p>å¦‚æœé‡‡ç”¨idea+Goæ’ä»¶å¼€å‘çš„è¯éœ€è¦æ³¨æ„ï¼Œideaå¯èƒ½ä¼šæ‰˜ç®¡ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦è¿›å…¥<code>settings, languages &amp; frameworks, go, go modules</code>é‡Œï¼Œè®¾ç½®proxyä¸º<code>https://goproxy.cn,direct</code>ï¼Œå°±okäº†ã€‚</p>
]]></content>
      <categories>
        <category>æå®¢æ—¥å¸¸</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>go mod</tag>
        <tag>GOPROXY</tag>
        <tag>GOSUMDB</tag>
        <tag>go env</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬å››è¯ï¼šWin10å®‰è£…minikubeï¼Œç”¨client-goéƒ¨ç½²mongodb</title>
    <url>/2019/10/03/gofromzero/04_kubernetes_mongo/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nb2Zyb216ZXJv" title="https://github.com/utmhikari/gofromzero">Githubä¼ é€é—¨<i class="fa fa-external-link"></i></span></p>
<p>æèµ·Golangï¼Œå°±ä¸å¾—ä¸æèµ·<span class="exturl" data-url="aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL3poLw==" title="https://kubernetes.io/zh/">kubernetes<i class="fa fa-external-link"></i></span>ï¼Œåœ¨å´‡å°šä¸Šäº‘çš„ä»Šå¤©ï¼Œkuberneteså·²æˆä¸ºæœåŠ¡ç«¯åŒå­¦å¿…éœ€æŒæ¡ä¹‹å­¦é—®ã€‚åœ¨<a href="https://utmhikari.github.io/2019/09/01/gofromzero/03_docker_client/">ç¬¬ä¸‰è¯</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†dockerå®¹å™¨ï¼Œå®ƒç›¸å½“äºè™šæ‹Ÿæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥æä¾›ç¯å¢ƒä¾›å„ç§ä¸åŒçš„åº”ç”¨è¿è¡Œï¼Œä»è€Œå®ç°è½»é‡éƒ¨ç½²ã€‚ä½†è¦æ˜¯ä¸šåŠ¡å¤æ‚ï¼Œéœ€è¦éƒ¨ç½²è¾ƒå¤šåº”ç”¨çš„è¯ï¼Œå°±ä¼šé‡åˆ°è®¸å¤šè¿ç»´ç›¸å…³çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>åº”ç”¨å…³è”çš„èµ„æºå¾ˆå¤šéƒ½éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œå®ƒä»¬çš„å­˜å‚¨ç©ºé—´éœ€è¦æ€æ ·åˆ†é…åŠè°ƒåº¦å‘¢ï¼Ÿ</li>
<li>ä¸åŒåœ°åŸŸçš„åº”ç”¨ï¼Œå¦‚ä½•å–å¾—ç›¸äº’è”ç³»ï¼Ÿ</li>
<li>åœ¨åº”ç”¨é›†ç¾¤ä¸­ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå­åº”ç”¨æŒ‚äº†ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</li>
<li>ã€‚ã€‚ã€‚</li>
</ul>
<p>è¿™äº›é—®é¢˜ï¼Œå•é dockeræ˜¯è§£å†³ä¸äº†çš„ï¼ˆä¹Ÿä¸æ˜¯dockeræ‰€è¦å…³å¿ƒçš„ï¼‰ï¼Œéœ€è¦åœ¨dockerçš„åŸºç¡€ä¸Šåšæ›´é«˜å±‚æ¬¡çš„è¿ç»´å¹³å°æ‰èƒ½è§£å†³ï¼Œè€Œkubernetesï¼Œå°±æ˜¯æ–¹æ¡ˆä¹‹ä¸€ã€‚å¤æ‚çš„è°ƒåº¦é€»è¾‘ï¼Œéƒ½ä¼šç”±kubernetesè´Ÿè´£ï¼Œè€Œè¿ç»´å¼€å‘äººå‘˜åˆ™åŸºæœ¬åªéœ€å‘kubernetesæä¾›èµ„æºåŠå…¶æè¿°ï¼Œå°±èƒ½æ»¡è¶³è¿ç»´éœ€æ±‚ï¼Œä»è€Œæå‡å·¥ä½œæ•ˆç‡ã€‚</p>
<p>æ—¢ç„¶å‡†å¤‡å…¥å‘ï¼Œå°±éœ€è¦å¼ºè¡Œè¸©ä¸‹å»ï¼Œå› æ­¤ä»Šå¤©å°±è¯•è¯•â€œå®¶ä¸­ä¸Šäº‘â€ï¼Œå•æœºæ­å»ºkubernetesï¼Œéƒ¨ç½²ä¸€ä¸ªmongodbæ•°æ®åº“ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œå’±ä»¬å¼€å§‹å§~</p>
<h2 id="minikubeâ€”â€”åœ¨Win10æœ¬åœ°æ­å»ºkubernetes"><a href="#minikubeâ€”â€”åœ¨Win10æœ¬åœ°æ­å»ºkubernetes" class="headerlink" title="minikubeâ€”â€”åœ¨Win10æœ¬åœ°æ­å»ºkubernetes"></a>minikubeâ€”â€”åœ¨Win10æœ¬åœ°æ­å»ºkubernetes</h2><a id="more"></a>
<p>ç¬”è€…çš„ç”µè„‘ä¸ºWin10ï¼Œå› æ­¤æ­å»ºç¯å¢ƒçš„éƒ¨åˆ†ï¼Œåªè€ƒè™‘Win10çš„æƒ…å†µã€‚</p>
<p>è¦åœ¨æœ¬åœ°æ­å»ºkubernetesè¿ç»´å¹³å°ï¼Œé¦–å…ˆå»ºè®®å®‰è£…dockerï¼Œç›´æ¥åœ¨å®˜ç½‘ä¸‹è½½<span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS9wcm9kdWN0cy9kb2NrZXItZGVza3RvcA==" title="https://www.docker.com/products/docker-desktop">Docker Desktop<i class="fa fa-external-link"></i></span>å®‰è£…å³å¯ï¼ˆæä¾›äº†æ—¥å¸¸å®¹å™¨ç¯å¢ƒ+Hyper-Vè™šæ‹ŸæœºåŠŸèƒ½+kubectlå®¢æˆ·ç«¯ï¼‰ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå®‰è£…kubernetesçš„æœ€å¥½æ–¹å¼æ˜¯é‡‡ç”¨å®˜æ–¹æä¾›çš„<span class="exturl" data-url="aHR0cHM6Ly9rdWJlcm5ldGVzLmlvL2RvY3MvdGFza3MvdG9vbHMvaW5zdGFsbC1taW5pa3ViZS8=" title="https://kubernetes.io/docs/tasks/tools/install-minikube/">minikube<i class="fa fa-external-link"></i></span>å·¥å…·ã€‚minikubeæä¾›äº†ä¸€å¥—å•èŠ‚ç‚¹kubernetesç¯å¢ƒï¼ˆå®ä½“ä¸ºè™šæ‹Ÿæœºï¼‰ï¼Œä»è€Œä½¿å¾—å•æœºç”¨æˆ·ä¹Ÿå¯ä»¥äº«å—kubernetesçš„æ‰€æœ‰åŠŸèƒ½ã€‚kuberneteså‚å•†ä¸ºGoogleï¼Œç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œä¸‹è½½Googleèµ„æºä¸€ç›´æ˜¯ä¸€ä¸ªéš¾é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé­”æ”¹ç‰ˆæœ¬â€”â€”<span class="exturl" data-url="aHR0cHM6Ly95cS5hbGl5dW4uY29tL2FydGljbGVzLzIyMTY4Nw==" title="https://yq.aliyun.com/articles/221687">minikubeé˜¿é‡Œäº‘ç‰ˆ<i class="fa fa-external-link"></i></span>ï¼Œä»è€Œé¿å…ç§‘å­¦ä¸Šç½‘çš„çƒ¦æ¼ã€‚ä¸‹è½½å¥½ï¼Œä¿å­˜å¥½ï¼Œè®°å¾—æŠŠminikubeæ ¹ç›®å½•åŠ åˆ°<code>PATHç¯å¢ƒå˜é‡</code>ï¼Œè¿™æ ·å°±èƒ½åœ¨cmd/powershellé‡Œç›´æ¥è¿è¡Œã€‚</p>
<p>å¯åŠ¨minikubeä¹‹å‰ï¼Œéœ€è¦åœ¨Hyper-Våˆ›å»ºä¸€ä¸ªå¤–éƒ¨çš„è™šæ‹Ÿäº¤æ¢æœºï¼ˆå¼€å§‹â€”â€”Windowsç®¡ç†å·¥å…·â€”â€”Hyper-Vç®¡ç†å™¨â€”â€”è™šæ‹Ÿäº¤æ¢æœºç®¡ç†å™¨â€”â€”åˆ›å»ºå¤–éƒ¨è™šæ‹Ÿäº¤æ¢æœºï¼‰ï¼Œç¬”è€…è¿™è¾¹å–åä¸º<code>EXTERNAL_SWITCH</code>ã€‚</p>
<p>minikubeå¯åŠ¨ä¹‹åï¼Œä¼šåœ¨ç”¨æˆ·æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºkubernetesé…ç½®ï¼Œè€Œååœ¨Hyper-Vä¸­åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºâ€”â€”ä¸€ä¸ªlinuxç³»ç»Ÿï¼Œé‡Œè¾¹ä¼šè‡ªå¸¦ä¸€ä¸ªdocker+kubernetesçš„ç¯å¢ƒã€‚åœ¨è™šæ‹Ÿæœºå†…ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œdockerç›¸å…³çš„å‘½ä»¤ä¸å®¹å™¨äº¤äº’ï¼Œæ¯”å¦‚æŸ¥çœ‹å½“å‰kubernetesç›¸å…³å®¹å™¨/é•œåƒçš„ä¿¡æ¯ä¸çŠ¶æ€ï¼›è€Œåœ¨å¤–è¾¹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„Win10ä¸»æœºé‡Œï¼Œå› ä¸ºminikubeå·²ç»åˆ›å»ºäº†é…ç½®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çŸ¥é“kubernetesèŠ‚ç‚¹çš„ipï¼Œå¹¶ä¸”å¯ä»¥ç”¨<code>kubectl</code>ä¸è™šæ‹Ÿæœºä¸­çš„kubernetesäº¤äº’ï¼Œè·å¾—å…¶ä¸­çŠ¶æ€ä¿¡æ¯ã€‚</p>
<p>å¯åŠ¨minikubeçš„æ–¹å¼ï¼Œå»ºè®®ç¼–å†™è„šæœ¬æ‰§è¡Œï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># minikube-start.ps1</span></span><br><span class="line">minikube start --vm-driver hyperv --hyperv-virtual-switch=EXTERNAL_SWITCH</span><br></pre></td></tr></table></figure>
<p>æŠŠè¿™ä¸ªè„šæœ¬æ”¾åˆ°minikube.exeåŒçº§ç›®å½•ä¸­ï¼Œå°±å¯ä»¥ç›´æ¥è¿è¡Œäº†ã€‚å¦‚æœä¸èƒ½è¿è¡Œçš„è¯ï¼Œä¸€èˆ¬æ˜¯powershellæ‰§è¡Œè„šæœ¬æƒé™é—®é¢˜ï¼Œè§£å†³æ–¹æ³•æ˜¯ç”¨ç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershellï¼Œç„¶åæ‰§è¡Œï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Unrestricted</span><br></pre></td></tr></table></figure>
<p>æŠŠæ‰§è¡Œæƒé™æ”¾å®½ï¼Œå°±å¥½äº†ã€‚</p>
<p>ä½†åé¢è¿˜ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ™®é€šç”¨æˆ·ä¸èƒ½åˆ›å»ºHyper-Vè™šæ‹Ÿæœºï¼Œè¿™ä¸ªæ—¶å€™åªéœ€è¦åœ¨æ™®é€šç”¨æˆ·çš„powershellä¸­è¾“å…¥<code>whoami</code>æŸ¥çœ‹<code>ç”¨æˆ·ç»„\ç”¨æˆ·å</code>ï¼Œç„¶åç®¡ç†å‘˜èº«ä»½æ‰“å¼€powershellï¼Œè¾“å…¥ï¼š</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">net localgroup <span class="string">"Hyper-V Administrators"</span> <span class="string">"ç”¨æˆ·ç»„\ç”¨æˆ·å"</span> /add</span><br></pre></td></tr></table></figure>
<p>å°±å¯ä»¥ä»¥æ™®é€šç”¨æˆ·èº«ä»½ï¼Œè¾“å…¥<code>minikube-start</code>ï¼Œå¯åŠ¨minikubeè™šæ‹Ÿæœºäº†ã€‚</p>
<p>è¾“å…¥<code>minikube status</code>å¯ä»¥æŸ¥çœ‹minikubeçš„çŠ¶æ€ã€‚å¦‚æœçŠ¶æ€æ˜¯ç±»ä¼¼äº</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">host: Running</span><br><span class="line">kubelet: Running</span><br><span class="line">apiserver: Running</span><br><span class="line">kubectl: Correctly Configured: pointing to minikube-vm at 192.168.0.102</span><br></pre></td></tr></table></figure>
<p>çš„è¯ï¼Œå°±è¯´æ˜å¯åŠ¨æˆåŠŸäº†ã€‚</p>
<p>è¦é€€å‡ºminikubeï¼Œæœ€ç¨³å®šçš„æ–¹æ³•æ˜¯<code>minikube ssh</code>è¿›å…¥åˆ°è™šæ‹Ÿæœºä¸­ï¼Œç„¶å<code>sudo poweroff</code>å…³é—­è™šæ‹Ÿæœºã€‚åœ¨ç¬”è€…ç”µè„‘ä¸Šï¼Œç›´æ¥ä½¿ç”¨<code>minikube stop</code>å…³é—­è™šæ‹Ÿæœºæœ‰æå¤§æ¦‚ç‡å¡ä½æ— æ³•å…³é—­ï¼Œå› æ­¤æš‚ä¸æ¨èè¿™ç§æ–¹æ³•ã€‚</p>
<h2 id="client-goâ€”â€”ç”¨Golangåœ¨kuberneteséƒ¨ç½²mongodb"><a href="#client-goâ€”â€”ç”¨Golangåœ¨kuberneteséƒ¨ç½²mongodb" class="headerlink" title="client-goâ€”â€”ç”¨Golangåœ¨kuberneteséƒ¨ç½²mongodb"></a>client-goâ€”â€”ç”¨Golangåœ¨kuberneteséƒ¨ç½²mongodb</h2><p>minikubeæ­å»ºå®Œæ¯•åï¼Œæ¥ä¸‹æ¥å°±è¦å®æˆ˜äº†â€”â€”åœ¨minikubeä¸­éƒ¨ç½²mongodbã€‚</p>
<p>é¦–å…ˆä¸è¦æ€¥ç€ç ï¼Œè€Œæ˜¯è¦è§£å†³ä»¥ä¸‹çš„é—®é¢˜ï¼š</p>
<ul>
<li>æ•°æ®åœ¨å“ªé‡Œå­˜å‚¨ï¼Ÿï¼ˆkubernetesçš„ä¸»æœºæ˜¯minikubeåˆ›å»ºçš„è™šæ‹Ÿæœºï¼Œæ‰€ä»¥åœ¨è™šæ‹Ÿæœºé‡Œï¼‰</li>
<li>å¦‚ä½•æš´éœ²æ•°æ®åº“çš„è¿æ¥ç«¯å£ï¼Ÿï¼ˆä¸»æœºå¯è®¿é—®èŠ‚ç‚¹ï¼Œæ•…å°†mongodbç«¯å£è½¬å‘è‡³èŠ‚ç‚¹ç«¯å£ï¼‰</li>
</ul>
<p>å¯¹äºæ•°æ®åº“é›†ç¾¤è€Œè¨€ï¼Œé€šå¸¸ä¼šå°†å…¶å°è£…æˆä¸€ç±»å«åšStatefulSetï¼ˆå‰¯æœ¬é›†ï¼‰çš„èµ„æºã€‚StatefulSetä¸»è¦åŒ…å«Podçš„é›†åˆï¼Œä»¥åŠå’Œå„ä¸ªPodå…³è”çš„PersistentVolumeClaimï¼ˆPVCï¼‰é›†åˆã€‚Podæ˜¯kubernetesè°ƒåº¦çš„å•ä½ï¼Œå¯ä»¥ç†è§£æˆå•ä¸ªåº”ç”¨å®ä¾‹ï¼Œè€ŒPVCåˆ™æ˜¯è¿™äº›Podå„ä¸ªå¯¹åº”çš„æŒä¹…åŒ–å­˜å‚¨ç©ºé—´çš„å£°æ˜ã€‚åœ¨å®é™…åœºæ™¯ä¸­ï¼Œç®¡ç†å­˜å‚¨ç©ºé—´çš„äººå‘˜ä¼šé¢„å…ˆåœ¨kubernetesä¸ºè®¸å¤šå®åœ¨çš„æŒä¹…åŒ–å­˜å‚¨ç©ºé—´æ‰“ä¸‹æ ‡è®°ï¼Œç»Ÿç§°ä¸ºStorage Classï¼Œç”¨æˆ·åˆ™åªéœ€è¦åœ¨StatefulSetå£°æ˜æ€æ ·å­˜å‚¨ï¼ˆPVCï¼‰ï¼Œkuberneteså°±åœ¨å†…éƒ¨æŠŠå„ä¸ªPodæ ¹æ®ç›¸åº”çš„Storage ClassåŠPVCä»è€Œåˆ†é…ç©ºé—´ï¼ˆPVï¼‰ï¼Œç»‘å®šèµ·æ¥ã€‚å¦‚æœä¸€ä¸ªPodå‘ç”Ÿæ•…éšœï¼Œå­˜å‚¨ç©ºé—´ä¹Ÿä¸ä¼šæ¶ˆå¤±ï¼Œè¿‡åæ¢å¤çš„Podä¹Ÿä¼šè·ŸåŸæ¥ä¸€æ ·ï¼Œæ‹¥æœ‰å’ŒåŸæ¥ç›¸åŒçš„æ ‡è¯†ï¼Œå­˜å‚¨ç©ºé—´ä¹Ÿå’ŒåŸæ¥çš„PVå¯¹åº”ã€‚</p>
<p>è€Œåœ¨ç¬”è€…è¿™é‡Œçš„ä¾‹å­é‡Œï¼Œåˆ›å»ºå¤šä¸ªæ•°æ®åº“ä»¥åŠå¤šä¸ªå­˜å‚¨ç©ºé—´è¾ƒä¸ºéº»çƒ¦ï¼Œå› æ­¤ä¹Ÿæœ‰å…¶å®ƒçš„åŠæ³•â€”â€”åœ¨Podçš„èµ„æºå£°æ˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘Šè¯‰kubernetesè¦åœ¨å¯åŠ¨mongodbå®¹å™¨ä¹‹æ—¶ï¼ŒæŒ‚è½½minikubeè™šæ‹Ÿæœºé‡Œé¢çš„ä¸€ä¸ªç›®å½•è¿›å»å­˜å‚¨æ•°æ®åº“æ•°æ®ï¼Œè¿™æ ·å®¹å™¨å®•æœºä¹‹åï¼Œæ•°æ®ä¾ç„¶ä¸ä¼šæ¶ˆå¤±ã€‚</p>
<p>å› æ­¤ï¼Œåˆ›å»ºmongodbçš„StatefulSetèµ„æºä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createMongoStatefulSet</span><span class="params">(clientset *kubernetes.Clientset)</span> <span class="params">(*appsv1.StatefulSet, error)</span></span> &#123;</span><br><span class="line">    replicas := <span class="keyword">int32</span>(<span class="number">1</span>)</span><br><span class="line">    terminationGracePeriodSeconds := <span class="keyword">int64</span>(<span class="number">10</span>)</span><br><span class="line">    statefulSet := appsv1.StatefulSet&#123;</span><br><span class="line">        ObjectMeta: metav1.ObjectMeta&#123;Name: <span class="string">"mongo"</span>&#125;,</span><br><span class="line">        Spec: appsv1.StatefulSetSpec&#123;</span><br><span class="line">            ServiceName: <span class="string">"mongo"</span>,</span><br><span class="line">            Replicas:    &amp;replicas,</span><br><span class="line">            Template: v1.PodTemplateSpec&#123;</span><br><span class="line">                ObjectMeta: metav1.ObjectMeta&#123;</span><br><span class="line">                    Labels: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">"role"</span>: <span class="string">"mongo"</span>&#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">                Spec: v1.PodSpec&#123;</span><br><span class="line">                    TerminationGracePeriodSeconds: &amp;terminationGracePeriodSeconds,</span><br><span class="line">                    Volumes: []v1.Volume&#123;</span><br><span class="line">                        &#123;</span><br><span class="line">                            Name: <span class="string">"mongo-volume"</span>,</span><br><span class="line">                            VolumeSource: v1.VolumeSource&#123;</span><br><span class="line">                                HostPath: &amp;v1.HostPathVolumeSource&#123;Path: <span class="string">"/home/docker/mongo"</span>&#125;,</span><br><span class="line">                            &#125;,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    Containers: []v1.Container&#123;</span><br><span class="line">                        &#123;</span><br><span class="line">                            Name:         <span class="string">"mongo"</span>,</span><br><span class="line">                            Image:        <span class="string">"library/mongo:latest"</span>,</span><br><span class="line">                            Command:      []<span class="keyword">string</span>&#123;<span class="string">"mongod"</span>, <span class="string">"--replSet"</span>, <span class="string">"rs0"</span>, <span class="string">"--bind_ip"</span>, <span class="string">"0.0.0.0"</span>&#125;,</span><br><span class="line">                            Ports:        []v1.ContainerPort&#123;&#123;ContainerPort: <span class="number">27017</span>&#125;&#125;,</span><br><span class="line">                            VolumeMounts: []v1.VolumeMount&#123;&#123;Name: <span class="string">"mongo-volume"</span>, MountPath: <span class="string">"/data/db"</span>&#125;&#125;,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            Selector: &amp;metav1.LabelSelector&#123;</span><br><span class="line">                MatchLabels: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">"role"</span>: <span class="string">"mongo"</span>&#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clientset.AppsV1().StatefulSets(defaultNamespace).Create(&amp;statefulSet)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªStatefulSeté‡Œé¢ï¼Œåˆ›å»ºäº†å•å‰¯æœ¬ï¼ˆreplicas=1ï¼‰çš„mongoæ•°æ®åº“ã€‚åœ¨å‰¯æœ¬çš„Podæ¨¡æ¿é‡Œï¼Œè¯¥å‰¯æœ¬æŒ‚è½½äº†è™šæ‹Ÿæœºçš„<code>/home/docker/mongo</code>ç›®å½•ï¼ˆminikubeé»˜è®¤ç”¨æˆ·ä¸ºdockerï¼Œmongoç›®å½•éœ€è¦é¢„å…ˆåˆ›å»ºï¼‰åˆ°å®¹å™¨é‡Œçš„<code>/data/db</code>ç›®å½•ï¼Œä¹Ÿå°±æ˜¯mongodbæ•°æ®å­˜å‚¨çš„åœ°æ–¹ã€‚mongoå¯åŠ¨å‚æ•°è¦<code>--bind_ip 0.0.0.0</code>ï¼Œä»è€Œèƒ½å¤Ÿè¢«å¤–éƒ¨è®¿é—®ã€‚</p>
<p>å¦å¤–æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªStatefulSetæœ‰ä¸€ä¸ªServiceNameå­—æ®µï¼Œè¿™æ˜¯å› ä¸ºé€šè¿‡ç›¸åº”çš„Serviceï¼Œè¿™ä¸ªStatefulSetæ‰ä¼šè¢«é›†ç¾¤å†…å…¶å®ƒæˆå‘˜å‘ç°ã€‚å› æ­¤ï¼Œåœ¨åˆ›å»ºStatefulSetä¹‹å‰ï¼Œæˆ‘ä»¬å…¶å®è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªç›¸åº”çš„Serviceèµ„æºï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">createMongoService</span><span class="params">(clientset *kubernetes.Clientset)</span> <span class="params">(*v1.Service, error)</span></span> &#123;</span><br><span class="line">    service := v1.Service&#123;</span><br><span class="line">        ObjectMeta: metav1.ObjectMeta&#123;</span><br><span class="line">            Name:   <span class="string">"mongo"</span>,</span><br><span class="line">            Labels: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">"name"</span>: <span class="string">"mongo"</span>&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        Spec: v1.ServiceSpec&#123;</span><br><span class="line">            Type: <span class="string">"NodePort"</span>,</span><br><span class="line">            Ports: []v1.ServicePort&#123;</span><br><span class="line">                &#123;</span><br><span class="line">                    Port:       <span class="number">27017</span>,</span><br><span class="line">                    TargetPort: intstr.IntOrString&#123;Type: <span class="number">0</span>, IntVal: <span class="number">27017</span>&#125;,</span><br><span class="line">                    NodePort:   <span class="number">32017</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            Selector: <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>&#123;<span class="string">"role"</span>: <span class="string">"mongo"</span>&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> clientset.CoreV1().Services(defaultNamespace).Create(&amp;service)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡NodePortæ–¹å¼ï¼ŒServiceèµ„æºå¯ä»¥å°†è¢«æœåŠ¡è€…çš„ç«¯å£ï¼ˆPortï¼‰æ˜ å°„åˆ°è‡ªå·±çš„ç«¯å£ï¼ˆTargetPortï¼‰ï¼Œç„¶åå†ç»‘å®šåˆ°èŠ‚ç‚¹ç‰¹å®šçš„ç«¯å£ï¼ˆNodePortï¼‰ã€‚mongodbçš„é»˜è®¤ç«¯å£æ˜¯27017ï¼Œè€Œé€šè¿‡<code>minikube ip</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çŸ¥é“èŠ‚ç‚¹çš„ipã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨Win10ä¸»æœºé‡Œè®¿é—®minikubeé‡Œçš„mongodbäº†ã€‚</p>
<p>æŠŠmongodbçš„Serviceä¸StatefulSetèµ„æºå£°æ˜äº¤ç»™kubernetesï¼Œå®ƒå°±ä¼šè‡ªåŠ¨æŠŠmongodbéƒ¨ç½²èµ·æ¥äº†ã€‚è¯•è¯•å§~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>kubernetesçš„éš¾ç‚¹ä¸»è¦æ¥è‡ªäºä¸šåŠ¡ç»éªŒã€‚æŠ€æœ¯ä¸ä¸šåŠ¡å¹¶è¡Œï¼ŒåŒå¿—ä»éœ€åŠªåŠ›ï¼</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>client-go</tag>
        <tag>kubernetes</tag>
        <tag>minikube</tag>
        <tag>mongodb</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘CSGOç©¶æè£…æœºä¼˜åŒ–è®¾ç½®æŒ‡å—</title>
    <url>/2019/09/21/diymemo/csgo/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸Šå‘¨ç”µè„‘çªå‘æå…¶å¥‡æ€ªçš„bugï¼Œå¯åŠ¨äº†ä¸åˆ°ä¸€ä¼šå„¿CPUé˜»å¡ï¼Œæ‰€æœ‰ç¨‹åºæ‰“ä¸å¼€ï¼Œå®‰å…¨æ¨¡å¼æŸ¥æ¯’ã€ä¿®å¤ç³»ç»Ÿã€æ¸…å­˜å‚¨å¸è½¯ä»¶å‡æ²¡æœ‰è·å¾—è¾ƒå¥½çš„æ•ˆæœã€‚å› æ­¤ç´¢æ€§é‡è£…äº†Windowsï¼Œæ‰€æœ‰ä¸€åˆ‡æ¨å€’é‡æ¥ã€‚</p>
<p>æ—¢ç„¶æ¨å€’é‡æ¥ï¼Œé‚£CSGOå°±æ˜¯ä¸å¾—ä¸è£…çš„ä¸€æ¬¾æ¸¸æˆã€‚CSGOåˆ°ç°åœ¨ä¹Ÿæœ‰10å¹´çš„å†å²äº†ï¼Œç„¶è€Œåœ¨ç½‘ä¸Šèƒ½æœåˆ°çš„æ¸¸æˆä¼˜åŒ–è®¾ç½®è¦ä¹ˆè¿‡æ—¶ï¼Œè¦ä¹ˆæ²¡æœ‰è¯¦å°½çš„æ•´åˆã€‚å› æ­¤ï¼Œæœ¬æ–‡ç« å€Ÿç€è£…æœºç»éªŒï¼Œæ•´ç†äº†è‡ªå·±ä¼˜åŒ–CSGOçš„å†ç¨‹~</p>
<p>ç”±äºç¬”è€…ä¸ºWin10+Nå¡ï¼Œå› æ­¤åœ¨Linux/Macä»¥åŠéNå¡ä¸‹ç©CSGOçš„åŒå­¦ï¼Œéƒ¨åˆ†é…ç½®è¿˜éœ€å¦è¡Œgoogle~</p>
<h2 id="Win10æ¸¸æˆè®¾ç½®"><a href="#Win10æ¸¸æˆè®¾ç½®" class="headerlink" title="Win10æ¸¸æˆè®¾ç½®"></a>Win10æ¸¸æˆè®¾ç½®</h2><p>è¿è¡Œåœ¨Win10çš„æ¸¸æˆéœ€è¦å…³é—­Win10è‡ªå¸¦çš„æ¸¸æˆä¼˜åŒ–ä¸é…ç½®</p>
<p>é¦–å…ˆå…³é—­XBoxè‡ªå¸¦çš„DVRï¼ˆæ¸¸æˆå†…å½•åƒä¹‹ç±»ï¼‰ï¼Œæœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œè¿™é‡Œé€šè¿‡æ³¨å†Œè¡¨æ–¹å¼è§£å†³ï¼š</p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line"></span><br><span class="line">[HKEY_CURRENT_USER\System\GameConfigStore]</span><br><span class="line">&quot;GameDVR_Enabled&quot;=dword:0</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\GameDVR]</span><br><span class="line">&quot;AllowGameDVR&quot;=dword:0</span><br><span class="line">[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PolicyManager\default\ApplicationManagement\AllowGameDVR]</span><br><span class="line">&quot;value&quot;=dword:0</span><br></pre></td></tr></table></figure>
<p>æ–°å»º<code>disableDVR.reg</code>å°†ä»¥ä¸Šæ–‡æœ¬å¤åˆ¶è¿›å»ï¼Œæ‰§è¡Œå³å¯ã€‚</p>
<p>å¦‚æœå¯¹æ³¨å†Œè¡¨ä¸ç†Ÿæ‚‰çš„è¯ï¼Œå¯ä»¥å¦å¤–ç™¾åº¦æœç›´æ¥åœ¨ç³»ç»Ÿè®¾ç½®å…³é—­çš„æ–¹æ³•ï¼ˆéå¸¸å¤šï¼Œéšä¾¿æŒ‘ä¸€ä¸ªå°±å¥½ï¼‰ï¼Œæ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly93d3cucGNvbmxpbmUuY29tLmNuL3dpbjEwLzEwNzcvMTA3NzI4MDcuaHRtbA==" title="https://www.pconline.com.cn/win10/1077/10772807.html">è¿™ä¸ª<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>ç„¶åå°±æ˜¯æŸ¥ç¼ºè¡¥æ¼äº†ã€‚æ‰“å¼€<code>ç³»ç»Ÿè®¾ç½®â€”â€”æ¸¸æˆ</code>ï¼Œåœ¨<code>æ¸¸æˆæ </code>æ¡ç›®å…³é—­<code>ä½¿ç”¨æ¸¸æˆæ å½•åˆ¶å‰ªè¾‘ã€å±å¹•æˆªå›¾å’Œå¹¿æ’­</code>ï¼Œå¦‚å›¾ï¼š</p>
<p><img src="/uploads/diymemo/csgo/gamebar.png" alt="æ¸¸æˆæ "></p>
<p>è€Œåï¼Œåœ¨<code>æ¸¸æˆæ¨¡å¼</code>æ¡ç›®ï¼Œå…³é—­<code>æ¸¸æˆæ¨¡å¼</code>ï¼Œå¦åˆ™CSGOç”»é¢è™šçš„ä¸€ç¬”ã€‚</p>
<p><img src="/uploads/diymemo/csgo/gamemode.png" alt="æ¸¸æˆæ¨¡å¼"></p>
<p>å¦‚æœå‡ºç°æœ‰æ¡ç›®ä¸åŒçš„æƒ…å†µï¼Œå¯èƒ½æ˜¯ç³»ç»Ÿç‰ˆæœ¬ä¸åŒçš„åŸå› ï¼ˆç¬”è€…ä¸º1903ï¼‰~</p>
<h2 id="é¼ æ ‡è®¾ç½®"><a href="#é¼ æ ‡è®¾ç½®" class="headerlink" title="é¼ æ ‡è®¾ç½®"></a>é¼ æ ‡è®¾ç½®</h2><p>é¼ æ ‡è®¾ç½®å¿…é¡»è¦åšçš„ä¸€ä¸ªæ˜¯å…³é—­é¼ æ ‡åŠ é€Ÿï¼š</p>
<p>æ‰“å¼€<code>æ§åˆ¶é¢æ¿</code>ï¼Œé€‰æ‹©<code>é¼ æ ‡</code>ä¸­çš„<code>æŒ‡é’ˆé€‰é¡¹</code>ä¸€æ ï¼Œå–æ¶ˆå‹¾é€‰<code>æé«˜æŒ‡é’ˆç²¾ç¡®åº¦</code></p>
<p><img src="/uploads/diymemo/csgo/cp_mouse.png" alt="æŒ‡é’ˆç²¾ç¡®åº¦"></p>
<p>è€Œåï¼Œå¦‚æœä½ çš„é¼ æ ‡æœ‰é¢å¤–é©±åŠ¨ç¨‹åºï¼ˆæ¯”å¦‚é›·è›‡ï¼‰ï¼Œéœ€è¦ä¸‹è½½é©±åŠ¨ç¨‹åºå»é¼ æ ‡åŠ é€Ÿç„¶ådiyä¸€ä¸ªè‡ªå·±æ„Ÿåˆ°èˆ’é€‚çš„é…ç½®ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å°±å¯ä»¥ç»§ç»­ä¸‹é¢äº†ã€‚</p>
<h2 id="Nå¡è®¾ç½®"><a href="#Nå¡è®¾ç½®" class="headerlink" title="Nå¡è®¾ç½®"></a>Nå¡è®¾ç½®</h2><p>é¦–å…ˆå®‰è£…Nå¡å›¾å½¢é©±åŠ¨ï¼ˆå¯ä»¥å®˜ç½‘æœä¹Ÿå¯ä»¥ç”¨é©±åŠ¨è½¯ä»¶ï¼‰ï¼Œå¦‚æœæˆåŠŸçš„è¯ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿæ‰¾åˆ°<code>NVIDIAæ§åˆ¶é¢æ¿</code>äº†ã€‚</p>
<p>åœ¨<code>NVIDIAæ§åˆ¶é¢æ¿</code>ä¸‹è®¾ç½®Nå¡ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<p>é¦–å…ˆè¿›å…¥<code>é€šè¿‡é¢„è§ˆè°ƒæ•´å›¾åƒè®¾ç½®</code>æ¡ç›®ï¼Œæ‹–åŠ¨æ¡ä¸ºä¾§é‡æ€§èƒ½ï¼š</p>
<p><img src="/uploads/diymemo/csgo/nvidia_preview.png" alt="é¢„è§ˆ"></p>
<p>è€Œåè¿›å…¥<code>ç®¡ç†3Dè®¾ç½®</code>æ¡ç›®ï¼Œå…¨å±€è®¾ç½®ç€é‡æ€§èƒ½è€Œéè´¨é‡ã€‚å½“ç„¶å¦‚æœä½ æƒ³æŸäº›å…¶ä»–æ¸¸æˆç€é‡è´¨é‡ï¼Œå¯ä»¥ä¸æ”¹å…¨å±€è®¾ç½®ï¼Œè€Œä¿®æ”¹ç¨‹åºè®¾ç½®ã€‚</p>
<p>ä¹‹åè¿›å…¥<code>é…ç½®Surroundã€PhysX</code>æ¡ç›®ï¼Œå°†PhysXè®¾ç½®ä¸ºæ˜¾å¡è€ŒéCPUï¼š</p>
<p><img src="/uploads/diymemo/csgo/physx.png" alt="PhysX"></p>
<p>é€‚ç”¨äºCSGOçš„è®¾ç½®å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/diymemo/csgo/nvidia1.png" alt="Nå¡1"></p>
<p><img src="/uploads/diymemo/csgo/nvidia2.png" alt="Nå¡2"></p>
<p>å¦‚æœéƒ¨åˆ†è®¾ç½®æ¡ç›®ä¸åŒï¼Œåº”å½“ä¸ºNVIDIAæ˜¾å¡å‹å·æˆ–é©±åŠ¨ç‰ˆæœ¬ä¸åŒæ‰€è‡´ï¼Œéœ€è¦å¦è¡Œæ£€ç´¢~</p>
<p>å†ç„¶åå°±çœ‹ä¸ªäººæƒ…å†µäº†ã€‚æ¯”å¦‚ä½ csgoåˆ†è¾¨ç‡ä¸º4:3ä½†åˆæƒ³å…¨å±æ²¡é»‘æ¡çš„è¯ï¼Œå¯ä»¥åœ¨<code>è°ƒæ•´æ¡Œé¢å°ºå¯¸å’Œä½ç½®</code>æ¡ç›®ä¸­çš„<code>ç¼©æ”¾</code>é€‰æ‹©<code>å…¨å±</code>ï¼Œå¹¶å‹¾é€‰<code>è¦†ç›–ç”±æ¸¸æˆå’Œç¨‹åºè®¾ç½®çš„ç¼©æ”¾æ¨¡å¼</code>ï¼Œè®°å¾—æŠŠåˆ·æ–°ç‡ä¹Ÿè®¾ç½®åˆ°æœ€é«˜~</p>
<p><img src="/uploads/diymemo/csgo/fullscreen.png" alt="å…¨å±"></p>
<h2 id="å¯åŠ¨å‚æ•°"><a href="#å¯åŠ¨å‚æ•°" class="headerlink" title="å¯åŠ¨å‚æ•°"></a>å¯åŠ¨å‚æ•°</h2><p>è‡ªå·±ç”µè„‘CSGOåœ¨steamå†…å¯åŠ¨å‚æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-novid -high -tickrate 128 -preload -refresh 120 -useforcedmparms -noforcemspd -noforcemaccel +exec autoexec.cfg</span><br></pre></td></tr></table></figure>
<p>ç¬”è€…ä¸ºç¥èˆ¹åˆ·æ–°ç‡120Hzæ˜¾ç¤ºå™¨ï¼Œå› æ­¤å¯åŠ¨å‚æ•°ä¼šå¡«å†™äº†<code>-refresh 120</code>ï¼Œå…¶ä»–å°ä¼™ä¼´è¯·æ ¹æ®è‡ªå·±æ˜¾ç¤ºå™¨æœ€å¤§åˆ·æ–°ç‡å¡«å†™<code>-refresh</code>å‚æ•°ï¼Œæ¯”å¦‚144ã€200å¤šå•¥çš„ã€‚</p>
<p>æœ€åä¼šå¯åŠ¨æ—¶æ‰§è¡Œ<code>autoexec.cfg</code>ï¼Œå…¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rate &quot;128000&quot;</span><br><span class="line">cl_cmdrate &quot;128&quot;</span><br><span class="line">cl_updaterate &quot;128&quot;</span><br><span class="line">cl_interp &quot;0&quot;</span><br><span class="line">cl_interp_ratio &quot;1&quot;</span><br><span class="line">cl_lagcompensation &quot;1&quot;</span><br><span class="line">r_dynamic &quot;0&quot;</span><br><span class="line">r_drawtracers_firstperson &quot;0&quot;</span><br><span class="line">fps_max &quot;300&quot;</span><br><span class="line">cl_radar_always_centered &quot;0&quot;</span><br><span class="line">cl_radar_scale &quot;0.3&quot;</span><br><span class="line">cl_hud_radar_scale &quot;1.15&quot;</span><br><span class="line">cl_radar_icon_scale_min &quot;1&quot;</span><br><span class="line">cl_radar_rotate &quot;1&quot;</span><br><span class="line">snd_mixahead &quot;0.05&quot;</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸€ä¸ªç¨³å½“ä½†å¹¶éæœ€ç‰›çš®æ¸¸æˆä½“éªŒçš„è®¾ç½®ã€‚å¦‚æœè¦è¿½æ±‚æœ€ä½³æ¸¸æˆä½“éªŒï¼Œæ¯”å¦‚å¯ä»¥è®¾ç½®<code>fps_max &quot;999&quot;</code>ä¹‹ç±»ã€‚</p>
<p><code>autoexec.cfg</code>éœ€è¦å­˜å‚¨åˆ°<code>${Steamæ¸¸æˆç›®å½•}\steamapps\common\Counter-Strike Global Offensive\csgo\cfg</code>ä¸­æ‰å¯ä»¥æ‰§è¡Œåˆ°ã€‚å…¶å®ƒçš„cfgè„šæœ¬ä¹ŸåŒæ ·å¦‚æ­¤ã€‚</p>
<h2 id="æ¸¸æˆå†…éƒ¨è®¾ç½®"><a href="#æ¸¸æˆå†…éƒ¨è®¾ç½®" class="headerlink" title="æ¸¸æˆå†…éƒ¨è®¾ç½®"></a>æ¸¸æˆå†…éƒ¨è®¾ç½®</h2><p>æ¥ä¸‹æ¥æ˜¯æ¸¸æˆå†…éƒ¨çš„è®¾ç½®ï¼Œé¦–å…ˆæ˜¯<code>è§†é¢‘è®¾ç½®</code>ï¼Œæ•ˆæœå…¨ä½ï¼Œç€é‡æ€§èƒ½å³å¯ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿æˆªå›¾ï¼Œé‡‡ç”¨äº†çª—å£æ¨¡å¼ï¼š</p>
<p><img src="/uploads/diymemo/csgo/video.png" alt="è§†é¢‘"></p>
<p>ç”¨æœ¬æœ¬çš„å°ä¼™ä¼´éœ€è¦åŒæ—¶è®¾ç½®<code>æ˜¾ç¤ºè®¾ç½®</code>ä¸º<code>ç”µè§†</code>ï¼Œè¿™æ ·ä¼šæœ‰æ›´å¥½çš„é¢œè‰²æ•ˆæœã€‚</p>
<p>è€Œåæ˜¯é¼ æ ‡ï¼Œæ‰“å¼€<code>é”®ç›˜/é¼ æ ‡</code>ä¸€æ ï¼Œå¯ç”¨åŸå§‹æ•°æ®è¾“å…¥ï¼Œå…³é—­é¼ æ ‡åŠ é€Ÿ</p>
<p><img src="/uploads/diymemo/csgo/mouse.png" alt="é¼ æ ‡"></p>
<p>å…¶å®ƒè®¾ç½®å› äººè€Œå¼‚ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>éŸ³é¢‘æ–¹é¢çš„ä¼˜åŒ–è¿˜æ²¡æœ‰ç³»ç»Ÿçš„æ¦‚å¿µï¼Œè€Œä¸”å› è€³æœºæ•ˆæœè€Œå·²ï¼Œå› æ­¤éœ€è¦å¦è¡Œæœç´¢å•¦~</p>
<p>å…¶å®ƒåœ°æ–¹ï¼Œå¦‚æœæœ‰ç¼ºï¼Œæ±‚ç•™è¨€è¡¥å……~</p>
<p>å¦‚æœé…ç½®ä¸å½“ï¼Œæ³è¯·æŒ‡æ­£~</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>CSGO</tag>
        <tag>Win10</tag>
        <tag>NVIDIA</tag>
        <tag>æ¸¸æˆ</tag>
        <tag>æ¸²æŸ“</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘luaä¸“ç”¨rpcåè®®sprotoâ€”â€”åŸºç¡€ä»‹ç»&amp;ç”¨äºåè®®æµ‹è¯•çš„äºŒæ¬¡å¼€å‘</title>
    <url>/2019/09/12/luatalk/sproto/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>rpcï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ï¼Œæ˜¯ä¸åŒä¸»æœºé—´çš„äº¤äº’çš„æœºåˆ¶ä¹‹ä¸€ã€‚å¥½æ¯”è¯´ï¼Œæˆ‘ä»¬æƒ³è¦è·å–æœåŠ¡å™¨çš„æŸä¸ªèµ„æºï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘é€ä¸€æ¡è®¯æ¯ç»™æœåŠ¡å™¨ï¼Œç„¶åæœåŠ¡å™¨è§£æä¿¡æ¯ï¼Œå†è¿”å›æ¨é€èµ„æºçš„ä¿¡æ¯ï¼Œè¿™æ ·ï¼Œä¾¿å®ç°äº†æˆ‘ä»¬å®¢æˆ·ç«¯è·ŸæœåŠ¡å™¨çš„ç›¸äº’çš„â€œè¿œç¨‹è°ƒç”¨â€ã€‚</p>
<p>ä¸ºäº†è®©ä¸åŒä¸»æœºä¹‹é—´èƒ½å¤Ÿç›¸äº’ç†è§£å‘é€çš„è®¯æ¯ï¼Œæˆ‘ä»¬éœ€è¦çº¦å®šç»Ÿä¸€çš„ä¿¡æ¯æ ¼å¼æ ‡å‡†ï¼Œä½¿å¾—ä¸åŒçš„ä¸»æœºå¯ä»¥å‘é€åŸºäºè¿™ä¸ªä¿¡æ¯æ ¼å¼çš„è®¯æ¯ï¼Œä¹Ÿå¯ä»¥è§£æè¿™ä¸ªæ ¼å¼ã€‚è¿™ç§æ ‡å‡†ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåè®®ï¼ˆprotocolï¼‰ã€‚</p>
<p>Luaä¸­åè®®é€‰æ‹©æœ‰è®¸å¤šç§ï¼Œprotobufã€jsonå‡å¯ã€‚ä½†æ˜¯ä»Šå¤©ï¼Œå°±ç¨å¾®ä»‹ç»ä¸€ä¸‹äº‘é£åŒå¿—å½“å¹´ä¸ºluaé‡èº«è®¾è®¡çš„sprotoåè®®ä»¥åŠå…¶ç”¨äºåè®®æµ‹è¯•çš„äºŒæ¬¡å¼€å‘ã€‚So, let the party begin~</p>
<h2 id="sprotoåè®®æè¿°"><a href="#sprotoåè®®æè¿°" class="headerlink" title="sprotoåè®®æè¿°"></a>sprotoåè®®æè¿°</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc3Byb3Rv" title="https://github.com/cloudwu/sproto">sproto<i class="fa fa-external-link"></i></span>æ˜¯ä¸“ç”¨äºluaçš„åè®®æ¡†æ¶ï¼Œç›¸å¯¹äºprotobufè·Ÿjsonï¼Œsprotoåœ¨æ•°æ®çš„åºåˆ—åŒ–/ååºåˆ—åŒ–æ•ˆç‡ä¸Šæœ‰æå¤§çš„ä¼˜åŠ¿ã€‚rpcä¸­ä¸ºäº†å¿«é€Ÿæ•ˆç‡åœ°ä¼ é€åè®®æ•°æ®ï¼Œä¼šå°†æ•°æ®ç»„è£…å‹ç¼©å‘é€ï¼Œæ¥æ”¶ç«¯å†è§£å‹æ‹†è§£æ•°æ®è¯†åˆ«æ¶ˆæ¯ï¼Œä»è€Œå‡å°äº†ç½‘ç»œä¼ è¾“çš„å¼€é”€ã€‚è¿™ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹ä¾¿å¯ç§°ä¹‹ä¸ºåºåˆ—åŒ–/ååºåˆ—åŒ–ã€‚</p>
<p>sprotoçš„è®¾è®¡ç±»ä¼¼äº<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vcHJvdG9jb2wtYnVmZmVycy8/aGw9emgtQ04=" title="https://developers.google.com/protocol-buffers/?hl=zh-CN">protobuf<i class="fa fa-external-link"></i></span>ï¼ŒåŸºæœ¬ç±»å‹ä¸º<code>string</code>ã€<code>binary</code>ã€<code>integer</code>ä»¥åŠ<code>boolean</code>å››ç§ã€‚å¯¹äºarrayåºåˆ—çš„æ”¯æŒï¼Œåˆ™åŠ ä¸Šå¼•ç”¨æ˜Ÿå·<code>*</code>å³å¯ï¼›å¯¹äºéæ•´æ•°çš„æ”¯æŒæ–¹é¢ï¼Œç”¨æˆ·å¯ä»¥parse stringæ¥å¤„ç†å®æ•°ï¼Œæˆ–è€…æŒ‡å®šintegerçš„å°æ•°ä½æ•°æ¥å¤„ç†å°æ•°ï¼ˆdecimalï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åƒç¼–ç¨‹é‡Œé¢strcuté‚£æ ·è‡ªå®šä¹‰ç±»å‹ï¼Œç±»å‹ä¸ç±»å‹ä¹‹é—´ä¹Ÿå¯ä»¥åµŒå¥—ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc3Byb3RvL2Jsb2IvbWFzdGVyL1JFQURNRS5tZA==" title="https://github.com/cloudwu/sproto/blob/master/README.md">readme<i class="fa fa-external-link"></i></span>ä¸­å¯»æ‰¾å„ç§ä¾‹å­ã€‚æ•°æ®ç±»å‹çš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">.Person &#123; # . means a user defined type</span><br><span class="line">    name <span class="number">0</span> : <span class="built_in">string</span> # <span class="built_in">string</span> is a build-in type.</span><br><span class="line">    id <span class="number">1</span> : integer</span><br><span class="line">    email <span class="number">2</span> : <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">    .PhoneNumber &#123; # user defined type can be nest.</span><br><span class="line">        number <span class="number">0</span> : <span class="built_in">string</span></span><br><span class="line">        type <span class="number">1</span> : integer</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    phone <span class="number">3</span> : *PhoneNumber # *PhoneNumber means an array of PhoneNumber.</span><br><span class="line">    height <span class="number">4</span> : integer(<span class="number">2</span>) # (<span class="number">2</span>) means a <span class="number">1</span>/<span class="number">100</span> fixed-point number.</span><br><span class="line">    data <span class="number">5</span> : binary # Some binary data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.AddressBook &#123;</span><br><span class="line">    person <span class="number">0</span> : *Person(id) # (id) is <span class="keyword">optional</span>, means Person.id is main index.</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¯ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹éœ€è¦åŒ…å«å­é¡¹çš„åç§°ã€ç¼–å·ï¼ˆåºåˆ—åŒ–æ—¶æ’åºï¼‰ä¸å­é¡¹æ•°æ®ç±»å‹ã€‚åŸºäºè¿™äº›æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥çº¦å®šå„ç§å„æ ·çš„åè®®ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">foobar <span class="number">1</span> &#123; # define a new protocol (for RPC used) with tag <span class="number">1</span></span><br><span class="line">    request Person # Associate the type Person with foobar.request</span><br><span class="line">    response &#123; # define the foobar.response type</span><br><span class="line">        ok <span class="number">0</span> : boolean</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œåè®®foobarï¼ˆç¼–å·ä¸º1ï¼‰è¯·æ±‚ä¸è¿”å›çš„åè®®æ•°æ®æ ¼å¼ä¾¿ä¸€ç›®äº†ç„¶äº†ã€‚</p>
<p>è‡³äºåè®®çš„åºåˆ—åŒ–è®¾è®¡ï¼Œåœ¨äº‘é£æ‰€è‘—<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNvZGluZ25vdy5jb20vMjAxNC8wNy9lam95cHJvdG8uaHRtbA==" title="https://blog.codingnow.com/2014/07/ejoyproto.html">ã€Šè®¾è®¡ä¸€ç§ç®€åŒ–çš„ protocol buffer åè®®ã€‹<i class="fa fa-external-link"></i></span>çš„Wire Protocolä¸â€œ0 å‹ç¼©â€ç« èŠ‚ä¸­å·²ç»è¯¦å°½æè¿°äº†ï¼Œæ­¤å¤„ä¾¿ä¸å†èµ˜è¿°ã€‚</p>
<h2 id="sprotoåè®®æ”¶å‘"><a href="#sprotoåè®®æ”¶å‘" class="headerlink" title="sprotoåè®®æ”¶å‘"></a>sprotoåè®®æ”¶å‘</h2><p>æ”¶å‘åè®®çš„ä¾‹å­å¯ä»¥æŸ¥çœ‹skynetç½‘ç»œæ¡†æ¶çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc2t5bmV0L3dpa2kvU3Byb3Rv" title="https://github.com/cloudwu/skynet/wiki/Sproto">Sproto<i class="fa fa-external-link"></i></span>ä¸€ç« ã€‚</p>
<p>sprotoæœ¬èº«ä¹Ÿåˆ†ä¸¤å±‚ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨sprotoçš„æ—¶å€™ï¼Œé€šå¸¸è°ƒç”¨sprotoçš„luaåµŒå…¥å±‚æ¨¡å—<code>sproto.lua</code>ä¸­çš„å‡½æ•°ã€‚çœŸå®æ”¶å‘sprotoåè®®æ—¶ï¼Œéœ€è¦å¸¦ä¸Šåè®®åŒ…å¤´<code>header</code>è¡¨ç°åè®®çš„å¤–åœ¨ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>type åè®®çš„ç±»å‹â€”â€”REQUESTæˆ–RESPONSE</li>
<li>session åè®®çš„æ ‡è¯†â€”â€”é€šè¿‡è¿™ä¸ªæ ‡è¯†å¯¹åº”è¯·æ±‚ä¸å“åº”</li>
</ul>
<p>ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨<code>sproto.parse</code>æˆ–<code>sproto.new</code>æŠŠè‡ªå·±å‚¨å­˜çš„åè®®å®šä¹‰è§£æè‡³å†…å­˜é‡Œã€‚é€šè¿‡<code>local host = sproto:host(åŒ…å¤´å)</code>ï¼Œæˆ‘ä»¬ä¾¿å¯æŒ‡å®šåŒ…å¤´ã€‚ä¹‹åï¼Œé€šè¿‡<code>host:attach(è§£æçš„åè®®)</code>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œç”¨æ¥æ‰“åŒ…æ¯ä¸ªåè®®æ•°æ®åŒ…ï¼Œè€Œç›¸å¯¹åœ°ï¼Œé€šè¿‡<code>host:dispatch</code>ï¼Œå°±å¯ä»¥è§£ææ¯ä¸€ä¸ªä¼ è¾“è¿‡æ¥çš„åè®®æ•°æ®äº†ã€‚å…·ä½“æ“ä½œåœ¨githubé¡¹ç›®ä¸Šçš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc3Byb3RvL2Jsb2IvbWFzdGVyL3Nwcm90by5sdWE=" title="https://github.com/cloudwu/sproto/blob/master/sproto.lua">sproto.lua<i class="fa fa-external-link"></i></span>éƒ½èƒ½çœ‹åˆ°ï¼Œä¾‹å­åˆ™å¯ä»¥æŸ¥çœ‹<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc3Byb3RvL2Jsb2IvbWFzdGVyL3Rlc3RycGMubHVh" title="https://github.com/cloudwu/sproto/blob/master/testrpc.lua">testrpc.lua<i class="fa fa-external-link"></i></span>ã€‚</p>
<h2 id="ç”¨äºåè®®æµ‹è¯•çš„äºŒæ¬¡å¼€å‘"><a href="#ç”¨äºåè®®æµ‹è¯•çš„äºŒæ¬¡å¼€å‘" class="headerlink" title="ç”¨äºåè®®æµ‹è¯•çš„äºŒæ¬¡å¼€å‘"></a>ç”¨äºåè®®æµ‹è¯•çš„äºŒæ¬¡å¼€å‘</h2><p>è¦æµ‹è¯•sprotoï¼Œé¦–å…ˆéœ€è¦å¯¼å‡ºæ‰€æœ‰åè®®ã€‚åœ¨å®˜æ–¹çš„å®ç°ä¸­ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nsb3Vkd3Uvc3Byb3RvL2Jsb2IvbWFzdGVyL3Nwcm90by5j" title="https://github.com/cloudwu/sproto/blob/master/sproto.c">sproto.c<i class="fa fa-external-link"></i></span>çš„<code>void sproto_dump(struct sproto *s)</code>å‡½æ•°å¯ä»¥æŠŠæ‰€æœ‰åè®®éƒ½printå‡ºæ¥ï¼Œå¯¹åº”çš„luaæ¥å£æ˜¯<code>require(&quot;sproto.core&quot;).dumpproto(è§£æçš„åè®®.__cobj))</code>ã€‚è€Œåœ¨ç¬”è€…è‡ªå·±forkçš„é¡¹ç›®ä¸­ï¼Œå°±ä¿®æ”¹äº†<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9zcHJvdG8vYmxvYi9tYXN0ZXIvbHNwcm90by5j" title="https://github.com/utmhikari/sproto/blob/master/lsproto.c">lsproto.cï¼ˆluaæ³¨å†Œå±‚ï¼‰<i class="fa fa-external-link"></i></span>çš„å®ç°ï¼Œå¢åŠ äº†totableçš„åŠŸèƒ½ã€‚é€šè¿‡totableå¯¼å‡ºä¹‹åï¼Œåœ¨åè®®æµ‹è¯•è¿‡ç¨‹ä¸­ç»Ÿè®¡åè®®ä¿¡æ¯å°±ä¸æ˜¯ä»€ä¹ˆéš¾é¢˜äº†ã€‚</p>
<p>è€Œåè®®æµ‹è¯•çš„ä¸€ä¸ªå¿…å¤‡åŠŸèƒ½å°±æ˜¯ä»å·¥å…·ç«¯å‘é€åè®®ï¼Œï¼ˆå¹¶éä»çœŸå®å®¢æˆ·ç«¯å‘é€ï¼‰ï¼Œå› æ­¤é¦–å…ˆæˆ‘ä»¬ä¹Ÿéœ€è¦é­”æ”¹<code>sproto.lua</code>æ¥ä¾¿åˆ©æµ‹è¯•ã€‚æˆ‘ä»¬å¯ä»¥è§‚å¯Ÿ<code>sproto:host</code>å‡½æ•°ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sproto:host</span><span class="params">( packagename )</span></span></span><br><span class="line">    packagename = packagename <span class="keyword">or</span>  <span class="string">"package"</span></span><br><span class="line">    <span class="keyword">local</span> obj = &#123;</span><br><span class="line">        __proto = self,</span><br><span class="line">        __package = <span class="built_in">assert</span>(core.querytype(self.__cobj, packagename), <span class="string">"type package not found"</span>),</span><br><span class="line">        __session = &#123;&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">setmetatable</span>(obj, host_mt)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­çš„<code>__session</code>ç”¨äºç¼“å­˜æ¯ä¸€ä¸ªæŒ‡å®šäº†sessionçš„åŒ…ï¼Œè¿™ä¸ªç¼“å­˜è¿‡ç¨‹æ˜¯åœ¨ä¸Šé¢æ‰€è¿°<code>host:attach</code>é‡Œæ‰“åŒ…å›è°ƒå‡½æ•°å®ç°çš„ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">host:attach</span><span class="params">(sp)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(name, args, session, ud)</span></span></span><br><span class="line">        <span class="keyword">local</span> proto = queryproto(sp, name)</span><br><span class="line">        header_tmp.<span class="built_in">type</span> = proto.tag</span><br><span class="line">        header_tmp.session = session</span><br><span class="line">        header_tmp.ud = ud</span><br><span class="line">        <span class="keyword">local</span> header = core.encode(self.__package, header_tmp)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> session <span class="keyword">then</span></span><br><span class="line">            self.__session[session] = proto.response <span class="keyword">or</span> <span class="literal">true</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> proto.request <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> content = core.encode(proto.request, args)</span><br><span class="line">            <span class="keyword">return</span> core.pack(header ..  content)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> core.pack(header)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å› æ­¤ï¼Œå¦‚æœè¦å®ç°ä»å·¥å…·ç«¯å‡­ç©ºå‘é€åè®®çš„è¯ï¼Œå¯ä»¥å¦å¤–åœ¨hostçš„objä¸­å¢åŠ <code>__name</code>ç¼“å­˜æ¯ä¸ªåè®®åçš„å‘é€ä¿¡æ¯ã€‚è¦å‡­ç©ºå‘ä¸€æ¡åè®®æ—¶ï¼Œå¦‚æœ<code>__name</code>ä¸­æ²¡æœ‰ç¼“å­˜ï¼Œå°±å†å‡­ç©ºç”Ÿæˆä¸€ä¸ªsessionï¼Œè€Œå¦‚æœæœ‰ï¼Œå°±æ ¹æ®ç¼“å­˜ä¸­æ˜¯å¦åŒ…å«sessionæ¥åˆ¤æ–­éœ€ä¸éœ€è¦å‡­ç©ºç”Ÿæˆsessionã€‚é€šè¿‡ä¿®æ”¹<code>host</code>ä¸<code>attach</code>å‡½æ•°ï¼Œå°±å¯ä»¥æ»¡è¶³è¿™äº›éœ€æ±‚å•¦~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¸è®ºæ˜¯sprotoï¼Œè¿˜æ˜¯å•¥ï¼Œåè®®æµ‹è¯•æœ¬èº«å®ç°æ–¹æ¡ˆä¼—å¤šï¼Œéœ€æ±‚ä¹Ÿåƒå˜ä¸‡åŒ–ï¼Œå•é è¿™ä¸€ç¯‡æ–‡ç« ï¼Œéš¾ä»¥å®Œå…¨è¯´æ˜ã€‚</p>
<p>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®~</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>lua</tag>
        <tag>sproto</tag>
        <tag>åè®®</tag>
        <tag>åè®®æµ‹è¯•</tag>
        <tag>rpc</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬ä¸‰è¯ï¼šåˆ©ç”¨docker clientæœ¬åœ°éƒ¨ç½²MySQL</title>
    <url>/2019/09/01/gofromzero/03_docker_client/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nb2Zyb216ZXJv" title="https://github.com/utmhikari/gofromzero">Githubä¼ é€é—¨<i class="fa fa-external-link"></i></span></p>
<p>æœ€è¿‘å›å¿†èµ·äº†åœ¨å­¦æ ¡é‚£ä¼šå„¿è¶£äº‹ï¼šåˆšå¼€å§‹ä¸Šæ•°æ®åº“åŸç†è¯¾ç¨‹ï¼Œä¸€å¼€å§‹è£…Microsoft SQL Serverï¼Œå…¨ç­åŒå­¦éƒ½åœ¨åæ§½ï¼Œæ€¨å£°è½½é“â€”â€”è¿™ä¸ªè¯´æ•°æ®åº“å’‹å¯åŠ¨ä¸äº†ï¼Œé‚£ä¸ªè¯´æ•°æ®åº“å’‹å¸è½½ä¸å¹²å‡€ï¼Œä¸ªä¸ªç„¦å¤´çƒ‚é¢ï¼Œå®åœ¨æ˜¯å¥½ä¸€ç•ªé£æ™¯ã€‚å”‰ï¼Œé‚£æ—¶å€™å°±åœ¨æƒ³ï¼Œè¦æ˜¯æœ‰ä¸€ä¸ªç±»ä¼¼äºè½¯ä»¶ç®¡å®¶çš„ä¸œè¥¿æ‰˜ç®¡Microsoft SQL Serverï¼Œè®©æˆ‘ä»¬ä¸€é”®å®‰è£…/å¸è½½ï¼Œå¯ä¸å°±å¥½äº†ã€‚</p>
<p>è¿›å…¥å·¥ä¸šç•Œï¼Œæ¥è§¦äº†è¿ç»´æ–¹é¢çš„çŸ¥è¯†ï¼Œæ‰äº†è§£åˆ°<span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS8=" title="https://www.docker.com/">docker<i class="fa fa-external-link"></i></span>çš„å­˜åœ¨ã€‚ä¸åŒäºå½“å¹´å¸¸ç”¨çš„è™šæ‹Ÿæœºè½¯ä»¶ï¼ˆVMWare WorkStationï¼‰ï¼Œdockerå¹¶æœªå¯¹æ“ä½œç³»ç»Ÿçš„ç¡¬ä»¶æ”¯æ’‘åšè™šæ‹ŸåŒ–ï¼Œåªæ˜¯æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ï¼Œä½†å´æ¨¡æ‹Ÿäº†ä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„ç¯å¢ƒï¼Œå› æ­¤ç›¸å¯¹äºè™šæ‹Ÿæœºè€Œè¨€ï¼Œdockeræ›´åŠ è½»é‡ã€‚è½»é‡çš„è¿è¡Œç¯å¢ƒæ„å‘³ç€åŸºäºdockerçš„éƒ¨ç½²ï¼Œåœ¨ç®¡ç†ä¸è°ƒåº¦ä¸Šä¼šæ›´åŠ å®¹æ˜“ã€‚çœ‹ï¼Œkubernetesï¼</p>
<p>å†å›åˆ°æˆ‘ä»¬çš„å­¦ä¹ ç”Ÿæ´»ï¼Œæ‹¿MySQLä¸ºä¾‹å§â€”â€”æœ‰äº†dockerï¼Œå®‰è£…å¸è½½MySQLï¼Œå°±ä¼šå˜å¾—æ— æ¯”å®¹æ˜“ã€‚é¦–å…ˆ<code>docker pull mysql</code>ï¼›è€Œåæ•´ç†ä¸€ä¸‹é…ç½®â€”â€”é€šè¿‡<code>-v</code>æ˜ å°„æ•°æ®åœ¨æœ¬åœ°çš„å­˜å‚¨è·¯å¾„ï¼Œé€šè¿‡<code>-p</code>æš´éœ²å‡ºæ¥mysqlå®¹å™¨çš„ç«¯å£ï¼Œé€šè¿‡<code>-e</code>è®¾ç½®MySQLå¯†ç ç­‰ç¯å¢ƒå˜é‡ï¼›ä¹‹å<code>docker run</code>å¸¦ä¸Šä¸Šé¢çš„è®¾ç½®ï¼Œæˆ‘ä»¬çš„MySQLå°±å¯åŠ¨äº†ï¼è¦å½»åº•å¸è½½çš„è¯ï¼Œåªéœ€è¦ä¸‰è¡Œå‘½ä»¤ï¼š<code>docker stop ${MySQLå®¹å™¨ID}</code>ã€<code>docker rm ${MySQLå®¹å™¨ID}</code>ä¸<code>docker image rm ${MySQLé•œåƒID}</code>ï¼Œå°±okäº†ï¼Œæ˜¯ä¸æ˜¯EZPZï¼Ÿ</p>
<p>æ­£å¥½ï¼Œdockeræ˜¯åŸºäºGolangç¼–å†™ã€‚å› æ­¤æœ¬æœŸä»é›¶å•æ’ï¼Œæˆ‘ä»¬å°±ç”¨Golangæ¥æŒ‘æˆ˜ä¸€ä¸‹å¦‚ä½•ä¸dockeräº¤äº’å§~</p>
<h2 id="ç¼–å†™Golangç¨‹åºéƒ¨ç½²MySQL"><a href="#ç¼–å†™Golangç¨‹åºéƒ¨ç½²MySQL" class="headerlink" title="ç¼–å†™Golangç¨‹åºéƒ¨ç½²MySQL"></a>ç¼–å†™Golangç¨‹åºéƒ¨ç½²MySQL</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç ”ç©¶ä¸€ä¸‹ç›¸å…³çš„æŠ€æœ¯æ ˆï¼šå®˜æ–¹æä¾›çš„Golangå®¢æˆ·ç«¯åº“<span class="exturl" data-url="aHR0cHM6Ly9nb2RvYy5vcmcvZ2l0aHViLmNvbS9kb2NrZXIvZG9ja2VyL2NsaWVudA==" title="https://godoc.org/github.com/docker/docker/client">docker client<i class="fa fa-external-link"></i></span>ä¸ºGolangä¸dockeré—´æ­å»ºäº†æ¡¥æ¢ï¼Œå…¶å®è´¨æ˜¯å¯¹<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2FwaS92MS4yNC8=" title="https://docs.docker.com/engine/api/v1.24/">docker engine api<i class="fa fa-external-link"></i></span>çš„æŠ½è±¡ï¼›è€Œdocker engine apiå®è´¨åˆ™æ˜¯ä¸€ä¸ªHTTPåç«¯ï¼Œæ˜¯å¯¹dockerå†…éƒ¨é•œåƒä¸å®¹å™¨ç®¡ç†åŠŸèƒ½çš„æŠ½è±¡ã€‚</p>
<p>é€šè¿‡docker clientåº“ï¼Œæˆ‘ä»¬åªéœ€å…³å¿ƒç›¸å…³çš„å‚æ•°è¾“å…¥ã€‚åº“ä¸­çš„æ–¹æ³•ä¼šè‡ªåŠ¨æ‹¼è£…å‚æ•°ï¼Œå‘é€è‡³docker engine apiï¼Œä»è€Œå®ç°äº¤äº’ã€‚docker clientçš„ä¸€äº›å°ä¾‹å­ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZGV2ZWxvcC9zZGsvZXhhbXBsZXMv" title="https://docs.docker.com/develop/sdk/examples/">è¿™é‡Œ<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¿…é¡»ç ”ç©¶ä¸€ä¸‹ï¼Œè¦éƒ¨ç½²MySQLå®¹å™¨ï¼Œéœ€è¦æœ‰å“ªäº›æ­¥éª¤ï¼š</p>
<a id="more"></a>
<ul>
<li>ç™»å½•docker hub</li>
<li>æ‹‰å–MySQLé•œåƒ</li>
<li>è®¾ç½®å‚æ•°ï¼Œå¯åŠ¨å®¹å™¨</li>
<li>å¼€å¯æ—¥å¿—</li>
</ul>
<p>è¿™å››ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½è±¡æˆä¸ºå››ä¸ªfuncï¼š</p>
<ul>
<li>login</li>
<li>pullImage</li>
<li>runImage</li>
<li>logImage</li>
</ul>
<p>é‚£ä¹ˆæˆ‘ä»¬çš„ä¸»funcä¾¿æ˜¯ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸»çº¿ç¨‹çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">var</span> ctx = context.Background()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">LaunchMySQL</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Creating docker client..."</span>)</span><br><span class="line">    cli, err := client.NewEnvClient()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">"Error while creating docker client! %s"</span>, err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> closeClient(cli)</span><br><span class="line">    login(cli)</span><br><span class="line">    pullImage(cli)</span><br><span class="line">    id := runImage(cli)</span><br><span class="line">    logImage(cli, id)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å››ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬åˆ†å¼€æ¥çœ‹ï¼š</p>
<h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">login</span><span class="params">(cli *client.Client)</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Logging in docker registry..."</span>)</span><br><span class="line">    ok, err := cli.RegistryLogin(ctx, types.AuthConfig&#123;</span><br><span class="line">        Username: <span class="string">"ç”¨æˆ·å"</span>,</span><br><span class="line">        Password: <span class="string">"å¯†ç "</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">"Error while logging in docker registry! %s"</span>, err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    log.Printf(<span class="string">"%s --- Token: %s\n"</span>, ok.Status, ok.IdentityToken)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é‡‡ç”¨<code>RegistryLogin</code>æ–¹æ³•ï¼Œå³å¯ç™»å½•docker hubï¼Œä¹‹åå°±å…å»è®¤è¯çš„æ­¥éª¤äº†~</p>
<h3 id="æ‹‰å–é•œåƒ"><a href="#æ‹‰å–é•œåƒ" class="headerlink" title="æ‹‰å–é•œåƒ"></a>æ‹‰å–é•œåƒ</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pullImage</span><span class="params">(cli *client.Client)</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Pulling MySQL Image..."</span>)</span><br><span class="line">    reader, err := cli.ImagePull(</span><br><span class="line">        ctx,</span><br><span class="line">        <span class="string">"docker.io/library/mysql"</span>,</span><br><span class="line">        types.ImagePullOptions&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">"Error while pulling image! %s"</span>, err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    _, err = io.Copy(os.Stdout, reader)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    log.Println(<span class="string">"Successfully pulled MySQL Image!"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‹‰å–é•œåƒæ­¥éª¤ï¼Œéœ€è¦æŒ‡å®šé•œåƒçš„å®Œæ•´å­˜å‚¨ä½ç½®ï¼š<code>docker.io/library/mysql</code></p>
<h3 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// create and start image</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runImage</span><span class="params">(cli *client.Client)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Running MySQL Image..."</span>)</span><br><span class="line">    resp, err := cli.ContainerCreate(</span><br><span class="line">        ctx,</span><br><span class="line">        &amp;container.Config&#123;</span><br><span class="line">            Image: <span class="string">"mysql:latest"</span>,</span><br><span class="line">            Env: []<span class="keyword">string</span>&#123;<span class="string">"MYSQL_ROOT_PASSWORD"</span>, <span class="string">"123456"</span>&#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &amp;container.HostConfig&#123;</span><br><span class="line">            PortBindings: nat.PortMap&#123;</span><br><span class="line">                <span class="string">"3306/tcp"</span>: []nat.PortBinding&#123;</span><br><span class="line">                    &#123;</span><br><span class="line">                        HostIP: <span class="string">"0.0.0.0"</span>,</span><br><span class="line">                        HostPort: <span class="string">"3306"</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            Mounts: []mount.Mount&#123;</span><br><span class="line">                &#123;</span><br><span class="line">                    Type:   mount.TypeBind,</span><br><span class="line">                    Source: <span class="string">"E:\\Tools\\MySQL"</span>,</span><br><span class="line">                    Target: <span class="string">"/var/lib/mysql"</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="literal">nil</span>,</span><br><span class="line">        <span class="string">"MySQLDB"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">"Error while creating image! %s"</span>, err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    log.Printf(<span class="string">"Successfully created MySQL image: %s!\n"</span>, resp.ID)</span><br><span class="line">    err = cli.ContainerStart(ctx, resp.ID, types.ContainerStartOptions&#123;&#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">"Error while starting image! %s"</span>, err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    log.Println(<span class="string">"Successfully ran MySQL image!"</span>)</span><br><span class="line">    <span class="keyword">return</span> resp.ID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸºäºé•œåƒä¸é…ç½®ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å¯åŠ¨ä¸€ä¸ªå®¹å™¨</p>
<p>åœ¨<code>Config</code>é‡Œï¼Œè®¾ç½®ç¯å¢ƒå˜é‡<code>MYSQL_ROOT_PASSWORD</code>ä¸º<code>123456</code>ï¼Œè€Œååœ¨<code>HostConfigé‡Œ</code>ï¼Œæš´éœ²<code>3306</code>ç«¯å£ï¼ˆMySQLé»˜è®¤ç«¯å£ï¼‰åˆ°å®¿ä¸»æœºçš„<code>3306</code>ç«¯å£ï¼Œè€Œåå®¿ä¸»æœºçš„<code>E:\Tools\MySQL</code>è·¯å¾„ä¸å®¹å™¨é‡Œ<code>/var/lib/mysql</code>è·¯å¾„ç»‘å®šï¼Œè¿™æ ·mysqlçš„æ•°æ®å°±èƒ½åœ¨æˆ‘ä»¬çš„æœ¬æœºï¼ˆå®¿ä¸»æœºï¼‰æŒä¹…åŒ–äº†</p>
<h3 id="å¼€å¯æ—¥å¿—"><a href="#å¼€å¯æ—¥å¿—" class="headerlink" title="å¼€å¯æ—¥å¿—"></a>å¼€å¯æ—¥å¿—</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">logImage</span><span class="params">(cli *client.Client, containerID <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Fetching log on MySQL container..."</span>)</span><br><span class="line">    reader, err := cli.ContainerLogs(ctx, containerID, types.ContainerLogsOptions&#123;</span><br><span class="line">        ShowStdout:<span class="literal">true</span>,</span><br><span class="line">        ShowStderr:<span class="literal">true</span>,</span><br><span class="line">        Timestamps:<span class="literal">true</span>,</span><br><span class="line">        Follow:<span class="literal">true</span>,</span><br><span class="line">        Details:<span class="literal">true</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">"Error while logging image! %s"</span>, err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">    _, err = io.Copy(os.Stdout, reader)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(err.Error())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ—¥å¿—é€‰é¡¹ä¸­ï¼ŒæŠŠæ‰€æœ‰boolé¡¹å¼€å¯ï¼Œæ—¥å¿—æ•°æ®ä¾¿æ›´åŠ ç»†èŠ‚äº†</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>golangä¸dockeräº¤äº’çš„ä¾‹å­ç¹ä¸èƒœæ•°ï¼Œä½†æ€»å½’è¿˜è¦ä¸šåŠ¡æ¥å†³å®šä½¿ç”¨å“ªäº›åŠŸèƒ½ã€‚</p>
<p>å¦å¤–ä¸å¾—ä¸è¯´ï¼Œåœ¨9102å¹´çš„ä»Šå¤©ï¼Œä¿®ä¹ æŠ€æœ¯çš„åŒå­¦ï¼Œå¸¦çš„ç”µè„‘å¿…é¡»å¾—æœ‰ä¸ªdockerã€‚</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>Golang</tag>
        <tag>docker</tag>
        <tag>docker client</tag>
        <tag>MySQL</tag>
        <tag>docker API</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘ä¸€æ–‡ä¸Šæ‰‹coroutineåç¨‹</title>
    <url>/2019/08/25/luatalk/coroutine/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æåˆ°luaï¼Œå°±ä¸å¾—ä¸æåç¨‹coroutineã€‚coroutineæ˜¯luaçš„ä¸€ç§å†…åœ¨æœºåˆ¶ï¼Œä¸ºluaæä¾›äº†åŸç”Ÿçš„å¼‚æ­¥æ”¯æŒã€‚ä»ç”¨æˆ·å±‚é¢æ¥çœ‹ï¼Œç”¨æˆ·ä¸éœ€å…³å¿ƒcoroutineçš„å†…åœ¨å®ç°ï¼Œè€Œåªéœ€è¦ç”¨coroutineè°ƒåº¦functionå³å¯ï¼Œå› æ­¤éå¸¸æ–¹ä¾¿ã€‚</p>
<p>å¯¹äºä¸€ä¸ªfunctionè€Œè¨€ï¼Œcoroutineå¯ä»¥å°†functionçš„ä»£ç åˆ†ç‰‡ï¼Œä½¿å¾—ä¸€ä¸ªfunctionå¯ä»¥åˆ†é˜¶æ®µè¿è¡Œã€‚åœ¨å®ç°ä¸Šï¼Œfunctionçš„çŠ¶æ€ç®¡ç†ä¼šä¸CPUçš„æœºåˆ¶ç›¸ä¼¼ã€‚å¦‚æœæŠŠä¸€ä¸ªfunctionå½“åšä¸€ä¸ªä»»åŠ¡æ¥çœ‹å¾…çš„è¯ï¼Œåœ¨coroutineçš„å°è£…ä¸‹ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šè¢«åˆ†è§£æˆå¤šä¸ªé˜¶æ®µçš„å­ä»»åŠ¡ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå¤šä¸ªä»»åŠ¡çš„å­ä»»åŠ¡ç›¸äº’åè°ƒè°ƒåº¦ï¼Œå®ç°æ›´åŠ çµæ´»çš„åŠŸèƒ½äº¤äº’ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬æœŸLuaæ‚è°ˆï¼Œå°±æ¥å°è¯•ä¸€æŠ”coroutineçš„ä½¿ç”¨å§ã€‚</p>
<h2 id="coroutineçš„åŸºæœ¬ç”¨æ³•"><a href="#coroutineçš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="coroutineçš„åŸºæœ¬ç”¨æ³•"></a>coroutineçš„åŸºæœ¬ç”¨æ³•</h2><p>å®˜æ–¹5.3.5ç‰ˆæœ¬çš„coroutineåº“ï¼Œæä¾›äº†å¦‚ä¸‹çš„æ¥å£ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lcorolib.c</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> luaL_Reg co_funcs[] = &#123;</span><br><span class="line">  &#123;<span class="string">"create"</span>, luaB_cocreate&#125;,</span><br><span class="line">  &#123;<span class="string">"resume"</span>, luaB_coresume&#125;,</span><br><span class="line">  &#123;<span class="string">"running"</span>, luaB_corunning&#125;,</span><br><span class="line">  &#123;<span class="string">"status"</span>, luaB_costatus&#125;,</span><br><span class="line">  &#123;<span class="string">"wrap"</span>, luaB_cowrap&#125;,</span><br><span class="line">  &#123;<span class="string">"yield"</span>, luaB_yield&#125;,</span><br><span class="line">  &#123;<span class="string">"isyieldable"</span>, luaB_yieldable&#125;,</span><br><span class="line">  &#123;<span class="literal">NULL</span>, <span class="literal">NULL</span>&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç”¨æˆ·å¯ä»¥é€šè¿‡<code>coroutine.wrap</code>ä¸<code>coroutine.create</code>ä¸¤ç§æ–¹å¼å°è£…ä¸€ä¸ªfunctionï¼ˆä»»åŠ¡ï¼‰ã€‚é€šè¿‡<code>wrap</code>å°è£…ä»»åŠ¡ä¼šè¿”å›ä¸€ä¸ªçº¯ç²¹çš„luaå‡½æ•°ï¼ˆtypeä¸ºfunctionï¼‰ï¼Œè€Œç”¨<code>create</code>å°è£…åˆ™è¿”å›çš„æ˜¯ä¸€ä¸ªå°è£…å¥½çš„çº¿ç¨‹ã€‚</p>
<p>åœ¨Luaä¸­ï¼Œçº¿ç¨‹threadä¸åç¨‹coroutineçš„æ¦‚å¿µå†…æ¶µæœ‰è¾ƒå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä½†æˆ‘ä»¬å¯ä»¥è®¤ä¸ºï¼Œçº¿ç¨‹æ˜¯æ›´åŠ å®è§‚å¹¿æ³›çš„æ¦‚å¿µï¼Œåç¨‹åˆ™æ˜¯ä¸€ç§ç‰¹æ®Šçš„çº¿ç¨‹ã€‚çº¿ç¨‹å¼ºè°ƒçš„ä¸åŒçš„<code>routine</code>ä¹‹é—´è¿è¡Œæ˜¯å¦ç‹¬ç«‹ï¼›è€Œåç¨‹å¼ºè°ƒçš„åˆ™æ˜¯ä¸åŒ<code>routine</code>ä¹‹é—´å…·æœ‰ç›¸äº’<code>co</code>çš„åä½œåŠŸèƒ½ã€‚</p>
<p>åŸºäºè¿™ä¸¤ç§æ–¹å¼è°ƒåº¦ä»»åŠ¡çš„ä»£ç å†™æ³•å¤§åŒå°å¼‚ã€‚ä»¥ä¸‹ä»¥<code>create</code>å°è£…ä»»åŠ¡ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ä¼šæ˜¯æ€æ ·çš„è¿›è¡Œâ€”â€”</p>
<a id="more"></a>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">(co, ...)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"Info:"</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\tSTATUS:"</span>, coroutine.<span class="built_in">status</span>(co))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\tRUNNING:"</span>, coroutine.<span class="built_in">running</span>())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"\tYIELDABLE:"</span>, coroutine.isyieldable())</span><br><span class="line">    <span class="keyword">if</span> ... <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"Output: "</span>)</span><br><span class="line">        <span class="keyword">for</span> _, v <span class="keyword">in</span> <span class="built_in">ipairs</span>(&#123;...&#125;) <span class="keyword">do</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">""</span>, <span class="built_in">tostring</span>(v))</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"----------------------------------------\n"</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> co</span><br><span class="line"></span><br><span class="line">co = coroutine.<span class="built_in">create</span>(<span class="function"><span class="keyword">function</span><span class="params">(a, b)</span></span></span><br><span class="line">    <span class="keyword">local</span> ab = a + b</span><br><span class="line">    <span class="built_in">output</span>(co)</span><br><span class="line">    <span class="keyword">local</span> c, d = coroutine.<span class="built_in">yield</span>(ab)</span><br><span class="line">    coroutine.<span class="built_in">resume</span>(coroutine.<span class="built_in">create</span>(<span class="function"><span class="keyword">function</span> <span class="params">(co_thread)</span></span> <span class="built_in">output</span>(co_thread) <span class="keyword">end</span>), co)</span><br><span class="line">    <span class="keyword">local</span> cd = c + d</span><br><span class="line">    <span class="built_in">output</span>(co)</span><br><span class="line">    <span class="keyword">local</span> e, f = coroutine.<span class="built_in">yield</span>(cd)</span><br><span class="line">    <span class="built_in">output</span>(co)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tostring</span>(e) .. <span class="built_in">tostring</span>(f)</span><br><span class="line"><span class="keyword">end</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ok1, ret1 = coroutine.<span class="built_in">resume</span>(co, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">output</span>(co, <span class="built_in">tostring</span>(ok1) .. <span class="string">": "</span> .. <span class="built_in">tostring</span>(ret1))</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ok2, ret2 = coroutine.<span class="built_in">resume</span>(co, <span class="number">11</span>, <span class="number">22</span>)</span><br><span class="line"><span class="built_in">output</span>(co, <span class="built_in">tostring</span>(ok2) .. <span class="string">": "</span> .. <span class="built_in">tostring</span>(ret2))</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> ok3, ret3 = coroutine.<span class="built_in">resume</span>(co, <span class="number">111</span>, <span class="number">222</span>)</span><br><span class="line"><span class="built_in">output</span>(co, <span class="built_in">tostring</span>(ok3) .. <span class="string">": "</span> .. <span class="built_in">tostring</span>(ret3))</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†å‡½æ•°<code>output</code>å‡½æ•°è¾“å‡ºå½“å‰å„çº¿ç¨‹çš„çŠ¶æ€ï¼ˆæ™®é€šä¸»çº¿ç¨‹ã€åç¨‹å‡å¯ï¼‰ã€‚åœ¨<code>coroutine</code>ä¸­å°è£…äº†ä»¥ä¸‹çš„åŠŸèƒ½æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ï¼š</p>
<ul>
<li><code>coroutine.status</code>ï¼šæŒ‡å®šä¸€ä¸ªçº¿ç¨‹ï¼Œè¿”å›è¯¥çº¿ç¨‹çš„çŠ¶æ€ï¼Œå¯ä»¥æ˜¯<code>suspendedï¼ˆæ²¡è¿è¡Œï¼Œæˆ–è¢«åˆ‡å‡ºï¼‰</code>ã€<code>runningï¼ˆæ­£åœ¨è¿è¡Œï¼‰</code>ã€<code>deadï¼ˆä»»åŠ¡å®Œæˆï¼Œæˆ–é‡åˆ°é”™è¯¯ï¼‰</code>ä»¥åŠ<code>normalï¼ˆæ­£è°ƒç€å¦å¤–ä¸€ä¸ªåç¨‹ï¼‰</code>å››ç§ä¹‹ä¸€ã€‚</li>
<li><code>coroutine.running</code>ï¼šè¿”å›å½“å‰çº¿ç¨‹ä»¥åŠæ˜¯å¦ä¸ºä¸»çº¿ç¨‹çš„booleanã€‚</li>
<li><code>coroutine.isyieldable</code>ï¼šè¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦å…·æœ‰<code>yield</code>åˆ‡å‡ºåŠŸèƒ½ï¼Œå¦‚æœæ˜¯æ™®é€šä¸»çº¿ç¨‹ï¼Œæˆ–è€…æ˜¯ä¸æ”¯æŒyieldçš„Cç¼–å†™çš„çº¿ç¨‹ï¼Œå°±ä¸èƒ½åˆ‡å‡ºã€‚</li>
</ul>
<p>ä¹‹åå®šä¹‰äº†åç¨‹<code>co</code>ï¼Œé‡‡ç”¨<code>create</code>å°è£…ä¸€ä¸ªä»»åŠ¡ã€‚å°è£…å®Œä¹‹åï¼Œå°±è¯•ç€è·‘ä¸€ä¸‹ã€‚</p>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹æœ€åçš„è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Info:</span><br><span class="line">        STATUS: running</span><br><span class="line">        RUNNING:        thread: 00000000006ee6b8        false</span><br><span class="line">        YIELDABLE:      true</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">Info:</span><br><span class="line">        STATUS: suspended</span><br><span class="line">        RUNNING:        thread: 00000000006e5ef8        true</span><br><span class="line">        YIELDABLE:      false</span><br><span class="line">Output:</span><br><span class="line">        true: 3</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">Info:</span><br><span class="line">        STATUS: normal</span><br><span class="line">        RUNNING:        thread: 00000000006f2e28        false</span><br><span class="line">        YIELDABLE:      true</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">Info:</span><br><span class="line">        STATUS: running</span><br><span class="line">        RUNNING:        thread: 00000000006ee6b8        false</span><br><span class="line">        YIELDABLE:      true</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">Info:</span><br><span class="line">        STATUS: suspended</span><br><span class="line">        RUNNING:        thread: 00000000006e5ef8        true</span><br><span class="line">        YIELDABLE:      false</span><br><span class="line">Output:</span><br><span class="line">        true: 33</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">Info:</span><br><span class="line">        STATUS: running</span><br><span class="line">        RUNNING:        thread: 00000000006ee6b8        false</span><br><span class="line">        YIELDABLE:      true</span><br><span class="line">----------------------------------------</span><br><span class="line"></span><br><span class="line">Info:</span><br><span class="line">        STATUS: dead</span><br><span class="line">        RUNNING:        thread: 00000000006e5ef8        true</span><br><span class="line">        YIELDABLE:      false</span><br><span class="line">Output:</span><br><span class="line">        true: 111222</span><br><span class="line">----------------------------------------</span><br></pre></td></tr></table></figure>
<p>ç„¶åå†åˆ†è§£è¿è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>ä¸»çº¿ç¨‹è°ƒç”¨<code>coroutine.resume(co, 1, 2)</code>å¼€å§‹è¿™ä¸ªåç¨‹ï¼Œå…¶ä¸­<code>1, 2</code>ä¸ºè¾“å…¥å‚æ•°ï¼Œå¯¹åº”ä»»åŠ¡functioné‡Œçš„åˆå§‹å‚æ•°<code>a, b</code>ã€‚</li>
<li>åœ¨åç¨‹ä¸­ï¼ŒæŠŠ<code>1, 2</code>ç›¸åŠ å¾—åˆ°<code>3</code>ç»™<code>ab</code>å˜é‡ï¼Œè€Œå<code>output</code>çº¿ç¨‹çŠ¶æ€ï¼š<code>status(co)</code>è¿”å›äº†<code>running</code>è¡¨ç¤ºåç¨‹<code>co</code>æ­£åœ¨è¿è¡Œï¼Œè€Œ<code>running</code>ä¸<code>isyieldable</code>åˆ™åªå…³å¿ƒå“ªä¸ªçº¿ç¨‹è¿è¡Œäº†å®ƒä»¬ã€‚åœ¨åç¨‹é‡Œï¼Œ<code>running</code>ä¼šè¿”å›åç¨‹åœ°å€ä»¥åŠ<code>false</code>ï¼Œä»£è¡¨ä¸æ˜¯ä¸»çº¿ç¨‹ï¼›è€Œåœ¨ä¸»çº¿ç¨‹é‡Œï¼Œ<code>running</code>ä¼šè¿”å›ä¸»çº¿ç¨‹åœ°å€ä»¥åŠ<code>true</code>ã€‚åŒæ ·ï¼Œåœ¨åç¨‹é‡Œï¼Œ<code>isyieldable</code>ä¼šè¿”å›<code>true</code>è¡¨ç¤ºè¯¥çº¿ç¨‹å¯è¢«<code>yield</code>ï¼Œè€Œåœ¨ä¸»çº¿ç¨‹åˆ™ä¸è¡Œï¼Œä¸º<code>false</code>ã€‚åé¢çš„ç»“æœä¹Ÿéƒ½åŒæ ·ã€‚</li>
<li>è°ƒç”¨<code>coroutine.yield(ab)</code>åˆ‡å‡ºåç¨‹ï¼Œåˆ‡å›ä¸»çº¿ç¨‹ï¼Œè¿™ä¸€é˜¶æ®µè¿”å›çš„ç»“æœä¸º<code>ab</code>ã€‚</li>
<li>ä¸»çº¿ç¨‹è§†è§’ä¸‹ï¼Œ<code>coroutine.resume</code>çš„è¿”å›ç»“æœä¸ºå½“å‰åç¨‹è¿™ä¸€é˜¶æ®µæ˜¯å¦æ²¡æœ‰å¼‚å¸¸ï¼ˆ<code>ok</code>ï¼‰ä»¥åŠåç¨‹<code>yield</code>å‡ºæ¥çš„è¿”å›å€¼ã€‚å› æ­¤<code>ok1</code>ä¸<code>ret1</code>åˆ™ä¸º<code>true</code>è·Ÿ<code>ab</code>ã€‚ä¸»çº¿ç¨‹è°ƒç”¨<code>output</code>å‡½æ•°æŸ¥çœ‹å„ä¸ªçº¿ç¨‹çŠ¶å†µï¼Œå¯ä»¥çœ‹åˆ°<code>status(co)</code>ä¸º<code>suspended</code>ï¼Œåç¨‹<code>co</code>æ­£åœ¨æš‚åœçŠ¶æ€ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡<code>resume</code>ï¼›è€Œç”±äºåœ¨ä¸»çº¿ç¨‹ï¼Œ<code>running</code>ä¸<code>isyieldable</code>åˆ†åˆ«ä¸º<code>true</code>è·Ÿ<code>false</code>ã€‚</li>
<li>ä¸»çº¿ç¨‹è°ƒç”¨<code>coroutine.resume(co, 11, 22)</code>ç»§ç»­è¿™ä¸ªåç¨‹ã€‚åœ¨åç¨‹<code>co</code>çš„è§†è§’ä¸‹ï¼Œ<code>local c, d = coroutine.yield(ab)</code>ä¸­çš„<code>c, d</code>ï¼Œå³ä¸º<code>resume</code>å®ƒçš„çº¿ç¨‹ä¼ è¿›æ¥çš„ä¸¤ä¸ªå‚æ•°ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯<code>11, 22</code>äº†ã€‚</li>
<li>åç¨‹<code>co</code>åˆè°ƒèµ·å¦ä¸€ä¸ªåç¨‹ï¼Œåœ¨å¦ä¸€ä¸ªåç¨‹è°ƒç”¨<code>output</code>æ¥çœ‹åŸæ¥åç¨‹<code>co</code>çš„<code>status</code>ã€‚å˜›ï¼Œè¿™ä¸€æ­¥åªæ˜¯ä¸ºäº†åŠ ä¸€ä¸ª<code>status == &quot;normal&quot;</code>çš„ä¾‹å­ã€‚</li>
<li>æŠŠ<code>11 + 22</code>çš„ç»“æœ<code>33</code>ç»™<code>cd</code>ï¼Œç„¶å<code>output</code>çº¿ç¨‹çŠ¶æ€ï¼Œç»“æœä¸æ­¥éª¤2ç›¸ä¼¼ã€‚è€Œåï¼Œå†æŠŠ<code>cd</code>ç»™<code>yield</code>åˆ‡å‡ºå»ã€‚</li>
<li>ä¸»çº¿ç¨‹æ”¶åˆ°è¿”å›å€¼<code>ok2 = true</code>ä»¥åŠ<code>ret2 = 33</code>ï¼Œè€Œåå†<code>output</code>ï¼Œç»“æœä¹Ÿä¸æ­¥éª¤4ç›¸ä¼¼ã€‚</li>
<li>ä¸»çº¿ç¨‹å†æ¬¡<code>resume</code>åç¨‹<code>co</code>ï¼Œè¾“å…¥å‚æ•°<code>111, 222</code>ç»™åç¨‹ä¸­çš„<code>e, f</code>ï¼Œåç¨‹å†…éƒ¨<code>output</code>çŠ¶æ€åï¼Œæœ€ç»ˆè¿”å›äº†å­—ç¬¦ä¸²<code>111222</code>ï¼Œåç¨‹ä»»åŠ¡ç»“æŸã€‚æ­¤æ—¶ä¸»çº¿ç¨‹ä¸­è°ƒç”¨<code>output(co)</code>ï¼Œå¯ä»¥çœ‹åˆ°<code>co</code>çš„çŠ¶æ€å·²ç»ä¸º<code>dead</code>ã€‚ç”±äºåç¨‹<code>co</code>æ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆ<code>dead</code>å°±è¡¨ç¤ºåç¨‹æ‰€æœ‰çš„å­ä»»åŠ¡éƒ½ç»“æŸå•¦~</li>
</ol>
<p>è‡³æ­¤ï¼Œæ•´ä¸€ä¸ª<code>coroutine.create</code>çš„ä¾‹å­å·²ç»å®Œæˆã€‚è€Œå¯¹äº<code>coroutine.wrap</code>ï¼Œç”±äºè¿”å›çš„æ˜¯ä¸€ä¸ªluaå‡½æ•°è€Œéçº¿ç¨‹ï¼Œå› æ­¤éœ€è¦é€šè¿‡<code>pcall</code>ç­‰æ‰‹æ®µæ•è·é”™è¯¯ï¼Œä»è€Œä¸è‡³äºæ–­æ‰ä¸»çº¿ç¨‹è¿è¡Œã€‚æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥ä¸€æ¢ç©¶ç«Ÿ~</p>
<h2 id="coroutineä¸åç«¯æ´‹è‘±åœˆæ¨¡å‹"><a href="#coroutineä¸åç«¯æ´‹è‘±åœˆæ¨¡å‹" class="headerlink" title="coroutineä¸åç«¯æ´‹è‘±åœˆæ¨¡å‹"></a>coroutineä¸åç«¯æ´‹è‘±åœˆæ¨¡å‹</h2><p><code>coroutine</code>çš„é‡ç‚¹åœ¨äº<code>co</code>ï¼Œåœ¨å®˜ç½‘ä¸Šï¼Œä¹Ÿæœ‰<span class="exturl" data-url="aHR0cHM6Ly93d3cubHVhLm9yZy9waWwvOS4zLmh0bWw=" title="https://www.lua.org/pil/9.3.html">æ’åˆ—ç»„åˆ<i class="fa fa-external-link"></i></span>ã€<span class="exturl" data-url="aHR0cHM6Ly93d3cubHVhLm9yZy9waWwvOS4yLmh0bWw=" title="https://www.lua.org/pil/9.2.html">ç”Ÿäº§è€…â€”â€”æ¶ˆè´¹è€…<i class="fa fa-external-link"></i></span>ç­‰è¡¨ç°ååŒä»»åŠ¡çš„ä¾‹å­ã€‚ä¸è¿‡æœ¬æ–‡åˆ™è¦æ¬å‡ºæˆ‘ä»¬çš„è€æœ‹å‹â€”â€”åç«¯çš„æ´‹è‘±åœˆæ¨¡å‹ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/luatalk/coroutine/onion.png" alt="æ´‹è‘±åœˆæ¨¡å‹" title="&#39;æ´‹è‘±åœˆæ¨¡å‹&#39;"></p>
<p>åç«¯å¯¹äºæ•°æ®è§„èŒƒã€å®‰å…¨æ€§ç­‰æ˜¯ç›¸å½“æœ‰è¦æ±‚çš„ã€‚æ¯”å¦‚ä¸€ä¸ªè·å–æ•°æ®çš„è¯·æ±‚åˆ°è¾¾åç«¯ï¼Œé¦–å…ˆéƒ½è¦ç»è¿‡é‡é‡å…³å¡æ£€æŸ¥è¯·æ±‚çš„åˆæ³•æ€§ï¼Œè€Œååç«¯æ§åˆ¶å™¨æ‰è°ƒç”¨æœåŠ¡å–å‡ºæ•°æ®ï¼Œæœ€åè¿”å›æ—¶ï¼Œè¿˜å¾—å†ä¸€ä¸ªä¸ªå…³å¡ä¸¥æŸ¥ï¼Œæ‰èƒ½æŠŠè¯¥å¸¦çš„æ•°æ®å¸¦å‡ºå»ã€‚æ´‹è‘±åœˆæ¨¡å‹çš„æ•°æ®å¤„ç†æµæ°´çº¿ï¼Œä¾¿æ˜¯å¦‚æ­¤ã€‚</p>
<p>æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­æ¥è¯•è¯•å§~</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">middleware_header</span><span class="params">(ctx)</span></span></span><br><span class="line">    ctx.header[<span class="string">"user-agent"</span>] = <span class="string">"ShangQi"</span></span><br><span class="line">    ctx.header[<span class="string">"referer"</span>] = <span class="string">"America"</span></span><br><span class="line">    coroutine.<span class="built_in">yield</span>()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">middleware_body</span><span class="params">(ctx)</span></span></span><br><span class="line">    ctx.body.data = <span class="string">"Chinese Hero"</span></span><br><span class="line">    coroutine.<span class="built_in">yield</span>()</span><br><span class="line">    <span class="keyword">if</span> ctx.body.data ~= <span class="string">"Chinese Hero"</span> <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">print</span>(ctx.header[<span class="string">"user-agent"</span>] .. <span class="string">" is not a Chinese Hero!"</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">controller</span><span class="params">(ctx)</span></span></span><br><span class="line">    <span class="keyword">if</span> ctx.header[<span class="string">"referer"</span>] ~= <span class="string">"China"</span> <span class="keyword">then</span></span><br><span class="line">        ctx.body.data = <span class="string">"You are not Chinese!"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> context = &#123; header = &#123;&#125;, body = &#123;&#125; &#125;</span><br><span class="line">handle(context, middleware_header, middleware_body, controller)</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªåœºæ™¯é‡Œï¼Œæˆ‘ä»¬è¦å¤„ç†çš„æ•°æ®å«<code>context</code>ã€‚<code>context</code>å…ˆç»è¿‡ä¸¤ä¸ª<code>middleware</code>ä¸­é—´ä»¶<code>header</code>ä¸<code>body</code>ï¼Œé€šè¿‡ä¸¤ä¸ªå…³å¡ï¼Œæ‰è¿›å…¥åˆ°æ­£å¼çš„æŒæƒç«¯<code>controller</code>ã€‚</p>
<p>åœ¨<code>header</code>ä¸­é—´ä»¶ä¸­ï¼Œ<code>context</code>ä¸ºè‡ªå·±çš„<code>header</code>åŠ ä¸Šäº†ä¸¤ä¸ªå¤´è¡”ï¼š<code>user-agent</code>è¡¨ç¤ºç”¨æˆ·ä»£ç†èº«ä»½ï¼Œè¿™é‡Œå«åš<code>ShangQi</code>ï¼›<code>referer</code>è¡¨ç¤ºä»å“ªé‡Œæ¥ï¼Œè¿™é‡Œå«åš<code>America</code>ã€‚</p>
<p>åœ¨<code>body</code>ä¸­é—´ä»¶ä¸­ï¼Œ<code>context</code>ä¸ºè‡ªå·±çš„<code>body</code>åŠ ä¸Šäº†<code>Chinese Hero</code>çš„æ•°æ®ï¼Œç„¶ååˆ‡å‡ºä¸ç®¡ï¼Œå¹¶ä¸”æ‰“èµŒï¼Œå¦‚æœåˆ‡å›æ¥ä¸æ˜¯<code>Chinese Hero</code>çš„è¯ï¼Œå°±å‘Šè¯‰å…¨ä¸–ç•Œï¼Œè¿™ä¸ª<code>user-agent</code>èº«ä»½ä¸èƒ½ä»£è¡¨<code>Chinese Hero</code>ã€‚</p>
<p>ä½†åœ¨çœŸæ­£æŒæ¡æ§åˆ¶å¤§æƒçš„<code>controller</code>ä¸­ï¼Œåˆ™ä¸ä¼šä¸ºæ ‡æ¦œ<code>Chinese Hero</code>çš„éä¸­å›½äººä¹°å•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ShangQi is not a Chinese Hero!</span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼Œæ€æ ·å®ç°è¿™ä¸€è¿‡ç¨‹å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹æ•´ä¸€ä¸ªä»£ç ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">(ctx, ...)</span></span></span><br><span class="line">    <span class="keyword">local</span> handlers = &#123;&#125;</span><br><span class="line">    <span class="keyword">local</span> args = <span class="built_in">table</span>.pack(...)</span><br><span class="line">    <span class="comment">-- æ£€æŸ¥é•¿åº¦</span></span><br><span class="line">    <span class="keyword">if</span> #args == <span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>, <span class="string">"Error! Expected at least one handler (controller) for context!"</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- æŠŠmiddlewareè·Ÿcontrollerç”¨coroutine.createå°è£…ï¼Œæ’å…¥åˆ°handlersä¸­</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, #args <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">type</span>(args[i]) == <span class="string">"function"</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>, <span class="string">"Error! Handler "</span> .. <span class="built_in">tostring</span>(i) .. <span class="string">" is not a function!"</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">table</span>.<span class="built_in">insert</span>(handlers, coroutine.<span class="built_in">create</span>(args[i]))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- å®¢æˆ·ç«¯ --&gt; middlewareï¼ˆä¸ŠåŠéƒ¨åˆ†ï¼‰ --&gt; controller</span></span><br><span class="line">    <span class="keyword">for</span> i = <span class="number">1</span>, #handlers <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> ok, err = coroutine.<span class="built_in">resume</span>(handlers[i], ctx)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> tag = <span class="string">"controller"</span></span><br><span class="line">            <span class="keyword">if</span> i ~= #handlers <span class="keyword">then</span></span><br><span class="line">                tag = <span class="string">"middleware #"</span> .. <span class="built_in">tostring</span>(i)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>, <span class="string">"Error at "</span> .. tag .. <span class="string">"! "</span> .. err</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- ç§»é™¤controller</span></span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">remove</span>(handlers)</span><br><span class="line">    <span class="comment">-- å®¢æˆ·ç«¯ &lt;-- middlewareï¼ˆä¸‹åŠéƒ¨åˆ†ï¼‰ &lt;-- controller</span></span><br><span class="line">    <span class="keyword">while</span> #handlers &gt; <span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> co = <span class="built_in">table</span>.<span class="built_in">remove</span>(handlers)</span><br><span class="line">        <span class="keyword">if</span> coroutine.<span class="built_in">status</span>(co) == <span class="string">"suspended"</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> ok, err = coroutine.<span class="built_in">resume</span>(co, ctx)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> ok <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>, <span class="string">"Error at middleware #"</span> .. <span class="built_in">tostring</span>(#handlers + <span class="number">1</span>) .. <span class="string">"! "</span> .. err</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">-- strict mode, call coroutine.yield() forcibly</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>, <span class="string">"Error at middleware #"</span> .. <span class="built_in">tostring</span>(#handlers + <span class="number">1</span>) .. <span class="string">"! Please cast coroutine.yield() in strict mode!"</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>, <span class="literal">nil</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„ä¸­é—´ä»¶ä¸æ§åˆ¶å™¨å¤„ç†ä»»åŠ¡éƒ½å°è£…æˆåç¨‹ï¼Œç„¶åå…¥æ ˆï¼ˆ<code>table.insert</code>ï¼‰ã€‚æœ€åä¸€ä¸ªå¤„ç†è€…ï¼ˆhandlerï¼‰ï¼Œä¹Ÿå°±æ˜¯æ§åˆ¶å™¨å¤„ç†å®Œæ¯•åï¼Œå¼€å§‹å°†ä¸€ä¸ªä¸ªåç¨‹popï¼ˆ<code>table.remove</code>ï¼‰å‡ºæ¥ï¼Œå†<code>resume</code>ï¼Œè¿™æ ·ï¼Œå°±èƒ½å¤Ÿæ¨¡æ‹Ÿæ´‹è‘±åœˆæ¨¡å‹çš„æ“ä½œäº†ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>luaçš„coroutineéå¸¸çµæ´»ã€‚é…åˆå„ç§åº•å±‚æ¶æ„ï¼Œå¯ä»¥ç©å‡ºå¾ˆå¤šç§ä¸åŒçš„èŠ±æ ·ã€‚å¤šä¸Šæ‰‹è¯•è¯•å§~</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>å¼‚æ­¥</tag>
        <tag>lua</tag>
        <tag>coroutine</tag>
        <tag>åç¨‹</tag>
        <tag>æ´‹è‘±åœˆæ¨¡å‹</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘iOSå®¡æ ¸&amp;é™æ€æ‰«æäºŒä¸‰äº‹</title>
    <url>/2019/08/19/testlife/ios_review/</url>
    <content><![CDATA[<p>æˆ‘ä»¬çš„æ—¥å¸¸ç”Ÿæ´»ç¦»ä¸å¼€æ‰‹æœºï¼Œæœ‰äº›åŒå­¦å–œæ¬¢ç”¨å›½äº§çš„å®‰å“æœºï¼Œè€Œå¦ä¸€äº›åŒå­¦å–œæ¬¢ç”¨ç®€çº¦çš„iPhoneã€‚</p>
<p>å¯¹æ¯”å®‰å“å’ŒiOSçš„è½¯ä»¶ç”Ÿæ€ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼šå®‰å“è½¯ä»¶çš„æŠ•æ”¾æ¸ é“ç¹å¤šï¼Œé¢˜æèŠ±æ ·ç¹å¤ï¼Œè´¨é‡å¤§å°ä¸ä¸€ï¼Œè€ŒiOSçš„æŠ•æ”¾æ¸ é“åˆ™ä¸ºApp Storeç‹¬å®¶ï¼Œç›¸å¯¹å®‰å“è½¯ä»¶æ¥è®²ï¼Œä¸ä»…è´¨é‡å‡è¡¡ï¼Œè€Œä¸”ç”¨æˆ·ä¸å¿…æ‹…å¿ƒæ‰‹æœºç—…æ¯’çš„å›°æ‰°ã€‚è¿™ä¸€ç‚¹ï¼Œå°±å½’åŠŸäºApp Storeä¸¥æ ¼çš„å®¡æ ¸åˆ¶åº¦ã€‚</p>
<a id="more"></a>
<p>åœ¨iOS Appçš„ç ”å‘æµç¨‹ä¸­ï¼Œæå®¡iOSåŒ…çš„ç¯èŠ‚ï¼Œä¸€èˆ¬ç”±è¿è¥ç»„å®Œæˆã€‚åœ¨æ­£å¼æå®¡è‡³App Storeå‰ï¼Œè¿è¥ç»„å¯èƒ½ä¼šå¯¹ç ”å‘äº¤ä»˜iOSåŒ…åšäººå·¥/é™æ€æ‰«ææ£€æŸ¥ï¼Œä»è€Œè¯†åˆ«å¹¶ä¿®å¤æå®¡åŒ…å­˜åœ¨çš„è¿è§„æƒ…å†µã€‚ç”±äºiOSå®¡æ ¸è§„åˆ™ä¸¥å‰ï¼Œå‘¨æœŸè¾ƒé•¿ï¼Œå¦‚æœè¢«ä¸€æ¬¡æ‰“å›çš„è¯ï¼Œåé¢å†ç­‰ä¸Šæ¶æˆåŠŸå¯å°±è€½è¯¯æ—¶é—´äº†ã€‚å› æ­¤å¯¹iOSåº”ç”¨ä¸Šæ¶è€Œè¨€ï¼Œé¢„å®¡æ­¥éª¤æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p>
<p>æµ‹è¯•ï¼ˆè´¨é‡ä¿éšœï¼‰çš„å·¥ä½œä¹‹ä¸€ä¾¿æ˜¯ä¿è¯ç ”å‘äº¤ä»˜çš„æ•ˆç‡ã€‚ç”±äºiOSå®¡æ ¸æ‰“å›å¯¹äº¤ä»˜æµç¨‹çš„é˜»å¡è¾ƒå¤§ï¼Œå› æ­¤å®æ–½æµ‹è¯•å·¦ç§»ï¼Œå°†éƒ¨åˆ†iOSé¢„å®¡æµç¨‹ç§»è‡³äº¤ä»˜è¿è¥å‰å®ç°ï¼Œè¿™æ ·ä¾¿èƒ½å¤Ÿå¢åŠ æ›´æ—©å‘ç°è‡ªå®¶äº§å“è¿è§„çš„æ¦‚ç‡ã€‚è‹¹æœçš„å®¡æ ¸æµç¨‹é€šå¸¸ä¼šåŒ…æ‹¬æœºå®¡ä¸äººå®¡ä¸¤å¤§å—ï¼Œä¸ºäº†å‡å°‘å·¥ä½œæˆæœ¬ï¼Œå¼•å…¥æ¨¡æ‹Ÿæœºå®¡æµç¨‹â€”â€”ipaåŒ…é™æ€æ‰«æï¼Œæ˜¯æœ€ä¸ºå¸¸è§çš„åšæ³•ã€‚</p>
<p>é™æ€æ‰«æçš„ç›®çš„æ˜¯æ£€æµ‹æå®¡åŒ…èµ„æºçš„å®Œæ•´æ€§ä¸åˆæ³•æ€§ã€‚<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2NuL2FwcC1zdG9yZS9yZXZpZXcvZ3VpZGVsaW5lcy8=" title="https://developer.apple.com/cn/app-store/review/guidelines/">App Storeå®¡æ ¸æŒ‡å—<i class="fa fa-external-link"></i></span>ä¸ºiOSå¼€å‘è€…ä»¬æä¾›äº†Appå®¡æ ¸çš„å‚è€ƒï¼Œè€Œé™æ€æ‰«æè¿™ä¸€å—ï¼Œåˆ™ä¸»è¦å…³å¿ƒç¬¬äºŒç±»ï¼ˆæ€§èƒ½ï¼‰ä»¥åŠç¬¬å››ç±»ï¼ˆè®¾è®¡ï¼‰ç­‰ç›¸å…³å‡†åˆ™ï¼Œå…¶å®ƒçš„æ¨¡å—è¦é¢„å®¡çš„è¯ï¼Œéœ€è¦åŠ æŒäººåŠ›å¾—ä»¥ç¡®è®¤ã€‚</p>
<p>ipaåŒ…æœ¬è´¨æ˜¯ä¸€ä¸ªzipåŒ…ã€‚å¦‚æœæœ‰åŒå­¦å¥½å¥‡æ‹†è¿‡çš„è¯ï¼Œå¯ä»¥çœ‹åˆ°ipaåŒ…åŒ…å«äº†è®¸å¤šå†…å®¹ï¼š</p>
<ul>
<li>Info.plist å…ƒæ•°æ®</li>
<li>_CodeSignature æ•°å­—ç­¾å</li>
<li>AppIcon å›¾æ ‡</li>
<li>äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>et cetera</li>
</ul>
<p>å¯¹äºé™æ€æ‰«æï¼Œåˆ™è‡³å°‘éœ€è¦æ£€æŸ¥ä»¥ä¸‹çš„ç‚¹ï¼š</p>
<ul>
<li>å…ƒæ•°æ®ï¼šå…ƒæ•°æ®çš„æ¡ä¾‹ç¹å¤šï¼Œéœ€è¦å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2xpYnJhcnkvYXJjaGl2ZS9kb2N1bWVudGF0aW9uL0dlbmVyYWwvUmVmZXJlbmNlL0luZm9QbGlzdEtleVJlZmVyZW5jZS9BcnRpY2xlcy9BYm91dEluZm9ybWF0aW9uUHJvcGVydHlMaXN0RmlsZXMuaHRtbCMvL2FwcGxlX3JlZi9kb2MvdWlkL1RQNDAwMDkyNTQtU1cx" title="https://developer.apple.com/library/archive/documentation/General/Reference/InfoPlistKeyReference/Articles/AboutInformationPropertyListFiles.html#//apple_ref/doc/uid/TP40009254-SW1">About Information Property List Files<i class="fa fa-external-link"></i></span>é€é¡¹æ£€æŸ¥</li>
<li>è¯ä¹¦ï¼šéœ€è¦ç»“åˆå…ƒæ•°æ®æ£€æŸ¥ï¼Œä¿è¯è¯ä¹¦æœ‰æ•ˆæœŸï¼Œå¹¶ä¸”ä¸ºæ˜¯App Storeçš„å‘å¸ƒç‰ˆæœ¬</li>
<li>å›¾ç‰‡ï¼šéœ€è¦ä¿è¯æœ‰ç‰¹å®šè§„æ ¼çš„å›¾ç‰‡å­˜åœ¨ï¼Œå‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYXBwbGUuY29tL2Rlc2lnbi9odW1hbi1pbnRlcmZhY2UtZ3VpZGVsaW5lcy9pb3Mvb3ZlcnZpZXcvdGhlbWVzLw==" title="https://developer.apple.com/design/human-interface-guidelines/ios/overview/themes/">Human Interface Guidelines<i class="fa fa-external-link"></i></span></li>
<li>äºŒè¿›åˆ¶æ–‡ä»¶ï¼šéœ€è¦ä¿è¯<span class="exturl" data-url="aHR0cHM6Ly9oZWxwLmFwcGxlLmNvbS9hcHAtc3RvcmUtY29ubmVjdC8/bGFuZz16aC1jbiMvZGV2NjExZTBhMjFm" title="https://help.apple.com/app-store-connect/?lang=zh-cn#/dev611e0a21f">è§„æ ¼<i class="fa fa-external-link"></i></span>ï¼Œä»¥åŠä¸å¾—åŒ…å«å®˜æ–¹ç¦æ­¢å¼€å‘è€…ç›´æ¥ä½¿ç”¨çš„apiã€‚äºŒè¿›åˆ¶æ–‡ä»¶çš„æ‰«æï¼Œç›¸å½“äºå¯¹iOSå¯æ‰§è¡Œæ–‡ä»¶çš„é€†å‘ã€‚å› æ­¤ï¼Œéœ€è¦å¯¹å¯æ‰§è¡Œæ–‡ä»¶<span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8yZWIzNTFiMGNlNTc=" title="https://www.jianshu.com/p/2eb351b0ce57">mach-o<i class="fa fa-external-link"></i></span>çš„ç»“æ„ä»¥åŠç›¸å…³é€†å‘å·¥å…·ï¼ˆæ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xvdmVjaHJpczAwL2FydGljbGUvZGV0YWlscy84MTU2MTYyNw==" title="https://blog.csdn.net/lovechris00/article/details/81561627">otool<i class="fa fa-external-link"></i></span>ï¼‰çš„ä½¿ç”¨è¿›è¡Œç†Ÿæ‚‰</li>
</ul>
<p>ä»æ•´ä¸ªAppçš„å®¡æ ¸æ¥çœ‹ï¼Œç›¸å¯¹äºäººå·¥æ£€æŸ¥ï¼Œé™æ€æ‰«æçš„å®¡æ ¸ç‚¹è¦†ç›–åº¦ç›¸å¯¹è¾ƒä½ï¼Œä½†å´å¯ä»¥å¯¹ç›´æ¥å¯¹æŸäº›å®¡æ ¸ç—›ç‚¹ï¼ˆæ¯”å¦‚ç¦æ­¢apiï¼‰è¿›è¡Œæ£€æµ‹ã€‚å› æ­¤ï¼Œèªæ˜çš„ä½ ï¼Œä¹Ÿä¸€èµ·æ¥å’Œè‹¹æœæ–—æ™ºæ–—å‹‡å§~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æµ‹è¯•</tag>
        <tag>iOS</tag>
        <tag>App Store</tag>
        <tag>é™æ€æ‰«æ</tag>
        <tag>iOSå®¡æ ¸</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘å®‰å“è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·SoloPi</title>
    <url>/2019/08/11/githubdiscovery/solopi/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>éšç€MTSC2019çš„å¬å¼€ï¼Œå…«æœˆä»½å„ç§æµ‹è¯•å·¥å…·ç›¸ç»§å¼€æºï¼Œå…¶ä¸­ä¸€æ¬¾åä¸º<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsaXBheS9Tb2xvUGk=" title="https://github.com/alipay/SoloPi">SoloPi<i class="fa fa-external-link"></i></span>çš„å®‰å“è‡ªåŠ¨åŒ–æµ‹è¯•åœ¨æœˆtrendingæ¦œä¸­æ’ä½é å‰ã€‚ç§»åŠ¨Appè‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯å½“å‰æµ‹è¯•é¢†åŸŸçš„é£å£ä¹‹ä¸€ï¼Œå¹¶ä¸”è¦å¼€å‘ä¸€æ¬¾å…¼å®¹æ€§å¥½ã€éœ€æ±‚é€‚åº”å¤šæ ·çš„Appï¼Œä¹Ÿå¹¶éä¸‰æ—¥ä¹‹å¯’ã€‚ä¸ºæ­¤ï¼Œæ¬¢è¿æœ¬æœŸGitHubæ¢ç´¢çš„ä¸»è§’â€”â€”SoloPiï¼</p>
<p>æµ‹è¯•ç¯å¢ƒä¸ºåä¸ºP20Proï¼Œå®‰å“ç‰ˆæœ¬8.1.0ï¼ŒSoloPiç‰ˆæœ¬ä¸º0.9.1ï¼Œä¸‹è½½åœ°å€å¯è¿›å…¥<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsaXBheS9Tb2xvUGkvcmVsZWFzZXM=" title="https://github.com/alipay/SoloPi/releases">GitHub Release<i class="fa fa-external-link"></i></span>æŸ¥çœ‹ã€‚ç”±äºåªæœ‰ä¸€ä¸ªæµ‹è¯•æœºï¼Œæ‰€ä»¥æœ¬æ¬¡ä»…æµ‹è¯•SoloPiçš„æ€§èƒ½æµ‹è¯•ä»¥åŠå½•åˆ¶å›æ”¾åŠŸèƒ½ã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬å¼€å§‹è¯•æ°´å§~</p>
<a id="more"></a>
<p><img src="/uploads/githubdiscovery/solopi/main.png" alt="SoloPiä¸»ç•Œé¢"></p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>é¦–å…ˆéœ€è¦å‡†å¤‡adbï¼Œåœ¨<span class="exturl" data-url="aHR0cHM6Ly9kZXZlbG9wZXIuYW5kcm9pZC5jb20vc3R1ZGlvL3JlbGVhc2VzL3BsYXRmb3JtLXRvb2xz" title="https://developer.android.com/studio/releases/platform-tools">å®˜ç½‘SDK Platform Tools<i class="fa fa-external-link"></i></span>å³å¯ä¸‹è½½åˆ°ã€‚ä¸‹è½½åè§£å‹ï¼ŒæŠŠ<code>platform-tools</code>ç›®å½•è®¾ç½®ä¸ºç¯å¢ƒå˜é‡<code>ANDROID_SDK</code>ï¼Œç„¶åå†åŠ åˆ°<code>PATH</code>ä¸­ï¼Œè¿™æ ·ä¸€æ–¹é¢å¯ä»¥è¢«SoloPiè¯†åˆ«ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥ç›´æ¥cmd adbäº†ã€‚</p>
<p>æ‰‹æœºUSBæ¥é€šåï¼Œé€šè¿‡<code>adb devices</code>å¯ä»¥çœ‹åˆ°å·²ç»è¿æ¥ä¸Šçš„ç»ˆç«¯ã€‚è€ŒåæŒ‰ç…§SoloPiçš„æŒ‡ç¤ºå¼€å¯æƒé™orå¼€å¯adbçš„WIFIè°ƒè¯•å³å¯</p>
<h2 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h2><p>ä¸åŒäºä¼ ç»Ÿçš„é€šè¿‡nativeå¯¼å‡ºæ€§èƒ½æ•°æ®åˆ°PCç«¯çš„æ–¹å¼ï¼ŒSoloPiåœ¨ç§»åŠ¨ç«¯å†…éƒ¨æä¾›å›¾å±‚æŸ¥çœ‹å„é¡¹æ€§èƒ½æ•°æ®ã€‚SoloPiæ”¯æŒçš„æ€§èƒ½æŒ‡æ ‡æå…¶å®Œå–„ï¼Œå¹¶ä¸”æä¾›åŠ å‹çš„æ“ä½œä»¥æ¨¡æ‹Ÿå¼±ç½‘ç­‰åœºæ™¯ï¼Œéå¸¸fitå„ç±»æµ‹è¯•çš„éœ€æ±‚ã€‚</p>
<p><img src="/uploads/githubdiscovery/solopi/profile.png" alt="SoloPiæ€§èƒ½æµ‹è¯•"></p>
<p>ä»¥çš‡å®¤æˆ˜äº‰ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­å³æ—¶åœ°æŸ¥çœ‹æ€§èƒ½æ•°æ®ï¼š</p>
<p><img src="/uploads/githubdiscovery/solopi/profile_cr.png" alt="çš‡å®¤æˆ˜äº‰æ€§èƒ½"></p>
<p>å¦‚æœéœ€è¦æœ‰è®°å½•æ€§èƒ½æ•°æ®çš„éœ€æ±‚ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨SoloPiæä¾›çš„å½•åˆ¶åŠŸèƒ½ã€‚å½•åˆ¶å®Œæˆåï¼Œå¯ä»¥åœ¨SoloPiç•Œé¢é‡ŒæŸ¥çœ‹å½•åˆ¶æ•°æ®ï¼š</p>
<p><img src="/uploads/githubdiscovery/solopi/profile_cr_record.png" alt="çš‡å®¤æˆ˜äº‰æ€§èƒ½å½•åˆ¶"></p>
<p>ç”±äºç§»åŠ¨Appçš„é™åˆ¶ï¼Œåœ¨æ€§èƒ½æ•°æ®æ›²çº¿ä¸å®é™…æ“ä½œçš„å…³è”è¿™ä¸€å—ï¼ŒSoloPiä»ç„¶å…·æœ‰å±€é™æ€§ã€‚ä½†æ˜¯æˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„å½•åˆ¶å›æ”¾åŠŸèƒ½ï¼Œå¯ä»¥ç¨å¾®å¼¥è¡¥è¿™æ–¹é¢çš„ä¸è¶³</p>
<h2 id="å½•åˆ¶å›æ”¾"><a href="#å½•åˆ¶å›æ”¾" class="headerlink" title="å½•åˆ¶å›æ”¾"></a>å½•åˆ¶å›æ”¾</h2><p>SoloPiæœ€å¼•äººæ³¨ç›®çš„åŠŸèƒ½å½“å±å½•åˆ¶å›æ”¾ã€‚å½•åˆ¶å›æ”¾åŠŸèƒ½å¯¹Native Appæ”¯æŒè¾ƒå¥½ï¼Œç»“åˆå®‰å“æ§ä»¶ç›‘æµ‹ä¸å›¾åƒè¯†åˆ«æŠ€æœ¯è¯†åˆ«UIä»è€Œè®°å½•ç”¨æˆ·æ“ä½œã€‚</p>
<p>ä»¥ä¹æ¸¸ä¸ºä¾‹ï¼Œæˆ‘ä»¬çš„å½•åˆ¶ç•Œé¢å¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/githubdiscovery/solopi/record_9game.png" alt="ä¹æ¸¸å½•åˆ¶"></p>
<p>å½•åˆ¶åŠŸèƒ½ä¸ä»…æ”¯æŒåŸºæœ¬çš„ç”¨æˆ·æ“ä½œï¼ˆæ‹–æ‹½ã€ç‚¹å‡»ã€é•¿æŒ‰ã€è¾“å…¥ï¼‰åŠæ“ä½œçš„æ¡ä»¶ç•Œå®šï¼ˆexistsï¼Ÿassertï¼Ÿmatch stringï¼Ÿï¼‰ï¼Œè€Œä¸”æ”¯æŒç³»ç»ŸæŒ‰é”®ã€gcã€adbç­‰æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå½“åšç§»åŠ¨ç«¯WebDriveræ¥ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨å½•åˆ¶è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨æ€§èƒ½å½•åˆ¶ï¼Œä»è€Œå°†æ€§èƒ½æ•°æ®ä¸æµ‹è¯•è¿‡ç¨‹å…³è”ã€‚</p>
<p>å½•åˆ¶åŠŸèƒ½é‡‡ç”¨ç”¨æˆ·æŒ‡å®šæ“ä½œ+æ‰§è¡Œçš„æœºåˆ¶ï¼Œå› æ­¤ä¼šæœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œæ¯”å¦‚å¯¹äºå³æ—¶æ€§è¾ƒå¼ºçš„æ¸¸æˆï¼ˆCRä¹‹ç±»ï¼‰è€Œè¨€ï¼Œå°±ä¸èƒ½æ»¡è¶³æµ‹è¯•çš„éœ€æ±‚ã€‚ä½†å¯¹äºä¸€èˆ¬çš„Appè€Œè¨€ï¼Œæ˜¯ç»°ç»°æœ‰ä½™çš„ã€‚</p>
<p>å½•åˆ¶å®Œæ¯•åï¼Œæˆ‘ä»¬å¯ä»¥ç¼–è¾‘å½•åˆ¶çš„ç”¨ä¾‹ï¼š</p>
<p><img src="/uploads/githubdiscovery/solopi/case_edit.png" alt="ç”¨ä¾‹ç¼–è¾‘"></p>
<p>ç¼–è¾‘ç”¨ä¾‹çš„æ“ä½œï¼Œå¯¹äºä¸ç†Ÿæ‚‰å®‰å“Appçš„åŒå­¦æ¥è¯´ä¼šæœ‰ä¸ä½çš„å£å’ã€‚å¦‚æœæˆ‘ä»¬ç¡®å®šç”¨åŠ›æµç¨‹ï¼Œä¾¿å¯ä»¥ç‚¹å‡»å›æ”¾ã€‚æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å›æ”¾çš„ç»“æœä»¥åŠæ¯ä¸ªæ­¥éª¤çš„ç»†èŠ‚ï¼Œä»è€Œæ’æŸ¥ç”¨ä¾‹ä¸­å­˜åœ¨çš„é—®é¢˜ï¼š</p>
<p><img src="/uploads/githubdiscovery/solopi/case_result.png" alt="å›æ”¾ç»“æœ"></p>
<p><img src="/uploads/githubdiscovery/solopi/case_step.png" alt="ç”¨ä¾‹æ­¥éª¤"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>SoloPiæ‰€æ”¯æŒçš„åŠŸèƒ½æ»¡è¶³äº†å¤§é‡ç§»åŠ¨ç«¯æµ‹è¯•çš„éœ€æ±‚ï¼Œåœ¨è‡ªåŠ¨åŒ–æ–¹é¢å·²ç»æ‰“é€šäº†ç”¨ä¾‹å½•åˆ¶ã€æ€§èƒ½å½•åˆ¶ä»¥åŠç”¨ä¾‹ç®¡ç†ä¸‰å—ã€‚å®é™…å…¥æ‰‹å°è¯•æ¥çœ‹ï¼Œé™¤äº†åœ¨ç”¨ä¾‹ç®¡ç†ä»¥åŠç¼–è¾‘æ–¹é¢ä¼šæœ‰ç•¥å¾®ä¸ä¾¿æ·çš„åœ°æ–¹ä¹‹å¤–ï¼Œå…¶å®ƒçš„æµ‹è¯•éœ€æ±‚éƒ½éå¸¸é¡ºåˆ©ï¼Œèƒ½å¤Ÿå‡å°‘äº†ä¸šåŠ¡æµ‹è¯•äººå‘˜è‡ªåŠ¨åŒ–ç¼–å†™çš„æˆæœ¬ï¼Œæ˜¯éå¸¸æœ‰ä»·å€¼çš„ã€‚</p>
<p>ç”±äºå‰è¿°æåˆ°ç§»åŠ¨Appçš„å±€é™æ€§ï¼Œå› æ­¤å¸Œæœ›SoloPiåç»­èƒ½ç§¯æå‘å¤–æ‰“é€šé“¾è·¯ï¼Œè®©ä¸šåŠ¡å®ç°ï¼ˆå°¤å…¶æ˜¯å½•åˆ¶ç»“æœåˆ†æï¼‰æ˜¾å¾—æ›´åŠ çµæ´»ã€‚</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½æµ‹è¯•</tag>
        <tag>è‡ªåŠ¨åŒ–æµ‹è¯•</tag>
        <tag>SoloPi</tag>
        <tag>Android</tag>
        <tag>å½•åˆ¶å›æ”¾</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬äºŒè¯ï¼šåˆæ¢æœåŠ¡ç«¯CRUDï¼Œgin+gormé»„é‡‘æ­æ¡£</title>
    <url>/2019/08/04/gofromzero/02_gin_gorm/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nb2Zyb216ZXJv" title="https://github.com/utmhikari/gofromzero">Githubä¼ é€é—¨<i class="fa fa-external-link"></i></span></p>
<p>å­¦ä¸€é—¨æ–°è¯­è¨€ï¼Œå¦‚æœå¤ªä¸“æ³¨äºè¯­æ³•ï¼Œé‚£è‚¯å®šå­¦çš„ä¸å¤Ÿå¿«ã€‚å¦‚æœæœ‰ä¸€å®šçš„éœ€æ±‚ç›®æ ‡ï¼Œå¸¦ç€è¿™ä¸ªç›®æ ‡å»å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€ï¼Œè¿™æ ·æ‰èƒ½å­¦å¾—å¿«ã€‚</p>
<p>å·¥ä½œä¸­å†™åç«¯çš„æ—¶é—´æ¯”ä¾‹ä¸åœ¨å°‘æ•°ï¼Œè€Œä¸”ä¼ é—»Goä¹Ÿå› å…¶é€‚ç”¨äºæœåŠ¡ç«¯è€Œè‘—åã€‚åœ¨Goç¤¾åŒºä¸­æœ€ä¸ºç«çƒ­çš„æœåŠ¡ç«¯æ¡†æ¶è·Ÿæ•°æ®åº“æŠ½è±¡ORMå±‚å½“å±<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dpbi1nb25pYy9naW4=" title="https://github.com/gin-gonic/gin">gin<i class="fa fa-external-link"></i></span>è·Ÿ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2ppbnpodS9nb3Jt" title="https://github.com/jinzhu/gorm">gorm<i class="fa fa-external-link"></i></span>äº†ï¼Œå› æ­¤æœ¬æœŸå•æ’çš„ç›®æ ‡ä¾¿æ˜¯ç”¨gin+gormæ‰“ä¸€ä¸ªç®€æ˜“çš„æ¡†æ¶ï¼Œå®ç°åŸºæœ¬CRUDçš„ç›®æ ‡ã€‚èµ°ä½ ~</p>
<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><p>åœ¨<a href="https://utmhikari.github.io/2019/07/20/gofromzero/01_first_code/">ç¬¬ä¸€è¯</a>ä¸­å·²ç»å¤§è‡´äº†è§£äº†Goé¡¹ç›®çš„ç”Ÿæˆï¼Œæ•…æœ¬æ¬¡gin+gormçš„æ­å»ºä¹Ÿä»¥æ­¤ä¸ºåŸºç¡€ã€‚</p>
<p>æœåŠ¡ç«¯é¢†åŸŸçš„å„ç§æœ¯è¯­åœ¨ä¸åŒçš„åœºæ™¯è·ŸæŠ€æœ¯æ ˆä¸‹æœ‰ä¸åŒçš„å«ä¹‰ã€‚ä½†æ€»ä½“æ¥è®²ï¼Œä¸€ä¸ªç®€å•çš„æœåŠ¡ç«¯Appéƒ½ä¼šæœ‰ä»¥ä¸‹çš„å±‚æ¬¡ï¼š</p>
<ul>
<li>æ ¡éªŒå±‚ï¼šé¢„å¤„ç†è¯·æ±‚ï¼Œæ ¡éªŒè¯·æ±‚æ˜¯å¦åˆæ³•ï¼ˆå¤§å°ã€å­—æ®µã€corsã€oauthä¹‹ç±»ï¼‰ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦æ‹¦æˆªã€‚é€šå¸¸ä¹Ÿè¢«ç§°ä½œä¸­é—´å±‚middleware</li>
<li>æ§åˆ¶å±‚ï¼šå¤„ç†åˆæ³•è¯·æ±‚çš„èµ·ç‚¹â€”â€”æ”¶é›†æ•´ç†ç›¸åº”æœåŠ¡æ¨¡å—çš„ç»“æœï¼Œåˆ¤æ–­è¯·æ±‚æ˜¯å¦åˆç†ï¼Œå†³å®šè¿”å›çš„æ•°æ®ï¼Œéµå¾ªå®½è¿›ä¸¥å‡ºåŸåˆ™ã€‚ä¸€èˆ¬å«åšControllerï¼Œginé‡Œé¢å«åšhandlerã€‚</li>
<li>ä¸šåŠ¡å±‚ï¼šå¤„ç†çœŸå®çš„ä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡å’Œæ•°æ®å±‚ä»¥åŠå„ä¸ªä¸šåŠ¡æ¨¡å—çš„äº¤äº’ä»è€Œæ ¡éªŒå¹¶æ„å»ºä¸šåŠ¡æ•°æ®ï¼Œäº¤ç”±æ§åˆ¶å±‚å†³ç­–ï¼Œä¸€èˆ¬å¯ç§°ä¹‹ä¸ºservice</li>
<li>æ•°æ®å±‚ï¼šæŠ½è±¡æŒä¹…åŒ–æ•°æ®ï¼ˆæ•°æ®åº“ï¼‰åˆ°ä»£ç å±‚é¢å¹¶æä¾›ä¸€ç³»åˆ—äº¤äº’è®¿é—®çš„æ–¹æ³•ï¼ŒORMä¸DAOå±‚éƒ½ç®—åœ¨å†…</li>
</ul>
<p>åŸºäºä»¥ä¸Šç»“æ„ï¼Œå¤§è‡´æ„å»ºäº†ä»¥ä¸‹çš„ç›®å½•ç»“æ„ï¼š</p>
<a id="more"></a>
<ul>
<li>root<ul>
<li>database æ•°æ®å±‚<ul>
<li>main.go å°è£…gorm</li>
<li>xxx.go è¡¨xxx</li>
</ul>
</li>
<li>handler æ§åˆ¶å±‚<ul>
<li>base.go å°è£…åŸºæœ¬è¿”å›æ–¹æ³•</li>
<li>xxx.go æ¨¡å—xxxæ§åˆ¶å™¨</li>
</ul>
</li>
<li>service ä¸šåŠ¡å±‚<ul>
<li>xxx ä¸šåŠ¡æ¨¡å—xxxï¼ˆé˜²æ­¢ç›¸äº’å¼•ç”¨ï¼Œç”¨æ–‡ä»¶å¤¹éš”å¼€ï¼‰<ul>
<li>abc.go æ¨¡å—xxxçš„abcä¸šåŠ¡</li>
</ul>
</li>
</ul>
</li>
<li>app.go æœåŠ¡ç«¯app</li>
<li>router.go æœåŠ¡ç«¯è·¯ç”±</li>
</ul>
</li>
</ul>
<p>æœ¬æ¬¡demoæ²¡æœ‰å¼„æ ¡éªŒå±‚(routeré‡Œè®¾ç½®å„ç§middleware)ï¼Œç›´æ¥ä»handlerå¼€å§‹å¹²æ‹‰~</p>
<h2 id="gormå°è£…"><a href="#gormå°è£…" class="headerlink" title="gormå°è£…"></a>gormå°è£…</h2><p>gormå®ç°äº†ä¸åŒæ•°æ®åº“å¯¹Goå¯¹è±¡çš„æ˜ å°„ã€‚gormæœ¬èº«æä¾›äº†é»˜è®¤çš„è¡¨Modelï¼ˆidã€å¢åˆ æ”¹æ—¶é—´ï¼‰ï¼Œä½†å®é™…è¿˜æ˜¯å»ºè®®è‡ªè¡Œå°è£…ä¸€å±‚ï¼Œä»¥å¢åŠ å¯æ§æ€§ã€‚</p>
<p>è¿™é‡Œä»¥mysqläº¤äº’ä¸ºä¾‹ï¼Œå®ç°äº†ä¸€ä¸ªå°è£…ä¾‹å­ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// database/main.go</span></span><br><span class="line"><span class="keyword">package</span> database</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> DBModel <span class="keyword">struct</span> &#123;</span><br><span class="line">    *gorm.Model</span><br><span class="line">    <span class="comment">// You can add your own model components here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// DB database instance</span></span><br><span class="line"><span class="keyword">var</span> DBInstance *gorm.DB</span><br><span class="line"></span><br><span class="line"><span class="comment">// InitDB initialize DB</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">InitDB</span><span class="params">()</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Initializing database..."</span>)</span><br><span class="line">    <span class="comment">// ä»docker hub pullä¸‹æ¥å°±å¥½äº†= =</span></span><br><span class="line">    db, err := gorm.Open(<span class="string">"mysql"</span>, <span class="string">"root:123456@tcp(localhost:32773)/gofromzero?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    DBInstance = db</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‡ä½¿æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªUserè¡¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€ä¸ªgoæ–‡ä»¶å†…å¼•ç”¨DBModelè·ŸDBInstanceï¼Œä»è€Œå®šä¹‰æ•°æ®äº¤äº’é€»è¾‘</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// database/user.go</span></span><br><span class="line"><span class="keyword">package</span> database</span><br><span class="line"></span><br><span class="line"><span class="comment">// Userè¡¨çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    *DBModel</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">    Age <span class="keyword">uint</span> <span class="string">`json:"age"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> userDAO <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserDAO user dao</span></span><br><span class="line"><span class="keyword">var</span> UserDAO userDAO</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create create a user record</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*userDAO)</span> <span class="title">Create</span><span class="params">(user User)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    DBInstance.AutoMigrate(&amp;User&#123;&#125;)</span><br><span class="line">    <span class="keyword">return</span> DBInstance.Create(&amp;user).Error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// First get the first record of user</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*userDAO)</span> <span class="title">First</span><span class="params">()</span> <span class="params">(User, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> user User</span><br><span class="line">    err := DBInstance.First(&amp;user).Error</span><br><span class="line">    <span class="keyword">return</span> user, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update update user record</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*userDAO)</span> <span class="title">Update</span><span class="params">(user User)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> DBInstance.Model(&amp;User&#123;&#125;).Updates(&amp;user).Error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete set all to delete state</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*userDAO)</span> <span class="title">Delete</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> DBInstance.Delete(&amp;User&#123;&#125;).Error</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·åœ¨å¤–éƒ¨è¦è·ŸUserè¡¨äº¤äº’çš„è¯ï¼Œç›´æ¥ç”¨<code>UserDAO</code>å°±å¯ä»¥å®Œæˆéœ€æ±‚äº†</p>
<h2 id="ginæœåŠ¡æ­å»º"><a href="#ginæœåŠ¡æ­å»º" class="headerlink" title="ginæœåŠ¡æ­å»º"></a>ginæœåŠ¡æ­å»º</h2><p>æœ‰äº†å¯¹gormçš„è¿›ä¸€æ­¥å°è£…ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¿‡å¤šæ‹…å¿ƒæ•°æ®è·å–çš„é—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å…³æ³¨ginçš„å†™æ³•ã€‚</p>
<p>é¦–å…ˆå»ºè®®å°è£…ä¸€äº›å¸¸ç”¨çš„è¿”å›æ–¹æ³•ï¼Œä»€ä¹ˆsuccessã€errorä¹‹ç±»ï¼Œæœ‰åŠ©äºå‡å°‘ç é‡ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// handler/base.go</span></span><br><span class="line"><span class="keyword">package</span> handler</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Success</span><span class="params">(c *gin.Context, data <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    c.JSON(http.StatusOK, gin.H&#123;</span><br><span class="line">        <span class="string">"data"</span>: data,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Error</span><span class="params">(c *gin.Context, err error, code <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    c.JSON(code, gin.H&#123;</span><br><span class="line">        <span class="string">"err"</span>: err.Error(),</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œååœ¨useræ¨¡å—çš„handlerä¸‹ï¼Œå®ç°æ§åˆ¶å™¨é€»è¾‘ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// handler/user.go</span></span><br><span class="line"><span class="keyword">package</span> handler</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"github.com/gin-gonic/gin"</span></span><br><span class="line">    service <span class="string">"github.com/gofromzero/ii/service/user"</span></span><br><span class="line">    <span class="string">"net/http"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> user <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// User instance of user controller</span></span><br><span class="line"><span class="keyword">var</span> User user</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create create a user</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*user)</span> <span class="title">Create</span><span class="params">(c *gin.Context)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> userForm service.Form</span><br><span class="line">    bindErr := c.ShouldBindJSON(&amp;userForm)</span><br><span class="line">    <span class="keyword">if</span> bindErr != <span class="literal">nil</span> &#123;</span><br><span class="line">        Error(c, bindErr, http.StatusForbidden)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    createErr := service.Create(userForm)</span><br><span class="line">    <span class="keyword">if</span> createErr != <span class="literal">nil</span>&#123;</span><br><span class="line">        Error(c, createErr, http.StatusBadRequest)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    Success(c, <span class="string">"Create user successfully!"</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹ç•¥ï¼ŒCRUD</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ–‡ä»¶å¤¹å®šä¹‰äº†userä¸šåŠ¡å±‚çš„æ¨¡å—ã€‚ä¸šåŠ¡å±‚ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// service/user/crud.go</span></span><br><span class="line"><span class="keyword">package</span> user</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Form <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`json:"name"`</span></span><br><span class="line">    Age <span class="keyword">uint</span> <span class="string">`json:"age"`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create create user on form</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Create</span><span class="params">(form Form)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> database.UserDAO.Create(database.User&#123;</span><br><span class="line">        Name: form.Name,</span><br><span class="line">        Age: form.Age,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// First get first user from database</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">First</span><span class="params">()</span> <span class="params">(database.User, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> database.UserDAO.First()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update update user records</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Update</span><span class="params">(form Form)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> database.UserDAO.Update(database.User&#123;</span><br><span class="line">        Name: form.Name,</span><br><span class="line">        Age: form.Age,</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Delete delete user records</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Delete</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> database.UserDAO.Delete()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™ä¸ªdemoä¸­ï¼Œä¸šåŠ¡å±‚çš„ä»£ç çœ‹èµ·æ¥æœ‰ç‚¹å¤šä½™ï¼ŒåŸºæœ¬æ˜¯çº¯ç²¹è°ƒç”¨UserDAOçš„æ–¹æ³•ã€‚ä½†å®é™…é¡¹ç›®å†™å¤§çš„è¯ï¼Œå…¶å®è¿˜ä¼šæ¶‰åŠåˆ°å’Œå…¶å®ƒæ¨¡å—çš„äº¤äº’ã€‚å› æ­¤ï¼Œè¿™ä¸€å±‚çš„ç‹¬ç«‹æ˜¯æœ‰å¿…è¦çš„ã€‚</p>
<p>æœ€åï¼Œåœ¨è·¯ç”±ä¸­è°ƒç”¨<code>handler.User</code>ï¼Œæˆ‘ä»¬å°±èƒ½å¾ˆè½»æ¾åœ°æ³¨å†Œuseræ¨¡å—çš„æ§åˆ¶å™¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// router.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Router gin router</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Router</span><span class="params">()</span> *<span class="title">gin</span>.<span class="title">Engine</span></span> &#123;</span><br><span class="line">    log.Println(<span class="string">"Registering routers..."</span>)</span><br><span class="line">    r := gin.Default()</span><br><span class="line">    api := r.Group(<span class="string">"/api"</span>)</span><br><span class="line">    v1 := api.Group(<span class="string">"/v1"</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        user := v1.Group(<span class="string">"/user"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            user.POST(<span class="string">""</span>, handler.User.Create)</span><br><span class="line">            user.GET(<span class="string">""</span>, handler.User.Get)</span><br><span class="line">            user.PUT(<span class="string">""</span>, handler.User.Update)</span><br><span class="line">            user.DELETE(<span class="string">""</span>, handler.User.Delete)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨Appå®ä¾‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// app.go</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// StartGin start gin server</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">StartGin</span><span class="params">()</span></span> &#123;</span><br><span class="line">    database.InitDB()</span><br><span class="line">    <span class="keyword">defer</span> database.CloseDB()</span><br><span class="line">    router := Router()</span><br><span class="line">    s := &amp;http.Server&#123;</span><br><span class="line">        Addr:    <span class="string">":8080"</span>,</span><br><span class="line">        Handler: router,</span><br><span class="line">    &#125;</span><br><span class="line">    err := s.ListenAndServe()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯•è¯•çœ‹å§~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Goåœ¨æ•´ä½“å°è±¡ä¸ŠçœŸçš„å¾ˆä¸¥æ ¼ï¼Œç”šè‡³æ¯”Javaè¿˜ä¸¥æ ¼ã€‚è¿™partçš„ä»£ç å†™èµ·æ¥çœŸå¿ƒä¸å¦‚JSè½»æ¾ï¼Œä½†é€šè¿‡è¿™äº›æ¢æ¥ä»£ç å¥å£®æ€§ä¸æœåŠ¡æ€§èƒ½å¢ç›Šï¼Œæ˜¯å¾ˆå€¼å¾—çš„ã€‚</p>
<p>è¿™æ¬¡é¡¹ç›®æ¶æ„çš„è®¾è®¡ä¹Ÿä»…æ˜¯æŠ›ç –å¼•ç‰ï¼Œå¯¹gormä»¥åŠginè¿˜æ²¡æœ‰æ›´åŠ æ·±å…¥çš„æ¢ç©¶ã€‚ä»¥åå¯å¾—åŠ æ²¹~</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>åç«¯å¼€å‘</tag>
        <tag>Golang</tag>
        <tag>gin</tag>
        <tag>webå¼€å‘</tag>
        <tag>gorm</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘ä¸€ä¸ªæµ‹è¯•å¼€å‘çš„ç”¨æˆ·æ€ç»´</title>
    <url>/2019/07/28/testlife/think_as_a_user/</url>
    <content><![CDATA[<p>è¿‘å‡ å¤©ä¸€ç›´åœ¨æ€è€ƒä»€ä¹ˆæ˜¯ç”¨æˆ·æ€ç»´ï¼Œå†³å®šç»“åˆè¿™ä¸€å¹´çš„å·¥ä½œï¼ŒæŠŠè‡ªå·±çš„æƒ³æ³•è®°å½•ä¸‹æ¥ã€‚</p>
<p>åœ¨è¿™ä¹‹å‰ï¼Œè‡ªå·±ä¸€ç›´ç§‰æŒä¸€ç§è§‚å¿µâ€”â€”æµ‹è¯•å¼€å‘ä»å·¥ä½œå†…å®¹ä¸Šï¼Œæ›´åŠ ç¬¦åˆâ€œå¼€ï¼ˆç ï¼‰å‘ï¼ˆå†œï¼‰â€çš„å®šä¹‰ï¼Œå› æ­¤åº”å½“æ›´åŠ ç€é‡äºæŠ€æœ¯æ·±è€•ï¼Œå¹¶ä¸”åœ¨ä¸šåŠ¡å¯¹æ¥æ—¶ï¼Œä¹Ÿå°½å¯èƒ½åœ°ä»ä»æŠ€æœ¯å®ç°çš„è§’åº¦å»é˜è¿°è§‚ç‚¹ä¸æƒ³æ³•ã€‚ä½†æ˜¯åœ¨ç»è¿‡åŒäº‹ä¼™ä¼´ä»¬çš„æç‚¹ï¼Œä»¥åŠå’Œå®¶ä¸­é¢†å¯¼æ¿€çƒˆè®¨ï¼ˆåµï¼‰è®ºï¼ˆæ¶ï¼‰äº†ä¸€ç•ªä¹‹åï¼Œè¿™ä¸ªè§‚å¿µå°±æ…¢æ…¢åœ°æ”¹å˜äº†ã€‚</p>
<p>æµ‹è¯•ï¼Œä¸ä»…ä»…æ˜¯æ ¹æ®éœ€æ±‚ï¼Œåˆ©ç”¨å„ç§å·¥å…·ï¼Œå¯¹å¼€å‘äº¤ä»˜çš„äº§å“è¿›è¡ŒåŠŸèƒ½ã€æ€§èƒ½ã€å®‰å…¨ç­‰æµ‹è¯•ï¼Œå‘ç°bugè€Œåæäº¤å¤ç°/è§£å†³æ–¹æ¡ˆï¼Œä»è€Œç¡®ä¿äº§å“ç¨³å®šï¼ˆQCï¼‰ã€‚è€Œå¦ä¸€äº›æ–¹é¢åœ¨äºâ€”â€”å¦‚ä½•ç¡®ä¿ç ”å‘è®¡åˆ’å®Œå¤‡è¿›è¡Œï¼Œé¢„é˜²äº§å“è®¾è®¡ç¼ºé™·ï¼Œä»è€Œä¿è¯äº§å“ä½“éªŒï¼›å¦‚ä½•ä¼˜åŒ–äº§å“ç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼Œä»è€Œä½¿äº§å“é¡ºåˆ©ä¸Šçº¿è¿è¥ï¼ˆQAï¼‰ã€‚ä½œä¸ºåä¸­å°çš„æµ‹è¯•å¼€å‘ï¼Œæ‰®æ¼”çš„è§’è‰²æ›´åƒæ˜¯â€œä¼˜åŒ–äº§å“ç”Ÿå‘½å‘¨æœŸâ€çš„å®ç°è€…ï¼Œè€Œå‰çº¿ä¸Šçš„QAä¸QCï¼Œåˆ™æˆä¸ºäº†æˆ‘ä»¬çš„ç”¨æˆ·ã€‚å› æ­¤åœ¨ä¸šåŠ¡å¯¹æ¥æ—¶ï¼Œé¦–å…ˆéƒ½éœ€è¦å°½å¯èƒ½æ»¡è¶³å‰çº¿åŒå­¦çš„éœ€æ±‚ï¼Œè®©ä»–ä»¬å¼•é¢†æ•ˆç‡å·¥å…·/å¹³å°çš„è®¾è®¡ã€‚</p>
<a id="more"></a>
<p>ä»¥çŸ­çº¿çš„å°æµ‹è¯•å·¥å…·ä¸ºä¾‹å§~å‰çº¿çš„åŒå­¦ä»¬éƒ½å¸Œæœ›æµ‹è¯•å·¥å…·å­¦ä¹ æˆæœ¬ä½ï¼Œå› æ­¤è‡ªå·±åœ¨å¼€å‘æµ‹è¯•å·¥å…·æ—¶ï¼Œéƒ½ä¼šæ—¶ä¸æ—¶æƒ³å¿µä¸€ä¸‹å®¶ä¸­é¢†å¯¼ï¼Œå¸Œæœ›å·¥å…·çš„æ˜“ç”¨æ€§èƒ½è®©å¥¹ä½¿ç”¨é¡ºç•…ã€‚ä½†æ˜¯ï¼Œ<strong>å·¥å…·çš„æ˜“ç”¨æ€§æ˜¯å¿…è¦æ¡ä»¶ï¼Œå´å¹¶ä¸æ˜¯å……åˆ†æ¡ä»¶</strong>ã€‚ç ”å‘æµ‹è¯•å·¥å…·ï¼Œä¸ä»…ä»…æ˜¯æ˜¾ç¤ºæµ‹è¯•çš„æ•°æ®ä¸æŒ‡æ ‡ï¼Œæ ‡è¯†æ•°æ®å¼‚å¸¸ï¼Œè€Œæ›´é‡è¦çš„æ˜¯è®©æµ‹è¯•äººå‘˜é€šè¿‡å·¥å…·ï¼Œèƒ½å¤Ÿè¿…é€Ÿå®šä½ç¼ºé™·çš„æˆå› å¹¶åˆ¶å®šæŠ¥è¡¨ä¸è§£å†³æ–¹æ¡ˆï¼Œæˆ–æ˜¯ç¡®è®¤æµ‹è¯•è¿‡ç¨‹ä¸­æ˜¯å¦å­˜åœ¨é¢å¤–çš„å› ç´ å½±å“äº†æµ‹è¯•æ•ˆæœã€‚å› æ­¤ï¼Œæµ‹è¯•å¼€å‘æ›´è¦å…³æ³¨çš„ï¼Œ<strong>ä¸€æ˜¯ä¸ºä»€ä¹ˆäº§ç”Ÿäº†å„ç§é‚£æ ·çš„æµ‹è¯•éœ€æ±‚ï¼Œå‰å› åæœæ˜¯ä»€ä¹ˆï¼›äºŒæ˜¯æŒç»­äº¤ä»˜ï¼Œè·Ÿè¿›å·¥å…·çš„ä½¿ç”¨æƒ…å†µï¼Œè§‚å¯Ÿå‰çº¿åŒå­¦æ˜¯å¦‚ä½•ä½¿ç”¨å·¥å…·æµ‹è¯•ä»¥åŠæ’æŸ¥é—®é¢˜çš„ï¼Œä»è€ŒæŒ–æ˜æ½œåœ¨éœ€æ±‚ï¼Œè®¾è®¡å·¥å…·çš„ä¼˜åŒ–è·¯çº¿</strong>ã€‚è¿™æ ·ï¼Œæµ‹è¯•å·¥å…·çš„å½¢æ€ï¼Œå°±é€æ­¥æ˜¾éœ²å‡ºæ¥äº†ã€‚ä»è¿™ä¸€ç‚¹ä¸Šæ¥çœ‹ï¼Œæµ‹è¯•å¼€å‘æ‰€è¦æ‹…ä»»çš„è§’è‰²ï¼Œå¯èƒ½ç®—æ˜¯<strong>QAä¸­çš„QA</strong>ã€‚</p>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œé€ è½®å­çš„äººï¼Œå¤šå¤šå°‘å°‘éƒ½ä¼šæ‹¥æœ‰è‰ºæœ¯å®¶èˆ¬çš„æ‰§å¿µã€‚è‰ºæœ¯å®¶å¤±å»äº†çµæ„Ÿï¼Œå°±åªå‰©ä¸‹ä¸€å…·ç©ºå£³ï¼›è€Œå¼€å‘è€…å¤±å»äº†éœ€æ±‚ï¼Œå°±åªèƒ½æ‰‹æŒ‡é¡¶ç€é”®ç›˜å‘å‘†ã€‚<strong>æµ‹è¯•å¼€å‘ï¼Œæ˜¯éœ€è¦æ›´åŠ ä¸»åŠ¨å»è·å–éœ€æ±‚çš„äºº</strong>ï¼Œè€Œçµæ„Ÿçš„æœ€ç›´æ¥æ¥æºï¼Œå°±æ˜¯å‰çº¿çš„æµ‹è¯•å°ä¼™ä¼´ä»¬ã€‚ä¼˜åŒ–å‰çº¿ä¼™ä¼´çš„å·¥ä½œæµç¨‹ï¼Œæ˜¯æµ‹è¯•å¼€å‘çš„ä¸€é¡¹é‡å¤§ä»»åŠ¡ã€‚å› æ­¤å¯¹äºæµ‹è¯•å¼€å‘è€Œè¨€ï¼Œ<strong>åˆ‡æ¢æ€ç»´ï¼Œç›´æ¥åˆ‡å…¥æµ‹è¯•ä¸šåŠ¡ï¼Œä»å‰çº¿æµ‹è¯•å·¥ä½œçš„è§’åº¦è¿›è¡Œæ²Ÿé€šï¼Œä»ä¸šåŠ¡ä¸Šå‡å°‘äº†æ²Ÿé€šæˆæœ¬ï¼Œæ›´åŠ æ˜ç¡®äº†éœ€æ±‚ï¼›ä»èŒä¸šæˆé•¿ä¸Šä¹Ÿå½¢æˆäº†æŠ€æœ¯è®¾è®¡ä¸å®ç°çš„ç»éªŒ</strong>ã€‚å¯ä»¥è¯´ï¼Œæ‹¥æœ‰è¿™ä¸€ä»½æŠ€èƒ½ï¼Œä¾¿æ˜¯æ‹¥æœ‰äº†ä¸€ç¬”å®è´µçš„è´¢å¯Œã€‚</p>
<p>è¯´åˆ°è¿™é‡Œï¼Œä¸ç”±å¾—æƒ³åˆ°äº†æ—©æ™¨å»åŒ»é™¢çœ‹ç—…è§‚å¯Ÿåˆ°çš„ä¸€ä»¶äº‹ï¼šçœ‹å®Œç—…ï¼Œå¾®ä¿¡ä»˜æ¬¾åä¸‹æ¥¼å–è¯ï¼Œè·Ÿä»¥å‰ç›¸æ¯”ï¼Œç°åœ¨å¤šäº†ä¸€ä¸ªæŠ¥åˆ°çš„æ­¥éª¤â€”â€”æ‚£è€…åœ¨æŠ¥åˆ°å¤„æ‰«æäºŒç»´ç åï¼Œæ‰çŸ¥é“è‡ªå·±åœ¨ä½•å¤„å–è¯ï¼Œç„¶ååªéœ€åç­‰åå•ä¸Šæœ‰åå­—å‡ºç°ï¼Œå°±å¯ä»¥å»å–è¯äº†ã€‚</p>
<p>å¯¹æ¯”ä¸€ä¸‹ä»¥å‰å–è¯çš„æµç¨‹ï¼ŒæŠ¥åˆ°æœºçš„å‡ºç°æ˜¾è‘—ä¼˜åŒ–äº†å–è¯æ•ˆç‡ã€‚ä¸€æ–¹é¢ï¼Œè§£å†³äº†ä¸ä»˜æ¬¾/ä»˜æ¬¾ä¸å–é€ æˆçš„è¯ç‰©æ»ç•™é—®é¢˜ï¼›å¦ä¸€æ–¹é¢ç¡®å®šäº†å–è¯é¡ºåºï¼Œè®©æ‚£è€…ä¸ç”¨æ‹…å¿ƒå–è¯ç¼–å·åŠ å¡å¯¼è‡´è¿Ÿè¿Ÿæ‹¿ä¸åˆ°è¯ï¼›å†ä¸€æ–¹é¢è”åŠ¨è‡ªåŠ¨å‘è¯æœºï¼Œä½¿å¾—è¯å¸ˆä¹Ÿä¸å¿…æ‰‹å¿™è„šä¹±ã€‚è¯å¸ˆçš„å·¥ä½œé‡å‡å°‘äº†ï¼Œæ‚£è€…ä½“éªŒä¹Ÿèµ·äº†å‰Šå³°å¡«è°·çš„æ•ˆæœï¼Œæ€»ä½“æ¥è®²ï¼Œä¸¤å…¨å…¶ç¾ã€‚</p>
<p><strong>å¼€é—¨è§å±±ï¼Œæ˜¯æ¯ä¸ªç”¨æˆ·çš„å¸Œå†€</strong>ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œä»¥ç”¨æˆ·æ€ç»´ä¸ºåŸç‚¹å»æ¢ç´¢æŠ€æœ¯å®ç°ï¼Œæ‰ä¼šæœ‰æ›´åŠ æ¸…æ™°çš„æ€è·¯ï¼Œè€Œä¸è‡³äºç›²ç›®ã€‚ä¸€å¹´æ¥ï¼Œæœ€å¤§çš„æ”¶è·æ˜¯æ·±åˆ»åœ°äº†è§£åˆ°æŠ€æœ¯çŸ¥è¯†ä¸æ€ç»´å›ºç„¶é‡è¦ï¼Œä½†å¸¦åŠ¨æŠ€æœ¯æ€ç»´æå‡çš„ï¼Œæ˜¯ç”¨æˆ·æ€ç»´ä¸»å¯¼çš„ä¸šåŠ¡éœ€æ±‚ã€‚å› æ­¤ï¼Œå¸Œæœ›æ—¥åèƒ½å¤ŸåŸ¹å…»æ›´æ•é”çš„ç”¨æˆ·å—…è§‰ï¼Œä»è€Œæ”¯æ’‘è‡ªå·±å‘å±•å¾—æ›´è¿œ~</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>äº§å“</tag>
        <tag>æµ‹è¯•å¼€å‘</tag>
        <tag>ä¸“é¡¹æµ‹è¯•</tag>
        <tag>æµ‹è¯•</tag>
        <tag>QA</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€ä»é›¶å•æ’Golangã€‘ç¬¬ä¸€è¯ï¼šGoå¼€å‘ç¯å¢ƒæ­å»ºâ€”â€”ç¯å¢ƒå˜é‡ã€ä¾èµ–ä¸ç›®å½•ç»“æ„è¸©å‘</title>
    <url>/2019/07/20/gofromzero/01_first_code/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9nb2Zyb216ZXJv" title="https://github.com/utmhikari/gofromzero">Githubä¼ é€é—¨<i class="fa fa-external-link"></i></span></p>
<p>å½“æµ‹è¯•å¼€å‘çœŸä¸å®¹æ˜“ï¼Œå…¥è¡Œç¬¬ä¸€å¹´ï¼Œå°±è¦åœ¨pythonã€NodeJSã€luaã€Cã€Javaç­‰è¯­è¨€é—´æ— ç¼åˆ‡æ¢ã€‚ä¸ºäº†å¿«é€Ÿå“åº”éœ€æ±‚ï¼ŒæŒºéš¾æŠ½å‡ºæ—¶é—´å»æ·±è€•ä¸€é—¨è¯­è¨€çš„ç‰¹æ€§ï¼ˆè¯¶ç¾¡æ…•é‚£äº›åªæJavaçš„äºº= =ï¼‰ã€‚åœ¨<a href="https://utmhikari.github.io/2019/07/01/testlife_mtsc2019/">MTSC2019åˆ†äº«</a>ä¸­ä¹Ÿè°ˆåˆ°ï¼Œæµ‹è¯•å¼€å‘å½’å±è´¨é‡ä¿éšœQAï¼Œä½œä¸ºä¸€ä¸ªä¸­å°è§’è‰²ï¼Œå…¶ç»ˆæä»»åŠ¡ä¿éšœç ”å‘æ•ˆèƒ½ï¼Œå› æ­¤ä¸€å¤§éœ€æ±‚æ˜¯æ‰“é€šäº§å“ç ”å‘è¿ç»´çš„ç”Ÿäº§çº¿ã€‚è¯´åˆ°ç”Ÿäº§çº¿å°±æƒ³åˆ°ä¸Šäº‘ï¼Œè¯´åˆ°ä¸Šäº‘å°±æƒ³åˆ°dockerè·Ÿkubeï¼Œè¯´åˆ°è·Ÿå®¹å™¨çš„äº¤äº’å°±æƒ³åˆ°äº†Golangã€‚é©¬è›‹ï¼Œåˆè¦å­¦ä¸€é—¨æ–°è¯­è¨€äº†ã€‚</p>
<p>å¼€è¿™ä¸ªå‘ï¼Œæ—¨åœ¨å±•ç°ä»¥ç¨‹åºå‘˜çš„è§†è§’å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€çš„è¿‡ç¨‹ã€‚å¸Œæœ›å¤§å®¶çœ‹å¾—æ¬¢ä¹ã€‚å¦‚æœæœ‰å¯å‘ï¼Œé‚£å°±æ›´æ£’å•¦ï¼</p>
<h2 id="å®‰è£…ä¸ç¯å¢ƒå˜é‡é…ç½®"><a href="#å®‰è£…ä¸ç¯å¢ƒå˜é‡é…ç½®" class="headerlink" title="å®‰è£…ä¸ç¯å¢ƒå˜é‡é…ç½®"></a>å®‰è£…ä¸ç¯å¢ƒå˜é‡é…ç½®</h2><p>å®¶é‡Œçš„ç”µè„‘æ˜¯Windowsï¼Œä»<span class="exturl" data-url="aHR0cHM6Ly9nb2xhbmcub3JnLw==" title="https://golang.org/">å®˜ç½‘<i class="fa fa-external-link"></i></span>å³å¯ä¸‹è½½Winçš„å®‰è£…åŒ…ã€‚Goçš„ç‰ˆæœ¬ä¸º1.12ã€‚</p>
<p>ä¸‹å¥½åå®‰è£…ï¼Œå®‰è£…å®Œæ¯•ä¹‹åè¿˜éœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæˆ‘çš„ç”µè„‘â€”â€”å±æ€§â€”â€”é«˜çº§ç³»ç»Ÿè®¾ç½®ï¼‰ã€‚<code>GOROOT</code>è®¾ç½®æˆGoçš„å®‰è£…è·¯å¾„ï¼Œè¿˜æœ‰ä¸€ä¸ªå…³é”®çš„<code>GOPATH</code>ï¼Œå®ƒè¡¨ç¤ºä½ çš„å·¥ä½œç›®å½•ï¼Œ<strong>ä¸€èˆ¬æ‰€æœ‰çš„Goé¡¹ç›®ï¼Œç”­ç®¡ç¬¬ä¸‰æ–¹çš„è¿˜æ˜¯ä½ çš„ï¼Œéƒ½ç»Ÿä¸€æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸‹</strong>ï¼ˆä»è¿™ç‚¹å¯ä»¥çœ‹å‡ºï¼ŒGoçš„æ§åˆ¶æ¬²è¿˜æ˜¯å¾ˆå¼ºçš„ï¼‰ã€‚<code>GOPATH</code>çš„ä¸€èˆ¬ç»“æ„å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<ul>
<li>GOPATH<ul>
<li>bin å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•</li>
<li>src æºç ç›®å½•</li>
</ul>
</li>
</ul>
<p>ä¸€èˆ¬æ¥è®²æˆ‘ä»¬å¯ä»¥åœ¨<code>%GOPATH%\src</code>ä¸‹æ–°å¼€ä¸€ä¸ªè‡ªå·±çš„æ–‡ä»¶å¤¹å­˜æ”¾æˆ‘ä»¬ä»¥åçš„Goé¡¹ç›®æºç ã€‚è€Œå¯¹äºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¯å¢ƒå˜é‡<code>PATH</code>ä¸­å¢åŠ <code>%GOPATH%\bin</code>è·Ÿ<code>%GOROOT%\bin</code>ä¿è¯åœ¨cmdé‡Œèƒ½ç›´æ¥è¿è¡Œã€‚</p>
<h2 id="é…ç½®VSCodeç¯å¢ƒ"><a href="#é…ç½®VSCodeç¯å¢ƒ" class="headerlink" title="é…ç½®VSCodeç¯å¢ƒ"></a>é…ç½®VSCodeç¯å¢ƒ</h2><p>Golangç”¨çš„IDEçš„è¯ideaè·ŸVSCodeéƒ½okï¼Œå®¶é‡Œå°±ç”¨VSCodeå¥½äº†ã€‚è¿™é‡Œç›´æ¥åœ¨<code>GOPATH</code>ä¸‹å»ºç«‹äº†ä¸€ä¸ª<code>mytest</code>æ–‡ä»¶å¤¹å½“ä½œæˆ‘ä»¬çš„æµ‹è¯•é¡¹ç›®ï¼Œç”¨VSCodeæ‰“å¼€ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªGoè„šæœ¬<code>main.go</code>ï¼Œå†…å®¹å°±æ˜¯æˆ‘ä»¬è§åˆ°æœ€å¤šçš„ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"fmt"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   fmt.Println(<span class="string">"Hell World"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªæ—¶å€™VSCodeå°±ä¼šæç¤ºä¸‹ä¸€å †å·¥å…·ä¾èµ–äº†ï¼ˆlinterã€è‡ªåŠ¨å¡«å……ä¹‹ç±»ï¼‰ã€‚ä½†æ˜¯VSCodeæ’ä»¶é»˜è®¤ä¼šä»go sourceä¸‹è½½ã€‚ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ä¸å¯æŠ—åŠ›ä¸€èˆ¬ä¸‹è½½ä¸è¡Œï¼Œä½†æœ‰å…¶å®ƒçš„è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>æµ‹ä¸€ä¸‹githubç½‘é€Ÿï¼Œå®åœ¨ä¸è¡Œè¯·å¼€å¯æ¸¸æˆåŠ é€Ÿå™¨</li>
<li>æŸ¥çœ‹VSCodeè¾“å‡ºæ—¥å¿—â€”â€”çœ‹çœ‹å“ªäº›ä¾èµ–å®‰è£…å¤±è´¥ã€‚ä¸€èˆ¬ç”±äºä¸å¯æŠ—åŠ›ï¼Œ<code>golang.org/x/tools/</code>ä¹‹ç±»çš„googleå®˜æ–¹ä¾èµ–ä¼šä¸‹ä¸åˆ°ã€‚è¿™ä¸ªæ—¶å€™éœ€è¦åœ¨<code>%GOPATH%\src</code>ä¸‹å»ºç«‹<code>golang.org/x</code>ç›®å½•ï¼Œç„¶åå†ä»githubä¸Šå¯¹åº”çš„ä»“åº“å…‹éš†<code>github.com/golang/tools</code>ï¼Œç„¶ågo installã€‚å¯ä»¥å‚è€ƒï¼š<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTMyOTU1MTgvYXJ0aWNsZS9kZXRhaWxzLzc4NzY2MDg2" title="https://blog.csdn.net/u013295518/article/details/78766086">VSCode + Golangé…ç½®<i class="fa fa-external-link"></i></span></li>
<li>åƒ<code>gocode-gomod</code>ç­‰binaryï¼ˆexeï¼‰ï¼Œå¯ä»¥ç›´æ¥copy gocodeæ”¹ä¸ªåå­—å°±èƒ½ç”¨</li>
</ul>
<p>ä¸‡äº‹å¼€å¤´éš¾ï¼Œä¸€åŠ³æ°¸é€¸ï¼Œå¼„å¥½è¿™äº›å°±åŸºæœ¬å¯ä»¥ç›´æ¥å¼€æäº†ã€‚VSCodeè¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæ¯”å¦‚é…åˆgolintä¼˜åŒ–ä»£ç ï¼Œä»£ç è§„èŒƒçš„äº‹æƒ…å°±å®Œå…¨ä¸ç”¨æ‹…å¿ƒäº†ã€‚</p>
<h2 id="package-import"><a href="#package-import" class="headerlink" title="package import"></a>package import</h2><p>å†åŸºäºä¸Šé¢çš„mytestç»™ä¸ªä¾‹å­ï¼Œæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š</p>
<ul>
<li>GOPATH<ul>
<li>src<ul>
<li>mytest<ul>
<li>main.go</li>
<li>hello<ul>
<li>hello.go</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>åœ¨Golangé‡Œï¼Œ<strong>å•ä¸ªç›®å½•ä¸‹çš„ç›´å±goæ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯ä¸åŒ…æ‹¬å­ç›®å½•ä¸‹çš„goæ–‡ä»¶ï¼‰ï¼Œéƒ½å¿…é¡»åªå±äºä¸€ä¸ªpackage</strong>ã€‚Golangåœ¨import packageæ—¶ï¼Œæœ¬è´¨ä¹Ÿå°±æ˜¯importä¸€ä¸ªç›®å½•å•¦ï¼Œå®ƒä¼šåˆ†åˆ«ä»¥<code>%GOROOT%\src</code>ä»¥åŠ<code>%GOPATH%\src</code>ä¸ºæ ¹ç›®å½•å¼€å§‹å¯»æ‰¾packageã€‚åƒ<code>fmt</code>ä¹‹ç±»çš„æ ‡å‡†åº“å°±åœ¨<code>%GOROOT%\src</code>ä¸­ï¼Œè€Œæˆ‘ä»¬è‡ªå·±ä¸‹çš„ä¾èµ–å°±åœ¨<code>%GOPATH%\src</code>ä¸­ã€‚</p>
<p>æ ¹æ®ä¸Šé¢çš„æ–‡ä»¶ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>hello.go</code>ä¸­å¡«å……å†…å®¹ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> hello</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Hello</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">(s <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">"Hell%s World"</span>, s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>hello.go</code>å±äºhelloè¿™ä¸ªpackageï¼Œç„¶ååŒ…å«ä¸€ä¸ªå«<code>Hello</code>çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å…·ä½“å¹²äº†ä»€ä¹ˆç›¸ä¿¡å¤§å®¶éƒ½æ˜ç™½ã€‚ç„¶è€Œé‡Œé¢å…¶å®æœ‰å‡ ä¸ªå‘â€”â€”<strong>Goçº¦å®špublicå‡½æ•°åç§°å¼€å¤´å¾—å¤§å†™</strong>ï¼Œæ¯”å¦‚è¿™ä¸ª<code>Hello(s string)</code>å†™æˆ<code>hello</code>çš„è¯ï¼Œå°±æˆäº†privateå‡½æ•°äº†ã€‚</p>
<p>åœ¨<code>main.go</code>è°ƒç”¨<code>Hello</code>å‡½æ•°çš„è¯ï¼Œå¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">"mytest/hello"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> s <span class="keyword">string</span></span><br><span class="line">    s = <span class="string">""</span></span><br><span class="line">    hello.Hello(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬importçš„æ˜¯<code>mytest/hello</code>ï¼Œä¹Ÿå°±æ˜¯ç›¸å¯¹äº<code>%GOPATH%\src</code>çš„æ–‡ä»¶å¤¹è·¯å¾„ï¼Œå°±å¯ä»¥æŠŠpackage helloç»™å¼•å…¥ã€‚è¦è°ƒç”¨çš„è¯ï¼Œåªéœ€<code>hello.Hello</code>å³å¯~</p>
<h2 id="ä¾èµ–ç®¡ç†"><a href="#ä¾èµ–ç®¡ç†" class="headerlink" title="ä¾èµ–ç®¡ç†"></a>ä¾èµ–ç®¡ç†</h2><p>å¼€å‘æœŸæˆ‘ä»¬å¸¸éœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹åº“ã€‚pythonæœ‰virtualenvï¼ŒNodeæœ‰npm + package.json + node_modulesï¼ŒJavaæœ‰Mavenï¼Œé‚£Golangé‡Œç”¨ä»€ä¹ˆè§£å†³æ–¹æ¡ˆå‘¢ï¼Ÿ</p>
<p>å››å¤„å¯»è§…äº†ä¸€ä¸‹ï¼Œç›®å‰æœ‰è®¸å¤švenderå¼çš„æ–¹æ¡ˆï¼ˆç±»ä¼¼node_modulesï¼‰ï¼Œæ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dvbGFuZy9kZXA=" title="https://github.com/golang/dep">dep<i class="fa fa-external-link"></i></span>è·Ÿ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL01hc3Rlcm1pbmRzL2dsaWRl" title="https://github.com/Masterminds/glide">glide<i class="fa fa-external-link"></i></span>ï¼Œè€Œç°ä»Šä¸»æ¨çš„æ–¹æ¡ˆæ˜¯1.11ç‰ˆæœ¬åçš„go modæŒ‡ä»¤ã€‚é¦–å…ˆï¼Œéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡<code>GOMOD111MODULE</code>ä¸º<code>on</code>ï¼Œç„¶åå¢åŠ ä¸€ä¸ªä»£ç†ï¼Œè®¾ç½®<code>GOPROXY</code>ä¸º<code>https://goproxy.io</code>ï¼Œè¿™æ ·å°±èƒ½ä¾¿æ·ä¸‹è½½ä¾èµ–äº†ã€‚</p>
<p>ä»¥å®‰è£…åç«¯æ¡†æ¶<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2dpbi1nb25pYy9naW4=" title="https://github.com/gin-gonic/gin">gin<i class="fa fa-external-link"></i></span>ä¸ºä¾‹ï¼Œé¦–å…ˆè¿›å…¥åˆšåˆšçš„mytestï¼Œç›´æ¥<code>go mod init</code>ï¼Œå³å¯å°†ä¹‹æ ‡ä¸ºæ¨¡å—ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåˆšåˆšç¯å¢ƒå˜é‡<code>GOMOD111MODULE</code>è®¾ä¸º<code>on</code>åéœ€è¦æ ‡è¯†æ¨¡å—ï¼Œé‡Œé¢çš„libæ‰èƒ½è¢«importã€‚</p>
<p>è€Œåï¼Œcopy ginçš„ç¤ºä¾‹ä»£ç åˆ°<code>main.go</code>ï¼Œç›´æ¥<code>go run main.go</code>ï¼Œä¾èµ–å°±ä¼šè‡ªåŠ¨å®‰è£…äº†ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¯¶ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´æœ‰ä¸€ä¸ªèˆ’æœçš„å¼€å‘ç¯å¢ƒæ˜¯å¾ˆé‡è¦çš„ã€‚åé¢å†æ…¢æ…¢ç ”ç©¶è¯­è¨€è·Ÿå„ç§è½®å­çš„ç‰¹æ€§~</p>
]]></content>
      <categories>
        <category>ä»é›¶å•æ’Golang</category>
      </categories>
      <tags>
        <tag>æ¶æ„</tag>
        <tag>ç¼–ç¨‹</tag>
        <tag>Golang</tag>
        <tag>ç¯å¢ƒå˜é‡</tag>
        <tag>go mod</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘å®‰å“FPSæµ‹è¯•è¯¦è§£</title>
    <url>/2019/07/13/testlife/android_fps/</url>
    <content><![CDATA[<p>å®‰å“çš„fpsæµ‹è¯•ï¼Œæ˜¯æˆ‘æ‰“å¼€æµ‹è¯•å¼€å‘å¤§é—¨çš„ä¸€æŠŠé’¥åŒ™ã€‚ä¸¤å¹´å‰çš„ç°åœ¨ï¼Œå®‰å“æ€§èƒ½æµ‹è¯•çš„ç›¸å…³èµ„æ–™ç”šå°‘ï¼Œä»¥fpsä¸ºä¾‹åœ¨ç½‘ä¸Šä¹Ÿåªæœ‰å¯¥å¯¥å‡ ç¯‡æ–‡ç« è®²è¿°ï¼Œä½†åˆ°äº†ä»Šå¹´ï¼Œå·²ç»æœ‰è®¸å¤šèµ„æ–™åœ¨å„å¤§æŠ€æœ¯è®ºå›ä¸Šä¾›å¤§å®¶çœ‹åˆ°äº†ã€‚å¯¹äºè‡ªå·±ï¼Œä¸€ç›´æƒ³æ‰¾ä¸€ä¸ªæœºä¼šæŠŠè¿™ä¸€æ®µæŠ€æœ¯æ¢ç´¢å†™å‡ºæ¥ã€‚æ‰€ä»¥ï¼Œå¿ƒåŠ¨ä¸å¦‚è¡ŒåŠ¨ã€‚</p>
<p>fpsï¼ˆframes per secondï¼‰ï¼Œé€šå¸¸è¡¨ç¤ºæˆ‘ä»¬å±å¹•æ¯ç§’å±•ç°çš„å›¾ç‰‡ï¼ˆå¸§ï¼‰æ•°ï¼Œåæ˜ äº†ä¸€æ¬¾åº”ç”¨åœ¨å½“å‰ç¡¬ä»¶ä¸‹çš„æ€§èƒ½æ¶ˆè€—ã€‚æ¯”å¦‚æˆ‘ä»¬æŠ½CSçš„æ—¶å€™ï¼Œå°±ç»å¸¸å…³æ³¨fpsæ˜¯å¦é«˜ï¼Œåœ¨é«˜çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šæœ‰è¾ƒå¥½çš„æµç•…åº¦ã€‚å› æ­¤fpsæ˜¯åº”ç”¨æ€§èƒ½æµ‹è¯•ä¸­ä¸€ä¸ªé‡è¦æŒ‡æ ‡ã€‚</p>
<p>å¯¹äºä¸€ä¸ªå®‰å“appè€Œè¨€ï¼Œä¸ºäº†æµ‹å®šfpsæ•°å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä»å®‰å“å›¾å½¢æ˜¾ç¤ºç›¸å…³çš„æ¨¡å—å…¥æ‰‹ã€‚ä¸€ä¸ªé€šç”¨çš„æ–¹å¼æ˜¯åˆ‡å…¥å®‰å“çš„SurfaceFlingeræœåŠ¡ï¼Œå®ƒæ˜¯å›¾å½¢æ˜¾ç¤ºæµç¨‹ä¸­è½¯ä»¶å±‚å’Œç¡¬ä»¶å±‚çš„äº¤äº’ç‚¹ï¼Œæ˜¯æå…¶å…³é”®çš„ä¸€ç¯ã€‚SurfaceFlingeråˆ™æ˜¯è´Ÿè´£åˆ†æ&amp;åˆæˆå„ä¸ªappä¸­çš„å›¾å±‚ï¼Œè€Œåå°†åˆæˆçš„å›¾åƒæ•°æ®äº¤ç”±ç¡¬ä»¶æ¸²æŸ“ã€‚ç¡¬ä»¶æ¸²æŸ“çš„æœºåˆ¶å¤æ‚ï¼Œå› æ­¤å®‰å“ç³»ç»Ÿä¸­ï¼Œå°†ç¡¬ä»¶æ“ä½œè¿›è¡Œäº†æŠ½è±¡æ–¹ä¾¿è°ƒç”¨ï¼Œæˆ‘ä»¬å°†è¿™ä¸€ä¸SurfaceFlingerå¯¹æ¥çš„å±‚æ¬¡ï¼Œç§°ä¹‹ä¸ºç¡¬ä»¶æŠ½è±¡å±‚ï¼ˆHALï¼‰ã€‚SurfaceFlingerä¸HALåœ¨åŠŸèƒ½ä¸Šæœ‰éƒ¨åˆ†çš„è€¦åˆï¼Œä¸€äº›Surfaceåˆæˆçš„å·¥ä½œï¼Œä¹Ÿä¼šå§”æ‰˜HALè¿›è¡Œã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•é€šè¿‡SurfaceFlingerè·å¾—fpsæ•°æ®å‘¢ï¼Ÿå¤§ä½“ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2l0Zm9vdGJhbGwvYXJ0aWNsZS9kZXRhaWxzLzQzMDg0NTI3Lw==" title="https://blog.csdn.net/itfootball/article/details/43084527/">ã€ŠAndroidæ€§èƒ½æµ‹è¯•ä¹‹fpsè·å–ã€‹<i class="fa fa-external-link"></i></span>ä¸€æ–‡ã€‚è¿™ç§æ–¹å¼æˆåŠŸç‡é«˜ï¼ˆè™½ç„¶æˆ‘å®¶æ‰‹æœºè¡Œä¸é€šï¼‰ï¼Œä¸”ä¸ç”¨rootï¼Œè¾ƒä¸ºæ–¹ä¾¿</p>
<p>é¦–å…ˆï¼Œé€šè¿‡adbï¼Œæˆ‘ä»¬å¯ä»¥å¯¼å‡ºSurfaceFlingeræœåŠ¡çš„è¿è¡Œæ—¶ä¿¡æ¯ã€‚</p>
<a id="more"></a>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys SurfaceFlinger</span><br></pre></td></tr></table></figure>
<p>dumpå‡ºçš„ä¿¡æ¯åŒ…å«äº†æ¯ä¸ªå›¾å±‚ç»è¿‡SurfaceFlingeråŠ å·¥åçš„ä¿¡æ¯ï¼Œä»¥åŠåœ¨ç¡¬ä»¶æ˜¾ç¤ºå±‚ä¸Šçš„å±‚æ¬¡ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">+ Layer 0x796c18e800 (com.supercell.clashroyale.kunlun/com.supercell.clashroyale.GameAppKunlun#0)</span><br><span class="line">  Region transparentRegion (this=0x796c18eb90, count=1)</span><br><span class="line">    [  0,   0, 1080, 2240]</span><br><span class="line">  Region visibleRegion (this=0x796c18e810, count=1)</span><br><span class="line">    [  0,   0,   0,   0]</span><br><span class="line">  Region surfaceDamageRegion (this=0x796c18e888, count=1)</span><br><span class="line">    [  0,   0,   0,   0]</span><br><span class="line">      layerStack=   0, z=    21015, pos=(0,0), size=(1080,2240), crop=(   0,   0,1080,2240), finalCrop=(   0,   0,  -1,  -1), isOpaque=0, invalidate=0, dataspace=(deprecated) sRGB Linear Full range, pixelformat=RGBA_8888 alpha=1.000, flags=0x00000000, tr=[1.00, 0.00][0.00, 1.00]</span><br><span class="line">      client=0x796fb03ec0</span><br></pre></td></tr></table></figure>
<p>ä¸€èˆ¬æ¥è®²ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©å‰å°çš„appè¿›è¡Œfpsç»Ÿè®¡ï¼Œå› æ­¤è¦é€‰æ‹©visible regionè¶³å¤Ÿå¤§ï¼Œä¸”zè½´ä¸ºæ­£çš„å±‚ã€‚é™¤äº†è¿™ä¸ªç­›é€‰ç‚¹ä¹‹å¤–ï¼Œä¹Ÿå¯åœ¨HALä¸­çš„ç¡¬ä»¶åˆæˆï¼ˆHWCï¼‰çš„ä¿¡æ¯ä¸­ï¼Œç­›é€‰æˆ‘ä»¬æƒ³è¦è·å–æ•°æ®çš„å›¾å±‚ã€‚</p>
<p>å¾—åˆ°å›¾å±‚åï¼Œæˆ‘ä»¬å¯ä»¥è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œå¯¼å‡ºè¯¥å›¾å±‚æ¸²æŸ“çš„æ—¶é—´æ•°æ®ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">adb shell dumpsys SurfaceFlinger --latency &lt;å›¾å±‚å&gt;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœæˆåŠŸçš„è¯ï¼Œä¼šæ˜¾ç¤ºå‡ºä¸‰åˆ—æ•°æ®ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// æŠ å›¾ from chromium android pylib</span><br><span class="line">16954612</span><br><span class="line">...</span><br><span class="line">7657467895508   7657482691352   7657493499756</span><br><span class="line">7657484466553   7657499645964   7657511077881</span><br><span class="line">7657500793457   7657516600576   7657527404780</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>æ‰€æœ‰æ•°æ®ä»¥çº³ç§’ä¸ºå•ä½ã€‚ç¬¬ä¸€è¡Œè¡¨ç¤ºæ˜¾ç¤ºå™¨åˆ·æ–°é¢‘ç‡ï¼ˆ16.95msï¼‰ï¼Œä¸€èˆ¬ä¸ºå›ºå®šå€¼ã€‚å‰©ä¸‹æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªå¸§çš„æ—¶åˆ»æ•°æ®ï¼Œä¸‰ä¸ªæ—¶åˆ»æ•°æ®åˆ†åˆ«è¡¨ç¤ºï¼š</p>
<ul>
<li>appç»˜å›¾æ—¶åˆ»ï¼ˆAï¼‰</li>
<li>å‚ç›´åŒæ­¥ä¿¡å·æ¥ä¸´æ—¶åˆ»ï¼ˆBï¼‰</li>
<li>SurfaceFlingeræŠŠå¸§å…¨éƒ¨æäº¤ç»™ç¡¬ä»¶çš„æ—¶åˆ»ï¼ˆCï¼‰</li>
</ul>
<p>æ‰€è°“<span class="exturl" data-url="aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS8lRTUlOUUlODIlRTclOUIlQjQlRTUlOTAlOEMlRTYlQUQlQTU=" title="https://baike.baidu.com/item/%E5%9E%82%E7%9B%B4%E5%90%8C%E6%AD%A5">å‚ç›´åŒæ­¥ï¼ˆVSyncï¼‰<i class="fa fa-external-link"></i></span>ï¼Œç©ç«æŠ€æ¸¸æˆçš„åŒå­¦åº”è¯¥éƒ½éå¸¸äº†è§£ï¼Œå®ƒæ˜¯ä¸æ˜¾ç¤ºå™¨åˆ·æ–°ç‡æŒ‚é’©çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºå™¨æœ‰å¤šä¸ªç¼“å­˜ï¼Œæ˜¾å¡åœ¨å…¶ä¸­ä¸€ä¸ªç¼“å­˜ç»˜å›¾ï¼Œè€Œæ˜¾ç¤ºå™¨åœ¨å¦å¤–çš„ç¼“å­˜è¯»å–å¸§æ•°æ®æ˜¾ç¤ºåœ¨å±å¹•ä¸Šï¼Œç„¶è€Œç”±äºæ˜¾å¡ç»˜å›¾çš„é€Ÿåº¦æ€»æ˜¯ä¼šæ¯”æ˜¾ç¤ºå™¨åˆ·æ–°çš„é€Ÿåº¦å¿«ï¼Œå¦‚æœæ˜¾å¡å®åœ¨æ²¡åœ°æ–¹ï¼Œæœ€åè·‘åˆ°æ˜¾ç¤ºå™¨è¯»å–å¸§çš„ç¼“å­˜å†™å…¥æ•°æ®çš„è¯ï¼Œé‚£æ˜¾ç¤ºå™¨å¯èƒ½ä¸ŠåŠéƒ¨æ˜¯ä¸€ä¸ªå¸§çš„ï¼Œä¸‹åŠéƒ¨åˆ†æˆå¦ä¸€ä¸ªå¸§çš„æ ·å­äº†ï¼Œé€ æˆç”»é¢æ’•è£‚ã€‚å› æ­¤ï¼Œæ˜¾ç¤ºå™¨é€šè¿‡è¿™ä¸ªæœºåˆ¶é˜»å¡æ˜¾å¡ç»˜å›¾è‡³å…¶å®ƒçš„ç¼“å­˜ï¼Œä»è€Œä¿è¯æ˜¾ç¤ºç”»é¢çš„æµç•…è¿è¡Œã€‚</p>
<p>ä¸€èˆ¬å®‰å“çš„appå¼€å¯äº†å‚ç›´åŒæ­¥ï¼Œå› æ­¤é€šè¿‡<code>æ•°æ®è¡Œæ•° - 1/Î”B</code>ï¼Œæˆ‘ä»¬å°±èƒ½è½»æ˜“åœ°è·å¾—fpsåŸå§‹å€¼ï¼Œå…¶ä¸­<code>Î”B</code>æŒ‡ä»£æœ€åä¸€ä¸ªå‚ç›´åŒæ­¥æ—¶åˆ»å‡å»ç¬¬ä¸€ä¸ªå‚ç›´åŒæ­¥æ—¶åˆ»çš„æ—¶é—´å·®ã€‚</p>
<p>ä½†é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘ç»˜å›¾æ‰å¸§ï¼ˆjankï¼‰çš„å› ç´ ã€‚æ‰€è°“æ‰å¸§æ­£å¥½ä¸å‰é¢çš„ç”»é¢æ’•è£‚ç›¸åï¼Œæ˜¯ç”±äºç³»ç»Ÿè°ƒåº¦é—®é¢˜ï¼Œå¯¼è‡´ä¸‹ä¸€ä¸ªVSyncä¿¡å·æ¥äº†æ—¶ï¼Œä¸‹ä¸€ä¸ªå›¾ç‰‡æ•°æ®æ²¡å‡†å¤‡å¥½ï¼Œè¿™æ ·æ˜¾ç¤ºå™¨å°±åˆæŠŠä¸Šä¸€å¸§æ•°æ®ç»™æ˜¾ç¤ºäº†ä¸€æ¬¡ã€‚é€šè¿‡ç»Ÿè®¡<code>ceil((C - A) / refresh-period)</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ¯ä¸€æ¬¡å‚ç›´åŒæ­¥ä¸‹ç»˜å›¾~ç¡¬ä»¶æ˜¾ç¤ºçš„æ ‡å‡†å€¼ï¼ˆjankflagï¼‰ï¼Œç†è®ºä¸Šè¿™ä¸ªæ ‡å‡†å€¼æ˜¯å®šå€¼ã€‚è€Œå®é™…æƒ…å†µä¸‹ï¼Œåªè¦è¿™ä¸ªæ ‡å‡†å€¼æœ‰å˜åŠ¨ï¼Œå°±è¯´æ˜æœ‰æ‰å¸§çš„æƒ…å†µäº†ã€‚</p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬é€šè¿‡fpsåŸå§‹å€¼ï¼Œå‡å»æ—¶é—´å·®å˜åŠ¨çš„æ¬¡æ•°ï¼ˆæ‰å¸§æ¬¡æ•°ï¼‰ï¼Œå°±èƒ½è·å¾—çœŸå®çš„fpså€¼äº†ã€‚</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½æµ‹è¯•</tag>
        <tag>Android</tag>
        <tag>æµ‹è¯•</tag>
        <tag>fps</tag>
        <tag>SurfaceFlinger</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€æµ‹è¯•äººç”Ÿã€‘MTSC2019å‚ä¼šè§é—»æ„Ÿæ‚Ÿ</title>
    <url>/2019/07/01/testlife/mtsc2019/</url>
    <content><![CDATA[<p>â€œæµ‹è¯•äººç”Ÿâ€ç¬¬ä¸€ç¯‡æ–‡ç« ï¼ŒçŒ®ç»™2019å¹´çš„ç§»åŠ¨æµ‹è¯•å¼€å‘å¤§ä¼šMTSCã€‚è¿™ä¸€æ¬¡ï¼Œéå¸¸è£å¹¸èƒ½å¤Ÿæ¥åˆ°åŒ—äº¬å›½é™…ä¼šè®®ä¸­å¿ƒå‚ä¼šï¼Œä¸€ç¹å›½å†…è´¨é‡ä¿éšœå·¥ä½œçš„ç°çŠ¶ä¸æœªæ¥çš„å‘å±•è¶‹åŠ¿ã€‚</p>
<p>åœ¨å­¦æ ¡æœŸé—´ï¼Œæˆ‘ä¹Ÿå‚ä¸è¿‡ä¸€äº›å°å‹çš„å­¦æœ¯ä¼šè®®ï¼Œä½†å¹¶ä¸å¦‚ä»Šå¹´çš„MTSCè¿™æ ·å£°åŠ¿æµ©å¤§ã€‚å·¥ä½œä¸€å¹´ä»¥æ¥å‚ä¸çš„ç¬¬ä¸€ä¸ªè®¨è®ºä¼šï¼Œå·²ç„¶æ˜¯å…¨å›½é¡¶ä¼šã€‚å€Ÿè¿™ä¸ªæœºä¼šï¼Œèƒ½å¤Ÿäº†è§£åˆ°ä¸šå†…æ’å¤´ä¼ä¸šåœ¨è´¨é‡ä¿éšœä¸šåŠ¡ä¸Šçš„è§£å†³æ–¹æ¡ˆï¼Œå¯¹äºè‡ªå·±åœ¨ä¸šåŠ¡ç†è§£ä¸Šä¼šé¢‡æœ‰å¸®åŠ©ã€‚æœ¬æ¬¡è®®ç¨‹ä¸­ï¼Œé™¤äº†å‚ä¸ç¬¬ä¸€å¤©ä¸»ä¼šåœºä¹‹å¤–ï¼Œç¬¬äºŒå¤©æ¸¸æˆæµ‹è¯•ä¸“åœºä¹Ÿå…¨ç¨‹å‚ä¸ï¼Œæ”¶è·é¢‡ä¸°ï¼Œæ„Ÿæ‚Ÿè‰¯å¤šï¼Œä¸€è¨€éš¾å°½ã€‚</p>
<a id="more"></a>
<p>æµ‹è¯•æµç¨‹å…¨è‡ªåŠ¨åŒ–æ˜¯è´¨é‡ç®¡ç†çš„ç»ˆææ¢¦æƒ³ï¼Œä½†æ˜¯ç°å®å¹¶ä¸å®Œç¾ï¼Œæ¯”å¦‚æ¸¸æˆé¢†åŸŸï¼Œåœ¨äº¤ä»˜é¢‘ç¹ã€ä»¥åŠåœºæ™¯é€»è¾‘å¤æ‚çš„é™åˆ¶ä¸‹ï¼Œå¿…é¡»è¦æœ‰ä¸€å®šæ‰‹å·¥æµ‹è¯•çš„æˆåˆ†ã€‚æ‰€ä»¥æ‰€è°“æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ–ï¼Œåº”è¯¥æ€æ ·ç•Œå®šæœ€ä¸ºåˆé€‚ï¼Ÿå…¶å®æˆ‘ä»¬ä¼šå‘ç°è‡ªåŠ¨åŒ–çš„ä¸€å¤§ç›®æ ‡æ˜¯ä¿ƒè¿›ç”Ÿäº§åŠ›ï¼Œåœ¨å¿…é¡»èµ‹äºˆäººåŠ›ç ”å‘çš„èƒŒæ™¯ä¸‹ï¼Œå¦‚ä½•å¿«é€ŸéªŒè¯äº§å“çš„è´¨é‡ï¼Œç›‘æ§ã€å®šä½&amp;è§£å†³é—®é¢˜ï¼ŒåŒæ—¶é¢„æµ‹é—®é¢˜ã€é¿å…ä»¥å‰çš„é—®é¢˜äº§ç”Ÿå‘¢ï¼Ÿå¸¦ç€è¿™äº›æœ‰å…³äºç”Ÿäº§æ•ˆç‡å¢å¼ºæ–¹é¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ‰ä¼šæƒ³åˆ°ä»¥æ¥å£è‡ªåŠ¨åŒ–ã€devopsä¸ºé¦–çš„ä¸€äº›åˆ—æµ‹è¯•æµç¨‹æŠ€æœ¯ã€‚å› æ­¤è¿½æ±‚è‡ªåŠ¨åŒ–ä¸æ˜¯å…³é”®ï¼Œå…³é”®æ˜¯å‘æ˜ç ”å‘è¿‡ç¨‹ä¸­çš„æ•ˆç‡ç—›ç‚¹ã€‚æ¯”å¦‚ç™¾åº¦çš„è‡ªåŠ¨æ„å»ºæƒé‡é‡åŒ–å¯ä»¥åŠæ—¶è¯„ä¼°äº¤ä»˜è´¨é‡ï¼Œèš‚èšçš„å¡åˆ†æ”¯ç®¡ç†èƒ½å¤Ÿæ˜¾è‘—é¿å…ç‰ˆæœ¬commit/pushé—®é¢˜ï¼Œè¿™äº›éƒ½æ˜¯éå¸¸ä¸é”™çš„ç‚¹å­ã€‚</p>
<p>ä»æ•´ä¸ªäº§å“çº¿è·Ÿæµ‹è¯•å²—ä½çš„èŒè´£ä¸Šçš„å…³ç³»æ¥çœ‹ï¼Œæµ‹è¯•äººå‘˜åœ¨å¤šæ•°æƒ…å†µä¸‹ä¼šæ‹…ä»»ä¸€ä¸ªæœåŠ¡è€…çš„è§’è‰²ã€‚æ¯”å¦‚æˆ‘è‡ªå·±ï¼Œä½œä¸ºæµ‹è¯•å¼€å‘ï¼ŒèŒè´£ä¸ä»…æ˜¯è§£å†³æŠ€æœ¯é—®é¢˜ï¼Œæ¢ç©¶åº•å±‚ç–¯ç‹‚ç è§¦ä¹‹ç±»ï¼Œè¿˜éœ€è¦æ¨åŠ¨è‡ªå·±çš„äº§å“ï¼Œä¸ä¸šåŠ¡çº¿æ²Ÿé€šè·Ÿè¿›ï¼Œäº†è§£ä¸šåŠ¡çº¿ä½¿ç”¨äº§å“çš„æ–¹å¼ä¸æ”¶ç›Šï¼Œå¹¶å€Ÿæ­¤æœºä¼šç»§ç»­æŒ–æ˜æ½œåœ¨éœ€æ±‚ã€‚å› æ­¤æˆ‘å¥—ç”¨äº†ä¸€ä¸ªç¼©å†™ï¼Œæå‡ºTaaSçš„æ¦‚å¿µâ€”â€”Test as a Serviceï¼Œæ¥å½¢å®¹æµ‹è¯•äººå‘˜ã€å°¤å…¶æ˜¯æµ‹è¯•å¼€å‘äººå‘˜çš„å·¥ä½œã€‚</p>
<p>ä»TaaSçš„è§’åº¦è€Œè¨€ï¼Œæµ‹è¯•å¼€å‘å¯¹äºä¸šåŠ¡çº¿çš„æœåŠ¡æ˜¯ä¸¤ä¸ªæ–¹å‘çš„ã€‚ç¬¬ä¸€ç§æ˜¯ç”±å¤–è€Œå†…å‹ï¼Œè¾ƒå¤šä»¥å¹³å°+æ’ä»¶çš„æ–¹å¼å­˜åœ¨ï¼Œå·¥ä½œç±»ä¼¼å¤–åŒ…çš„æ€§è´¨ï¼Œæ¯”å¦‚WeTestè·ŸUWAã€‚è¿™ä¸€ç±»æµ‹è¯•ä¸šåŠ¡æ›´åŠ å…³æ³¨äºå·²æ„å»º/å¾…äº¤ä»˜äº§å“çš„ç»¼åˆè´¨é‡è¯„ä¼°ï¼Œæ³¨é‡C/Sæ€§èƒ½ã€å®‰å…¨ã€é™æ€æ‰«æï¼Œæˆ–æ˜¯é’ˆå¯¹ç‰¹å®šæ¡†æ¶/å¼•æ“çš„ç²¾å‡†æµ‹è¯•æ–¹é¢ã€‚ç¬¬äºŒç§æ˜¯éšæ³¢é€æµå‹ï¼Œä¸ä¸šåŠ¡çº¿è€¦åˆåº¦è¾ƒé«˜ï¼Œä¸»è¦é’ˆå¯¹ç ”å‘æœŸæœªäº¤ä»˜ç”Ÿäº§ç‰ˆæœ¬å‰çš„è´¨é‡æ§åˆ¶ï¼Œåƒæ¥å£è‡ªåŠ¨åŒ–/å›å½’ã€è¦†ç›–ç‡ã€commit hookã€åè®®æµ‹è¯•ä¹‹ç±»çš„é’ˆå¯¹æ€§æ•ˆç‡å·¥å…·ï¼Œæ›´æ˜“åœ¨é¡¹ç›®ç ”å‘æ—©æœŸã€æœªäº¤ä»˜ç”Ÿäº§ç‰ˆæœ¬æ—¶è¿›è¡Œæ¨åŠ¨ã€‚ä¸ç®¡æ˜¯å“ªä¸€ç§æƒ…å†µï¼Œæå‡ç ”å‘æ•ˆç‡ï¼Œæ»¡è¶³é¡¹ç›®éœ€æ±‚ï¼Œä¼˜å…ˆçº§ä¸€ç›´å¾—æ’ç¬¬ä¸€ã€‚</p>
<p>è¿™ä¸€å±Šå¤§ä¼šåŒæ ·æ¶Œç°äº†è®¸å¤šæ™ºèƒ½ç§‘æŠ€/AIæµ‹è¯•æ–¹é¢çš„ä¸»é¢˜ï¼Œç‹­ä¹‰åœ°è®²ï¼Œä¹Ÿå°±æ˜¯æœºå™¨å­¦ä¹ æŠ€æœ¯çš„åº”ç”¨ã€‚æ¯”å¦‚ä»Šå¹´çš„è…¾è®¯ï¼Œåœ¨æ¸¸æˆUIè‡ªåŠ¨åŒ–æµ‹è¯•æ–¹é¢å–å¾—äº†å¾ˆå¤§çš„è¿›å±•ï¼Œå®ç°äº†æ‰‹æ¸¸CFçš„Botã€‚è…¾è®¯çš„è¿™ä¸€åœºæ¼”è®²å¸å¼•äº†å°è®²å®¤ä¸¤å€æ¤…å­æ•°çš„è§‚ä¼—ï¼ŒåŒè¡Œä»¬å¯¹é«˜æ–°æŠ€æœ¯åº”ç”¨äºè´¨é‡ç®¡ç†ä¸šåŠ¡é¢‡æœ‰å…´è‡´ï¼Œä½†ä¸å¯å¦è®¤çš„æ˜¯ï¼Œè…¾è®¯åœ¨å‘å±•Turing Labçš„èƒŒåï¼Œæ˜¯å…¶å¤šå¹´çš„æ¸¸æˆç ”å‘ç®¡ç†ç»éªŒä»¥åŠè´¨é‡ç®¡ç†ä½“ç³»/æŠ€æœ¯åŸºå»ºï¼Œæ‰èƒ½å¤Ÿæ”¯æŒä»–ä»¬åœ¨é«˜æ–°æŠ€æœ¯æ–¹é¢çš„ç ”ç©¶ï¼Œå¹¶ä¸”å¦ä¸€æ–¹é¢ï¼Œè¦å¾€AIæµ‹è¯•æŠ€æœ¯è¿›è¡Œåº”ç”¨ï¼ŒæŠ€æœ¯æ·±åº¦æ˜¯å…¶æ¬¡ï¼Œè€ŒAIèƒ½å¤Ÿè§£å†³ä¸šåŠ¡ä¸­çš„å“ªäº›ç—›ç‚¹ï¼Œå¦‚ä½•è·å–è¶³é‡æœ‰ä»·å€¼çš„æ•°æ®é›†ï¼Œå¦‚ä½•æ‰“é€šæ•´ä¸ªAIæµ‹è¯•æµç¨‹ï¼Œæ‰æ˜¯çœŸæ­£éœ€è¦æ€è€ƒçš„ä¸œè¥¿ã€‚</p>
<p>å› æ­¤ï¼Œæ•´ä¸ªè‡ªåŠ¨åŒ–è´¨é‡ç®¡ç†ä¹Ÿæ˜¯è¿™æ ·â€”â€”å¦‚ä½•è®©è´¨é‡æŠŠæ§æ›´æ°å½“åœ°å¡ä½ä¸šåŠ¡ç‚¹ï¼Œä»è€Œæ•ˆç‡åé¦ˆï¼Œæ‰æ˜¯æˆ‘ä»¬åšè‡ªåŠ¨åŒ–æµ‹è¯•æœåŠ¡æ‰€è¦ç•™æ„çš„åœ°æ–¹ã€‚</p>
<p>é€šç¯‡æ–‡ç« ä»…ä¸ºä¸ªäººè§è§£ã€‚è™½ç„¶ç°åœ¨è‡ªå·±çš„ä¸šåŠ¡ç»éªŒä¸å¤Ÿä¸°å¯Œï¼Œçœ¼ç•Œä¹Ÿä¸ä¸€å®šå¤Ÿå®½å¹¿ï¼Œä½†å¸Œæœ›å¤šå¹´ä¹‹åï¼Œå†æ¬¡çœ‹åˆ°è‡ªå·±å†™è¿‡çš„æ–‡ç« ï¼Œå¯ä»¥æ¸©æ•…è€ŒçŸ¥æ–°ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹ï¼Œå¼€äº†çœ¼ç•Œï¼Œæ¶¨äº†è§è¯†ï¼Œå°±æ˜¯å¾ˆçˆ½ï¼</p>
]]></content>
      <categories>
        <category>æµ‹è¯•äººç”Ÿ</category>
      </categories>
      <tags>
        <tag>è´¨é‡ç®¡ç†</tag>
        <tag>æµ‹è¯•</tag>
        <tag>MTSC</tag>
        <tag>QA</tag>
        <tag>TaaS</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘æ–°æ¬¾å‘½ä»¤è¡Œå·¥å…·terminusæµ‹è¯•</title>
    <url>/2019/06/22/githubdiscovery/terminus/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å…­æœˆçš„Githubè¶‹åŠ¿æ¦œå•ä¸Šï¼Œé™¤å»ä¸€äº›æ–‡ä¹¦ã€æ•™ç¨‹æ€§è´¨çš„é¡¹ç›®å¤–ï¼Œå¤§éƒ¨åˆ†é¡¹ç›®å¹¶éè‡ªå·±æ‰€é’ˆå¯¹çš„é¢†åŸŸã€‚å› æ­¤ï¼Œæœæ–­è¯•æ°´äº†ä¸€æ¬¾è½¯ä»¶ï¼Œ</p>
<p>Windowsç³»ç»Ÿä¸‹çš„å‘½ä»¤è¡Œå·¥å…·é…ç½®ï¼Œä¸€ç›´æ˜¯å¼€å‘è€…ä»¬çº ç»“çš„ç—›ç‚¹ã€‚åœ¨è¿™ä¸€å—ï¼Œ<span class="exturl" data-url="aHR0cHM6Ly9jbWRlci5uZXQv" title="https://cmder.net/">cmder<i class="fa fa-external-link"></i></span>ã€<span class="exturl" data-url="aHR0cHM6Ly9tb2JheHRlcm0ubW9iYXRlay5uZXQv" title="https://mobaxterm.mobatek.net/">MobaXTerm<i class="fa fa-external-link"></i></span>ç”šè‡³å³å°†ä¸Šçº¿çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL21pY3Jvc29mdC90ZXJtaW5hbA==" title="https://github.com/microsoft/terminal">Windows Terminal<i class="fa fa-external-link"></i></span>ï¼Œéƒ½æ˜¯ä¸é”™çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>è€Œä»Šå¤©ä»‹ç»çš„è¿™ä¸€æ¬¾è½¯ä»¶â€”â€”<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0V1Z2VueS90ZXJtaW51cw==" title="https://github.com/Eugeny/terminus">terminus<i class="fa fa-external-link"></i></span>ï¼Œåœ¨å…­æœˆä»½è·»èº«è¶‹åŠ¿æ’è¡Œå‰åï¼Œåˆ™ä¼¼ä¹æ›´åŠ ç¬¦åˆæˆ‘ä»¬å¯¹å‘½ä»¤è¡Œå·¥å…·çš„å½±å“ã€‚ä½œä¸ºä¸€ä¸ªç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œterminusé‡‡ç”¨Angular + Electronå¼€å‘ï¼ŒåŒ…å«äº†ç»ˆç«¯æ¨¡æ‹Ÿå™¨å¿…å¤‡çš„è®¸å¤šåŠŸèƒ½ï¼Œå…¼å…·ç¾è§‚ä¸å®ç”¨æ€§ã€‚æˆ‘ä»¬å¯ä»¥é¦–å…ˆæ¥çœ‹çœ‹ï¼Œterminusçš„ç•Œé¢é•¿ä»€ä¹ˆæ ·å­~</p>
<a id="more"></a>
<p><img src="/uploads/githubdiscovery/terminus/main.PNG" alt="terminusç•Œé¢"></p>
<p>ä¸‹é¢ï¼Œè®©æˆ‘ä»¬ä¸€èµ·è¯•æ°´ä¸€ä¸‹terminuså§~</p>
<h2 id="terminusç‰¹æ€§"><a href="#terminusç‰¹æ€§" class="headerlink" title="terminusç‰¹æ€§"></a>terminusç‰¹æ€§</h2><p>ä»¥æœ€æ–°ï¼ˆ1.0.82ï¼‰çš„Windowsç‰ˆä¸ºä¾‹ï¼ŒterminusåŒ…å«çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>å¤šæ ‡ç­¾ç»ˆç«¯æ”¯æŒï¼ˆcmdã€powershellã€bashï¼‰ä»¥åŠé¢å¤–ç»ˆç«¯é…ç½®</li>
<li>å¤šçš®è‚¤/ä¸»é¢˜é…è‰²å®šåˆ¶ï¼ˆåµŒå…¥ç»ˆç«¯çš®è‚¤æ•°åç§ï¼‰</li>
<li>SSHæ”¯æŒä¸ç®¡ç†</li>
<li>æ’ä»¶ã€å¿«æ·é”®ã€å³é”®èœå•æ”¯æŒ</li>
</ul>
<p>ä»åŠŸèƒ½çš„è¦†ç›–åº¦æ¥è®²ï¼Œä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„ç»ˆç«¯ç¨‹åºæ¥è¯´ï¼Œæ»¡è¶³å¤šæ ‡ç­¾ã€å³é”®èœå•ä»¥åŠSSHï¼Œå·²ç»éå¸¸æ£’äº†ã€‚</p>
<h2 id="terminusæµ‹è¯•"><a href="#terminusæµ‹è¯•" class="headerlink" title="terminusæµ‹è¯•"></a>terminusæµ‹è¯•</h2><p>ä½œä¸ºä¸€ä¸ªæµ‹è¯•äººå‘˜ï¼Œæµ‹è¯•ä¸€ä¸ªæ²¡æœ‰ç­–åˆ’æ–‡æ¡£çš„æˆå“æ—¶ï¼Œå¯ä»¥éµå¾ªä»¥ä¸‹çš„æµ‹è¯•æ€è·¯ï¼š</p>
<ul>
<li>ä»æ™®é€šç”¨æˆ·è§’åº¦è€Œè¨€ï¼Œæœ€åŸºæœ¬çš„æ“ä½œæ˜¯å¦èƒ½å¤Ÿé¡ºåˆ©è·‘é€šï¼Ÿ</li>
<li>ä»DIYç”¨æˆ·è§’åº¦è€Œè¨€ï¼Œå„ç§ä¸é…ç½®å…³è”çš„ç”¨ä¾‹æ“ä½œæ˜¯å¦ä¹Ÿèƒ½é¡ºåˆ©ï¼Ÿ</li>
<li>çŒœæµ‹äº§å“è®¾è®¡çš„äº®ç‚¹ä¹‹å¤„ï¼Œè¿™äº›äº®ç‚¹ä¹‹å¤„çš„æ“ä½œç”¨ä¾‹æ˜¯å¦èƒ½å¤Ÿè·‘é¡ºåˆ©ï¼Ÿ</li>
</ul>
<p>ä»¥åŠä»¥ä¸‹çš„æµ‹è¯•ç­–ç•¥ï¼š</p>
<ul>
<li>æµ‹è¯•å°½é‡å…³æ³¨æ¶æ€§bugï¼Œäº¦å³é‚£äº›æ˜¾è‘—å½±å“æˆ–é˜»å¡ç”¨æˆ·çš„è½¯ä»¶æ“ä½œçš„bug</li>
<li>ä¸åˆ»æ„å…³å¿ƒbugçš„æˆå› ï¼Œä½†è¦ä¸ºå¼€å‘æä¾›è¶³å¤Ÿçš„ä¿¡æ¯å¸®åŠ©ä»–ä»¬å®šä½bug</li>
</ul>
<p>éµå¾ªä¸Šè¿°æ€è·¯ä¸ç­–ç•¥ï¼ŒæŒ‰ç…§æµ‹è¯•bugæå•çš„æ ‡å‡†ï¼Œå°åˆ—è‡ªå®¶Windowsä¸‹1.0.82ç‰ˆæœ¬å‡ ä¸ªæµ‹åˆ°çš„æ¶æ€§bugï¼š</p>
<h3 id="åº”ç”¨è®¾ç½®ç•Œé¢ä¸‹æ— æ³•æ–°å»ºç»ˆç«¯-SSHè¿æ¥"><a href="#åº”ç”¨è®¾ç½®ç•Œé¢ä¸‹æ— æ³•æ–°å»ºç»ˆç«¯-SSHè¿æ¥" class="headerlink" title="åº”ç”¨è®¾ç½®ç•Œé¢ä¸‹æ— æ³•æ–°å»ºç»ˆç«¯/SSHè¿æ¥"></a>åº”ç”¨è®¾ç½®ç•Œé¢ä¸‹æ— æ³•æ–°å»ºç»ˆç«¯/SSHè¿æ¥</h3><ul>
<li>ç¼ºé™·æè¿°ï¼šä»…å½“è®¾ç½®ç•Œé¢çš„Applicationæ ä¸‹ï¼Œæ–°å»ºterminalåä¸æ˜¾ç¤ºç»ˆç«¯ï¼Œå¹¶ä¸”æ— æ³•è¿æ¥SSH</li>
<li>å¤ç°è¿‡ç¨‹ï¼šç‚¹å‡»â€œè®¾ç½®â€æŒ‰é’®è¿›å…¥Applicationæ ï¼Œå†ç‚¹å‡»æ–°å»ºç»ˆç«¯æˆ–SSHæŒ‰é’®å‡ä¸æ˜¾ç¤ºç•Œé¢ï¼Œä¸”ç»ˆç«¯æ ‡ç­¾é¡µæ— æ³•å…³é—­</li>
<li>å¤‡æ³¨ä¿¡æ¯ï¼šåˆ‡æ¢å…¶å®ƒè®¾ç½®é¡¹æˆ–å…¶å®ƒæ ‡ç­¾é¡µåï¼Œé˜»å¡çš„æ–°å»ºç»ˆç«¯/è¿æ¥SSHæ“ä½œå¯ä»¥ç»§ç»­</li>
<li>é”™è¯¯è¾“å‡ºï¼šangular moduleæœ‰ä»undefinedè¯»å–appVersionå±æ€§çš„è¡Œä¸º</li>
<li>å›¾ç‰‡æè¿°ï¼šè§ä¸‹= =</li>
</ul>
<p><img src="/uploads/githubdiscovery/terminus/main.PNG" alt="ä»è®¾ç½®æ–°å»ºç»ˆç«¯ä¸æ˜¾ç¤º"></p>
<h3 id="æ— æ³•å†æ¬¡æ‰“å¼€terminus"><a href="#æ— æ³•å†æ¬¡æ‰“å¼€terminus" class="headerlink" title="æ— æ³•å†æ¬¡æ‰“å¼€terminus"></a>æ— æ³•å†æ¬¡æ‰“å¼€terminus</h3><ul>
<li>ç¼ºé™·æè¿°ï¼šå½“terminusä¸ºå¼€å¯çŠ¶æ€æ—¶ï¼Œæ— æ³•å†æ¬¡æ‰“å¼€terminus</li>
<li>å¤ç°è¿‡ç¨‹ï¼šå¼€å¯ä¸€ä¸ªterminusç¨‹åºåï¼Œå†æ¬¡æ‰“å¼€terminusï¼ŒåŸæœ‰çš„terminuså…³é—­ï¼Œæ–°çš„ç¨‹åºä¸å¼€å¯</li>
<li>å¤‡æ³¨ï¼šåŸæœ‰terminuså…³é—­åï¼Œå†æ¬¡æ‰“å¼€terminusï¼ŒåŸå…ˆå¼€å¯çš„æ ‡ç­¾ä¾ç„¶å­˜åœ¨</li>
</ul>
<h3 id="åˆ‡å›æ’ä»¶è®¾ç½®ç•Œé¢ä¸‹æ‹‰æ ä¸æ˜¾ç¤º"><a href="#åˆ‡å›æ’ä»¶è®¾ç½®ç•Œé¢ä¸‹æ‹‰æ ä¸æ˜¾ç¤º" class="headerlink" title="åˆ‡å›æ’ä»¶è®¾ç½®ç•Œé¢ä¸‹æ‹‰æ ä¸æ˜¾ç¤º"></a>åˆ‡å›æ’ä»¶è®¾ç½®ç•Œé¢ä¸‹æ‹‰æ ä¸æ˜¾ç¤º</h3><ul>
<li>ç¼ºé™·æè¿°ï¼šå½“æœ‰å…¶ä½™ç»ˆç«¯æ ‡ç­¾æƒ…å†µä¸‹ï¼Œæ’ä»¶è®¾ç½®é¡µé¢æ˜¾ç¤ºé»˜è®¤æ’ä»¶æœç´¢ç»“æœåï¼Œåˆ‡ç»ˆç«¯å†åˆ‡å›ï¼Œä¸‹æ‹‰æ ä¸æ˜¾ç¤º</li>
<li>å¤ç°è¿‡ç¨‹ï¼šé¦–å…ˆæ–°å»ºç»ˆç«¯ï¼Œè€Œåæ–°å»ºæ’ä»¶è®¾ç½®æ ‡ç­¾ç­‰å¾…å¼‚æ­¥æ’ä»¶æœç´¢æ“ä½œå®Œæˆï¼Œå†ç‚¹å‡»ç»ˆç«¯æ ‡ç­¾ï¼Œå†å›æ¥ç‚¹å‡»æ’ä»¶è®¾ç½®æ ‡ç­¾</li>
<li>å¤‡æ³¨ï¼šéœ€è¦å†ä¸€æ¬¡å¼€å¯æ’ä»¶è®¾ç½®æ ‡ç­¾ï¼Œæ‰å¯ä»¥æ˜¾ç¤ºä¸‹æ‹‰æ </li>
<li>å›¾ç‰‡æè¿°ï¼šè§ä¸‹= =</li>
</ul>
<p><img src="/uploads/githubdiscovery/terminus/plugin.PNG" alt="åˆ‡å›æ’ä»¶è®¾ç½®ç•Œé¢ä¸‹æ‹‰æ ä¸æ˜¾ç¤º"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»å¼€å‘çš„è§’åº¦è€Œè¨€ï¼Œå…ˆç¡®å®šéœ€æ±‚ï¼Œå†™æ¨¡ç‰ˆï¼Œåé¢å‡ºäº†å…·ä½“bugå†è¿­ä»£ï¼Œæ˜¯ä¸€ä¸ªå¦¥å–„çš„è·¯å­ã€‚</p>
<p>ä»è¯•æ°´ç»“æœçœ‹æ¥ï¼Œterminusä¸ºæˆ‘ä»¬å¼€å‘å‘½ä»¤è¡Œå·¥å…·å¼€è¾Ÿäº†æ›´åŠ ç²¾è‡´çš„æ€è·¯ï¼Œä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„è½¯ä»¶ï¼Œä»åŠŸèƒ½çš„å®Œå¤‡æ€§è€Œè¨€ï¼Œå·²ç»èƒ½å¤Ÿå…·å¤‡æ—¥å¸¸ä½¿ç”¨æ€§ã€‚</p>
<p>è™½ç„¶æœ‰äº›æ¶æ€§bugï¼Œå¹¶ä¸”ä¹Ÿæœ‰äº›GUIæ¸²æŸ“ä¸Šçš„ç‘•ç–µï¼Œä½†å¹¶ä¸å¦¨ç¢æ•´ä¸ªç ”å‘çš„å¤§æ–¹å‘ï¼Œå› æ­¤æˆ‘ä»¬æœŸæœ›å¼€å‘äººå‘˜èƒ½å¤Ÿåé¢æŠ½ç©ºä¸€ä¸ªä¸ªè¡¥æ­£ã€‚</p>
<p>æ•…ç°åœ¨è¿™ä¸ªæ—¶æ®µï¼Œæ²¡æœ‰ç”¨è¿‡terminusçš„åŒå­¦ä»¬ï¼Œå¯ä»¥è¯•ç”¨ä¸€ä¸‹å•¦~å¦‚æœè§‰å¾—ä¸é¡ºæ‰‹ï¼Œä¹Ÿè¯·ç»™äºˆä¸€ç‚¹è€å¿ƒâ€”â€”æœŸå¾…terminusåç»­çš„ç‰ˆæœ¬å§ï¼</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>æ•ˆç‡å·¥å…·</tag>
        <tag>shell</tag>
        <tag>terminus</tag>
        <tag>terminal</tag>
        <tag>æµ‹è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘çŠ¹è±«å°±ä¼šè´¥åŒ—â€”â€”å…ƒè¡¨metatableè§£æ</title>
    <url>/2019/06/12/luatalk/metatable/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨luaçš„å­¦ä¹ è¿‡ç¨‹å½“ä¸­ï¼Œå…ƒè¡¨metatableçš„æ¦‚å¿µåŠç”¨æ³•æ˜¯å¸¸è§çš„éšœç¢ä¹‹ä¸€</p>
<p>å…ƒè¡¨ï¼Œåœ¨å…¶å®ƒluaæ‚è°ˆç­‰éƒ½æåˆ°è¿‡ï¼Œæ˜¯ä¸€ç§æè¿°luaæ•°æ®çš„å±æ€§ä»¥åŠè¡Œä¸ºçš„è¡¨ã€‚è™½ç„¶å®˜æ–¹ç»™äº†setã€accountç­‰ä¾‹å­è¯¦ç»†è®²è§£äº†metatableï¼Œä½†æ€»è¿˜æ˜¯ç¼ºä¹äº›æç‚¼ã€‚ä¸ºäº†å¹²ç¿»è¿™ä¸ªç—›ç‚¹ï¼Œè¿™æ¬¡ï¼Œæœæ–­å¼ºä¸Šmetatableçš„ç²¾é«“ã€‚æ¯•ç«Ÿï¼ŒçŠ¹è±«å°±ä¼šè´¥åŒ—~</p>
<h2 id="å…ƒè¡¨æœ‰ä»€ä¹ˆ"><a href="#å…ƒè¡¨æœ‰ä»€ä¹ˆ" class="headerlink" title="å…ƒè¡¨æœ‰ä»€ä¹ˆ"></a>å…ƒè¡¨æœ‰ä»€ä¹ˆ</h2><p>æˆ‘ä»¬é¦–å…ˆå°±ä¼šæœ‰ç–‘é—®ï¼šé€šè¿‡å“ªäº›å±æ€§æŒ‡æ ‡ï¼Œå¯ä»¥æè¿°luaçš„æ•°æ®å‘¢ï¼Ÿé€šè¿‡<span class="exturl" data-url="aHR0cHM6Ly93d3cubHVhLm9yZy9tYW51YWwvNS4zL21hbnVhbC5odG1sIzIuNA==" title="https://www.lua.org/manual/5.3/manual.html#2.4">å®˜æ–¹æ‰‹å†Œ<i class="fa fa-external-link"></i></span>ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰¾åˆ°ç­”æ¡ˆã€‚</p>
<p>åœ¨luaä¸­ï¼Œæˆ‘ä»¬æŠŠå…ƒè¡¨ä¸­çš„keyï¼Œä¹Ÿå°±æ˜¯æè¿°æ•°æ®çš„å±æ€§æŒ‡æ ‡ï¼Œç§°ä¹‹ä¸ºevent</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰çš„eventåˆ†ä¸ºä¸¤ç»„ï¼ˆæ‹¬å·ä¸­ä»£è¡¨luaé‡Œçš„è¯­æ³•ï¼‰ï¼š</p>
<ol>
<li><p>æè¿°å…¶åŸºç¡€æ€§è´¨çš„ï¼š</p>
<ul>
<li>å±æ€§ç´¢å¼•ï¼š<code>__index</code>ï¼Œ<code>__newindex</code></li>
<li>é•¿åº¦ï¼š<code>__len(#)</code></li>
<li>å‡½æ•°å½¢å¼ï¼š<code>__call</code></li>
<li>å­—ç¬¦ä¸²å½¢å¼ï¼š<code>__tostring</code></li>
</ul>
</li>
<li><p>æè¿°å…¶è¿ç®—çš„ï¼š</p>
<ul>
<li>æ™®é€šè¿ç®—ï¼š<code>__add(åŠ +)</code>ï¼Œ<code>__sub(å‡-)</code>ï¼Œ<code>__mul(ä¹˜*)</code>ï¼Œ<code>__div(é™¤/)</code>ï¼Œ<code>__mod(æ¨¡%)</code>ï¼Œ<code>__pow(ä¹˜æ–¹^)</code>ï¼Œ<code>__unm(è´Ÿ-)</code>ï¼Œ<code>__idiv(å–æ•´é™¤//)</code></li>
<li>ä½è¿ç®—ï¼š<code>__band(ä¸&amp;)</code>ï¼Œ<code>__bor(æˆ–|)</code>ï¼Œ<code>__bxor(å¼‚æˆ–~)</code>ï¼Œ<code>__bnot(é~)</code>ï¼Œ<code>__shl(å·¦ç§»&lt;&lt;)</code>ï¼Œ<code>__shr(å³ç§»&gt;&gt;)</code></li>
<li>å…³ç³»è¿ç®—ï¼š<code>__concat(è”ç»“..)</code>ï¼Œ<code>__eq(å…¨ç­‰==)</code>ï¼Œ<code>__lt(å°äº&lt;)</code>ï¼Œ<code>__lte(å°äºç­‰äº&lt;=)</code></li>
</ul>
</li>
</ol>
<h2 id="å…ƒè¡¨æ€ä¹ˆç”¨"><a href="#å…ƒè¡¨æ€ä¹ˆç”¨" class="headerlink" title="å…ƒè¡¨æ€ä¹ˆç”¨"></a>å…ƒè¡¨æ€ä¹ˆç”¨</h2><p>å…ˆæ¥çœ‹ä¸€æ®µç¨‹åºå§~</p>
<a id="more"></a>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> mt = &#123;</span><br><span class="line">    __band = <span class="function"><span class="keyword">function</span> <span class="params">(a, b)</span></span></span><br><span class="line">        <span class="built_in">print</span>(a)</span><br><span class="line">        <span class="built_in">print</span>(b)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">12345</span></span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">    <span class="built_in">__call</span> = <span class="function"><span class="keyword">function</span> <span class="params">(x)</span></span></span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="keyword">end</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> t = <span class="built_in">setmetatable</span>(&#123;&#125;, mt)</span><br><span class="line"><span class="keyword">local</span> s = <span class="built_in">debug</span>.<span class="built_in">setmetatable</span>(<span class="string">"666"</span>, mt)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n-------------------------------------------------\n"</span>)</span><br><span class="line"><span class="keyword">local</span> i = <span class="built_in">debug</span>.<span class="built_in">setmetatable</span>(t &amp; s, mt)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n-------------------------------------------------\n"</span>)</span><br><span class="line">i()</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºæ¥ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯è¿™ä¸ª~</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">-------------------------------------------------</span><br><span class="line"></span><br><span class="line">table: 0000000000dca020</span><br><span class="line">666</span><br><span class="line"></span><br><span class="line">-------------------------------------------------</span><br><span class="line"></span><br><span class="line">12345</span><br></pre></td></tr></table></figure>
<p>è¿™å…¶ä¸­å¦‚ä½•è¿›è¡Œï¼Ÿé¦–å…ˆæˆ‘ä»¬çœ‹ä»£ç ï¼Œè¡¨mtè¡¨ç¤ºå…ƒè¡¨ï¼Œå®šä¹‰äº†ä»¥ä¸‹æ•°æ®äº¤äº’è¡Œä¸º:</p>
<ul>
<li>â€œé€»è¾‘ä¸â€æ“ä½œbandï¼Œå˜æˆæŠŠé€»è¾‘ä¸çš„ä¸¤è¾¹æ‰“å°å‡ºæ¥ï¼Œä¸ç®¡ä¸¤è¾¹æ˜¯å•¥ï¼Œç„¶åè¿”å›æ•°å€¼12345</li>
<li>â€œå‡½æ•°è°ƒç”¨â€æ“ä½œcallï¼Œå˜æˆç›´æ¥æŠŠå‡½æ•°è°ƒç”¨è€…æ‰“å°å‡ºæ¥ï¼Œä¸ç®¡è°ƒç”¨è€…åˆ°åº•æ˜¯å•¥æ•°æ®ç±»å‹</li>
</ul>
<p>ç„¶åå°±å¯ä»¥å¼€å§‹éªšæ“ä½œäº†~åœ¨luaä¸­ï¼Œä¸€èˆ¬åªæœ‰tableç±»å‹çš„æ•°æ®å¯ä»¥setmetatableï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è°ƒç”¨debugåº“çš„è¯ï¼Œå°±å¯ä»¥ä¸ºä»»æ„ç±»å‹çš„æ•°æ®è®¾ç½®å…ƒè¡¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆå¯ä»¥è¯•è¯•å­—ç¬¦ä¸²ä¸è¡¨ä¹‹é—´çš„äº¤äº’~</p>
<p>æ–°å»ºè®¾ç½®äº†å…ƒè¡¨çš„ç©ºè¡¨tä¸â€666â€å­—ç¬¦ä¸²sï¼Œç„¶åï¼Œä¸ºå®ƒä»¬è®¾ç½®å…ƒè¡¨ã€‚è¿™æ ·å®ƒä»¬å°±å¯ä»¥äº¤äº’å•¦~</p>
<p>å½“æ‰§è¡Œ<code>local i = t &amp; s</code>çš„æ—¶å€™ï¼Œåœ¨<code>t &amp; s</code>çš„æ“ä½œä¸­ï¼Œæ ¹æ®å…ƒè¡¨<code>__band</code>å®šä¹‰ï¼Œä¼šæŠŠtè·Ÿséƒ½printå‡ºæ¥ï¼Œç„¶åè¿”å›12345ç»™iã€‚iæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä½†ä»ç„¶å¯ä»¥è¢«è®¾ç½®ä¸Šå…ƒè¡¨ã€‚ç„¶åå†è¯•è¯•çœ‹è°ƒç”¨içš„æ“ä½œ<code>i()</code>ï¼Œæ ¹æ®å…ƒè¡¨çš„<code>__call</code>é€»è¾‘ï¼Œå°±ä¼šæ‰“å°å‡ºiæ¥äº†ã€‚</p>
<p>å¾ˆé»‘ç§‘æŠ€å§~</p>
<h2 id="å…ƒè¡¨-amp-é¢å‘å¯¹è±¡"><a href="#å…ƒè¡¨-amp-é¢å‘å¯¹è±¡" class="headerlink" title="å…ƒè¡¨&amp;é¢å‘å¯¹è±¡"></a>å…ƒè¡¨&amp;é¢å‘å¯¹è±¡</h2><p>å…ƒè¡¨æœ€å¸¸è§çš„ç”¨é€”æ˜¯luaçš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå…·ä½“è€Œè¨€ï¼Œåˆ™æ˜¯é‡‡ç”¨åŸå‹æ¨¡å¼è¿›è¡Œã€‚æ–°å»ºçš„å¯¹è±¡å®ä¾‹åˆå§‹åŒ–æ—¶ç»§æ‰¿åŸå‹çš„æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨ä¿®æ”¹å±æ€§çš„è¿‡ç¨‹ä¸­ä¸å½±å“åŸå‹çš„å˜åŒ–ã€‚</p>
<p>æˆ‘ä»¬çœ‹çœ‹åŸå‹ç±»çš„å®ç°ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> prototype = &#123;</span><br><span class="line">    tag = <span class="string">"PROTOTYPE"</span>,</span><br><span class="line">    value = <span class="string">"hello world"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prototype:print</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> <span class="built_in">pairs</span>(self) <span class="keyword">do</span></span><br><span class="line">        <span class="built_in">print</span>(k .. <span class="string">": "</span> .. <span class="built_in">tostring</span>(v))</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">prototype:new</span><span class="params">(o)</span></span></span><br><span class="line">    o = o <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">setmetatable</span>(o, &#123;</span><br><span class="line">        <span class="built_in">__index</span> = self,</span><br><span class="line">        <span class="comment">-- __newindex = function (t, k, v) rawset(t, k, v) end</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">setmetatable</span>(prototype, &#123; <span class="built_in">__call</span> = prototype.new &#125;)</span><br></pre></td></tr></table></figure>
<p>åœ¨åŸå‹ç±»çš„åŸè¡¨ä¸­ï¼ŒæŠŠ<code>__call</code>è®¾ç½®ä¸ºæ„é€ å‡½æ•°newï¼Œè¿™ä¹Ÿç¬¦åˆæˆ‘ä»¬ä¸€è´¯çš„è°ƒç”¨æ„é€ å‡½æ•°çš„ä¹ æƒ¯ã€‚å¯¹äºæ¯ä¸€ä¸ªæ–°å®ä¾‹ï¼Œæˆ‘ä»¬å°†å…ƒè¡¨ä¸­çš„<code>__index</code>è®¾ç½®ä¸ºprototypeè‡ªå·±ï¼Œå°†<code>__newindex</code>è®¾å®šä¸ºrawsetæœºåˆ¶ã€‚</p>
<p><code>__index</code>è¡¨ç¤ºå±æ€§æŸ¥æ‰¾ç´¢å¼•/æ–¹æ³•ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªè¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å¯¹äºä¸€ä¸ªè¡¨è€Œè¨€ï¼Œå¦‚æœè¦æŸ¥æ‰¾xå±æ€§ä½†åœ¨è¡¨é‡Œæ²¡æœ‰çš„è¯ï¼Œå°±ä¼šè°ƒç”¨å…ƒè¡¨çš„<code>__index</code>è¿›è¡ŒæŸ¥æ‰¾ã€‚å› æ­¤ï¼Œåœ¨æ–°å®ä¾‹ä¸­ï¼Œ<code>__index</code>ç†æ‰€å½“ç„¶åœ°è®¾ç½®ä¸ºåŸå‹è¡¨prototype</p>
<p><code>__newindex</code>è¡¨ç¤ºæ›´æ–°å±æ€§çš„æœºåˆ¶ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå¦å¤–å•ç‹¬çš„è¡¨ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚å¦‚æœè®¾ç½®æˆå¦å¤–å•ç‹¬çš„è¡¨ï¼Œåˆ™æ–°çš„å±æ€§è·Ÿå€¼éƒ½ä¼šè®¾åˆ°å¦å¤–çš„è¡¨ä¸Šï¼›å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯¹äºè¡¨å®ä¾‹è€Œè¨€ï¼Œåˆ™é»˜è®¤ä¸ºè§¦å‘tableæœ¬èº«çš„rawseté€»è¾‘ï¼Œå°†æ–°çš„é”®å€¼å¯¹è®¾åˆ°è¯¥å®ä¾‹ä¸Šã€‚tableçš„rawseté€»è¾‘ä¸ä¼šåè¿‡æ¥è§¦å‘newindexï¼Œå› æ­¤ä¸ä¼šé€ æˆstack overflow</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥çœ‹åŸºäºåŸå‹çš„å®ä¾‹ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> prototype = <span class="built_in">require</span> <span class="string">"prototype"</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n---------------- init table -----------------\n"</span>)</span><br><span class="line"><span class="keyword">local</span> t = prototype(&#123; tag = <span class="string">"TABLE"</span> &#125;)</span><br><span class="line">t:<span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n---------------- init prototype -----------------\n"</span>)</span><br><span class="line"><span class="built_in">getmetatable</span>(t).<span class="built_in">__index</span>:<span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n--------------  modified table  ---------------\n"</span>)</span><br><span class="line"></span><br><span class="line">t.new_value = <span class="string">"new name"</span></span><br><span class="line">t.value = <span class="string">"jaja"</span></span><br><span class="line">t.tag = <span class="string">"NEWTABLE"</span></span><br><span class="line">t:<span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n--------------  modified? prototype  ---------------\n"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">getmetatable</span>(t).<span class="built_in">__index</span>:<span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªåŸºäºprototypeçš„å®ä¾‹ï¼Œå¹¶ä¸”ä¿®æ”¹å…¶ä¸­çš„å€¼ï¼Œå†åè¿‡æ¥çœ‹åŸå‹çš„å€¼ï¼Œæ‰“å°å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">---------------- init table -----------------</span><br><span class="line"></span><br><span class="line">tag: TABLE</span><br><span class="line"></span><br><span class="line">---------------- init prototype -----------------</span><br><span class="line"></span><br><span class="line">value: hello world</span><br><span class="line">print: function: 0000000002a60940</span><br><span class="line">new: function: 0000000002a60af0</span><br><span class="line">tag: PROTOTYPE</span><br><span class="line"></span><br><span class="line">--------------  modified table  ---------------</span><br><span class="line"></span><br><span class="line">tag: NEWTABLE</span><br><span class="line">new_value: new name</span><br><span class="line">value: jaja</span><br><span class="line"></span><br><span class="line">--------------  modified? prototype  ---------------</span><br><span class="line"></span><br><span class="line">value: hello world</span><br><span class="line">print: function: 0000000002a60940</span><br><span class="line">new: function: 0000000002a60af0</span><br><span class="line">tag: PROTOTYPE</span><br></pre></td></tr></table></figure>
<p>å¾ˆå¹¸è¿ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€æœŸæœ›çš„é‚£æ ·ï¼</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å…ƒè¡¨metatableï¼Œå¬èµ·æ¥æ‹—å£ï¼Œä½†ç”¨èµ·æ¥éå¸¸çµæ´»~</p>
<p>ä¸ä»…æ˜¯luaï¼Œåƒpythonï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„æ“ä½œ</p>
<p>åœ¨å®é™…luaç¼–ç¨‹çš„æ—¶å€™ï¼Œå¯å¾—å¤šå°è¯•å–”~</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>lua</tag>
        <tag>é¢å‘å¯¹è±¡</tag>
        <tag>å…ƒè¡¨</tag>
        <tag>ç»§æ‰¿</tag>
        <tag>åŸå‹æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘Win10ç¼–ç¨‹å­—ä½“&amp;ä¸»é¢˜è®¾ç½®å…¨æ”»ç•¥</title>
    <url>/2019/06/01/diymemo/font_theme/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¼–ç¨‹éœ€è¦çº ç»“å­—ä½“è·Ÿçš®è‚¤å—ï¼Ÿè‚¯å®šè¦çº ç»“çš„å•¦= = = =</p>
<p>è°ƒç†å­—ä½“è·Ÿçš®è‚¤ï¼Œå°±è·Ÿæ‰“æ‰®æˆ¿é—´ä¸€æ ·ã€‚æ¯å½“æ‰“å¼€ç¼–ç¨‹è½¯ä»¶ä¹‹æ—¶ï¼Œè¦æ˜¯çœ‹åˆ°æ¸…äº®çš„å­—ä½“ï¼Œçˆ½å¿«çš„çš®è‚¤ï¼Œå¿ƒé‡Œè‚¯å®šå°±ç‰¹åˆ«è¸å®ï¼Œç ç èµ·æ¥è‚¯å®šä¹Ÿå°±ç‰¹åˆ«èˆ’æœã€‚</p>
<p>æ˜¯æ—¶å€™åˆ†äº«ä¸€ä¸‹æˆ‘çš„ç¼–ç¨‹å­—ä½“ä»¥åŠä¸»é¢˜è®¾ç½®äº†ï¼ï¼ï¼</p>
<a id="more"></a>
<h2 id="ç”µè„‘é…ç½®"><a href="#ç”µè„‘é…ç½®" class="headerlink" title="ç”µè„‘é…ç½®"></a>ç”µè„‘é…ç½®</h2><h3 id="æ˜¾ç¤º"><a href="#æ˜¾ç¤º" class="headerlink" title="æ˜¾ç¤º"></a>æ˜¾ç¤º</h3><p>æ˜¾ç¤ºæ–¹é¢ï¼Œä¸»æœºç”¨çš„æœ€é«˜åˆ†è¾¨ç‡1080pçš„èˆ¹ï¼Œæ¥äº†HDMIåˆ°åç¡•MG248QRæ˜¾ç¤ºå™¨ï¼Œåˆ·æ–°ç‡120hzã€‚</p>
<h3 id="ç¼–ç¨‹è½¯ä»¶"><a href="#ç¼–ç¨‹è½¯ä»¶" class="headerlink" title="ç¼–ç¨‹è½¯ä»¶"></a>ç¼–ç¨‹è½¯ä»¶</h3><p>ç¼–ç¨‹è½¯ä»¶ä¸»è¦æ˜¯4ä¸ªï¼š</p>
<ul>
<li>Visual Studio Codeï¼šä¸»åŠ›å¼€å‘&amp;å†™åšå®¢</li>
<li>IntelliJ Ideaï¼šå†™pythonã€javaç”¨</li>
<li>Visual Studioï¼šUnityè·ŸUnrealç”¨</li>
<li>Notapad++ï¼šæ—¥å¸¸æ–‡æœ¬ç¼–è¾‘</li>
</ul>
<h2 id="å­—ä½“-amp-ä¸»é¢˜é…ç½®"><a href="#å­—ä½“-amp-ä¸»é¢˜é…ç½®" class="headerlink" title="å­—ä½“&amp;ä¸»é¢˜é…ç½®"></a>å­—ä½“&amp;ä¸»é¢˜é…ç½®</h2><p>ç”±äºWindowså¤©ç”Ÿæ¸²æŸ“ä¸å’‹åœ°ï¼Œæ¯”Macå·®äº†ä¸€å¤§æˆªã€‚å› æ­¤é€‰æ‹©å­—ä½“æ­é…çš®è‚¤ï¼Œé‚£å¯å¾—å¾—ä¸‹ä¸€ç•ªåŠŸå¤«ã€‚</p>
<h3 id="Visual-Studio-Code"><a href="#Visual-Studio-Code" class="headerlink" title="Visual Studio Code"></a>Visual Studio Code</h3><p>è‡ªå·±çš„é…ç½®æ˜¯ï¼šCobalt2ä¸»é¢˜ + Operator Mono Lightå­—ä½“ï¼ˆå¤§å°14ï¼‰ï¼Œè¡Œé«˜22</p>
<p>æ‹¿lfunctimerçš„luaæ–‡ä»¶åšä¾‹å­ï¼ŒåŠ äº†lua coder assistã€TODO highlightç­‰æ’ä»¶ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/diymemo/font_theme/vscode_cobalt2_operator_mono.PNG" alt="VSCode Cobalt2 + Operator Mono"></p>
<p>ä¸»é¢˜çš„é€‰æ‹©å¾ˆå¤šæ ·ï¼Œå®˜æ–¹çš„Dark+å…¶å®å·²ç»å¾ˆä¸é”™äº†ã€‚ä½†æ˜¯æ¨èçš„è¯ï¼ŒOne Dark Pro Vividè·Ÿè‡ªå¸¦çš„Monokaiéƒ½æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚<strong>Materialç³»åˆ—ä¸»é¢˜åƒä¸‡ä¸èƒ½é€‰ï¼ï¼ï¼çœ‹ä¹…äº†éå¸¸ä¼¤çœ¼ï¼Œä½å¯¹æ¯”åº¦ä¸å¥½çœ‹ï¼Œé«˜å¯¹æ¯”åº¦å¤ªä¼¤çœ¼ã€‚</strong></p>
<p>å›¾æ ‡ä¸»é¢˜ï¼ˆIcon Themeï¼‰ï¼Œå¯ä»¥é€‰Materialç³»åˆ—ï¼Œä¹Ÿå¯ä»¥é€‰VSCode Great Iconsä¹‹ç±»ï¼Œæ¯”è¾ƒéšæ„ã€‚</p>
<p>å­—ä½“çš„è¯ï¼Œå®æµ‹Fantasque Sans Monoä¸Ubuntu Monoæ˜¯æ¨èçš„é€‰æ‹©ã€‚Consolasè·ŸSource Code Variableä¼šç¨å¾®æœ‰ç‚¹è‚¥çš„æ„Ÿè§‰ï¼Œè€ŒInconsolataè·ŸMonacoç³»åˆ™ä¼šæœ‰ä¸€äº›æ¸²æŸ“ä¸Šçš„ç‘•ç–µã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹çœ‹Monokai + Fantasque Sans Monoä»¥åŠOne Dark Pro Vivid + Ubuntu Monoçš„æ•ˆæœï¼š</p>
<p><img src="/uploads/diymemo/font_theme/vscode_monokai_fantasque_sans_mono.PNG" alt="VSCode Monokai + Fantasque Sans Mono"></p>
<p><img src="/uploads/diymemo/font_theme/vscode_one_dark_pro_ubuntu_mono.PNG" alt="VSCode One Dark Pro Vivid + Ubuntu Mono"></p>
<h3 id="IntelliJ-Idea"><a href="#IntelliJ-Idea" class="headerlink" title="IntelliJ Idea"></a>IntelliJ Idea</h3><p>Ideaæ–¹é¢ï¼Œä¸»é¢˜é¦–é€‰å®˜æ–¹å‡ºçš„æ–°çš®è‚¤ï¼šDark purpleã€‚<strong>åƒä¸‡ä¸è¦å®‰è£…Materialçš®è‚¤ï¼Œç¼ºç‚¹ä¸Šé¢å·²ç»è¯´äº†ï¼Œè€Œä¸”å¸è½½éš¾ï¼Œç®€ç›´æ˜¯æµæ°“æ’ä»¶ã€‚</strong></p>
<p>å­—ä½“æ–¹é¢ï¼ŒIdeaæœ‰è¯»å–ä¸åˆ°Operator Monoçš„bugã€‚Windowsä¸Šï¼Œé¦–å…ˆåœ¨Appearanceè®¾ç½®é‡ŒæŠŠEditorçš„æŠ—é”¯é½¿è®¾ç½®ä¸ºGreyscaleï¼š</p>
<p><img src="/uploads/diymemo/font_theme/idea_greyscale.PNG" alt="Idea Greyscale"></p>
<p>ç„¶åé¦–é€‰Fantasque Sans Monoï¼Œä¸­æ–‡å­—ä½“è‹¹æ–¹ï¼ˆfallback fontè®¾ç½®ï¼‰ï¼Œæåº¦èˆ’é€‚ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/uploads/diymemo/font_theme/idea_fantasque_sans_mono.PNG" alt="Idea Fantasque Sans Mono"></p>
<p>Monacoç³»ä¹Ÿä¸é”™ï¼ŒHeyMonaæˆ–Monaco for Powerlineéƒ½æœ‰ä¸ä¿—çš„æ˜¾ç¤ºæ•ˆæœï¼š</p>
<p><img src="/uploads/diymemo/font_theme/idea_heymona.PNG" alt="Idea HeyMona"></p>
<p>å¦‚æœæ˜¯å°å±å¹•ï¼Œä¹Ÿå¯ä»¥ç”¨Source Code Variableï¼Œä½†å¤§å±å¹•ä¼šæ˜¾èƒ–ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¯•è¯•~</p>
<h3 id="Visual-Studio"><a href="#Visual-Studio" class="headerlink" title="Visual Studio"></a>Visual Studio</h3><p>Visual Studioçš„å­—ä½“æ¸²æŸ“æ˜¯çœŸçš„è¾£é¸¡ï¼Œèƒ½çœ‹çš„å­—ä½“çœŸçš„å¤ªå°‘äº†ã€‚</p>
<p>å¯ä»¥é€‰æ‹©Darkä¸»é¢˜ + Inconsolataæˆ–Ubuntu Monoå­—ä½“çš„é…ç½®ï¼Œå­—ä½“è¦è®¾å°ä¸€ç‚¹ï¼Œä¸¤ä¸ªçš„å±•ç°æ•ˆæœéƒ½å·®ä¸å¤šã€‚ç›´æ¥ä»¥Inconsolataä¸ºä¾‹å¥½äº†= =</p>
<p><img src="/uploads/diymemo/font_theme/vs_inconsolata.PNG" alt="VS Inconsolata"></p>
<h3 id="Notepad"><a href="#Notepad" class="headerlink" title="Notepad++"></a>Notepad++</h3><p>Notepad++è·ŸVisual Studioæ¸²æŸ“çš„æ•ˆæœç›¸ä¼¼ã€‚å› æ­¤ï¼Œå­—ä½“ä¸ŠåŒæ ·é‡‡ç”¨Inconsolataæˆ–è€…Ubuntu Monoå³å¯ã€‚</p>
<p>ä¸»é¢˜çš„é€‰æ‹©ä¸Šï¼ŒMonokaiæˆ–è€…Obsidianéƒ½ä¸é”™ã€‚Obsidiançš„å…³é”®å­—æ ‡ç²—ä½“ï¼Œç”±äºInconsolataè·ŸUbuntu Monoåœ¨Notepad++ä¸Šç²—ä½“æ˜¾ç¤ºå¹¶ä¸ç®—ç‰¹åˆ«å®Œç¾ï¼Œæ‰€ä»¥å¦‚æœæ‡’å¾—å»DIYçš„è¯ï¼Œé€‰Monokaiå°±å¥½äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä¸€ç¹Monokai + Inconsolataä»¥åŠObsidian + Ubuntu Monoçš„æ•ˆæœï¼š</p>
<p><img src="/uploads/diymemo/font_theme/notepad_inconsolata.PNG" alt="Notepad Inconsolata"></p>
<p><img src="/uploads/diymemo/font_theme/notepad_ubuntu_mono.PNG" alt="Notepad Ubuntu Mono"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœæƒ³è¦å¤å¤ï¼Œæˆ–è€…æ²¡å¤ªå¤šå®¡ç¾éœ€æ±‚ï¼ŒConsolasã€Courier (New)ä¹‹ç±»çš„å°±å¯ä»¥æ»¡è¶³äº†= =s</p>
<p>åƒDejaVu Sans Monoã€Droid Sans Monoã€Fira Codeã€Hackã€Input Monoä¹‹æµï¼Œç½‘ä¸Šä»‹ç»çœ‹ç€è¿˜OKï¼Œå®é™…æ•ˆæœè¿˜æ˜¯ç¡¬ä¼¤ã€‚</p>
<p>èåœé’èœï¼Œå„æœ‰æ‰€çˆ±ã€‚ä»¥ä¸Šè®¾ç½®ä»…ä¾›å‚è€ƒï¼ï¼ï¼å®è·µï¼Œæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†~</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>ç¼–ç¨‹</tag>
        <tag>Win10</tag>
        <tag>å­—ä½“</tag>
        <tag>ä¸»é¢˜</tag>
        <tag>çš®è‚¤</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€GitHubæ¢ç´¢ã€‘pythonè°ƒè¯•åˆ©å™¨â€”â€”pysnooperæºç åˆ†æ</title>
    <url>/2019/05/25/githubdiscovery/pysnooper/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™æ¬¡åˆå¼€äº†ä¸ªæ–°å‘â€”â€”GitHubæ¢ç´¢ï¼Œä¸»è¦å†…å®¹æ˜¯è¯•æ°´å½“æœŸGitHubä¸Šè¾ƒç«çš„repo</p>
<p>è™½ç„¶topæ¦œä¸Šå„è·¯æ–°æ‰‹æ•™ç¨‹è·Ÿç»å…¸è€ä¸æ­»é¡¹ç›®å æ®äº†å¤§åŠæ±Ÿå±±ï¼Œä½†æ¸…æµæ€»æ˜¯ä¼šæœ‰çš„ã€‚</p>
<p>ç¬¬ä¸€æœŸå°±è¯•æ°´ä¸€ä¸‹<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Nvb2wtUlIvUHlTbm9vcGVy" title="https://github.com/cool-RR/PySnooper">pysnooper<i class="fa fa-external-link"></i></span>å§ï¼Œä¸€ä¸ªæ–°å¥‡å®ç”¨çš„pythonè°ƒè¯•å™¨ã€‚</p>
<p>é¡ºä¾¿æºç åˆ†æä¸€æ³¢ï¼Œäº†è§£ä¸‹pythonçš„debugæ“ä½œã€‚</p>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œè¿›å…¥æ­£é¢˜~</p>
<h2 id="pysnooperä½¿ç”¨æ•ˆæœ"><a href="#pysnooperä½¿ç”¨æ•ˆæœ" class="headerlink" title="pysnooperä½¿ç”¨æ•ˆæœ"></a>pysnooperä½¿ç”¨æ•ˆæœ</h2><p>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°ä¸Šç”¨<code>pysnooper.snoop</code>è£…é¥°å™¨ï¼Œç»™è¿™ä¸ªå‡½æ•°åŒ…è£…ä¸€ä¸ªé¢å¤–åŠŸèƒ½ï¼Œå®ç°åœ¨æ ‡å‡†é”™è¯¯æµæ‰“å°å‡½æ•°debugä¿¡æ¯çš„æ•ˆæœã€‚æ¯”å¦‚è¯´ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">@pysnooper.snoop(depth=2)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> x == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> mul(</span><br><span class="line">        x,</span><br><span class="line">        factorial(x - <span class="number">1</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> a * b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    factorial(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œmainçš„æ•ˆæœå°±æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Starting var:.. x = 2</span><br><span class="line">22:24:25.476753 call         5 def factorial(x):</span><br><span class="line">22:24:25.476753 line         6     if x == 0:</span><br><span class="line">22:24:25.476753 line         8     return mul(</span><br><span class="line">22:24:25.476753 line         9         x,</span><br><span class="line">22:24:25.476753 line        10         factorial(x - 1)</span><br><span class="line">    Starting var:.. x = 1</span><br><span class="line">    22:24:25.477743 call         5 def factorial(x):</span><br><span class="line">    22:24:25.477743 line         6     if x == 0:</span><br><span class="line">    22:24:25.477743 line         8     return mul(</span><br><span class="line">    22:24:25.477743 line         9         x,</span><br><span class="line">    22:24:25.477743 line        10         factorial(x - 1)</span><br><span class="line">        Starting var:.. x = 0</span><br><span class="line">        22:24:25.477743 call         5 def factorial(x):</span><br><span class="line">        22:24:25.477743 line         6     if x == 0:</span><br><span class="line">        22:24:25.477743 line         7         return 1</span><br><span class="line">        22:24:25.477743 return       7         return 1</span><br><span class="line">        Return value:.. 1</span><br><span class="line">        Starting var:.. a = 1</span><br><span class="line">        Starting var:.. b = 1</span><br><span class="line">        22:24:25.477743 call        15 def mul(a, b):</span><br><span class="line">        22:24:25.477743 line        16     return a * b</span><br><span class="line">        22:24:25.477743 return      16     return a * b</span><br><span class="line">        Return value:.. 1</span><br><span class="line">    22:24:25.477743 return      10         factorial(x - 1)</span><br><span class="line">    Return value:.. 1</span><br><span class="line">    Starting var:.. a = 2</span><br><span class="line">    Starting var:.. b = 1</span><br><span class="line">    22:24:25.477743 call        15 def mul(a, b):</span><br><span class="line">    22:24:25.477743 line        16     return a * b</span><br><span class="line">    22:24:25.477743 return      16     return a * b</span><br><span class="line">    Return value:.. 2</span><br><span class="line">22:24:25.477743 return      10         factorial(x - 1)</span><br><span class="line">Return value:.. 2</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥traceåˆ°æ•´ä¸€ä¸ªå‡½æ•°ç›¸å…³çš„æµç¨‹äº†ï¼Œéå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥å¾ˆå¥½åœ°ä»£æ›¿printçš„å·¥ä½œã€‚</p>
<h2 id="pysnooperå®ç°åŸç†"><a href="#pysnooperå®ç°åŸç†" class="headerlink" title="pysnooperå®ç°åŸç†"></a>pysnooperå®ç°åŸç†</h2><p>pysnooperçš„å®ç°æ¶‰åŠåˆ°pythonåº•å±‚debugç›¸å…³çš„çŸ¥è¯†ã€‚åœ¨ä»¥å‰å†™è¿‡çš„ä¸€ç¯‡<a href="https://utmhikari.github.io/2019/04/07/luatalk/lfunctimer_capi">luaçš„debugåº“æºç åˆ†æ</a>ä¸­æåˆ°äº†luaè·å–debugä¿¡æ¯çš„ç›¸å…³æ“ä½œï¼Œè€Œpysnooperå®ç°ä¸Šä¹Ÿæ˜¯é€šè¿‡è·å–åº•å±‚ä¿¡æ¯è¿›è¡Œdebug traceï¼Œä»ç»“æœä¸Šæ¥çœ‹ï¼Œä¹Ÿæ”¶é›†äº†callã€lineã€returnä»¥åŠå˜é‡å®šä¹‰ä¹‹ç±»çš„æ“ä½œäº‹ä»¶ä¿¡æ¯ã€‚è™½ç„¶è¯­è¨€ä¸åŒï¼Œä½†åŸºæœ¬æ€æƒ³éƒ½ä¸€æ ·æ»´~</p>
<p>å› æ­¤ï¼Œåœ¨é€†å‘pyssnooperå®ç°åŸç†ä¹‹æ—¶ï¼Œä¹Ÿå°†å…ˆå…¥ä¸ºä¸»åœ°ä»£å…¥ä¸€äº›luaçš„ç›¸å…³æ¦‚å¿µã€‚</p>
<p>pysnooperç›¸å…³çš„å‚è€ƒèµ„æ–™ï¼ŒåŸºæœ¬å¯ä»¥åœ¨pythonæ ‡å‡†åº“ä¸­çš„<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L2luc3BlY3QuaHRtbA==" title="https://docs.python.org/3/library/inspect.html">inspectåº“æ–‡æ¡£<i class="fa fa-external-link"></i></span>ä¸­æ‰¾åˆ°~</p>
<p>è°ƒç”¨çš„<code>pysnooper.snoop</code>å®šä¹‰åœ¨pysnooperçš„<code>__init__.py</code>ä¸­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> .tracer <span class="keyword">import</span> Tracer <span class="keyword">as</span> snoop</span><br></pre></td></tr></table></figure>
<p>å› æ­¤æˆ‘ä»¬ç›´æ¥è½¬å‘Tracerç±»ä¸€æ¢ç©¶ç«Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, function)</span>:</span></span><br><span class="line">    self.target_codes.add(function.__code__)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @functools.wraps(function)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">simple_wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> self:</span><br><span class="line">            <span class="keyword">return</span> function(*args, **kwargs)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @functools.wraps(function)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generator_wrapper</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        gen = function(*args, **kwargs)</span><br><span class="line">        method, incoming = gen.send, <span class="literal">None</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">with</span> self:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    outgoing = method(incoming)</span><br><span class="line">                <span class="keyword">except</span> StopIteration:</span><br><span class="line">                    <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                method, incoming = gen.send, (<span class="keyword">yield</span> outgoing)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                method, incoming = gen.throw, e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> pycompat.iscoroutinefunction(function):</span><br><span class="line">        <span class="comment"># return decorate(function, coroutine_wrapper)</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line">    <span class="keyword">elif</span> inspect.isgeneratorfunction(function):</span><br><span class="line">        <span class="keyword">return</span> generator_wrapper</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> simple_wrapper</span><br></pre></td></tr></table></figure>
<p>ä½œä¸ºä¸€ä¸ªè£…é¥°å™¨é¦–å…ˆè¦å®ç°çš„æ˜¯å„ç±»å‡½æ•°çš„åŒ…è£…ã€‚pysnooperé¦–å…ˆå°†è¯¥å‡½æ•°ç¼–è¯‘çš„ä»£ç <code>__code__</code>è¿›è¡Œå¤‡ä»½ï¼Œè€Œåæ ¹æ®æƒ…å†µå°è£…å‡½æ•°ã€‚pysnooperæš‚æ—¶æ²¡æœ‰å¯¹åç¨‹ï¼ˆasync def task/coroutineï¼‰åšå°è£…ï¼Œä½†å¯¹äºä¸€èˆ¬å‡½æ•°è·Ÿgeneratorï¼Œéƒ½æŠŠå‡½æ•°ä½“å†…æ‰€æœ‰çš„æ“ä½œåŒ…è£¹åœ¨äº†Tracerè‡ªå·±çš„withä½œç”¨åŸŸä¸­ã€‚</p>
<p>åœ¨æ—¥å¸¸ç ç ä¸­ï¼Œæˆ‘ä»¬å†™åˆ°withçš„åœºæ™¯ä¸€èˆ¬æ˜¯æ–‡ä»¶ioæ“ä½œï¼Œæˆ–è€…æ˜¯tensorflowä¹‹ç±»ã€‚withä½œç”¨åŸŸæä¾›äº†<code>__enter__</code>ä¸<code>__exit__</code>ä¸¤ä¸ªå…ƒæ–¹æ³•ï¼Œå®šä¹‰è¿›å‡ºä½œç”¨åŸŸæ—¶çš„ç›¸å…³æ“ä½œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">    calling_frame = inspect.currentframe().f_back</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self._is_internal_frame(calling_frame):</span><br><span class="line">        calling_frame.f_trace = self.trace</span><br><span class="line">        self.target_frames.add(calling_frame)</span><br><span class="line"></span><br><span class="line">    stack = self.thread_local.__dict__.setdefault(<span class="string">'original_trace_functions'</span>, [])</span><br><span class="line">    stack.append(sys.gettrace())</span><br><span class="line">    sys.settrace(self.trace)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_value, exc_traceback)</span>:</span></span><br><span class="line">    stack = self.thread_local.original_trace_functions</span><br><span class="line">    sys.settrace(stack.pop())</span><br><span class="line">    calling_frame = inspect.currentframe().f_back</span><br><span class="line">    self.target_frames.discard(calling_frame)</span><br><span class="line">    self.frame_to_local_reprs.pop(calling_frame, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_is_internal_frame</span><span class="params">(self, frame)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> frame.f_code.co_filename == Tracer.__enter__.__code__.co_filename</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯å½“å‘ç”Ÿè¿›å‡ºTracerä½œç”¨åŸŸçš„æ—¶å€™ï¼ˆä¹Ÿå°±æ˜¯å°è£…functionçš„æ—¶å€™ï¼‰éƒ½ä¼šå‘ç”Ÿä¸€äº›ç±»ä¼¼çŠ¶æ€ç®¡ç†çš„æ“ä½œã€‚å› æ­¤é¦–å…ˆç¨å¾®å˜æ¸…ä¸€äº›æ¦‚å¿µ:</p>
<ul>
<li>frameï¼šç›¸å½“äºluaçš„callinfoï¼Œè¡¨ç¤ºpythonè°ƒç”¨æ ˆä¸Šçš„å‡½æ•°ä¿¡æ¯</li>
<li>thread_localï¼šå½“å‰çº¿ç¨‹ä½œç”¨åŸŸï¼ˆJavaåŒå­¦åº”è¯¥éƒ½æ˜ç™½ï¼‰</li>
<li>traceï¼šç›¸å½“äºluaçš„hook</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡<code>__enter__</code>æ—¶ï¼Œå¢åŠ ç»Ÿè®¡frameä¿¡æ¯ï¼Œå¹¶ä¸”åœ¨å½“å‰çº¿ç¨‹å»ºç«‹ä¸€ä¸ªtraceæ ˆè®°å½•æ¯ä¸ªå‡½æ•°ä¸Šä¸€ä¸ªframeï¼ˆè°ƒç”¨è¯¥å‡½æ•°çš„frameï¼‰çš„traceå‡½æ•°ã€‚<br>ç„¶ååè¿‡æ¥ï¼Œæ¯æ¬¡<code>__exit__</code>æ—¶ï¼Œtraceå‡½æ•°é‡ç½®ä¸ºä¸Šä¸€ä¸ªï¼ˆä»traceæ ˆä¸­popå‡ºæ¥ï¼‰ï¼ŒåŒæ—¶ç§»é™¤ç»Ÿè®¡çš„frameï¼Œä»è€Œç»´æŒåŸæœ‰çš„çŠ¶æ€ã€‚</p>
<p>æœ€åæˆ‘ä»¬ç›´æ¥çœ‹traceï¼ˆhookï¼‰å‡½æ•°ï¼Œäº†è§£pysnooperæ‰“å°æ“ä½œå…·ä½“å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trace</span><span class="params">(self, frame, event, arg)</span>:</span></span><br><span class="line">    <span class="comment">### Checking whether we should trace this line: #######################</span></span><br><span class="line">    <span class="comment">#                                                                     #</span></span><br><span class="line">    <span class="comment"># We should trace this line either if it's in the decorated function,</span></span><br><span class="line">    <span class="comment"># or the user asked to go a few levels deeper and we're within that</span></span><br><span class="line">    <span class="comment"># number of levels deeper.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (frame.f_code <span class="keyword">in</span> self.target_codes <span class="keyword">or</span> frame <span class="keyword">in</span> self.target_frames):</span><br><span class="line">        <span class="keyword">if</span> self.depth == <span class="number">1</span>:</span><br><span class="line">            <span class="comment"># We did the most common and quickest check above, because the</span></span><br><span class="line">            <span class="comment"># trace function runs so incredibly often, therefore it's</span></span><br><span class="line">            <span class="comment"># crucial to hyper-optimize it for the common case.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">elif</span> self._is_internal_frame(frame):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            _frame_candidate = frame</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, self.depth):</span><br><span class="line">                _frame_candidate = _frame_candidate.f_back</span><br><span class="line">                <span class="keyword">if</span> _frame_candidate <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">                <span class="keyword">elif</span> _frame_candidate.f_code <span class="keyword">in</span> self.target_codes <span class="keyword">or</span> _frame_candidate <span class="keyword">in</span> self.target_frames:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    thread_global.__dict__.setdefault(<span class="string">'depth'</span>, <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">if</span> event == <span class="string">'call'</span>:</span><br><span class="line">        thread_global.depth += <span class="number">1</span></span><br><span class="line">    indent = <span class="string">' '</span> * <span class="number">4</span> * thread_global.depth</span><br><span class="line"></span><br><span class="line">    <span class="comment">#                                                                     #</span></span><br><span class="line">    <span class="comment">### Finished checking whether we should trace this line. ##############</span></span><br></pre></td></tr></table></figure>
<p>pythonè§„å®štraceå‡½æ•°åŒ…å«ä¸‰ä¸ªå‚æ•°ï¼šframeã€eventä¸argï¼Œframeä»£è¡¨å½“å‰è°ƒç”¨æ ˆçš„frameï¼›eventæ˜¯è¿è¡Œæ—¶äº‹ä»¶ï¼Œæ¯”luaå¤šäº†exceptionä¸opcodeä¸¤ä¸ªï¼›argæ˜¯å—æ§äºeventçš„åªè¯»å‚æ•°ã€‚</p>
<p>åœ¨pysnooperçš„traceå‡½æ•°ä¸­ï¼Œé¦–å…ˆé’ˆå¯¹æ˜¯å¦è®°å½•/æ‰“å°æ•°æ®è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰å½“å‰frameæˆ–è€…å…¶ä¸Šå±‚frameåœ¨è¦æµ‹çš„framesé‡Œæˆ–è€…åŒ…å«è¦æµ‹çš„ä»£ç å—ï¼Œæ‰ä¼šè¢«çº³å…¥pysnooperè®°å½•å½“ä¸­ã€‚<br>åˆ¤æ–­å®Œä¹‹åï¼Œå°±è§„å®šæ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œæ‰“å°å¢åŠ 4ä½ç¼©è¿›ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_local_reprs</span><span class="params">(frame, watch=<span class="params">()</span>)</span>:</span></span><br><span class="line">    code = frame.f_code</span><br><span class="line">    vars_order = code.co_varnames + code.co_cellvars + code.co_freevars + tuple(frame.f_locals.keys())</span><br><span class="line">    result_items = [(key, utils.get_shortish_repr(value)) <span class="keyword">for</span> key, value <span class="keyword">in</span> frame.f_locals.items()]</span><br><span class="line">    result_items.sort(key=<span class="keyword">lambda</span> key_value: vars_order.index(key_value[<span class="number">0</span>]))</span><br><span class="line">    result = collections.OrderedDict(result_items)</span><br><span class="line">    <span class="keyword">for</span> variable <span class="keyword">in</span> watch:</span><br><span class="line">        result.update(sorted(variable.items(frame)))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trace</span><span class="params">(...)</span>:</span></span><br><span class="line">    <span class="comment"># æ¥ä¸Š</span></span><br><span class="line">    <span class="comment">### Reporting newish and modified variables: ##########################</span></span><br><span class="line">    <span class="comment">#                                                                     #</span></span><br><span class="line">    old_local_reprs = self.frame_to_local_reprs.get(frame, &#123;&#125;)</span><br><span class="line">    self.frame_to_local_reprs[frame] = local_reprs = \</span><br><span class="line">        get_local_reprs(frame, watch=self.watch)</span><br><span class="line">    newish_string = (<span class="string">'Starting var:.. '</span> <span class="keyword">if</span> event == <span class="string">'call'</span> <span class="keyword">else</span></span><br><span class="line">                        <span class="string">'New var:....... '</span>)</span><br><span class="line">    <span class="keyword">for</span> name, value_repr <span class="keyword">in</span> local_reprs.items():</span><br><span class="line">        <span class="keyword">if</span> name <span class="keyword">not</span> <span class="keyword">in</span> old_local_reprs:</span><br><span class="line">            self.write(<span class="string">'&#123;indent&#125;&#123;newish_string&#125;&#123;name&#125; = &#123;value_repr&#125;'</span>.format(</span><br><span class="line">                **locals()))</span><br><span class="line">        <span class="keyword">elif</span> old_local_reprs[name] != value_repr:</span><br><span class="line">            self.write(<span class="string">'&#123;indent&#125;Modified var:.. &#123;name&#125; = &#123;value_repr&#125;'</span>.format(</span><br><span class="line">                **locals()))</span><br><span class="line"></span><br><span class="line">    <span class="comment">#                                                                     #</span></span><br><span class="line">    <span class="comment">### Finished newish and modified variables. ###########################</span></span><br></pre></td></tr></table></figure>
<p>è€Œåï¼Œå¯¹å½“å‰frameçš„å˜é‡çŠ¶æ€è¿›è¡Œåˆ†æã€‚å¦‚æœæœ‰æ–°çš„å˜é‡ï¼Œåˆ™æ ‡æ˜æ–°å˜é‡æˆ–è€…è°ƒç”¨å‚æ•°ï¼›å¦‚æœæœ‰å˜é‡è·Ÿä¸Šä¸€æ¬¡å€¼ä¸ä¸€æ ·ï¼Œåˆ™æ ‡æ˜ä¿®æ”¹äº†ä¸€ä¸ªå˜é‡ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trace</span><span class="params">(...)</span>:</span></span><br><span class="line">    <span class="comment"># æ¥ä¸Š</span></span><br><span class="line">    now_string = datetime_module.datetime.now().time().isoformat()</span><br><span class="line">    line_no = frame.f_lineno</span><br><span class="line">    source_line = get_source_from_frame(frame)[line_no - <span class="number">1</span>]</span><br><span class="line">    thread_info = <span class="string">""</span></span><br><span class="line">    <span class="keyword">if</span> self.thread_info:</span><br><span class="line">        current_thread = threading.current_thread()</span><br><span class="line">        thread_info = <span class="string">"&#123;ident&#125;-&#123;name&#125; "</span>.format(</span><br><span class="line">            ident=current_thread.ident, name=current_thread.getName())</span><br><span class="line">    thread_info = self.set_thread_info_padding(thread_info)</span><br><span class="line"></span><br><span class="line">    <span class="comment">### Dealing with misplaced function definition: #######################</span></span><br><span class="line">    <span class="comment">#                                                                     #</span></span><br><span class="line">    <span class="keyword">if</span> event == <span class="string">'call'</span> <span class="keyword">and</span> source_line.lstrip().startswith(<span class="string">'@'</span>):</span><br><span class="line">        <span class="comment"># If a function decorator is found, skip lines until an actual</span></span><br><span class="line">        <span class="comment"># function definition is found.</span></span><br><span class="line">        <span class="keyword">for</span> candidate_line_no <span class="keyword">in</span> itertools.count(line_no):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                candidate_source_line = \</span><br><span class="line">                    get_source_from_frame(frame)[candidate_line_no - <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                <span class="comment"># End of source file reached without finding a function</span></span><br><span class="line">                <span class="comment"># definition. Fall back to original source line.</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> candidate_source_line.lstrip().startswith(<span class="string">'def'</span>):</span><br><span class="line">                <span class="comment"># Found the def line!</span></span><br><span class="line">                line_no = candidate_line_no</span><br><span class="line">                source_line = candidate_source_line</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="comment">#                                                                     #</span></span><br><span class="line">    <span class="comment">### Finished dealing with misplaced function definition. ##############</span></span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œé™¤å»æ–°å»ºå˜é‡/ä¿®æ”¹å˜é‡ä¹‹å¤–ï¼Œå…¶å®ƒçš„æ—¥å¿—éƒ½æ‰“å°å½“å‰æ—¶é—´ã€eventã€æºç ä»¥åŠçº¿ç¨‹ä¿¡æ¯ã€‚</p>
<p>å¯¹äºè£…é¥°å™¨ï¼Œåˆ™æš‚ä¸”è·³è¿‡ï¼Œå¯»æ‰¾çœŸæ­£çš„å‡½æ•°å£°æ˜ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trace</span><span class="params">(...)</span>:</span></span><br><span class="line">    <span class="comment"># æ¥ä¸Š</span></span><br><span class="line">    <span class="comment"># If a call ends due to an exception, we still get a 'return' event</span></span><br><span class="line">    <span class="comment"># with arg = None. This seems to be the only way to tell the difference</span></span><br><span class="line">    <span class="comment"># https://stackoverflow.com/a/12800909/2482744</span></span><br><span class="line">    code_byte = frame.f_code.co_code[frame.f_lasti]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isinstance(code_byte, int):</span><br><span class="line">        code_byte = ord(code_byte)</span><br><span class="line">    ended_by_exception = (</span><br><span class="line">            event == <span class="string">'return'</span></span><br><span class="line">            <span class="keyword">and</span> arg <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">and</span> (opcode.opname[code_byte]</span><br><span class="line">                    <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'RETURN_VALUE'</span>, <span class="string">'YIELD_VALUE'</span>))</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ended_by_exception:</span><br><span class="line">        self.write(<span class="string">'&#123;indent&#125;Call ended by exception'</span>.</span><br><span class="line">                    format(**locals()))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        self.write(<span class="string">u'&#123;indent&#125;&#123;now_string&#125; &#123;thread_info&#125;&#123;event:9&#125; '</span></span><br><span class="line">                    <span class="string">u'&#123;line_no:4&#125; &#123;source_line&#125;'</span>.format(**locals()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> event == <span class="string">'return'</span>:</span><br><span class="line">        <span class="keyword">del</span> self.frame_to_local_reprs[frame]</span><br><span class="line">        thread_global.depth -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ended_by_exception:</span><br><span class="line">            return_value_repr = utils.get_shortish_repr(arg)</span><br><span class="line">            self.write(<span class="string">'&#123;indent&#125;Return value:.. &#123;return_value_repr&#125;'</span>.</span><br><span class="line">                        format(**locals()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> event == <span class="string">'exception'</span>:</span><br><span class="line">        exception = <span class="string">'\n'</span>.join(traceback.format_exception_only(*arg[:<span class="number">2</span>])).strip()</span><br><span class="line">        exception = utils.truncate(exception, utils.MAX_EXCEPTION_LENGTH)</span><br><span class="line">        self.write(<span class="string">'&#123;indent&#125;&#123;exception&#125;'</span>.</span><br><span class="line">                    format(**locals()))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> self.trace</span><br></pre></td></tr></table></figure>
<p>æœ€åå°±æ˜¯returnè·Ÿexceptionçš„åˆ¤å®šï¼Œä¸¤è€…æœ‰ä¸€å®šçš„äº¤é›†ï¼ˆå¯è§ä¸Šé¢æ³¨é‡Šï¼‰ï¼Œå› æ­¤æ ¹æ®ä¸åŒæƒ…å†µä»å½“å‰ä½œç”¨åŸŸå˜é‡è¡¨<code>locals()</code>æå–ä¸åŒå˜é‡æ‰“å°ä¸åŒä¿¡æ¯ã€‚è¿™é‡Œä¹Ÿä¸éœ€ç»†è¿°ã€‚</p>
<p>æ€»ä½“çœ‹æ¥ï¼Œpysnooperæä¾›çš„hookè¿˜æ˜¯éå¸¸è½»é‡å®ç”¨çš„ã€‚è™½ç„¶å­˜åœ¨è¿™å…¼å®¹async taskè·Ÿè‡ªå®šä¹‰hookï¼ˆtraceï¼‰çš„é—®é¢˜ï¼Œä½†åœ¨å¹³æ—¶debugä¸­å·²ç»å¯ä»¥æ»¡è¶³è®¸å¤šéœ€æ±‚äº†ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥å‰å†™pythonçš„æ—¶é—´ç®—èµ·æ¥åº”è¯¥æ˜¯æœ€å¤šçš„ï¼Œä½†æ˜¯pythonè°ƒè¯•ç›¸å…³çš„å·¥ä½œéƒ½æ²¡æœ‰å¥½å¥½ç ”ç©¶è¿‡ï¼Œè¯´æ¥ä¹Ÿæœ‰ç‚¹å°æƒ­æ„§ã€‚</p>
<p>è¿™æ¬¡å€Ÿç€è¯•æ°´pysnooperçš„æœºä¼šï¼Œæ¶¨äº†è®¸å¤šè§è¯†ï¼Œä¹Ÿé¡ºä¾¿å¯¹pythonåº•å±‚æœ‰äº†åˆæ­¥çš„äº†è§£ã€‚</p>
<p>è™½ç„¶è‡ªå·±ä¹ æƒ¯è‚‰çœ¼debugï¼Œä½†pysnooperä½œä¸ºä¸€ä¸ªdebugé»‘ç§‘æŠ€ï¼Œè¿˜æ˜¯ç›¸å½“ç»™åŠ›ï¼ï¼ï¼</p>
]]></content>
      <categories>
        <category>GitHubæ¢ç´¢</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æºç åˆ†æ</tag>
        <tag>pysnooper</tag>
        <tag>é€†å‘</tag>
        <tag>debug</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘æœ€ç»ˆè¯ï¼šé‡å›é¦–çŸ¥è¯†ç‚¹ï¼Œè®©pythonçœŸæ­£easyï¼</title>
    <url>/2019/05/19/easypython/vii/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Easy Pythonç»ˆäºæ¥åˆ°å®Œç»“ï¼Œæˆ‘çš„é¢†å¯¼ä¹Ÿå¤¸å¥–æˆ‘å†™ä½œéå¸¸çš„å–åŠ›ç”¨å¿ƒã€‚å¯¹æ­¤ï¼Œæˆ‘æ·±è¡¨æ¬£æ…°ï¼</p>
<p>å…­ç« Pythonè®²è§£ï¼Œå¹¶ä¸å•çº¯æ˜¯åˆ‡ç£‹ä»£ç æŠ€è‰ºï¼Œè€Œæ›´æ˜¯æ³¨é‡äºæ¯ä¸€è¡Œä»£ç èƒŒåå‘ç”Ÿçš„äº‹å„¿</p>
<p>ä¸ºæ­¤ï¼Œè®©æˆ‘ä»¬ä¸€èµ·é‡å›é¦–Easy Pythonç³»åˆ—ï¼Œå…‰è£æ”¶å°¾å§ï¼</p>
<h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><a id="more"></a>
<h3 id="ç¬¬ä¸€è¯ï¼šprint-â€˜HelloWorldâ€™-â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°"><a href="#ç¬¬ä¸€è¯ï¼šprint-â€˜HelloWorldâ€™-â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°" class="headerlink" title="ç¬¬ä¸€è¯ï¼šprint(â€˜HelloWorldâ€™)â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°"></a><a href="https://utmhikari.github.io/2019/03/09/easypython/i">ç¬¬ä¸€è¯ï¼šprint(â€˜HelloWorldâ€™)â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°</a></h3><p>HelloWorldï¼Œæ˜¯ä»£ç ä¸–ç•Œçš„å…¥å£ã€‚å½“æˆ‘ä»¬é‡‡ç”¨Pythonè¯­è¨€æ‰“ä¸‹print(â€˜HelloWorldâ€™)çš„ä¸€åˆ»ï¼Œæ˜¯å¦æƒ³è¿‡printâ€”â€”è¿™ä¸ªå‡½æ•°ï¼Œåˆ°åº•è¡¨ç¤ºä»€ä¹ˆå‘¢ï¼Ÿåˆ°åº•èƒ½æ€ä¹ˆç”¨å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªè¯é¢˜å°±å¯ä»¥è¡ç”Ÿåˆ°â€œå‡½æ•°â€ï¼ˆåŠŸèƒ½æ¨¡å—ï¼‰ç›¸å…³çš„è¯é¢˜ã€‚æŠŠä¸€ä¸ªå¤§çš„ç¨‹åºè¿›è¡Œè¿‡ç¨‹è§£è€¦ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†è§£ä¹‹ä¸ºå°çš„åŠŸèƒ½æ¨¡å—ã€‚æ¯ä¸€ä¸ªæ¨¡å—éƒ½æœ‰ç›¸åº”çš„è¾“å…¥ä¸è¾“å‡ºï¼Œè¿™æ ·å°±æŠŠæ•´ä¸€ä¸ªç¨‹åºä¸²èµ·æ¥äº†ã€‚</p>
<p>åœ¨ç¬¬ä¸€è¯ï¼Œæˆ‘ä»¬æåˆ°çš„çŸ¥è¯†æœ‰ï¼š</p>
<ul>
<li>å‡½æ•°ä¸è¿‡ç¨‹ï¼ˆfunction &amp; processï¼‰</li>
<li>è¾“å…¥&amp;å‚æ•°&amp;å…³é”®å­—/æ— å…³é”®å­—å‚æ•°ï¼ˆinput, arguments, *args &amp; **kwargsï¼‰</li>
<li>è¾“å‡º&amp;è¿”å›ï¼ˆoutput &amp; returnï¼‰</li>
</ul>
<h3 id="ç¬¬äºŒè¯ï¼šæ˜ å°„â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°çš„çº½å¸¦"><a href="#ç¬¬äºŒè¯ï¼šæ˜ å°„â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°çš„çº½å¸¦" class="headerlink" title="ç¬¬äºŒè¯ï¼šæ˜ å°„â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°çš„çº½å¸¦"></a><a href="https://utmhikari.github.io/2019/03/16/easypython/ii">ç¬¬äºŒè¯ï¼šæ˜ å°„â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°çš„çº½å¸¦</a></h3><p>æ˜ å°„ä»£è¡¨äº†è¾“å…¥ä¸è¾“å‡ºçš„å…³ç³»ï¼Œè€Œå‡½æ•°åˆ™å®ç°äº†æ˜ å°„ã€‚åœ¨æˆ‘ä»¬æ—¥å¸¸ç ç ä¸­ï¼Œå¦‚æœèƒ½ç”¨æ˜ å°„çš„æ–¹å¼è¡¨ç¤ºä¸€æ®µç¨‹åºï¼Œèƒ½å¤Ÿå¢å¼ºä»£ç çš„å¯è¯»æ€§</p>
<p>åœ¨ç¬¬äºŒè¯ï¼Œæˆ‘ä»¬æåˆ°çš„çŸ¥è¯†æœ‰ï¼š</p>
<ul>
<li>æ˜ å°„ï¼ˆmappingï¼‰</li>
<li>å­—å…¸åŠå…¶æ˜ å°„å®ç°ï¼ˆdict &amp; hashï¼‰</li>
<li>å‡½æ•°å¼ç¼–ç¨‹&amp;pythonç¤ºä¾‹ï¼ˆfunctional programming with its exampleï¼‰</li>
</ul>
<h3 id="ç¬¬ä¸‰è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸Šï¼‰"><a href="#ç¬¬ä¸‰è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸Šï¼‰" class="headerlink" title="ç¬¬ä¸‰è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸Šï¼‰"></a><a href="https://utmhikari.github.io/2019/03/31/easypython/iii">ç¬¬ä¸‰è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸Šï¼‰</a></h3><p>pythonåœ¨æ•°æ®åˆ†ææ–¹é¢çš„åº”ç”¨éå¸¸å¹¿æ³›ã€‚åœ¨ç½‘ä¸Šæœ‰éå¸¸å¤šçš„çˆ¬è™«æ•™ç¨‹ï¼Œç„¶è€Œçˆ¬è™«èƒŒååˆ°åº•å¹²äº†ä»€ä¹ˆï¼Œæˆ‘ä»¬å´ä¸æ˜“çŸ¥æ™“ã€‚</p>
<p>åŒæ ·ï¼Œè±†ç“£top250ç”µå½±çš„ä¿¡æ¯çˆ¬å–ä¹Ÿæ˜¯è®¸å¤šåŒå­¦çš„å…¥é—¨ä¹‹å¾„ã€‚Easy Pythonä¹Ÿæ˜¯ä¸€æ ·ï¼Œé‡‡ç”¨ä¸Šä¸‹ä¸¤è¯ä»‹ç»è±†ç“£250çš„pythonçˆ¬è™«â€”â€”çˆ¬ä»€ä¹ˆï¼Œæ€ä¹ˆçˆ¬ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆçˆ¬â€”â€”æ‰€æœ‰çš„ä¸€åˆ‡ï¼Œå…¨éƒ¨æµ“ç¼©æˆç²¾åã€‚</p>
<p>åœ¨ç¬¬ä¸‰è¯ï¼Œæˆ‘ä»¬æŠ“å–äº†top250ç”µå½±çš„é“¾æ¥ï¼Œæ‰€æ¶‰åŠåˆ°çš„çŸ¥è¯†æœ‰ï¼š</p>
<ul>
<li>ç½‘ç»œåŸºç¡€ï¼šHTTPã€URLã€åè®®ã€çŠ¶æ€ç ç­‰ï¼ˆHTTP, URL, Protocol, Status Code, Resources, etcï¼‰</li>
<li>HTMLç½‘é¡µä¸BeautifulSoupè§£æï¼ˆHTML page &amp; BeautifulSoup Parserï¼‰</li>
<li>Chromeå¼€å‘è€…æ¨¡å¼ï¼ˆChrome Developer Modeï¼‰</li>
</ul>
<h3 id="ç¬¬å››è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸‹ï¼‰"><a href="#ç¬¬å››è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸‹ï¼‰" class="headerlink" title="ç¬¬å››è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸‹ï¼‰"></a><a href="https://utmhikari.github.io/2019/03/31/easypython/iv">ç¬¬å››è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸‹ï¼‰</a></h3><p>è±†ç“£äºŒç™¾äº”çš„ä¸‹ç¯‡ç›¸å¯¹äºä¸Šç¯‡ï¼Œçˆ¬å–äº†æ¯ä¸€ä¸ªç”µå½±é“¾æ¥ä¸­çš„å…·ä½“ç”µå½±ä¿¡æ¯ã€‚ä»ç¼–ç¨‹è§’åº¦è€Œè¨€ï¼Œæ¶‰åŠçš„çŸ¥è¯†é¢å°±æ›´å¹¿äº†ï¼š</p>
<ul>
<li>å¼‚æ­¥å¹¶å‘è°ƒåº¦ä¸asyncioåº“ï¼ˆasynchronous programming &amp; asyncio usageï¼‰</li>
<li>é˜»å¡ä¸éé˜»å¡ä»»åŠ¡ï¼ˆblocking &amp; non-blocking tasksï¼‰</li>
<li>çˆ¬è™«ä»£ç†æ± &amp;ç”Ÿäº§è€…â€”â€”æ¶ˆè´¹è€…è°ƒåº¦ï¼ˆproxy pool &amp; producer-consumer modelï¼‰</li>
<li>æ¡ä»¶å˜é‡åŠå…¶ç­‰å¾…&amp;å”¤é†’æœºåˆ¶ï¼ˆcondition variable &amp; wait-notify mechanismï¼‰</li>
</ul>
<p>æ³¨é‡ä»£ç å·¥ç¨‹åŒ–ï¼ˆå¼ºè¿«ç—‡ï¼‰çš„åŒå­¦ä»¬ï¼Œåƒä¸‡ä¸è¦é”™è¿‡~</p>
<h3 id="ç¬¬äº”è¯ï¼šå°è¯•scikit-learnæ•°æ®æŒ–æ˜â€”â€”newsgroupæ•°æ®å¤„ç†ä¸æ–‡æœ¬åˆ†ç±»"><a href="#ç¬¬äº”è¯ï¼šå°è¯•scikit-learnæ•°æ®æŒ–æ˜â€”â€”newsgroupæ•°æ®å¤„ç†ä¸æ–‡æœ¬åˆ†ç±»" class="headerlink" title="ç¬¬äº”è¯ï¼šå°è¯•scikit-learnæ•°æ®æŒ–æ˜â€”â€”newsgroupæ•°æ®å¤„ç†ä¸æ–‡æœ¬åˆ†ç±»"></a><a href="https://utmhikari.github.io/2019/04/14/easypython/v">ç¬¬äº”è¯ï¼šå°è¯•scikit-learnæ•°æ®æŒ–æ˜â€”â€”newsgroupæ•°æ®å¤„ç†ä¸æ–‡æœ¬åˆ†ç±»</a></h3><p>ç¬¬äº”è¯å¯¹æ•°æ®å¤„ç†&amp;æ–‡æœ¬åˆ†æçš„åŸºæœ¬æ“ä½œåšäº†è®²è§£ï¼Œç®€è¦åœ°ä»‹ç»äº†æ–‡æœ¬åˆ†ç±»çš„æ¦‚å¿µä¸æ“ä½œï¼Œå¹¶ä¸”æ‰“é€šäº†Pythonçš„æœºå™¨å­¦ä¹ åº“ä¸æˆ‘ä»¬è‡ªå·±çš„æ•°æ®ã€‚</p>
<p>åœ¨è¿™ä¸€è¯ä¸­ï¼Œæ¶‰åŠåˆ°çš„çŸ¥è¯†æœ‰ï¼š</p>
<ul>
<li>æ•°æ®æŒ–æ˜ï¼Œæœºå™¨å­¦ä¹ &amp;æ–‡æœ¬åˆ†ç±»ï¼ˆdata-mining, machine-learning &amp; text-classificationï¼‰</li>
<li>æ­£åˆ™è¡¨è¾¾å¼ï¼ˆregular expressionï¼‰</li>
<li>scikit-learnæ–‡æœ¬åˆ†ç±»æµæ°´çº¿ï¼ˆpipeline of text-classification via scikit-learnï¼‰</li>
</ul>
<h3 id="ç¬¬å…­è¯ï¼šmultiprocessingâ€”â€”Pythonå¤šè¿›ç¨‹å¹¶è¡Œ"><a href="#ç¬¬å…­è¯ï¼šmultiprocessingâ€”â€”Pythonå¤šè¿›ç¨‹å¹¶è¡Œ" class="headerlink" title="ç¬¬å…­è¯ï¼šmultiprocessingâ€”â€”Pythonå¤šè¿›ç¨‹å¹¶è¡Œ"></a><a href="https://utmhikari.github.io/2019/05/11/easypython/vi">ç¬¬å…­è¯ï¼šmultiprocessingâ€”â€”Pythonå¤šè¿›ç¨‹å¹¶è¡Œ</a></h3><p>ç¬¬å…­è¯ï¼Œè®²è¿°äº†è®¸å¤šåŒå­¦æ‰€å…³å¿ƒï¼Œè¸©å‘è¾ƒå¤šçš„å¹¶å‘ç¼–ç¨‹ï¼Œå‰–æäº†å…¶ä¸­åŸç†ï¼Œå¹¶ç”¨pythonå®ç°å¤šä»»åŠ¡å¹¶è¡Œæ“ä½œã€‚åœ¨è¿™æ–¹é¢æœ‰ç–‘æƒ‘çš„åŒå­¦ä»¬ï¼Œåƒä¸‡ä¸è¦é”™è¿‡ï¼</p>
<p>åœ¨è¿™ä¸€è¯ä¸­ï¼Œæ¶‰åŠåˆ°çš„çŸ¥è¯†æœ‰ï¼š</p>
<ul>
<li>å¹¶å‘&amp;å¹¶è¡Œä»»åŠ¡ï¼ˆconcurrent &amp; parallel tasksï¼‰</li>
<li>çº¿ç¨‹ã€è¿›ç¨‹çš„ç‰¹æ€§ä¸å…³ç³»ï¼ˆfeatures &amp; relations of thread &amp; processï¼‰</li>
<li>å¤šçº¿ç¨‹&amp;å¤šè¿›ç¨‹ï¼ˆmulti-threading &amp; multi-processingï¼‰</li>
<li>pythonè¿›ç¨‹èµ„æºå…±äº«ï¼ˆshared data on pythonic-multi-processingï¼‰</li>
<li>å®¢æˆ·ç«¯/æœåŠ¡å™¨æ¨¡å¼ä¸tornadoæ¡†æ¶ï¼ˆC/S model &amp; tornado frameworkï¼‰</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»ç¼–ç¨‹çˆ±å¥½è€…ä»¬çš„è§’åº¦è¯„ä»·pythonçš„è¯ï¼Œå°±å¥½æ¯”CSGOç©å®¶è¯„ä»·P90è¿™æŠŠæ­¦å™¨â€”â€”â€œnoob gunâ€ï¼Œæ˜¯ä¸ªäººéƒ½èƒ½ä¸Šæ‰‹ç”¨èµ·æ¥ï¼Œå¤ªTMç®€å•äº†ã€‚</p>
<p>ä½†æ˜¯ï¼Œpythonçš„easyä»…é™äºä¸Šæ‰‹å®¹æ˜“å—ï¼Ÿç›¸å¯¹äºpythonï¼Œluaå¯¹æ–°äººé‚£æ˜¯æ›´åŠ å‹å¥½ï¼Œå°±è¿æˆ‘å®¶é‚£ç¬¨ç¬¨çš„é¢†å¯¼ï¼Œéƒ½è¯´luaçœ‹çš„æ¯”pythonå®¹æ˜“ã€‚</p>
<p>pythonç®€å•çš„æ„ä¹‰åœ¨äºèƒŒåå¼ºå¤§çš„ç¤¾åŒºä¸€ç›´ä¸æ–­åœ°æ¨åŠ¨ç€pythonçš„è½®å­ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨å„ä¸ªåœºæ™¯éƒ½æœ‰è½»æ¾é©°éª‹çš„å¯èƒ½ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¹¶ä¸è¿½æ±‚å®Œç¾çš„è´¨é‡ï¼Œä½†æ±‚å¿«é€Ÿå®ç°åŸºæœ¬çš„æ“ä½œï¼Œé‚£å°±é€‰æ‹©pythonå§ï¼</p>
<p>Easy Python, lemon squeezy~</p>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>ç¼–ç¨‹</tag>
        <tag>python</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>çŸ¥è¯†æ€»ç»“</tag>
        <tag>easy python</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘ç¬¬å…­è¯ï¼šmultiprocessingâ€”â€”Pythonå¤šè¿›ç¨‹å¹¶è¡Œ</title>
    <url>/2019/05/11/easypython/vi/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰æ®µæ—¶é—´ï¼Œæˆ‘å’Œæˆ‘çš„é¢†å¯¼å›åˆ°äº†æ¯æ ¡ï¼Œå’Œæˆ‘çš„å¸ˆçˆ¶å¸ˆæ¯èšé¤ã€‚èšé¤ç‚¹äº†å¾ˆå¤šä¸œè¥¿ï¼Œå¤§ç¢—å®½é¢ï¼Œç‰›è‚‰ç‚’é¥­ï¼ŒéŸ©å›½çƒ¤è‚‰ï¼Œåƒéƒ½åƒä¸å®Œã€‚è™½ç„¶æˆ‘çš„é¢†å¯¼æœ€è¿‘é•¿å¾—æ¯”ä»¥å‰päº†äº›ï¼Œä½†æ˜¯åƒé¥­é€Ÿåº¦è¿˜æ˜¯æ…¢æ‚ æ‚ ã€‚å”‰ï¼Œè¦æ˜¯æˆ‘çš„é¢†å¯¼èƒ½æœ‰ä¸ªä¸‰å¤´å…­è‡‚ï¼Œæ¯ä¸ªæ‰‹éƒ½å¤¹èœï¼Œæ¯ä¸ªå¤´éƒ½å»å•ƒï¼Œé‚£åƒé¥­é€Ÿåº¦å¯å°±è¹­è¹­åœ°æ¶¨ä¸Šå»äº†å•Šï¼</p>
<p>äººæ— æ³•ä¸‰å¤´å…­è‡‚ï¼Œä½†åœ¨Pythoné‡Œï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ°ã€‚</p>
<h2 id="å¹¶å‘-amp-å¹¶è¡Œå®éªŒ"><a href="#å¹¶å‘-amp-å¹¶è¡Œå®éªŒ" class="headerlink" title="å¹¶å‘&amp;å¹¶è¡Œå®éªŒ"></a>å¹¶å‘&amp;å¹¶è¡Œå®éªŒ</h2><p>è¦æƒ³å®ç°ä¸‰å¤´å…­è‡‚çš„æ•ˆç‡ï¼Œä¸èµ°å•ä¸€é¡ºåºæµï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦è®©å¤šä¸ªä»»åŠ¡èƒ½å¤Ÿå¹¶å‘ï¼ˆConcurrentï¼‰ï¼Œè¿˜èƒ½å¤Ÿå¹¶è¡Œï¼ˆParallelï¼‰è¿ä½œã€‚</p>
<p>å‡ä½¿åƒé¥­åƒåˆ°ä¸€åŠï¼Œäººæœ‰ä¸‰æ€¥ï¼Œæ‘˜èŠ±å›æ¥ç»§ç»­ç”¨è†³ï¼Œé‚£ä¹ˆå¦‚æœæŠŠâ€œåƒé¥­â€ä¸â€œè§£æ‰‹â€å½“ä½œä¸¤ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå®ƒä»¬ä¾¿æ˜¯ä¾¿æ˜¯å¹¶å‘è¿ä½œï¼Œä½†ä¸å¹¶è¡Œã€‚å¦‚æœå¤ªè¿½æ±‚æ•ˆç‡ï¼Œè¹²å‘æ°é¥­ï¼Œé‚£ä¾¿å³æ˜¯å¹¶å‘ï¼Œä¹Ÿæ˜¯å¹¶è¡Œäº†ã€‚</p>
<p>åœ¨Pythonä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‰ç§æ–¹å¼å®ç°å¹¶å‘ã€‚ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–¹æ³•ï¼Œéƒ½æ”¯æŒå¹¶è¡Œã€‚</p>
<p>è¿™ä¸‰ç§æ–¹æ³•æ˜¯ï¼š</p>
<a id="more"></a>
<ul>
<li>å¤šçº¿ç¨‹ Multi Threading</li>
<li>å¤šè¿›ç¨‹ Multi Processing</li>
<li>å¼‚æ­¥IO Async IO</li>
</ul>
<p>å…¶ä¸­ï¼Œå¼‚æ­¥IOçš„å®ç°æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨ç¬¬å››ç« <a href="https://utmhikari.github.io/2019/03/31/easypython/iv">ã€Šç©è½¬è±†ç“£äºŒç™¾äº”ï¼šä¸‹ã€‹</a>ä¸­å·²ç»ä»‹ç»è¿‡ã€‚å¤šçº¿ç¨‹å’Œå¤šè¿›ç¨‹çš„å®ç°æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvemgtY24vMy8=" title="https://docs.python.org/zh-cn/3/">Pythonå®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span>ï¼Œæˆ–è€…å¹²è„†ç›´æ¥çœ‹ä¸‹é¢çš„å®ä¾‹ã€‚</p>
<p>é€šè¿‡ä¸€ä¸ªç®€å•çš„è¿è¡Œæ—¶é—´æµ‹è¯•æˆ‘ä»¬å°±å¯ä»¥å‘ç°ï¼Œè¿™ä¸‰ç§æ–¹æ³•ä¸­ï¼Œå“ªäº›æ–¹æ³•æ˜¯èƒ½å¤ŸçœŸæ­£åˆ©ç”¨å¹¶è¡Œçš„æ•ˆç‡ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"></span><br><span class="line">TOTAL = <span class="number">20000</span>  <span class="comment"># å­ä»»åŠ¡æ‰§è¡Œæ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(n)</span>:</span>  <span class="comment"># æ¯ä¸ªå­ä»»åŠ¡ï¼Œä»nå‡åˆ°-n</span></span><br><span class="line">    end = -n</span><br><span class="line">    <span class="keyword">while</span> n &gt; end:</span><br><span class="line">        n -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sequential</span><span class="params">()</span>:</span>  <span class="comment"># ä¸€èˆ¬çš„é¡ºåºæ‰§è¡Œ</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(TOTAL):</span><br><span class="line">        task(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_process</span><span class="params">()</span>:</span>  <span class="comment"># å¤šè¿›ç¨‹ï¼Œè®¾å®šæœ€å¤§è¿›ç¨‹æ•°ä¸º10ï¼Œæ”¾åˆ°ä¸€ä¸ªæ± é‡Œè°ƒåº¦</span></span><br><span class="line">    pool = Pool(<span class="number">10</span>)</span><br><span class="line">    pool.map(task, range(TOTAL))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">async_io</span><span class="params">()</span>:</span>  <span class="comment"># å¼‚æ­¥IOï¼Œè¯¦è§Easy Pythonç¬¬å››ç« </span></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">async_task</span><span class="params">(n)</span>:</span></span><br><span class="line">        task(n)</span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(*[async_task(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(TOTAL)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multi_thread</span><span class="params">()</span>:</span>  <span class="comment"># å¤šçº¿ç¨‹ï¼Œè®¾å®š10ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§è¡Œ2000ä¸ªtask</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tasks</span><span class="params">(ns)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> ns:</span><br><span class="line">            task(n)</span><br><span class="line">    threads = []</span><br><span class="line">    inputs = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> range(<span class="number">10</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(TOTAL):</span><br><span class="line">        inputs[(i % <span class="number">10</span>)].append(i)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        threads.append(Thread(target=functools.partial(tasks, inputs[i])))</span><br><span class="line">        threads[<span class="number">-1</span>].start()</span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># sequential</span></span><br><span class="line">    start = datetime.datetime.now()</span><br><span class="line">    sequential()</span><br><span class="line">    print(<span class="string">"Sequential: %s"</span> % (datetime.datetime.now() - start).total_seconds())</span><br><span class="line">    <span class="comment"># multi-process</span></span><br><span class="line">    start = datetime.datetime.now()</span><br><span class="line">    multi_process()</span><br><span class="line">    print(<span class="string">"Multi-Process: %s"</span> % (datetime.datetime.now() - start).total_seconds())</span><br><span class="line">    <span class="comment"># asyncio</span></span><br><span class="line">    start = datetime.datetime.now()</span><br><span class="line">    asyncio.run(async_io())</span><br><span class="line">    print(<span class="string">"Async-IO: %s"</span> % (datetime.datetime.now() - start).total_seconds())</span><br><span class="line">    <span class="comment"># multi-thread</span></span><br><span class="line">    start = datetime.datetime.now()</span><br><span class="line">    multi_thread()</span><br><span class="line">    print(<span class="string">"Multi-Thread: %s"</span> % (datetime.datetime.now() - start).total_seconds())</span><br></pre></td></tr></table></figure>
<p>ç»“æœå‡ºç‚‰ï¼</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Sequential: 18.116519</span><br><span class="line">Multi-Process: 3.879628</span><br><span class="line">Async-IO: 18.225281</span><br><span class="line">Multi-Thread: 18.119936</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ï¼Œåªæœ‰é‡‡ç”¨å¤šè¿›ç¨‹çš„æ–¹å¼ï¼Œèƒ½å¤Ÿç¬¦åˆæˆ‘ä»¬çš„å¹¶è¡ŒçŒœæµ‹ã€‚å…¶å®ƒæ–¹å¼ï¼Œç”šè‡³æ¯”é¡ºåºæ‰§è¡Œè¿˜è¦æ…¢ä¸€äº›ï¼Œåº”å½“ä¸æ˜¯å¹¶è¡Œè¿è¡Œã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆæ˜¯å¤šè¿›ç¨‹ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆæ˜¯å¤šè¿›ç¨‹ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯å¤šè¿›ç¨‹ï¼Ÿ"></a>ä¸ºä»€ä¹ˆæ˜¯å¤šè¿›ç¨‹ï¼Ÿ</h2><h3 id="çº¿ç¨‹ä¸è¿›ç¨‹"><a href="#çº¿ç¨‹ä¸è¿›ç¨‹" class="headerlink" title="çº¿ç¨‹ä¸è¿›ç¨‹"></a>çº¿ç¨‹ä¸è¿›ç¨‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç®€è¦ä»‹ç»ä¸€ä¸‹<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvVGhyZWFkXyUyOGNvbXB1dGluZyUyOQ==" title="https://en.wikipedia.org/wiki/Thread_%28computing%29">çº¿ç¨‹<i class="fa fa-external-link"></i></span>ä¸<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvUHJvY2Vzc18lMjhjb21wdXRpbmclMjk=" title="https://en.wikipedia.org/wiki/Process_%28computing%29">è¿›ç¨‹<i class="fa fa-external-link"></i></span>ã€‚</p>
<ul>
<li>çº¿ç¨‹ï¼ˆThreadï¼‰ï¼šæ“ä½œç³»ç»Ÿè°ƒåº¦æœ€å°å•ä½ï¼Œé¡ºåºæ‰§è¡Œçš„ç¨‹åºæµ</li>
<li>è¿›ç¨‹ï¼ˆProcessï¼‰ï¼šè®¡ç®—æœºç¨‹åºçš„å®ä¾‹ï¼Œçº¿ç¨‹çš„å®¹å™¨</li>
</ul>
<p>è¿›ç¨‹ï¼Œå¥½æ¯”æ˜¯ä¸€ä¸ªç‰¹å®šå·¥ä½œçš„æµç¨‹ï¼Œæ˜¯ç›¸å¯¹å®è§‚çš„ï¼›çº¿ç¨‹ï¼Œåˆ™æ˜¯ä¸€ä¸ªä¸ªå­ä»»åŠ¡çš„æµç¨‹ï¼Œæ˜¯ç›¸å¯¹å¾®è§‚çš„ã€‚ä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œå¯ä»¥å®¹çº³å¤šä¸ªä¸åŒçš„çº¿ç¨‹ä»¥æ‰§è¡Œä¸åŒç±»å‹çš„å·¥ä½œã€‚åŒä¸€ä¸ªè¿›ç¨‹çš„ä¸åŒçº¿ç¨‹ä¹‹é—´ï¼Œå…±äº«äº†è®¸å¤šå½“å‰è¿›ç¨‹ä¿¡æ¯ï¼Œç›¸äº’ç‹¬ç«‹æ€§è¾ƒå¼±ï¼›è€ŒåŒä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ä¹‹é—´ï¼Œå…±äº«ä¿¡æ¯è¾ƒå°‘ï¼Œç›¸äº’ç‹¬ç«‹æ€§å¼ºã€‚</p>
<p>åœ¨å®é™…æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œå¯¹äºå•ä¸ªï¼ˆæ ¸ï¼‰CPUè€Œè¨€ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½è·‘ä¸€ä¸ªç‰¹å®šçš„çº¿ç¨‹ã€‚CPUé€šè¿‡ä¸åœåœ°åˆ‡æ¢ä¸åŒçº¿ç¨‹å®ç°å„ä¸ªçº¿ç¨‹ä»»åŠ¡çš„å¹¶å‘ï¼Œå¹¶ä¸”ç”±äºCPUæ‰‹é€Ÿå¤ªå¿«ï¼Œé€ æˆäº†æˆ‘ä»¬ä¸€æŒ‰<code>ctrl + alt + del</code>æ‰€çœ‹åˆ°çš„ï¼ŒåŒä¸€æ—¶åˆ»å‡ åä¸ªè¿›ç¨‹éƒ½åœ¨åŒæ—¶è·‘çš„å‡è±¡ã€‚ä½†æ˜¯ï¼Œå¯¹äºå¤šæ ¸CPUè€Œè¨€ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšåˆ°åœ¨å¤šä¸ªCPUä¸Šï¼Œå¹¶å‘å¹¶ä¸”å¹¶è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œå¢åŠ æ‰§è¡Œæ•ˆç‡ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼ŒPythonçš„å¤šçº¿ç¨‹ï¼Œå´æ— æ³•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<h3 id="å…¨å±€è§£é‡Šå™¨é”GIL"><a href="#å…¨å±€è§£é‡Šå™¨é”GIL" class="headerlink" title="å…¨å±€è§£é‡Šå™¨é”GIL"></a>å…¨å±€è§£é‡Šå™¨é”GIL</h3><p>Pythonå¤šçº¿ç¨‹æ— æ³•åˆ©ç”¨å¤šæ ¸CPUçš„ä¼˜åŠ¿ï¼Œå…¶ç½ªé­ç¥¸é¦–ï¼Œåœ¨äºå…¨å±€è§£é‡Šå™¨é”ï¼ˆGILï¼ŒGlobal Interpreter Lockï¼‰</p>
<p>äº†è§£GILï¼Œå¯ä»¥çœ‹è¿™ä¸ªèµ„æ–™ï¼š<span class="exturl" data-url="aHR0cDovL3d3dy5kYWJlYXouY29tL3B5dGhvbi9VbmRlcnN0YW5kaW5nR0lMLnBkZg==" title="http://www.dabeaz.com/python/UnderstandingGIL.pdf">UnderstandingGIL<i class="fa fa-external-link"></i></span></p>
<p>è¿è¡ŒPythonä»£ç ï¼Œéœ€è¦é€šè¿‡è§£é‡Šå™¨ï¼ˆIntepreterï¼‰è¿›è¡Œã€‚Pythonè§£é‡Šå™¨åœ¨è¯»å–äº†ä¸€è¡ŒPythonä»£ç åï¼Œå°±ä¼šå°†å…¶æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåï¼Œå†è¯»å–ä¸‹ä¸€è¡Œä»£ç ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>GILèƒ½å¤Ÿä½¿å¾—åŒä¸€æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½åœ¨æ‰§è¡Œã€‚Pythonçš„å®˜æ–¹å®ç°Cythonå°±é‡‡ç”¨äº†è¿™ç§æœºåˆ¶ï¼Œä¿è¯Pythonè¿›ç¨‹ä¸­èµ„æºçš„çŠ¶æ€èƒ½å¤ŸåŒæ­¥ï¼ˆsynchronizeï¼‰åˆ°å„ä¸ªçº¿ç¨‹ä¸­ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒGILç®€å•ç²—æš´ï¼Œè®©æˆ‘ä»¬çœå»äº†èµ„æºåŒæ­¥çš„æ‹…å¿§ï¼Œä½†ç›¸å¯¹åœ°ï¼Œé€ æˆäº†ä¸€ç§åŒä¸€æ—¶åˆ»ä¸€ä¸ªçº¿ç¨‹åŒ…åœºçš„æ™¯è±¡ï¼Œä¸èƒ½æ»¡è¶³ç»†ç²’åº¦çš„èµ„æºåŒæ­¥æ“ä½œã€‚</p>
<p>å› æ­¤ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•å°±æ˜¯å¼€å¯å¤šä¸ªè¿›ç¨‹ï¼Œè®©æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„è§£é‡Šå™¨è·ŸGILã€‚è¿™æ ·ï¼Œå°±èƒ½å®ç°å¤šä»»åŠ¡çš„å¹¶è¡Œäº†ã€‚</p>
<h2 id="å¤šè¿›ç¨‹èµ„æºå…±äº«â€”â€”TornadoCenter"><a href="#å¤šè¿›ç¨‹èµ„æºå…±äº«â€”â€”TornadoCenter" class="headerlink" title="å¤šè¿›ç¨‹èµ„æºå…±äº«â€”â€”TornadoCenter"></a>å¤šè¿›ç¨‹èµ„æºå…±äº«â€”â€”TornadoCenter</h2><p>è¿›ç¨‹ä¹‹é—´çš„èµ„æºä¿¡æ¯é€šå¸¸æ˜¯ä¸å…±äº«çš„ï¼Œå› æ­¤è¦å€Ÿç”±ç³»ç»Ÿè‡ªèº«çš„æœºåˆ¶ã€‚æ¯”å¦‚è¯´å†…å­˜ä¿¡æ¯å…±äº«ï¼Œåœ¨Pythonçš„å¤šè¿›ç¨‹æ¨¡å—<code>multiprocessing</code>ä¸­ï¼Œå°±æä¾›äº†<code>Pipeï¼ˆç®¡é“ï¼‰</code>ã€<code>Queueï¼ˆé˜Ÿåˆ—ï¼‰</code>ç­‰æ–¹å¼ï¼Œä½¿å¾—ä¸åŒè¿›ç¨‹ä¹‹é—´çš„æ•°æ®å¯ä»¥å…±äº«ã€‚</p>
<p>åœ¨æˆ‘çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9Ub3JuYWRvQ2VudGVy" title="https://github.com/utmhikari/TornadoCenter">TornadoCenter<i class="fa fa-external-link"></i></span>å°é¡¹ç›®ä¸­ï¼Œå°±æœ‰è¿™æ ·çš„ä¸€ä¸ªå®ä¾‹â€”â€”ä¸»è¿›ç¨‹æ˜¯cmdå°é»‘æ¡†å‘½ä»¤è¡Œç¨‹åºï¼Œé€šè¿‡è§„å®šçš„æŒ‡ä»¤å¯ä»¥å¼€å¯æœåŠ¡å™¨è¿›ç¨‹ä¸å®¢æˆ·ç«¯è¿›ç¨‹ã€‚å®¢æˆ·ç«¯è¿›ç¨‹é€šè¿‡ç½‘ç»œè¯»å†™å¾€æœåŠ¡å™¨è¿›ç¨‹å‘é€æ•°æ®ï¼Œè€ŒæœåŠ¡å™¨è¿›ç¨‹åˆ™é€šè¿‡<code>Queue</code>é˜Ÿåˆ—å‘é€æ•°æ®ç»™ä¸»è¿›ç¨‹ã€‚Tornadoæ˜¯ä¸€ä¸ªè‘—åçš„Pythonç½‘ç»œæ¡†æ¶ï¼Œå› æ­¤èƒ½æ»¡è¶³è¿™æ–¹é¢çš„éœ€æ±‚ã€‚</p>
<p>ä¸»è¿›ç¨‹å¤§æ¦‚è®¾è®¡å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    å¿½ç•¥å…¶å®ƒåˆå§‹åŒ–</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self._cmd_state = &#123;</span><br><span class="line">        <span class="string">'exit'</span>: self._exit,</span><br><span class="line">        <span class="string">'help'</span>: self._help,</span><br><span class="line">        <span class="string">'server'</span>: &#123;</span><br><span class="line">            <span class="string">'start'</span>: self._start_server,</span><br><span class="line">            <span class="string">'stop'</span>: self._stop_server,</span><br><span class="line">            <span class="string">'params'</span>: self._show_server_params,</span><br><span class="line">            <span class="string">'status'</span>: self._show_server_status</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'client'</span>: &#123;</span><br><span class="line">            <span class="string">'start'</span>: self._start_client,</span><br><span class="line">            <span class="string">'stop'</span>: self._stop_client,</span><br><span class="line">            <span class="string">'status'</span>: self._show_client_status</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    self._server_holder = TornadoTCPServerHolder()</span><br><span class="line">    self._client_holder = TornadoTCPClientHolder()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_dispatch</span><span class="params">(self, cmds, cmd_state)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    dispatch cmds on cmd state machine</span></span><br><span class="line"><span class="string">    :param cmds: cmd.split(' ')</span></span><br><span class="line"><span class="string">    :param cmd_state: the current state of cmd</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    len_cmd = len(cmds)</span><br><span class="line">    <span class="keyword">if</span> len_cmd == <span class="number">0</span> <span class="keyword">or</span> cmds[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> cmd_state.keys():</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    state = cmd_state[cmds[<span class="number">0</span>]]</span><br><span class="line">    <span class="keyword">if</span> callable(state):</span><br><span class="line">        sig = signature(state)</span><br><span class="line">        len_pars = len(sig.parameters)</span><br><span class="line">        <span class="keyword">if</span> len_pars == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> state() <span class="keyword">if</span> len_cmd == <span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> functools.partial(state, cmds[<span class="number">1</span>:])() <span class="keyword">if</span> len_cmd &gt; <span class="number">1</span> <span class="keyword">else</span> state()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> self._dispatch(cmds[<span class="number">1</span>:], state) <span class="keyword">if</span> len_cmd &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">loop</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Main loop of TornadoCenter</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    self._log(<span class="string">'Start main loop!!!'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = input(<span class="string">'\n$ '</span>).strip()</span><br><span class="line">        <span class="keyword">if</span> len(cmd) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        cmds = cmd.split(<span class="string">' '</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._dispatch(cmds, self._cmd_state):</span><br><span class="line">            self._exception(<span class="string">'Invalid command: %s!'</span> % cmd)</span><br><span class="line">            self._help()</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥æ‹†è§£ä¸€ä¸‹ä¸šåŠ¡ï¼š</p>
<ul>
<li>åˆå§‹åŒ–å˜é‡<ul>
<li>cmd_state: æ ¹æ®æŒ‡ä»¤æŸ¥æ‰¾å¯¹åº”æ‰§è¡Œå‡½æ•°çš„reference</li>
<li>server_holder: ç®¡ç†æœåŠ¡å™¨è¿›ç¨‹</li>
<li>client_holder: ç®¡ç†å®¢æˆ·ç«¯è¿›ç¨‹</li>
</ul>
</li>
<li>å‡½æ•°<ul>
<li>loopï¼šä¸»å¾ªç¯ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨cmdç•Œé¢ä¸Šèƒ½ä¸€ç›´è¾“å…¥æŒ‡ä»¤ï¼Œè¾“é”™äº†åˆ™æ˜¾ç¤ºå¸®åŠ©</li>
<li>dispatch: æ ¹æ®æŒ‡ä»¤ä¸cmd_stateï¼ŒæŸ¥æ‰¾&amp;æ‰§è¡Œå¯¹åº”å‡½æ•°</li>
</ul>
</li>
</ul>
<p>å¯¹äºç®¡ç†æœåŠ¡å™¨è¿›ç¨‹çš„<code>server_holder</code>ï¼Œæˆ‘ä»¬éœ€è¦è®©å…¶æŒæœ‰æœåŠ¡å™¨è¿›ç¨‹çš„å®ä¾‹<code>process</code>ï¼Œäº’é€šæœåŠ¡å™¨è¿›ç¨‹æ•°æ®çš„é€šé“<code>queue</code>ï¼Œä»¥åŠæŸ¥è¯¢æœåŠ¡å™¨è¿›ç¨‹çŠ¶æ€çš„ä¸€äº›æ¥å£ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TornadoTCPServerHolder</span><span class="params">(BaseCSHolder)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Tornado TCPServer Holder</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Initialization</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        BaseCSHolder.__init__(self, <span class="string">'TCPServerHolder'</span>)</span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        Server Info</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self._process = <span class="literal">None</span></span><br><span class="line">        self._queue = Queue()</span><br><span class="line">        self._params = &#123;</span><br><span class="line">            <span class="string">'host'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">            <span class="string">'port'</span>: <span class="number">5000</span>,</span><br><span class="line">            <span class="string">'num_processes'</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">'''</span></span><br><span class="line"><span class="string">        Monitor Thread</span></span><br><span class="line"><span class="string">        '''</span></span><br><span class="line">        self._monitor = <span class="literal">None</span></span><br><span class="line">        self._is_monitor_stop = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_monitor_loop</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Monitor thread, print the data received by the server</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._log(<span class="string">'Starting Monitor...'</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> self._is_monitor_stop:</span><br><span class="line">                self._is_monitor_stop = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> self._queue.empty():</span><br><span class="line">                data = self._queue.get()</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">if</span> data.startswith(<span class="string">'JSON|'</span>):</span><br><span class="line">                        json_data = json.loads(data[<span class="number">5</span>:])</span><br><span class="line">                        self._log(<span class="string">'Received JSON data: %s\n%s'</span> % (</span><br><span class="line">                            type(json_data), json.dumps(json_data, indent=<span class="number">2</span>)</span><br><span class="line">                        ))</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        self._log(<span class="string">'Received String: %s'</span> % data)</span><br><span class="line">                <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                    self._exception(e)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Start Tornado TCPServer Process</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self._log(<span class="string">'Starting Tornado TCPServer...'</span>)</span><br><span class="line">        <span class="keyword">if</span> self.is_server_active():</span><br><span class="line">            self._exception(<span class="string">'Cannot start server! The TCPServer is still active!'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._process = TornadoTCPServerProcess(queue=self._queue, params=self._params)</span><br><span class="line">            self._process.start()</span><br><span class="line">            self._monitor = Thread(target=self._monitor_loop)</span><br><span class="line">            self._monitor.start()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>ç‰©ä»¥ç±»èšï¼Œæˆ‘ä»¬å¯ä»¥å°†æœåŠ¡å™¨è¿›ç¨‹çš„ç®¡ç†æŠ½è±¡åˆ°ä¸€ä¸ªç±»ä¸­ã€‚è¿™ä¸ªç±»ç»§æ‰¿äº†å¦å¤–ä¸€ä¸ªå«<code>BaseCSHolder</code>çš„ç±»ï¼Œå…·å¤‡æ‰“å°æ—¥å¿—ä»¥åŠç¼–è¾‘å‚æ•°çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseCSHolder</span><span class="params">(Logger)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Client and Server Holder Class</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, tag=<span class="string">'BaseCSHolder'</span>)</span>:</span></span><br><span class="line">        Logger.__init__(self, tag)</span><br><span class="line">        self._params = dict()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_param_keys</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        get the keys of params</span></span><br><span class="line"><span class="string">        :return: sorted param keys</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> sorted(self._params.keys())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_params</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        get the params</span></span><br><span class="line"><span class="string">        :return: params dict</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self._params</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_params</span><span class="params">(self, params)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        set the params of the server</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">pass</span>  <span class="comment"># æ­¤å¤„çœç•¥</span></span><br></pre></td></tr></table></figure>
<p>æ€»çš„æ¥çœ‹ï¼Œåœ¨å¯åŠ¨æœåŠ¡å™¨è¿›ç¨‹ä¹‹åï¼ŒåŒæ—¶ä¹Ÿèµ·ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ<code>monitor_loop</code>çš„é€»è¾‘ï¼Œç›‘æ§<code>Queue</code>é‡Œçš„æ•°æ®ã€‚æ¯å½“<code>Queue</code>é‡Œæœ‰æ•°æ®çš„æ—¶å€™ï¼Œå°±å–å‡ºæ¥æ•°æ®ï¼Œæ‰“å°å‡ºæ¥ã€‚</p>
<p>å¯¹äºæœåŠ¡å™¨è¿›ç¨‹çš„å®ä¾‹ï¼ˆServer Process Instanceï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è®©å…¶æŒæœ‰æœåŠ¡å™¨å®ä¾‹ï¼ˆServer Instanceï¼‰ã€ä¸»çº¿ç¨‹ä¼ é€’çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚æœåŠ¡å™¨å‚æ•°ä¸<code>Queue</code>ï¼‰ä»¥åŠå…¶å®ƒè‡ªèº«ä¿¡æ¯ã€‚æœåŠ¡å™¨è¿›ç¨‹å®ä¾‹ç›¸å½“äºæ˜¯æœåŠ¡å™¨å®ä¾‹çš„å®¹å™¨ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TornadoTCPServerProcess</span><span class="params">(Process, Logger)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    TCPServer Process</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, queue=None, params=None)</span>:</span></span><br><span class="line">        Process.__init__(self, daemon=<span class="literal">True</span>)</span><br><span class="line">        Logger.__init__(self, <span class="string">'TCPServerProcess'</span>)</span><br><span class="line">        self._queue = queue</span><br><span class="line">        self._params = params</span><br><span class="line">        self._server = <span class="literal">None</span>  <span class="comment"># è¿è¡Œè¯¥è¿›ç¨‹ï¼ˆrunï¼‰åï¼Œä¼šå¼€å¯æœåŠ¡å™¨å®ä¾‹</span></span><br></pre></td></tr></table></figure>
<p>è€Œæœ€åï¼Œå¯¹äºæœåŠ¡å™¨å®ä¾‹ï¼Œå°±æ˜¯å®å®åœ¨åœ¨åœ°ç»§æ‰¿æœåŠ¡å™¨æ¡†æ¶äº†ã€‚</p>
<p>Tornadoæ¡†æ¶çš„ç”¨æ³•ï¼Œå¯ä»¥å‚è€ƒ<span class="exturl" data-url="aHR0cDovL3d3dy50b3JuYWRvd2ViLm9yZy9lbi9zdGFibGUvZ3VpZGUuaHRtbA==" title="http://www.tornadoweb.org/en/stable/guide.html">å®˜æ–¹æ–‡æ¡£<i class="fa fa-external-link"></i></span></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TornadoTCPServer</span><span class="params">(TCPServer, Logger)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    TCPServer instance of tornado</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, queue=None)</span>:</span></span><br><span class="line">        TCPServer.__init__(self)</span><br><span class="line">        Logger.__init__(self, <span class="string">'TCPServer'</span>)</span><br><span class="line">        self._queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">handle_stream</span><span class="params">(self, stream, address)</span>:</span></span><br><span class="line">        host, port = address</span><br><span class="line">        addr = <span class="string">'%s:%s'</span> % (host, port)</span><br><span class="line">        self._log(<span class="string">'Handling stream at %s'</span> % addr)</span><br><span class="line">        proto_cnt = <span class="number">0</span></span><br><span class="line">        <span class="keyword">await</span> stream.write(<span class="string">'Welcome to tornado server!'</span>.encode(<span class="string">'utf-8'</span>))</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                data = <span class="keyword">await</span> stream.read_bytes(<span class="number">4096</span>, partial=<span class="literal">True</span>)</span><br><span class="line">                decode_data = data.decode().strip()</span><br><span class="line">                self._queue.put(decode_data)</span><br><span class="line">                proto_cnt += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> proto_cnt % <span class="number">10</span> == <span class="number">0</span>:</span><br><span class="line">                    self._log(<span class="string">'Received %d protos from %s!'</span> % (proto_cnt, addr))</span><br><span class="line">            <span class="keyword">except</span> StreamClosedError:</span><br><span class="line">                self._log(<span class="string">'Stream at %s:%s is closed!'</span> % (host, port))</span><br><span class="line">                <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡æœåŠ¡å™¨å®ä¾‹åœ¨æ”¶åˆ°æ•°æ®åï¼Œå°±ä¼šæŠŠæ•°æ®è§£ç æ”¾åˆ°<code>Queue</code>é˜Ÿåˆ—å¤´é‡Œã€‚è¿™æ ·åœ¨ä¸»çº¿ç¨‹é‚£ä¸€ç«¯ï¼Œå°±å¯ä»¥å®æ—¶åœ¨é˜Ÿåˆ—å°¾å–å‡ºæ•°æ®æ‰“å°äº†ã€‚</p>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†å¤šè¿›ç¨‹ä¹‹é—´çš„èµ„æºå…±äº«ã€‚æ€ä¹ˆæ ·ï¼Œè¦ä¸è¦è¯•è¯•â€œåƒæ‰‹è§‚éŸ³â€~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ‰äº†å¤šè¿›ç¨‹ä¸å¼‚æ­¥çš„æ”¯æŒï¼ŒPythonåœ¨åŸºç¡€ä»»åŠ¡è°ƒåº¦ä¸Šï¼Œæ›´æ˜¯å¢å¼ºäº†ä¸€ä¸ªå±‚æ¬¡</p>
<p>Easy Pythonç¬¬å…­ç« â€”â€”å¤šè¿›ç¨‹å¹¶è¡Œï¼Œä¹Ÿæ ‡å¿—ç€Easy Pythonç³»åˆ—è¿›å…¥å°¾å£°</p>
<p>ç¬¬ä¸ƒç« ï¼Œä¼šå¯¹Easy Pythonç³»åˆ—åšæœ€ç»ˆçš„æ•´ç†</p>
<p>See ya~</p>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>GIL</tag>
        <tag>å¹¶è¡Œ</tag>
        <tag>å¹¶å‘</tag>
        <tag>multiprocessing</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€DIYå°è®°ã€‘è¸å¹³Win10å‡çº§ä¹‹å‘â€”â€”æˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒº</title>
    <url>/2019/05/01/diymemo/msr/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰å‡ å¤©å¿ƒè¡€æ¥æ½®ï¼Œæƒ³æŠŠè‡ªå·±èˆ¹ä¸Šçš„Win10æ›´æ–°åˆ°18å¹´10æœˆçš„ç‰ˆæœ¬ï¼ˆ1809ï¼‰ï¼Œç»“æœæ˜“å‡ä¸‹è½½äº†æ›´æ–°ä¹‹åï¼Œå®‰è£…æ—¶æç¤ºâ€œæˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒºâ€ï¼Œäºæ˜¯ä¸€è„¸æ‡µé€¼ã€‚</p>
<p><img src="/uploads/diymemo/msr/nomsr.png" alt="æˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒº" title="&#39;æˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒº&#39;"></p>
<p>å‘ä¹Ÿæ˜¯è¦æ…¢æ…¢è¸©çš„ã€‚ç†¬äº†ä¸¤å¤œï¼Œç»ˆäºæˆåŠŸè§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå°†Win10å‡çº§åˆ°äº†æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<h2 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h2><h3 id="åŸå› åˆ†æ"><a href="#åŸå› åˆ†æ" class="headerlink" title="åŸå› åˆ†æ"></a>åŸå› åˆ†æ</h3><p>é‡åˆ°è¿™ä¸ªé—®é¢˜åï¼Œç¬”è€…ç¬¬ä¸€æ—¶é—´googleç™¾åº¦äº†ä¸‹è§£å†³æ–¹æ¡ˆï¼Œçœ‹åˆ°äº†ä»¥ä¸‹å‡ æ¡ï¼š</p>
<a id="more"></a>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9hbnN3ZXJzLm1pY3Jvc29mdC5jb20vemgtaGFucy93aW5kb3dzL2ZvcnVtL3dpbmRvd3M4XzEtdXBkYXRlLyVFNSVBRSU4OSVFOCVBMyU4NXdpbjEwJUU2JTgwJUJCJUU2JTk4JUFGJUU2JThGJTkwLzJmN2JiZGI0LTMzYmQtNGE3Yy1iZDg1LTU3NzFhNWFmMTZjZQ==" title="https://answers.microsoft.com/zh-hans/windows/forum/windows8_1-update/%E5%AE%89%E8%A3%85win10%E6%80%BB%E6%98%AF%E6%8F%90/2f7bbdb4-33bd-4a7c-bd85-5771a5af16ce">å®‰è£…win10æ€»æ˜¯æç¤ºï¼šæˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒº<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL21vczg2LmNvbS80MTE1Mi5odG1s" title="http://mos86.com/41152.html">æ­¤PCä¸èƒ½è¿è¡ŒWindows 10 â€“ æˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™åˆ†åŒº<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL2Jicy5wY2JldGEuY29tL2ZvcnVtLnBocD9tb2Q9dmlld3RocmVhZCZhbXA7dGlkPTE3MzU5MjM=" title="http://bbs.pcbeta.com/forum.php?mod=viewthread&amp;tid=1735923">win10.15063æ›´æ–°å‡ºé”™â€æˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒºâ€<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL2Jicy5wY2JldGEuY29tL2ZvcnVtLnBocD9tb2Q9dmlld3RocmVhZCZhbXA7dGlkPTE2MjA5NzA=" title="http://bbs.pcbeta.com/forum.php?mod=viewthread&amp;tid=1620970">æ±‚åŠ©ï¼Œæ— æ³•æ›´æ–°windows10!!!é—®é¢˜â€œæˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒºâ€ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼<i class="fa fa-external-link"></i></span></li>
<li><span class="exturl" data-url="aHR0cDovL3RpZWJhLmJhaWR1LmNvbS9wLzQ0MDAxNTU5OTc=" title="http://tieba.baidu.com/p/4400155997">æ±‚åŠ©ï¼Œæˆ‘ä»¬æ— æ³•æ›´æ–°ç³»ç»Ÿä¿ç•™çš„åˆ†åŒº<i class="fa fa-external-link"></i></span></li>
<li>and so onâ€¦</li>
</ul>
<p>æ€»çš„æ¥çœ‹ï¼Œåº”è¯¥æ˜¯å…ˆå‰è£…Windowsç³»ç»Ÿæ—¶ï¼Œå®‰è£…ç¨‹åºä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¿ç•™åˆ†åŒºï¼Œä½†æ˜¯ç”±äºåˆ†åŒºä¸å¤Ÿå¤§ï¼Œå¯¼è‡´æ— æ³•å®‰è£…æ–°ç‰ˆæœ¬çš„ç³»ç»Ÿã€‚</p>
<h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç¬”è€…æœæ–­æ‰“å¼€ç¥–ä¼ çš„<span class="exturl" data-url="aHR0cDovL3d3dy5kaXNrZ2VuaXVzLmNuLw==" title="http://www.diskgenius.cn/">DiskGenius<i class="fa fa-external-link"></i></span>ï¼ŒæŸ¥çœ‹äº†ä¸‹ç¡¬ç›˜åˆ†åŒº</p>
<p><img src="/uploads/diymemo/msr/efi.jpg" alt="å¼•å¯¼åˆ†åŒº" title="&#39;å¼•å¯¼åˆ†åŒº&#39;"></p>
<p><img src="/uploads/diymemo/msr/msr.jpg" alt="MSR" title="&#39;MSR&#39;"></p>
<p>ä¸Šå›¾æ˜¯å¼•å¯¼åˆ†åŒºï¼ˆBootï¼‰ï¼Œé‡Œè¾¹çš„è®°å½•ç€æ•´ä¸ªç”µè„‘çš„å¼•å¯¼ä¿¡æ¯ã€‚æˆ‘ä»¬å¸¸è¯´çš„å¯åŠ¨ã€é‡å¯ï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¼•å¯¼ã€é‡å¼•å¯¼ï¼ˆBoot&amp;Rebootï¼‰ã€‚åœ¨å’±ä»¬ç”µè„‘åˆšå¼€æœºçš„æ—¶å€™ï¼Œå°±æ˜¯åˆ©ç”¨è¿™ä¸ªåˆ†åŒºçš„æ–‡ä»¶æ¥å¯åŠ¨æ“ä½œç³»ç»Ÿçš„ã€‚</p>
<p>ä¸‹å›¾æ˜¯MSRåˆ†åŒºï¼ˆMicrosoft Reserved Partitionï¼‰æ˜¯Windowsè£…æœºæ—¶å€™è‡ªåŠ¨ä¼šå¼€çš„é¢„ç•™åˆ†åŒºï¼Œä¹Ÿå°±æ­£å¥½å¯¹åº”ç€æç¤ºé‡Œçš„â€œä¿ç•™åˆ†åŒºâ€äº†ã€‚æˆ‘ä»¬çš„å·¥ä½œä¸»è¦é’ˆå¯¹è¿™ä¸ªè¿›è¡Œã€‚</p>
<p>å¦‚æœè¦æ‰©å®¹MSRåˆ†åŒºçš„è¯ï¼Œåªèƒ½ç”¨è¿™ä¸ªåˆ†åŒºç›¸é‚»çš„ç©ºé—´ã€‚ä»DiskGeniusç•Œé¢ä¸Šéƒ¨åˆ†çš„ç¡¬ç›˜æ¡æ¥çœ‹ï¼ŒMSRåˆ†åŒºçš„å·¦è¾¹æ˜¯å¼•å¯¼åˆ†åŒºï¼Œå­˜æ”¾ç€å¯åŠ¨ç³»ç»Ÿçš„æ–‡ä»¶ï¼Œä¸å¥½æ¸…æ‰ï¼›MSRåˆ†åŒºçš„å³è¾¹åˆšä¸Šèˆ¹å°±è‡ªå¸¦çš„æ¢å¤åˆ†åŒºï¼ˆMicrosoft Recovery Partitionï¼‰ï¼Œå¤§æ¦‚500Må¤§å°ã€‚ä»ç½‘ä¸Šæœåˆ°çš„èµ„æ–™æ¥çœ‹ï¼Œæ›´æ–°Win10å¤§æ¦‚éœ€è¦ç”¨åˆ°é¢„ç•™åˆ†åŒºç©ºé—´500Må·¦å³ï¼ŒåŸæ¥çš„MSRåŠ ä¸ŠRecoveryçš„ç©ºé—´åŠ èµ·æ¥ä¹Ÿæ˜¯500Må·¦å³ï¼Œå…¶å®æ˜¯ä¸ä¿é™©çš„ã€‚å†å¾€å³çš„è¯ï¼Œå°±æ˜¯Cç›˜ç©ºé—´ï¼Œå¯ä»¥çœ‹åˆ°é‚£ä¸€å—ç©ºé—´å·²ç»è¢«Cç›˜æ–‡ä»¶å ç”¨äº†ï¼Œæ²¡æ³•åˆ†ç»™MSRåˆ†åŒºã€‚</p>
<p>ä¸ºæ­¤ï¼Œé‡‡å–ä»¥ä¸‹æ–¹æ¡ˆè§£å†³é—®é¢˜:</p>
<ul>
<li>åˆ é™¤åŸå…ˆçš„MSRä¸æ¢å¤åˆ†åŒºï¼Œå°†è¿™äº›ç©ºé—´æš‚æ—¶åˆ†ç»™å¼•å¯¼åˆ†åŒº</li>
<li>Cç›˜æŠ½å‡º3Gï¼Œæ–°å»ºMSRä¸æ¢å¤åˆ†åŒº</li>
</ul>
<h3 id="ä¿®å¤å·¥ä½œ"><a href="#ä¿®å¤å·¥ä½œ" class="headerlink" title="ä¿®å¤å·¥ä½œ"></a>ä¿®å¤å·¥ä½œ</h3><p>å®ç°ä¿®å¤æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<h4 id="æ“ä½œæ­¥éª¤"><a href="#æ“ä½œæ­¥éª¤" class="headerlink" title="æ“ä½œæ­¥éª¤"></a>æ“ä½œæ­¥éª¤</h4><ol>
<li>å¤‡ä»½å¼•å¯¼æ–‡ä»¶â€”â€”ç”¨DiskGeniusæŠŠå¼•å¯¼åˆ†åŒºçš„æ–‡ä»¶æ‹·è´å‡ºæ¥ã€‚ç”±äºç¬”è€…è£…äº†Win10è·ŸLinux MintåŒç³»ç»Ÿï¼Œå› æ­¤å¼•å¯¼æ–‡ä»¶ç¼ºå¤±çš„è¯ä»£ä»·å°±å¾ˆå¤§äº†</li>
<li>åˆ¶ä½œè¿›å…¥WinPEç¯å¢ƒï¼ˆWindows Preinstall Environmentï¼‰çš„Uç›˜å¯åŠ¨ç›˜ï¼ˆå¸¦å„ç±»è£…æœºå·¥å…·ï¼‰ã€‚å¹³æ—¶æˆ‘ä»¬åšä¸€äº›è£…ç³»ç»Ÿè·Ÿç³»ç»Ÿä¿®å¤æ“ä½œï¼Œå°±æ˜¯åœ¨åœ¨WinPEç¯å¢ƒä¸‹è¿›è¡Œçš„ã€‚å…·ä½“æ–¹å¼ï¼Œæ¯”å¦‚å¯ä»¥ä¸‹ä¸€ä¸ª<span class="exturl" data-url="aHR0cHM6Ly93d3cubGFvbWFvdGFvLm5ldC9kb3duLw==" title="https://www.laomaotao.net/down/">è€æ¯›æ¡ƒ<i class="fa fa-external-link"></i></span>å°±å¯ä»¥å°†ç©ºçš„Uç›˜åˆ¶ä½œæˆå¯åŠ¨ç›˜ã€‚åˆ¶ä½œæˆå¯åŠ¨ç›˜çš„Uç›˜æ”¾å…¶å®ƒæ–‡ä»¶ä¹Ÿå¹¶ä¸å½±å“å…¶åŠŸèƒ½ã€‚</li>
<li>é‡å¯ç”µè„‘ï¼Œè¿›å…¥BIOSç•Œé¢ï¼Œåœ¨å¯åŠ¨/å¼•å¯¼ç›¸å…³çš„é€‰é¡¹ä¸­ï¼Œå°†Uç›˜å¯åŠ¨ä¼˜å…ˆçº§è°ƒåˆ°æœ€é«˜ã€‚è¿›å…¥BIOSç•Œé¢çš„æ–¹æ³•è¦æ ¹æ®ä¸»æ¿/ç”µè„‘å‚å®¶æ¥å®šã€‚è¦è°ƒæ•´ä¼˜å…ˆçº§çš„è¯ï¼Œå°±æ‰¾Bootä¹‹ç±»çš„é€‰é¡¹ç„¶åè°ƒæ•´é¡ºåºã€‚è¿™ä¸€æ­¥éª¤åŸºæœ¬åªéœ€è¦æ‡‚ç‚¹è‹±æ–‡ã€‚è°ƒå¥½ä¹‹åå†é‡å¯ï¼Œè¿™æ—¶å€™åº”è¯¥å°±å¯ä»¥è¿›åˆ°Uç›˜é‡Œè€æ¯›æ¡ƒè®¾ç½®çš„PEç³»ç»Ÿäº†ã€‚</li>
<li>è¿›å…¥è€æ¯›æ¡ƒç³»ç»Ÿåï¼Œæ‰“å¼€é‡Œé¢è‡ªå¸¦çš„DiskGeniusï¼ˆåˆ†åŒºå·¥å…·ï¼‰ï¼Œè®°å½•ä¸€ä¸‹åŸå…ˆMSRä¸æ¢å¤åˆ†åŒºçš„è§„æ ¼ï¼ˆæ ¼å¼ã€æ˜¯å¦éšè—ã€æ˜¯å¦ç‚¹é€‰å‚å®¶OEMä¹‹ç±»ï¼‰ï¼Œç„¶ååˆ é™¤åŸå…ˆçš„MSRä¸æ¢å¤åˆ†åŒºï¼Œå°†è¿™äº›ç©ºé—´åˆ†ç»™å¼•å¯¼åˆ†åŒº</li>
<li>æ”¹å˜Cç›˜å¤§å°ï¼ŒæŠ½å‡º3Gç©ºé—´ã€‚1Gæ–°å»ºåˆ†åŒºï¼Œæ ¼å¼ä¸ºMicrosoft Reserved Partitionï¼Œå¦å¤–2Gæ–°å»ºåˆ†åŒºï¼Œæ ¼å¼ä¸ºMicrosoft Recovery Partitionã€‚ä¸¤è€…å…·ä½“çš„è§„æ ¼ï¼Œæœ€å¥½è·Ÿæ­¥éª¤4è®°å½•çš„ä¸€æ ·ã€‚</li>
<li>é‡å¯è¿›å…¥BIOSç•Œé¢ï¼ŒæŠŠWindowså¯åŠ¨ä¼˜å…ˆçº§è°ƒåˆ°æœ€é«˜ã€‚</li>
<li>å†é‡å¯ï¼Œå°±èƒ½è¿›Windowså•¦~æ‹”æ‰Uç›˜ï¼Œè¯•è¯•å‡çº§å§ï¼</li>
</ol>
<h4 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h4><ol>
<li>æ”¹å˜åˆ†åŒºæ¶‰åŠåˆ°çš„æ‰€æœ‰æ–‡ä»¶ï¼Œæœ€å¥½éƒ½å¤‡ä»½ã€‚è™½ç„¶Cç›˜æ–‡ä»¶ä¸å¤‡ä»½ä¹Ÿå¯ï¼Œä½†å¦‚æœæƒ³è¦å¤‡ä»½ï¼Œä¹Ÿæ— æ‰€è°“= =</li>
<li>æ¯è¿›è¡Œä¸€æ¬¡æ”¹å˜åˆ†åŒºæ“ä½œä¹‹å‰ï¼Œéƒ½è¦ä»”ç»†çœ‹è¯´æ˜ï¼æ“ä½œä¹‹åï¼Œä¿å­˜åˆ†åŒºè¡¨</li>
<li>ä¸è¦æ€•ï¼Œä½†ä¸€å®šè¦å†·é™</li>
</ol>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è£…æœºå‘å¤šï¼Œä½†æ›´é‡è¦çš„æ˜¯æœ‰ä¸€é¢—ä¸»åŠ¨æŸ¥èµ„æ–™ï¼Œæ•¢äºè¸©å‘è§£å†³é—®é¢˜çš„å†³å¿ƒã€‚</p>
<p>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘å°±æƒ³åˆ°äº†æˆ‘å®¶é¢†å¯¼ï¼Œç”µè„‘ä¸€å‡ºbugï¼Œå°±æƒ³ç€é‡è£…ç³»ç»Ÿï¼Œæ¯«æ— å¿—æ°”ã€‚</p>
<ul>
<li>éƒ½9012å¹´äº†ï¼Œç³»ç»Ÿå‡ºbugï¼Œç¬¬ä¸€æ„Ÿæ€ä¹ˆè¿˜æ˜¯é‡è£…ç³»ç»Ÿï¼Ÿï¼Ÿï¼Ÿç¬¨ç¬¨ï¼ï¼ï¼</li>
<li>ä½ è¿é—®é¢˜çš„ä¸¥é‡ç¨‹åº¦éƒ½æ²¡è°ƒç ”è¿‡ï¼Œæ€ä¹ˆèƒ½å¼ºè¡Œä»˜å‡ºé‡è£…ç³»ç»Ÿçš„ä»£ä»·å‘¢ï¼Ÿï¼Ÿï¼Ÿå°å‚»ç“œï¼ï¼ï¼</li>
<li>ä½ è¦é‡è£…ï¼Œä½ è‡ªå·±é‡è£…å•Šï¼ï¼ï¼åŠ³èµ„å…è´¹å¸®ä½ æ— ç—›ä¿®ç”µè„‘è¿˜ä¸æ„¿æ„ï¼ï¼ï¼å””QAQ</li>
<li>æ²¡ç”µè„‘çŸ¥è¯†ä¸æ˜¯å€Ÿå£ï¼Œè¦å–„äºæ±‚åŠ©ï¼Œå¤šç»™ç‚¹å„¿ä¿¡æ¯ï¼Œæ‰èƒ½æ›´å¥½åœ°è§£å†³é—®é¢˜å•Š= =</li>
</ul>
<p>å”‰ï¼Œè®­å½’è®­ï¼Œå•¥æ—¶å€™æ‰èƒ½é•¿ç‚¹å¨é£å””</p>
]]></content>
      <categories>
        <category>DIYå°è®°</category>
      </categories>
      <tags>
        <tag>Win10</tag>
        <tag>DiskGenius</tag>
        <tag>MSR</tag>
        <tag>ä¿ç•™åˆ†åŒº</tag>
        <tag>WinPE</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘æ¢ç´¢C APIï¼Œå¼€å‘lnodelist</title>
    <url>/2019/04/20/luatalk/lnodelist/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘ä¸€ç›´åœ¨æ¢ç´¢Luaçš„C APIç¼–ç¨‹éƒ¨åˆ†ï¼Œä¸Šæ¬¡å®ç°äº†ä¸€ä¸ªå‡½æ•°æ‰§è¡Œæ—¶é—´ç»Ÿè®¡åº“ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9sZnVuY3RpbWVy" title="https://github.com/utmhikari/lfunctimer">lfunctimer<i class="fa fa-external-link"></i></span>ï¼Œè¿™æ¬¡å°±æœæ–­å†™äº†ä¸€ä¸ª<code>lnodelist</code>æ¥ç©ç©ã€‚åœ¨è¿™æœŸé—´ï¼Œé‡åˆ°äº†è®¸å¤šçº ç»“çš„é—®é¢˜ï¼Œå› æ­¤æœæ–­åšä¸‹åˆ†äº«~</p>
<p>æµ‹è¯•ç”¨ä¾‹ç°åœ¨è´¼å°‘= =æƒ³è¦è¯•ç”¨çš„åŒå­¦å¯ä»¥èµ°<code>lnodelist</code>çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9sbm9kZWxpc3Q=" title="https://github.com/utmhikari/lnodelist">Githubä¼ é€é—¨<i class="fa fa-external-link"></i></span>ï¼Œæˆ–è€…<code>luarocks install lnodelist</code>ï¼Œå°±å¯ä»¥å¼€å§‹å¹²èµ·~</p>
<p>åœ¨Luaé‡Œï¼Œtableå……å½“ç€arrayä»¥åŠhashmapä¸¤ä¸ªè§’è‰²ï¼Œæä¾›äº†ç®€å•çš„insertã€removeã€concatç­‰åŠŸèƒ½ã€‚<code>lnodelist</code>åˆ™æ˜¯ç‹¬ç«‹äºtableä¹‹å¤–å»ºç«‹ä¸€ä¸ªå´­æ–°çš„<code>list/array</code>æ•°æ®ç»“æ„ï¼Œæš‚æ—¶æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚APIçš„éœ€æ±‚ä¸Šï¼Œåˆ™å…¼å¹¶javaçš„LinkedListè·Ÿjsçš„arrayä¸¤ç§ä½“ç³»ï¼Œåˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> luaL_Reg lnodelist_f[] = &#123;</span><br><span class="line">  &#123;<span class="string">"new"</span>, list_new&#125;,  <span class="comment">// local l = list.new()</span></span><br><span class="line">  &#123;<span class="string">"size"</span>, list_size&#125;,  <span class="comment">// list.size(l) or #l</span></span><br><span class="line">  &#123;<span class="string">"push"</span>, list_push&#125;,  <span class="comment">// list.push(l, val)</span></span><br><span class="line">  &#123;<span class="string">"pushleft"</span>, list_pushleft&#125;,  <span class="comment">// list.pushleft(l, val)</span></span><br><span class="line">  &#123;<span class="string">"pop"</span>, list_pop&#125;,  <span class="comment">// list.pop(l) -&gt; last val</span></span><br><span class="line">  &#123;<span class="string">"popleft"</span>, list_popleft&#125;,  <span class="comment">// list.popleft(l) -&gt; first val</span></span><br><span class="line">  &#123;<span class="string">"remove"</span>, list_remove&#125;,  <span class="comment">// list.remove(l)</span></span><br><span class="line">  &#123;<span class="string">"removeleft"</span>, list_removeleft&#125;,  <span class="comment">// list.removeleft(l)</span></span><br><span class="line">  &#123;<span class="string">"set"</span>, list_set&#125;,  <span class="comment">// list.set(l, idx, val)</span></span><br><span class="line">  &#123;<span class="string">"get"</span>, list_get&#125;,  <span class="comment">// list.get(l, idx) -&gt; l[idx]</span></span><br><span class="line">  &#123;<span class="string">"insert"</span>, list_insert&#125;,  <span class="comment">// list.insert(l, idx, val)</span></span><br><span class="line">  &#123;<span class="string">"delete"</span>, list_delete&#125;,  <span class="comment">// list.delete(l, idx)</span></span><br><span class="line">  &#123;<span class="string">"reverse"</span>, list_reverse&#125;,  <span class="comment">// list.reverse(l)</span></span><br><span class="line">  &#123;<span class="string">"clear"</span>, list_clear&#125;,  <span class="comment">// list.clear(l)</span></span><br><span class="line">  &#123;<span class="string">"extend"</span>, list_extend&#125;,  <span class="comment">// list.extend(l1, l2)</span></span><br><span class="line">  &#123;<span class="string">"slice"</span>, list_slice&#125;,  <span class="comment">// list.slice(l [, start [, end]]) -&gt; sl</span></span><br><span class="line">  &#123;<span class="string">"join"</span>, list_join&#125;,  <span class="comment">// list.join(l, sep [,start [, end]])</span></span><br><span class="line">  &#123;<span class="string">"foreach"</span>, list_foreach&#125;,  <span class="comment">// list.foreach(l, (val, idx) =&gt; &#123;&#125;)</span></span><br><span class="line">  &#123;<span class="string">"map"</span>, list_map&#125;,  <span class="comment">// list.map(l, (val, idx) =&gt; newVal) -&gt; mapl</span></span><br><span class="line">  &#123;<span class="string">"some"</span>, list_some&#125;,  <span class="comment">// list.some(l, (val, idx) =&gt; boolean)</span></span><br><span class="line">  &#123;<span class="string">"find"</span>, list_find&#125;,  <span class="comment">// list.find(l, (val, idx) =&gt; trueVal)</span></span><br><span class="line">  &#123;<span class="string">"__len"</span>, list_size&#125;,  <span class="comment">// same as list.size(l)</span></span><br><span class="line">  &#123;<span class="string">"__gc"</span>, list_clear&#125;,  <span class="comment">// same as list.clear(l)</span></span><br><span class="line">  &#123;<span class="string">"__tostring"</span>, list_tostring&#125;,  <span class="comment">// print list length and lua registry reference</span></span><br><span class="line">  &#123;<span class="literal">NULL</span>, <span class="literal">NULL</span>&#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="è¸©å‘è®°å½•"><a href="#è¸©å‘è®°å½•" class="headerlink" title="è¸©å‘è®°å½•"></a>è¸©å‘è®°å½•</h2><h3 id="æ•°æ®ç»“æ„ä¸å…ƒè¡¨è®¾è®¡"><a href="#æ•°æ®ç»“æ„ä¸å…ƒè¡¨è®¾è®¡" class="headerlink" title="æ•°æ®ç»“æ„ä¸å…ƒè¡¨è®¾è®¡"></a>æ•°æ®ç»“æ„ä¸å…ƒè¡¨è®¾è®¡</h3><p><code>lnodelist</code>æœ¬èº«è¦å®ç°ä¸ºä¸€ä¸ªéluaçš„è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œåœ¨Luaé‡Œï¼Œè¿™ç§æ•°æ®ç»“æ„å±äº<code>userdata</code>çš„ç±»å‹ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥è¢«luaçš„GCï¼ˆgarbage collectionï¼Œå€’åƒåœ¾ï¼‰æœºåˆ¶æ£€æµ‹å›æ”¶çš„<code>struct</code>ç»“æ„ä½“æ•°æ®å—ã€‚ä»åŒå‘é“¾è¡¨çš„è®¾è®¡ä¸Šæ¥çœ‹ï¼Œåˆå§‹åŒ–çš„<code>userdata</code>å¯ä»¥åŒ…å«<code>size</code>ã€<code>*head</code>ä»¥åŠ<code>*tail</code>ä¸‰æ–¹é¢ã€‚é€šè¿‡<code>size</code>ã€<code>*head</code>ä»¥åŠ<code>*tail</code>ä¸‰ä¸ªä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç®€å•ç®¡ç†ä¸€ä¸ªåŒå‘é“¾è¡¨ã€‚è€Œé“¾è¡¨çš„æ¯ä¸ªç»“ç‚¹å†…å­˜åˆ™éœ€è¦è‡ªå·±ç®¡ç†ï¼Œå…¶æ•°æ®ç»“æ„åŒ…å«<code>type</code>ã€<code>*value</code>ã€<code>*prev</code>ä»¥åŠ<code>*next</code>å››ä¸ªä¿¡æ¯ï¼Œåˆ†åˆ«æ˜¯ç»“ç‚¹æ•°æ®çš„ç±»å‹ã€å€¼è·Ÿé“¾è¡¨é‡Œè¾¹ä¸Šä¸€ä¸ªã€ä¸‹ä¸€ä¸ªç»“ç‚¹çš„æŒ‡é’ˆã€‚å› æ­¤ï¼Œ<code>lnodelist</code>çš„<code>userdata</code>ç»“æ„ä½“è·Ÿç»“ç‚¹ç»“æ„ä½“å®šä¹‰å¯ä»¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* struct of node */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">l_node</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> type;</span><br><span class="line">  <span class="keyword">void</span> *value;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">l_node</span> *<span class="title">prev</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">l_node</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; l_node;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* struct of list */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">l_list</span> &#123;</span></span><br><span class="line">  lua_Integer size;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">l_node</span> *<span class="title">head</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">l_node</span> *<span class="title">tail</span>;</span></span><br><span class="line">&#125; l_list;</span><br></pre></td></tr></table></figure>
<p><code>lnodelist</code>ä½œä¸ºä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€ä¸ªå«å…ƒè¡¨ï¼ˆmetatableï¼‰çš„ä¸œè¥¿å¯¹å…¶åŸºæœ¬å±æ€§ä»¥åŠåœ¨luaè¿è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿç‰¹å®šäº‹ä»¶ä¸‹çš„è¡Œä¸ºè¿›è¡Œæè¿°ã€‚äº†è§£è¿‡å…ƒæ•°æ®ï¼ˆmetadataï¼‰çš„åŒå­¦éƒ½ä¼šçŸ¥é“ï¼Œå®ƒæ˜¯æè¿°æ•°æ®çš„æ•°æ®ï¼Œå…¶å®å…ƒè¡¨ï¼Œä¹Ÿä¸ç¦»å…¶å®—ã€‚åœ¨<code>lnodelist</code>çš„å…ƒè¡¨ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»å¾—é‡æ–°å®šä¹‰è¿™ä¸ªæ•°æ®æ ‘ç»“æ„è¢«luaæ ‡è®°GCæ—¶çš„è¡Œä¸ºï¼ˆäº‹ä»¶<code>__gc</code>ï¼‰ã€‚</p>
<p>GCï¼ˆGarbage Collectionï¼‰è¡Œä¸ºå¯ä»¥å›æ”¶æ•°æ®çš„å†…å­˜ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨luaè™šæ‹Ÿæœºå®šä¹‰<code>lnodelist</code>çš„è¿‡ç¨‹ä¸­ï¼Œå€¼å®šä¹‰äº†åˆšå¼€å§‹çš„<code>userdata</code>ï¼Œè€Œåé¢ç»“ç‚¹çš„å†…å­˜åˆ™æš‚æ—¶æ˜¯ä¸€ä¸ªä¸ªè‡ªå·±æ“ä½œçš„ï¼Œå¹¶ä¸å—luaè™šæ‹Ÿæœºç®¡è¾–ã€‚å› æ­¤ï¼ŒGCæ—¶å€™ï¼Œéœ€è¦æ³¨æ„å›æ”¶ç»“ç‚¹å†…å­˜ã€‚</p>
<p><code>lnodelist</code>é‡‡ç”¨Luaæœ€æ–°ç‰ˆ5.3.5çš„C APIç¼–å†™ã€‚ç›¸å¯¹äºæŸäº›æ—§ç‰ˆæœ¬ï¼ˆå¦‚5.1ï¼‰ï¼Œå…¶æ³¨å†Œlibçš„æ–¹å¼ï¼ˆluaopenå‡½æ•°é‡Œè¾¹çš„é€»è¾‘ï¼‰ä¸ä¸€æ ·äº†ã€‚ç»è¿‡ä¸€ç•ªæ¢ç©¶ï¼Œå‚è€ƒäº†luaæºç æŸäº›åœ°æ–¹çš„éªšæ“ä½œï¼Œç°åœ¨çš„å†™æ³•å¯ä»¥è¿™æ ·ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">LUAMOD_API <span class="keyword">int</span> <span class="title">luaopen_lnodelist</span><span class="params">(lua_State *L)</span> </span>&#123;</span><br><span class="line">  luaL_newmetatable(L, LUA_NODELIST);</span><br><span class="line">  lua_pushvalue(L, <span class="number">-1</span>);</span><br><span class="line">  lua_setfield(L, <span class="number">-2</span>, <span class="string">"__index"</span>);</span><br><span class="line">  luaL_setfuncs(L, lnodelist_f, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€Œåï¼Œæ¯æ¬¡æ–°å»º<code>list</code>æ—¶ï¼Œæ³¨å†Œä¸€ä¸‹å…ƒè¡¨å³å¯ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* push a new empty list on lua stack */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">new_list</span><span class="params">(lua_State *L)</span> </span>&#123;</span><br><span class="line">  l_list *l = (l_list *)lua_newuserdata(L, <span class="keyword">sizeof</span>(l_list));</span><br><span class="line">  l-&gt;size = <span class="number">0</span>;</span><br><span class="line">  l-&gt;head = <span class="literal">NULL</span>;</span><br><span class="line">  l-&gt;tail = l-&gt;head;</span><br><span class="line">  luaL_setmetatable(L, LUA_NODELIST);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®å­˜å–"><a href="#æ•°æ®å­˜å–" class="headerlink" title="æ•°æ®å­˜å–"></a>æ•°æ®å­˜å–</h3><p>åœ¨luaä¸­ï¼Œé‡‡ç”¨<code>TValue</code>è¡¨ç¤ºluaçš„æ•°æ®</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// lobject.h</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">** Union of all Lua values</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">union</span> Value &#123;</span><br><span class="line">  GCObject *gc;    <span class="comment">/* collectable objects */</span></span><br><span class="line">  <span class="keyword">void</span> *p;         <span class="comment">/* light userdata */</span></span><br><span class="line">  <span class="keyword">int</span> b;           <span class="comment">/* booleans */</span></span><br><span class="line">  lua_CFunction f; <span class="comment">/* light C functions */</span></span><br><span class="line">  lua_Integer i;   <span class="comment">/* integer numbers */</span></span><br><span class="line">  lua_Number n;    <span class="comment">/* float numbers */</span></span><br><span class="line">&#125; Value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> TValuefields Value value_; int tt_</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">lua_TValue</span> &#123;</span></span><br><span class="line">  TValuefields;</span><br><span class="line">&#125; TValue;</span><br></pre></td></tr></table></figure>
<p>ä¸ºæ­¤ï¼Œåœ¨ç»“ç‚¹<code>l_node</code>ä¸­ï¼Œä¹ŸåŒæ ·é‡‡ç”¨<code>type</code>åŠ <code>value</code>çš„å½¢å¼ï¼Œè¡¨ç¤ºæ¯ä¸€ä¸ªå­˜åˆ°é“¾è¡¨çš„æ•°æ®ã€‚</p>
<p>è·å–æ•°æ®çš„ç±»å‹å¯ä»¥é€šè¿‡<code>lua_type</code>å‡½æ•°è·å¾—ï¼Œæ ¹æ®æ•°æ®çš„ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åšswitchè·³è¡¨å»èµ°ç›¸åº”çš„åˆ†æ”¯å­˜æ•°æ®ã€‚</p>
<p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œéƒ¨åˆ†æ•°æ®ç±»å‹ï¼ˆæ¯”å¦‚å‡½æ•°ã€tableï¼‰ï¼Œåœ¨APIé‡Œæˆ‘ä»¬æ— æ³•ç›´æ¥è·å¾—ç›¸åº”æ•°æ®ç»“æ„çš„structå®šä¹‰ï¼Œå› æ­¤åªèƒ½é€šè¿‡luaçš„æ³¨å†Œè¡¨Registryæ‰¾åˆ°è¿™äº›æ•°æ®å”¯ä¸€ç´¢å¼•ï¼Œç„¶åæŠŠç´¢å¼•å€¼å­˜åœ¨<code>value</code>ä¸­ï¼Œè¿™æ ·é€šè¿‡<code>type</code>è·Ÿ<code>value</code>å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„æ•°æ®äº†ã€‚</p>
<p>æ•°æ®å­˜å‚¨çš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* assign value to value pointer, may modify type */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">assign_val</span><span class="params">(lua_State *L, l_node* node, <span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">int</span> type = lua_type(L, arg);</span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> LUA_TNUMBER:</span><br><span class="line">      <span class="keyword">if</span> (lua_isinteger(L, arg)) &#123;</span><br><span class="line">        node-&gt;value = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(lua_Integer));</span><br><span class="line">        *(lua_Integer *)node-&gt;value = lua_tointeger(L, arg);</span><br><span class="line">        node-&gt;type = LUA_TINTEGER;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ...  <span class="comment">// lua_Number</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LUA_TSTRING:</span><br><span class="line">      ...  <span class="comment">// const char*</span></span><br><span class="line">    <span class="keyword">case</span> LUA_TBOOLEAN:</span><br><span class="line">      ...  <span class="comment">// int (bool)</span></span><br><span class="line">    <span class="keyword">case</span> LUA_TNIL:</span><br><span class="line">    <span class="keyword">case</span> LUA_TNONE:</span><br><span class="line">      ...  <span class="comment">// nil</span></span><br><span class="line">    <span class="keyword">default</span>:  <span class="comment">// store in registry index</span></span><br><span class="line">      lua_pushvalue(L, arg);</span><br><span class="line">      node-&gt;value = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">      *(<span class="keyword">int</span> *)node-&gt;value = luaL_ref(L, LUA_REGISTRYINDEX);</span><br><span class="line">      node-&gt;type = type;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>åè¿‡æ¥ï¼Œå–æ•°æ®pushåˆ°luaæ ˆä¸Šçš„é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* get value of node and push to lua stack */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push_val</span><span class="params">(lua_State *L, l_node *node)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (node-&gt;type) &#123;</span><br><span class="line">    <span class="keyword">case</span> LUA_TINTEGER:</span><br><span class="line">      lua_pushinteger(L, *(lua_Integer *)(node-&gt;value));</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LUA_TNUMBER:</span><br><span class="line">      lua_pushnumber(L, *(lua_Number *)(node-&gt;value));</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LUA_TSTRING:</span><br><span class="line">      lua_pushstring(L, *(<span class="keyword">const</span> <span class="keyword">char</span> **)(node-&gt;value));</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LUA_TBOOLEAN:</span><br><span class="line">      lua_pushstring(L, (<span class="keyword">int</span> *)node-&gt;value ? <span class="string">"true"</span> : <span class="string">"false"</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> LUA_TNIL:  <span class="comment">// nil or none</span></span><br><span class="line">    <span class="keyword">case</span> LUA_TNONE:</span><br><span class="line">      lua_pushnil(L);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:  <span class="comment">// get from registry index</span></span><br><span class="line">      lua_rawgeti(L, LUA_REGISTRYINDEX, *(<span class="keyword">int</span> *)node-&gt;value);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é”€æ¯æ•°æ®ï¼ˆfreeï¼‰æ—¶ï¼Œç‰¹æ®Šçš„æ•°æ®ç»“æ„æš‚æ—¶éœ€è¦åœ¨luaæ³¨å†Œè¡¨é‡Œ<code>unref</code>æ¥å–æ¶ˆç´¢å¼•ã€‚å…¶ä¸­çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œè¿˜è¦åç»­æœ‰ç©ºæ¢ç©¶ã€‚</p>
<h3 id="éå†æ•°æ®"><a href="#éå†æ•°æ®" class="headerlink" title="éå†æ•°æ®"></a>éå†æ•°æ®</h3><p>luaæœ¬èº«éå†æ•°æ®é‡‡ç”¨<code>pairs</code>ä¸<code>ipairs</code>ä¸¤ç§æ–¹å¼ï¼Œä½†æ˜¯å¯¹äº<code>lnodelist</code>çš„é“¾è¡¨æ¥è¯´ï¼Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜â€”â€”é¦–å…ˆï¼Œ<code>pairs</code>è·Ÿ<code>ipairs</code>æ˜¯æ— çŠ¶æ€çš„ã€‚å¯¹äºåˆ—è¡¨ç±»å‹ï¼Œæˆ‘ä»¬é‡‡ç”¨<code>ipairs</code>éå†æ—¶ï¼Œé€šå¸¸ä¸ºç´¢å¼•è‡ªå¢åå†è°ƒç”¨<code>ipair</code>å‡½æ•°æ‰§è¡Œï¼Œä½†å¯¹äºé“¾è¡¨ï¼Œæ ¹æ®ç´¢å¼•å¯»æ‰¾ä¼šå¢åŠ æ€§èƒ½å¼€é”€ï¼Œå¹¶ä¸”<code>l_node</code>ç»“ç‚¹æœ¬èº«å¹¶éluaåŸç”Ÿçš„æ•°æ®ç±»å‹ã€‚å› æ­¤ï¼Œç°åœ¨æš‚æ—¶çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡‡ç”¨<code>Javascript</code>çš„æ¨¡å¼callå›è°ƒå‡½æ•°è¿›è¡Œéå†ã€‚æ¯”å¦‚<code>foreach</code>çš„å®ç°ï¼Œå¯ä»¥å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* foreach loop for stateful iteration */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">list_foreach</span><span class="params">(lua_State *L)</span> </span>&#123;</span><br><span class="line">  l_list *l = check_list(L, <span class="number">1</span>);</span><br><span class="line">  luaL_checktype(L, <span class="number">2</span>, LUA_TFUNCTION);</span><br><span class="line">  l_node *node = l-&gt;head;</span><br><span class="line">  lua_Integer idx = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (node != <span class="literal">NULL</span>) &#123;</span><br><span class="line">    lua_pushvalue(L, <span class="number">2</span>);</span><br><span class="line">    push_val(L, node);</span><br><span class="line">    lua_pushinteger(L, ++idx);</span><br><span class="line">    lua_call(L, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">    node = node-&gt;next;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥å®ç°ä¸€æ¬¡éå†ï¼Œ<code>map</code>ç­‰æ–¹æ³•åŒç†</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿‘æœŸåˆ·é¢˜å°‘äº†ï¼Œåœ¨å†™<code>lnodelist</code>çš„è¿‡ç¨‹ä¸­ä¹Ÿæ¸æ¸æ‰¾å›äº†ä¸€ç‚¹æ„Ÿè§‰ã€‚æ€»çš„æ¥è¯´èƒ½æœ‰ä¸ªå°demoä¹Ÿä¸é”™ï¼Œè¦æŠŠå®ƒåšå¾—æ›´å¥½çš„è¯ï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹é¢éœ€è¦è°ƒç ”ä¸æ”¹è¿›ï¼š</p>
<ul>
<li>å†…å­˜ç®¡ç†ï¼šåº”å½“å…¼å®¹luaçš„å†…å­˜ç®¡ç†ï¼Œå¹¶ä¸”é…åˆluaçš„GCæœºåˆ¶</li>
<li>é”™è¯¯æ§åˆ¶ï¼šåº”å½“æœ‰æ›´ç»†çš„é”™è¯¯å£°æ˜è·Ÿå›æ»šæœºåˆ¶</li>
<li>åŠŸèƒ½æ”¹è¿›ï¼šå®Œå–„åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥å…¼å®¹luaå†…ç½®æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚table</li>
<li>åç¨‹æ”¯æŒï¼šæ—¢ç„¶è¦JS Styleï¼Œé‚£è¿˜æ˜¯å¾—å¢åŠ å¯¹coroutineçš„æ”¯æŒ</li>
</ul>
<p>è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œè¿˜å¾—å†æ·±å…¥å»ç ”ç©¶å‘€ï¼</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>array</tag>
        <tag>Lua</tag>
        <tag>C API</tag>
        <tag>lnodelist</tag>
        <tag>åŒå‘é“¾è¡¨</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘ç¬¬äº”è¯ï¼šå°è¯•scikit-learnæ•°æ®æŒ–æ˜â€”â€”newsgroupæ•°æ®å¤„ç†ä¸æ–‡æœ¬åˆ†ç±»</title>
    <url>/2019/04/14/easypython/v/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ•°æ®æŒ–æ˜ï¼ˆData Miningï¼‰ï¼Œä¸€èˆ¬æŒ‡ä»æµ·é‡æŠ“å–çš„æ•°æ®ä¸­ç»è¿‡ä¸€å®šçš„æ•°æ®å¤„ç†ã€ç®—æ³•ï¼Œä»è€Œæå–å‡ºæœ‰ä»·å€¼çš„ä¿¡æ¯çš„è¿‡ç¨‹ã€‚å®ƒå¤§ä½“åŸºäºç»Ÿè®¡å­¦ã€æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰ç­‰åŸç†ï¼Œè¾…ä½äº†äººç±»çš„ä¿¡æ¯å¤„ç†å·¥ä½œï¼Œä¸ºäººå·¥æ™ºèƒ½ï¼ˆAIï¼‰é“ºä¸‹é“è·¯ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼Œä¼¼ä¹æ­£æ˜¯å› æ•°æ®æŒ–æ˜è€Œç”Ÿçš„é‚£æ ·ï¼ŒPythonç¤¾åŒºä¸­æœ‰å„ç§æ•°æ®æŒ–æ˜ç›¸å…³çš„packageï¼Œèƒ½å¤Ÿæ»¡è¶³å„ç§æ•°æ®å¤„ç†ä¸ç®—æ³•æ¨¡å‹æ„å»ºéœ€æ±‚ã€‚æˆ‘ä»¬åªéœ€è¦<code>pip/conda install åŒ…å</code>ï¼Œç„¶åæŸ¥æŸ¥apiæ–‡æ¡£ï¼Œç†¬å‡ åè¡Œä»£ç ï¼Œå°±èƒ½ç©ä¸€ç©æ•°æ®æŒ–æ˜ã€‚</p>
<p>ä¸ºæ­¤ï¼Œåœ¨è¿™ä¸€è¯ï¼Œæˆ‘ä»¬ä»¥è‡ªç„¶è¯­è¨€å¤„ç†ï¼ˆNLPï¼‰çš„æ–‡æœ¬åˆ†ç±»ï¼ˆText Classificationï¼‰ä¸ºä¾‹ï¼Œè®¾è®¡ä¸€ä¸ªæœ€simpleçš„ï¼Œæœ€old schoolçš„ï¼Œä»¥Pythonä¸ºä¾‹çš„ï¼Œä»æ•°æ®è·å–åˆ°äº§ç”Ÿæ•°æ®æŒ–æ˜ç»“æœçš„æµç¨‹ã€‚</p>
<h2 id="æ–‡æœ¬åˆ†ç±»æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ–‡æœ¬åˆ†ç±»æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ–‡æœ¬åˆ†ç±»æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ–‡æœ¬åˆ†ç±»æ˜¯ä»€ä¹ˆï¼Ÿ</h2><a id="more"></a>
<p>æ–‡æœ¬åˆ†ç±»ï¼Œæ›´é€šå¸¸çš„ç†è§£ï¼Œå«æ–‡æœ¬è‡ªåŠ¨åˆ†ç±»ï¼ˆauto-classificationï¼‰ï¼Œæ˜¯æ–‡æœ¬æ•°æ®æŒ–æ˜æœ€æ™®é€šä¸è¿‡çš„æ–¹æ³•äº†ã€‚æ–‡æœ¬åˆ†ç±»åº”ç”¨çš„ä¾‹å­æ¯”æ¯”çš†æ˜¯ï¼Œæ¯”å¦‚æŸä¸ªæ–°é—»ç½‘ç«™ï¼Œçˆ¬åˆ°äº†æµ·é‡å¤–éƒ¨çš„æ–°é—»æ–‡æœ¬ï¼Œå½“äººåŠ›ä¸è¶³ä»¥å°†å…¶ä¸€ä¸ªä¸ªå½’ç±»æ—¶ï¼Œå°±éœ€è¦å€ŸåŠ©è®¡ç®—æœºçš„åŠ›é‡ï¼Œå°†é‚£äº›æ²¡æœ‰æ ‡æ³¨ç±»åˆ«ï¼ˆcategory labellingï¼‰æ–°é—»è‡ªåŠ¨å½’ç±»åˆ°å·²æœ‰çš„ç±»åˆ«å½“ä¸­ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„é—®é¢˜å°±æ˜¯â€”â€”æ€æ ·åƒäººä¸€æ ·ï¼Œå»è¯†åˆ«é‚£äº›æ²¡æœ‰å½’ç±»çš„æ–°é—»çš„ç±»åˆ«å‘¢ï¼Ÿ</p>
<p>ä¿—è¯è¯´çš„å¥½ï¼Œåªè¦åŠŸå¤«æ·±ï¼Œé“æµç£¨æˆé’ˆã€‚æˆ‘ä»¬åœ¨å­©ææ—¶ä»£ï¼Œæ˜¯çˆ¶æ¯å‘Šè¯‰æˆ‘ä»¬ï¼Œè¿™åªçŒ«ï¼Œé‚£æ˜¯ç‹—ï¼Œæˆ‘ä»¬æ‰èƒ½å¯¹ä¸åŒçš„åŠ¨ç‰©è¿›è¡Œåˆ†è¾¨ã€‚åœ¨æ•°æ®æŒ–æ˜é¢†åŸŸï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨åˆ†ç±»å™¨ï¼ˆclassifierï¼‰ï¼Œæ»¡è¶³è‡ªåŠ¨åˆ†ç±»çš„éœ€æ±‚ã€‚åˆ†ç±»å™¨å°±åƒæˆ‘ä»¬çš„å¤§è„‘ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡å¸æ”¶ä¸åŒçŸ¥è¯†ï¼Œè°ƒæ•´è‡ªå·±çš„å†³ç­–ï¼Œä½†å…¶æœ¬è´¨ä¸Šï¼Œå´æ˜¯ä¸€ä¸ªå¤¹æ‚äº†ç¹å¤æ•°å­¦è®¡ç®—çš„è®¡ç®—æœºç¨‹åºè€Œå·²ã€‚æˆ‘ä»¬è¦åšçš„ï¼Œåˆ™æ˜¯æŠŠå·²æœ‰çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯å½’ç±»å¥½çš„é‚£äº›æ–°é—»æ–‡æœ¬ï¼Œå»å‘Šè¯‰åˆ†ç±»å™¨ï¼Œè¿™ç¯‡æ˜¯Aç±»ï¼Œè¿™ç¯‡æ˜¯Bç±»ï¼Œä»è€Œè®­ç»ƒï¼ˆtrainï¼‰å®ƒçš„æ–°é—»ç±»åˆ«è¯†åˆ«èƒ½åŠ›ã€‚è¿™æ ·ï¼Œé¢å¯¹å„ç§æœªå½’ç±»æ–°é—»çš„è€ƒéªŒï¼ˆtestï¼‰ï¼Œåˆ†ç±»å™¨å°±å¯ä»¥äº‰å–åƒäººé‚£æ ·ï¼ŒæŠŠæ–°é—»çš„ç±»åˆ«è¯†åˆ«å‡ºæ¥äº†ã€‚</p>
<p>ä¸ºæ­¤ï¼Œè¦ä¿è¯è®¡ç®—æœºçš„è¯†åˆ«æ•ˆæœï¼Œå®Œå¤‡ä¼˜è‰¯çš„è®­ç»ƒææ–™ï¼ˆtraining setï¼‰å’Œç²¾è‡´ç¼œå¯†çš„è®­ç»ƒæ–¹æ³•ï¼ˆalgorithm modelï¼‰éƒ½å¿…ä¸å¯å°‘ã€‚</p>
<h2 id="ç®€å•çš„ä¾‹å­â€”â€”newsgroupæ–‡æœ¬åˆ†ç±»"><a href="#ç®€å•çš„ä¾‹å­â€”â€”newsgroupæ–‡æœ¬åˆ†ç±»" class="headerlink" title="ç®€å•çš„ä¾‹å­â€”â€”newsgroupæ–‡æœ¬åˆ†ç±»"></a>ç®€å•çš„ä¾‹å­â€”â€”newsgroupæ–‡æœ¬åˆ†ç±»</h2><p>ä»¥ä¸‹ï¼Œæˆ‘ä»¬å°±å¼€å§‹æœ€ç®€å•çš„æ–‡æœ¬åˆ†ç±»æµç¨‹ç¤ºä¾‹å•¦ï¼æˆ‘ä»¬é‡‡ç”¨<span class="exturl" data-url="aHR0cHM6Ly9zY2lraXQtbGVhcm4ub3JnL3N0YWJsZS8=" title="https://scikit-learn.org/stable/">scikit-learn<i class="fa fa-external-link"></i></span>æä¾›çš„å·¥å…·è¿›è¡Œæ–‡æœ¬åˆ†ç±»æµç¨‹æ¨¡æ‹Ÿã€‚</p>
<h3 id="newsgroupæ•°æ®é›†ä¸‹è½½"><a href="#newsgroupæ•°æ®é›†ä¸‹è½½" class="headerlink" title="newsgroupæ•°æ®é›†ä¸‹è½½"></a>newsgroupæ•°æ®é›†ä¸‹è½½</h3><p>æ–‡æœ¬åˆ†ç±»æ•°æ®é›†ï¼Œæˆ‘ä»¬é‡‡ç”¨æœ€ç»å…¸çš„æ–°é—»æ•°æ®é›†ï¼š<span class="exturl" data-url="aHR0cDovL3F3b25lLmNvbS9+amFzb24vMjBOZXdzZ3JvdXBzLw==" title="http://qwone.com/~jason/20Newsgroups/">20 newsgroupæ•°æ®é›†<i class="fa fa-external-link"></i></span>è¿›è¡Œæ¨¡æ‹Ÿï¼Œä½¿ç”¨çš„ç‰ˆæœ¬ä¸º<span class="exturl" data-url="aHR0cDovL3F3b25lLmNvbS9+amFzb24vMjBOZXdzZ3JvdXBzLzIwbmV3cy0xODgyOC50YXIuZ3o=" title="http://qwone.com/~jason/20Newsgroups/20news-18828.tar.gz">18828ç‰ˆ<i class="fa fa-external-link"></i></span>ï¼Œè®°å½•äº†18828ç¯‡ä¸é‡å¤çš„è‹±æ–‡æ–°é—»ã€‚è™½ç„¶<code>scikit-learn</code>åº“é»˜è®¤æä¾›è¯¥æ•°æ®é›†çš„ä¸‹è½½å¤„ç†ï¼Œä½†æ˜¯åœ¨è¿™ä¸€è¯ï¼Œæˆ‘ä»¬å°±è‡ªå·±å®ç°ä¸€éå§~</p>
<p>ä¸‹è½½ï¼Œè§£å‹ï¼Œæ€»å…±æœ‰<code>alt.atheism</code>åˆ°<code>talk.religion.misc</code>20ä¸ªç±»åˆ«çš„æ–‡æœ¬ã€‚æ‰“å¼€æ¯ä¸€ä¸ªç±»åˆ«æ–‡ä»¶å¤¹ï¼Œèƒ½çœ‹åˆ°ä»¥æ–°é—»ç¼–å·ä¸ºæ–‡ä»¶åï¼ˆæ²¡æœ‰åç¼€åï¼‰çš„æ–°é—»æ–‡ä»¶ã€‚ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œå°±èƒ½å¤Ÿçœ‹åˆ°é‡Œé¢çš„æ–°é—»å†…å®¹å•¦ã€‚</p>
<h3 id="æ–°é—»æ•°æ®è¯»å–-amp-é¢„å¤„ç†"><a href="#æ–°é—»æ•°æ®è¯»å–-amp-é¢„å¤„ç†" class="headerlink" title="æ–°é—»æ•°æ®è¯»å–&amp;é¢„å¤„ç†"></a>æ–°é—»æ•°æ®è¯»å–&amp;é¢„å¤„ç†</h3><p>è¦æ¨¡æ‹Ÿæ–‡æœ¬åˆ†ç±»ï¼Œéœ€è¦æŠŠæ¯ä¸€ä¸ªæ–°é—»è·Ÿå®ƒä»¬çš„ç±»åˆ«ä¸€ä¸€å¯¹åº”ã€‚åœ¨<code>scikit-learn</code>ä¸­ï¼Œè¦å®ç°newsgroupæ–°é—»å†…å®¹ä¸ç±»åˆ«çš„å¯¹åº”ï¼Œéœ€è¦å»ºç«‹ä¸¤ä¸ªåˆ—è¡¨ï¼š</p>
<ul>
<li>æ‰€æœ‰æ–°é—»çš„åˆ—è¡¨</li>
<li>æ‰€æœ‰æ–°é—»å½’å±ç±»åˆ«ç¼–å·çš„åˆ—è¡¨ï¼ˆ1~nï¼‰</li>
</ul>
<p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨è¯»å–æ–°é—»æ–‡ä»¶å†…å®¹çš„æ—¶å€™ï¼Œä¹Ÿè¦åšä¸€ä¸ªç±»åˆ«æ ‡ç­¾çš„åˆ—è¡¨ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># out directory to store newsgroup datasset</span></span><br><span class="line">directory = <span class="string">'./20news-18828'</span></span><br><span class="line"><span class="comment"># category_names[label_number - 1] = category name</span></span><br><span class="line">category_names = os.listdir(directory)</span><br><span class="line"><span class="comment"># sequence of news contents --- X</span></span><br><span class="line">news_contents = list()</span><br><span class="line"><span class="comment"># sequence of news labels  --- Y</span></span><br><span class="line">news_labels = list()</span><br><span class="line"><span class="comment"># traverse into directories</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(category_names)):</span><br><span class="line">    category = category_names[i]</span><br><span class="line">    category_dir = os.path.join(directory, category)</span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> os.listdir(category_dir):</span><br><span class="line">        file_path = os.path.join(category_dir, file_name)</span><br><span class="line">        <span class="comment"># get the word list of a single news file</span></span><br><span class="line">        raw_content = open(file_path, encoding=<span class="string">'latin1'</span>).read().strip()</span><br><span class="line">        <span class="comment"># preprocess data</span></span><br><span class="line">        news_content = preprocess_content(raw_content)</span><br><span class="line">        <span class="comment"># append news labels and news contents</span></span><br><span class="line">        news_labels.append(i + <span class="number">1</span>)</span><br><span class="line">        news_contents.append(news_content)</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ï¼Œ<code>news_contents</code>æ˜¯æˆ‘ä»¬çš„æ–°é—»å†…å®¹ï¼›<code>news_labels</code>æ˜¯æˆ‘ä»¬æ¯ä¸ªæ–°é—»å†…å®¹å¯¹åº”ç±»åˆ«çš„ç¼–å·çš„åˆ—è¡¨ï¼Œè·Ÿ<code>news_contents</code>ä¸€æ ·é•¿ï¼›è€Œ<code>category_names</code>åˆ™æ˜¯ç±»åˆ«åçš„åˆ—è¡¨äº†ã€‚æˆ‘ä»¬éå†æ¯ä¸ªç±»åˆ«ç›®å½•å»è¯»å–æ–°é—»æ–‡ä»¶å†…å®¹ï¼Œæ–‡ä»¶ç¼–ç ç»æŸ¥è¯æ˜¯<code>latin1</code>ã€‚æ²¡è¯»åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬éƒ½å»ç”¨ä¸€ä¸ª<code>preprocess_content</code>å‡½æ•°é¢„å¤„ç†ï¼ˆpreprocessingï¼‰è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œç„¶åæŠŠæ–‡ä»¶å†…å®¹åŠ åˆ°<code>news_contents</code>ä¸­ï¼ŒæŠŠè¿™ä¸ªæ–°é—»å¯¹åº”çš„ç±»åˆ«ç¼–å·ï¼Œæ­¤å¤„è®¾ä¸º<code>ç´¢å¼•i + 1</code>ï¼ŒåŠ åˆ°<code>news_labels</code>ä¸­ã€‚</p>
<p>é¢„å¤„ç†æ–‡æœ¬æ–¹ä¾¿äº†æˆ‘ä»¬åç»­å¯¹æ–‡æœ¬æ•°æ®çš„æ“ä½œã€‚é‚£ä¹ˆï¼Œå¦‚ä½•é¢„å¤„ç†newsgroupæ–‡æœ¬æ•°æ®å‘¢ï¼Ÿè¿™å°±å’Œæ–°é—»æ–‡æœ¬çš„æ•°å­¦æ¨¡å‹è¡¨ç¤ºæ–¹æ³•æœ‰å…³äº†ã€‚æŠŠæ–‡å­—å †ç Œæ–‡æœ¬å˜æˆæ•°å­¦æ¨¡å‹ï¼Œåˆ†ç±»å™¨æ‰èƒ½å¤Ÿå­¦ä¹ ä¸åŒç±»åˆ«çš„æ–‡æœ¬æ˜¯è¿™æ ·é‚£æ ·çš„ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å«åšæ‹Ÿåˆï¼ˆfitï¼‰ã€‚å¯¹äºæ–°é—»ç±»çš„é•¿æ–‡æœ¬æ¥è¯´ï¼Œæœ€ç®€å•ç²—æš´oldschoolçš„æ–¹æ³•ï¼Œå°±æ˜¯ç”¨è¯é¢‘ã€å…³é”®è¯ä¹‹ç±»çš„ä¿¡æ¯æ¥è¡¨ç¤ºæ–‡æœ¬å†…å®¹ã€‚è™½ç„¶è¿™ç§æ–¹æ³•å¿½ç•¥äº†è¯ä¸è¯ä¹‹é—´çš„ä¸Šä¸‹æ–‡å…³ç³»ï¼Œä½†ä»å®è·µæ•ˆæœæ¥çœ‹ï¼Œå·²ç»å¾ˆokäº†ã€‚</p>
<p>è¦è·å–æ–‡æœ¬çš„è¯é¢‘ã€å…³é”®è¯ç­‰ä¿¡æ¯ï¼Œå°±æ¶‰åŠåˆ°æ–‡æœ¬çš„åˆ†è¯ã€‚newsgroupæ‰‹æœºçš„æ˜¯è‹±æ–‡æ–°é—»ï¼Œå› æ­¤ä¸ºäº†è®©åç»­çš„åˆ†è¯æ›´åŠ æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨é¢„å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>è¿‡æ»¤æ‰æ–°é—»æ–‡æœ¬æ ‡ç‚¹ç¬¦å·ä¹‹ç±»çš„å¹²æ‰°å­—ç¬¦ï¼ŒæŠŠæ‰€æœ‰å•è¯éƒ½ä»¥ç©ºæ ¼ç›¸è¿</strong>ï¼Œè¿™æ ·å°±å®Œæˆäº†æ–‡æœ¬çš„ä¸å¤„ç†äº†ã€‚</p>
<p>å®Œæˆè¿™ä¸ªéœ€æ±‚ï¼Œå°±éœ€è¦ä¸€ä¸ªæ–‡æœ¬é¢„å¤„ç†çš„å¼ºå¤§æ­¦å™¨â€”â€”<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLnB5dGhvbi5vcmcvMy9saWJyYXJ5L3JlLmh0bWw=" title="https://docs.python.org/3/library/re.html">æ­£åˆ™è¡¨è¾¾å¼<i class="fa fa-external-link"></i></span>ï¼ˆRegular Expressionï¼‰ã€‚é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬å¯ä»¥åŒ¹é…ä¸€ä¸ªæ ·å¼ï¼ˆpatternï¼‰çš„æ–‡æœ¬ï¼Œå¹¶å¯¹å®ƒè¿›è¡Œæ“ä½œã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬çš„<code>preprocess_content</code>é¢„å¤„ç†å‡½æ•°ï¼Œå°±å¯ä»¥è¿™æ ·å†™å•¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># replace any character that is not digit or letter or space with empty string</span></span><br><span class="line">replace_with_empty_pattern = re.compile(<span class="string">r'[^A-Za-z0-9\s]'</span>)</span><br><span class="line"><span class="comment"># replace consecutive spaces and enters(\n) with a single space</span></span><br><span class="line">replace_with_single_space_pattern = re.compile(<span class="string">r'\s&#123;2,&#125;|[^\S ]'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">preprocess_content</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> re.sub(</span><br><span class="line">        replace_with_single_space_pattern, <span class="string">' '</span>,</span><br><span class="line">        re.sub(replace_with_empty_pattern, <span class="string">''</span>, content)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é¦–å…ˆå»æ‰æ ‡ç‚¹ç¬¦å·ä¹‹ç±»çš„å¹²æ‰°å­—ç¬¦ï¼Œç„¶åæŠŠæ‰€æœ‰çš„å•è¯éƒ½ä»¥ä¸€ä¸ªç©ºæ ¼ç›¸éš”ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åšä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œå®Œæˆè¿™ä¸ªéœ€æ±‚å§~</p>
<ul>
<li><code>[^A-Za-z0-9\s]</code>  â€” é¦–å…ˆï¼Œ<code>[^å˜»å“ˆå˜¿]</code>ä»£è¡¨ä¸åŒ¹é…<code>å˜»å“ˆå˜¿</code>ä¹‹ç±»çš„å­—ç¬¦ï¼›ç„¶åï¼Œ<code>A-Za-z0-9</code>å°±é¡¾åæ€ä¹‰ï¼Œä»£è¡¨æ•°å­—è·Ÿå­—æ¯ï¼›æœ€åï¼Œ<code>\s</code>ä»£è¡¨ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬æ¯”å¦‚ç©ºæ ¼(space)å•Šã€å›è½¦(enter)å•Šã€åˆ¶è¡¨ç¬¦ï¼ˆtabï¼‰ä¹‹ç±»ã€‚è¿èµ·æ¥ï¼Œå°±æ˜¯<strong>ä¸åŒ¹é…æ•°å­—ã€å­—æ¯è·Ÿç©ºç™½å­—ç¬¦çš„é‚£äº›æ–‡æœ¬</strong>çš„æ„æ€ï¼Œä¹Ÿå°±æ­£å¥½å¯¹åº”æˆ‘ä»¬çš„å¹²æ‰°å­—ç¬¦ã€‚æˆ‘ä»¬ç”¨<code>re.sub</code>æ–¹æ³•ï¼Œå°±å¯ä»¥æŠŠè¿™äº›å¹²æ‰°å­—ç¬¦æ›¿æ¢æˆç©ºå­—ç¬¦ä¸²<code>&#39;&#39;</code>ï¼Œä»è€Œå»æ‰å®ƒä»¬ã€‚</li>
<li><code>\s{2,}|[^\S ]</code> â€” é¦–å…ˆï¼Œ<code>\s{2,}</code>è¡¨ç¤ºè¿ç»­å‡ºç°ä¸¤æ¬¡æˆ–ä»¥ä¸Šçš„ç©ºç™½å­—ç¬¦ï¼›å…¶æ¬¡ï¼Œ<code>|</code>ä»£è¡¨â€œæˆ–è€…â€çš„æ„æ€ï¼Œæœ€åï¼Œ<code>[^\S ]</code>ä¸­çš„<code>\S</code>ï¼Œä»£è¡¨éç©ºç™½å­—ç¬¦ï¼Œæ•´ä¸€ä¸‹å°±è¡¨ç¤ºç©ºç™½å­—ç¬¦é‡Œé™¤å»ç©ºæ ¼å¤–ï¼ˆé‡Œè¾¹å¤š<code>^</code>äº†ä¸€ä¸ªç©ºæ ¼å–”ï¼‰å…¶å®ƒæ‰€æœ‰çš„ç©ºç™½å­—ç¬¦ã€‚è¿™æ ·ï¼Œæ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼å°±è¡¨ç¤ºâ€”â€”<strong>é™¤äº†å•ä¸ªç©ºæ ¼å¤–ï¼Œæ‰€æœ‰ç©ºç™½å­—ç¬¦ç»„åˆæˆå­—ç¬¦ä¸²</strong>çš„æƒ…å†µäº†ã€‚æˆ‘ä»¬æŠŠå‡ºç°è¿™äº›æƒ…å†µçš„å­—ç¬¦ä¸²éƒ½ç”¨å•ä¸ªç©ºæ ¼<code>&#39; &#39;</code>ä»£æ›¿ï¼Œè¿™æ ·æ‰€æœ‰çš„å•è¯éƒ½ä»¥ç©ºæ ¼ç›¸éš”äº†ã€‚ï¼ˆè¯¶ï¼Œå…¶å®å«Œéº»çƒ¦çš„è¯ï¼Œç›´æ¥<code>\s+</code>ä¹Ÿæˆ= =ï¼‰</li>
</ul>
<p><code>print</code>ä¸€ä¸‹è¯•è¯•çœ‹å§~</p>
<h3 id="æ–°é—»æ–‡æœ¬åˆ†ç±»"><a href="#æ–°é—»æ–‡æœ¬åˆ†ç±»" class="headerlink" title="æ–°é—»æ–‡æœ¬åˆ†ç±»"></a>æ–°é—»æ–‡æœ¬åˆ†ç±»</h3><p>å¦‚ä¸Šæ‰€è¯´ï¼Œè¦å®ç°ä¸€ä¸ªç®€å•çš„æ–‡æœ¬åˆ†ç±»æµç¨‹ï¼Œå°±éœ€è¦å‡†å¤‡å¥½è®­ç»ƒè®¡ç®—æœºçš„æ•°æ®å’Œç”¨äºæµ‹è¯•è®¡ç®—æœºçš„æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥æŠŠåˆšåˆšå¤„ç†å¥½çš„æ–°é—»å†…å®¹è·Ÿç±»åˆ«æ ‡ç­¾åˆ—è¡¨æ´—åˆ·åˆ·ï¼ˆshuffleï¼‰ï¼Œç„¶ååˆ†éš”ä¸€éƒ¨åˆ†ç”¨äºè®­ç»ƒï¼Œä¸€éƒ¨åˆ†ç”¨äºæµ‹è¯•ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠè®­ç»ƒè·Ÿæµ‹è¯•æ•°æ®é›†çš„æ¯”é‡è®¾æˆ1ï¼š1å…ˆå•¦~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">train_contents, test_contents, train_labels, test_labels = \</span><br><span class="line">    train_test_split(news_contents, news_labels, shuffle=<span class="literal">True</span>, test_size=<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬çš„æ–°é—»ï¼Œè½¬åŒ–æˆæ•°å­¦æ¨¡å‹ï¼Œä»è€Œè¢«åˆ†ç±»å™¨è¯†åˆ«ã€‚æŒ‰ç…§æœ€ç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªæ•°æ®é›†æ‰€æœ‰å‡ºç°è¿‡çš„ä¸åŒè¯è¯­æ•´åˆæˆä¸€ä¸ªè¯è¡¨ï¼ˆvocabularyï¼‰ã€‚ç„¶åï¼Œé’ˆå¯¹æ¯ä¸€ç¯‡æ–‡ç« ï¼Œéƒ½è®¡ç®—<strong>è¯è¡¨é‡Œæ¯ä¸ªè¯åœ¨è¿™ç¯‡æ–‡ç« çš„å…³é”®ç¨‹åº¦</strong>ï¼Œå†ä¸€æ•´åˆï¼Œå°±æˆäº†è¿™ç¯‡æ–‡ç« çš„æ•°å­¦æ¨¡å‹è¡¨ç¤ºäº†ã€‚</p>
<p>æ€æ ·è®¡ç®—è¯è¡¨é‡Œæ¯ä¸ªè¯åœ¨å•ç¯‡æ–‡ç« çš„å…³é”®ç¨‹åº¦å‘¢ï¼Ÿæœ€è€æ‰ç‰™ä½†åˆæœ‰æ•ˆçš„æ–¹æ³•ï¼Œå°±æ˜¯é€šè¿‡<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLWhhbnMvVGYtaWRm" title="https://zh.wikipedia.org/zh-hans/Tf-idf">TF-IDF<i class="fa fa-external-link"></i></span>è®¡ç®—äº†ã€‚TFï¼ˆTerm Frequencyï¼‰ä»£è¡¨è¿™ä¸ªè¯åœ¨è¯¥ç¯‡æ–‡ç« å‡ºç°çš„é¢‘ç‡ï¼ŒIDFï¼ˆInverse Document Frequencyï¼‰ä»£è¡¨è¿™ä¸ªè¯åœ¨æ•´ä¸ªæ•°æ®é›†ä¸­åœ°ä½é¢‘ç¨‹åº¦ã€‚ä¸€ä¸ªè¯ï¼Œå‡ºç°åœ¨è¯¥ç¯‡æ–‡ç« æ¬¡æ•°å¤šï¼Œå‡ºç°åœ¨æ•´ä¸ªæ•°æ®é›†æ¬¡æ•°å°‘ï¼Œå°±è¡¨ç¤ºè¿™ä¸ªè¯è¯­èƒ½å¤Ÿæ›´åŠ çªå‡ºè¯¥ç¯‡æ–‡ç« çš„è¯­ä¹‰ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>scikit-learn</code>å†…ç½®çš„<code>TfidfVectorizer</code>ï¼ŒæŠŠæ–‡ç« çš„æ–‡æœ¬è½¬åŒ–ä¸ºæ‰€æœ‰è¯è¯­åœ¨è¯¥ç¯‡æ–‡ç« å…³é”®ç¨‹åº¦çš„é›†åˆï¼Œä¹Ÿå°±æ˜¯ä¸ªå‘é‡å•¦~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> TfidfVectorizer</span><br><span class="line"></span><br><span class="line">tfidf_vectorizer = TfidfVectorizer()</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†æŠŠæ¯ç¯‡æ–‡ç« çš„æ•°å­¦æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªåˆ†ç±»å™¨ã€‚å¸¸ç”¨çš„åˆ†ç±»å™¨æœ‰è®¸å¤šï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å°±ä»¥SVMï¼ˆSupport Vector Machineï¼Œæ”¯æŒå‘é‡æœºï¼‰ä¸ºä¾‹å•¦- -</p>
<p>SVMçš„åˆ†ç±»åŸç†å¯ä»¥ç”¨åˆ‡è¥¿ç“œæ¥æ¯”å–»â€”â€”è¥¿ç“œé‡Œæœ‰ç™½çš„é»‘çš„ç±½ï¼Œç°åœ¨ä¸ç®¡ä½ åˆ€çš„å½¢çŠ¶ï¼Œæ€æ ·æ¥ä¸€åˆ€ï¼Œä½¿å¾—åˆ€ä¸¤è¾¹èƒ½å¤Ÿå°½é‡åˆ†åˆ«æ˜¯ç™½ç±½è·Ÿé»‘ç±½ï¼Œç„¶ååˆ€åˆ°ç™½ç±½é»‘ç±½ä¸¤è€…è·ç¦»çš„æœ€å°å€¼èƒ½å°½é‡å¤§å‘¢ï¼Ÿæ¯”å–»è¯´çš„ç®€å•ï¼Œå®é™…è®¡ç®—è¿˜æ˜¯å¤æ‚çš„ï¼ˆæ•°å­¦æ¸£TATï¼‰ã€‚ä½†æˆ‘ä»¬è‹¥æ˜¯å•çº¯å¼•ç”¨ï¼Œåˆ™ä¸éœ€è¦ç®¡è¿™äº›æ•°å­¦é—®é¢˜ï¼Œç›´æ¥importå°±å¥½å•¦~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.svm <span class="keyword">import</span> LinearSVC</span><br><span class="line"></span><br><span class="line"><span class="comment"># LinearSVCï¼šçº¿æ€§æ”¯æŒå‘é‡åˆ†ç±»å™¨</span></span><br><span class="line">svm_classifier = LinearSVC(verbose=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>åœ¨å‰é¢çš„<code>TfidfVectorizer</code>ä¸­ï¼Œæˆ‘ä»¬ä¼šå…ˆå¯¹è®­ç»ƒé›†æ“ä½œï¼Œæœ€åå¯¹äºæ¯ä¸€ä¸ªæ–°é—»ç”Ÿæˆçš„æ•°å­¦æ¨¡å‹ï¼Œéƒ½æ˜¯ä¸€ä¸ªç»´åº¦å¾ˆé«˜çš„å‘é‡ï¼ˆè¯è¡¨é•¿åº¦= =ï¼‰ã€‚ä¸ºäº†èƒ½å¤Ÿè®©æˆ‘ä»¬çš„SVMåˆ†ç±»å™¨è®­ç»ƒæ›´åŠ æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç‰¹å¾é€‰æ‹©ï¼ˆfeature selectionï¼‰çš„æ–¹æ³•ï¼Œåœ¨è¯è¡¨ä¸­æŒ‘é€‰å°‘é‡æ¥ä½œä¸ºæ¯ä¸ªæ–°é—»æ•°å­¦æ¨¡å‹çš„ç»´åº¦å°±å¥½å•¦ã€‚</p>
<p>å¡æ–¹ç»Ÿè®¡é‡ï¼ˆchi2ï¼‰æ˜¯å¸¸ç”¨çš„ç‰¹å¾é€‰æ‹©æŒ‡æ ‡ã€‚å¡æ–¹ç»Ÿè®¡é‡èƒ½å¤Ÿè¡¡é‡è¯è¯­è·Ÿç±»åˆ«çš„ç›¸å…³æ€§ï¼Œå› æ­¤é€šè¿‡å¡æ–¹æŒ‡æ ‡æ‰“åˆ†ç­›é€‰è¯è¡¨ä¸­çš„è¯è¯­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‰”é™¤è®¸å¤šå½±å“åˆ†ç±»æ•ˆæœçš„å¸¸è§è¯äº†ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.feature_selection <span class="keyword">import</span> SelectKBest, chi2</span><br><span class="line"></span><br><span class="line"><span class="comment"># é€‰10000ä¸ªè¯è¯­ä½œä¸ºæ–‡æ¡£ç‰¹å¾è¯</span></span><br><span class="line">chi2_feature_selector = SelectKBest(chi2, k=<span class="number">10000</span>)</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæµæ°´çº¿ï¼ˆpipelineï¼‰ï¼ŒæŠŠæ•´ä¸ªæµç¨‹ä¸²èµ·æ¥â€”â€”</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.pipeline <span class="keyword">import</span> Pipeline</span><br><span class="line"></span><br><span class="line">pipeline = Pipeline(memory=<span class="literal">None</span>, steps=[</span><br><span class="line">    (<span class="string">'tfidf'</span>, tfidf_vectorizer),</span><br><span class="line">    (<span class="string">'chi2'</span>, chi2_feature_selector),</span><br><span class="line">    (<span class="string">'svm'</span>, svm_classifier),</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>å¯¹äºè®­ç»ƒæ•°æ®ï¼Œæˆ‘ä»¬å…ˆæŠŠå…¶è½¬åŒ–ä¸ºä»¥TF-IDFä¸ºåŸºç¡€çš„æ•°å­¦æ¨¡å‹ï¼Œç„¶åé€šè¿‡chi2æ–¹æ³•é€‰æ‹©ç‰¹å®šæ•°é‡çš„è¯è¯­ä»è€Œå‰”é™¤å¹²æ‰°è¯ï¼Œæœ€åæŠŠå®ƒè¾“å…¥åˆ°SVMåˆ†ç±»å™¨ä¸­è¿›è¡Œè®­ç»ƒã€‚</p>
<p>å¯¹äºæµ‹è¯•æ•°æ®ï¼Œæˆ‘ä»¬åŒæ ·å…ˆå°†å…¶è½¬åŒ–ä¸ºTF-IDFä¸ºåŸºç¡€çš„æ•°æ®ï¼Œç„¶ååœ¨chi2æµç¨‹æ—¶ï¼ŒæŠŠè®­ç»ƒæ•°æ®é€‰å‡ºçš„è¯è¯­åº”ç”¨åˆ°æµ‹è¯•æ•°æ®ä¸­ä½œä¸ºæ¯ä¸€ä¸ªæµ‹è¯•æ–‡æ¡£çš„ç‰¹å¾è¯ï¼ˆfeatureï¼‰ï¼Œæœ€åå†å°†å…¶è¾“å…¥åˆ°SVMåˆ†ç±»å™¨ä¸­ï¼Œè¿›è¡Œç±»åˆ«é¢„æµ‹ï¼ˆpredictï¼‰ï¼Œä¹Ÿå°±æ˜¯â€œåˆ†ç±»â€å•¦ã€‚</p>
<p>å¾—åˆ°é¢„æµ‹ç»“æœåï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>classification_report</code>æ¨¡å—ï¼Œå»å±•ç°æˆ‘ä»¬çš„æµ‹è¯•æŠ¥å‘Šã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> classification_report</span><br><span class="line"></span><br><span class="line">pipeline.fit(train_contents, train_labels)</span><br><span class="line">result = pipeline.predict(test_contents)</span><br><span class="line">report = classification_report(test_labels, result, target_names=category_names)</span><br></pre></td></tr></table></figure>
<p>è¯•è¯•çœ‹å§~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç”¨pythonè¿›è¡Œnewsgroupæ–‡æœ¬åˆ†ç±»ï¼Œä¸è¿‡æ˜¯å°èœèŠ±ç”Ÿã€‚åœ¨æ•°æ®æŒ–æ˜ã€æœºå™¨å­¦ä¹ é¢†åŸŸï¼Œæ›´å¤šçš„æ˜¯æ•°å­¦çš„æ‰å®ç¨‹åº¦ï¼Œä»£ç èƒ½åŠ›å¹¶éæœ€ä¸ºé‡è¦ã€‚</p>
<p>newsgroupçš„æ•°æ®ï¼Œæ€»å…±ä¸åˆ°ä¸¤ä¸‡ï¼Œç®—æ˜¯å°‘ä¹‹åˆå°‘ã€‚æ›´ä¸ºæµ·é‡çš„æ•°æ®ï¼Œè¦è¿›è¡Œæ•°æ®å¤„ç†æŒ–æ˜ï¼Œå…‰é ä¸ªé»˜è®¤çš„SVMä¹‹ç±»ä¹Ÿæ˜¯å¾’åŠ³ï¼Œéœ€è¦æ›´ä¸ºå¤æ‚ã€æ›´åŠ æ·±å±‚æ¬¡çš„æ¨¡å‹ï¼Œå¥½æ¯”è¯´ç¥ç»ç½‘ç»œï¼Œæ‰èƒ½ç¡¬åˆšã€‚</p>
<p>ä½†æ˜¯å¾ˆåº†å¹¸ï¼Œæˆ‘ä»¬æ‹¥æœ‰pythonï¼Œå’ŒèƒŒåå¼ºå¤§çš„ç¤¾åŒºã€‚</p>
<p>æˆ‘æƒ³åå¤è¯´ï¼Œä¸ºä»€ä¹ˆå«easy pythonï¼Ÿæ¯”pythonæ›´å®¹æ˜“ä¸Šæ‰‹çš„è¯­è¨€å¾ˆå¤šï¼Œluaå°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚ä½†æ˜¯ï¼Œluaç°åœ¨æ”¯æŒé‚£ä¹ˆå¤šæ•°æ®æŒ–æ˜éœ€æ±‚å—ï¼Ÿå¹¶æ²¡æœ‰ã€‚</p>
<p>easy pythonï¼Œå› ä¸ºå®ƒå°±å¦‚ç”µå­ç´ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬éšå¿ƒæ‰€æ¬²ï¼Œå¤©é©¬è¡Œç©ºã€‚</p>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ•°æ®æŒ–æ˜</tag>
        <tag>æ–‡æœ¬åˆ†ç±»</tag>
        <tag>scikit-learn</tag>
        <tag>newsgroup</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘debug.getinfoæºç åˆ†æâ€”â€”ä½¿ç”¨C APIé‡å†™lfunctimer</title>
    <url>/2019/04/07/luatalk/lfunctimer_capi/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ˜¨å¤©æ›´æ–°äº†ä¸€ä¸‹<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9sZnVuY3RpbWVy" title="https://github.com/utmhikari/lfunctimer">lfunctimer<i class="fa fa-external-link"></i></span>ï¼Œä¸»è¦æŠŠhookæ›´æ”¹ä¸ºc apiçš„å½¢å¼ï¼Œå¹¶ä¸”åˆæ­¥åŠ äº†utilå’Œconfigçš„æ‰©å±•</p>
<p>æƒ³è¦è¯•ç”¨çš„åŒå­¦çš„è¯å¯ä»¥ç‚¹å‡»ä¸Šé¢cloneä¸‹æ¥ï¼Œæˆ–è€…å®‰è£…<span class="exturl" data-url="aHR0cHM6Ly9sdWFyb2Nrcy5vcmcv" title="https://luarocks.org/">luarocks<i class="fa fa-external-link"></i></span>åæ‰§è¡Œä¸‹é¢å‘½ä»¤å®‰è£…~</p>
<p><code>luarocks install --server=http://luarocks.org/manifests/utmhikari lfunctimer</code></p>
<p>è¨€å½’æ­£ä¼ ï¼Œåˆ©ç”¨luaåŸç”Ÿçš„c apiåšdebugç›¸å…³æ“ä½œä¼šæ¯”luaè‡ªå¸¦çš„<code>debug.getinfo</code>æ¥çš„å¿«è®¸å¤šï¼Œæˆ‘ä»¬å¯ä»¥æ¥ä¸€æ¢ç©¶ç«Ÿ</p>
<h2 id="debug-getinfoæºç åˆ†æ"><a href="#debug-getinfoæºç åˆ†æ" class="headerlink" title="debug.getinfoæºç åˆ†æ"></a>debug.getinfoæºç åˆ†æ</h2><p>æˆ‘ä»¬å¯ä»¥ä»å®˜æ–¹ä¸‹è½½æºç æœç´¢<code>debug.getinfo</code>çš„å®ç°ï¼Œæ­¤å¤„ä»¥ç‰ˆæœ¬5.3.5ä¸ºä¾‹ã€‚</p>
<p><code>debug.getinfo</code>å¯¹åº”çš„æºç æ˜¯<code>ldblib.c</code>çš„<code>db_getinfo</code>å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ¨<code>ldblib.c</code>çš„æœ«å°¾ä¸­æŸ¥åˆ°~</p>
<a id="more"></a>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> luaL_Reg dblib[] = &#123;</span><br><span class="line">  <span class="comment">// ç•¥è¿‡å‰é¢</span></span><br><span class="line">  &#123;<span class="string">"getinfo"</span>, db_getinfo&#125;,</span><br><span class="line">  <span class="comment">// ç•¥è¿‡åé¢</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">LUAMOD_API <span class="keyword">int</span> <span class="title">luaopen_debug</span> <span class="params">(lua_State *L)</span> </span>&#123;</span><br><span class="line">  luaL_newlib(L, dblib);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>luaæä¾›ä¸€ä¸ªæ³¨å†Œè¡¨ï¼ˆRegistryï¼‰æœºåˆ¶å»æŠŠæˆ‘ä»¬çš„å‡½æ•°åè·Ÿå‡½æ•°å¯¹åº”èµ·æ¥ï¼Œç„¶åæœ€åè¦è®©luaè¯†åˆ«è¿™ä¸ªæ¨¡å—çš„è¯ï¼Œå°±å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œåç§°ä¸º<code>luaopen_æ¨¡å—å</code>ï¼Œç„¶åé€šè¿‡<code>luaL_newlib</code>æ–¹æ³•è¯»å–å‰é¢çš„<code>luaL_Reg</code>æ³¨å†Œè¡¨æ•°æ®å˜æˆä¸€ä¸ªå‡½æ•°åâ€”â€”å‡½æ•°çš„tableå°±okäº†ã€‚</p>
<p>åƒ<code>debug</code>ä¹‹ç±»çš„luaå†…ç½®åº“ï¼Œåˆ™åœ¨èµ·luaçš„æ—¶å€™å°±è°ƒç”¨<code>linit.c</code>é‡Œçš„<code>luaL_openlibs</code>æ–¹æ³•å°±è½½å…¥ï¼›è€Œå¦‚æœæ˜¯ç¬¬ä¸‰æ–¹åº“ï¼Œä½ åœ¨requireçš„æ—¶å€™ï¼Œåˆ™ä¼šé€šè¿‡<code>loadlib.c</code>ä¸­çš„æ–¹æ³•å»å¯»æ‰¾æ¨¡å—æœ‰æ— è½½å…¥è¿‡ï¼Œå¦‚æœè½½å…¥è¿‡åˆ™ç”¨è½½å…¥è¿‡çš„æ¨¡å—(<code>package.loaded</code>)ï¼Œå¦‚æœæ²¡è½½å…¥è¿‡å°±è½½å…¥ï¼Œå¹¶ä¸”åŠ åˆ°è½½å…¥è¿‡æ¨¡å—ä¸­ã€‚è¿™éƒ¨åˆ†ä¸å†ç»†ç©¶å•¦ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œå‘æ˜ï¼Œæˆ‘æœ‰ç©ºçš„è¯ä¹Ÿä¼šè‡ªå·±å†è¸©è¸©å‘~</p>
<p>æˆ‘ä»¬å†å›å¤´çœ‹<code>ldblib.c</code>çš„<code>db_getinfo</code>å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯<code>debug.getinfo</code>å¯¹åº”çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// debug.getinfo([thread,] f [,what]): è·å–å½“å‰è¿è¡Œå‡½æ•°çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">// thread (optional): è¦è·å–å‡½æ•°æ‰€åœ¨çš„lua stateï¼ˆé»˜è®¤å½“å‰lua stateï¼‰</span></span><br><span class="line"><span class="comment">// f: è°ƒç”¨æ ˆå±‚æ¬¡ï¼ˆ0æ˜¯å½“å‰å‡½æ•°ï¼Œ1æ˜¯å½“å‰å‡½æ•°callerï¼Œå¾€ä¸Šç±»æ¨ï¼‰</span></span><br><span class="line"><span class="comment">// what (optional)ï¼šè·å–çš„ä¿¡æ¯æœ‰å“ªäº›ï¼ˆé»˜è®¤å…¨éƒ¨ï¼‰</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">db_getinfo</span> <span class="params">(lua_State *L)</span> </span>&#123;</span><br><span class="line">  lua_Debug ar;</span><br><span class="line">  <span class="keyword">int</span> arg;</span><br><span class="line">  <span class="comment">// å‚æ•°æ£€éªŒéƒ¨åˆ†</span></span><br><span class="line">  lua_State *L1 = getthread(L, &amp;arg);  <span class="comment">// è¯»å–threadå‚æ•°</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *options = luaL_optstring(L, arg+<span class="number">2</span>, <span class="string">"flnStu"</span>);</span><br><span class="line">  checkstack(L, L1, <span class="number">3</span>);</span><br><span class="line">  <span class="comment">// è·å–funcæœ¬èº«/CallInfo</span></span><br><span class="line">  <span class="keyword">if</span> (lua_isfunction(L, arg + <span class="number">1</span>)) &#123;  <span class="comment">/* info about a function? */</span></span><br><span class="line">    options = lua_pushfstring(L, <span class="string">"&gt;%s"</span>, options);  <span class="comment">/* add '&gt;' to 'options' */</span></span><br><span class="line">    lua_pushvalue(L, arg + <span class="number">1</span>);  <span class="comment">/* move function to 'L1' stack */</span></span><br><span class="line">    lua_xmove(L, L1, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;  <span class="comment">/* stack level */</span></span><br><span class="line">    <span class="keyword">if</span> (!lua_getstack(L1, (<span class="keyword">int</span>)luaL_checkinteger(L, arg + <span class="number">1</span>), &amp;ar)) &#123;</span><br><span class="line">      lua_pushnil(L);  <span class="comment">/* level out of range */</span></span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è·å–é™„åŠ ä¿¡æ¯flnStuä¹‹ç±»çš„</span></span><br><span class="line">  <span class="keyword">if</span> (!lua_getinfo(L1, options, &amp;ar))</span><br><span class="line">    <span class="keyword">return</span> luaL_argerror(L, arg+<span class="number">2</span>, <span class="string">"invalid option"</span>);</span><br><span class="line">  <span class="comment">// push tableï¼Œä½œä¸ºæœ€åç»“æœ</span></span><br><span class="line">  lua_newtable(L);  <span class="comment">/* table to collect results */</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strchr</span>(options, <span class="string">'S'</span>)) &#123;</span><br><span class="line">    settabss(L, <span class="string">"source"</span>, ar.source);</span><br><span class="line">    settabss(L, <span class="string">"short_src"</span>, ar.short_src);</span><br><span class="line">    settabsi(L, <span class="string">"linedefined"</span>, ar.linedefined);</span><br><span class="line">    settabsi(L, <span class="string">"lastlinedefined"</span>, ar.lastlinedefined);</span><br><span class="line">    settabss(L, <span class="string">"what"</span>, ar.what);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strchr</span>(options, <span class="string">'l'</span>))</span><br><span class="line">    settabsi(L, <span class="string">"currentline"</span>, ar.currentline);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strchr</span>(options, <span class="string">'u'</span>)) &#123;</span><br><span class="line">    settabsi(L, <span class="string">"nups"</span>, ar.nups);</span><br><span class="line">    settabsi(L, <span class="string">"nparams"</span>, ar.nparams);</span><br><span class="line">    settabsb(L, <span class="string">"isvararg"</span>, ar.isvararg);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strchr</span>(options, <span class="string">'n'</span>)) &#123;</span><br><span class="line">    settabss(L, <span class="string">"name"</span>, ar.name);</span><br><span class="line">    settabss(L, <span class="string">"namewhat"</span>, ar.namewhat);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strchr</span>(options, <span class="string">'t'</span>))</span><br><span class="line">    settabsb(L, <span class="string">"istailcall"</span>, ar.istailcall);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strchr</span>(options, <span class="string">'L'</span>))</span><br><span class="line">    treatstackoption(L, L1, <span class="string">"activelines"</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">strchr</span>(options, <span class="string">'f'</span>))</span><br><span class="line">    treatstackoption(L, L1, <span class="string">"func"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;  <span class="comment">/* return table */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å¦‚æœåœ¨æ¯æ¬¡è°ƒç”¨<code>debug.getinfo</code>ä¼šç»å†<code>å‚æ•°æ£€éªŒâ€”â€”è·å–funcæˆ–CallInfoä¿¡æ¯â€”â€”è·å–é™„åŠ ä¿¡æ¯ï¼ˆwhatï¼‰</code>çš„è¿‡ç¨‹ï¼Œæ¯æ¬¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ª<code>lua_Debug</code>ç»“æ„ä½“ï¼Œåœ¨luaä¸­è¿”å›çš„æ˜¯ä¸€ä¸ªtableï¼Œç›¸å¯¹ç¹çä¸€äº›ã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨<code>db_getinfo</code>ä¸­çš„<code>lua_getstack</code>è·Ÿ<code>lua_getinfo</code>æ–¹æ³•å»åœ¨æˆ‘ä»¬çš„c hookä¸­è·å–å‡½æ•°ä¿¡æ¯ã€‚</p>
<h2 id="ç”¨C-APIé‡å†™lfunctimerçš„hook"><a href="#ç”¨C-APIé‡å†™lfunctimerçš„hook" class="headerlink" title="ç”¨C APIé‡å†™lfunctimerçš„hook"></a>ç”¨C APIé‡å†™lfunctimerçš„hook</h2><p>åœ¨æ–°ç‰ˆlfunctimerä¸­ï¼Œç¬¬ä¸€ç‰ˆC Hookå®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LFUNCTIMER_UPVAL_IDX</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LFUNCTIMER_UPVAL_IDX 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> LFUNCTIMER_FUNCMAP_UPVAL_IDX</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LFUNCTIMER_FUNCMAP_UPVAL_IDX 2</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// push function name to top of stack</span></span><br><span class="line"><span class="comment">// not the same as builtin "getfuncname" method</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lfunctimer_getfuncname</span><span class="params">(lua_State *L)</span> </span>&#123;</span><br><span class="line">    lua_Debug ar;</span><br><span class="line">    <span class="keyword">if</span> (!lua_getstack(L,  LFUNCTIMER_STKLVL, &amp;ar)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// check if function name already exists</span></span><br><span class="line">    lua_getinfo(L, <span class="string">"f"</span>, &amp;ar);</span><br><span class="line">    lua_pushvalue(L, <span class="number">-1</span>);</span><br><span class="line">    lua_gettable(L, lua_upvalueindex(LFUNCTIMER_FUNCMAP_UPVAL_IDX));</span><br><span class="line">    <span class="keyword">if</span> (lua_toboolean(L, <span class="number">-1</span>)) &#123;</span><br><span class="line">        lua_remove(L, <span class="number">1</span>);  <span class="comment">// remove funcinfo</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// check if it's a builtin function</span></span><br><span class="line">    lua_getinfo(L, <span class="string">"Sn"</span>, &amp;ar);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *what = ar.what;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(what, <span class="string">"C"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        lua_pushfstring(L, <span class="string">"&lt;Builtin&gt; %s"</span>, ar.name);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ar.namewhat[<span class="number">0</span>] == <span class="string">'\0'</span>) &#123;</span><br><span class="line">        lua_pushfstring(L, <span class="string">"&lt;%s:%d&gt; ::UNKNOWN::"</span>, ar.short_src, ar.linedefined);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lua_pushfstring(L, <span class="string">"&lt;%s:%d&gt; %s"</span>, ar.short_src, ar.linedefined, ar.name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// save function name to function map</span></span><br><span class="line">    lua_pushvalue(L, <span class="number">1</span>);</span><br><span class="line">    lua_pushstring(L, lua_tostring(L, <span class="number">-2</span>));</span><br><span class="line">    lua_settable(L, lua_upvalueindex(LFUNCTIMER_FUNCMAP_UPVAL_IDX));</span><br><span class="line">    <span class="comment">// remove funcinfo</span></span><br><span class="line">    lua_remove(L, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚loadstringï¼‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿä¸ä¾µå…¥luaåŸç”Ÿapiå»è·å–å‡½æ•°åç§°ä¿¡æ¯ã€‚å› æ­¤å¯ä»¥è¿™æ ·æ“ä½œâ€”â€”åœ¨hookå‡½æ•°ä¸­å»ä¸Šä¸€ä¸ªæ ˆå±‚æ¬¡ï¼ˆlevel=1ï¼‰çš„callerï¼Œæˆ‘ä»¬å°±å¯ä»¥<code>getstack</code>åæŠŠå‡½æ•°ä¿¡æ¯æš‚å­˜åœ¨ä¸€ä¸ª<code>lua_Debug</code>ç»“æ„ä½“ä¸­ï¼Œå¹¶åœ¨åç»­ä¾æ®éœ€æ±‚<code>getinfo</code>ç›¸åº”çš„å†…å®¹ã€‚</p>
<p>è·å–å‡½æ•°åç§°çš„æ€»ä½“é€»è¾‘å’Œä¸Šä¸€ç‰ˆçš„lfunctimerï¼ˆlua hookï¼‰åŸºæœ¬ç±»ä¼¼ï¼Œå¦‚æœèƒ½è·å–åˆ°å¥½ä¹¦åç§°ï¼Œå°±æŠŠå‡½æ•°åç§°pushåˆ°<code>lua_State</code>çš„æ ˆä¸Šã€‚åœ¨åè¾¹çš„é€»è¾‘ä¸­ï¼Œcallè·Ÿreturnäº‹ä»¶çš„handleréƒ½è¢«åˆ†ç¦»äº†å‡ºæ¥ï¼Œè¿™æ ·å°±æ˜¾å¾—æ›´åŠ æ¨¡å—åŒ–äº†ã€‚</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// debug hook of lfunctimer</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">lfunctimer_debug_hook</span><span class="params">(lua_State *L)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *evt = lua_tostring(L, <span class="number">1</span>);</span><br><span class="line">    lua_settop(L, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// get function name</span></span><br><span class="line">    <span class="keyword">if</span> (lfunctimer_getfuncname(L) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// print log</span></span><br><span class="line">    lua_getfield(L, lua_upvalueindex(LFUNCTIMER_CFG_UPVAL_IDX), <span class="string">"verbose"</span>);</span><br><span class="line">    <span class="keyword">if</span> (lua_toboolean(L, <span class="number">-1</span>)) &#123;</span><br><span class="line">        lua_getfield(L, lua_upvalueindex(LFUNCTIMER_UPVAL_IDX), <span class="string">"log"</span>);</span><br><span class="line">        lua_pushfstring(L, <span class="string">"%s: %s"</span>, lua_tostring(L, <span class="number">1</span>), evt);</span><br><span class="line">        lua_call(L, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    lua_pop(L, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// dispatch events</span></span><br><span class="line">    <span class="keyword">if</span> (evt[<span class="number">0</span>] == <span class="string">'c'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> handle_call(L);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (evt[<span class="number">0</span>] == <span class="string">'r'</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> handle_return(L);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿‡åçœŸçš„è¦å¤šæŠ½ç©ºç ”è¯»ä¸‹å„ç§æºç ï¼Œæ‰“å¥½åŸºç¡€= =mlgbçš„ï¼Œæœ€è¿‘ä¸ºäº†é¢†å¯¼æ¯•ä¸šè®ºæ–‡çš„äº‹æƒ…ï¼Œéƒ½æ†”æ‚´äº†ã€‚</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>lua</tag>
        <tag>debug</tag>
        <tag>æµ‹è¯•</tag>
        <tag>lfunctimer</tag>
        <tag>lua C API</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘ç¬¬å››è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸‹ï¼‰</title>
    <url>/2019/03/31/easypython/iv/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ä¸Šç¯‡ï¼Œæˆ‘ä»¬è·å¾—äº†è±†ç“£äºŒç™¾äº”çš„ç”µå½±URLï¼Œç„¶åå­˜å‚¨åœ¨äº†ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è®¿é—®æ¯ä¸€ä¸ªç”µå½±URLï¼Œæ·±å…¥æ•Œåï¼Œè·å–æƒ…æŠ¥~</p>
<p>æ‰€æœ‰çš„ä»£ç éƒ½å·²å­˜å‚¨åœ¨æˆ‘çš„Githubä»“åº“ï¼š<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9Eb3ViYW5fMjUw" title="https://github.com/utmhikari/Douban_250">Douban_250<i class="fa fa-external-link"></i></span>å½“ä¸­~</p>
<h2 id="è®¾ç½®çˆ¬å–è§„åˆ™"><a href="#è®¾ç½®çˆ¬å–è§„åˆ™" class="headerlink" title="è®¾ç½®çˆ¬å–è§„åˆ™"></a>è®¾ç½®çˆ¬å–è§„åˆ™</h2><p>å¯¹äºæ¯ä¸€ä¸ªç”µå½±ï¼Œæˆ‘ä»¬é€‰æ‹©çˆ¬å–å¦‚ä¸‹å†…å®¹ï¼ˆè™½ç„¶ç”µå½±åˆ—è¡¨é¡µå°±èƒ½çˆ¬å¾—åˆ°= =ï¼‰ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">æ ‡é¢˜ï¼ˆtitleï¼‰ã€å¹´ä»½ï¼ˆyearï¼‰ã€æ—¶é•¿ï¼ˆtimeï¼‰ã€</span><br><span class="line">å¯¼æ¼”ï¼ˆdirectorï¼‰ã€ç±»å‹ï¼ˆgenreï¼‰ã€è¯„åˆ†ï¼ˆscoreï¼‰</span><br></pre></td></tr></table></figure>
<p>éšæ„ç‚¹å‡»ä¸€ä¸ªç”µå½±é¡µé¢ï¼Œç”¨ä¸Šç¯‡æ‰€è¯´çš„æå–CSSé€‰æ‹©å™¨çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆ¶ä½œå‡ºæ¯ä¸€ç§å†…å®¹ä¸å†…å®¹æå–è§„åˆ™çš„æ˜ å°„ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># spå°±æ˜¯ä¸Šç¯‡æ‰€è¯´çš„soupè§£æå™¨</span></span><br><span class="line"><span class="comment"># æ¯ä¸€ç§å†…å®¹éƒ½å¯ä»¥åœ¨è§£æå™¨ä¸­æŒ‰ç‰¹å®šçš„è§„åˆ™æå–åŠ å·¥å¾—åˆ°</span></span><br><span class="line">content_func_map = &#123;</span><br><span class="line">    <span class="string">'title'</span>: <span class="keyword">lambda</span> sp: sp.select_one(<span class="string">'#content &gt; h1 &gt; span:nth-child(1)'</span>).get_text(),</span><br><span class="line">    <span class="string">'year'</span>: <span class="keyword">lambda</span> sp: sp.select_one(<span class="string">'#content &gt; h1 &gt; span.year'</span>).get_text().replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>),</span><br><span class="line">    <span class="string">'time'</span>: <span class="keyword">lambda</span> sp: sp.select_one(<span class="string">'#info &gt; span[property="v:runtime"]'</span>).get_text(),</span><br><span class="line">    <span class="string">'director'</span>: <span class="keyword">lambda</span> sp: sp.select_one(<span class="string">'#info &gt; span:nth-child(1) &gt; span.attrs &gt; a'</span>).get_text(),</span><br><span class="line">    <span class="string">'genre'</span>: <span class="keyword">lambda</span> sp: list(map(<span class="keyword">lambda</span> item: item.get_text(), sp.select(<span class="string">'#info &gt; span[property="v:genre"]'</span>))),</span><br><span class="line">    <span class="string">'score'</span>: <span class="keyword">lambda</span> sp: sp.select_one(<span class="string">'#interest_sectl &gt; div.rating_wrap.clearbox &gt; div.rating_self.clearfix &gt; strong'</span>).get_text()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®å®Œè§„åˆ™ï¼Œå¤§é—®é¢˜æ¥äº†= =250ä¸ªé“¾æ¥ï¼Œä¸€ä¸ªä¸ªè®¿é—®ï¼Œåº”è¯¥ä¼šå¾ˆæ…¢å§ï¼è€Œä¸”ï¼Œè±†ç“£è¿˜æœ‰åçˆ¬è™«æœºåˆ¶ï¼Œå¦‚æœè®¿é—®é—´éš”å¤ªå¿«ï¼Œå°±ä¼šæš‚æ—¶å°ipâ€”â€”è¿™ï¼Œè¿™å¯æ€ä¹ˆåŠå‘€ï¼</p>
<h2 id="äººæµ·æˆ˜æœ¯ï¼Œä»£ç†çˆ¬è™«"><a href="#äººæµ·æˆ˜æœ¯ï¼Œä»£ç†çˆ¬è™«" class="headerlink" title="äººæµ·æˆ˜æœ¯ï¼Œä»£ç†çˆ¬è™«"></a>äººæµ·æˆ˜æœ¯ï¼Œä»£ç†çˆ¬è™«</h2><p>ä¸€ä¸ªä¸ªè®¿é—®æ…¢çš„è¯ï¼Œä¸€èµ·è®¿é—®ï¼Œä¼¼ä¹ä¼šæ›´å¿«çš„å§= =<br>è±†ç“£å°ipçš„è¯ï¼Œå¦‚æœæœ‰å¤šä¸ªipï¼Œæ•ˆç‡ä¹Ÿä¼šå¢åŠ çš„å§= =</p>
<h3 id="æ•ˆç‡è°ƒåº¦"><a href="#æ•ˆç‡è°ƒåº¦" class="headerlink" title="æ•ˆç‡è°ƒåº¦"></a>æ•ˆç‡è°ƒåº¦</h3><p>ç†æƒ³çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›çˆ¬å–æ¯ä¸€ä¸ªurlçš„è¿‡ç¨‹ï¼Œéƒ½èƒ½å¤Ÿè¢«å½“ä½œæ˜¯ä¸€ä¸ªä»»åŠ¡ï¼ˆtaskï¼‰ã€‚å°±åƒåœ¨Mè®°ä¸€æ ·ï¼Œå‰å°æ¯æ”¶åˆ°ä¸€ä¸ªå®¢äººçš„è®¢å•ï¼Œéƒ½ä¼šæŠŠè®¢å•ä»»åŠ¡ç›´æ¥æ‰”ç»™å¨å¸ˆä»¬ï¼Œç„¶åå¤„ç†ä¸‹ä¸€ä¸ªå®¢äººçš„è¯·æ±‚ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬çš„å¨å¸ˆåœ¨å“ªé‡Œï¼Ÿ</p>
<p>å¾—ç›Šäºpythonå†…ç½®çš„<code>asyncio</code>åº“ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿå¨å¸ˆä»¬çš„å·¥ä½œï¼Œè°ƒåº¦æ¯ä¸€ä¸ªçˆ¬è™«ä»»åŠ¡ã€‚</p>
<p>ç„¶è€Œï¼Œå³ä½¿æœ‰äº†<code>asyncio</code>åº“ï¼Œæˆ‘ä»¬ä¹Ÿåªæ˜¯é€šè¿‡å…¶ä¸­çš„è°ƒåº¦æœºåˆ¶ï¼Œé‡æ„äº†CPUæŒ‡ä»¤è€Œå·²ï¼Œå¯¹äºæŸäº›é˜»å¡ï¼ˆblockï¼‰ä»»åŠ¡è¿›åº¦çš„è¿‡ç¨‹ï¼Œå¹¶ä¸èƒ½å¦¥å–„è§£å†³ã€‚åœ¨çˆ¬å–urlå†…å®¹çš„è¿‡ç¨‹ä¸­ï¼Œæœ€é˜»ç¢æˆ‘ä»¬ä»»åŠ¡è¿›åº¦çš„ï¼Œå½“å±è¯·æ±‚â€”â€”å“åº”çš„é˜¶æ®µã€‚å¯¹äºè°ƒåº¦å™¨æ¥è®²ï¼Œä¸€ä¸ªä»»åŠ¡å‘é€è¯·æ±‚å‡ºå»ï¼Œè°ƒåº¦å™¨å¹¶ä¸éœ€è¦è®©å®ƒå‚»ç­‰å“åº”å›æ¥ï¼Œè€Œæ˜¯å¯ä»¥è®©è¿™ä¸ªä»»åŠ¡æ­‡ä¸€ä¸‹ï¼ŒæŠŠæ‰§è¡Œæƒè®©ï¼ˆyieldï¼‰ç»™å…¶å®ƒä»»åŠ¡ï¼Œç›´åˆ°å“åº”å›æ¥åï¼Œå†é€šçŸ¥è¿™ä¸ªä»»åŠ¡ç»§ç»­åŸæ¥çš„å·¥ä½œï¼Œè¿™æ ·æ‰å¤Ÿæ•ˆç‡ã€‚ä¸Šä¸€ç« æˆ‘ä»¬ç”¨çš„<code>requests</code>åº“ä¸æ”¯æŒè¿™ä¸€ç§æœºåˆ¶ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç¬¬ä¸‰æ–¹çš„<code>aiohttp</code>åº“ï¼Œå®Œæˆè¿™ä¸ªéœ€æ±‚ã€‚</p>
<h3 id="è·å–ä»£ç†æ± "><a href="#è·å–ä»£ç†æ± " class="headerlink" title="è·å–ä»£ç†æ± "></a>è·å–ä»£ç†æ± </h3><p>HTTPè¯·æ±‚æ”¯æŒæˆ‘ä»¬é€šè¿‡ä»£ç†å‘é€æ•°æ®ï¼Œä½¿å¾—ç›®æ ‡è¯†åˆ«å‘é€æºä¸ºä»£ç†æœåŠ¡å™¨ã€‚è¦çŸ­æ—¶é—´è·å–å¤§é‡çš„ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œå¾ˆç®€å•ï¼Œéšä¾¿æ‰¾ä¸ªæ¯”å¦‚<span class="exturl" data-url="aHR0cHM6Ly93d3cueGljaWRhaWxpLmNvbS8=" title="https://www.xicidaili.com/">è¥¿åˆºä»£ç†<i class="fa fa-external-link"></i></span>æˆ–è€…<span class="exturl" data-url="aHR0cDovL3d3dy42NmlwLmNuL3B0Lmh0bWw=" title="http://www.66ip.cn/pt.html">66ä»£ç†<i class="fa fa-external-link"></i></span>ï¼Œåˆ©ç”¨å†…ç½®æŸ¥è¯¢ï¼Œæˆ–è€…HTMLè§£æçˆ¬å–ä¸€å †ï¼Œæä¸ªä¸€ä¸¤åƒä¸ªå°±å¥½ã€‚</p>
<h3 id="ä»£ç†æœåŠ¡å™¨åˆ†é…"><a href="#ä»£ç†æœåŠ¡å™¨åˆ†é…" class="headerlink" title="ä»£ç†æœåŠ¡å™¨åˆ†é…"></a>ä»£ç†æœåŠ¡å™¨åˆ†é…</h3><p>åœ¨æˆ‘ä»¬çš„äººæµ·æˆ˜æœ¯é‡Œï¼Œæ¯ä¸€ä¸ªçˆ¬è™«ä»»åŠ¡å¼€å§‹å‰ï¼Œéƒ½éœ€è¦åˆ†é…åˆ°ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ã€‚æ‰€ä»¥é—®é¢˜æ¥äº†â€”â€”ä»£ç†æœåŠ¡å™¨ï¼Œè¯¥æ€ä¹ˆåˆ†é…ç»™æ¯ä¸€ä¸ªä»»åŠ¡å‘¢ï¼Ÿæˆ‘ä»¬å¸Œæœ›ï¼Œæ¯ä¸€ä¸ªä»»åŠ¡éƒ½åƒè¢«ç­‰å¾…ç‚¹åä¸€æ ·ï¼Œå¦‚æœæœ‰å¯ç”¨çš„ä»£ç†æœåŠ¡å™¨å°±æŒ‘å‡ ä¸ªä»»åŠ¡å»ç”¨ï¼Œå¦‚æœæš‚æ—¶èƒ½ç”¨çš„ä»£ç†æœåŠ¡å™¨éƒ½åœ¨ç”¨çš„è¯ï¼Œå°±æ­‡ä¸€ä¼šå„¿ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœæ²¡æœ‰ä»£ç†æœåŠ¡å™¨èƒ½ç”¨ï¼Œå°±å‡‰å‡‰äº†= =</p>
<p>å¾—ç›Šäº<code>asyncio</code>åº“æä¾›æ¡ä»¶å˜é‡ï¼ˆCondition Variableï¼‰çš„æœºåˆ¶ï¼Œå¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚éœ€è¦è·å¾—èµ„æºçš„ä»»åŠ¡ï¼Œå°±å»ç­‰å¾…ï¼ˆwaitï¼‰èµ„æºåˆ†é…å™¨çš„é€šçŸ¥ï¼Œèµ„æºåˆ†é…å™¨å‘ç°èµ„æºå¯ç”¨ï¼Œåˆ™å»é€šçŸ¥ï¼ˆnotifyï¼‰é‚£äº›è¿«ä¸åŠå¾…çš„ä»»åŠ¡ï¼Œå«ä»–ä»¬èµ¶ç´§è·å–èµ„æºå»ã€‚å…·ä½“å¦‚ä½•æ“ä½œï¼Ÿä¸”è®©æˆ‘å¾å¾é“æ¥~</p>
<p>é¦–å…ˆï¼Œåœ¨çˆ¬è™«ä»»åŠ¡å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—æŠŠâ€œè·å–ä»£ç†æ± â€ä¸€æ­¥æ‹¿åˆ°çš„ä»£ç†æœåŠ¡å™¨åˆ—è¡¨ï¼Œæ”¾åˆ°å’±ä»¬å†…å­˜é‡Œã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"> <span class="comment"># åˆå§‹åŒ–æ¡ä»¶å˜é‡</span></span><br><span class="line">cond = <span class="literal">None</span></span><br><span class="line"><span class="comment"># ä»£ç†é˜Ÿåˆ—é‡‡ç”¨deque()æ•°æ®ç»“æ„ï¼Œå¤´å°¾éƒ½å¯ä»¥æ·»åŠ /åˆ é™¤ï¼Œä¾¿äºä»£ç†é‡å¤åˆ©ç”¨</span></span><br><span class="line">proxies = deque()</span><br><span class="line"><span class="comment"># å­˜æ”¾å½“å‰æ­£åœ¨ä½¿ç”¨çš„ä»£ç†ï¼Œå¦‚æœåŒæ—¶è¢«å¤šä¸ªä»»åŠ¡ç”¨çš„è¯ï¼Œå°å¿ƒè¢«è±†ç“£å°= =</span></span><br><span class="line">proxies_used = set()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_proxies</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è·å–å­˜å¥½çš„ä»£ç†æœåŠ¡å™¨åˆ—è¡¨</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    contents = open(<span class="string">'proxies.txt'</span>, encoding=<span class="string">'utf-8'</span>).read().splitlines()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(contents)):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> contents[i].startswith(<span class="string">'http'</span>):</span><br><span class="line">            contents[i] = <span class="string">'http://'</span> + contents[i]</span><br><span class="line">    proxies.extend(set(contents))</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œå¼€å§‹æ·»åŠ æˆ‘ä»¬çš„ä»»åŠ¡å•¦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºç”¨äºå‘é€HTTPè¯·æ±‚çš„å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">    <span class="comment"># ç”µå½±æ•°é‡</span></span><br><span class="line">    num_urls = len(movie_urls)</span><br><span class="line">    <span class="comment"># åˆå§‹åŒ–æ¡ä»¶å˜é‡Condition Variable</span></span><br><span class="line">    <span class="keyword">global</span> cond</span><br><span class="line">    cond = asyncio.Condition()</span><br><span class="line">    <span class="comment"># æ·»åŠ ä»»åŠ¡å•¦~</span></span><br><span class="line">    tasks = list()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_urls):</span><br><span class="line">        <span class="comment"># crawl_movie_urlå°±æ˜¯æˆ‘ä»¬çˆ¬è™«ä»»åŠ¡çš„æ¨¡ç‰ˆå•¦ï¼Œå…·ä½“è§ä¸‹é¢</span></span><br><span class="line">        tasks.append(crawl_movie_url(session, movie_urls[i], i + <span class="number">1</span>))</span><br><span class="line">    <span class="comment"># æœ€åä¸€ä¸ªå¯åŠ¨çš„ä»»åŠ¡æ˜¯å’±ä»¬çš„ä»£ç†åˆ†é…æ¨¡å—ï¼šallocate_proxy</span></span><br><span class="line">    tasks.append(allocate_proxy(len(tasks)))</span><br><span class="line">    <span class="comment"># å¼€å§‹æŠŠè¿™å †ä»»åŠ¡è·‘èµ·æ¥ï¼Œèµ°ä½ ~</span></span><br><span class="line">    <span class="keyword">await</span> asyncio.gather(*tasks)</span><br></pre></td></tr></table></figure>
<p>å¯¹äºæ¯ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éƒ½åšæˆä¸€ä¸ªå¾ªç¯ï¼ˆloopï¼‰ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆæˆ–è€…æ²¡æœ‰ä»£ç†æœåŠ¡å™¨å¯ç”¨ï¼Œæ‰é€€å‡ºä¸å¹²ã€‚å› æ­¤ï¼Œçˆ¬è™«ä»»åŠ¡çš„åˆå§‹é€»è¾‘å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åŠ äº†asyncï¼Œè¡¨ç¤ºè¿™ä¸ªå‡½æ•°ä¸Šå‡ä¸ºä¸€ä¸ªå¯è¢«asyncioæ¨¡å—è°ƒåº¦çš„ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">crawl_movie_url</span><span class="params">(session, url, movie_num)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># åŠ äº†awaitï¼Œè¯¥ä»»åŠ¡å°±æ­‡äº†ï¼Œä¿å­˜è¯¥ä»»åŠ¡çŠ¶æ€ï¼ŒCPUæ‰§è¡Œæƒäº¤ç»™å…¶å®ƒä»»åŠ¡</span></span><br><span class="line">        <span class="comment"># ç›´åˆ°get_proxyæœ‰ç»“æœæ‰è¢«asyncioè°ƒåº¦å™¨å”¤é†’</span></span><br><span class="line">        proxy = <span class="keyword">await</span> get_proxy()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> proxy:</span><br><span class="line">            log(movie_num, <span class="string">'TMDä»£ç†å…¨éƒ¨æŒ‚äº†ï¼Œå‡‰å‡‰= ='</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># å¼€å§‹æ‰§è¡Œçˆ¬è™«ä»»åŠ¡å•¦ï¼Œå…·ä½“åé¢è¯´= =</span></span><br><span class="line">        <span class="keyword">await</span> set_proxy_in_use(proxy)</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>å¯¹äºæ¯ä¸€ä¸ªä»»åŠ¡æ¥è®²ï¼Œè¯¥å¦‚ä½•è·å–ä»£ç†æœåŠ¡å™¨å‘¢ï¼Ÿå’±ä»¬çš„<code>get_proxy</code>ä»»åŠ¡ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">get_proxy</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># cond.acquire()è·Ÿcond.release()ï¼Œå¯ä»¥å®ç°å¯¹ä¸€æ®µå‘½ä»¤çš„åŠ è§£é”ï¼ˆLockï¼‰</span></span><br><span class="line">    <span class="comment"># å°±å¦‚åŒä¸Šå•æ‰€ä¸€æ ·ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œåˆ°åŠ é”çš„ä¸€æ®µï¼Œå¦‚æœå¦ä¸€ä¸ªä»»åŠ¡ä¹Ÿæ‰§è¡Œåˆ°è¿™ä¸€æ®µï¼Œå°±ä¼šæš‚åœæŒ‚èµ·ï¼Œç­‰å¾…æ’é˜Ÿ</span></span><br><span class="line">    <span class="comment"># proxiesè·Ÿproxies_usedæ˜¯æ¯ä¸ªä»»åŠ¡å…±äº«çš„å…¨å±€å˜é‡ï¼ˆGlobal Variableï¼‰ï¼Œå¯¹äºå…±äº«å˜é‡çš„æ“ä½œï¼Œæ˜¯è¦åŠ é”çš„</span></span><br><span class="line">    <span class="comment"># å¦‚æœä»£ç†å°±å‰©ä¸€ä¸ªï¼Œç„¶åä¸¤ä¸ªä»»åŠ¡éƒ½è·‘åˆ°è¿™ä¸€æ®µï¼Œé‚£å°±å‡ºäº‹äº†= =</span></span><br><span class="line">    <span class="keyword">await</span> cond.acquire()</span><br><span class="line">    proxy = <span class="string">''</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># ç­‰å¾…ä»£ç†åˆ†é…å™¨é€šçŸ¥= =</span></span><br><span class="line">        <span class="comment"># ä»£ç†åˆ†é…å™¨ä¼šåœ¨æœ‰å¯ç”¨ä»£ç†ï¼Œæˆ–è€…ä»£ç†å…¨éƒ¨å‡‰å‡‰çš„æ—¶å€™å”¤é†’è¿™äº›ç­‰å¾…è€…</span></span><br><span class="line">        <span class="keyword">await</span> cond.wait()</span><br><span class="line">        <span class="comment"># å¦‚æœæœ‰å¯ç”¨ä»£ç†ï¼Œå°±æŒ‘ä¸€ä¸ªï¼Œæ²¡æœ‰å°±ç›´æ¥è¿”å›ç©ºå­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="comment"># å¯ä»¥çœ‹ä¸Šé¢çš„crawl_movie_urlä»»åŠ¡ï¼Œç›´æ¥å‡‰å‡‰= =</span></span><br><span class="line">        <span class="keyword">if</span> len(proxies) &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="comment"># ä»ä»£ç†é˜Ÿåˆ—å¤´éƒ¨å–å‡ºä¸€ä¸ªä»£ç†</span></span><br><span class="line">            proxy = proxies.popleft()</span><br><span class="line">            <span class="comment"># æŠŠè¿™ä¸ªä»£ç†åŠ åˆ°æ­£åœ¨ä½¿ç”¨çš„ä»£ç†é›†åˆä¸­</span></span><br><span class="line">            proxies_used.add(proxy)</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        cond.release()</span><br><span class="line">    <span class="keyword">return</span> proxy</span><br></pre></td></tr></table></figure>
<p>é¢å¯¹è¿™ç¾¤å—·å—·å¾…å“ºçš„ä»»åŠ¡ä»¬ï¼Œæˆ‘ä»¬çš„ä»£ç†æœåŠ¡å™¨åˆ†é…ä»»åŠ¡<code>allocate_proxy</code>ï¼Œå°±å¯ä»¥è¿™æ ·è®¾è®¡äº†</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">allocate_proxy</span><span class="params">(max_tasks)</span>:</span></span><br><span class="line">    <span class="comment"># ä»£ç†åˆ†é…ä»»åŠ¡ï¼Œæœ¬èº«å°±ç›¸å½“äºä¸€ä¸ªæœåŠ¡ï¼Œå› æ­¤è¿™é‡Œé‡‡ç”¨å¾ªç¯çš„æ–¹å¼æ¥è®¾è®¡</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># ä¸Šé”ï¼ŒåŠ³èµ„è¦ç»™åˆ«çš„ä»»åŠ¡åˆ†é…ä»£ç†äº†</span></span><br><span class="line">        <span class="comment"># è€Œä¸”è¿˜å¾—çœ‹ä»£ç†é˜Ÿåˆ—å‘¢ï¼Œå…¶ä»–ä»»åŠ¡å…ˆåˆ«ç€æ€¥= =</span></span><br><span class="line">        <span class="keyword">await</span> cond.acquire()</span><br><span class="line">        will_break = <span class="literal">False</span>  <span class="comment"># æ˜¯å¦é€€å‡ºä»£ç†åˆ†é…ä»»åŠ¡</span></span><br><span class="line">        will_delay = <span class="literal">False</span>  <span class="comment"># ä¸‹ä¸€ä¸ªå¾ªç¯æ˜¯å¦è¦å»¶è¿Ÿé•¿ä¸€ç‚¹</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> task_count == max_tasks:</span><br><span class="line">                <span class="comment"># task_countæŒ‡å½“å‰å®Œæˆçš„çˆ¬è™«ä»»åŠ¡æ•°</span></span><br><span class="line">                <span class="comment"># å¦‚æœåˆ°äº†æœ€å¤§å€¼ï¼Œè¯´æ˜å…¨éƒ¨ä»»åŠ¡éƒ½ç»“æŸäº†</span></span><br><span class="line">                <span class="comment"># è¿™ä¸ªæ—¶å€™ä»£ç†åˆ†é…ä»»åŠ¡ä¹Ÿå°±å®Œæˆä»»åŠ¡äº†</span></span><br><span class="line">                will_break = <span class="literal">True</span></span><br><span class="line">            <span class="comment"># çœ‹ä»£ç†é˜Ÿåˆ—è¿˜æœ‰æœ¨æœ‰å¯ç”¨çš„</span></span><br><span class="line">            len_proxies = len(proxies)</span><br><span class="line">            <span class="keyword">if</span> len_proxies == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">if</span> len(proxies_used) == <span class="number">0</span>:</span><br><span class="line">                    <span class="comment"># ä»£ç†é˜Ÿåˆ—æ²¡ä»£ç†ï¼Œè¿tmæ­£åœ¨ç”¨çš„ä»£ç†ä¹Ÿæ˜¯ç©ºçš„ï¼Œå²‚ä¸æ˜¯å‡‰å‡‰= =</span></span><br><span class="line">                    <span class="comment"># æŠŠè¿™ä¸ªå¯æ€•çš„ä¿¡æ¯å‘Šè¯‰ç»™æ‰€æœ‰ä»»åŠ¡å§= =ç„¶ååŠ³èµ„ä¹Ÿè·‘è·¯= =</span></span><br><span class="line">                    cond.notify_all()</span><br><span class="line">                    will_break = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="comment"># ä»£ç†éƒ½åœ¨ç”¨ç€å‘¢ï¼Œç­‰å¤šä¸€ä¼šå„¿å†ç»™å¤§å®¶åˆ†é…å§= =</span></span><br><span class="line">                    will_delay = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># ä»£ç†é˜Ÿåˆ—æœ‰å¤šå°‘ä»£ç†ï¼Œæœ€å¤šé€šçŸ¥å¤šå°‘ä¸ªä»»åŠ¡å»æ‹¿ä»£ç†å»</span></span><br><span class="line">                cond.notify(len_proxies)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            cond.release()</span><br><span class="line">            <span class="keyword">if</span> will_break:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> will_delay:</span><br><span class="line">                <span class="comment"># æ­‡å¤šå‡ ç§’ï¼Œå†åˆ†é…ä»£ç†ç»™å…¶å®ƒå—·å—·å¾…å“ºçš„ä»»åŠ¡</span></span><br><span class="line">                <span class="comment"># ç›¸å½“äºçˆ¬è™«è®¿é—®ç½‘é¡µçš„æ—¶é—´é—´éš”è®¾ç½®</span></span><br><span class="line">                <span class="comment"># è±†ç“£ç™½å¤©2så·¦å³æ™šä¸Š3~4så·¦å³å·®ä¸å¤š</span></span><br><span class="line">                <span class="keyword">await</span> asyncio.sleep(get_proxy_delay_time())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># æ­‡ä¸€ä¸¢ä¸¢æ—¶é—´ï¼ŒæŠŠè‡ªå·±æ’åœ¨ä»»åŠ¡è°ƒåº¦åé¢</span></span><br><span class="line">                <span class="comment"># ä¸ç„¶while Trueæ­»å¾ªç¯ï¼Œåˆ«çš„ä»»åŠ¡å°±è·‘ä¸äº†äº†</span></span><br><span class="line">                <span class="keyword">await</span> asyncio.sleep(proxy_search_period)</span><br></pre></td></tr></table></figure>
<h2 id="çˆ¬è™«ä¸»ä»»åŠ¡"><a href="#çˆ¬è™«ä¸»ä»»åŠ¡" class="headerlink" title="çˆ¬è™«ä¸»ä»»åŠ¡"></a>çˆ¬è™«ä¸»ä»»åŠ¡</h2><p>æœ‰äº†ä»£ç†åˆ†é…è¿™ä¸ªå¼ºåŠ²çš„åç›¾ï¼Œæˆ‘ä»¬çš„çˆ¬è™«ä»»åŠ¡å°±å¯ä»¥é¡ºåˆ©è¿›è¡Œå•¦ï¼</p>
<p>å…è´¹çš„ä»£ç†å¥½å¤šéƒ½æ²¡æ³•ç”¨çš„ï¼Œéœ€è¦åœ¨çˆ¬è™«çš„è¿‡ç¨‹ä¸­ä¸æ–­èˆå¼ƒã€‚åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">crawl_movie_url</span><span class="params">(session, url, movie_num)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># è¿™æ®µä¸Šé¢è®²äº†= =</span></span><br><span class="line">        proxy = <span class="keyword">await</span> get_proxy()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> proxy:</span><br><span class="line">            log(movie_num, <span class="string">'TMDä»£ç†å…¨éƒ¨æŒ‚äº†ï¼Œå‡‰å‡‰= ='</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># resultå­˜å‚¨çˆ¬å–çš„æ•°æ®ï¼Œlogå‡½æ•°æ‰“å°æ—¥å¿—ï¼ˆå¾—è‡ªå®šä¹‰å®ç°= =ï¼‰</span></span><br><span class="line">        result = &#123;<span class="string">'number'</span>: movie_num, <span class="string">'url'</span>: url, <span class="string">'proxy'</span>: proxy&#125;</span><br><span class="line">        log(movie_num, <span class="string">'ä»£ç†%sæ­£åœ¨è®¿é—®%s...'</span> % (proxy, url))</span><br><span class="line">        success = <span class="literal">True</span>  <span class="comment"># æ˜¯å¦çˆ¬å–æˆåŠŸçš„æ ‡å¿—</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># ç”¨getè·å–æ•°æ®ï¼Œåˆ¤æ–­çŠ¶æ€ç ï¼Œè€Œåè§£ææ•°æ®</span></span><br><span class="line">            response = <span class="keyword">await</span> session.get(url, proxy=proxy, headers=headers, timeout=proxy_connection_timeout)</span><br><span class="line">            status_code = response.status</span><br><span class="line">            <span class="keyword">if</span> status_code == <span class="number">200</span>:</span><br><span class="line">                html = <span class="keyword">await</span> response.text()</span><br><span class="line">                soup = BeautifulSoup(html, html_parser)</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> content_func_map.keys():</span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="comment"># æŒ‰æœ€å¼€å§‹è®¾çš„çˆ¬å–è§„åˆ™æŠ“æ•°æ®ï¼Œå­˜åˆ°resulté‡Œ</span></span><br><span class="line">                        content = content_func_map[k](soup)</span><br><span class="line">                        result[k] = content</span><br><span class="line">                    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                        <span class="comment"># å¦‚æœçˆ¬ä¸äº†ï¼Œå¾ˆæœ‰å¯èƒ½getåˆ°çš„ç½‘é¡µå˜äº†ï¼</span></span><br><span class="line">                        <span class="comment"># æ¯”å¦‚å«ä½ ç™»å½•å•¥å•¥çš„ï¼Œè¿™è¯´æ˜ä»£ç†è¢«è±†ç“£ä¸´æ—¶å°é»‘å±‹äº†ï¼Œæœæ–­æ”¾å¼ƒè¿™ä¸ªä»£ç†</span></span><br><span class="line">                        log(movie_num, <span class="string">'ä»£ç†%sçˆ¬å–%sä¿¡æ¯å¤±è´¥ï¼æœæ–­æ”¾å¼ƒæ‰ï¼é”™è¯¯ä¿¡æ¯ï¼š%s\n'</span> % (proxy, k, e))</span><br><span class="line">                        success = <span class="literal">False</span></span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                   <span class="comment"># å¦‚æœçŠ¶æ€ç ä¸å¯¹ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯400å•¥çš„ï¼Œè¯´æ˜ä¹Ÿè¢«è±†ç“£å°é»‘å±‹äº†ï¼Œæœæ–­æ”¾å¼ƒæ‰è¿™ä¸ªä»£ç†</span></span><br><span class="line">                log(movie_num, <span class="string">'ä»£ç†%sè·å–æ•°æ®å¤±è´¥ï¼æœæ–­æ”¾å¼ƒæ‰ï¼çŠ¶æ€ç : %dï¼'</span> % (proxy, status_code))</span><br><span class="line">                success = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="comment"># ä»£ç†é“¾æ¥æˆ–è€…ä»£ç†å‘é€è¯·æ±‚éƒ½æœ‰é—®é¢˜ï¼Œæœæ–­ä¸è¦äº†</span></span><br><span class="line">            log(movie_num, <span class="string">'ä»£ç†%sè¿æ¥å‡ºé”™ï¼Œæœæ–­æ”¾å¼ƒæ‰ï¼ï¼ï¼é”™è¯¯ä¿¡æ¯ï¼š%sï¼'</span> % (proxy, e))</span><br><span class="line">            success = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">if</span> success:</span><br><span class="line">                <span class="comment"># æˆåŠŸçˆ¬å–æ•°æ®ï¼ŒæŠŠçˆ¬å–ç»“æœåŠ ä¸Šï¼ŒæŠŠä»»åŠ¡å®Œæˆæ•°åŠ ä¸Š</span></span><br><span class="line">                <span class="keyword">global</span> results</span><br><span class="line">                <span class="keyword">global</span> task_count</span><br><span class="line">                results.append(result)</span><br><span class="line">                task_count = task_count + <span class="number">1</span></span><br><span class="line">                log(movie_num, <span class="string">'å½“å‰çˆ¬åˆ°ä¿¡æ¯çš„ç”µå½±æ•°: %dï¼Œçˆ¬åˆ°ä¿¡æ¯ï¼š%s'</span> % (task_count, str(result)))</span><br><span class="line">                <span class="comment"># è¿™ä¸ªä»£ç†è¿˜èƒ½ç”¨ï¼Œç»™åŠ›ï¼proxies_usedé‡Œåˆ æ‰å®ƒ</span></span><br><span class="line">                <span class="comment"># ç„¶åæŠŠå®ƒæ”¾åˆ°proxiesçš„å°¾éƒ¨ï¼ˆappendï¼‰</span></span><br><span class="line">                <span class="keyword">await</span> recycle_proxy(proxy)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># è¿™ä¸ªä»£ç†ä¸ç»™åŠ›ï¼Œç›´æ¥ä»proxies_usedåˆ æ‰å§~</span></span><br><span class="line">                <span class="keyword">await</span> remove_proxy(proxy)</span><br></pre></td></tr></table></figure>
<p>è¯•è¯•çœ‹å§~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è±†ç“£Top 250çˆ¬è™«ï¼Œå…¶å®æ›´å¤šçš„éš¾ç‚¹ï¼Œåœ¨äºå¦‚ä½•ç»„ç»‡ã€è°ƒåº¦ä½ çš„èµ„æºï¼Œæ›´æœ‰æ•ˆç‡åœ°å¤„ç†æ•°æ®ã€‚çˆ¬è™«çš„å·¥å…·ã€è½¯ä»¶ï¼Œå…¶å®éƒ½å·²ç»çƒ‚å¤§è¡—</p>
<p>å¯¹äºè½¯ä»¶ï¼Œé›†æœå®¢ã€å…«çˆªé±¼ä¹‹ç±»çš„å°±èƒ½å®Œæˆéœ€æ±‚</p>
<p>å¯¹äºä»£ç†æ± ï¼Œgithubä¸Šå°±æœ‰è®¸å¤šé¡¹ç›®å¯ä»¥cloneä¸‹æ¥å»è·å¾—</p>
<p>å¯¹äºçˆ¬è™«æ¡†æ¶ï¼Œå…¶å®å¯ä»¥è¸©è¸©<code>scrapy</code>åº“çš„å‘ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸æˆç†Ÿçš„çˆ¬è™«æ¡†æ¶</p>
<p>å¯¹äºè·å–å¼‚æ­¥åŠ è½½ï¼ˆä¸æ˜¯å½“å³å°±åœ¨responseé‡Œï¼Œè€Œæ˜¯åé¢æ‰åŠ è½½åˆ°ï¼‰çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<span class="exturl" data-url="aHR0cDovL3BoYW50b21qcy5vcmcv" title="http://phantomjs.org/">PhantomJS<i class="fa fa-external-link"></i></span>ä¸€ç±»çš„å·¥å…·ï¼Œæˆ–è€…åˆ©ç”¨Chromeå¼€å‘è€…å·¥å…·ï¼Œé‡‡ç”¨æŠ“åŒ…+æ¨¡æ‹ŸHTTPè¯·æ±‚çš„æ–¹å¼ï¼Œè·å–ç›¸åº”æ•°æ®ã€‚</p>
<p>æœ€åä»‹ç»ä¸€ä¸ªå¤§æ€å™¨â€”â€”<span class="exturl" data-url="aHR0cHM6Ly9zZWxlbml1bS1weXRob24ucmVhZHRoZWRvY3MuaW8v" title="https://selenium-python.readthedocs.io/">Selenium<i class="fa fa-external-link"></i></span>ï¼Œä½œä¸ºä¸€æ¬¾æµè§ˆå™¨æµ‹è¯•é©±åŠ¨ï¼Œseleniumç”šè‡³å¯ä»¥æ¨¡æ‹Ÿæµè§ˆå™¨æ“ä½œï¼Œç™¾è¯•ä¸çˆ½ï¼Œè°ç”¨è°çŸ¥é“ï¼</p>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>å¼‚æ­¥</tag>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>ä»£ç†</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘ç¬¬ä¸‰è¯ï¼šçˆ¬è™«åˆæ¢â€”â€”ç©è½¬è±†ç“£äºŒç™¾äº”ï¼ˆä¸Šï¼‰</title>
    <url>/2019/03/31/easypython/iii/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€ç›´ä»¥æ¥ï¼Œçˆ¬è™«éƒ½æ˜¯è®¸å¤šåŒå­¦å­¦Pythonçš„ç›®çš„ä¹‹ä¸€ï¼Œå°±è¿æˆ‘æ•¬çˆ±çš„é¢†å¯¼ï¼Œä¹Ÿç»å¸¸ä¸è€»ä¸‹é—®ä¸€äº›çˆ¬è™«æ–¹é¢çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¼€å§‹å®æˆ˜â€”â€”ä»¥<span class="exturl" data-url="aHR0cHM6Ly9tb3ZpZS5kb3ViYW4uY29tL3RvcDI1MA==" title="https://movie.douban.com/top250">è±†ç“£Top 250<i class="fa fa-external-link"></i></span>ä¸ºä¾‹ï¼Œè¯•æ°´ä¸€ä¸‹åŸºç¡€çš„çˆ¬è™«ã€‚</p>
<p>â€œç©è½¬è±†ç“£äºŒç™¾äº”â€ç³»åˆ—åˆ†ä¸ºä¸Šä¸‹ä¸¤éƒ¨ï¼Œæ‰€æœ‰ä»£ç ï¼Œå¯ä»¥åœ¨æˆ‘çš„Githubé‡Œ<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9Eb3ViYW5fMjUw" title="https://github.com/utmhikari/Douban_250">Douban_250<i class="fa fa-external-link"></i></span>æ‰¾åˆ°~</p>
<p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚ä»¥ä¸‹æµè§ˆå™¨æ“ä½œï¼Œéƒ½åŸºäºæœ€æ–°ç‰ˆChrome~</p>
<h2 id="è·å–ç”µå½±åˆ—è¡¨ç½‘é¡µæ•°æ®"><a href="#è·å–ç”µå½±åˆ—è¡¨ç½‘é¡µæ•°æ®" class="headerlink" title="è·å–ç”µå½±åˆ—è¡¨ç½‘é¡µæ•°æ®"></a>è·å–ç”µå½±åˆ—è¡¨ç½‘é¡µæ•°æ®</h2><p>çˆ¬è™«çˆ¬è™«ï¼Œå®è´¨è¿˜æ˜¯æŠ“å–ç½‘ç»œæ•°æ®= =çˆ¬è™«ä¸å¾—æ€¥ï¼Œå¯è¦ä¸€æ­¥æ­¥æ¥â€”â€”é¦–å…ˆï¼Œæˆ‘ä»¬å¸Œæœ›è·å¾—æ¯ä¸€ä¸ªç”µå½±çš„é“¾æ¥ï¼ŒæŠŠå®ƒä»¬å­˜èµ·æ¥ï¼Œç•™ç€åç»­çˆ¬å–å…·ä½“å†…å®¹å¤‡ç”¨ã€‚</p>
<p>æ‰“å¼€<span class="exturl" data-url="aHR0cHM6Ly9tb3ZpZS5kb3ViYW4uY29tL3RvcDI1MA==" title="https://movie.douban.com/top250">è±†ç“£Top 250é¦–é¡µ<i class="fa fa-external-link"></i></span>ï¼Œä¼šçœ‹åˆ°ç”µå½±åˆ—è¡¨çš„é¡µé¢ï¼Œå¾€ä¸‹ç¿»ï¼Œä¼šçœ‹åˆ°æ€»å…±æœ‰10é¡µï¼Œæ¯é¡µ25ä¸ªç”µå½±ã€‚æ‰“å¼€ç¬¬äºŒé¡µï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨çš„åœ°å€å˜æˆäº†<code>https://movie.douban.com/top250?start=25&amp;filter=</code>ï¼Œå’±ä»¬è§‚å¯Ÿä¸€ä¸‹é“¾æ¥â€”â€”é“¾æ¥æœ‰ä¸€éƒ¨åˆ†ï¼Œ<code>start=25</code>ï¼Œæ˜¯ä¸æ˜¯å¾ˆçªå…€ï¼ŸæŒ‰è¿™æ ·æ¨ç®—ï¼Œç¬¬ä¸‰é¡µåº”è¯¥æ˜¯<code>start=50</code>ï¼Œç¬¬ä¸€é¡µå°±æ˜¯<code>start=0</code>å˜›= =è¯•äº†ä¸€ä¸‹ï¼ŒæœçœŸæ˜¯çš„= =</p>
<p>å› æ­¤ï¼Œçˆ¬å–250ä¸ªç”µå½±é“¾æ¥ï¼Œä¸éš¾è§„åˆ’ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<ul>
<li>æ‰“å¼€10ä¸ªç”µå½±åˆ—è¡¨é¡µé¢â€”â€”<code>https://movie.douban.com/top250?start=$movie_num&amp;filter=</code>ï¼Œå…¶ä¸­<code>$movie_num</code>æ˜¯<code>25 * (é¡µæ•° - 1)</code></li>
<li>è·å–10ä¸ªé¡µé¢çš„ç½‘é¡µå†…å®¹â€”â€”æˆ‘ä»¬éƒ½çŸ¥é“ç‚¹å‡»ç”µå½±åå°±èƒ½è¿›åˆ°ç”µå½±é“¾æ¥é‡Œï¼Œé‚£ä¹ˆç”µå½±é“¾æ¥åœ¨ç½‘é¡µå†…å®¹çš„æ¦‚ç‡å°±å¾ˆå¤§</li>
<li>è§£æç½‘é¡µå†…å®¹ï¼Œæå–é“¾æ¥ä¿¡æ¯</li>
</ul>
<p>å› æ­¤ï¼Œæ¯ä¸€é¡µçš„é“¾æ¥ï¼Œå¯ä»¥å¦‚ä¸‹è¡¨ç¤ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_start_url</span><span class="params">(page)</span>:</span></span><br><span class="line">    <span class="comment"># page = 0 ç›¸å½“äºç¬¬ä¸€é¡µ</span></span><br><span class="line">    start_num = <span class="number">25</span> * page</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'https://movie.douban.com/top250?start=%d&amp;filter='</span> % start_num</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦è·å–è¿™äº›æ¯ä¸€é¡µçš„ç½‘é¡µä¿¡æ¯äº†â€”â€”è¦è·å–ä¿¡æ¯ï¼Œå°±æ¶‰åŠåˆ°äº¤æµï¼Œè¦äº¤æµï¼Œå°±è¦æœ‰å…±åŒçš„è¯­è¨€ï¼Œçº¦å®šä¿—æˆçš„æ•°æ®æ ¼å¼â€”â€”æˆ‘ä»¬å¯ç§°ä¹‹ä¸ºåè®®ï¼ˆProtocolï¼‰ã€‚è·å–ç½‘é¡µä¿¡æ¯ï¼Œæˆ‘ä»¬å°±å¸¸ç”¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼ˆHTTPï¼‰ï¼Œå¦‚æœéœ€è¦è¿›ä¸€æ­¥ä¿è¯ä¼ è¾“æ•°æ®çš„å®‰å…¨æ€§ï¼Œå°±é‡‡ç”¨è¶…æ–‡æœ¬ä¼ è¾“å®‰å…¨åè®®ï¼ˆHTTPSï¼‰ï¼Œæ˜¯HTTPçš„æ‰©å±•ã€‚è±†ç“£çš„é“¾æ¥ä»¥httpså¼€å¤´ï¼Œå¯è§æ˜¯é‡‡ç”¨äº†HTTPSä½œä¸ºæ•°æ®ä¼ è¾“çš„åè®®ã€‚</p>
<p>å¯¹äºä¸€ä¸ªç½‘ç«™æ¥è¯´ï¼Œæ¯ä¸€ä¸ªç½‘é¡µï¼Œéƒ½åªæ˜¯ä¸€ç§èµ„æºï¼ˆResourceï¼‰ã€‚èµ„æºçš„é“¾æ¥ï¼Œä¸è®ºæ˜¯æ‰€è°“çš„ç½‘é¡µï¼Œè¿˜æ˜¯ä»€ä¹ˆç§å­ä¸‹è½½åœ°å€ï¼Œéƒ½å½’å±äºä¸€ä¸ªæ¦‚å¿µâ€”â€”ç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼ˆURLï¼‰ã€‚é€šå¸¸æ¥è®²ï¼Œå¦‚æœæœåŠ¡å™¨å…è®¸çš„è¯ï¼Œæˆ‘ä»¬é‡‡ç”¨HTTPæˆ–è€…HTTPSçš„æ•°æ®æ ¼å¼ï¼Œé‡‡ç”¨åè®®çº¦å®šçš„GETè¯·æ±‚æ–¹å¼ï¼ˆRequest Methodï¼‰è®¿é—®ä¸€ä¸ªURLï¼Œå°±å¯ä»¥è·å–è¯¥URLä¸‹ç›¸åº”çš„èµ„æºã€‚ç›¸åº”åœ°ï¼Œå¯¹è±†ç“£äºŒç™¾äº”æ¯ä¸€é¡µçš„URLå‘å‡ºGETè¯·æ±‚ï¼Œå°±åº”å½“å¯ä»¥è·å–åˆ°ç½‘é¡µçš„å†…å®¹ã€‚</p>
<p>å› æ­¤é¦–å…ˆï¼Œæˆ‘ä»¬å»ç»™ä¸Šè¿°æ‰€æœ‰ç”µå½±åˆ—è¡¨é¡µé¢å‘è¯·æ±‚ï¼Œè·å–æ‰€æœ‰ç½‘é¡µæ•°æ®ã€‚åœ¨python3é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡requestsåº“å‘é€http/httpsè¯·æ±‚ï¼Œè·å¾—è¯·æ±‚çš„å“åº”ï¼ˆResponseï¼‰æ•°æ®ï¼Œæå–ç½‘é¡µä¿¡æ¯ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    url = get_start_url(i)  <span class="comment"># å°±ç”¨ä¸Šé¢è¯´çš„get_start_urlå‡½æ•°</span></span><br><span class="line">    response = requests.get(url)</span><br><span class="line">    <span class="comment"># HTTP/HTTPSåè®®é‡Œï¼Œresponseæ•°æ®çš„ä¸åŒçŠ¶æ€ç ï¼ˆstatus codeï¼‰æœ‰ä¸åŒå«ä¹‰</span></span><br><span class="line">    <span class="comment"># ä¸€èˆ¬2å­—å¤´è¡¨ç¤ºæ•´ä¸ªè¯·æ±‚&amp;å“åº”æ•°æ®è¿‡ç¨‹æˆåŠŸè¿›è¡Œï¼Œ200æœ€å¸¸è§</span></span><br><span class="line">    <span class="comment"># 4å­—å¤´è¡¨ç¤ºè¯·æ±‚æœ‰é—®é¢˜ï¼Œæ— æ³•è·å¾—æƒ³è¦çš„æ•°æ®ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ä½ è¢«æœåŠ¡å™¨å°é»‘å±‹äº†</span></span><br><span class="line">    <span class="comment"># 5å­—å¤´è¡¨ç¤ºæœåŠ¡å™¨èƒŒé”…ï¼Œå¤„ç†ä½ çš„è¯·æ±‚è¿‡ç¨‹ä¸­bugäº†ï¼Œæˆ–è€…æ˜¯æ ¹æœ¬æ²¡æ³•å¤„ç†è¯·æ±‚</span></span><br><span class="line">    <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">        html = response.text  <span class="comment"># æå–ç›¸åº”çš„æ–‡æœ¬ä¿¡æ¯ï¼Œåœ¨æ­¤ä¸ºç½‘é¡µæ•°æ®</span></span><br><span class="line">        è§£æ(html)</span><br><span class="line">        å­˜å‚¨æ•°æ®()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'Error at page %d with status %d!'</span> %</span><br><span class="line">              (i + <span class="number">1</span>, response.status_code))</span><br></pre></td></tr></table></figure>
<h2 id="è§£ææå–ç”µå½±URL"><a href="#è§£ææå–ç”µå½±URL" class="headerlink" title="è§£ææå–ç”µå½±URL"></a>è§£ææå–ç”µå½±URL</h2><h3 id="HTMLè§£æ"><a href="#HTMLè§£æ" class="headerlink" title="HTMLè§£æ"></a>HTMLè§£æ</h3><p>è·å¾—äº†ç”µå½±åˆ—è¡¨ç½‘é¡µæ•°æ®ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡æŸç§è§„åˆ™ï¼Œè·å–ç½‘é¡µé‡Œè¾¹çš„ç”µå½±é“¾æ¥ã€‚ç½‘é¡µæ•°æ®æ–‡æœ¬ä¸€èˆ¬éµä»HTMLï¼ˆè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼‰æ ¼å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å³é”®ç½‘é¡µæŸ¥çœ‹æºä»£ç çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ªç½‘é¡µçš„å…ƒç´ ï¼ˆElementï¼‰ï¼Œéƒ½è¢«æ ‡ç­¾ï¼ˆTagï¼‰åŒ…è£¹ç€ï¼Œå½¢å¼ç±»ä¼¼äºè¿™æ ·â€”â€”<code>&lt;tag1&gt;&lt;tag2&gt;...&lt;/tag2&gt;...&lt;/tag1&gt;</code>ï¼Œæ ‡ç­¾å±‚å±‚ç›¸æ‰£ï¼Œè€Œæœ€å¤–å±‚æœ‰ä¸€ä¸ª<code>&lt;html&gt;</code>æ ‡ç­¾åŒ…è£¹ç€æ‰€æœ‰çš„å†…å®¹ï¼Œå› æ­¤æ•´ä¸€ä¸ªç½‘é¡µæ•°æ®ç±»ä¼¼äºç”±æ ‡ç­¾ã€å…ƒç´ ç»„æˆï¼Œä»¥<code>&lt;html&gt;</code>æ ‡ç­¾ä¸ºæ ¹çš„æ ‘çŠ¶ç»“æ„ã€‚åœ¨Pythonä¸­ï¼Œæœ‰è®¸å¤šç¬¬ä¸‰æ–¹åº“ï¼ˆéœ€è¦é¢å¤–å®‰è£…~ï¼‰å¯ä»¥æ»¡è¶³è§£æHTMLçš„éœ€æ±‚ï¼Œè¿™é‡Œä»¥<code>bs4</code>çš„<code>BeautifulSoup</code>è§£æåº“ä»¥åŠ<code>lxml</code>è§£æå¼•æ“ä¸ºä¾‹ï¼Œå°è¯•æå–è±†ç“£ç”µå½±çš„é“¾æ¥ã€‚</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">html = response.text  <span class="comment"># æ¥ä¸Š</span></span><br><span class="line">html_parser = <span class="string">'lxml'</span>  <span class="comment"># æŒ‡å®šè§£æå¼•æ“ä¸ºlxml</span></span><br><span class="line">soup = BeautifulSoup(html, html_parser)  <span class="comment"># åŸºäºç½‘é¡µæ•°æ®æ„å»ºä¸€ä¸ªè§£æå™¨</span></span><br></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥ï¼Œéšä¾¿åœ¨å“ªä¸€ä¸ªç”µå½±åˆ—è¡¨é¡µé¢æ‰“å¼€Chromeå¼€å‘è€…å·¥å…·ï¼Œé€‰æ‹©Elementsä¸€æ ï¼Œç‚¹å‡»å¼€å‘è€…å·¥å…·å·¦ä¸Šè§’çš„é¼ æ ‡ï¼Œå†ç‚¹ä¸€ä¸ªç”µå½±æ ‡é¢˜ï¼Œå°±å¯ä»¥<br>åœ¨å¼€å‘è€…å·¥å…·ä¸­å®šä½åˆ°è¯¥æ ‡é¢˜æ‰€åœ¨çš„å…ƒç´ ã€‚</p>
<p>æ‰€ä»¥ï¼Œçœ‹åˆ°æœ‰ä¸ªæ ‡ç­¾ï¼Œ<code>&lt;a href=&quot;å•¥å•¥å•¥&quot;&gt;...&lt;/a&gt;</code>äº†å—ï¼Ÿç‚¹å‡»é‚£ä¸ªhrefé‡Œçš„å†…å®¹ï¼Œæ˜¯ä¸æ˜¯è¿›åˆ°äº†æ¯éƒ¨ç”µå½±çš„é¡µé¢ï¼Ÿè¯•è¯•çœ‹å§~</p>
<h3 id="å®šä½æ ‡ç­¾"><a href="#å®šä½æ ‡ç­¾" class="headerlink" title="å®šä½æ ‡ç­¾"></a>å®šä½æ ‡ç­¾</h3><p>è¦å®šä½è¿™ä¸ª<code>&lt;a href=&quot;å•¥å•¥å•¥&quot;&gt;...&lt;/a&gt;</code>å…ƒç´ çš„ä½ç½®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å‘è€…å·¥å…·çš„Elementsç•Œé¢ä¸­å³é”®ç‚¹å‡»æ ‡ç­¾å¤´éƒ¨ï¼Œä¹Ÿå°±æ˜¯<code>&lt;a href=&quot;å•¥å•¥å•¥&quot;&gt;</code>è¿™ä¸€éƒ¨åˆ†ï¼Œç„¶åï¼Œé€‰æ‹©copy -&gt; selectorï¼Œè·å–è¯¥å…ƒç´ CSSé€‰æ‹©å™¨çš„ä»£ç ã€‚é€‰æ‹©å™¨ï¼ˆSelectorï¼‰ï¼Œå¯ä»¥æ»¡è¶³å®šä½ä¸€ç»„æˆ–æ˜¯ä¸€ä¸ªç‰¹å®šHTMLå…ƒç´ çš„éœ€æ±‚ã€‚è€ŒBeautifulSoupï¼Œåˆ™å¯¹CSSé€‰æ‹©å™¨ï¼ˆCSS Selectorï¼‰æœ‰ç€è¾ƒå¥½çš„æ”¯æŒã€‚</p>
<p>ä»¥ç¬¬ä¸€é¡µçš„ã€Šè‚–ç”³å…‹çš„æ•‘èµã€‹ä¸ºä¾‹æ“ä½œï¼Œcopyå‡ºæ¥çš„é€‰æ‹©å™¨çš„ä»£ç æ˜¯â€”â€”<code>#content &gt; div &gt; div.article &gt; ol &gt; li:nth-child(1) &gt; div &gt; div.info &gt; div.hd &gt; a</code>ï¼Œçœ‹èµ·æ¥å¾ˆé•¿ï¼Œé‚£æœ‰æ²¡æœ‰ç®€å•çš„ç‰ˆæœ¬å‘¢ï¼Ÿä»”ç»†è§‚å¯Ÿï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼šæ ‡ç­¾çš„å±æ€§ï¼ˆæ¯”å¦‚<code>&lt;a href=&quot;å•¥å•¥å•¥&quot;&gt;</code>é‡Œï¼Œ<code>href</code>å°±æ˜¯æ ‡ç­¾çš„å±æ€§ï¼‰é‡Œï¼Œ<code>class</code>è·Ÿ<code>id</code>æ˜¯è¾ƒä¸ºå¸¸è§çš„ä¸¤ä¸ªã€‚æ ‡ç­¾å±æ€§<code>class</code>ä¸€èˆ¬æŒ‡ä»£ä¸€ç±»ç‰¹å®šçš„ç½‘é¡µå…ƒç´ æ’ç‰ˆæ ·å¼ï¼Œè€Œ<code>id</code>åˆ™ä¸€èˆ¬ç”¨äºæŒ‡ä»£ä¸€ä¸ªç‰¹å®šçš„å…ƒç´ ã€‚æ¯ä¸€ä¸ªç”µå½±é“¾æ¥çš„ä¸Šå±‚ï¼Œéƒ½æœ‰ä¸€ä¸ª<code>&lt;div class=&quot;hd&quot;&gt;</code>çš„æ ‡ç­¾ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªæ ‡ç­¾ä¸‹å±‚çš„<code>&lt;a&gt;</code>æ ‡ç­¾ï¼Œå¯»æ‰¾å¯¹åº”çš„ç”µå½±é“¾æ¥ï¼Œå¹¶å­˜å‚¨èµ·æ¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">movie_url_file = open(<span class="string">'movie_urls.txt'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="keyword">for</span> movies <span class="keyword">in</span> soup.find_all(<span class="string">'div'</span>, class_=<span class="string">'hd'</span>):</span><br><span class="line">    <span class="comment"># moviesè¡¨ç¤ºç½‘é¡µä¸­æ¯ä¸€ä¸ª&lt;div class="hd"&gt;æ ‡ç­¾ä¸‹çš„å…ƒç´ </span></span><br><span class="line">    movie_url = movies.find(<span class="string">'a'</span>)[<span class="string">'href'</span>]  <span class="comment"># æå–è¯¥å…ƒç´ ä¸‹å±‚&lt;a&gt;æ ‡ç­¾çš„hrefå±æ€§</span></span><br><span class="line">    movie_url_file.write(movie_url + <span class="string">'\n'</span>)  <span class="comment"># æŠŠé“¾æ¥å†™å…¥æ–‡ä»¶</span></span><br><span class="line">movie_url_file.close()</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™æ ·çš„æ“ä½œï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—250ä¸ªç”µå½±çš„urläº†ã€‚è¯•è¯•çœ‹å§~</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä¸ŠåŠéƒ¨åˆ†ï¼Œåˆè¯•çˆ¬è™«ï¼Œæˆ‘ä»¬æŠ“åˆ°äº†è±†ç“£250ä¸ªç”µå½±çš„é“¾æ¥ã€‚</p>
<p>ä¸‹åŠéƒ¨åˆ†ï¼Œæˆ‘ä»¬å°±åœ¨è¿™250ä¸ªç”µå½±çš„é“¾æ¥ä¸­ï¼Œä¸€æ¢ç©¶ç«Ÿå§~</p>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>çˆ¬è™«</tag>
        <tag>BeautifulSoup</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>HTML</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘Luaæ€§èƒ½æµ‹è¯•ï¼šå‡½æ•°æ‰§è¡Œæ—¶é—´ç»Ÿè®¡</title>
    <url>/2019/03/25/luatalk/lfunctimer/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨ç™½ç›’æ€§èƒ½æµ‹è¯•ï¼ˆprofilingï¼‰ä¸­ï¼Œå‡½æ•°æ—¶é—´ç»Ÿè®¡æ˜¯ä¸€é¡¹é‡è¦çš„æŒ‡æ ‡ã€‚å¯¹äºæ•´ä¸ªä»¥luaä¸ºåŸºç¡€çš„ç³»ç»Ÿæ¶æ„è€Œè¨€ï¼Œå‡½æ•°æ—¶é—´ç»Ÿè®¡æ•°æ®æ˜¯æ€§èƒ½ä¼˜åŒ–çš„ç›´æ¥å‚ç…§ã€‚</p>
<p>å› æ­¤ï¼Œæœ¬æ¬¡Luaæ‚è°ˆï¼Œå°†ä¼šåˆ†äº«ä¸€ç§å‡½æ•°æ‰§è¡Œæ—¶é—´ç»Ÿè®¡çš„å®ç°~</p>
<h2 id="å‡½æ•°æ‰§è¡Œæ—¶é—´è·å–"><a href="#å‡½æ•°æ‰§è¡Œæ—¶é—´è·å–" class="headerlink" title="å‡½æ•°æ‰§è¡Œæ—¶é—´è·å–"></a>å‡½æ•°æ‰§è¡Œæ—¶é—´è·å–</h2><p>å•ä¸ªå‡½æ•°æ‰§è¡Œæ—¶é—´çš„è·å–ç›¸å¯¹è¾ƒä¸ºç®€å•ï¼Œä¾‹å­å¦‚ä¸‹ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">local</span> start = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">local</span> <span class="keyword">end</span> = <span class="built_in">os</span>.<span class="built_in">clock</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">tostring</span>(<span class="keyword">end</span> - start))</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>åœ¨å‡½æ•°çš„å¼€å¤´ä¸ç»“å°¾è°ƒç”¨luaå†…ç½®çš„os.clockï¼ˆå†…æ ¸å®ç°ä¸ºtime.hçš„ä¸­<code>clock()</code>æ—¶é—´æˆ³é™¤ä»¥<code>CLOCKS_PER_SEC</code>ç»Ÿè®¡é‡ï¼Œå•ä½ä¸ºç§’ï¼‰ï¼Œå¯ä»¥è½»è€Œæ˜“ä¸¾åœ°è·å¾—è¯¥å‡½æ•°çš„æ‰§è¡Œæ—¶é—´</p>
<h2 id="hookå®ç°"><a href="#hookå®ç°" class="headerlink" title="hookå®ç°"></a>hookå®ç°</h2><a id="more"></a>
<p>åœ¨luaçš„debugåº“ä¸­ï¼Œhookæ©ç åŒ…æ‹¬lineã€callã€returnç­‰å‡ ç§ï¼Œæ˜“çŸ¥åœ¨callä¸returnäº‹ä»¶æ‰“hookï¼Œå¯ä»¥æ›´ç²¾ç¡®åœ°å¯¹å‡½æ•°æ—¶é—´è¿›è¡Œç»Ÿè®¡ã€‚</p>
<p>å‡½æ•°æ‰§è¡Œæ—¶é—´çš„hookå¯ä»¥å‚è€ƒç¬”è€…çš„<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3V0bWhpa2FyaS9sZnVuY3RpbWVy" title="https://github.com/utmhikari/lfunctimer">lfunctimer<i class="fa fa-external-link"></i></span>ï¼Œåœ¨å®ç°ä¸Šå‚è€ƒäº†<span class="exturl" data-url="aHR0cHM6Ly9rZXBsZXJwcm9qZWN0LmdpdGh1Yi5pby9sdWFjb3YvaW5kZXguaHRtbA==" title="https://keplerproject.github.io/luacov/index.html">luacov<i class="fa fa-external-link"></i></span>ä»¥åŠluaå®˜ç½‘çš„<span class="exturl" data-url="aHR0cHM6Ly93d3cubHVhLm9yZy9waWwvMjMuMy5odG1s" title="https://www.lua.org/pil/23.3.html">å‡½æ•°ç»Ÿè®¡æ ·ä¾‹<i class="fa fa-external-link"></i></span>ã€‚</p>
<p>å‡½æ•°æ—¶é—´ç»Ÿè®¡ä¸­æœ‰ä¸€ä¸ªæ ¸å¿ƒçš„é—®é¢˜å°±æ˜¯é€’å½’è°ƒç”¨è‡ªèº«æƒ…å†µï¼Œå¯¹ä¸è¿™ä¸ªé—®é¢˜çš„å¤„ç†æ–¹æ¡ˆæ˜¯â€”â€”ä»¥æœ€æ—©callè‡³æœ€æ™šreturnçš„æ—¶é—´ä¸ºå‡†ã€‚ä¸ºæ­¤ï¼Œå¯¹äºæ¯ä¸€ä¸ªå‡½æ•°ï¼Œè®¾ç«‹ä¸€ä¸ªstackè®°å½•æ—¶é—´ç‚¹ï¼Œæ¯callä¸€æ¬¡pushæ—¶é—´ç‚¹ï¼Œæ¯returnä¸€æ¬¡popæ—¶é—´ç‚¹ï¼Œå¦‚æœå‰©æœ€åä¸€ä¸ªï¼Œå°±å¢åŠ æ—¶é—´é‡ã€‚ä»£ç å‚è€ƒå¦‚ä¸‹ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> evt == <span class="string">"call"</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> functimestack[f] <span class="keyword">then</span></span><br><span class="line">        functimestack[f] = &#123;&#125;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(functimestack[f], <span class="built_in">os</span>.<span class="built_in">clock</span>())</span><br><span class="line"><span class="keyword">elseif</span> evt == <span class="string">"return"</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> functimestack[f] <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">if</span> #functimestack[f] == <span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> exec_time = <span class="built_in">os</span>.<span class="built_in">clock</span>() - functimestack[f][<span class="number">1</span>]</span><br><span class="line">            lfunctimer.save(funcnames[f], exec_time)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="built_in">table</span>.<span class="built_in">remove</span>(functimestack[f])</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>luaå‡½æ•°æ‰§è¡Œæ—¶é—´çš„ç»Ÿè®¡ä»å®ç°åŸç†ä¸Šå¹¶ä¸éš¾ï¼Œç”šè‡³å¯ä»¥ä¸æ›¾ç»æ‰€æåˆ°çš„è¦†ç›–ç‡ç»Ÿè®¡æ¨¡å—ç²¾å¯†ç»“åˆ</p>
<p>å› æ­¤ï¼Œåˆæ˜¯ä¸€ä¸ªæ‰©å±•æ€§éå¸¸å¼ºçš„æµ‹è¯•éœ€æ±‚å•¦~</p>
<h2 id="æ›´æ–°"><a href="#æ›´æ–°" class="headerlink" title="æ›´æ–°"></a>æ›´æ–°</h2><p>å…¶å®è¿›è¡Œå‡½æ•°æ‰§è¡Œæ—¶é—´çš„ç»Ÿè®¡çš„è¯ï¼Œå•çº¯å»hookè¿™ä¿©callã€returnäº‹ä»¶ï¼Œæœ‰çš„æ—¶å€™è¿˜ä¼šhookåˆ°ä¸€äº›ä¸å¿…è¦è®°å½•çš„å‡½æ•°ï¼Œè¿˜æœ‰å¯èƒ½å¼•å‘æ€§èƒ½é—®é¢˜ã€‚è¿˜æœ‰ä¸€ç§å¥½çš„æ–¹æ³•æ˜¯ï¼šåœ¨æ¯ä¸ªtické‡Œï¼ˆæ¯”å¦‚é’ˆå¯¹æ¸¸æˆå®¢æˆ·ç«¯/æœåŠ¡ç«¯ï¼Œåœ¨updateå‡½æ•°é‡Œï¼‰å»æ‰“å°å‡½æ•°è°ƒç”¨æ ˆä¸Šæ‰€æœ‰çš„å‡½æ•°ï¼Œè¿™æ ·å¯èƒ½ä¼šæ›´åŠ æœ‰æ•ˆã€‚</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>æ€§èƒ½æµ‹è¯•</tag>
        <tag>lua</tag>
        <tag>debug</tag>
        <tag>æµ‹è¯•</tag>
        <tag>lfunctimer</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘ç¬¬äºŒè¯ï¼šæ˜ å°„â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°çš„çº½å¸¦</title>
    <url>/2019/03/16/easypython/ii/</url>
    <content><![CDATA[<h2 id="ä»dictå¼€å§‹è¯´èµ·"><a href="#ä»dictå¼€å§‹è¯´èµ·" class="headerlink" title="ä»dictå¼€å§‹è¯´èµ·"></a>ä»dictå¼€å§‹è¯´èµ·</h2><p>å­¦pythonçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€å®šä¼šæ¥è§¦åˆ°dictï¼ˆå­—å…¸ï¼‰è¿™ä¸ªæ•°æ®ç»“æ„ã€‚</p>
<p>dictç»“æ„å±•ç¤ºäº†æ•°æ®é—´ï¼ˆkeyä¸valueï¼‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œkeyä½œä¸ºä¸€ä¸ªæŸ¥è¯¢ç´¢å¼•ï¼Œæ˜¯ä¸å…è®¸æœ‰é‡å¤çš„ï¼Œè€Œä¸åŒkeyæ‰€å¯¹åº”çš„valueï¼Œåˆ™å…è®¸é‡å¤å€¼çš„å­˜åœ¨ã€‚</p>
<p>æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ç¾¤boys&amp;girlsï¼Œæ‰“å‡ºæ•´ä¸ªdictï¼Œå†æ‰“å‡ºgirlsæœ‰å“ªäº›ï¼Œå¯ä»¥è¿™æ ·æ“ä½œï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pprint</span><br><span class="line">d = dict()</span><br><span class="line">d[<span class="string">'girl'</span>] = [<span class="string">'è¿ªä¸½çƒ­å·´'</span>, <span class="string">'ç‹é¸¥'</span>, <span class="string">'é¬¼é¬¼'</span>]</span><br><span class="line">d[<span class="string">'boy'</span>] = [<span class="string">'å¤§ç¢—å®½é¢'</span>]</span><br><span class="line"><span class="comment"># ç”¨pprint.pprintå‡½æ•°æ‰“å°æ•°æ®ç»“æ„ï¼Œä½¿å¾—å…¶æ’ç‰ˆæ›´åŠ pretty~</span></span><br><span class="line">pprint.pprint(d, indent=<span class="number">2</span>)</span><br><span class="line"><span class="comment"># å•ç”¨pprint.pformatï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªæ’ç‰ˆè¿‡åçš„å­—ç¬¦ä¸²ï¼Œæ‰“å°å‡ºæ¥è¦é¢å¤–printæ“ä½œ~</span></span><br><span class="line">print(<span class="string">'Girls are: %s'</span> % pprint.pformat(d[<span class="string">'girl'</span>]))</span><br></pre></td></tr></table></figure>
<p>æ‰“å‡ºæ¥çš„æ•ˆæœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&apos;boy&apos;: [&apos;å¤§ç¢—å®½é¢&apos;], &apos;girl&apos;: [&apos;è¿ªä¸½çƒ­å·´&apos;, &apos;ç‹é¸¥&apos;, &apos;é¬¼é¬¼&apos;]&#125;</span><br><span class="line">Girls are: [&apos;è¿ªä¸½çƒ­å·´&apos;, &apos;ç‹é¸¥&apos;, &apos;é¬¼é¬¼&apos;]</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥å¾ˆç›´è§‚åœ°çœ‹åˆ°è¿™ç§å¯¹åº”å…³ç³»</p>
<h2 id="æ˜ å°„"><a href="#æ˜ å°„" class="headerlink" title="æ˜ å°„"></a>æ˜ å°„</h2><p>åƒdictæ•°æ®ç»“æ„ç»™æˆ‘ä»¬å±•ç°çš„ä¸€æ ·ï¼Œæ•°æ®é—´çš„å¯¹åº”å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç»Ÿç§°ä¸ºï¼šæ˜ å°„ï¼ˆMappingï¼‰</p>
<p>å¦‚åŒç¬¬ä¸€è¯æ‰€è¯´ï¼Œç¨‹åºçš„æœ¬è´¨å³ä¸ºè¾“å…¥-&gt;å‡½æ•°-&gt;è¾“å‡ºã€‚è¾“å…¥å’Œè¾“å‡ºï¼Œå°±æ˜¯ä¸€ç§æ˜ å°„å…³ç³»ï¼Œè€Œå®ç°è¿™ç§æ˜ å°„çš„è§„åˆ™ï¼Œå°±æ˜¯å‡½æ•°ã€‚åœ¨dicté‡Œé¢ï¼Œå®ç°æ˜ å°„çš„å‡½æ•°ï¼Œå¯ä»¥ç®€åŒ–å¦‚ä¸‹ï¼š</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_value</span><span class="params">(key)</span>:</span></span><br><span class="line">    memory_address_of_value = hash(key)</span><br><span class="line">    <span class="keyword">return</span> get_data_from_address(memory_address_of_value)</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†è®©æˆ‘ä»¬ä¾¿æ·åœ°ä»ä¸€ä¸ªkeyè®¿é—®åˆ°å¯¹åº”çš„valueï¼Œdictä¸å¯èƒ½æŠŠæ‰€æœ‰çš„keyéƒ½è¿‡ä¸€éæ‰¾ï¼Œé‚£æ ·è´¹æ—¶è´¹åŠ›ã€‚</p>
<p>å–è€Œä»£ä¹‹ï¼Œdictå¯ä»¥ç›´æ¥é€šè¿‡ä¸€ç§ç®—æ³•å‡½æ•°ï¼Œç§°ä¹‹ä¸ºhashï¼Œå°±å¯ä»¥æŠŠkeyè®¡ç®—ï¼ˆæ˜ å°„ï¼‰ä¸ºä¸€ä¸ªæ•°å€¼ï¼Œå³valueçš„å†…å­˜åœ°å€ã€‚æˆ‘ä»¬é€šè¿‡è¿™ä¸ªå†…å­˜åœ°å€ï¼Œå°±å¯ä»¥å–å‡ºå¯¹åº”çš„valueæ•°æ®äº†ï¼Œéå¸¸ç®€å•ç²—æš´ã€‚</p>
<h2 id="æ•°æ®å¤„ç†å°éœ€æ±‚"><a href="#æ•°æ®å¤„ç†å°éœ€æ±‚" class="headerlink" title="æ•°æ®å¤„ç†å°éœ€æ±‚"></a>æ•°æ®å¤„ç†å°éœ€æ±‚</h2><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹è¿™æ ·ä¸€ä¸ªéœ€æ±‚ã€‚æˆ‘ä»¬çš„è¾“å…¥æ˜¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">input_list = [<span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯1~15çš„ä¹±åºã€‚ç°åœ¨æˆ‘ä»¬æƒ³è¾“å‡ºè¿™æ ·çš„ç»“æœï¼š</p>
<ul>
<li>å¦‚æœå¤§äº10ï¼Œ è¾“å‡ºå­—ç¬¦ä¸²â€”â€”è¿™ä¸ªæ•°å­—å¤§äº10</li>
<li>å¦‚æœå°äºç­‰äº10ï¼Œè¾“å‡ºå­—ç¬¦ä¸²â€”â€”è¿™ä¸ªæ•°å­—å°äºç­‰äº10</li>
<li>è¢«3æ•´é™¤çš„å¥‡æ•°ä¸å½•å…¥</li>
</ul>
<p>è¿™ä¸ªéœ€æ±‚å¹¶ä¸éš¾ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°æ‰“å‡ºä»¥ä¸‹çš„ä»£ç ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">output_list = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> input_list:</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> i % <span class="number">3</span> != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">10</span>:</span><br><span class="line">            output_list.append(<span class="string">'%d: å¤§äº10ï¼'</span> % i)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output_list.append(<span class="string">'%d: å°äºç­‰äº10ï¼'</span> % i)</span><br></pre></td></tr></table></figure>
<p>æ‰“å‡ºæ¥çš„ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">11: å¤§äº10ï¼</span><br><span class="line">2: å°äºç­‰äº10ï¼</span><br><span class="line">12: å¤§äº10ï¼</span><br><span class="line">5: å°äºç­‰äº10ï¼</span><br><span class="line">10: å°äºç­‰äº10ï¼</span><br><span class="line">7: å°äºç­‰äº10ï¼</span><br><span class="line">14: å¤§äº10ï¼</span><br><span class="line">6: å°äºç­‰äº10ï¼</span><br><span class="line">1: å°äºç­‰äº10ï¼</span><br><span class="line">13: å¤§äº10ï¼</span><br><span class="line">8: å°äºç­‰äº10ï¼</span><br><span class="line">4: å°äºç­‰äº10ï¼</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æˆ‘æŠŠè¿™ä¸ªä»£ç ç»™æˆ‘æ•¬çˆ±çš„é¢†å¯¼çœ‹äº†ä¹‹åï¼Œé¢†å¯¼å±…ç„¶çœ‹ä¸æ‡‚ï¼Œè§‰å¾—æˆ‘çš„å±‚æ¬¡ä¸å¤Ÿæ¸…æ™°ã€‚å””å¦ˆå‘€ï¼Œä»£ç éƒ½è¿™ä¹ˆçŸ­äº†ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘€</p>
<p>äºæ˜¯ï¼Œåªå¥½æ”¹æˆäº†ä¸€ä¸ªé€»è¾‘å±‚æ¬¡æ¸…æ™°ä¸€ç‚¹çš„ç»“æ„ï¼Œé¡ºå¸¦ç»™æ’äº†ä¸ªåºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">output = map(</span><br><span class="line">    <span class="keyword">lambda</span> x: <span class="string">'%d: å¤§äº10ï¼'</span> % x <span class="keyword">if</span> x &gt; <span class="number">10</span> <span class="keyword">else</span> <span class="string">'%d: å°äºç­‰äº10ï¼'</span> % x,</span><br><span class="line">    filter(</span><br><span class="line">        <span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> x % <span class="number">3</span> != <span class="number">0</span>,</span><br><span class="line">        sorted(input_list),</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ‰“å‡ºæ¥è¿™ä¸ªç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1: å°äºç­‰äº10ï¼</span><br><span class="line">2: å°äºç­‰äº10ï¼</span><br><span class="line">4: å°äºç­‰äº10ï¼</span><br><span class="line">5: å°äºç­‰äº10ï¼</span><br><span class="line">6: å°äºç­‰äº10ï¼</span><br><span class="line">7: å°äºç­‰äº10ï¼</span><br><span class="line">8: å°äºç­‰äº10ï¼</span><br><span class="line">10: å°äºç­‰äº10ï¼</span><br><span class="line">11: å¤§äº10ï¼</span><br><span class="line">12: å¤§äº10ï¼</span><br><span class="line">13: å¤§äº10ï¼</span><br><span class="line">14: å¤§äº10ï¼</span><br></pre></td></tr></table></figure>
<p>è¿™å›é¢†å¯¼ç»ˆäºæ»¡æ„å•¦~~</p>
<h2 id="åˆ†è§£è¿‡ç¨‹ï¼ŒæŒç»­æ˜ å°„"><a href="#åˆ†è§£è¿‡ç¨‹ï¼ŒæŒç»­æ˜ å°„" class="headerlink" title="åˆ†è§£è¿‡ç¨‹ï¼ŒæŒç»­æ˜ å°„"></a>åˆ†è§£è¿‡ç¨‹ï¼ŒæŒç»­æ˜ å°„</h2><p>è®©ä¸€ä¸ªæ™®é€šçš„æ•°æ®å¤„ç†è¿‡ç¨‹å˜å¾—å±‚æ¬¡æ¸…æ™°ï¼Œå…¶å®æ˜¯æœ‰æ–¹æ³•çš„ï¼Œå¾—ç›Šäºpythonå†…ç½®çš„é«˜é˜¶å‡½æ•°ï¼Œå¦‚æœä½ å†™è¿‡jsï¼Œç©è½¬es6æˆ–è€…lodashï¼Œç»å¯¹ç« å£å°±è±ã€‚</p>
<p>ä¸Šä¸€æ®µä»£ç ä¸­ï¼Œä¸éš¾å‘ç°å¤šäº†3ä¸ªæ–°å‡½æ•°ï¼šmapã€filterè·Ÿsortedã€‚æˆ‘ä»¬è¿™å°±ä¸€ä¸€æ¥çœ‹ï¼š</p>
<p>mapï¼Œå°±æ˜¯æ˜ å°„å•¦~å®ƒçš„è¾“å…¥å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ˆæ˜ å°„è§„åˆ™ï¼‰ä»¥åŠæˆ‘ä»¬çš„ä¸€å †è¾“å…¥å€¼ï¼Œåªè¦ç»™å®šå‡½æ•°è·Ÿç›¸åº”çš„ä¸€å †è¾“å…¥å€¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºæ˜ å°„è¾“å‡ºã€‚</p>
<p>ç„¶è€Œï¼Œmapçš„å´å¹¶ä¸æ˜¯è¿”å›æ‰€æœ‰æ˜ å°„è¾“å‡ºç»“æœï¼Œè€Œæ˜¯å•çº¯çš„ä¸€ä¸ªå¯è¿­ä»£ï¼ˆIterableï¼‰çš„å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å…·æœ‰ä¸€ä¸ªå«è¿­ä»£å™¨ï¼ˆIteratorï¼‰çš„ä¸œä¸œå¯ä»¥è®©æˆ‘ä»¬è®¿é—®è¾“å‡ºçš„ç»“æœã€‚è¿­ä»£å™¨ï¼Œå°±åƒæˆ‘æ•¬çˆ±çš„é¢†å¯¼æ‡’æ´‹æ´‹çš„é‚£æ ·ï¼Œä¸å»ç†å®ƒï¼Œå®ƒå•¥éƒ½ä¸å¹²ï¼Œåªæœ‰è°ƒç”¨å®ƒï¼Œå®ƒæ‰ä¼šå±é¢ å±é¢ åœ°æŠŠä¸‹ä¸€ä¸ªmapè¾“å‡ºå€¼ç»™å–å‡ºæ¥ã€‚è¿™ç§â€œæ‡’äººæ“ä½œâ€ï¼Œå…¶å®æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚å¦‚æœè¾“å…¥æ•°æ®é‡å¤§ï¼Œæˆ‘ä»¬éœ€è¦çš„è¾“å‡ºæ•°æ®é‡å°çš„è¯ï¼Œå…ˆæŠŠæ‰€æœ‰è¾“å‡ºéƒ½ç»™å‡ºæ¥ï¼Œå†è¿‡ä¸€éè¾“å‡ºæ•°æ®ï¼Œé‚£è¦çŒ´å¹´é©¬æœˆå‘€ï¼</p>
<p>filterï¼Œè·Ÿmapä¸€æ ·ï¼Œè¾“å…¥ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°è·Ÿä¸€å †è¾“å…¥å€¼ï¼ŒåŸºæœ¬æœºåˆ¶éƒ½å·®ä¸å¤šï¼Œå‹‰å¼ºç®—æ˜¯ä¸€ç§æ˜ å°„çš„å½¢å¼ï¼Œä½†è¾“å‡ºæ€»æœ‰å·®åˆ«â€”â€”é¡¾åæ€ä¹‰ï¼Œfilteræ˜¯è¿‡æ»¤ã€ç­›é€‰ä¹‹æ„ï¼Œæ»¡è¶³æ¡ä»¶çš„é€‰æ‹©ï¼Œä¸æ»¡è¶³æ¡ä»¶çš„æŠ›å¼ƒã€‚å› æ­¤ï¼Œè¾“å…¥å‡½æ•°ï¼ˆè§„åˆ™ï¼‰çš„è¿”å›å€¼ï¼Œåº”å½“æ˜¯Trueæˆ–è€…False</p>
<p>sortedï¼Œé¡¾åæ€ä¹‰ï¼Œå°±â€œæ’åºâ€ä¹‹æ„ï¼Œå…¶è¾“å…¥æ˜¯ä»»æ„å¯è¿­ä»£çš„å¯¹è±¡ï¼Œä»¥åŠæ¯ä¸ªå…ƒç´ è¦æ‹¿æ¥æ¯”è¾ƒçš„å€¼ï¼ˆkeyï¼‰ï¼Œè¿˜æœ‰æ˜¯å¦é€†åºï¼ˆreverseï¼‰çš„é€‰é¡¹ã€‚æ¸…æ™°æ˜“æ‡‚ã€‚</p>
<p>è¯´å®Œè¿™äº›ï¼Œå›åˆ°æˆ‘ä»¬çš„éœ€æ±‚ï¼š</p>
<ul>
<li>å¦‚æœå¤§äº10ï¼Œ è¾“å‡ºå­—ç¬¦ä¸²â€”â€”è¿™ä¸ªæ•°å­—å¤§äº10</li>
<li>å¦‚æœå°äºç­‰äº10ï¼Œè¾“å‡ºå­—ç¬¦ä¸²â€”â€”è¿™ä¸ªæ•°å­—å°äºç­‰äº10</li>
<li>è¢«3æ•´é™¤çš„å¥‡æ•°ä¸å½•å…¥</li>
</ul>
<p>è¦è§£å†³è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬åº”å½“ï¼š</p>
<ol>
<li>å…ˆæ’ä¸ªåºï¼Œå¥½çœ‹ç‚¹â€”â€”<code>sorted(input_list)</code></li>
<li>ç­›é€‰æ•°å­—â€”â€”<code>filter(å‡½æ•°ï¼šè¾“å…¥å€¼-&gt;æ˜¯orä¸æ˜¯è¢«3æ•´é™¤å¥‡æ•°-&gt; False or True, ä¸€å †è¾“å…¥å€¼ï¼šç¬¬ä¸€æ­¥çš„è¾“å‡º)</code></li>
<li>æ ¹æ®å¤§å°è¾“å‡ºå­—ç¬¦ä¸²â€”â€”<code>map(å‡½æ•°ï¼šè¾“å…¥å€¼-&gt;å¤§äº10 | å°äº10 -&gt; è¾“å‡ºå•¥å•¥å•¥, ä¸€å †è¾“å…¥å€¼ï¼šç¬¬äºŒæ­¥çš„è¾“å‡º)</code></li>
</ol>
<p>ç„¶åä¸²èµ·æ¥ï¼Œå°±æ˜¯è¿™äº›å•¦ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">output = map(</span><br><span class="line">    <span class="keyword">lambda</span> x: <span class="string">'%d: å¤§äº10ï¼'</span> % x <span class="keyword">if</span> x &gt; <span class="number">10</span> <span class="keyword">else</span> <span class="string">'%d: å°äºç­‰äº10ï¼'</span> % x,</span><br><span class="line">    filter(</span><br><span class="line">        <span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">or</span> x % <span class="number">3</span> != <span class="number">0</span>,</span><br><span class="line">        sorted(input_list),</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°ï¼Ÿé‚£å°±åœ¨ä»¥åç ç çš„æ—¶å€™ï¼Œå¤šè¯•è¯•çœ‹è¿™ç§styleå§~</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¥è§¦ç¼–ç¨‹çš„åŒå­¦ä»¬ï¼Œæ€»ä¼šå¬è¿‡ä¸¤ä¸ªè¯ï¼šé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆObject Oriented Programmingï¼‰ä¸å‡½æ•°å¼ç¼–ç¨‹ï¼ˆFunctional Programmingï¼‰ï¼Œç”šè‡³æœ‰è®¸å¤šäººé¼“å¹å‡½æ•°å¼ç¼–ç¨‹ï¼Œè´¬ä½é¢å‘å¯¹è±¡äº‘äº‘ï¼Œå¼•èµ·ä¸€ç•ªäº‰è®ºã€‚</p>
<p>é¢å‘å¯¹è±¡æ—¨åœ¨æŠŠä»£ç ä¸–ç•Œæ‰“é€ æˆæˆ‘ä»¬ç†Ÿæ‚‰çš„ç‰©ä»¥ç±»ï¼ˆclassï¼‰èšçš„ç°å®ä¸–ç•Œã€‚è¿™æ ·ï¼Œæ•´ä¸ªä»£ç æ¶æ„å°±æ›´å®¹æ˜“è¢«äººç†è§£ï¼Œå¯ç»´æŠ¤æ€§å°±æ›´å¼ºäº†ã€‚å› æ­¤ï¼Œé¢å‘å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ªç›¸å¯¹å®è§‚çš„æ¦‚å¿µã€‚</p>
<p>å‡½æ•°å¼ç¼–ç¨‹ï¼Œé¡¾åæ€ä¹‰ï¼Œå‡½æ•°å³ä¸ºç¨‹åºçš„åŸºç¡€ã€‚æ­£å¦‚ç¬¬ä¸€è¯æ‰€è¯´çš„é‚£æ ·ï¼Œå‡½æ•°ï¼Œä¸ä»…æ˜¯è¾“å…¥åˆ°è¾“å‡ºçš„æ˜ å°„è§„åˆ™ï¼Œè€Œä¸”å°±åƒæ´»å­—å°åˆ·ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªå¯å¤ç°çš„è¿‡ç¨‹ã€‚å› æ­¤ï¼Œä¸ç®¡å¤šé•¿å¤šçŸ­ã€å¤šå¤§å¤šå°çš„ç¨‹åºï¼Œéƒ½å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæˆ–æ˜¯å¤šä¸ªå‡½æ•°çš„ç¹å¤è”ç³»ï¼Œå°±æ¯”å¦‚è¯´ï¼Œå’±ä»¬åƒç«é¾™æœä¹‹åâ€¦â€¦é‡‡ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼Œèƒ½å¤Ÿæå¤§å¢å¼ºç¨‹åºçš„æ¡ç†æ€§ï¼Œå› æ­¤å¯ä»¥è¯´ï¼Œç›¸å¯¹äºé¢å‘å¯¹è±¡ï¼Œå‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ä¸ªå¾®è§‚çš„æ¦‚å¿µã€‚</p>
<p>é¢å‘å¯¹è±¡ä¸å‡½æ•°å¼ç¼–ç¨‹ï¼Œæ˜¯ä½ ä¸­æœ‰æˆ‘ã€æˆ‘ä¸­æœ‰ä½ çš„å…³ç³»ï¼Œå¹¶ä¸å­˜åœ¨æ‰€è°“çš„å¯¹ç«‹é¢ã€‚ä½œä¸ºä¸€ä¸ªæ—¢æ”¯æŒé¢å‘å¯¹è±¡åˆæ”¯æŒå‡½æ•°å¼ç¼–ç¨‹çš„è¯­è¨€ï¼ŒPythonè¿˜æ˜¯å¾ˆäººæ€§åŒ–æ»´ï¼ç¬¬äºŒè¯è™½ç„¶è®²è¿°çš„å¤šæ˜¯å‡½æ•°å¼ç¼–ç¨‹ç›¸å…³çš„æ¦‚å¿µï¼Œä½†å®é™…ä½¿ç”¨æ—¶ï¼Œå°¤å…¶ä»£ç é‡å¢å¤§æ—¶ï¼Œå°±éœ€è¦åº”ç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•ä¸è®¾è®¡æ¨¡å¼ï¼Œæ”¶æ‹¾ä¸€ä¸‹ä½ çš„é¡¹ç›®å•¦~</p>
<p>å®è·µå‡ºçœŸçŸ¥ï¼Œå¸Œæœ›å’±ä»¬ä¸€èµ·è¿›æ­¥~</p>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>å‡½æ•°å¼ç¼–ç¨‹</tag>
        <tag>é«˜é˜¶å‡½æ•°</tag>
        <tag>æ˜ å°„</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Luaæ‚è°ˆã€‘è§£é”luaä»£ç è¦†ç›–ç‡æµ‹è¯•ï¼šluacovæºç åˆ†æ</title>
    <url>/2019/03/10/luatalk/luacov/</url>
    <content><![CDATA[<p>Lua æ‚è°ˆç³»åˆ—ï¼Œå°±ä»¥ä»£ç è¦†ç›–ç‡æµ‹è¯•çš„ luacov å¼€å¤´å§</p>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>è¯´åˆ° lua çš„è¦†ç›–ç‡æµ‹è¯•ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šæƒ³åˆ°ç”¨<span class="exturl" data-url="aHR0cHM6LS1rZXBsZXJwcm9qZWN0LmdpdGh1Yi5pby9sdWFjb3YvaW5kZXguaHRtbA==" title="https:--keplerproject.github.io/luacov/index.html">luacov<i class="fa fa-external-link"></i></span>åšä»£ç è¦†ç›–ç‡æµ‹è¯•<br>åœ¨<span class="exturl" data-url="aHR0cHM6LS1ibG9nLmNzZG4ubmV0L080ZEM4T2pPN1pMNi9hcnRpY2xlL2RldGFpbHMvNzgzNzMxMTc=" title="https:--blog.csdn.net/O4dC8OjO7ZL6/article/details/78373117">å¹²è´§ï½œä½¿ç”¨ luacov ç»Ÿè®¡ lua ä»£ç è¦†ç›–ç‡<i class="fa fa-external-link"></i></span>ä¸€æ–‡ä¸­ï¼Œä»‹ç»äº†åŸºæœ¬çš„ luacov ç”¨æ³•ï¼Œä½†æ˜¯ç¼ºå°‘å¯¹ luacov æ·±å…¥æŒ–æ˜çš„ç›¸å…³å†…å®¹ã€‚å¹¶ä¸”åŒæ—¶ï¼ŒåŸç”Ÿçš„ luacov æä¾›äº†ä¸€å¥—ç®€æ´çš„è¦†ç›–ç‡æµ‹è¯•å®ç°ä»¥åŠæŠ¥å‘Šè¾“å‡ºå½¢å¼ï¼Œä½†æ˜¯åœ¨å®é™…è®¸å¤šåœºæ™¯ä¸­ï¼Œé‡‡ç”¨åŸç”Ÿ luacov è¿˜æ˜¯è¿œè¿œæ»¡è¶³ä¸äº†éœ€æ±‚çš„<br>å› æ­¤ï¼Œæœ¬æ–‡æ—¨åœ¨é€šè¿‡åˆ†æ luacov çš„å®ç°ï¼Œå¸®åŠ©å¸Œæœ›äº†è§£ lua ä»£ç è¦†ç›–ç‡æµ‹è¯•æˆ–æ˜¯ä½¿ç”¨ã€äºŒæ¬¡å¼€å‘ luacov çš„åŒå­¦å°½å¿«ä¸Šæ‰‹</p>
<h2 id="è·å–ä»£ç è¦†ç›–ç‡æ•°æ®"><a href="#è·å–ä»£ç è¦†ç›–ç‡æ•°æ®" class="headerlink" title="è·å–ä»£ç è¦†ç›–ç‡æ•°æ®"></a>è·å–ä»£ç è¦†ç›–ç‡æ•°æ®</h2><p>luacov è·å–ä»£ç è¦†ç›–ç‡æ•°æ®ï¼Œå¾—ç›Šäº lua è‡ªå¸¦çš„ debug åº“ã€‚æˆ‘ä»¬ä» luacov çš„ä¸»ç±» runner ä¸­ï¼Œå¯ä»¥ä¸€æ¢ç©¶ç«Ÿ</p>
<a id="more"></a>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆå§‹åŒ–runner</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runner.init</span><span class="params">(configuration)</span></span></span><br><span class="line">    <span class="comment">-- è¯»å–è®¾ç½®</span></span><br><span class="line">    runner.configuration = runner.load_config(configuration)</span><br><span class="line">    <span class="comment">-- é‡è½½os.exitï¼Œåœ¨åŸç”Ÿos.exit()å‰æŠŠå‰©ä¸‹æ•°æ®å­˜æ‰ï¼Œæˆ–è€…è¾“å‡ºæŠ¥å‘Šä¹‹ç±»</span></span><br><span class="line">    <span class="built_in">os</span>.<span class="built_in">exit</span> = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">        on_exit()</span><br><span class="line">        raw_os_exit(...)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">-- åœ¨'l'äº‹ä»¶åŠ debug hook</span></span><br><span class="line">    <span class="built_in">debug</span>.<span class="built_in">sethook</span>(runner.debug_hook, <span class="string">"l"</span>)</span><br><span class="line">    <span class="comment">-- å¦‚æœæ¯ä¸ªthreadéƒ½æœ‰ç‹¬ç«‹çš„hook</span></span><br><span class="line">    <span class="keyword">if</span> has_hook_per_thread() <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- é‡è½½coroutine.createï¼Œæ‰“åŒ…å‡½æ•°ä¹‹å‰å…ˆåœ¨'l'äº‹ä»¶sethook</span></span><br><span class="line">        <span class="keyword">local</span> rawcoroutinecreate = coroutine.<span class="built_in">create</span></span><br><span class="line">        coroutine.<span class="built_in">create</span> = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">            <span class="keyword">local</span> co = rawcoroutinecreate(...)</span><br><span class="line">            <span class="built_in">debug</span>.<span class="built_in">sethook</span>(co, runner.debug_hook, <span class="string">"l"</span>)</span><br><span class="line">            <span class="keyword">return</span> co</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">-- coroutine.wrapç”¨çš„error handler</span></span><br><span class="line">        <span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">safeassert</span><span class="params">(ok, ...)</span></span></span><br><span class="line">            <span class="keyword">if</span> ok <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">return</span> ...</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="built_in">error</span>(..., <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">-- é‡è½½coroutine.wrapï¼Œæ‰“åŒ…å‡½æ•°ä¹‹å‰å…ˆåœ¨'l'äº‹ä»¶sethook</span></span><br><span class="line">        coroutine.<span class="built_in">wrap</span> = <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">            <span class="keyword">local</span> co = rawcoroutinecreate(...)</span><br><span class="line">            <span class="built_in">debug</span>.<span class="built_in">sethook</span>(co, runner.debug_hook, <span class="string">"l"</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(...)</span></span></span><br><span class="line">                <span class="keyword">return</span> safeassert(coroutine.<span class="built_in">resume</span>(co, ...))</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>lua çš„<code>debug.sethook([thread], hook, mask)</code>å‡½æ•°å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„ lua è„šæœ¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ç‰¹å®šçš„æ¡ä»¶ï¼ˆmaskï¼‰æ—¶æ‰§è¡Œç›¸åº”çš„å‡½æ•°ï¼ˆhookï¼‰ã€‚å½“ mask ä¸º<code>&#39;l&#39;</code>æ—¶ï¼Œè¡¨ç¤º lua è„šæœ¬å·²ç»æ‰§è¡Œåˆ°äº†æ–°çš„ä¸€è¡Œã€‚å› æ­¤ï¼Œä¸ºäº†ç»Ÿè®¡è¦†ç›–ç‡ï¼Œåªéœ€è¦åœ¨æˆ‘ä»¬ hook<code>&#39;l&#39;</code>äº‹ä»¶çš„å‡½æ•°ä¸­ï¼Œå¯»æ‰¾æ‰§è¡Œçš„æ–‡ä»¶å’Œè¡Œå·å°±å¥½äº†</p>
<h2 id="hook-å‡½æ•°"><a href="#hook-å‡½æ•°" class="headerlink" title="hook å‡½æ•°"></a>hook å‡½æ•°</h2><p>åœ¨ luacov.runner ä¸­ï¼Œå®šä¹‰çš„ debug hook ä¸ºï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line">runner.debug_hook = <span class="built_in">require</span>(cluacov_ok <span class="keyword">and</span> <span class="string">"cluacov.hook"</span> <span class="keyword">or</span> <span class="string">"luacov.hook"</span>).new(runner)</span><br></pre></td></tr></table></figure>
<p>å› æ­¤æˆ‘ä»¬å¯ä»¥ä»¥ luacov.hook æ¨¡å—ä¸ºä¾‹è§‚å¯Ÿå…·ä½“å®ç°ï¼š</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hook.new</span><span class="params">(runner)</span></span></span><br><span class="line">    <span class="comment">-- å¿½ç•¥çš„æ–‡ä»¶åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">local</span> ignored_files = &#123;&#125;</span><br><span class="line">    <span class="comment">-- hookæ‰§è¡Œçš„æ¬¡æ•°count</span></span><br><span class="line">    <span class="keyword">local</span> steps_after_save = <span class="number">0</span></span><br><span class="line">    <span class="comment">-- hookå‡½æ•°å‚æ•°ä¸º(äº‹ä»¶evt, è¡Œæ•°line_nr, æ ˆå±‚æ¬¡level)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(_, line_nr, level)</span></span></span><br><span class="line">        <span class="comment">-- levelé»˜è®¤å€¼ä¸º2</span></span><br><span class="line">        <span class="comment">-- æ ˆå±‚æ¬¡ä¸º1ä½è°ƒç”¨hookçš„luacovï¼Œæ ˆå±‚æ¬¡ä¸º2å³ä¸ºå¾…æµ‹è¦†ç›–ç‡çš„æ–‡ä»¶</span></span><br><span class="line">        level = level <span class="keyword">or</span> <span class="number">2</span></span><br><span class="line">        <span class="comment">-- åˆ¤æ–­runneræ˜¯å¦åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> runner.initialized <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">-- è·å–æ ˆå±‚æ¬¡levelçš„sourceæºæ–‡ä»¶ä¿¡æ¯ï¼Œå³æ–‡ä»¶å</span></span><br><span class="line">        <span class="comment">-- è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±å·²ç»è·å¾—äº†æƒ³è¦çš„ä¿¡æ¯ï¼šæ–‡ä»¶ånameä¸è¡Œæ•°line_nr</span></span><br><span class="line">        <span class="keyword">local</span> name = <span class="built_in">debug</span>.<span class="built_in">getinfo</span>(level, <span class="string">"S"</span>).source</span><br><span class="line">        <span class="comment">-- åˆ¤æ–­æ–‡ä»¶åå‰é¢æœ‰æ²¡@ï¼Œä»¥åŠæ˜¯ä¸æ˜¯loadstringè¯»å–çš„ï¼ˆä¸ç„¶å°±ä¸æ˜¯æ–‡ä»¶åï¼‰</span></span><br><span class="line">        <span class="keyword">local</span> prefixed_name = <span class="built_in">string</span>.<span class="built_in">match</span>(name, <span class="string">"^@(.*)"</span>)</span><br><span class="line">        <span class="keyword">if</span> prefixed_name <span class="keyword">then</span></span><br><span class="line">            name = prefixed_name</span><br><span class="line">        <span class="keyword">elseif</span> <span class="keyword">not</span> runner.configuration.codefromstrings <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">-- è¯»å–ä¸´æ—¶ç¼“å­˜runner.dataé‡Œè¾¹çš„æ•°æ®</span></span><br><span class="line">        <span class="keyword">local</span> data = runner.data</span><br><span class="line">        <span class="keyword">local</span> file = data[name]</span><br><span class="line">        <span class="comment">-- åˆ¤æ–­è¯¥æ–‡ä»¶çš„æ•°æ®æ˜¯å¦è¦å­˜å‚¨</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> file <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">if</span> ignored_files[name] <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">elseif</span> runner.file_included(name) <span class="keyword">then</span></span><br><span class="line">                file = &#123;<span class="built_in">max</span> = <span class="number">0</span>, max_hits = <span class="number">0</span>&#125;</span><br><span class="line">                data[name] = file</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                ignored_files[name] = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">-- ä¿®æ­£è¯¥æ–‡ä»¶æœ€å¤§hitåˆ°çš„è¡Œæ•°</span></span><br><span class="line">        <span class="keyword">if</span> line_nr &gt; file.<span class="built_in">max</span> <span class="keyword">then</span></span><br><span class="line">            file.<span class="built_in">max</span> = line_nr</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">-- æ›´æ–°è¯¥æ–‡ä»¶è¡Œçš„hitæ•°</span></span><br><span class="line">        <span class="keyword">local</span> hits = (file[line_nr] <span class="keyword">or</span> <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">        file[line_nr] = hits</span><br><span class="line">        <span class="keyword">if</span> hits &gt; file.max_hits <span class="keyword">then</span></span><br><span class="line">            file.max_hits = hits</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="comment">-- åˆ¤æ–­tickæ­¥é•¿ï¼Œå†³å®šæ˜¯å¦å­˜å‚¨æ•°æ®</span></span><br><span class="line">        <span class="keyword">if</span> runner.tick <span class="keyword">then</span></span><br><span class="line">            steps_after_save = steps_after_save + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> steps_after_save == runner.configuration.savestepsize <span class="keyword">then</span></span><br><span class="line">                steps_after_save = <span class="number">0</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> runner.paused <span class="keyword">then</span></span><br><span class="line">                    runner.save_stats()</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°æ•´ä¸€ä¸ª hook ä¸­æœ€æœ‰ä»·å€¼çš„éƒ¨åˆ†è¿˜æ˜¯<code>local name = debug.getinfo(level, &quot;S&quot;).source</code>ã€‚lua åŸç”Ÿçš„ debug.getinfo ç›¸è¾ƒäº c api çš„æ€§èƒ½å·®ï¼Œå› æ­¤å»ºè®®å®é™…éœ€æ±‚ä½¿ç”¨ä¸­å¼•å…¥<span class="exturl" data-url="aHR0cHM6LS1naXRodWIuY29tL0x1YURpc3QtdGVzdGluZy9jbHVhY292" title="https:--github.com/LuaDist-testing/cluacov">cluacov<i class="fa fa-external-link"></i></span>çš„ hook æ¨¡å—ä½œä¸º hook å‡½æ•°</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>lua è¦†ç›–ç‡ä¿¡æ¯çš„æ”¶é›†ï¼Œæ€»ä½“æ— éå¦‚æˆ‘ä»¬åœ¨ luacov æ‰€çœ‹åˆ°çš„ï¼šåœ¨<code>&#39;l&#39;</code>äº‹ä»¶çš„ hook å‡½æ•°ä¸­è·å–æ–‡ä»¶åä¸ç›¸åº”è¡Œæ•°ï¼Œç„¶åä¿è¯æ¯ä¸€ä¸ª lua çº¿ç¨‹ï¼ˆåç¨‹ï¼‰éƒ½èƒ½æ‰“ä¸Š hookã€‚<br>luacov å®ç°æ€»ä½“è€Œè¨€ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œä¼˜åŒ–ç©ºé—´éå¸¸å¤šï¼Œæ¯”å¦‚ save_stats()å¯ä»¥ä¿®æ”¹ä¸º socketã€websocket ä¸€ç±»å®æ—¶ä¼ é€æ•°æ®ï¼Œä»è€Œé¿å…åŸç”Ÿ luacov è®¾ç½® step è¿‡å°æ—¶å¯¼è‡´æŠ¥å‘Šæ–‡ä»¶ io é¢‘ç¹ï¼Œé€ æˆæ•°æ®ä¸¢å¤±ã€‚å½“ç„¶ï¼Œæœ‰äº†ç½‘ç»œä¼ è¾“ï¼ŒåŸé…çš„å¾ˆå¤šå‚æ•°éƒ½ä¸éœ€è¦äº†ã€‚<br>å†æ·±å…¥ä¸€ç‚¹ï¼Œä»£ç æ–‡ä»¶ç¿»è¯‘æˆæœºå™¨ç ï¼Œæ¯•ç«Ÿæ˜¯çŠ¶æ€æœºä½¿ç„¶ã€‚å¦‚æœç»†å¿ƒè§‚å¯Ÿ luacov è¦†ç›–ç‡çš„ç»“æœçš„è¯ï¼Œä¼šå‘ç°æœ‰å¾ˆå¤šè¯¥ hit çš„è¡Œä¼š hit ä¸åˆ°ã€‚è¿™äº›ç§ç§ï¼Œå°±ç•™å¾…åç»­å‘æ˜å•¦~</p>
]]></content>
      <categories>
        <category>Luaæ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>lua</tag>
        <tag>debug</tag>
        <tag>æµ‹è¯•</tag>
        <tag>ä»£ç è¦†ç›–ç‡</tag>
        <tag>luacov</tag>
      </tags>
  </entry>
  <entry>
    <title>ã€Easy Pythonã€‘ç¬¬ä¸€è¯ï¼šprint(&#39;HelloWorld&#39;)â€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°</title>
    <url>/2019/03/09/easypython/i/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™ä¸ªå¹´ä»£ï¼Œè¿å°å­¦ç”Ÿéƒ½ä¼šPythonäº†ï¼Œæˆ‘å®¶é¢†å¯¼è¿˜æ˜¯ä¸€è¡Œä»£ç éƒ½æ‰“ä¸å‡ºã€‚<br>ç½‘ä¸Šçš„Pythonæ•™ç¨‹ä¸€æŠ“ä¸€å¤§æŠŠï¼Œä½†å‡ºäºè®©äººæ›´åŠ æ·±åˆ»ç†è§£ä»¥åŠå®ç”¨çš„ç›®çš„ï¼ˆå°¤å…¶æ˜¯æˆ‘å®¶é¢†å¯¼ï¼‰ï¼ŒEasy Pythonï¼Œå¼€å§‹æŒ–å‘ï¼</p>
<h2 id="å®‰è£…Python"><a href="#å®‰è£…Python" class="headerlink" title="å®‰è£…Python"></a>å®‰è£…Python</h2><p>è¿™ä¸ªæ²¡æœ‰æ•™ç¨‹= =ï¼Œè¯·å®‰è£…3.*æœ€æ–°ç‰ˆPython<br>ç¼–è¾‘å™¨å»ºè®®ä¸ºvscode ã€sublimeä¹‹ç±»ï¼ˆè®°å¾—è£…æ’ä»¶ï¼‰ï¼Œå¦‚è‹¥è§‰å¾—è£…æ’ä»¶çƒ¦å¯ç›´æ¥ä¸Špycharm<br>Easy Pythonç³»åˆ—ä¸å±•ç°å®æ—¶äº¤äº’å¼å‘½ä»¤~</p>
<h2 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h2><p>å­¦ç¨‹åºçš„ç¬¬ä¸€è¡Œä»£ç ï¼Œå¤§æ¦‚éƒ½æ˜¯Hello Worldå§ï¼</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Hello World!'</span>)</span><br></pre></td></tr></table></figure>
<p>ç„¶åå‘½ä»¤è¡Œé‡Œï¼Œå°±ä¼šè¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Hello World!</span><br></pre></td></tr></table></figure>
<p>é‚£å¦‚æœè¦æ‰“å‡º1è¡Œ100ä¸ªHello Worldçš„è¯ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ<br>å¦‚æœè¿™æ ·çš„è¯ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    print(<span class="string">'Hello World'</span>)</span><br></pre></td></tr></table></figure>
<p>è¯•è¯•çœ‹ï¼Œä¼šæ‰“å‡º100è¡ŒHelloWorldï¼Œä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚<br>è¿™ä¸ªæ—¶å€™ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</p>
<a id="more"></a>
<h3 id="è¾“å…¥ä¸è¾“å‡º"><a href="#è¾“å…¥ä¸è¾“å‡º" class="headerlink" title="è¾“å…¥ä¸è¾“å‡º"></a>è¾“å…¥ä¸è¾“å‡º</h3><p>ç¨‹åºæœ¬è´¨å°±æ˜¯ï¼šè¾“å…¥ -&gt; å‡½æ•°ï¼ˆfunctionï¼‰-&gt;è¾“å‡ºã€‚è¾“å…¥çš„raw dataï¼Œç»ç”±ä¸€ä¸ªå«å‡½æ•°çš„ä¸œè¥¿å¤„ç†ï¼Œå°±èƒ½è¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚<br>å¦‚æœä¸€ä¸ªå‡½æ•°ï¼Œæ²¡æœ‰è¾“å…¥è¾“å‡ºï¼Œä¹Ÿæ²¡å…³ç³»ã€‚è¿™æ ·ï¼Œå‡½æ•°å°±å•çº¯æ˜¯ä¸€ä¸ªæ•°æ®å¤„ç†è¿‡ç¨‹è€Œå·²äº†ã€‚</p>
<p>åœ¨å…ˆå‰çš„HelloWorldï¼Œå°±ä¼¼ä¹æ˜¯è¿™ä¹ˆä¸€ä¸ªç»“æ„ï¼š</p>
<ul>
<li>è¾“å…¥ï¼šHello World</li>
<li>å‡½æ•°ï¼šprint</li>
<li>è¾“å‡ºï¼šå‘½ä»¤è¡Œä¸­æ‰“å‡ºHello World</li>
</ul>
<p>æ‰€ä»¥ï¼Œå’±ä»¬å¯ä»¥ä»å‡½æ•°å…¥æ‰‹ï¼šå¯ä¸å¯ä»¥å®šåˆ¶ä¸€ä¸‹printï¼Œè®©å’±ä»¬çš„Hello Worldèƒ½å¤Ÿæ‰“å‡ºæ¥ä¸æ¢è¡Œå‘¢ï¼Ÿ<br>çœ‹ä¸€çœ‹printè¿™ä¸ªå‡½æ•°ï¼ˆfunctionï¼‰çš„æºç :</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print</span><span class="params">(self, *args, sep=<span class="string">' '</span>, end=<span class="string">'\n'</span>, file=None)</span>:</span></span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œprintå‡½æ•°æœ‰ä¸ªend=â€™\nâ€™çš„å‚æ•°ã€‚é¡¾åæ€ä¹‰ï¼Œæ¯æ¬¡printä¸€ä¸‹ï¼Œè¾“å‡ºçš„å­—ç¬¦ä¸²ç»“å°¾éƒ½æœ‰ä¸€ä¸ªâ€™\nâ€™ã€‚â€™\nâ€™æ˜¯æ¢è¡Œç¬¦ï¼Œé‚£ä¹ˆå°±è¯´æ˜ï¼Œå•çº¯çš„print100ä¸‹ï¼Œå°±ä¼šå‡º100è¡ŒHelloWorldå˜<br>å› æ­¤ï¼Œè¦è§£å†³å’±ä»¬çš„éœ€æ±‚ä¹Ÿå¾ˆç®€å•ï¼ŒæŒ‡å®šendä¸ºä¸æ¢è¡Œï¼Œè¦†ç›–æ‰é»˜è®¤å‚æ•°å°±å¥½äº†~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">    print(<span class="string">'Hello World'</span>, end=<span class="string">'; '</span>)</span><br></pre></td></tr></table></figure>
<p>è¯•è¯•çœ‹å§~</p>
<h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><p>å‡½æ•°ï¼Œfunctionï¼Œå°±åƒæ´»å­—å°åˆ·çš„æ´»å­—è·Ÿæµæ°´çº¿ä¸Šçš„æœºæ¢°å¤„ç†å™¨ä¸€æ ·ï¼Œæ˜¯å¯ä»¥å¤ç”¨çš„å¤„ç†è¿‡ç¨‹ï¼Œæ˜¯é€šç”¨çš„åŠŸèƒ½ã€‚<br>å‡½æ•°çš„è¾“å…¥å«åš<strong>å‚æ•°</strong>ï¼ˆarguments, argsï¼‰ï¼›å‡½æ•°çš„è¾“å‡ºå¯ç§°ä½œ<strong>è¿”å›</strong>ï¼ˆreturnï¼‰ã€‚<br>printå°±æ˜¯ä¸€ä¸ªæœ€å…¸å‹çš„å‡½æ•°ï¼Œæˆ‘ä»¬å†™ä»£ç æ—¶å¸¸å¸¸printæ•°æ®å‡ºæ¥è°ƒè¯•ã€‚printå‡½æ•°ï¼Œå°±æ˜¯è¿™ä¹ˆå®ç”¨ã€‚<br>ç°åœ¨è®©æˆ‘ä»¬å†æ¬¡å›é¡¾ä¸€ä¸‹printçš„å‡½æ•°æ€ä¹ˆå®šä¹‰çš„ï¼ˆdefï¼‰ï¼Œè¿™å›ï¼Œå’±ä»¬æŠŠæ³¨é‡Šä¹Ÿç»™æ‰“å‡ºæ¥~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print</span><span class="params">(self, *args, sep=<span class="string">' '</span>, end=<span class="string">'\n'</span>, file=None)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    print(value, ..., sep=' ', end='\n', file=sys.stdout, flush=False)</span></span><br><span class="line"><span class="string">    Prints the values to a stream, or to sys.stdout by default.</span></span><br><span class="line"><span class="string">    Optional keyword arguments:</span></span><br><span class="line"><span class="string">    file:  a file-like object (stream); defaults to the current sys.stdout.</span></span><br><span class="line"><span class="string">    sep:   string inserted between values, default a space.</span></span><br><span class="line"><span class="string">    end:   string appended after the last value, default a newline.</span></span><br><span class="line"><span class="string">    flush: whether to forcibly flush the stream.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h3><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œprintå‡½æ•°ä¸­ï¼Œè§„å®šäº†è¿™ä¹ˆäº›å‚æ•°ï¼š*args, sep, end, file</p>
<p>é¦–å…ˆå’±ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ªå‚æ•°â€”â€”*argsã€‚é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€å †å‚æ•°ï¼ˆargumentsï¼‰çš„ç§°å‘¼ã€‚å‚æ•°å¼€å¤´ä¸ºå•æ˜Ÿå·*ï¼Œå°±ä»£è¡¨è¿™æ˜¯ä¸€å †<strong>æ— å…³é”®å­—å‚æ•°</strong>ï¼Œå°±å«â€œæ— åå‚æ•°â€å¥½å•¦<br>è€Œåƒsep=xxx, end=xxxä¹‹ç±»çš„ï¼Œéƒ½æ˜¯<strong>å‚æ•°å=å‚æ•°å€¼</strong>çš„ç»“æ„ï¼Œå®ƒä»¬å°±å«â€”â€”<strong>å…³é”®å­—å‚æ•°</strong>ï¼ˆkeyword arguments, kwargsï¼‰ï¼Œå¦‚æœè¦è¡¨ç¤ºä¸€å †å…³é”®å­—å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ï¼š**kwargs</p>
<p>è¯´äº†è¿™ä¹ˆäº›ï¼Œä¸å¦‚å’±ä»¬æ¥è¯•è¯•è¾“å…¥ï¼šæˆ‘çˆ±ä½ </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Wo'</span>, <span class="string">'Ai'</span>, <span class="string">'Ni'</span>)</span><br></pre></td></tr></table></figure>
<p>è¾“å…¥äº†ä¸‰ä¸ªæ— åå‚æ•°ï¼Œç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Wo Ai Ni</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä¸‰ä¸ªæ— åå‚æ•°éƒ½è¢«æ‰“å‡ºæ¥äº†ï¼Œéƒ½è¢«ç©ºæ ¼åˆ†éš”ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±çŸ¥é“sepå‚æ•°ï¼ˆseparatorï¼‰çš„ä½œç”¨äº†ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘çˆ±ä½ ä¸åˆ†éš”çš„æ–¹æ³•æ˜¯~</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(<span class="string">'Wo'</span>, <span class="string">'Ai'</span>, <span class="string">'Ni'</span>, sep=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">WoAiNi</span><br></pre></td></tr></table></figure>
<p>æœ€åä¸€ä¸ªfileå‚æ•°ï¼ŒæŒ‡å®šäº†æˆ‘ä»¬åœ¨å“ªé‡Œprintå‡ºç»“æœã€‚é»˜è®¤å€¼æ˜¯sys.stdoutï¼Œæ ‡å‡†è¾“å‡ºæµï¼Œå’±ä»¬åœ¨cmdå°é»‘æ¡†é‡Œå¸¸çœ‹è§çš„é‚£äº›ç™½å­—å°±æ˜¯é‡Œè¾¹å‡ºæ¥çš„å•¦ã€‚<br>ä¸å¦‚ï¼Œå’±ä»¬è¯•è¯•æŠŠWoAiNiæ‰“è¿›æ–‡ä»¶é‡Œï¼Ÿ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é»˜è®¤file=sys.stdoutï¼Œç³»ç»Ÿæ ‡å‡†è¾“å‡ºæµ</span></span><br><span class="line"><span class="comment"># å› æ­¤è¦è‡ªå®šä¹‰fileï¼Œåˆ™åº”å½“è¦èµ‹äºˆåŒç±»å‹çš„å‚æ•°</span></span><br><span class="line"><span class="comment"># fileåº”è¯¥æŒ‡å®šæˆä¸€ä¸ªè¾“å‡ºæµï¼Œç±»ä¼¼ä¸€ä¸ªæ•°æ®å†™å…¥é€šé“</span></span><br><span class="line"><span class="comment"># pythonå†…ç½®äº†open('æ–‡ä»¶å', 'w')çš„æ–¹æ³•ï¼Œå¯ä»¥åˆ›é€ ä¸€ä¸ªæ–‡ä»¶çš„å†™å…¥æµ</span></span><br><span class="line"><span class="comment"># å…¶ä¸­'w'ä»£è¡¨writeï¼Œå³å†™å…¥æ¨¡å¼</span></span><br><span class="line"><span class="comment"># å¯ä¸èƒ½å•çº¯file='woaini.txt'å–”ï¼Œæ€ä¹ˆèƒ½èµ‹ä¸€ä¸ªå­—ç¬¦ä¸²ä¸Šå»æƒ¹</span></span><br><span class="line">print(<span class="string">'Wo'</span>, <span class="string">'Ai'</span>, <span class="string">'Ni'</span>, sep=<span class="string">''</span>, file=open(<span class="string">'woaini.txt'</span>, <span class="string">'w'</span>))</span><br></pre></td></tr></table></figure>
<p>æ‰“å¼€pythonæ–‡ä»¶åŒç›®å½•ä¸‹ï¼Œæ˜¯ä¸æ˜¯å¤šäº†ä¸€ä¸ªwoaini.txtå•¦~å¿«å»ç§ç§å§ï¼</p>
<h3 id="è¿”å›"><a href="#è¿”å›" class="headerlink" title="è¿”å›"></a>è¿”å›</h3><p>è¯´åˆ°è¿™ä¹ˆå¤šï¼Œprintçš„è¿”å›å€¼ï¼ŒçœŸçš„æ˜¯ä¸Šé¢æ‰€è¯´çš„â€å‘½ä»¤è¡Œä¸­æ‰“å‡ºHello Worldâ€å˜›<br>å½“ç„¶ä¸æ˜¯æ‹‰= =<br>æˆ‘ä»¬å…¶å®å¯ä»¥ç”¨printæ‰“ä¸€ä¸‹printçš„è¿”å›å€¼ï¼Œäº†è§£ä¸€ä¸‹ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = print(<span class="string">'woaini'</span>)</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>
<p>ç»“æœæ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">woaini</span><br><span class="line">None</span><br></pre></td></tr></table></figure>
<p>åœ¨pythoné‡Œï¼ŒNoneæ˜¯ä¸€ä¸ªæŠ½è±¡çš„ç¬¦å·ï¼Œæ˜¯pythonå†…ç½®çš„å…³é”®å­—ï¼ˆä¸æ˜¯å‡½æ•°çš„å…³é”®å­—ï¼ï¼‰ï¼Œä»£è¡¨æ— ï¼Œæ²¡æœ‰æ•°æ®ã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œprintï¼Œè¿”å›äº†Noneã€‚<br>soï¼Œå‘½ä»¤è¡Œçš„è¾“å‡ºç®—ä»€ä¹ˆå‘¢ï¼Ÿ<br>æˆ‘ä»¬å†æ‹¿ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    print(<span class="string">'woaini'</span>)</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a, b = <span class="number">1</span>, <span class="number">1</span></span><br><span class="line">print(func(a, b))</span><br></pre></td></tr></table></figure>
<p>æ‰“å‡ºæ¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">woaini</span><br><span class="line">2</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæœ€ä¸‹è¾¹çš„printï¼Œè¦æ‰“å‡ºå‡½æ•°func(a, b)çš„ç»“æœï¼Œå› æ­¤å…ˆæ‰§è¡Œfuncã€‚åœ¨æ‰§è¡Œfuncçš„æœŸé—´ï¼Œæ‰“å‡ºäº†woainiã€‚ç„¶åæ‰è¿”å›äº†x + yçš„ç»“æœã€‚ä¹‹åï¼Œæ‰æ‰“å‡ºæ¥1+1çš„ç»“æœï¼Œç­‰äº2ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¦æ ¹æ®returnæ‰çŸ¥é“å‡½æ•°è¿”å›ä»€ä¹ˆï¼Œå…¶å®ƒéƒ¨åˆ†çš„è¾“å‡ºéƒ½åªæ˜¯å‡½æ•°è¿‡ç¨‹çš„å‰¯äº§ç‰©ã€‚æ²¡æœ‰returnï¼Œå°±é»˜è®¤è¿”å›Noneã€‚<br>å› æ­¤æ•´ä¸ªprintçš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸ºï¼š</p>
<ul>
<li>å‚æ•°ï¼šè‡ªå®šä¹‰å‚æ•°ï¼ˆ*args, sepä¹‹ç±»ï¼‰ã€printçš„é»˜è®¤å‚æ•°</li>
<li>å‡½æ•°ï¼šprint</li>
<li>è¿‡ç¨‹ï¼šæ‰“å‡ºHello Worldåˆ°æ ‡å‡†è¾“å‡ºæµä¸­ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œçœ‹åˆ°</li>
<li>è¿”å›ï¼šNone</li>
</ul>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å‡½æ•°æ— å¤„ä¸åœ¨ï¼Œä¸ä»…æ˜¯printï¼Œå°±è¿ä½ æ‰§è¡Œçš„pythonè„šæœ¬ï¼Œæœ¬èº«ä¹Ÿå¯ä»¥å½“åšä¸€ä¸ªå‡½æ•°ã€‚<br>æˆ‘ä»¬å»ºä¸€ä¸ªæ–‡ä»¶ï¼š1.pyï¼Œé‡Œé¢å†…å®¹ä¸ºï¼š</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥å†…ç½®çš„â€œç³»ç»ŸåŠŸèƒ½â€æ¨¡å—ï¼šsys</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># printå‡ºæ‰§è¡Œ1.pyçš„å‚æ•°</span></span><br><span class="line">print(sys.argv)</span><br></pre></td></tr></table></figure>
<p>ç„¶åï¼Œcmdå‘½ä»¤è¡Œé‡Œè¿›åˆ°1.pyç›®å½•ä¸‹ï¼Œè¾“å…¥python 1.py 123 abc qwer gogo ainiçœ‹çœ‹ç»“æœå§~</p>
<hr>
<p>è‡³äºç¬¬ä¸€è¯çš„æ„è¯†æµâ€”â€”è¾“å…¥ã€è¾“å‡ºä¸å‡½æ•°ï¼Œå…¶å®æ˜¯ä¸ªè¶…çº§å¤§å‘ï¼Œä¸æ˜¯ä¸‰è¨€ä¸¤è¯­èƒ½å¤Ÿè¯´æ¸…æ¥šçš„ã€‚ä½†æ˜¯ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿåˆ›é€ è¿™æ ·ä¸€ä¸ªæ•ˆæœï¼Œè®©æˆ‘ä»¬é˜…è¯»ä»£ç è·Ÿé˜…è¯»æ™®é€šè‹±æ–‡æ–‡ç« ä¸€æ ·é¡ºç•…ï¼Œè®©æˆ‘äº²çˆ±çš„é¢†å¯¼åœ¨å‚é˜…æˆ‘çš„æ–‡ç« ä¹‹åï¼Œèƒ½å¯¹ç ä»£ç æœ‰æ–°çš„è®¤çŸ¥ä¸æƒ³æ³•ï¼</p>
<p>é€šç¯‡æ–‡ç« ï¼Œæš‚ä¸”ä¸€æ°”å‘µæˆï¼Œæœ‰å™è¿°ä¸å¦¥ä¹‹å¤„ï¼Œæ¬¢è¿æŒ‡æ­£ï¼</p>
]]></content>
      <categories>
        <category>Easy Python</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>æ•™ç¨‹</tag>
        <tag>å‡½æ•°</tag>
        <tag>è¾“å…¥</tag>
        <tag>è¾“å‡º</tag>
      </tags>
  </entry>
</search>
