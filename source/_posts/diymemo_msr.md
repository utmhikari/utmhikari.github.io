---
title: 【DIY小记】踏平Win10升级之坑——我们无法更新系统保留的分区
date: 2019/05/01 20:22:08
categories:
- DIY小记
tags:
- Win10
- DiskGenius
- MSR
- 保留分区
- WinPE
---

## 前言

前几天心血来潮，想把自己船上的Win10更新到18年10月的版本（1809），结果易升下载了更新之后，安装时提示“我们无法更新系统保留的分区”，于是一脸懵逼。

![我们无法更新系统保留的分区](/uploads/diymemo/msr/nomsr.png ''我们无法更新系统保留的分区'')

坑也是要慢慢踩的。熬了两夜，终于成功解决了这个问题，将Win10升级到了最新版本。

<!-- more -->

## 踩坑记录

### 原因分析

遇到这个问题后，笔者第一时间google百度了下解决方案，看到了以下几条：

- [安装win10总是提示：我们无法更新系统保留的分区](https://answers.microsoft.com/zh-hans/windows/forum/windows8_1-update/%E5%AE%89%E8%A3%85win10%E6%80%BB%E6%98%AF%E6%8F%90/2f7bbdb4-33bd-4a7c-bd85-5771a5af16ce)
- [此PC不能运行Windows 10 – 我们无法更新系统保留分区](http://mos86.com/41152.html)
- [win10.15063更新出错"我们无法更新系统保留的分区"](http://bbs.pcbeta.com/forum.php?mod=viewthread&tid=1735923)
- [求助，无法更新windows10!!!问题“我们无法更新系统保留的分区”！！！！！！！！！！](http://bbs.pcbeta.com/forum.php?mod=viewthread&tid=1620970)
- [求助，我们无法更新系统保留的分区](http://tieba.baidu.com/p/4400155997)
- and so on...

总的来看，应该是先前装Windows系统时，安装程序会自动创建一个保留分区，但是由于分区不够大，导致无法安装新版本的系统。

### 问题解决

为了解决这个问题，笔者果断打开祖传的[DiskGenius](http://www.diskgenius.cn/)，查看了下硬盘分区

![引导分区](/uploads/diymemo/msr/efi.jpg ''引导分区'')

![MSR](/uploads/diymemo/msr/msr.jpg ''MSR'')

上图是引导分区（Boot），里边的记录着整个电脑的引导信息。我们常说的启动、重启，其实也就是引导、重引导（Boot&Reboot）。在咱们电脑刚开机的时候，就是利用这个分区的文件来启动操作系统的。

下图是MSR分区（Microsoft Reserved Partition）是Windows装机时候自动会开的预留分区，也就正好对应着提示里的“保留分区”了。我们的工作主要针对这个进行。

如果要扩容MSR分区的话，只能用这个分区相邻的空间。从DiskGenius界面上部分的硬盘条来看，MSR分区的左边是引导分区，存放着启动系统的文件，不好清掉；MSR分区的右边刚上船就自带的恢复分区（Microsoft Recovery Partition），大概500M大小。从网上搜到的资料来看，更新Win10大概需要用到预留分区空间500M左右，原来的MSR加上Recovery的空间加起来也是500M左右，其实是不保险的。再往右的话，就是C盘空间，可以看到那一块空间已经被C盘文件占用了，没法分给MSR分区。

为此，采取以下方案解决问题:

- 删除原先的MSR与恢复分区，将这些空间暂时分给引导分区
- C盘抽出3G，新建MSR与恢复分区

### 修复工作

实现修复操作步骤如下：

#### 操作步骤

1. 备份引导文件——用DiskGenius把引导分区的文件拷贝出来。由于笔者装了Win10跟Linux Mint双系统，因此引导文件缺失的话代价就很大了
2. 制作进入WinPE环境（Windows Preinstall Environment）的U盘启动盘（带各类装机工具）。平时我们做一些装系统跟系统修复操作，就是在在WinPE环境下进行的。具体方式，比如可以下一个[老毛桃](https://www.laomaotao.net/down/)就可以将空的U盘制作成启动盘。制作成启动盘的U盘放其它文件也并不影响其功能。
3. 重启电脑，进入BIOS界面，在启动/引导相关的选项中，将U盘启动优先级调到最高。进入BIOS界面的方法要根据主板/电脑厂家来定。要调整优先级的话，就找Boot之类的选项然后调整顺序。这一步骤基本只需要懂点英文。调好之后再重启，这时候应该就可以进到U盘里老毛桃设置的PE系统了。
4. 进入老毛桃系统后，打开里面自带的DiskGenius（分区工具），记录一下原先MSR与恢复分区的规格（格式、是否隐藏、是否点选厂家OEM之类），然后删除原先的MSR与恢复分区，将这些空间分给引导分区
5. 改变C盘大小，抽出3G空间。1G新建分区，格式为Microsoft Reserved Partition，另外2G新建分区，格式为Microsoft Recovery Partition。两者具体的规格，最好跟步骤4记录的一样。
6. 重启进入BIOS界面，把Windows启动优先级调到最高。
7. 再重启，就能进Windows啦~拔掉U盘，试试升级吧！

#### 注意事项

1. 改变分区涉及到的所有文件，最好都备份。虽然C盘文件不备份也可，但如果想要备份，也无所谓= =
2. 每进行一次改变分区操作之前，都要仔细看说明！操作之后，保存分区表
3. 不要怕，但一定要冷静

## 总结

装机坑多，但更重要的是有一颗主动查资料，敢于踩坑解决问题的决心。

说到这里，我就想到了我家领导，电脑一出bug，就想着重装系统，毫无志气。

- 都9012年了，系统出bug，第一感怎么还是重装系统？？？笨笨！！！
- 你连问题的严重程度都没调研过，怎么能强行付出重装系统的代价呢？？？小傻瓜！！！
- 你要重装，你自己重装啊！！！劳资免费帮你无痛修电脑还不愿意！！！唔QAQ
- 没电脑知识不是借口，要善于求助，多给点儿信息，才能更好地解决问题啊= =

唉，训归训，啥时候才能长点威风唔
